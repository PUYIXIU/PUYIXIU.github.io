[{"title":"Stellarä½¿ç”¨æŒ‡å—","path":"/2025/02/21/hello-world/","content":"éšä¾¿å†™ç‚¹ä»€ä¹ˆå§ Stellar-æ¯ä¸ªäººçš„ç‹¬ç«‹åšå®¢https://xaoxuu.com/blog/20221029/ æ–‡æ¡£ | Hexohttps://hexo.io/zh-cn/docs/ 1ï¸âƒ£ åŸºæœ¬ä½¿ç”¨ğŸ’­ è¡¨è¾¾ç±»æ ‡ç­¾emoji è¡¨æƒ…åŒ… % emoji è›‹ç³• %% emoji twemoji 1f634 %% emoji qq å’–å•¡ %% emoji tieba ç¤¼ç‰© height:2em %% emoji blobcat blobcatheartpride height:3em % blobcat è¡¨æƒ…åº“ icon å›¾æ ‡æ ‡ç­¾å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥å›¾æ ‡ï¼š å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥å›¾æ ‡ï¼š% icon octopus:32 %% icon octopus:32 color:red %% icon octopus:32 color:orange %% icon octopus:32 color:yellow %% icon octopus:32 color:green %% icon octopus:32 color:cyan %% icon octopus:32 color:blue %% icon octopus:32 color:purple % è‡ªå®šä¹‰å›¾æ ‡å¯ä»¥åœ¨ source/_data/icons.yml ä¸­é…ç½® mark æ ‡è®°é»˜è®¤ çº¢ æ©™ é»„ ç»¿ é’ è“ ç´« äº® æš— è­¦å‘Š é”™è¯¯ % mark é»˜è®¤ %% mark çº¢ color:red %% mark æ©™ color:orange %% mark é»„ color:yellow %% mark ç»¿ color:green %% mark é’ color:cyan %% mark è“ color:blue %% mark ç´« color:purple %% mark äº® color:light %% mark æš— color:dark %% mark è­¦å‘Š color:warning %% mark é”™è¯¯ color:error % hashtag æ ‡ç­¾Stellar Hexo GitHub % hashtag Stellar https://xaoxuu.com/wiki/stellar/ %% hashtag Hexo https://hexo.io/ color:blue %% hashtag GitHub https://github.com/xaoxuu/ color:dark % image å›¾ç‰‡æ ‡ç­¾% image src [description] [download:bool/string] [width:px] [padding:px] [bg:hex] [fancybox:bool/string] % å‚æ•°è¯´æ˜src: å›¾ç‰‡åœ°å€description: å›¾ç‰‡æè¿°download: href # ä¸‹è½½åœ°å€ï¼Œè®¾ç½®æ­¤å€¼åé¼ æ ‡æ”¾åœ¨å›¾ç‰‡ä¸Šä¼šæ˜¾ç¤ºä¸‹è½½åœ°å€ï¼Œå¦‚æœä¸‹è½½åœ°å€ä¸ºå›¾ç‰‡åœ°å€ï¼Œå¯ä»¥è®¾ç½®ä¸º truewidth: 200px # å›¾ç‰‡å®½åº¦padding: 16px # å›¾ç‰‡å››å‘¨å¡«å……å®½åº¦bg: #ffffff # å›¾ç‰‡åŒºåŸŸèƒŒæ™¯é¢œè‰²ï¼Œ16è¿›åˆ¶fancybox: href # fancybox æ”¾å¤§åœ°å€ï¼Œè®¾ç½®æ­¤å€¼åä¼šè°ƒç”¨è¯¥é“¾æ¥æ”¾å¤§ï¼Œå¦‚æœæ”¾å¤§åœ°å€ä¸ºå›¾ç‰‡åœ°å€ï¼Œå¯ä»¥è®¾ç½®ä¸º true æ¨ªå‘é“ºæ»¡å›¾ç‰‡çŒ«çŒ«é•‡æ¥¼ % image /images/base/test.jpg çŒ«çŒ«é•‡æ¥¼ download:true fancybox:true % ç«–å›¾ï¼ˆå°å›¾ï¼‰ä¼˜åŒ–çŒ«çŒ«é•‡æ¥¼ % image /images/base/test2.jpg çŒ«çŒ«é•‡æ¥¼ width:300px padding:10px bg:var(--card) download:true fancybox:true % blockquote æ®µè½å¼•ç”¨è¿™æ˜¯ä½¿ç”¨ blockquote æ ‡ç­¾çš„ä¾‹å­ % blockquote %è¿™æ˜¯ä½¿ç”¨ blockquote æ ‡ç­¾çš„ä¾‹å­% endblockquote % quote å¼•ç”¨å±…ä¸­å¼•ç”¨ % quot å±…ä¸­å¼•ç”¨ % è‡ªå®šä¹‰iconé…ç½®åœ¨_config.stellar.ymlçš„quotä¸‹é…ç½® è‡ªå®šä¹‰é…ç½® % quot è‡ªå®šä¹‰é…ç½® icon:coffee % ä¹Ÿå¯ä»¥æŒ‡å®šä»»æ„å›¾æ ‡ % quot ä¹Ÿå¯ä»¥æŒ‡å®šä»»æ„å›¾æ ‡ prefix:cat-head:64 suffix:dog-head:64 % ç‰¹åˆ«å¼•ç”¨ % quot ç‰¹åˆ«å¼•ç”¨ el:h4 icon:talk % poetry è¯—è¯é»‘å®¢ä¹Ÿæ˜¯åˆ›é€ è€…ï¼Œä¸ç”»å®¶ã€å»ºç­‘å¸ˆã€ä½œå®¶ä¸€æ ·ä¿ç½—Â·æ ¼é›·å„å§†é»‘å®¢ææ‡‚ â€œè®¡ç®—ç†è®ºâ€ï¼ˆtheory of computationï¼‰çš„å¿…è¦æ€§ï¼Œä¸ç”»å®¶ææ‡‚é¢œæ–™åŒ–å­¦æˆåˆ†çš„å¿…è¦æ€§å·®ä¸å¤šå¤§ã€‚ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹èŠ‚é€‰ % poetry é»‘å®¢ä¹Ÿæ˜¯åˆ›é€ è€…ï¼Œä¸ç”»å®¶ã€å»ºç­‘å¸ˆã€ä½œå®¶ä¸€æ · author:ä¿ç½—Â·æ ¼é›·å„å§† footer:ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹èŠ‚é€‰ %é»‘å®¢ææ‡‚ **â€œè®¡ç®—ç†è®ºâ€**ï¼ˆtheory of computationï¼‰çš„å¿…è¦æ€§ï¼Œä¸ç”»å®¶ææ‡‚é¢œæ–™åŒ–å­¦æˆåˆ†çš„å¿…è¦æ€§å·®ä¸å¤šå¤§ã€‚% endpoetry % paper çº¸å¼ æ ‡ç­¾ã€Šå¿æ‚”å½•ã€‹èŠ‚é€‰ç¬¬äºŒç« è¿™è¯ä¸æ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„ç»éªŒï¼Œè€Œæ˜¯æ ¹æ®æˆ‘çš„è§‚å¯Ÿï¼Œå› ä¸ºæˆ‘çŸ¥é“è‡ªå·±çš„ç»éªŒæ˜¯å®Œå…¨ä¸é€‚äºåˆ«äººçš„ã€‚ç¬¬ä¸‰ç« å¯æ˜¯æˆ‘æ— è®ºæ€æ ·ç”¨åŠŸï¼Œè¿›æ­¥è¿˜æ˜¯å¾ˆå°ã€‚è¯´èµ·æ¥çœŸæ˜¯å¥‡æ€ªï¼Œæˆ‘è™½ç„¶ä¹Ÿæœ‰ç›¸å½“çš„ç†è§£èƒ½åŠ›ï¼Œæˆ‘å´ä»æ¥ä¸èƒ½ä»è€å¸ˆé‚£é‡Œâ€”â€”çˆ¶äº²å’Œæœ—æ‹œå°”è¥¿åŸƒå…ˆç”Ÿæ˜¯ä¾‹å¤–â€”â€”å­¦åˆ°ä»€ä¹ˆä¸œè¥¿ã€‚æˆ‘å¦å¤–çš„ä¸€äº›çŸ¥è¯†ï¼Œéƒ½æ˜¯æˆ‘è‡ªå­¦æ¥çš„ï¼Œè¿™ä¸ªä»¥åå°±ä¼šæ¸…æ¥šçš„ã€‚æˆ‘é‚£ä¸èƒ½å¿å—ä»»ä½•æŸç¼šçš„æ€æƒ³ä¸è‚¯æœä»æ—¶é—´çš„é™åˆ¶ï¼›æ‹…å¿ƒå­¦ä¸ä¼šçš„å¿ƒæƒ…å¦¨ç¢ç€æˆ‘ä¸“å¿ƒå¬è®²ï¼šç”Ÿæ€•ç”±äºè‡ªå·±ä¸æ‡‚è€Œè®©æ•™æˆ‘çš„äººç€æ€¥çš„å¿ƒæƒ…ä¿ƒä½¿æˆ‘è£…æ‡‚ï¼Œæ•™çš„äººä¸€ç›´å¾€ä¸‹æ•™ï¼Œæˆ‘å´ä»€ä¹ˆä¹Ÿä¸æ‡‚ã€‚æˆ‘æƒ³æŒ‰è‡ªå·±çš„æ­¥è°ƒè¡ŒåŠ¨ï¼Œä¸æ„¿é¡ºä»åˆ«äººçš„æ­¥è°ƒã€‚å¢æ¢­ã€Šå¿æ‚”å½•ã€‹ç¬¬äºŒã€ä¸‰ç« èŠ‚é€‰ % paper style:underline title:ã€Šå¿æ‚”å½•ã€‹èŠ‚é€‰ author:å¢æ¢­ date:ã€Šå¿æ‚”å½•ã€‹ footer:ç¬¬äºŒã€ä¸‰ç« èŠ‚é€‰ %!-- line left --ç¬¬äºŒç« !-- paragraph --è¿™è¯ä¸æ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„ç»éªŒï¼Œè€Œæ˜¯æ ¹æ®æˆ‘çš„è§‚å¯Ÿï¼Œå› ä¸ºæˆ‘çŸ¥é“è‡ªå·±çš„ç»éªŒæ˜¯å®Œå…¨ä¸é€‚äºåˆ«äººçš„ã€‚!-- line right --ç¬¬ä¸‰ç« !-- paragraph --å¯æ˜¯æˆ‘æ— è®ºæ€æ ·ç”¨åŠŸï¼Œè¿›æ­¥è¿˜æ˜¯å¾ˆå°ã€‚è¯´èµ·æ¥çœŸæ˜¯å¥‡æ€ªï¼Œæˆ‘è™½ç„¶ä¹Ÿæœ‰ç›¸å½“çš„ç†è§£èƒ½åŠ›ï¼Œæˆ‘å´ä»æ¥ä¸èƒ½ä»è€å¸ˆé‚£é‡Œâ€”â€”çˆ¶äº²å’Œæœ—æ‹œå°”è¥¿åŸƒå…ˆç”Ÿæ˜¯ä¾‹å¤–â€”â€”å­¦åˆ°ä»€ä¹ˆä¸œè¥¿ã€‚æˆ‘å¦å¤–çš„ä¸€äº›çŸ¥è¯†ï¼Œéƒ½æ˜¯æˆ‘è‡ªå­¦æ¥çš„ï¼Œè¿™ä¸ªä»¥åå°±ä¼šæ¸…æ¥šçš„ã€‚æˆ‘é‚£ä¸èƒ½å¿å—ä»»ä½•æŸç¼šçš„æ€æƒ³ä¸è‚¯æœä»æ—¶é—´çš„é™åˆ¶ï¼›æ‹…å¿ƒå­¦ä¸ä¼šçš„å¿ƒæƒ…å¦¨ç¢ç€æˆ‘ä¸“å¿ƒå¬è®²ï¼šç”Ÿæ€•ç”±äºè‡ªå·±ä¸æ‡‚è€Œè®©æ•™æˆ‘çš„äººç€æ€¥çš„å¿ƒæƒ…ä¿ƒä½¿æˆ‘è£…æ‡‚ï¼Œæ•™çš„äººä¸€ç›´å¾€ä¸‹æ•™ï¼Œæˆ‘å´ä»€ä¹ˆä¹Ÿä¸æ‡‚ã€‚**æˆ‘æƒ³æŒ‰è‡ªå·±çš„æ­¥è°ƒè¡ŒåŠ¨ï¼Œä¸æ„¿é¡ºä»åˆ«äººçš„æ­¥è°ƒã€‚**% endpaper % styleï¼šunderline | æ— ï¼Œæ˜¯å¦å¸¦ä¸‹åˆ’çº¿ titleï¼šæ ‡é¢˜ authorï¼šä½œè€… dateï¼šæ—¥æœŸ footerï¼šé¡µè„š æ­£æ–‡å¯è®¾ç½®æ®µè½æ ¼å¼!-- section å°èŠ‚æ ‡é¢˜ --å°èŠ‚æ ‡é¢˜ï¼Œå±…ä¸­æ˜¾ç¤º!-- paragraph --æ®µè½ï¼Œé¦–è¡Œç¼©è¿›ä¸¤ä¸ªå­—ç¬¦!-- line left --æ®µè½å·¦å¯¹é½!-- line right --æ®µè½å³å¯¹é½ reel å·è½´æ ‡ç­¾å—é™µåˆ«å„¿ç«¥å…¥äº¬æç™½ç™½é…’æ–°ç†Ÿå±±ä¸­å½’ï¼Œé»„é¸¡å•„é»ç§‹æ­£è‚¥ã€‚å‘¼ç«¥çƒ¹é¸¡é…Œç™½é…’ï¼Œå„¿å¥³å¬‰ç¬‘ç‰µäººè¡£ã€‚é«˜æ­Œå–é†‰æ¬²è‡ªæ…°ï¼Œèµ·èˆè½æ—¥äº‰å…‰è¾‰ã€‚æ¸¸è¯´ä¸‡ä¹˜è‹¦ä¸æ—©ï¼Œè‘—é­è·¨é©¬æ¶‰è¿œé“ã€‚ä¼šç¨½æ„šå¦‡è½»ä¹°è‡£ï¼Œä½™äº¦è¾å®¶è¥¿å…¥ç§¦ã€‚ä»°å¤©å¤§ç¬‘å‡ºé—¨å»ï¼Œæˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äººã€‚å…¨å”è¯—èŠ‚é€‰ % reel å—é™µåˆ«å„¿ç«¥å…¥äº¬ author:æç™½ date:å…¨å”è¯— footer:èŠ‚é€‰ %ç™½é…’æ–°ç†Ÿå±±ä¸­å½’ï¼Œé»„é¸¡å•„é»ç§‹æ­£è‚¥ã€‚å‘¼ç«¥çƒ¹é¸¡é…Œç™½é…’ï¼Œå„¿å¥³å¬‰ç¬‘ç‰µäººè¡£ã€‚é«˜æ­Œå–é†‰æ¬²è‡ªæ…°ï¼Œèµ·èˆè½æ—¥äº‰å…‰è¾‰ã€‚æ¸¸è¯´ä¸‡ä¹˜è‹¦ä¸æ—©ï¼Œè‘—é­è·¨é©¬æ¶‰è¿œé“ã€‚ä¼šç¨½æ„šå¦‡è½»ä¹°è‡£ï¼Œä½™äº¦è¾å®¶è¥¿å…¥ç§¦ã€‚ä»°å¤©å¤§ç¬‘å‡ºé—¨å»ï¼Œæˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äººã€‚% endreel % note å¤‡æ³¨å—å¤‡æ³¨æ ‡é¢˜å¤‡æ³¨å†…å®¹ - color: redã€orangeã€amberã€yellowã€greenã€cyanã€blueã€purpleã€lightã€darkã€warningã€error % note å¤‡æ³¨æ ‡é¢˜ å¤‡æ³¨å†…å®¹ [color:color] % link é“¾æ¥å¡ç‰‡Stellar-æ¯ä¸ªäººçš„ç‹¬ç«‹åšå®¢https://xaoxuu.com/blog/20221029/ % link href [title] [icon:src] [desc:true/false] % button æŒ‰é’®æ–‡æ¡£ æ¢ç´¢ - size: é»˜è®¤ | xsï¼ˆæœ€å°å·ï¼‰ % button text url [icon:key/src] [color:color] [size:xs] % % button æ–‡æ¡£ /wiki icon:solar:notebook-bookmark-bold-duotone % % button æ¢ç´¢ /explore icon:solar:planet-bold-duotone size:xs % okr ç›®æ ‡ç®¡ç† okrï¼šObjectives and Key Results O1 2025 å¹´å°ç›®æ ‡ï¼šå…¨çƒæ—…è¡Œ âœˆï¸ ä»å®¶é—¨å£çš„å°å…¬å›­å¼€å§‹å§ æ­£å¸¸ 0% KR1 é‡æ„ tag-plugins å’Œ wiki ç³»ç»Ÿ å½“ KR è¿›åº¦ä¸º 100% æ—¶ï¼Œæ ‡ç­¾é»˜è®¤æ˜¾ç¤ºä¸º å·²å®Œæˆå½“ KR æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œé»˜è®¤ä¸º 0%å½“ O æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰ KR è¿›åº¦å¹³å‡å€¼ æ­£å¸¸ 1% KR2 å®Œæˆä¸»è¦é¡µé¢è®¾è®¡ç¨¿ å°æç¤º1å°æç¤º2æ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­ä¿®æ”¹æ ‡ç­¾çš„é¢œè‰²å’Œæ–‡æ¡ˆæ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­å¢åŠ ä»»æ„çš„æ ‡ç­¾é…ç½® å»¶æœŸ 0% KR3 å®Œæˆå‰ç½®å‡†å¤‡å·¥ä½œ åœ¨å’¸æ°´å’Œæµ·æ»©ä¹‹é—´æ‰¾ä¸€äº©åœ°æ±‚å‡ºåœ†å‘¨ç‡å15ä½æ‰¾å‡ºå®‡å®™çš„ç»ˆæé€»è¾‘å»åœ°ç‹±é‡Œèµ°ä¸¤æ­¥ æœªå®Œæˆ -0% KR-4 å¼€å‘ã€æµ‹è¯•å’Œå‘å¸ƒ é£é™© 0% copy å¤åˆ¶è¡Œ $ % copy curl -s https://sh.xaox.cc/install | sh prefix:$ %% copy git:https xaoxuu.com/hexo-theme-stellar %% copy git:ssh xaoxuu.com/hexo-theme-stellar %% copy git:gh xaoxuu.com/hexo-theme-stellar % radio å•é€‰æ²¡æœ‰å‹¾é€‰çš„å•é€‰æ¡† å·²å‹¾é€‰çš„å•é€‰æ¡† æ²¡æœ‰å‹¾é€‰çš„å•é€‰æ¡† å·²å‹¾é€‰çš„å•é€‰æ¡† % radio æ²¡æœ‰å‹¾é€‰çš„å•é€‰æ¡† %% radio checked:true å·²å‹¾é€‰çš„å•é€‰æ¡† % checkedï¼štrue | false colorï¼šé¢œè‰² checkbox å¤é€‰æ™®é€šçš„æ²¡æœ‰å‹¾é€‰çš„å¤é€‰æ¡† æ™®é€šçš„å·²å‹¾é€‰çš„å¤é€‰æ¡† æ˜¾ç¤ºä¸ºåŠ å·çš„ç»¿è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† æ˜¾ç¤ºä¸ºå‡å·çš„é»„è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† æ˜¾ç¤ºä¸ºä¹˜å·çš„çº¢è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† % checkbox æ™®é€šçš„æ²¡æœ‰å‹¾é€‰çš„å¤é€‰æ¡† %% checkbox checked:true æ™®é€šçš„å·²å‹¾é€‰çš„å¤é€‰æ¡† %% checkbox symbol:plus color:green checked:true æ˜¾ç¤ºä¸ºåŠ å·çš„ç»¿è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† %% checkbox symbol:minus color:yellow checked:true æ˜¾ç¤ºä¸ºå‡å·çš„é»„è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† %% checkbox symbol:times color:red checked:true æ˜¾ç¤ºä¸ºä¹˜å·çš„çº¢è‰²çš„å·²å‹¾é€‰çš„å¤é€‰æ¡† % checkedï¼štrue | false symbolï¼š plus | minus | times colorï¼šé¢œè‰² audio éŸ³é¢‘æ ‡ç­¾ æ”¯æŒéŸ³ä¹å¤–é“¾å’Œç½‘æ˜“äº‘éŸ³ä¹ Your browser does not support the audio tag. % audio https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3 %% audio netease:4919517 %% audio type:2 netease:4919517 autoplay:0 % type 2 è¡¨ç¤ºæ­Œæ›² 0 è¡¨ç¤ºæ­Œå• netease: æ­Œæ›²æ­Œå• idï¼Œåœ¨ç½‘æ˜“äº‘åˆ†äº«é“¾æ¥ä¸­èƒ½æ‰¾åˆ° autoplay 1 è¡¨ç¤ºè‡ªåŠ¨æ’­æ”¾ 0 è¡¨ç¤ºæ‰‹åŠ¨æ’­æ”¾ video è§†é¢‘æ ‡ç­¾ % video bilibili:BV1x44y1K7ho %% video youtube:FDUk0Kcte9A %- width: 500px # å•ä½ 80% 20em 100mm- autoplay: 1/0 # 1ï¼šè‡ªåŠ¨æ’­æ”¾ 0ï¼šæ‰‹åŠ¨æ’­æ”¾ navbar å¯¼èˆªæ æ–‡ç« é¡¹ç›®ç•™è¨€GitHub - ç”±é“¾æ¥ç»„æˆçš„å¯¼èˆªæ  % navbar active:/wiki/ [æ–‡ç« ](/) [é¡¹ç›®](/wiki/) [ç•™è¨€](#comments) [GitHub](https://github.com/xaoxuu/) % frame è®¾å¤‡æ¡†æ¶ % frame iphone11 img:/assets/wiki/prohud/toast/demo-loading.png video:/assets/wiki/prohud/toast/demo-loading.mp4 focus:top % æ–‡æœ¬ä¿®é¥°æ ‡ç­¾é›† è¿™æ˜¯ å¯†ç  æ ‡ç­¾ è¿™æ˜¯ ä¸‹åˆ’çº¿ æ ‡ç­¾ è¿™æ˜¯ ç€é‡å· æ ‡ç­¾ è¿™æ˜¯ æ³¢æµªçº¿ æ ‡ç­¾ è¿™æ˜¯ åˆ é™¤çº¿ æ ‡ç­¾ è¿™æ˜¯ ä¸Šè§’æ ‡ æ ‡ç­¾ è¿™æ˜¯ ä¸‹è§’æ ‡ æ ‡ç­¾ è¿™æ˜¯ é”®ç›˜æ ·å¼ æ ‡ç­¾ï¼Œè¯•ä¸€è¯•ï¼šâŒ˜ + D - è¿™æ˜¯ % psw å¯†ç  % æ ‡ç­¾- è¿™æ˜¯ % u ä¸‹åˆ’çº¿ % æ ‡ç­¾- è¿™æ˜¯ % emp ç€é‡å· % æ ‡ç­¾- è¿™æ˜¯ % wavy æ³¢æµªçº¿ % æ ‡ç­¾- è¿™æ˜¯ % del åˆ é™¤çº¿ % æ ‡ç­¾- è¿™æ˜¯ % sup ä¸Šè§’æ ‡ color:red % æ ‡ç­¾- è¿™æ˜¯ % sub ä¸‹è§’æ ‡ % æ ‡ç­¾- è¿™æ˜¯ % kbd é”®ç›˜æ ·å¼ % æ ‡ç­¾ï¼Œè¯•ä¸€è¯•ï¼š% kbd âŒ˜ % + % kbd D % ğŸ”¢ æ•°æ®ç±»æ ‡ç­¾timeline æ—¶é—´çº¿2025 å¹´ 2 æœˆ 25 æ—¥ä»Šå¤©ç§‘ä¸‰è€ƒè¯•æœ€åç†„ç«ï¼Œè¿˜å¥½æˆ‘å¹³æ—¶ç»ƒè½¦ç†„ç«å¤ªå¤šæ‰€ä»¥å¾ˆç†Ÿï¼Œå›ç©ºæŒ¡æ‰“ç«æ¢ä¸€æ¡£å®Œæˆé è¾¹åœè½¦ï¼Œè´´ç€åŠæ ¼çº¿è¿‡äº†ï¼Œæ¿€åŠ¨çš„å¿ƒé¢¤æŠ–çš„æ‰‹2025 å¹´ 2 æœˆ 24 æ—¥ä¸‹åˆç§‘ç›®ä¸‰æ¨¡æ‹Ÿ 3 æŠŠè¿æŒ‚ï¼Œæ•™ç»ƒå·®ç‚¹æ°”æ’…è¿‡å» % timeline %!-- node 2025 å¹´ 2 æœˆ 25 æ—¥ --ä»Šå¤©ç§‘ä¸‰è€ƒè¯•æœ€åç†„ç«ï¼Œè¿˜å¥½æˆ‘å¹³æ—¶ç»ƒè½¦ç†„ç«å¤ªå¤šæ‰€ä»¥å¾ˆç†Ÿï¼Œå›ç©ºæŒ¡æ‰“ç«æ¢ä¸€æ¡£å®Œæˆé è¾¹åœè½¦ï¼Œè´´ç€åŠæ ¼çº¿è¿‡äº†ï¼Œæ¿€åŠ¨çš„å¿ƒé¢¤æŠ–çš„æ‰‹% image /images/meme/idrive.jpg width:300px %!-- node 2025 å¹´ 2 æœˆ 24 æ—¥ --ä¸‹åˆç§‘ç›®ä¸‰æ¨¡æ‹Ÿ 3 æŠŠè¿æŒ‚ï¼Œæ•™ç»ƒå·®ç‚¹æ°”æ’…è¿‡å»% image /images/meme/acat.jpg width:200px %% endtimeline % åŠ¨æ€æ—¶é—´çº¿å‚è€ƒ friends å‹é“¾æ˜çœ¸å¦‚åˆæ–‘æ–‘reuixiy /source/_data/links/exm_blogs.yml- title: æ˜çœ¸å¦‚åˆ url: https://www.zywvvd.com/ cover: icon: https://www.zywvvd.com/image/avatar.png description: Hexo-Butterflyæ­å»ºï¼Œè®¿é—®ç»Ÿè®¡çš„3dæ¨¡å‹éå¸¸ç‚«é…· % friends exm_blogs % sites ç½‘ç«™å¡ç‰‡unsplashé«˜è´¨é‡å›¾ç‰‡åˆ†äº«å¹³å° /source/_data/links/sites_design.yml- title: unsplash url: https://unsplash.com/ cover: /images/site/unsplash.png icon: https://unsplash.com/favicon.ico description: é«˜è´¨é‡å›¾ç‰‡åˆ†äº«å¹³å° % sites sites_design % ghcard å¡ç‰‡GitHub Card APIhttps://github.com/anuraghazra/github-readme-stats % ghcard puyixiu theme:dark %% ghcard PUYIXIU/ashihachi-stellar-blog theme:dark % ğŸ“¦ å®¹å™¨ç±»æ ‡ç­¾box ç›’å­å®¹å™¨% box [title] [color:color] [child:codeblock/tabs] %% endbox % å‚æ•°è¯´æ˜title: æ ‡é¢˜color: red/orange/yellow/green/cyan/blue/purple/light/darkchild: codeblock | tabs folding æŠ˜å å®¹å™¨å±•å¼€è¯¦æƒ… % folding title [codeblock:bool] [open:bool] [color:color] %content% endfolding % å‚æ•°è¯´æ˜codeblock: true | falseopen: true | falsecolor: red/orange/yellow/green/cyan/blue/purple/light/dark folders èšåˆæŠ˜å å®¹å™¨æŠ½å±‰A è¿™ä¸ªæŠ½å±‰æ˜¯ç©ºçš„æŠ½å±‰B è¿™ä¸ªæŠ½å±‰æ˜¯ç©ºçš„æŠ½å±‰C æ‰¾åˆ°äº†ä¸€æŠŠæ‰‹ç”µç­’ % folders %!-- folder æŠ½å±‰A --è¿™ä¸ªæŠ½å±‰æ˜¯ç©ºçš„!-- folder æŠ½å±‰B --è¿™ä¸ªæŠ½å±‰æ˜¯ç©ºçš„!-- folder æŠ½å±‰C --æ‰¾åˆ°äº†ä¸€æŠŠæ‰‹ç”µç­’% endfolders % tabs åˆ†æ å®¹å™¨å›¾ç‰‡ä»£ç å—è¡¨æ ¼let x = 123;console.log(Hello World); a b c a1 b1 c1 a2 b2 c2 % tabs active:2 align:center %!-- tab å›¾ç‰‡ --% image /images/base/test.jpg width:300px %!-- tab ä»£ç å— --content!-- tab è¡¨æ ¼ --| a | b | c || --- | --- | --- || a1 | b1 | c1 || a2 | b2 | c2 |% endtabs % å‚æ•°é…ç½®align: centeractive: æ¿€æ´»æ ‡ç­¾ grid ç½‘æ ¼åˆ†åŒºåŠ¨æ€åˆ—æ•° é»˜è®¤å¸ƒå±€1åˆ—: 240px - 480px2åˆ—: 480px - 720px3åˆ—: 720px é¾Ÿå±±æ±‰å¢“å´–æ´å¢“æ˜¯åœ¨çŸ³å±±ä¸­å¼€å‡¿å¢“å®¤çš„ä¸€ç§å¢“è‘¬å½¢åˆ¶ï¼Œåœ°ä¸‹ç©ºé—´çš„å¸ƒç½®è™½ç„¶æ¯”è¾ƒè‡ªç”±ï¼Œä½†éƒ½æœ€å¤§é™åº¦è±¡å¾å’Œæ¨¡ä»¿äº†åœ°ä¸Šç”Ÿæ´»çš„å†…å®¹ã€‚ç›®å‰æ‰€çŸ¥çš„æ±‰ä»£è¯¸ä¾¯ç‹å´–æ´å¢“åˆ†å¸ƒåœ¨æ±Ÿè‹å¾å·ã€æ²³åŒ—æ»¡åŸç­‰åœ°ï¼Œå…±æœ‰ä¸‰åå¤šåº§ã€‚ä¸»è¦é›†ä¸­äºé»„æ·®ä¹‹é—´çš„ä¸œéƒ¨åœ°åŒºã€‚å¾å·åŒ—æ´å±±æ±‰å¢“å’Œç‹®å­å±±æ±‰å¢“å°±æ˜¯è¥¿æ±‰å‰æœŸçš„ä¸¤åº§å¤§å‹æ¥šç‹å´–æ´å¢“ã€‚åˆ˜æ³¨å¢“åŸæ£ºå®¤çš„å®¤é¡¶æ­£å¥½å¯¹ç€å±±çš„æœ€é«˜å¤„ï¼ŒçœŸä¸çŸ¥é“åœ¨å±±é‡Œä½œä¸šçš„å·¥åŒ æ˜¯æ€ä¹ˆç¡®å®šçš„ä½ç½®ã€‚ä¸è¿‡åæ¥å› ä¸ºé¡¶ä¸Šè£‚å¼€äº†ï¼Œæ‰æŠŠæ£ºæ¤ç§»åˆ°ç°åœ¨çš„å¢“å®¤é‡Œã€‚ % grid %!-- cell --content left!-- cell --content right% endgrid % å‚æ•°é…ç½®w: ä¸€åˆ—çš„å®½åº¦c: å›ºå®šåˆ—æ•°bg: box | cardgap: æ¯åˆ—ä¹‹é—´çš„é—´è·ï¼Œé»˜è®¤16pxbr: åœ†è§’åŠå¾„ å›ºå®šåˆ—æ•° % grid c:2 %...% endgrid % èƒŒæ™¯æ ·å¼ cell 1 cell 2 cell 3 cell 4 cell 1 cell 2 cell 3 cell 4 gallery å›¾åº“ç±»ä¼¼æ•ˆæœ albums ä¸“è¾‘å®¹å™¨posters æµ·æŠ¥å®¹å™¨ @tianhao_wang@eberhard@eberhard@eberhard@eberhard@vklemen % gallery %![@tianhao_wang](https://images.unsplash.com/photo-1688142202243-e218ad203952?w=800auto=formatfit=cropq=60ixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHx0b3BpYy1mZWVkfDYzfEZ6bzN6dU9ITjZ3fHxlbnwwfHx8fHw%3D)![@eberhard](https://images.unsplash.com/photo-1700994630045-f7a20df6d92e?w=800auto=formatfit=cropq=60ixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHxwcm9maWxlLXBhZ2V8MjN8fHxlbnwwfHx8fHw%3D)![@eberhard](https://images.unsplash.com/photo-1533274221104-015a584a1005?w=800auto=formatfit=cropq=60ixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHx0b3BpYy1mZWVkfDE4fGJvOGpRS1RhRTBZfHxlbnwwfHx8fHw%3D)![@eberhard](https://images.unsplash.com/photo-1539604214100-ab860d9082e0?w=800auto=formatfit=cropq=60ixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHx0b3BpYy1mZWVkfDIxfGJvOGpRS1RhRTBZfHxlbnwwfHx8fHw%3D)![@eberhard](https://images.unsplash.com/photo-1698843848092-588f9c1bb0bd?w=800auto=formatfit=cropq=60ixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHxwcm9maWxlLXBhZ2V8Mzh8fHxlbnwwfHx8fHw%3D)![@vklemen](https://images.unsplash.com/photo-1516571748831-5d81767b788d?q=80w=2574auto=formatfit=cropixlib=rb-4.0.3ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)% endgallery % banner æ¨ªå¹…å®¹å™¨å‚æ•°é…ç½®bg: èƒŒæ™¯avatar: å¤´åƒlink: è·³è½¬é“¾æ¥ ç‹¬ç«‹é¡µé¢ éšè®°æ”¶è—éšè®° % banner éšè®° bg:/images/covers/coffee1.jpg %% navbar active:/notes/ [éšè®°](/notes/) [æ”¶è—](/bookmark/) %% endbanner % ç”¨æˆ·èµ„æ–™é¡µ è¶³å…«æ¡‘å…«æ¡è…¿å„æœ‰æƒ³æ³• % banner è¶³å…«æ¡‘ å…«æ¡è…¿å„æœ‰æƒ³æ³• bg:/images/covers/pixel_universe.png avatar:/images/base/avatar.png %% endbanner % swiper è½®æ’­å®¹å™¨ % swiper effect:cards %![](https://images.unsplash.com/photo-1625171515821-1870deb2743b?ixlib=rb-4.0.3ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8auto=formatfit=cropw=774q=80)![](https://images.unsplash.com/photo-1528283648649-33347faa5d9e?ixlib=rb-4.0.3ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8auto=formatfit=cropw=774q=80)![](https://images.unsplash.com/photo-1542272201-b1ca555f8505?ixlib=rb-4.0.3ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8auto=formatfit=cropw=774q=80)![](https://images.unsplash.com/photo-1524797905120-92940d3a18d6?ixlib=rb-4.0.3ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8auto=formatfit=cropw=774q=80)% endswiper % å‚æ•°é…ç½®effect: cards | coverflowwidth: min | max 2ï¸âƒ£ è¿›é˜¶ç”¨æ³•è‡ªå®šä¹‰å°ç»„ä»¶ç»„ä»¶åº“åœ¨ _data/widgets.yml ä¸­åˆ›å»º ç»„ä»¶åº“toc ç›®å½•æ ‘æ•ˆæœå¯ä»¥å‚è€ƒå½“å‰é¡µé¢å³ä¾§çš„ æœ¬æ–‡ç›®å½• _data/widgets.ymltoc:layout: toclist_number: false # æ˜¯å¦æ˜¾ç¤ºåºå·min_depth: 2 # å»ºè®®ä¸è¦ä½äº 2 å³ä» H2 æ ‡ç­¾å¼€å§‹è§£æï¼ˆH1 æ ‡ç­¾ç”¨äºæ–‡ç« å¤§æ ‡é¢˜ï¼‰max_depth: 5 # 5 ä»£è¡¨æœ€å¤šè§£æåˆ° H5 æ ‡ç­¾fallback: recent # Use a backup widget when toc does not exist.collapse: false # true / false / auto (å§‹ç»ˆæŠ˜å /ä¸æŠ˜å /è‡ªåŠ¨æŠ˜å ) recent è¿‘æœŸæ–‡ç« _data/widgets.ymlrecent:layout: recentrss: # /atom.xml # npm i hexo-generator-feedlimit: 5 # Count of posts related ç›¸å…³æ–‡ç« å±•ç¤ºæœ‰ç›¸åŒ tag çš„å…¶å®ƒé¡¹ç›® _data/widgets.ymlrelated:layout: related linkList é“¾æ¥åˆ—è¡¨å±•ç¤ºä¸€ç»„é“¾æ¥åˆ—è¡¨ _data/widgets.ymllinklist:layout: linklist# columns:1 åˆ—è¡¨æ˜¾ç¤º# columns:2 æ¯ 2 ä¸ªæŒ‰é’®æ”¾ä¸€è¡Œcolumns: 1items:#- icon: svg.../svg # æˆ–è€… icons.yml ä¸­è®¾ç½®çš„ icon åç§°- icon: github:logo # æˆ–è€… icons.yml ä¸­è®¾ç½®çš„ icon åç§° title: å…³äº url: /about/ markdown æ–‡æœ¬å†…å®¹_data/widgets.ymlwelcome:layout: markdowntitle: æ¬¢è¿æ¬¢è¿#linklist: # ä¸ linklist ç»„ä»¶å†™æ³•ç›¸åŒ # columns: 1 # items: # - icon: # title: # url:content: |æ¬¢è¿æ¥åˆ° **èµ›åšçŠç‘šç¤ ğŸª¸**æˆ‘æ˜¯è¿™é—´é™‹å®¤çš„å®ˆé—¨äºº **Ashly**å®¶é‡Œé‚£ä½å…«è…•ç›®æ­£åœ¨ **èµ›åšäº‘æ¸¸ä¸­**è¯·é—®è¦æ¥æ¯ **æµ·ç›é£å‘³çš„å’–å•¡ â˜•** å—ï¼Ÿdiv style=display:flex;justify-content:centerimg src=/images/base/TaiFi.gif //divsrc: # å¯ä»¥è®¾ç½®å¤–éƒ¨ md æ–‡ä»¶é“¾æ¥ tagcloud æ ‡ç­¾äº‘_data/widgets.ymltagcloud:layout: tagcloudtitle: æ ‡ç­¾äº‘# æ ‡ç­¾äº‘é…ç½®min_font: 12max_font: 24amount: 100orderby: nameorder: 1 # 1, sac å‡åºï¼›-1, desc é™åºcolor: false # ä½¿ç”¨é¢œè‰²start_color: # å¼€å§‹çš„é¢œè‰²ã€‚æ‚¨å¯ä½¿ç”¨åå…­è¿›ä½å€¼ï¼ˆ#b700ffï¼‰ï¼Œrgbaï¼ˆrgba(183, 0, 255, 1)ï¼‰ï¼Œhslaï¼ˆhsla(283, 100%, 50%, 1)ï¼‰æˆ– é¢œè‰²å…³é”®å­—ã€‚æ­¤å˜é‡ä»…åœ¨ color å‚æ•°å¼€å¯æ—¶æ‰æœ‰ç”¨ã€‚end_color: # ç»“æŸçš„é¢œè‰²ã€‚æ‚¨å¯ä½¿ç”¨åå…­è¿›ä½å€¼ï¼ˆ#b700ffï¼‰ï¼Œrgbaï¼ˆrgba(183, 0, 255, 1)ï¼‰ï¼Œhslaï¼ˆhsla(283, 100%, 50%, 1)ï¼‰æˆ– é¢œè‰²å…³é”®å­—ã€‚æ­¤å˜é‡ä»…åœ¨ color å‚æ•°å¼€å¯æ—¶æ‰æœ‰ç”¨ã€‚show_count: false # æ˜¾ç¤ºæ¯ä¸ªæ ‡ç­¾çš„æ–‡ç« æ€»æ•° ghuser github ç”¨æˆ·é¢æ¿_data/widgets.ymlghuser:layout: ghuserusername: github # your github login usernameavatar: true # show avatar or notmenu: true # show menu or not ghrepo github é¡¹ç›®é¢æ¿_data/widgets.ymlghrepo:layout: ghrepo _posts/xxx.mdrepo: xaoxuu/hexo-theme-stellar _data/wiki/projects.ymlname: Stellartitle: Stellarsubtitle: æ¯ä¸ªäººçš„ç‹¬ç«‹åšå®¢ | Designed by xaoxuurepo: xaoxuu/hexo-theme-stellar timeline æ—¶é—´çº¿_data/widgets.ymltimeline:layout: timelinetitle: è¿‘æœŸåŠ¨æ€api: https://api.github.com/repos/xaoxuu/hexo-theme-stellar/issues # è‹¥ä½ æƒ³é™åˆ¶æ•°é‡ï¼Œåœ¨ api é“¾æ¥åé¢åŠ ä¸Š?per_page=1 æŒ‡é™åˆ¶ä¸º 1 æ¡user: # æ˜¯å¦è¿‡æ»¤åªæ˜¾ç¤ºæŸä¸ªäººå‘å¸ƒçš„å†…å®¹ï¼Œå¦‚æœè¦ç­›é€‰å¤šäººï¼Œç”¨è‹±æ–‡é€—å·éš”å¼€hide: # title,footer # éšè—æ ‡é¢˜æˆ–åº•éƒ¨ # æ­¤åŠŸèƒ½éœ€è¦ Stellar v1.13.0 çµæ´»ç”¨æ³•æŒ‡å®šçš„é¡µé¢å¦‚æœå¸Œæœ›å¯¹ç»„ä»¶çš„æŸä¸ªå±æ€§è¿›è¡Œè¦†å†™æ—¶ï¼š _post/xxx.md---title: æŸä¸€ç¯‡æ–‡ç« leftbar: - welcome # åªå†™ä¸€ä¸ªå­—ç¬¦ä¸²ä»£è¡¨å¼•ç”¨å¯¹åº”çš„é€šç”¨ç»„ä»¶ - override: my_timeline_lite api: https://xxx---","tags":["hexo"]},{"title":"cocosæ¸¸æˆå¼€å‘è®°å½•ï¼šğŸ Name Your Gift","path":"/2024/12/24/NameYourGift/","content":"ğŸ å‰è¨€ğŸğŸğŸ ç¬¬ä¸€æ¬¡ä»å¤´åˆ°å°¾å¼€å‘ä¸€æ¬¾å®Œæ•´çš„h5å°æ¸¸æˆï¼Œä»ç­–åˆ’ã€å¼€å‘åˆ°ä¸Šæ¶ä¸€å…±èŠ±è´¹äº†16å¤©å·¦å³çš„æ—¶é—´ï¼Œç¬”è€…ä»æ¥æ²¡æœ‰æ¥è§¦è¿‡æ¸¸æˆè¡Œä¸šï¼Œå¯¹æ¸¸æˆå¼€å‘ä¹Ÿå¤„äºæ‘¸ç´¢çš„åˆæœŸï¼Œè¿™ç¯‡æ–‡ç« çš„å†™ä½œç›®çš„ï¼Œæ˜¯è®°å½•æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œå’Œè§£å†³é—®é¢˜çš„æ€è·¯ã€‚ä»Šå¤©æ˜¯2024å¹´12æœˆ24æ—¥å¹³å®‰å¤œğŸ„ï¼Œç¥å¤§å®¶åœ£è¯èŠ‚å¿«ä¹ï¼Œå¼€å¼€å¿ƒå¿ƒè¿æ¥2025ğŸ‰ğŸ‰ğŸ‰ï¼ ğŸ… æ¸¸æˆä»‹ç» *åœ£è¯èŠ‚å‰å¤•ï¼Œåœ£è¯è€äººğŸ…æ­£åœ¨å‡†å¤‡é€ç»™å­©å­ä»¬çš„ç¤¼ç›’ï¼Œæ”¶é›†æ•£è½åœ¨æˆ¿é—´å„å¤„çš„ææ–™æ‰“åŒ…æˆç¤¼ç›’ğŸï¼Œæ‰¾åˆ°åˆé€‚çš„é€ç¤¼å¯¹è±¡ï¼ŒæŒ‰ç…§ä»–ä»¬çš„å–œå¥½è¿›è¡ŒåŒ…è£…ã€‚* ğŸ‘‰itch.ioå®Œæ•´ç‰ˆæ¸¸æˆåœ°å€ğŸ‘‰æ¸¸æˆå…¨æµç¨‹å±•ç¤º æ¸¸æˆåç§°ï¼š Name Your Gift ä¸­æ–‡åï¼š æ±‚ç¤¼å¿…åº” æ”¯æŒè¯­è¨€ï¼š ä¸­æ–‡ã€è‹±æ–‡ æ¸¸ç©æ—¶é—´ï¼š 5-10min å¹³å°ï¼š PC æ¸¸ç©è®¾å¤‡ï¼š é¼ æ ‡ã€é”®ç›˜ è¿è¡Œå¹³å°ï¼š æµè§ˆå™¨ æ¸¸æˆç±»å‹ï¼š 2då¹³å°è·³è·ƒã€åƒç´ é£æ ¼ âœ‚ï¸ æ¸¸æˆæˆªå›¾ ğŸ® æ“ä½œè§„åˆ™â„ï¸ä½¿ç”¨ADWæˆ–è€…**â†â†’â†‘**è¿›è¡Œç§»åŠ¨å’Œè·³è·ƒâ›„ï¸Eé”®ä¸¾èµ·ç‰©å“ï¼ŒXé”®ä¸NPCæˆ–æ ·å¼å°è¿›è¡Œäº¤äº’ï¼ŒSpaceé”®è·³è¿‡å¯¹è¯ğŸé˜…è¯»å­©å­ä»¬å¯„æ¥çš„ä¿¡ä»¶ï¼Œæ‰¾åˆ°é€‚åˆä»–ä»¬çš„ç¤¼ç‰©ï¼ŒæŒ‰ç…§ä»–ä»¬çš„å–œå¥½è¿›è¡ŒåŒ…è£…ğŸ›·å°†ç¡®è®¤åŒ…è£…å¥½çš„ç¤¼ç›’ä¸¢åˆ°é›ªæ©‡è½¦ä¸­ ğŸ’» å¼€å‘è¿‡ç¨‹ğŸ“˜ ç¬¬ä¸€æ­¥ï¼šç­–åˆ’è¿™é‡Œä¸»è¦ç”¨å‡ ä¸ªé—®é¢˜ä½œä¸ºåˆ‡å…¥ç‚¹ï¼š1. ä¸ºä»€ä¹ˆè¦åšè¿™æ¬¾æ¸¸æˆï¼Ÿ2. è¿™æ¬¾æ¸¸æˆçš„æ ¸å¿ƒç©æ³•æ˜¯ä»€ä¹ˆï¼Ÿ3. è¿™æ¬¾æ¸¸æˆå¸Œæœ›è¾¾æˆçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ é—®é¢˜1ï¼šä¸ºä»€ä¹ˆè¦åšè¿™æ¬¾æ¸¸æˆï¼Ÿ ç­”ï¼š çº¯ä¸»è§‚ç­”æ¡ˆã€‚å› ä¸ºç¬”è€…å¹³æ—¶æ¯”è¾ƒå–œæ¬¢æ‰“æ¸¸æˆï¼Œæ¯”è¾ƒå…³æ³¨ç‹¬ç«‹æ¸¸æˆä¸ç‹¬æ¸¸å¼€å‘è€…ï¼Œå¸Œæœ›èƒ½åŠ å…¥è¿™ä¸ªè¡Œåˆ—ï¼Œç¬”è€…æœ¬èŒæ˜¯Webå‰ç«¯å·¥ç¨‹å¸ˆï¼Œåªèƒ½é ä¸‹ç­åé›¶ç¢æ—¶é—´å­¦ä¹ æ¸¸æˆç›¸å…³çŸ¥è¯†ï¼Œä½†æ— è®ºæ€ä¹ˆå­¦ï¼Œæ€»è§‰å¾—æ‘¸ä¸åˆ°é—¨è·¯ï¼Œäºæ˜¯å¸Œæœ›åˆ©ç”¨ç°åœ¨å­¦åˆ°çš„ä¸œè¥¿ï¼Œå®Œå®Œæ•´æ•´çš„åšä¸€æ¬¾æ¸¸æˆï¼Œäº²è‡ªå®è·µä¸€ä¸‹ï¼Œæ€»ç»“ç»éªŒï¼Œä¸ºä¸‹ä¸€æ­¥çš„å­¦ä¹ æ‰¾åˆ°æ–¹å‘ã€‚ é—®é¢˜2ï¼šè¿™æ¬¾æ¸¸æˆçš„æ ¸å¿ƒç©æ³•æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š è¿™æ¬¾æ¸¸æˆå®é™…ä¸Šæ›´åƒæ˜¯ä¸€æ¬¡ä¸´æ‘¹ã€‚ç©æ³•ä¸Šå¹¶æ²¡æ€ä¹ˆè®¾è®¡ï¼Œæœ€åˆçš„æƒ³æ³•æ˜¯ï¼šèƒ½åˆ©ç”¨ç°åœ¨å­¦ä¹ åˆ°çš„ä¸œè¥¿ï¼Œä»å¤´åˆ°è„šåˆ¶ä½œå‡ºä¸€æ¬¾å’Œåœ£è¯èŠ‚ç›¸å…³çš„æ¸¸æˆå°±è¡Œã€‚ä¸´æ‘¹çš„å¯¹è±¡æ˜¯itch.ioä¸Šçš„åˆ›ä½œè€…williambilliamçš„æ¸¸æˆä½œå“festive-frenzyï¼Œ2023å¹´itch.io Christmas Game Jamçš„å‚èµ›è·å¥–æ¸¸æˆã€‚è¯•ç©ä¹‹åè§‰å¾—éå¸¸é€‚åˆæ¸¸æˆå¼€å‘ä¸Šæ‰‹ã€‚è¿™æ¬¾æ¸¸æˆçš„ç©æ³•å°±æ˜¯ï¼š æ”¶é›†åˆ¶ä½œç¤¼ç›’éœ€è¦çš„3æ ·å¿…å¤‡ææ–™ï¼šå½©çº¸ã€ç¤¼èŠ±ã€ç¤¼ç‰©ï¼Œè¿™äº›ææ–™æ•£è½åœ¨åœ°å›¾çš„å„å¤„ï¼ŒæŠŠå®ƒä»¬å¸¦åˆ°åˆæˆç §ï¼Œåˆæˆä¸ºä¸€ä¸ªç¤¼ç›’ï¼Œç„¶åä¸¢åˆ°é›ªæ©‡è½¦å†…ã€‚å°†æ‰€æœ‰çš„ç¤¼ç›’éƒ½ä¸¢è¿›é›ªæ©‡å†…ï¼Œå³ç®—æ¸¸æˆèƒœåˆ©ã€‚æ¸¸æˆç©æ³•éå¸¸å¥‘åˆ2023å¹´Christmas Game Jamçš„ç‰¹æ®Šç‰©å“è¦æ±‚ï¼šç §ã€‚ä½†å¦‚æœä»…é™äºæ­¤ï¼Œç©æ³•ä¼¼ä¹è¿‡äºå•è°ƒï¼Œä¸æ­¤åŒæ—¶æˆ‘åˆç©äº†å¦ä¸€æ¬¾å°æ¸¸æˆï¼šitch.ioä¸Šåˆ›ä½œè€…duzdaçš„æ¸¸æˆä½œå“santa-saysã€‚è¿™æ¬¾æ¸¸æˆçš„æ ¸å¿ƒç©æ³•æ˜¯ï¼š æ¯éš”ä¸€æ®µæ—¶é—´ç©å®¶å¤´é¡¶ä¼šæ‰ä¸‹ä¸€ä¸ªæœ‰ç€ä¸åŒå½©çº¸ã€å½©å¸¦ã€å°ºå¯¸ã€çº¹ç†çš„ç¤¼ç›’ï¼Œå››å‘¨æœ‰4ä¸ªä¼ é€å¸¦æŒ‡å‘4ä¸ªèˆ±é—¨ï¼Œæ¯ä¸ªèˆ±é—¨ä¸Šéƒ½æœ‰ä¸€ä¸ªæŒ‡ç¤ºç‰Œï¼Œä¸Šé¢ç”»ç€ä¸€ä¸ªç¤¼ç›’ï¼Œæ—è¾¹å†™ç€ä¸€ä¸ªå…³é”®å­—ï¼ˆå½©çº¸å½©å¸¦å°ºå¯¸çº¹ç†ï¼‰ï¼Œä½ éœ€è¦æ ¹æ®è¿™ä¸ªæŒ‡ç¤ºï¼Œå°†ç¤¼ç›’é€åˆ°åŒ¹é…æŒ‡ç¤ºç‰Œä¸Šç¤¼ç›’çš„å…³é”®å­—éƒ¨ä½çš„èˆ±é—¨ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªæ¸¸æˆä½œä¸ºä¸€ä¸ªæ¸¸æˆåŸå‹è€Œè¨€ç›¸å½“æœ‰è¶£ï¼Œäºæ˜¯å°±å€Ÿé‰´äº†å…¶ä¸­å¯¹ç¤¼ç›’æ ·å¼è¿›è¡Œç­›é€‰çš„ç©æ³•ã€‚NameYourGiftåœ¨festive-frenzyçš„æ¸¸æˆåŸºç¡€ä¹‹ä¸Šï¼ŒåŠ å…¥äº†santa-saysçš„éƒ¨åˆ†è¦ç´ ï¼Œè®¾è®¡äº†æœ€ç»ˆçš„ç©æ³•ï¼šæ”¶é›†åˆ¶ä½œç¤¼ç›’çš„é“å…·â€”â€”å½©çº¸ã€ç¤¼èŠ±ã€ç¤¼ç‰©ï¼Œå°†å®ƒä»¬å¸¦åˆ°åˆæˆç §ï¼Œåˆæˆä¸ºç¤¼ç›’ã€‚è¿™å›ä¸ä»…ä»…è¦è€ƒè™‘ç¤¼ç›’çš„åˆ¶ä½œï¼Œè¿˜è¦è€ƒè™‘é€ç¤¼å¯¹è±¡ï¼Œä½ è¦æ ¹æ®å­©å­ä»¬å¯„æ¥çš„ä¿¡ä»¶ï¼Œæ¥åˆ¤æ–­ä»–ä»¬å¯¹åº”çš„ç¤¼ç‰©ï¼šå­©å­ä»¬çš„ä¿¡ä»¶åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼šä»–ä»¬çš„æƒ³æ³•ã€å¸Œæœ›æˆ–è€…çƒ¦æ¼ï¼Œå­©å­ä»¬ä¸ä¼šç›´æ¥å‘ä½ è¯´æ˜ä»–ä»¬æƒ³è¦çš„ç¤¼ç‰©ï¼Œä½†ä½ éœ€è¦æ ¹æ®ä»–ä»¬çš„æè¿°æ¥æ¨æµ‹ä»–ä»¬å¯èƒ½éœ€è¦çš„ç¤¼ç‰©ã€‚ä»–ä»¬å–œæ¬¢çš„å½©çº¸ã€å½©å¸¦ã€çº¹ç†ï¼Œä½ éœ€è¦å°†ç¤¼ç›’å®šåˆ¶ä¸ºä»–ä»¬å–œæ¬¢çš„æ ·å­ã€‚ç©å®¶éœ€è¦å¸¦ç€ç¤¼ç›’ï¼Œä¸å°ç²¾çµè¿›è¡Œå¯¹è¯ï¼Œå¯¹è¯å†…å®¹ä¼šé€éœ²ä¸ç¤¼ç‰©ç›¸å…³çš„ä¿¡æ¯ï¼Œç©å®¶å¯ä»¥æ ¹æ®å¯¹è¯ä¿¡æ¯è¿›ä¸€æ­¥åˆ¤æ–­ä¸ç¤¼ç‰©åŒ¹é…çš„å­©å­ã€‚ç©å®¶å°†åˆ¶å®šå¥½æ ·å¼çš„ç¤¼ç›’ä¸¢åˆ°é›ªæ©‡è½¦ä¸­ï¼Œå¦‚æœåŒ¹é…æ­£ç¡®ï¼Œåˆ™ç³»ç»Ÿåˆ¤æ–­ç¤¼ç‰©æ‰“åŒ…æˆåŠŸä¸ºæ‰€æœ‰å­©å­æ‰“åŒ…å¥½ç¤¼ç‰©ï¼Œæ¸¸æˆèƒœåˆ©ã€‚ é—®é¢˜3ï¼šè¿™æ¬¾æ¸¸æˆå¸Œæœ›è¾¾æˆçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š ä¸ºäº†åˆ©ç”¨è‡ªå·±ç›®å‰æ‰€å­¦ï¼Œå®Œå®Œæ•´æ•´åšä¸€æ¬¾æ¸¸æˆã€‚è¿™ä¸ªç›®æ ‡ä¹Ÿç®—æ˜¯è¾¾åˆ°äº†ï¼Œä½œä¸ºåˆå¿ƒè€…å¸Œæœ›èƒ½å¤šåšä¸€äº›å®Œæ•´åº¦æ¯”è¾ƒé«˜çš„å°Demoï¼Œè¦ç¬”è€…è‡ªå·±è¯´ï¼ŒNameYourGiftè·Ÿã€å¥½ç©ã€‘å¯å·®å¾—è¿œäº†ï¼Œç¾æœ¯é£æ ¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå‡ºä¼—çš„ï¼Œæ˜¯ä¸€æ¬¾æ²¡æœ‰ä»»ä½•ç‰¹è‰²çš„å°Demoï¼Œä½†åœ¨åˆ¶ä½œä¸­ï¼Œç¬”è€…è‡ªå·±èƒ½åœ¨æ¯ç‡¥çš„å­¦ä¹ è¿‡ç¨‹ä¸­ä½“éªŒåˆ°æ¸¸æˆå¼€å‘çš„ä¹è¶£ï¼Œè¿™ç‚¹å°±è¶³å¤Ÿäº†ã€‚å½“ç„¶ï¼Œåœ¨ç©æ³•è®¾è®¡ã€ç©å®¶è°ƒç ”ã€æ¦‚å¿µè®¾è®¡ã€æ¸¸æˆç†å¿µã€æŠ€æœ¯é€‰å‹ã€ç¾æœ¯è®¾è®¡ã€æ¸¸æˆæµ‹è¯•ã€æ¸¸æˆå‘è¡Œã€å¸‚åœºæ¨å¹¿ç­‰ç­‰æ–¹é¢ï¼Œæˆ‘å…¨éƒ½çŸ¥ä¹‹ç”šå°‘ï¼Œä½†å‡¡äº‹æ€»æ˜¯è¦æœ‰ä¸ªå¼€å§‹ã€‚è¿˜æœ‰ä¸ªå¾ˆé‡è¦çš„ç›®çš„ï¼Œå°±æ˜¯ç”¨è¿™æ¬¾æ¸¸æˆæ¥åº†ç¥2024å¹´åœ£è¯èŠ‚ ï¼ˆä¹å°±å®Œäº†ï¼‰ ğŸ“– ç¬¬äºŒæ­¥ï¼šå¼€å‘ğŸ›  å¼€å‘å·¥å…·å‡†å¤‡å·¥ä½œ æ¸¸æˆç¼–è¾‘å™¨ï¼šCocos Creator 2.4.10ä»£ç ç¼–è¾‘å™¨ï¼šVSCodeåƒç´ ç”»ç»˜åˆ¶ï¼šAseprite v1.3.10.1ç²¾çµå›¾å¤„ç†ï¼šTexturePackerå›¾ç‰‡å¤„ç†ï¼šPhotoshop 2019æ“ä½œç³»ç»Ÿï¼šWindows 10è¿›åº¦è®°å½•å·¥å…·ï¼š Notionç´ ææ•´ç†å·¥å…·ï¼šEagleå…³äºcocosçš„å­¦ä¹ ï¼Œä¸»è¦æ˜¯é€šè¿‡2ä¸ªè¯¾ç¨‹è¿›è¡Œï¼šCocosCreatorå…¥é—¨æ•™ç¨‹ä¹‹2Dæ¸¸æˆå¼€å‘ã€æŒç»­æ›´æ–°â€”ç¬¬23é›†ã€‘ã€Cocosæ•™ç¨‹-æ¸¸æˆå¼€å‘ã€‘2Dæ¨ªæ¿è§’è‰²ç§»åŠ¨-æ”»å‡»-è·³è·ƒ-å†²åˆº-é—ªé¿ âš™ï¸ å®ç°è¿‡ç¨‹å¼€å‘ç»“æŸåreviewäº†ä»£ç ï¼Œæœ‰äº›åœ°æ–¹çš„å®ç°éƒ½ç›¸å½“ç²—ç³™ï¼Œåƒè§’è‰²ç§»åŠ¨ã€ç‰©ä½“äº¤äº’è¿™ç§åŠŸèƒ½ï¼Œä¸€å®šæœ‰æ›´æˆç†Ÿç¨³å®šçš„è„šæœ¬å®ç°æ–¹å¼ï¼Œå› æ­¤è¿™é‡Œä»‹ç»çš„å„ç§å®ç°æ–¹å¼ï¼Œéƒ½ä¸æ˜¯æœ€å¥½çš„å®ç°æ–¹æ³•ï¼Œæœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ã€‚ ğŸ—ºï¸ åœ°å›¾åœºæ™¯æ­å»ºæ¨è2ä¸ªbç«™è§†é¢‘ï¼šã€æ— åºŸè¯æ•™ç¨‹ã€‘åœ¨Tiledä¸­åˆ¶ä½œåŠ¨ç”»ç“¦ç‰‡å›¾å¹¶å¯¼å…¥Cocos Creatorå¼•æ“ã€Cocosæ•™ç¨‹ã€‘å¦‚ä½•å®ç°äººç‰©ä¸å¢™å£é—´çš„ç¢°æ’ï¼Ÿç¬”è€…æœ€åˆæ‘¸ç´¢cocoså¼•æ“æ—¶ï¼ŒçŸ¥é“æœ‰TileMapè¿™ä¸ªä¸œè¥¿ï¼Œå­¦ä¹ Unityçš„æ—¶å€™ç”¨è¿‡TileMapç¼–è¾‘å™¨ï¼Œä½†æ˜¯åˆ°äº†cocosè¿™é‡Œï¼Œå…³äºTileMapçš„ä»‹ç»å¾ˆå°‘ï¼Œçœ‹å®˜ç½‘æ–‡æ¡£ä»‹ç»ï¼Œéœ€è¦å¼•å…¥Tiledç¼–è¾‘å™¨å¯¼å‡ºçš„.tmxçš„æ–‡ä»¶ã€‚å½“æ—¶éå¸¸æ‘¸ä¸ç€å¤´è„‘ï¼Œæ‘¸ç´¢äº†ä¸€ä¸‹Tiledç¼–è¾‘å™¨ï¼Œæ„Ÿè§‰æ¯”è¾ƒå¤æ‚ï¼Œä¸æ˜¯ä¸€ä¸‹å°±èƒ½èµ°é€šçš„ï¼Œäºæ˜¯å°±ä¸æ„¿æ„ç”¨TileMapç»§ç»­è¿›è¡Œåœ°å›¾ç¼–è¾‘äº†ã€‚äºæ˜¯é€‰æ‹©äº†æœ€éº»çƒ¦çš„ä¸€ç§æ–¹æ³•ï¼šç›´æ¥ä¸Šæ‰‹ç”¨ç“¦ç‰‡ä¸€ç –ä¸€ç“¦æŠŠåœ°å›¾å’èµ·æ¥ï¼Œç„¶åæ‰‹åŠ¨ç¼–è¾‘åœ°å›¾åŒ…å›´ç›’ ï¼ˆè‡ªå·±çœ‹åˆ°éƒ½æ— è¯­çš„ç¨‹åº¦ï¼‰ ã€‚ä¹Ÿäºæ˜¯åœ°å›¾å°ï¼Œä¸€å¼€å§‹å«æˆ‘å’æˆåŠŸäº†ï¼Œå› ä¸ºè¿™ä¸ªå¥‡è‘©æ“ä½œï¼Œå¯¼è‡´åé¢å¾ˆå¤šè«åå…¶å¦™çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šæˆ‘åˆ©ç”¨ç©å®¶ä¸åœ°é¢ç¢°æ’çš„æ³•å‘é‡yå€¼æ˜¯å¦ç­‰äº-1æ¥åˆ¤æ–­ç©å®¶è·³è·ƒæ˜¯å¦ç«™ç«‹åœ¨åœ°é¢ä¸Šï¼Œä½†æ•ˆæœæ€»æ˜¯ä¸å¥½ï¼Œåæ¥å‘ç°æ˜¯å› ä¸ºæˆ‘è‡ªå®šä¹‰çš„åœ°é¢åŒ…å›´ç›’ä¸å®Œå…¨æ˜¯æ°´å¹³åœ°é¢çš„åŸå› ï¼ˆå­˜åœ¨æ–œåº¦ï¼‰ä¹‹åçœ‹äº†è¿™ä¸¤ç¯‡æ•™ç¨‹ï¼Œä¸€ç¯‡ä»‹ç»å¦‚ä½•å°†Tiledä¸­åˆ¶ä½œçš„åŠ¨ç”»ç“¦ç‰‡å›¾å¯¼å…¥Cocos Creatorï¼Œä¸€ç¯‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ä»£ç æ–¹å¼ç»™TileMapæ·»åŠ ç¢°æ’ç›’ï¼Œä½†è·ŸUnityçš„TileMap Collider2Dæ¯”èµ·æ¥ï¼Œæ„Ÿè§‰cocosè¿˜æ˜¯éº»çƒ¦å¾ˆå¤šã€‚ ğŸš¶ğŸ»â€â™‚ï¸ è§’è‰²æ°´å¹³ç§»åŠ¨ è§’è‰²æ°´å¹³ç§»åŠ¨ æ ¹æ®ADé”®çš„è¾“å…¥ï¼Œåˆ¤æ–­Playerçš„æœå‘ï¼Œå¹¶ç»™Playerçš„RigidBodyä¸€ä¸ªçº¿æ€§é€Ÿåº¦ï¼š@ccclassexport default class PlayerMove extends cc.Component // èµ°è·¯é€Ÿåº¦ walkSpeed: number = 0; // åˆå§‹èµ°è·¯é€Ÿåº¦ initWalkSpeed: number = 0; // æœ€å¿«èµ°è·¯é€Ÿåº¦ maxWalkSpeed: number = 350; // æœå‘ dir: number = 1; // åˆšä½“ rbBody: cc.RigidBody = null; onLoad() this.rbBody = this.node.getComponent(cc.RigidBody); start() cc.systemEvent.on( cc.SystemEvent.EventType.KEY_DOWN, (event: cc.Event.EventKeyboard) = switch(event.keyCode) case cc.macro.KEY.a: case cc.macro.KEY.left: // å‘å·¦ç§»åŠ¨ this.setFaceDir(-1); this.move(); break; case cc.macro.KEY.d: case cc.macro.KEY.right: // å‘å³ç§»åŠ¨ this.setFaceDir(1); this.move(); break; ) move(dir) let v = this.rbBody.linearVelocity; // é€æ¸åŠ å¤§åŠ é€Ÿåº¦ï¼Œç›´åˆ°æœ€å¤§å€¼200 if(this.walkSpeed 200) this.walkSpeed += 2; // å­˜åœ¨ä¸€ä¸ªé€Ÿåº¦æœ€å¤§å€¼ if (Math.abs(v.x + this.walkSpeed * this.dir) this.maxWalkSpeed) v.x += this.walkSpeed * this.dir; else v.x = this.maxWalkSpeed * this.dir; this.rbBody.linearVelocity = v; // è®¾ç½®æœå‘ setFaceDir(dir) // è½¬å‘ if (this.dir !== dir) this.dir = dir; // è½¬å‘æ—¶åŠ é€Ÿåº¦å˜ä¸ºåˆå§‹å€¼ this.walkSpeed = this.initWalkSpeed; if (this.dir == 1) // å‘å³ this.node.scaleX = 1; else // å‘å·¦ this.node.scaleX = -1; æ­¤æ—¶ï¼ŒPlayerçš„ç§»åŠ¨ä¾æ—§æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œå› ä¸ºç§»åŠ¨äº‹ä»¶æ˜¯åœ¨KEY_DOWNä¸­è§¦å‘å¹¶è¢«è°ƒç”¨çš„ï¼Œå¦‚æœé•¿æŒ‰ADé”®ï¼ŒKEY_DOWNä»…ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè§’è‰²ä¹Ÿå°±ä»…ä¼šç§»åŠ¨ä¸€å°ä¸‹ï¼Œä½†æˆ‘å¸Œæœ›çœ‹åˆ°çš„æ˜¯é•¿æŒ‰æ—¶è§’è‰²åŠ é€Ÿç§»åŠ¨ã€‚å› æ­¤è¿™é‡Œå°±è¦é…åˆKEY_UPäº‹ä»¶å’ŒæŒ‰é”®è®°å½•å“ˆå¸Œè¡¨è¿›è¡Œå®ç°ï¼šå‚è€ƒå¸–å­ï¼šcocos creator ç»„åˆé”®æ€ä¹ˆç”¨ï¼Ÿå…·ä½“æ€è·¯å°±æ˜¯åœ¨KEY_DOWNç›‘å¬åˆ°æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­å°†è¿™ä¸ªæŒ‰é”®çš„çŠ¶æ€ç½®ä¸ºæ¿€æ´»ï¼Œåœ¨KEY_UPç›‘å¬åˆ°æŒ‰é”®è¢«æ¾å¼€æ—¶ï¼Œå†å°†æŒ‰é”®é‡ç½®ã€‚åœ¨updateä¸­å¯¹å“ˆå¸Œè¡¨çš„å±æ€§å€¼è¿›è¡Œè½®è¯¢ï¼Œå‘ç°æœ‰å¤„äºæ¿€æ´»çŠ¶æ€çš„æŒ‰é”®å°±è°ƒç”¨å¯¹åº”çš„æŒ‰é”®æ–¹æ³•ï¼š// å½“å‰æŒ‰ä¸‹çš„é”®pressKeys = []; onLoad() this.pressKeys = []start() cc.systemEvent.on( cc.SystemEvent.EventType.KEY_UP, (event: cc.Event.EventKeyboard) = // æŒ‰é”®é‡ç½® this.pressKeys[event.keyCode] = false; ); cc.systemEvent.on( cc.SystemEvent.EventType.KEY_DOWN, (event: cc.Event.EventKeyboard) = // æŒ‰é”®è¢«æ¿€æ´» this.pressKeys[event.keyCode] = true; );update(dt) // æ£€æŸ¥pressKeysæŒ‰é”®è¡¨ this.checkKeyboard() // æ£€æŸ¥æŒ‰é”®checkKeyboard() for (let [key, value] of Object.entries(this.pressKeys)) if (value == false) continue; let keyCode = Number(key); switch (keyCode) case cc.macro.KEY.a: case cc.macro.KEY.left: // å‘å·¦ç§»åŠ¨ this.setFaceDir(-1); this.move(); break; case cc.macro.KEY.d: case cc.macro.KEY.right: // å‘å·¦ç§»åŠ¨ this.setFaceDir(1); this.move(); break; case cc.macro.KEY.w: case cc.macro.KEY.up: // è·³è·ƒ this.jump(); break; ğŸ“· è§’è‰²è·³è·ƒä¸ç›¸æœºè·Ÿéš è§’è‰²è·³è·ƒä¸ç›¸æœºè·Ÿéš è§’è‰²è·³è·ƒä¸­æœ€å¥½å®ç°çš„å°±æ˜¯è·³è·ƒåŠ¨ä½œæœ¬èº«ï¼Œç»™Playerçš„RigidBodyä¸€ä¸ªæ²¿yè½´æœä¸Šçš„linearVelocityçº¿æ€§é€Ÿåº¦å³å¯ï¼š// æ˜¯å¦å¯ä»¥è·³è·ƒjumpEnable: boolean = true// è·³èµ·çš„çº¿æ€§é€Ÿåº¦jumpSpeed: number = 800;// è·³è·ƒjump() if(!this.jumpEnable) return let v = this.rbBody.linearVelocity v.y = this.jumpSpeed this.rbBody.linearVelocity = v this.jumpEnable = false;ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä½•åˆ¤æ–­Playerç°åœ¨æ˜¯å¦å¯ä»¥è·³è·ƒï¼Œå› ä¸ºPlayeråªæœ‰åœ¨ç¡®è®¤åŒè„šåœ¨åœ°ä¸Šæ—¶æ‰èƒ½è¿›è¡Œä¸‹æ¬¡è·³è·ƒï¼Œè¦ä¸å°±å·¦è„šè¸©å³è„šåŸåœ°é£å‡äº†ã€‚åˆ¤æ–­çš„æ–¹æ³•æ˜¯æ£€æµ‹ç¢°æ’çš„æ³•å‘é‡çš„yå€¼æ˜¯å¦å°äº0ï¼Œå°äº0è¯´æ˜æ­¤æ—¶åœ°é¢åœ¨ä½äºPlayerçš„æ–¹å‘ï¼š// æ£€æµ‹ä¸åœ°é¢ä¹‹é—´çš„ç¢°æ’onBeginContact(contact, self, other) // å½“å‰æ¥è§¦åˆ°åœ°é¢ï¼Œå¯ä»¥è·³èµ· let group = other.node.group if(other.tag == CollisionTags.ground self.tag == playerCollistionTags.move) // ä»ä¸Šè‡³ä¸‹è½ä¸‹ let normal = contact.getWorldManifold().normal if(normal.y 0) this.jumpEnable = true // æ£€æµ‹ç©å®¶åŒè„šç¦»åœ°onEndContact(contact, self, other) // ç¦»å¼€åœ°é¢ï¼Œæ— æ³•è·³èµ· if(other.tag == CollisionTags.ground self.tag == playerCollistionTags.move) // ç¦»å¼€è„šä¸‹çš„ç‰©ä½“ let normal = contact.getWorldManifold().normal if(normal.y 0) this.jumpEnable = false ç›¸æœºè·Ÿéšè¿™é‡Œè¿›è¡Œäº†é«˜åº¦æ§åˆ¶ï¼šä»¥åŠä¸ªå±å¹•çš„é«˜åº¦ï¼ˆä¹Ÿå°±æ˜¯Canavsçš„åŸç‚¹é«˜åº¦ï¼‰ä¸ºé«˜åº¦è·ŸéšèŠ‚ç‚¹Pï¼Œåˆ’åˆ†æ•´ä¸ªåœºæ™¯è§’è‰²åœ¨Pç‚¹ä»¥ä¸‹ä½ç½®ï¼Œç›¸æœºä¸è·Ÿéšé«˜åº¦è§’è‰²åœ¨Pç‚¹ä»¥ä¸Šä½ç½®ï¼Œç›¸æœºè·Ÿéšé«˜åº¦ç›¸æœºç¼“åŠ¨è·Ÿéš// ç›®æ ‡ç›¸æœºä½ç½® cameraTarget = x:0, y:0, cameraStep = 8 // æ§åˆ¶ç¼“åŠ¨å¹³æ»‘åº¦ // å¢åŠ ä¸€ä¸ªç¼“åŠ¨æ•ˆæœ updateCamera() if(window.game.camera.x !== this.cameraTarget.x) window.game.camera.x += (this.cameraTarget.x - window.game.camera.x)/this.cameraStep if(window.game.camera.y !== this.cameraTarget.y) window.game.camera.y += (this.cameraTarget.y - window.game.camera.y)/this.cameraStep // ç›¸æœºè·Ÿéš cameraFollow() // è·Ÿéšxåæ ‡ this.cameraTarget.x = this.node.x if(this.node.y = 0) // èŠ‚ç‚¹åœ¨Canvasä¸­å¿ƒä»¥ä¸‹ï¼Œåˆ™ä»¥Canavsä¸ºä¸­å¿ƒ this.cameraTarget.y = 0 else // èŠ‚ç‚¹é«˜äºCanavsä¸­å¿ƒï¼Œå¼€å§‹è·Ÿéš this.cameraTarget.y = this.node.y + scrollHeight; ğŸ“¦ï¸ ç‰©ä½“æŠ¬ä¸¾ä¸æŠ›å‡º ç‰©ä½“æŠ¬ä¸¾ä¸æŠ›å‡º ç‰©ä½“ä¸­å­˜åœ¨å‡ ç§å¯æŠ¬ä¸¾çš„ç‰©å“ï¼Œè¿™é‡Œä½¿ç”¨Gourpå¯¹è¿™äº›ç‰©å“çš„Nodeè¿›è¡Œæ ‡è¯†ã€‚Playeréœ€è¦ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜æ”¾å½“å‰é™„è¿‘å¯æŠ¬ä¸¾çš„ç‰©å“ï¼Œè¿™ä¸ªæ•°ç»„åœ¨ç¢°æ’æ£€æµ‹ä¸­è¿›è¡Œåˆ·æ–°,å½“å¯æŠ¬ä¸¾ç‰©å“è¢«Playerè§¦ç¢°åˆ°æ—¶ï¼Œå°±è¢«çº³å…¥æ•°ç»„ä¹‹ä¸­ï¼Œå½“ç¢°æ’ç»“æŸæ—¶ï¼Œå†è¢«ä»æ•°ç»„ä¸­æ¸…é™¤ï¼š// ç¢°æ’ç›’æ£€æµ‹onBeginContact(contact, self, other) // åˆ¤æ–­æ˜¯å¦æ˜¯å¯äº¤äº’ç‰©å“ï¼Œæ˜¯å¦æ˜¯äº¤äº’æ¢æµ‹ç¢°æ’ç›’æ£€æµ‹åˆ°çš„ç¢°æ’ if(pickableList.includes(other.node.group) self.tag == playerCollistionTags.pick) // æ£€æµ‹æ˜¯å¦å·²ç»å­˜åœ¨è¿™ä¸ªç‰©å“ if(this.pickItemList.findIndex(item=item.uuid == other.node.uuid) 0) // æ¨å…¥è¯¥ç‰©å“ this.pickItemList.push(other.node) onEndContact(contact, self, other) if(pickableList.includes(other.node.group) self.tag == playerCollistionTags.pick) // ä»æ•°ç»„ä¸­è¿‡æ»¤æ‰ this.pickItemList = this.pickItemList.filter(item=other.node.uuid !== item.uuid) å½“Playerç›‘å¬åˆ°æŠ¬ä¸¾å‘½ä»¤æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­æ‰‹ä¸­æœ‰æ²¡æœ‰ç‰©å“ï¼Œå¦‚æœæœ‰ï¼Œä¸‹ä¸€æ­¥åŠ¨ä½œåˆ™æ˜¯å°†ç‰©å“æŠ›å‡ºå»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šä»å¯æŠ¬ä¸¾ç‰©å“é˜Ÿåˆ—ä¸­æŒ‘å‡ºé˜Ÿé¦–ç‰©å“ä¸¾èµ·ã€‚è¿™é‡Œéœ€è¦ç»™æŠ¬ä¸¾æŠ›å‡ºåŠ¨ä½œä¸€ä¸ªCDé—´éš”ï¼Œè®©å®ƒæ— æ³•è¢«è¿ç»­è§¦å‘ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´Playerå°†åˆšåˆšä»æ‰‹ä¸­æŠ›å‡ºçš„ç‰©å“åˆæŠ¬ä¸¾å›æ¥çš„åŠ¨ä½œï¼š// ç‰©å“æ”¶é›†çš„CDpickingCD = 0// æ˜¯å¦å¯ä»¥æ¡èµ·pickable:boolean = false// è¢«æ¡èµ·æ¥çš„ç‰©å“pickItemList:cc.Node[] = []// æ¡èµ·ç‰©å“pickup() if(this.pickingCD0) return this.pickingCD = 20 // å¦‚æœæ‰‹ä¸­æœ‰ç‰©å“ï¼Œä¸¢å‡ºå» if(this.pickingItem) this.throwOut() return if(this.pickItemList.length 0) // æŠ¬ä¸¾ç‰©å“ this.pickingItem = this.pickItemList.shift() this.lift() update() // CDå†·å´ if(this.pickingCD 0) this.pickingCD -- ä¸¾èµ·ç‰©å“å’ŒæŠ›å‡ºç‰©å“æ˜¯ä¸¤ç§æˆªç„¶ç›¸åçš„åŠ¨ä½œï¼šä¸¾èµ·ç‰©å“ï¼šåˆ‡æ¢ä¸¾èµ·è´´å›¾ï¼Œè¢«ä¸¾èµ·ç‰©çš„RigidBodyå¤±æ•ˆï¼Œç‰©å“åæ ‡å®šä½åˆ°Playerçš„å¤´é¡¶ä½ç½®æŠ›å‡ºç‰©å“ï¼šåˆ‡æ¢æ­£å¸¸è´´å›¾ï¼Œæ¢å¤ç‰©å“RigidBodyï¼Œå¹¶ç»™å®ƒä¸€ä¸ªå’Œç©å®¶æœå‘ç›¸åŒçš„linearVelocityçº¿æ€§é€Ÿåº¦ä½œä¸ºæŠ›å‡ºåŠ›// ä¸¢å‡ºç‰©å“throwOut() // åˆ‡æ¢è´´å›¾ this.toggleSprite(normal) // æ£€æŸ¥å½“å‰ç©å®¶çš„æœå‘ï¼Œå‘æŒ‡å®šæœå‘ä¸¢å‡ºç‰©å“ const pm = this.node.getComponent(PlayerMove) const dir = pm.dir // æ­¤å¤„é¡ºåºä¸èƒ½é¢ å€’ï¼Œå¦åˆ™å—åŠ›å¤±è´¥ const pickRb = this.pickingItem.getComponent(cc.RigidBody) pickRb.enabled = true this.pickingItem.getComponent(cc.PhysicsPolygonCollider).enabled = true let v = pickRb.linearVelocity pickRb.gravityScale = 1 v.x = 300* dir v.y = 300 pickRb.linearVelocity = v this.pickingItem = null// ä¸¾èµ·ç‰©å“lift() // åˆ‡æ¢è´´å›¾ this.toggleSprite(pick) let pickRb = this.pickingItem.getComponent(cc.RigidBody) // å°†çº¿æ€§é€Ÿåº¦ã€è§’é€Ÿåº¦æ§åˆ¶ä¸º0 // å³ä¾¿æ˜¯æŠŠåˆšä½“æ’¤ç¦»ä¹‹åï¼Œç‰©ä½“ä¾æ—§ä¼šæŒ‰ç…§åŸæœ¬çš„è§’é€Ÿåº¦è¿åŠ¨ pickRb.linearVelocity.x = 0 pickRb.linearVelocity.y = 0 pickRb.angularVelocity = 0 pickRb.gravityScale = 0 pickRb.enabled = false this.pickingItem.getComponent(cc.PhysicsPolygonCollider).enabled = false // åæ ‡å®šåˆ°å¤´é¡¶ä½ç½® this.pickingItem.x = this.node.x this.pickingItem.y = this.node.y + this.pickingItem.height ğŸ§° ç¤¼ç‰©åˆæˆ ç¤¼ç‰©åˆæˆ åˆæˆä¸€ä¸ªç¤¼ç›’ï¼Œä¸€å…±éœ€è¦ä¸‰ç§åŸæ–™ï¼Œå¹¶ä¸”æ¯ç§åŸæ–™ä»…ä»…éœ€è¦ä¸€ç§ã€‚å› æ­¤åˆæˆå°å°±æœ‰ä¸‰ä¸ªç©ºä½ï¼Œåˆ†åˆ«ç•™ç»™å½©çº¸ã€å½©å¸¦ã€ç¤¼ç‰©ç±»å‹çš„èŠ‚ç‚¹ï¼Œå¦‚æœç›‘å¬åˆ°æœ‰èŠ‚ç‚¹è¿›å…¥äº†å®ƒçš„æ£€æµ‹åœˆï¼Œå¹¶ä¸”æ˜¯å¯ä»¥ç”¨äºåˆæˆçš„ææ–™ç±»å‹ï¼Œåˆæˆå°å°±ä¼šç»§ç»­æ£€æµ‹ææ–™å¯¹åº”çš„åˆæˆå¸­ä½æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å°±å°†ç›®æ ‡ææ–™çº³å…¥å¸­ä½ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›®æ ‡ææ–™ä½œä¸ºå¤‡ç”¨ææ–™è¿›å…¥å¾…åˆæˆææ–™é˜Ÿåˆ—ä¸­ã€‚åˆæˆå°å¸å…¥ç¢°æ’æ£€æµ‹ï¼š// å­˜æ”¾å½“å‰åŒ…å›´åœˆé‡Œå¯ä»¥è¢«ä½¿ç”¨çš„ææ–™contactMats = [];// ç¢°æ’ç›‘å¬onBeginContact(contact, self, other) // ä¸æ˜¯åˆæˆåŒ…å›´ç›’ç›‘å¬åˆ°çš„ç¢°æ’ // ä¸æ˜¯åŸææ–™çš„ï¼Œè¿”å› if (self.tag != 1 || !materialGroupList.includes(other.node.group)) return; // contactMatä¸­å·²ç»å­˜åœ¨çš„ï¼Œè¿”å› if (this.contactMats.find((item) = item.uuid == other.node.uuid)) return; // è£…è½½çš„ææ–™ä¸­å·²ç»å­˜åœ¨çš„ï¼Œè¿”å› if (Object.values(this.mat).find((item) = item?.uuid == other.node.uuid)) return; this.contactMats.push(other.node);onEndContact(contact, self, other) // å·²ç»è£…è½½çš„ææ–™ï¼Œä¸ç”¨å†åˆ¤æ–­äº† if (Object.values(this.mat).find((item) = item?.uuid == other.node.uuid)) return; // å‰”é™¤ this.contactMats = this.contactMats.filter( (item) = item.uuid != other.node.uuid );æœ‰äº†ä¸€ä¸ªå­˜æ”¾å¯åˆæˆç‰©çš„æ•°ç»„ä¹‹åï¼Œå°±å¯ä»¥åœ¨updateä¸­è¿›è¡Œè£…å¡«äº†ï¼Œä¹Ÿå°±æ˜¯åšææ–™ç‰©åŒ¹é…ï¼š// åˆå§‹ææ–™å¸­ä½initMaterial = // ç¤¼ç‰© gift: undefined, // çº¸å¼  papper: undefined, // ä¸å¸¦ ribbon: undefined, // ææ–™é›†é½æ€»æ•° count: 0,;// ææ–™å¸­ä½mat = ...initMaterial; // å¯¹å·å…¥åº§ preload() let cm = [...this.contactMats] for (let material of cm) let load = false switch (material.group) case Gift: if (!this.mat.gift) this.mat.gift = material; load = true break; case Papper: if(!this.mat.papper) this.mat.papper = material; load = true break; case Ribbon: if(!this.mat.ribbon) this.mat.ribbon = material load = true break; // æœ‰æ–°ææ–™è¢«å¡«å…¥ if(load) this.mat.count++ // å°†å·²å¡«å…¥çš„ææ–™ä»é¢„å¤‡åˆ—è¡¨ä¸­æå‡º this.contactMats = this.contactMats.filter(item=item.uuid != material.uuid) // çº³å…¥å¸­ä½çš„ææ–™é‡åŠ›å˜ä¸º0 let matRb = material.getComponent(cc.RigidBody) matRb.gravityScale = 0 let v = matRb.linearVelocity v.x = 0 v.y = 0 matRb.linearVelocity = v let matCol = material.getComponent(cc.PhysicsPolygonCollider) matCol.enabled = false matRb.enabled = false // ä¸‰ä¸ªå¸­ä½å…¨æ»¡ï¼Œç»“æŸé¢„è£…å¡« if(this.mat.count=3) break; è¢«çº³å…¥å¸­ä½çš„ææ–™ä¼šå›´ç»•ç€å·¥ä½œå°ä¸Šæ–¹çš„åˆæˆç‚¹è¿›è¡Œæ—‹è½¬ï¼š// åˆå¹¶é˜¶æ®µçš„æ—‹è½¬é€Ÿåº¦mergingSpinSpeed = 2;// åˆå¹¶/è¢«å¸å…¥çš„é€Ÿåº¦mergeSpeed = 0.5;// æ—‹è½¬spin() let spinItems = Object.values(this.mat).filter(item= return item item instanceof cc.Node ) spinItems.forEach(item= // è®¡ç®—ææ–™ç›¸å¯¹åˆæˆç‚¹ï¼ˆåœ†å¿ƒï¼‰çš„åæ ‡ let diffX = item.x - this.center.x let diffY = item.y - this.center.y let distance = Math.sqrt(diffX ** 2 + diffY ** 2) // è®¡ç®—å¼§åº¦ let radian = Math.atan(diffY / diffX) // å¼§åº¦è½¬è§’åº¦ let angle = radian * 180 / Math.PI if(diffX 0) angle+=180 if(angle 0) angle += 360 angle += this.spinSpeed radian = angle * Math.PI / 180 distance -= this.mergeSpeed let r = distance this.spinRadius? distance: this.spinRadius item.x = this.center.x + r * Math.cos(radian) item.y = this.center.y + r * Math.sin(radian) )å½“ä¸‰ä¸ªå¸­ä½éƒ½æœ‰å¯¹åº”çš„ææ–™æ—¶ï¼Œå¼€å§‹åˆå¹¶ï¼Œæ­¤æ—¶ææ–™çš„æ—‹è½¬åŠå¾„å¼€å§‹é€æ¸å‡å°ï¼Œææ–™è¢«å·å…¥åˆæˆç‚¹ï¼Œç›´åˆ°è¶…è¿‡æœ€å°åŠå¾„é˜ˆå€¼æ—¶ï¼Œåˆ¤å®šåˆæˆç»“æŸï¼Œç”Ÿæˆç¤¼ç›’ï¼š// åˆå¹¶çŠ¶æ€ï¼šé›†é½3ä¸ªææ–™ï¼Œææ–™ä»¬å¼€å§‹å‘å†…è¢«å¸å…¥ï¼Œæ—‹è½¬é€Ÿåº¦åŠ é€ŸisMerge = false;// æœ€å°çš„æ—‹è½¬åŠå¾„ï¼ˆå°äºè¿™ä¸ªå€¼åˆ¤æ–­ä¸ºåˆæˆç»“æŸï¼‰minRadius = 5;// åˆå¹¶/è¢«å¸å…¥çš„é€Ÿåº¦mergeSpeed = 0.5;// å¼€å§‹åˆå¹¶merge() // æ”¶ç¼© this.spinRadius -= this.mergeSpeed // ç¼©åˆ°æœ€å°æ•°å€¼ if(this.spinRadius this.minRadius) this.mergeEnd() // åˆå¹¶ç»“æŸmergeEnd() // æ­¤å¤„åº”è¯¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ç¤¼ç‰© this.generateGift(this.mat.gift) this.mat.gift.active = false this.mat.papper.active = false this.mat.ribbon.active = false // this.mat = JSON.parse(JSON.stringify(initMaterial)) this.mat = ...initMaterial this.spinRadius = initSpinRadius this.spinSpeed = initSpinSpeed this.isMerge = false// ç”Ÿæˆç¤¼ç‰©generateGift(gift) // æ ¹æ®ç¤¼ç‰©çš„å°ºå¯¸è·å–ç¤¼ç‰©ç›’ï¼Œæ­¤å¤„å…³äºç¤¼ç‰©prefabç•¥ const giftPrefab = this.giftBoxPrefab[gift.getComponent(Gift).size] const newGiftBox = cc.instantiate(giftPrefab) let giftBoxCom = newGiftBox.getComponent(GiftBox) giftBoxCom.setGift(gift) newGiftBox.x = this.center.x newGiftBox.y = this.center.y newGiftBox.setParent(this.giftBoxGroup)ä»é¢„è£…ææ–™åˆ°åˆå¹¶ï¼Œéœ€è¦åœ¨updateä¸­è¿›è¡Œæ£€æµ‹ï¼šupdate() this.spinSpeed = initSpinSpeed if (this.mat.count 3) this.preload(); // é¢„è£… else this.spinSpeed = this.mergingSpinSpeed this.merge() // åˆå¹¶ if(this.mat.count0) this.spin() // æ—‹è½¬ ğŸ ç¤¼ç›’å®šåˆ¶ ç¤¼ç›’å®šåˆ¶ ç¤¼ç›’å®šåˆ¶çš„ä¸»è¦é—®é¢˜å°±æ˜¯ï¼Œæ‰€æœ‰æ­é…çš„ç¤¼ç›’æ ·å¼ï¼Œéƒ½è¦æœ‰å®ƒå¯¹åº”çš„èµ„æºå›¾ç‰‡ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™å‘½åï¼šå°ºå¯¸-å½©çº¸é¢œè‰²-å½©å¸¦é¢œè‰²-çº¹ç†åœ¨æ ·å¼ç¼–è¾‘èœå•ç»“æŸåï¼Œç”Ÿæˆç¤¼ç›’æ ·å¼å¯¹åº”çš„å›¾ç‰‡èµ„æºçš„åç§°ï¼Œç„¶åä½¿ç”¨cc.resources.loadè¿›è¡ŒåŠ¨æ€åŠ è½½ï¼š// é‡æ–°åŠ è½½è´´å›¾resetSprite() /** * è´´å›¾å‘½åæ¨¡ç‰ˆ * ç›’å­å°ºå¯¸-ç›’å­é¢œè‰²-ä¸å¸¦é¢œè‰²-ç›’å­çº¹ç† * å¤§-è“-ç™½-çº¯è‰² */ let name = [ SizeType[this.size], ColorType[this.color], RibbonColorType[this.ribbonColor], PatternType[this.pattern] ].join(-) cc.resources.load(`imgs/boxes/$name`,cc.SpriteFrame, (error:Error, assets:cc.SpriteFrame)= if(error) console.log(error) return this.node.getComponent(cc.Sprite).spriteFrame = assets this.isMerge this.playChange() ) ğŸ›· ç¤¼ç›’åŒ¹é…æ£€æµ‹å½“ç¤¼ç‰©ç›’æ£€æµ‹åˆ°ä¸é›ªæ©‡çš„ç¢°æ’æ—¶ï¼Œä¼šæ£€æµ‹å­©å­æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ä¸è¯¥ç¤¼ç‰©ç›’åŒ¹é…çš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ¤å®šç¤¼ç‰©åŒ…è£…æˆåŠŸï¼Œä¸å­˜åœ¨åˆ™åˆ¤å®šå¤±è´¥ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªåå¼¹çš„åŠ›ï¼š// å¼€å§‹ç¢°æ’ onBeginContact(contact, self, other) if(!this.isMerge) return if(this.done) return // æ£€æµ‹æ˜¯å¦æ˜¯é›ªæ©‡è½¦çš„ç¤¼ç‰©æ£€æµ‹ç¢°æ’ç›’ if(other.tag == 3 other.node.name == SnowCar) let success = false // debugger // å¯¹ç¤¼ç‰©ç»„åˆè¿›è¡Œåˆ¤å®š let data = window.game.childList.json.data for(let i = 0; i data.length; i++) let child = data[i] // å·²ç»åŒ…è£…å®Œæ¯• if(child.isDone) continue ; let giftList = window.game.globalDict.json.gift let wish = giftList.find(item=item.value == child.gift) // ç¤¼ç‰©ä¸ä¸€è‡´ if(wish.name !== this.gift.name) continue; if( child.papper == this.color child.ribbon == this.ribbonColor child.pattern == this.pattern ) // åˆ¤å®šç¤¼ç‰©åˆ†é…ç»“æŸ child.done = true success = true this.node.group = default break; if(success) this.done = true let collider = this.node.getComponent(cc.PhysicsPolygonCollider) collider.density = 1000 collider.friction = 1000 else // æ–½åŠ ä¸€ä¸ªå‘å¤–çš„åŠ› const rb = this.node.getComponent(cc.RigidBody) let v = rb.linearVelocity v.x = -300 v.y = 300 rb.linearVelocity = v æ£€æµ‹æˆåŠŸæ•ˆæœï¼šæ£€æµ‹å¤±è´¥æ•ˆæœï¼š ğŸ’¬ å¯¹è¯ç³»ç»Ÿ å¯¹è¯ç³»ç»Ÿ å¯¹è¯äº¤äº’çš„æ•´ä¸ªå®ç°æµç¨‹ï¼šè§¦å‘è§’è‰²å¯¹è¯åˆ‡æ¢å¯¹è¯ä¸­UIæ ¹æ®å½“å‰æ¸¸æˆçŠ¶æ€åˆ¤æ–­è½½å…¥çš„æ¸¸æˆè„šæœ¬ç»‘å®šå¯¹è¯æ—¶é”®ç›˜äº‹ä»¶æ¨¡æ‹Ÿæ‰“å­—å­—å¹•æ•ˆæœå½“å‰è¯­å¥ç»“æŸï¼ŒåŠ è½½ä¸‹ä¸€å¥è¯æ‰€æœ‰å¯¹è¯åŠ è½½å®Œï¼Œå¯¹è¯ç»“æŸç¬¬ä¸€æ­¥ï¼šè§¦å‘ä¸NPCä¹‹é—´çš„å¯¹è¯ï¼Œåˆ‡æ¢å¯¹è¯UIï¼š// å’ŒNPCè¯´è¯talk() // æ¸¸æˆæš‚åœ window.game.Pause() // åˆ‡æ¢å¯¹è¯ä¸­UI this.ToggleTalkUI(true).then(res= // UIåˆ‡æ¢å¥½ä¹‹åè¿›å…¥å¯¹è¯ this.startLoadTalk() )ç¬¬äºŒæ­¥ï¼šè½½å…¥å½“å‰å¯¹è¯// åŠ è½½å¯¹è¯startLoadTalk() // ä¸‹é¢ä¸€ç³»åˆ—åˆ†æ”¯ç”¨äºåˆ¤æ–­å½“å‰åº”è¯¥è¿›è¡Œçš„å¯¹è¯å†…å®¹ if(!this.hasInitTalked) // å¦‚æœæ²¡æœ‰ç»è¿‡å¼€åœºå¯¹è¯ï¼ŒåŠ è½½å¼€åœºå¯¹è¯è„šæœ¬ this.curScript = this.initScript this.hasInitTalked = true else if(this.isGameEndTalk) // æ­¤æ—¶æ¸¸æˆå·²ç»ç»“æŸï¼ŒåŠ è½½ç»“æŸå¯¹è¯ this.curScript = this.gameEndTalk else // æ­£åœ¨æ¡èµ·çš„ç‰©å“ let pickingItem = this.pickComp.pickingItem let group = pickingItem?.group // å¦‚æœæ˜¯æ‰‹ä¸Šæ‹¿ç€ç¤¼ç‰©æˆ–è€…æ˜¯ç¤¼ç‰©ç›’ï¼ŒåŠ è½½ç¤¼ç‰©å¯¹åº”çš„è„šæœ¬ if(group == Gift) // æ˜¯ç¤¼ç‰©ï¼Œç›´æ¥åŠ è½½è„šæœ¬ this.curScript = pickingItem.getComponent(Gift).script.json else if(group == GiftBox) let gift = pickingItem.getComponent(GiftBox).gift this.curScript = gift.getComponent(Gift).script.json else // å¦‚æœæ˜¯å…¶å®ƒæƒ…å†µï¼Œåˆ™åŠ è½½éšæœºå¯¹è¯ this.curScript = this.randomTalkScript[this.randomTalkIndex] this.randomTalkIndex = (this.randomTalkIndex + 1) % this.randomTalkScript.length // é‡ç½®å¯¹è¯å†…å®¹ this.loadNextWord(null) // ç»‘å®šå¯¹è¯é”®ç›˜äº‹ä»¶ cc.systemEvent.on( cc.SystemEvent.EventType.KEY_UP, this.loadNextWord, this ) ç¬¬ä¸‰æ­¥ï¼šå¯¹è¯ä¸­çš„é”®ç›˜äº‹ä»¶ã€æ¨¡æ‹Ÿæ‰“å­—ä¸å¯¹è¯ç»“æŸæ­¤å¤„çš„å…³é”®ç‚¹åœ¨äºï¼šå¯¹è¯ç»“æŸåï¼Œä¸€å®šè¦å¯¹æ­¤æ¬¡å¯¹è¯å¼€å§‹æ—¶ç»‘å®šçš„é”®ç›˜äº‹ä»¶è¿›è¡Œè§£ç»‘å®šï¼Œå› ä¸ºå¦‚æœä¸è§£ç»‘ï¼Œå°±ä¼šåœ¨ä¸‹æ¬¡å¯¹è¯äº‹ä»¶è¢«è§¦å‘æ—¶å†æ¬¡ç»‘å®šä¸€æ¬¡å¯¹è¯äº‹ä»¶ï¼Œç›¸å½“äºåŒä¸€ä¸ªé”®ç›˜æ“ä½œå¯¹åº”2ä¸ªå·²ç»è¢«ç»‘å®šçš„é”®ç›˜äº‹ä»¶ï¼Œå½“è§¦å‘ã€ä¸‹ä¸€å¥è¯ã€‘çš„æ“ä½œæ—¶ï¼Œå®é™…ä¼šæ‰§è¡Œ2æ¬¡ã€è½½å…¥ä¸‹ä¸€å¥è¯ã€‘æ“ä½œï¼Œå°±ä¼šå‡ºç°è·³å¥ç°è±¡ã€‚loadNextWord(event:cc.Event.EventKeyboard) const talkEnd = ()= this.curScript = null // ä¸€å®šè¦å¯¹å·²ç»ç»‘å®šçš„å¯¹è¯äº‹ä»¶è§£ç»‘ cc.systemEvent.off( cc.SystemEvent.EventType.KEY_UP, this.loadNextWord, this ) // ç»“æŸå¯¹è¯ this.stopTalk() // è¾“å…¥çš„æ˜¯ç©ºæ ¼ï¼Œè·³è¿‡å¯¹è¯ if(event event.keyCode == cc.macro.KEY.space) talkEnd() this.typingLocation = 0 this.targetContent = return if(event event.keyCode !== cc.macro.KEY.e) return // å­—è¿˜æ²¡æœ‰æ‰“å®Œï¼ŒæŒ‰Eç›´æ¥æ˜¾ç¤ºå…¨éƒ¨å¯¹è¯ if(this.tCLabelCp.string.length !== this.targetContent.length) this.typingLocation = this.targetContent.length this.tCLabelCp.string = this.targetContent // æ­¤å¤„æ¸…ç©ºçš„æ˜¯æ¨¡æ‹Ÿæ‰“å­—ä¸­ç”¨åˆ°çš„å»¶æ—¶å™¨ clearTimeout(this.typingTimer) return this.typingLocation = 0 this.targetContent = // ä»£è¡¨ä¸€å¥è¯å·²ç»åŠ è½½å®Œ if(this.curTalkIndex = this.curScript.data.length) this.curScript = null talkEnd() return // åŠ è½½ä¸‹ä¸€å¥è¯ let wordData = this.curScript.data[this.curTalkIndex] // è·å–è¯´è¯è€…ä¿¡æ¯ let talker = this.curScript.chara.find(item=item.id == wordData.talker) // å°†è¯´è¯è€…åå­—è½½å…¥åå­—Nodeä¸­ this.tNameLabelCp.string = talker.name[window.globalData.lang] this.talkerNameLabel.color = new cc.Color(...talker.color) // è¯´è¯äººéŸ³æ•ˆ this.talkerSound = talker.sound // æ­¤å¤„æ’å…¥ä¸€ä¸ªæ‰“å­—ç‰¹æ•ˆ this.targetContent = wordData.content[window.globalData.lang] this.tCLabelCp.string = // æ¨¡æ‹Ÿæ‰“å­—æ•ˆæœ this.simTyping() this.curTalkIndex ++ // æ‰“å­—é€Ÿåº¦typingSpeed:number = 100// æ‰“å­—ä½ç½®è®°å½•typingLocation:number = 0// ç›®æ ‡æ‰“å­—å†…å®¹targetContent:string = typingTimer = null// æ¨¡æ‹Ÿæ‰“å­—simTyping() window.globalData.playSound(this.talkerSound) this.tCLabelCp.string += (this.targetContent[this.typingLocation] || ) this.typingLocation ++ if(this.typingLocation this.targetContent.length) this.typingTimer = setTimeout(()= this.simTyping() ,this.typingSpeed) // åœæ­¢è¯´è¯ï¼Œè°ˆè¯ç»“æŸstopTalk() // é€€å‡ºå¯¹è¯UI this.ToggleTalkUI(false).then(res= // æ¸¸æˆç»§ç»­ window.game.Continue() this.curTalkIndex = 0 this.tNameLabelCp.string = this.tCLabelCp.string = this.targetContent = ) ğŸ” å…¶ä»–é—®é¢˜ğŸ§© å…¨å±€çŠ¶æ€ç®¡ç†å•ä¸€åœºæ™¯å†…å¤šä¸ªèŠ‚ç‚¹çš„å…±äº«çš„çŠ¶æ€ï¼Œä½¿ç”¨ä¸€ä¸ªå•ä¸€åœºæ™¯è„šæœ¬ç±»Gameè¿›è¡Œæ§åˆ¶ï¼Œå°†GameæŒ‚è½½åˆ°CanvasèŠ‚ç‚¹ä¸Šï¼Œç„¶åå­˜æ”¾åˆ°æµè§ˆå™¨çš„windowä¸­ã€å¤šä¸ªåœºæ™¯å…±äº«çš„çŠ¶æ€ï¼Œ å­˜æ”¾åœ¨å…¥å£åœºæ™¯ä¸­çš„globalDataèŠ‚ç‚¹ä¸­ï¼Œå°†è¯¥èŠ‚ç‚¹é€šè¿‡cc.game.addPersistRootNodeè¿›è¡Œä¿å­˜ï¼Œå¯ä»¥åœ¨å¤šä¸ªåœºæ™¯å†…è®¿é—®åˆ°ï¼Œç”¨äºå­˜æ”¾ä¸€äº›æ¸¸æˆæ€»çŠ¶æ€ã€æ€»è®¾ç½®å‚æ•°ã€‚ ğŸŒ² åœºæ™¯åˆ‡æ¢é—®é¢˜å¦‚æœéœ€è¦ä»Aåœºæ™¯åˆ‡æ¢åˆ°Båœºæ™¯ï¼Œéœ€è¦é”€æ¯Aåœºæ™¯ä¸­ç»‘å®šçš„å…¨å±€äº‹ä»¶ï¼Œå¦åˆ™ä¹‹å‰ç»‘å®šçš„äº‹ä»¶ä¾ç„¶ä¼šè¢«æ­£å¸¸è°ƒç”¨ï¼š// å¦‚æœä¸é”€æ¯ç»‘å®šçš„äº‹ä»¶ï¼Œåˆ‡æ¢åœºæ™¯è°ƒç”¨çš„æ˜¯è¢«é”€æ¯èŠ‚ç‚¹ä¸Šçš„è„šæœ¬onDestroy(): void cc.systemEvent.removeAll(cc.SystemEvent.EventType.KEY_DOWN) cc.systemEvent.removeAll(cc.SystemEvent.EventType.KEY_UP) âŒ¨ï¸ äº‹ä»¶ç»‘å®šé—®é¢˜å‚è€ƒåšå®¢ï¼šæ¸¸æˆå¼€å‘-cocos creatorè¸©å‘-bind(this)å¯¼è‡´çš„äº‹ä»¶ç›‘å¬offä¸æ‰åœ¨ç»‘å®šå¯¹è¯é”®ç›˜äº‹ä»¶æ—¶ï¼Œæœ€åˆä½¿ç”¨çš„æ˜¯bindç»‘å®šäº‹ä»¶çš„thisï¼šcc.systemEvent.on( cc.SystemEvent.EventType.KEY_UP, this.loadNextWord.bind(this))ä½†æ˜¯é€šè¿‡bindç»‘å®šçš„æ¯æ¬¡éƒ½æ˜¯æ–°çš„äº‹ä»¶ï¼Œæ— æ³•æ­£å¸¸è¿›è¡Œè§£ç»‘ã€‚éœ€è¦ç”¨å¦ä¸€ç§æ–¹å¼æ¥å¯¹å…¨å±€äº‹ä»¶è¿›è¡Œç»‘å®šå’Œè§£ç»‘å®šï¼š// äº‹ä»¶ç»‘å®šcc.systemEvent.on( cc.SystemEvent.EventType.KEY_UP, this.loadNextWord, this)// äº‹ä»¶ç»‘å®šcc.systemEvent.off( cc.SystemEvent.EventType.KEY_UP, this.loadNextWord, this) ğŸ–±ï¸ é˜²æ­¢Clickäº‹ä»¶ç©¿é€ä¸Šå±‚èœå•å¼¹å‡ºåï¼Œè¢«é®ä½çš„æŒ‰é’®ä¾æ—§èƒ½æ­£å¸¸è§¦å‘ï¼Œéœ€è¦ç»™ä¸å¸Œæœ›è¢«ç©¿é€çš„èŠ‚ç‚¹æ·»åŠ BlockInputEventsç»„ä»¶ ğŸ“… å®Œæ•´ç‰ˆå¼€å‘æ—¥å¿— ğŸ ç¬¬ä¸‰æ­¥ï¼šä¸Šæ¶å‚è€ƒï¼šå¦‚ä½•ä¸Šä¼ ä½ çš„æ¸¸æˆåˆ°itch.ioï¼Ÿ(å«ä¸Šä¼ é¡µé¢çš„ç¿»è¯‘)æœ€åä¸Šæ¶æ¸¸æˆåˆ°itch.io,å®˜æ–¹æ¨èçš„å°é¢å›¾æ˜¯630*500ï¼Œå¦‚æœæ˜¯h5æ¸¸æˆï¼Œä¸Šä¼ åŒ…å†…çš„æ–‡ä»¶æ•°é‡ä¸å…è®¸è¶…è¿‡1000ä¸ªï¼Œæ‰€ä»¥åœ¨ä¸Šä¼ ä¹‹å‰æœ€å¥½æ¸…ç†ä¸€ä¸‹é¡¹ç›®æ–‡ä»¶å¤¹ ğŸ”š é¡¹ç›®æ€»ç»“æœ€æ·±åˆ»çš„æ€»ç»“å°±æ˜¯ï¼šä¸€å®šè¦é’ˆå¯¹æ¯ä¸ªåŠŸèƒ½ï¼Œè®¾è®¡å•å…ƒæµ‹è¯•ï¼ä¸ç„¶åˆ°äº†æ¸¸æˆåæœŸï¼Œæ‰€æœ‰æµç¨‹å·²ç»ä¸²èµ·æ¥ä¹‹åï¼Œå†æƒ³æ”¹ä¸€ä¸ªæ¸¸æˆä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ä¼šéå¸¸ç—›è‹¦è¿™éƒ¨åˆ†è¿˜åœ¨æ‘¸ç´¢ä¸­â€¦åœ¨å…¨å±€æ•°æ®è§„åˆ’å’Œæ§åˆ¶æ–¹é¢æ¯”è¾ƒæ··ä¹±è¿™ä»…æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªä¸»åœºæ™¯çš„å°æ¸¸æˆï¼Œå®é™…ä¸Šæ²¡æœ‰æ¶‰åŠä»»ä½•å¤æ‚çš„è®¾è®¡ã€‚æ ¹æ®ç©å®¶çš„å®é™…åé¦ˆï¼Œæ¸¸æˆåœ¨å¼•å¯¼æ–¹é¢åšçš„ä¸å¥½ï¼Œ ç©å®¶çš„æ¸¸æˆä½“éªŒæ²¡æœ‰é¢„æƒ³çš„æµç•…ã€‚ ğŸ’ æ¸¸æˆèµ„æºæ¸¸æˆç´ ææ¥æº æ¸¸æˆä¸­ä½¿ç”¨åˆ°çš„éƒ½æ˜¯å¼€æºç¤¾åŒºåˆ›ä½œè€…ä»¬åˆ†äº«çš„ç´ æèµ„æºï¼šç¾æœ¯èµ„æºï¼šå¤§éƒ¨åˆ†æ¥è‡ªäºWilliamBilliamçš„å¼€æºç¾æœ¯èµ„æºåŒ…festive-frenzy-sprite-sheetï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†éƒ¨åˆ†æ‰©å±•ã€‚å›¾æ ‡èµ„æºæ¥è‡ªäºitch.ioä¸Šçš„åˆ›ä½œè€…PiiiXLçš„å¼€æºç¾æœ¯èµ„æºåŒ…1-bit-icons-part-2æ“ä½œè¯´æ˜çš„é”®ç›˜å›¾æ ‡èµ„æºæ¥è‡ªäºitch.ioä¸Šçš„åˆ›ä½œè€…xPheReçš„å¼€æºç¾æœ¯èµ„æºåŒ…pixel-keyboard-layoutéº‹é¹¿åŠ¨ç”»æ¥è‡ªäºlapizwcgçš„å¼€æºç¾æœ¯èµ„æºåŒ…the-minifolks-forest-animals-deer-doe-free-32x32-mod-by-lapizwcgå­—ä½“èµ„æºï¼š Uranus-PixeléŸ³æ•ˆèµ„æºï¼š éŸ³ä¹å’ŒéŸ³æ•ˆæ¥è‡ªäºFreeSoundä¸Šçš„åˆ›ä½œè€…rhodesmaså’Œåˆ›ä½œè€…AudioCoffeeçš„å¼€æºåˆ†äº«ã€‚é¡¹ç›®githubæºç ","tags":["GameDev"],"categories":["GameDev"]},{"title":"Node-Expressåå°åº”ç”¨å¼€å‘è¿‡ç¨‹è®°å½•","path":"/2024/11/21/Express/","content":"å¿«é€Ÿéƒ¨ç½²expressé¡¹ç›®ï¼ˆç®€å•ç‰ˆï¼‰ä¸»è¦å‚è€ƒåšå®¢ ç¨‹åºç‰ˆæœ¬ æ“ä½œç³»ç»Ÿ CentOS7mysql 5.7.44nvm 0.38.0node v22.11.0 ExpressæœåŠ¡å™¨æ­å»ºå¿«é€Ÿæ­å»ºExpressæœåŠ¡å™¨-å‚è€ƒåšå®¢ä½¿ç”¨Expressåº”ç”¨ç¨‹åºç”Ÿæˆå™¨å¿«é€Ÿåˆ›å»ºåº”ç”¨éª¨æ¶ï¼šnpx express-generatorå®‰è£…ä¾èµ–ï¼šnpm installå®‰è£…nodemonæ”¯æŒçƒ­åŠ è½½ï¼šnpm i -g nodemonä¿®æ”¹package.jsonä¸­çš„scriptsçš„startè„šæœ¬ï¼š scripts: start: nodemon ./bin/www nodemoné€šè¿‡ç›‘å¬é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å˜åŠ¨ï¼Œè‡ªåŠ¨é‡å¯é¡¹ç›®ä¿®æ”¹æœåŠ¡çš„é»˜è®¤ç«¯å£ï¼ˆ3000ï¼‰ï¼š// app.jsprocess.env.PORT = 8090 // è‡ªå®šä¹‰ç«¯å£expressè¿æ¥mysqlæ•°æ®åº“åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºdataBaseæ–‡ä»¶å¤¹ï¼šdataBase api.js æŸ¥è¯¢æ•°æ®åº“æ¥å£config.js æ•°æ®åº“é…ç½®æ–‡ä»¶db.js æ•°æ®åº“è¿æ¥æ–‡ä»¶config.jsdb.jsapi.jsmodule.exports = db: host: 127.0.0.1, port: 3306, user: root, password: 123456, database: test_db, connectTimeout:10000, useConnectionPool: true, // è¿æ¥æ•°æ®åº“const mysql = require(mysql)const config = require(./config.js).db// è¿æ¥æ•°æ®åº“module.exports = mysql.createConnection(config)const connection = require(./db)// æ•°æ®åº“æŸ¥è¯¢const getService = () = return new Promise((resolve, reject) = connection.query(select * from Server, (err,data) = if(err) reject(err) else resolve(data) ) )module.exports = getService æœåŠ¡å™¨é…ç½®MySqlCentOSç¯å¢ƒå®‰è£…Mysql-å‚è€ƒåšå®¢å¸¸ç”¨å‘½ä»¤ï¼š# å¼€å¯mysqlæœåŠ¡systemctl start mysqld.service# è¿›å…¥mysqlå‘½ä»¤å°mysql -u root -p# é…ç½®my.cnfvim /etc/my.cnfè¿˜æ²¡æœ‰è´¦å·å’Œå¯†ç æ—¶ï¼Œå¯ä»¥åœ¨my.cnfä¸­é…ç½®è·³è¿‡å¯†ç ï¼š#...skip-grant-tablesä¿®æ”¹è¿‡my.cnfæ–‡ä»¶ä¹‹åï¼Œéœ€è¦é‡å¯mysqlæœåŠ¡ï¼šservice mysqld restartä¿®æ”¹Mysqlå¯†ç å‚è€ƒåšå®¢ï¼šåœ¨CentOsä¸Šä¿®æ”¹Mysqlå¯†ç ä¿®æ”¹é»˜è®¤å¯†ç æ—¶æŠ¥ã€å·²ç»è®¾ç½®äº†è·³è¿‡å¯†ç ã€‘çš„é”™è¯¯éœ€è¦ä½¿ç”¨mysqlå‘½ä»¤è¡Œè¿›è¡Œä¿®æ”¹ï¼Œè¿›å…¥mysqlæ•°æ®åº“ï¼šuse mysql;æŸ¥è¯¢è¡¨ä¿®æ”¹å¯†ç ï¼šalter user root@localhost identified by NewPassword;æœ€åä¸€å®šè¦åˆ·æ–°ä¸€ä¸‹mysqlï¼šflush privileges; æœåŠ¡å™¨é…ç½®gitå‚è€ƒåšå®¢ï¼šæœåŠ¡å™¨æ­å»ºå®‰è£…gitGiteeæ¯æ¬¡pulléƒ½è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å®‰è£…gitå‘½ä»¤ï¼šyum -y install gitè®¾ç½®gitå…¨å±€ç”¨æˆ·åã€é‚®ç®±åœ°å€ã€å¯†ç ï¼šgit config --global user.name xxxgit config --global user.email xxxgit config --global user.password xxxexpressæœåŠ¡å»ºåº“æäº¤ï¼Œè€ƒè™‘åˆ°å›½å†…ç½‘ç»œï¼Œé€‰ç”¨çš„æ˜¯giteeä»“åº“ï¼Œé‡åˆ°é—®é¢˜ï¼šæ¯æ¬¡git pulléƒ½éœ€è¦æˆ‘é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä½¿ç”¨å‘½ä»¤å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼šgit config --global credential.helper store æœåŠ¡å™¨é…ç½®NVMåˆ°äº†å‘æœ€å¤šçš„ä¸€æ­¥å®‰è£…å‚è€ƒå®‰è£…nvmï¼šcurl -o- https://raw.githubusercontent.com/creationix/nvm/v0.35.3/install.sh | bashå®‰è£…æŒ‡å®šç‰ˆæœ¬çš„nodeï¼šnvm install v22.11.0nodeè¿è¡ŒæŠ¥é”™é—®é¢˜å‚è€ƒåšå®¢ï¼šå‡çº§gccCentOS7å‡çº§GCCç‰ˆæœ¬ï¼Œè§£å†³version GLIBCXX_3.4.21â€˜ not foundè§£å†³nvmå‡çº§node v18.14.0æ—¶lib64libm.so.6: version â€˜GLIBC_2.27â€™ not found (required by node)é—®é¢˜æŸ¥çœ‹nodeç‰ˆæœ¬ï¼šnode -vè¿™æ—¶å‡ºç°æŠ¥é”™ï¼š-bash-4.2# node -vnode: /lib64/libm.so.6: version `GLIBC_2.27 not found (required by node)node: /lib64/libc.so.6: version `GLIBC_2.25 not found (required by node)node: /lib64/libc.so.6: version `GLIBC_2.28 not found (required by node)node: /lib64/libstdc++.so.6: version `CXXABI_1.3.9 not found (required by node)node: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.20 not found (required by node)node: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.21 not found (required by node)å¤§æ¦‚æ„æ€å°±æ˜¯ç¼ºå°‘å¯¹åº”ç‰ˆæœ¬çš„å‡ ä¸ªlib64ä¸‹çš„æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹ï¼Œä¸»è¦è§£å†³æ–¹æ¡ˆè§å‚è€ƒåšå®¢ï¼ˆèŠ±å¾ˆé•¿æ—¶é—´è§£å†³å¥½çƒ¦ï¼‰ Nginxæ‰˜ç®¡æœåŠ¡ä¸»è¦å‚è€ƒåšå®¢ è¿è¡ŒNodeé¡¹ç›® æŠŠä»£ç åº“æ‹‰ä¸‹æ¥ï¼Œnpm iå®‰è£…ä¾èµ–ä¹‹åï¼Œä½¿ç”¨pm2è¿›è¡ŒæœåŠ¡æ‰˜ç®¡ï¼š# å…¨å±€å®‰è£…pm2npm i -g pm2# pm2å¯åŠ¨åº”ç”¨ç¨‹åºpm2 start npm --name your-server-name# æŸ¥çœ‹pm2å¯åŠ¨æœåŠ¡åˆ—è¡¨pm2 liståœ¨æœåŠ¡å™¨ä¸Šå¼€æ”¾å¯¹åº”çš„æœåŠ¡ç«¯å£ Nginxä»£ç†é…ç½® server listen 80; server_name cocos-test.e-duck.xyz; location / # å…è®¸è·¨åŸŸ add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods GET, POST, OPTIONS; proxy_set_header X-Real-IP $remote_addr; # è·å–ç”¨æˆ·IP proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header Host $http_host; proxy_set_header X-Nginx-Proxy true; proxy_set_header Connection ; # æœåŠ¡å¼€å¯çš„åœ°å€ proxy_pass http://127.0.0.1:8090; å…¶å®ƒExpressè·å–è¯·æ±‚IPåœ°å€éœ€è¦å€ŸåŠ©åº“ï¼šIP2Regionnpm i ip2regionå¼•å…¥å¹¶ä½¿ç”¨ip2regionï¼šconst IP2Region = require(ip2region).default;router.get(/welcome,(req,res)= // éœ€è¦é…åˆnginxçš„é…ç½®ï¼Œåœ¨x-forwarded-forä¸­æå–ç”¨æˆ·ip let ip = req.headers[x-forwarded-for] || req.ip // å»ºç«‹æ–°çš„æŸ¥è¯¢ const query = new IP2Region() // è·å–ipåœ°å€ /** * * country:ä¸­å›½, * province:XXçœ, * city:XXå¸‚, * isp:ç§»åŠ¨, * */ const ipAddress = query.search(ip) res.send( code:200, data:ipAddress ))nginxéœ€è¦ä¿®æ”¹headeré…ç½®ï¼šserver listen 80; server_name xxxxxx; location / # ... proxy_set_header X-Forwarded-For $remote-addr; Nodejsè¿æ¥æ•°æ®åº“é¢‘ç¹æ‰çº¿é—®é¢˜æè¿° ä½¿ç”¨Nodejsè¿æ¥Mysqlæ—¶é¢‘ç¹æ‰çº¿ï¼ŒæŠ¥é”™ï¼šPROTOCOL_ENQUEUE_AFTER_FATAL_ERROR è§£å†³æ–¹æ³• Nodeè¿æ¥Mysqlé‡åˆ°çš„å‘ä»¥åŠè¸©å‘æ€»ç»“"},{"title":"NextJs","path":"/2024/09/24/NextJs/","content":"Bç«™Upï¼šå…¨æ ˆç å”æºæ•™ç¨‹åœ°å€ ä»€ä¹ˆæ˜¯NextJSNextJs Docä¸­æ–‡æ–‡æ¡£NextJsåŸºäºReactï¼Œreactjsæ¡†æ¶çš„åŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œä¸»è¦æ˜¯å°†htmlå’Œjavascriptä¸¤è€…ç»“åˆä½¿ç”¨ï¼ŒNextJsåœ¨æ­¤ä¹‹å¤–å¼•å…¥é¢å¤–çš„æ¡†æ¶åŠŸèƒ½ï¼šCLIè¿è¡Œæ—¶æ–‡ä»¶ç»“æ„è·¯ç”±é™æ€ç”Ÿæˆå™¨static generationISRSSRAPIStyleVercelé™æ€æ‰˜ç®¡å¹³å°è¿˜æœ‰å¦å¤–2ä¸ªå’ŒNextJsæ¯”è¾ƒç›¸ä¼¼çš„æ¡†æ¶ï¼šGatsbyJsï¼šç”Ÿæˆé™æ€é¡µé¢ï¼Œæ•°æ®ä»æœ¬æœºæŠ“å–æ•°æ®æ•´åˆï¼Œé€šè¿‡GraphQLæŸ¥è¯¢æœåŠ¡æä¾›æ•°æ®NestJSï¼šæ›´åŠ åå‘åç«¯ï¼Œç»§æ‰¿äº†Controllerã€Serviceç­‰å±‚çº§ï¼Œåå‘MVCç»“æ„ NextJsæ¡†æ¶ç›®å½•åˆ›å»ºé¡¹ç›®ï¼šnpx create-next-app@latestpackage.jsonè„šæœ¬å‘½ä»¤dev å¼€å‘æ¨¡å¼å¯åŠ¨build æ„å»ºç”Ÿäº§ç¯å¢ƒåº”ç”¨start å¯åŠ¨ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨export æ„å»ºé™æ€ç½‘ç«™ç«™ç‚¹åŸæœ¬çš„next exportå‘½ä»¤ç”¨äºæ„å»ºé™æ€ç½‘ç«™ç«™ç‚¹ï¼Œç°åœ¨éœ€è¦ç›´æ¥åœ¨next.config.mjsä¸­é…ç½®outputï¼šconst nextConfig = output:export,;export default nextConfig;è¿™æ ·ï¼Œåœ¨è¿è¡Œnpm run buildçš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆoutç›®å½•ï¼Œä¸‹é¢å­˜æ”¾çš„å°±æ˜¯é™æ€èµ„æº.nextæ–‡ä»¶.nextæ–‡ä»¶æ˜¯nexté¡¹ç›®ç”Ÿäº§ç¯å¢ƒä¸‹è¿è¡Œçš„æ–‡ä»¶ï¼Œåœ¨devæ¨¡å¼ä¸‹ä¹Ÿç”Ÿæˆ.nextæ–‡ä»¶ é™æ€è·¯ç”±indexè·¯ç”±åœ¨æ–‡ä»¶æ ¹ç›®å½•ä¸‹åˆ›å»ºpagesæ–‡ä»¶ï¼Œåœ¨pagesæ–‡ä»¶ä¸‹åˆ›å»ºçš„å­æ–‡ä»¶å¯ä»¥é€šè¿‡è·¯ç”±è¿›è¡Œå¯¼èˆªï¼špagesaboutindex.tsxè®¿é—®æ–¹å¼ï¼šlocalhost:3000aboutåµŒå¥—è·¯ç”±pagesnewshot.tsxè®¿é—®æ–¹å¼ï¼šlocalhost:3000newshot åŠ¨æ€è·¯ç”±åŠ¨æ€è·¯ç”± åŠ¨æ€è·¯ç”±ä½¿ç”¨æ–¹æ‹¬å·åŒ…è£¹å‚æ•°pagesnews[newId].tsxåœ¨è®¿é—®è·¯å¾„çš„æ—¶å€™åŠ å…¥è·¯ç”±ï¼šlocalhost:3000news1é€šè¿‡useRouterè·¯ç”±é’©å­è·å–åˆ°è·¯ç”±å‚æ•°ï¼šconst router = useRouter();const id = router.query.newIdåŠ¨æ€çˆ¶çº§è·¯å¾„ä½œä¸ºè·¯å¾„çš„ç›®å½•åä¹Ÿå¯ä»¥ç”¨åŠ¨æ€å‚æ•°çš„æ–¹å¼å‘½åï¼Œè¡¨ç¤ºçˆ¶çº§è·¯å¾„pagesnews[newsId]index.tsxcomment.tsxï¼ˆè®¿é—®ç›®æ ‡ï¼‰åœ¨è®¿é—®è·¯å¾„çš„æ—¶å€™åŠ å…¥è·¯ç”±ï¼šlocalhost:3000news1commentåŠ¨æ€åµŒå¥—è·¯ç”±è·¯ç”±ä¸­ä¸ä»…ä»…å¯ä»¥åµŒå…¥1ä¸ªåŠ¨æ€å‚æ•°ï¼Œå¯ä»¥åµŒå…¥å¤šä¸ªpagesnews[newsId]index.tsxcommentindex.tsx[commentId].tsxï¼ˆè®¿é—®ç›®æ ‡ï¼‰åœ¨è®¿é—®è·¯å¾„çš„æ—¶å€™åŠ å…¥è·¯ç”±ï¼šlocalhost:3000news1comment1åŠ¨æ€paramsè·¯ç”±åŠ¨æ€å‚æ•°è¿˜èƒ½åŒ…å«æ›´å¤šä¿¡æ¯ï¼špagesabout[â€¦params].tsxè®¿é—®è·¯å¾„ï¼šlocalhost:3000about123å‚æ•°è·å–æ–¹å¼ï¼ˆæ•°ç»„æ ¼å¼è¿”å›ï¼‰ï¼šconst router = useRouter();const params = router.query.params // [1,2,3] è¿è¡Œæ—¶åŠ¨æ€è·å–æ•°æ®æ¨¡æ‹Ÿåå°æ¥å£è·å–æ•°æ®export default function Recipe() const [data, setData] = useStateany[]([]) // æŠ“å–æ•°æ® const fetchData = () = fetch(https://dummyjson.com/recipes) .then(res=res.json()) .then(reply= console.log(reply) setData(reply.recipes) ) useEffect(()= fetchData() ,[]) return ( main ul data.map(item=li key=item.iditem.name/li) /ul /main ) æ„å»ºæ—¶è·å–æ•°æ®é¢„ç”Ÿæˆé™æ€é¡µé¢ï¼ˆSSGï¼‰é¡µé¢é¢„æ„å»º SSG SSRå’ŒCSRçš„åŒºåˆ«ï¼šhtmlè¯ç”Ÿä¹‹æ—¶ï¼Œå°±æ˜¯ä½œä¸ºä¸€ç§ä»æœåŠ¡å™¨ç«¯è·å–çš„èµ„æºï¼ˆSSRï¼‰ï¼Œä½†æ˜¯éšç€htmlå¯¹çµæ´»æ€§çš„éœ€æ±‚å˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œè¶Šæ¥è¶Šå¤šçš„äº¤äº’é€»è¾‘éƒ½è¢«æ”¾åœ¨äº†æµè§ˆå™¨ç«¯æ‰§è¡Œï¼Œäºæ˜¯å°±è¡ç”Ÿå‡ºäº†CSRçš„æ¨¡å¼ï¼Œç±»ä¼¼äºä¸€å®¶é¤å…ï¼ˆæœåŠ¡å™¨ï¼‰è´©å–æ‹›ç‰Œèœï¼ˆç½‘é¡µï¼‰ï¼Œä¸€å¼€å§‹å¤–å–å‘˜ï¼ˆæµè§ˆå™¨ï¼‰æ¥é¢†é¤ï¼Œå¨å¸ˆæŠŠèœè€è€å®å®åšå¥½äº¤åˆ°å¤–å–å‘˜æ‰‹é‡Œï¼ˆSSRï¼‰åæ¥å‘ç°å¤–å–å‘˜çš„æ–™ç†æ°´å¹³ç”šè‡³æ¯”å¨å¸ˆè¿˜å¼ºï¼ˆæµè§ˆå™¨ä¸“é—¨è´Ÿè´£jsçš„è¿è¡Œå’Œæ¸²æŸ“ï¼‰ï¼Œäºæ˜¯å¨å¸ˆå¹²è„†å°±åªæŠŠæ–™ç†çš„é£Ÿæå’Œé£Ÿè°±ï¼ˆjshtmlcssç­‰å…¶å®ƒåŸæ–™ï¼‰äº¤ç»™å¤–å–å‘˜ï¼Œå«å®ƒç°åœºåˆ¶ä½œå°±è¡Œäº†SSRå’ŒSSGçš„åŒºåˆ«SSRï¼šæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ŒåŠ¨æ€ç”Ÿæˆhtmlæ–‡ä»¶è¿”å›ç»™ç”¨æˆ·SSGï¼šæœåŠ¡å™¨ç«¯æ„å»ºï¼Œæå‰ç”Ÿæˆé™æ€htmlæ–‡ä»¶ï¼Œç”¨æˆ·è¯·æ±‚æ—¶è¿”å›çˆ¬è™«å’ŒSEOç”±äºSSRæ¨¡å¼ä¸‹çš„htmlæ–‡ä»¶éƒ½æ˜¯ç”±æœåŠ¡å™¨ç«¯ç”Ÿæˆè¿”å›çš„ï¼Œçˆ¬è™«å°±èƒ½ç›´æ¥çˆ¬å–åˆ°å…¶å†…å®¹ä¸­çš„ä¿¡æ¯ï¼Œåœ¨SEOä¼˜åŒ–æ–¹é¢ä¹Ÿæœ‰æ›´å¤§çš„ä¼˜åŠ¿ï¼Œè¿™æ˜¯CSRåº”ç”¨ä¸å…·æœ‰çš„ä¼˜åŠ¿ï¼ŒCSRç±»ä¼¼äºç¾é£Ÿè®°è€…ï¼ˆçˆ¬è™«ï¼‰æƒ³è¦æ¥è¿™å®¶é¤å…ç”¨æ‹›ç‰Œèœï¼ˆç½‘é¡µï¼‰å–æï¼Œ å´åªæ”¶åˆ°é£Ÿæå’Œä¸€å¼ é£Ÿè°±ï¼Œå®Œå…¨ä¸çŸ¥é“æˆå“æ˜¯ä»€ä¹ˆæ ·å­æœåŠ¡å™¨ç«¯æ¸²æŸ“é¡µé¢ï¼Œéœ€è¦åœ¨é¡µé¢ä¸­å¤šæ·»åŠ 2ä¸ªå¼‚æ­¥æ–¹æ³•ï¼šgetStaticPathsç”¨äºåŠ¨æ€è·¯ç”±é¡µé¢ä¸­ï¼Œåˆ¤æ–­å“ªäº›è·¯ç”±éœ€è¦è¿›è¡Œä¸æ¸²æŸ“getStaticPropsè¯·æ±‚é¢„æ¸²æŸ“å‚æ•°propsä½¿ç”¨propsæ¸²æŸ“ç»„ä»¶ï¼Œç”Ÿæˆhtmlé¡µé¢ getStaticProps é¡µé¢ç»„ä»¶æ¥æ”¶ä¸€ä¸ªé‡‡çº³æ•°propsï¼Œè€Œè¿™ä¸ªå‚æ•°ç”±getStaticPropsä¼ å…¥export default function Recipe(props:any) // devæ¨¡å¼ä¸‹ï¼Œåœ¨æœåŠ¡ç«¯è¿è¡Œä¸€éï¼Œåœ¨å®¢æˆ·ç«¯è¿è¡Œä¸€é console.log(Recipe, props.data) return ( main ul props.data.map((item:any)= li key=item.iditem.name/li) /ul /main )åœ¨getStaticPropsä¸­è·å–åŠ¨æ€æ•°æ®ï¼Œä¼ å…¥ç»„ä»¶å†…ï¼Œè°ƒç”¨ç»„ä»¶å‡½æ•°è¿›è¡Œæ¸²æŸ“ï¼šexport async function getStaticProps() // åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ console.log(static props) const response = await fetch(https://dummyjson.com/recipes) const reply = await response.json() return ( props: data:reply.recipes, ) getStaticPaths å¯¹äºåŠ¨æ€è·¯ç”±é¡µé¢ï¼Œæ— æ³•ç›´æ¥åœ¨getStaticPropså‡½æ•°ä¸­ï¼Œé€šè¿‡useRouterç›´æ¥è·å–åˆ°è·¯ç”±å‚æ•°ï¼Œå› æ­¤éœ€è¦ç”¨getStaticPathsï¼Œå®šä¹‰é™æ€é¡µé¢ç”Ÿæˆçš„èŒƒå›´ï¼Œå¹¶å°†è·¯ç”±å‚ä¿¡æ¯é€šè¿‡contextä¼ å…¥getStaticPropsä¸­ï¼šgetStaticPaths â†’ getStaticProps â†’ CompFunctiongetStaticPathsï¼šexport async function getStaticPaths() return paths:[ params:recipeId:1, params:recipeId:2, ], fallback:true, // fallbackè®¾ç½®è·¯ç”±å‚æ•°æœªåŒ¹é…ä¸Šä¹‹åçš„è¡Œä¸º getStaticPropsï¼š// getStaticPropså‡½æ•°åç§°å›ºå®šexport async function getStaticProps(context:any) // é€šè¿‡getStaticPathsè·å–åˆ°çš„è·¯ç”±å‚æ•° const recipeId = context.params.recipeId const response = await fetch(`https://dummyjson.com/recipes/$recipeId`) const reply = await response.json() console.log(reply) return props: data:reply æ„å»ºç»“æœ next build æ„å»ºç»“æœæ„å»ºç”Ÿæˆæ–‡ä»¶ è·¯ç”±è·³è½¬ æ•°æ®é¢„å–è·¯ç”±è·³è½¬ LinkuseRouterexport default function RouterButton() const router = useRouter() return ( div Link href=/HomeHome/Link button onClick=()=router.back()Back/button button onClick=()=router.push(/login)Login/button /div ) prefetch Linknextæä¾›çš„Linkæ ‡ç­¾ï¼Œæä¾›prefetchæ ‡ç­¾ï¼Œå³é¢„è·å–ç›®æ ‡é¡µé¢ï¼Œå³æ ¹æ®å½“å‰é¡µé¢ä¸­çš„é“¾æ¥é¢„è·å–æ•°æ®ï¼Œå¯ä»¥æ ¹æ®è§†å£æ»šåŠ¨é¼ æ ‡æ‚¬åœè§¦å‘ å®¢æˆ·è¯·æ±‚æ—¶æŒ‰éœ€ç”Ÿæˆé™æ€é¡µé¢æœåŠ¡ç«¯æŒ‰éœ€ç”Ÿæˆ SSG åŠ¨æ€è·¯ç”±å¯ä»¥è¿›è¡Œå…¨é‡æ„å»ºï¼šexport async function getStaticPaths() // åŠ¨æ€ç”Ÿæˆurlå‚æ•° const response = await fetch(https://dummyjson.com/posts) const reply = await response.json() return paths:reply.posts.map((post:any)=( params:postId:post.id.toString() )), fallback: true, ä¹Ÿå¯ä»¥æŒ‰éœ€ç”Ÿæˆï¼Œé…ç½®getStaticPathsè¿”å›fallbackä¸ºtrueï¼šexport async function getStaticPaths() return paths:[], fallback: true, fallbackå¯ä»¥æœ‰å‡ ä¸ªå€¼ï¼šblock è®¿é—®æœªç”Ÿæˆé™æ€é¡µé¢çš„åŠ¨æ€è·¯ç”±æ—¶ï¼Œè¿”å›404true æŒ‰éœ€ç”Ÿæˆé™æ€é¡µé¢ å¢é‡æ›´æ–°å†…å®¹é™æ€ç”Ÿæˆé¡µé¢revalidate getStaticPropsè¿”å›çš„revalidateï¼Œç”¨äºæ§åˆ¶é™æ€é¡µé¢åˆ·æ–°å‘¨æœŸï¼Œexport async function getStaticProps() const dt = new Date().toString() const response = await fetch(https://dummyjson.com/posts) const reply = await response.json() return props: data:reply.posts, dt , revalidate:30 // é™æ€é¡µé¢ç¼“å­˜å‘¨æœŸ è®¾ç½®revalidateä¹‹åï¼Œé™æ€æ–‡ä»¶çš„htmlè¯·æ±‚å¤´ä¸­å°±ä¼šå¤šå‡ºä¸€ä¸ªå‚æ•°,ä»£è¡¨ç¼“å­˜æ—¶é•¿æ§åˆ¶cache-control: s-maxage=30, stale-while-revalidate æœåŠ¡ç«¯æ¸²æŸ“ SSRSSR Nextä¸­åœ¨ç»„ä»¶å†…ä½¿ç”¨å¼‚æ­¥æ–¹æ³•getServerSidePropsï¼Œæ¥è¡¨ç¤ºéœ€è¦æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„é¡µé¢å’ŒgetStaticPropsçš„ä¸åŒä¹‹å¤„åœ¨äºï¼ŒgetServerSidePropsçš„routerå‚æ•°contextæ›´ç±»ä¼¼httpè¯·æ±‚å¤´çš„æ ¼å¼ï¼ŒåŒ…æ‹¬reqã€resã€paramsã€queryç­‰å‚æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¯¹resè¿›è¡Œè‡ªå®šä¹‰å“åº”å¤´é…ç½®ï¼šexport async function getServerSideProps(context:any) const res, query, params = context // å¯¹é™æ€é¡µé¢çš„è¯·æ±‚å¤´è‡ªå®šä¹‰é…ç½® res.setHeader(Set-Cookie, token=xxxxxxx) return ( props: data: [], dt ) è·¯ç”±ä¼ å‚ å’ŒSSGä¸åŒï¼ŒSSRæ”¯æŒé€šè¿‡è·¯ç”±ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œä¼ å‚çš„æ–¹å¼å¯ä»¥æ˜¯é€šè¿‡è·¯ç”±ä¼ å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡åŠ¨æ€è·¯ç”±ä¼ å‚ï¼Œæ— è®ºæ˜¯å“ªä¸€ç§ï¼Œåœ¨getServerSidePropsä¸­éƒ½å¯ä»¥é€šè¿‡contextè·å–åˆ°è·¯ç”±å‚æ•°ä¼ å‚è·¯ç”±æ–‡ä»¶ï¼š products.tsxurlï¼šproducts?typephonebrandvivoè·å–åˆ°çš„å‚æ•°context.queryï¼š type: phone, brand: vivo åŠ¨æ€è·¯ç”±ä¼ å‚åŒæ–¹æ‹¬å·ï¼Œè¡¨ç¤ºå°±ç®—ä¸ä¼ paramsï¼Œä¹Ÿä¼šæ˜ å°„åˆ°è¯¥æ–‡ä»¶ä¸­è·¯ç”±æ–‡ä»¶ï¼š[[â€¦params]].tsxurlï¼šproductsphonevivoè·å–åˆ°çš„å‚æ•°context.queryï¼š params: [ phone, vivo ] åˆ›å»ºåç«¯APIæ¥å£API åœ¨pagesä¸‹åˆ›å»ºapiç›®å½•ï¼Œä¸‹é¢å­˜æ”¾è·¯ç”±æ˜ å°„æ¥å£ï¼Œpagesapiapiç›®å½•ä¸‹åˆ›å»ºæ¥å£è·¯å¾„ï¼šapiproducts.tsimport NextApiRequest, NextApiResponse from next;type Data = dt: string, products: any[]// handlerä¸­é…ç½®è¿”å›å€¼export default async function handler( req: NextApiRequest, res: NextApiResponseData) const dt = new Date().toString() // console.log(dt, method: req.method, query: req.query) const response = await fetch(https://dummyjson.com/products) const reply = await response.json() res.status(200).json( dt, products:reply.products ) å¢åˆ æ”¹æŸ¥ handlerä¸­ï¼Œæ ¹æ®å­—æ®µreq.methodå¯¹è¯·æ±‚ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼šexport default async function handler( req: NextApiRequest, res: NextApiResponseData) const dt = new Date().toString() console.log(dt, method: req.method, query: req.query) switch(req.method) case POST: productsList.push(req.body) break; case PUT: const index = productsList.findIndex((product:any)=product.id==req.body.id) if(index=0) productsList.splice(index, 1, req.body) break; case DELETE: const index = productsList.findIndex((product:any)=product.id==req.body.id) if(index=0) productsList.splice(index, 1) break; default: break; res.status(200).json( total: productsList.length, products: productsList ) é¡µé¢å…¨å±€é¡µé¢å¸ƒå±€è®¾ç½®pages layoutsNext.js v13æ¨å‡ºäº†App Routerä½œä¸ºæ–°çš„è·¯ç”±è§£å†³æ–¹æ¡ˆï¼š- app - template.tsx - layout.tsx - page.tsx - news - template.tsx - layout.tsx - page.tsxå…¶ä¸­templateå’Œlayoutéƒ½æä¾›äº†å…¬å…±çš„å¸ƒå±€æ–¹æ³•ï¼Œä¸åŒç‚¹åœ¨äºï¼šlayoutï¼Œç›¸å½“äºå¤šä¸ªå­é¡µé¢å…±äº«ä¸€ä¸ªçˆ¶å¸ƒå±€templateï¼Œç›¸å½“äºä¸ºå¤šä¸ªå­é¡µé¢åˆ›å»ºç›¸åŒçš„å¸ƒå±€ é¡µé¢è¾…åŠ©ä¿¡æ¯è®¾ç½® åœ¨pageæˆ–è€…layoutä¸­è®¾ç½®metadataå˜é‡ï¼Œä½œä¸ºå¯¹headerå¤´çš„è¡¥å……æˆ–è€…è¦†ç›–è®¾ç½®ï¼Œå¸¸ç”¨æ¥ä¼˜åŒ–SEOæœç´¢å¼•æ“import Metadata from next export const metadata: Metadata = title: Next.js, export default function Page() return ... use client Nexté»˜è®¤appä¸‹çš„æ‰€æœ‰pageséƒ½æ˜¯ç”±æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ï¼Œå› æ­¤ä¸€äº›Reactçš„Hookæ— æ³•ä½¿ç”¨ï¼Œéœ€è¦åœ¨é¡µé¢çš„ç¬¬ä¸€è¡ŒåŠ ä¸Šæ³¨é‡Šï¼šuse client å‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æ‰˜ç®¡å¹³å°éƒ¨ç½² Vercelå°†é™æ€æ–‡ä»¶æ‰˜ç®¡åœ¨Vercelå¹³å°çš„æ–¹æ³•è™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯å›½å†…åŸºæœ¬æ˜¯æ— æ³•è®¿é—®åˆ°Vercleæ‰˜ç®¡çš„ç«™ç‚¹çš„å®˜ç½‘éƒ¨ç½²æŒ‡å¯¼ éƒ¨ç½²é—®é¢˜æŠ¥é”™ï¼šæœåŠ¡ç«¯æ— æ³•è°ƒç”¨å®¢æˆ·ç«¯api ReferenceError: document is not definedå®˜æ–¹è§£å†³æ–¹æ³•github issueè§£å†³æ–¹æ³•é¡µé¢ä½¿ç”¨dynamicssrå¼•å…¥ç»„ä»¶åŠ¨æ€å¼•å…¥ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®ssrçš„é…ç½®åˆ¤æ–­æ˜¯å¦åœ¨æœåŠ¡å™¨ç«¯å¼•å…¥ç»„ä»¶ä½¿ç”¨use clientå£°æ˜ä¸ºå®¢æˆ·ç«¯ç»„ä»¶Page é¡µé¢Component å­ç»„ä»¶import dynamic from next/dynamicconst Component = dynamic(()=import(./Component),ssr:false)export function Page() return ( Component// )use clientexport function Component() return (divå­ç»„ä»¶/div) NextJså¼€å‘æ–‡æ¡£ç›®å½•ç»“æ„Next.js Project Structure å®˜æ–¹æ–‡æ¡£ APIå‚è€ƒå‡½æ•°FunctiongenerateMetadataå‚è€ƒæ–‡ç« ï¼šgenerateMetadataå®˜æ–¹æ–‡æ¡£Next.js ä¸ºä»€ä¹ˆä½¿ç”¨metadataå–ä»£äº†Headç»„ä»¶ï¼ŸgenerateViewportå®˜æ–¹æ–‡æ¡£nextå®šä¹‰é™æ€é¡µé¢çš„metadataï¼š// metadata å¤´éƒ¨å…ƒæ•°æ®è®¾ç½®export const metadata: Metadata = title: Next Lab, description: Next + Three Lab,;// viewport è§†å£è®¾ç½®export const viewport: Viewport = themeColor:black, width:320.1, initialScale:1, minimumScale:1, maximumScale:1, userScalable:false,export default function RootLayout( children, : Readonly children: React.ReactNode;) return ( html lang=en meta name=theme-color content=#000/ body className=`$geistSans.variable $geistMono.variable` children /body /html );","tags":["Web"]},{"title":"å‰ç«¯é¡¹ç›®å·¥ç¨‹åŒ–é…ç½®æŒ‡å—","path":"/2024/09/19/FrontDevEnv/","content":"Webpack5 + React18 + Ts å¼€å‘å’Œæ‰“åŒ…ç¯å¢ƒå›¾æºè‡ªåŸåšå®¢ä½œè€… å‚è€ƒåšå®¢ webpack loaderä»‹ç» åˆå§‹åŒ–é¡¹ç›®åˆå§‹åŒ–package.jsonåˆå§‹åŒ–package.jsonæ–‡ä»¶ åˆ›å»ºæ–°é¡¹ç›®çš„ç©ºç›®å½•æ–‡ä»¶webpack-react-tsï¼Œåœ¨ç›®å½•æ–‡ä»¶ä¸‹æ‰“å¼€cmdæ§åˆ¶å°ï¼Œæ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼šnpm init -ynpm initå‘½ä»¤ä»‹ç» åˆå§‹åŒ–ç›®å½•ç»“æ„æ‰‹åŠ¨åˆ›å»ºç›®å½•ç»“æ„ â”œâ”€â”€ build | â”œâ”€â”€ webpack.base.js # å…¬å…±é…ç½®| â”œâ”€â”€ webpack.dev.js # å¼€å‘ç¯å¢ƒé…ç½®| â””â”€â”€ webpack.prod.js # æ‰“åŒ…ç¯å¢ƒé…ç½®â”œâ”€â”€ publicâ”‚ â””â”€â”€ index.html # htmlæ¨¡æ¿â”œâ”€â”€ src| â”œâ”€â”€ App.tsx # æ ¹ç»„ä»¶â”‚ â””â”€â”€ index.tsx # reactåº”ç”¨å…¥å£é¡µé¢â”œâ”€â”€ tsconfig.json # tsé…ç½®â””â”€â”€ package.json å®‰è£…ä¾èµ–å®‰è£…ä¾èµ– webpackä¾èµ–npm i webpack webpack-cli -Dreactä¾èµ–npm i react react-dom -Sreactç±»å‹ä¾èµ–npm i @types/react @types/react-dom -D æ·»åŠ ç½‘é¡µæ ¹htmlæ¨¡ç‰ˆæ·»åŠ ç½‘é¡µæ ¹htmlæ¨¡ç‰ˆ publicindex.html !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titlewebpack-react-ts/title/headbody !-- å®¹å™¨èŠ‚ç‚¹ -- div id=root/div/body/html é…ç½®tsconfig.jsonæ–‡ä»¶é…ç½®tsconfig.jsonæ–‡ä»¶ é…ç½®æŒ‡å— compilerOptions: target: ESNext, lib: [DOM, DOM.Iterable, ESNext], allowJs: false, skipLibCheck: false, esModuleInterop: false, allowSyntheticDefaultImports: true, strict: true, forceConsistentCasingInFileNames: true, module: ESNext, moduleResolution: Node, resolveJsonModule: true, isolatedModules: true, noEmit: true, jsx: react , include: [./src] åˆå§‹åŒ–srcApp.tsxå’Œsrcindex.tsxå†…å®¹åˆå§‹åŒ–srcApp.tsxå’Œsrcindex.tsxå†…å®¹ srcindex.tsxæ˜¯å…¥å£æ–‡ä»¶import React from reactimport createRoot from react-dom/clientimport App from ./Appconst root = document.getElementById(root)if(root) createRoot(root).render(App/)srcApp.tsxæ˜¯æ ¹ç»„ä»¶import React from react;function App() return h2Webpack React Ts/h2export default App é…ç½®åŸºç¡€ç‰ˆReact+tsç¯å¢ƒwebpackå…¬å…±ç¯å¢ƒbuildwebpack.base.js é…ç½®å…¥å£æ–‡ä»¶ entryé…ç½®å‡ºå£æ–‡ä»¶ outputé…ç½®loaderè§£ætså’Œjsxï¼Œéœ€è¦å®‰è£…ä¾èµ–ï¼šbabel-loader@babelcore@babelpreset-react jsxè§£æå™¨@babelpreset-typescript tsè§£æå™¨npm i babel-loader @babel/core @babel/preset-react @babel/preset-typescript -Dé…ç½®æ–‡ä»¶åç¼€ resolveå°†é™æ€èµ„æºå¼•å…¥htmlæ–‡ä»¶ï¼Œéœ€è¦å®‰è£…ä¾èµ–html-webpack-pluginnpm i html-webpack-plugin -Dconst path = require(path)const HtmlWebpackPlugin = require(html-webpack-plugin);module.exports = // 1. å…¥å£æ–‡ä»¶ entry: path.join(__dirname,../src/index.tsx), // 2. æ‰“åŒ…æ–‡ä»¶å‡ºå£ output: filename: static/js/[name].js, // æ¯ä¸ªè¾“å‡ºjsçš„åç§° path: path.join(__dirname, ../dist), // æ‰“åŒ…ç»“æœ clean: true, publicPath: /, // æ‰“åŒ…åæ–‡ä»¶çš„å…¬å…±å‰ç¼€è·¯å¾„ , // 3. loaderè§£ætså’Œjsx module: rules:[ test: /.(ts|tsx)$/, // åŒ¹é…tsã€tsxæ–‡ä»¶ use: loader: babel-loader, options: // é¢„è®¾æ‰§è¡Œä»å³å‘å·¦ presets:[ @babel/preset-react, @babel/preset-typescript ] ] , // 4. æ–‡ä»¶å¼•ç”¨åç¼€é…ç½® resolve: extensions: [.js, .tsx, ,ts] , // 5. æ·»åŠ htmlæ’ä»¶ plugins: [ new HtmlWebpackPlugin( template:path.resolve(__dirname, ../public/index.html), // è®¾ç½®æ¨¡ç‰ˆ inject:true, // æ˜¯å¦è‡ªåŠ¨æ³¨å…¥ ), ] webpackå¼€å‘ç¯å¢ƒé…ç½®buildwebpack.dev.js é…ç½®å¼€å‘ç¯å¢ƒéœ€è¦é¢å¤–å®‰è£…2ä¸ªåº“ï¼šwebpack-dev-server å¼€å‘ç¯å¢ƒä¸­å¯åŠ¨æœåŠ¡å™¨webpack-merge åˆå¹¶webpack.base.jsåŸºæœ¬é…ç½®npm i webpack-dev-server webpack-merge -Dä¿®æ”¹webpack.dev.jsæ–‡ä»¶ï¼šconst path = require(path);const merge = require(webpack-merge)const baseConfig = require(./webpack.base)// åˆå¹¶å…¬å…±é…ç½®ï¼Œæ·»åŠ å¼€å‘ç¯å¢ƒé…ç½®module.exports = merge(baseConfig, mode: development, // å¼€å‘æ¨¡å¼ï¼ŒåŠ é€Ÿæ‰“åŒ… devtool: eval-cheap-module-source-map, // æºç è°ƒè¯•ç»“æ„ devServer: // æœåŠ¡å™¨é…ç½® port: 3000, // æœåŠ¡ç«¯å£å· compress: false, // gzipå‹ç¼© hot: true, // å¼€å¯çƒ­æ›´æ–° historyApiFallback: true, // static: directory: path.join(__dirname, ../public) // æ‰˜ç®¡é™æ€èµ„æºpublicæ–‡ä»¶å¤¹ )åœ¨package.jsonä¸­æ·»åŠ devè„šæœ¬ï¼š scripts: dev: webpack-dev-server -c build/webpack.dev.js æ§åˆ¶å°æ‰§è¡Œdevå¯åŠ¨å‘½ä»¤ï¼šnpm run dev webpackæ‰“åŒ…ç¯å¢ƒé…ç½®buildwebpack.prod.js ä¿®æ”¹webpack.prod.jsé…ç½®æ–‡ä»¶ï¼šconst merge = require(webpack-merge)const baseConfig = require(./webpack.base)module.exports = merge(baseConfig, mode:production,// å¼€å¯ç”Ÿäº§ç¯å¢ƒ)æ·»åŠ buildè„šæœ¬ï¼š scripts: build: webpack -c build/webpack.prod.js æ‰§è¡Œæ‰“åŒ…å‘½ä»¤npm run buildå¯ä»¥é€šè¿‡serveå¯åŠ¨æ‰“åŒ…å¥½çš„é¡¹ç›®ï¼šnpm i serve -gserve -s dist åŸºç¡€åŠŸèƒ½é…ç½®é…ç½®ç¯å¢ƒå˜é‡ç¯å¢ƒå˜é‡åˆ†ç±» æŒ‰ç…§æ¨¡å¼å¼€å‘ç¯å¢ƒç”Ÿäº§ç¯å¢ƒåŒºåˆ†æ–¹å¼ï¼šprocess.env.NODE_ENVæŒ‰ç…§é¡¹ç›®ä¸šåŠ¡ç¯å¢ƒå¼€å‘ç¯å¢ƒæµ‹è¯•ç¯å¢ƒé¢„æµ‹ç¯å¢ƒæ­£å¼ç¯å¢ƒ åŒºåˆ†é¡¹ç›®æ¥å£ç¯å¢ƒæ–¹å¼ è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ process.env.BASE_ENVè®¾ç½®æ–¹å¼ï¼šcross-env å…¼å®¹å„ç³»ç»Ÿè®¾ç½®ç¯å¢ƒå˜é‡çš„åŒ…webpack.DefinePlugin webpackå†…ç½®ï¼Œä¸ºä¸šåŠ¡ä»£ç æ³¨å…¥ç¯å¢ƒå˜é‡å®‰è£…cross-envï¼šnpm i cross-env -Dä¿®æ”¹package.jsoné‡Œçš„è„šæœ¬ï¼š scripts: dev:dev: cross-env NODE_ENV=development BASE_ENV=development webpack-dev-server -c build/webpack.dev.js, dev:test: cross-env NODE_ENV=development BASE_ENV=test webpack-dev-server -c build/webpack.dev.js, dev:pre: cross-env NODE_ENV=development BASE_ENV=pre webpack-dev-server -c build/webpack.dev.js, dev:prod: cross-env NODE_ENV=development BASE_ENV=production webpack-dev-server -c build/webpack.dev.js, build:dev: cross-env NODE_ENV=production BASE_ENV=development webpack -c build/webpack.prod.js, build:test: cross-env NODE_ENV=production BASE_ENV=test webpack -c build/webpack.prod.js, build:pre: cross-env NODE_ENV=production BASE_ENV=pre webpack -c build/webpack.prod.js, build:prod: cross-env NODE_ENV=production BASE_ENV=production webpack -c build/webpack.prod.js åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œä¼šå°†ç”¨äºåˆ¤æ–­ç¯å¢ƒçš„å‚æ•°ä¼ å…¥webpackçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œwebpackå¯ä»¥æ ¹æ®å‚æ•°è¿›è¡Œä¸åŒçš„é…ç½®ï¼šprocess.env.NODE_ENV // æ¨¡å¼å‚æ•°process.env.BASE_ENV // ä¸šåŠ¡å‚æ•°ç›´åˆ°è¿™ä¸€æ­¥ï¼Œä¼ å…¥çš„å‚æ•°åªèƒ½åœ¨webpacké…ç½®æ–‡ä»¶ä¸­è·å–åˆ°ï¼Œè¦æƒ³åœ¨ä¸šåŠ¡ä»£ç ä¸­ç”¨åˆ°å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨webpack.DefinePluginï¼Œå°†å‚æ•°æ³¨å…¥åˆ°ä¸šåŠ¡ä»£ç ä¸­å»ï¼šconst webpack = require(webpack);module.exports = plugins:[ new webpack.DefinePlugin( process.env.BASE_ENV:JSON.stringify(progress.env.BASE_ENV) ) ] csslessé…ç½®å¦‚ä½•è§£æcss å¯¹cssçš„è§£æéœ€è¦ç”¨åˆ°loaderï¼šstyle-loader æŠŠè§£æåçš„cssä»£ç æŠ½ç¦»æ”¾åˆ°å¤´éƒ¨çš„styleæ ‡ç­¾css-loader è§£æcssæ–‡ä»¶npm i style-loader css-loader -Då°†loaderé…ç½®åˆ°webpack.base.jsä¸­ï¼šmodule.exports = module: rules:[ // é…ç½®cssæ–‡ä»¶ test: /\\.css$/, use:[style-loader, css-loader] ] æ³¨æ„ï¼Œloaderä¼šä»å³å‘å·¦å¼•å…¥ï¼Œè¿™é‡Œçš„é¡ºåºä¸èƒ½æ”¹å˜ï¼Œå› ä¸ºéœ€è¦å…ˆç¼–è¯‘cssä»£ç ï¼Œå†å°†csséƒ¨åˆ†åµŒå…¥åˆ°styleé‡Œ less éœ€è¦ç”¨åˆ°2ä¸ªåŒ…ï¼šless-loader æŠŠlessç¼–è¯‘ä¸ºcss less æ ¸å¿ƒnpm i less less-loader -DæŠŠless-loaderåŠ å…¥åˆ°ä¹‹å‰çš„cssé…ç½®éƒ¨åˆ†ï¼šmodule.exports = module: rules:[ // é…ç½®css/lessæ–‡ä»¶ test: /\\.(css|less)$/, use:[style-loader, css-loader,less-loader] ] å¤„ç†css3å‰ç¼€å…¼å®¹æ€§åœ¨css3è¿˜æ²¡æœ‰æ™®åŠçš„æ—¶å€™ï¼Œå„å®¶æµè§ˆå™¨é€šè¿‡â€œå®éªŒå±æ€§â€çš„æ–¹å¼å¯¹ç‰¹æ€§è¿›è¡Œå®ç°ï¼Œå¹¶åœ¨è‡ªå®¶å®ç°çš„å±æ€§å‰æŒ‚ä¸Šæµè§ˆå™¨çš„æ ‡è¯†ï¼Œå¯¼è‡´ä¸ºäº†å®ç°åŒä¸€ä¸ªå±æ€§ï¼Œè¦å†™å¥½å‡ ä¸ªç‰ˆæœ¬postcsså°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå®ç°çš„ï¼Œè™½ç„¶ç°åœ¨å¤§éƒ¨åˆ†çš„ä¸»æµæµè§ˆå™¨éƒ½æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿˜æ˜¯å­˜åœ¨éœ€è¦å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„æƒ…å†µå­˜åœ¨ï¼Œè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨postcss-loaderï¼Œéœ€è¦å¼•å…¥2ä¸ªåº“ï¼špostcss-loader å¤„ç†cssçš„å‰ç¼€autoprefixer å†³å®šéœ€è¦å…¼å®¹å“ªäº›æµè§ˆå™¨npm i postcss-loader autoprefixer -Då¯ä»¥å°†postcsså•ç‹¬æ”¾åˆ°æ ¹ç›®å½•é‡Œé…ç½®ï¼šåœ¨æ ¹ç›®å½•ä¸­æ·»åŠ postcss.config.jsæ–‡ä»¶module.exports = plugins: [autoprefixer]å†æ·»åŠ autoprefixeré…ç½®æ–‡ä»¶.browserslistrcIE 9 # å…¼å®¹IE 9chrome 35 # å…¼å®¹chrome 35ç„¶åå°†postcss-loaderé…ç½®åˆ°webpackä¸­module.exports = module: rules:[ // é…ç½®css/lessæ–‡ä»¶ test: /\\.(css|less)$/, use:[style-loader, css-loader, postcss-loader, less-loader] ] babelå¤„ç†jså…¼å®¹babelå¯ä»¥ç”¨æ¥è½¬æ¢jsçš„ç‰ˆæœ¬ï¼Œä¹Ÿèƒ½å°†ä¸æ ‡å‡†çš„jsè½¬æ¢ä¸ºæ ‡å‡†çš„jsï¼Œéœ€è¦å®‰è£…ä¸‹é¢çš„åº“ï¼šbabel-loader ä½¿ç”¨babelåŠ è½½æœ€æ–°jså¹¶è½¬æ¢ä¸ºES5@babelcorebabelç¼–è¯‘çš„æ ¸å¿ƒåŒ…@babelpreset-envç¼–è¯‘é¢„è®¾ï¼Œè½¬æ¢ç›®å‰æœ€æ–°çš„jsæ ‡å‡†è¯­æ³•core-jsä½¿ç”¨ä½ç‰ˆæœ¬jsè¯­æ³•æ¨¡æ‹Ÿé«˜ç‰ˆæœ¬çš„åº“ï¼Œå«ç‰‡npm i babel-loader @babel/core @babel/preset-env core-js -Dåœ¨æ ¹ç›®å½•æ·»åŠ babel.config.jsï¼Œè¿›è¡Œé…ç½®ï¼šmodule.exports = // å¤„ç†é¡ºåºï¼š // 1. å¤„ç†ts // 2. å¤„ç†jsx // 3. babelè½¬æ¢ presets:[ [ @babel/preset-env, //è®¾ç½®æµè§ˆå™¨ç‰ˆæœ¬ï¼Œä¼˜å…ˆä½¿ç”¨.browserslistrcï¼Œ // targets: // ie: 9, // chrome: 35, // , useBuiltIns: usage, // æŒ‰éœ€æ·»åŠ  corejs: 3 // ç‰ˆæœ¬ ], @babel/preset-react, @babel/preset-typescript ]å°†babelæ·»åŠ åˆ°webpacké…ç½®ä¸­ï¼šmodule.exports = module: rules:[ test: /.(ts|tsx)$/, // åŒ¹é…tsã€tsxæ–‡ä»¶ use:babel-loader ] å¤åˆ¶publicæ–‡ä»¶å¤¹publicæ–‡ä»¶å¤¹ä¸‹ä¸€èˆ¬æ”¾ä¸€äº›é™æ€èµ„æºï¼Œæ¯”å¦‚å›¾ç‰‡ã€å…¨å±€cssç­‰ï¼Œåœ¨devæ¨¡å¼ä¸‹ï¼Œå¯ä»¥é€šè¿‡æ‰˜ç®¡é…ç½®ï¼Œç›´æ¥é€šè¿‡ç»å¯¹è·¯å¾„è®¿é—®åˆ°publicæ–‡ä»¶ä¸‹çš„èµ„æºï¼šmodule.exports = merge(baseConfig, devServer: static: directory: path.join(__dirname, ../public) )ä½†åœ¨buildæ¨¡å¼ä¸‹ï¼Œéœ€è¦å°†publicæ–‡ä»¶å†…å®¹ç›´æ¥å¤åˆ¶åˆ°æ„å»ºå‡ºå£æ–‡ä»¶å¤¹ä¸­éœ€è¦ç”¨åˆ°copy-webpack-pluginæ’ä»¶ï¼šnpm i copy-webpack-plugin -Dåœ¨webpack.prod.jsä¸­è¿›è¡Œæ–‡ä»¶æºã€å¤åˆ¶ç›®æ ‡ã€è¿‡æ»¤å™¨ç­‰é…ç½®ï¼šconst path = require(path);const merge = require(webpack-merge)const baseConfig = require(./webpack.base)const CopyPlugin = require(copy-webpack-plugin)module.exports = merge(baseConfig, mode:production,// å¼€å¯ç”Ÿäº§ç¯å¢ƒ plugins:[ // å¤åˆ¶æ–‡ä»¶æ’ä»¶ new CopyPlugin( patterns:[ from: path.resolve(__dirname, ../public), to: path.resolve(__dirname, ../dist/public), filter: source = return !source.includes(index.html) ] ) ]) å¤„ç†å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨asset-moduleè¿›è¡Œå¤„ç†ï¼Œåœ¨webpack.base.jsä¸­è¿›è¡Œé…ç½®ï¼šmodule.exports = module: rules:[ // é…ç½®å›¾ç‰‡æ–‡ä»¶ test: /.(png|jpg|jpeg|gif|svg)$/, type: asset, parser: dataUrlCondition: // å°äº10kbï¼Œè½¬base64ä½ maxSize: 10 * 1024, , generator: filename:static/images/[name][ext] // æ–‡ä»¶è¾“å‡ºç›®å½•å’Œå‘½å ] å­—ä½“å’Œåª’ä½“æ–‡ä»¶å­—ä½“å’Œåª’ä½“æ–‡ä»¶ä¸å›¾ç‰‡çš„é…ç½®åŸºæœ¬ç›¸ä¼¼ï¼šmodule.exports = module: rules:[ test:/.(woff2?|eot|ttf|otf)$/, type:asset, parser: dataUrlCondition: maxSize: 10 * 1024, , generator: filename:static/fonts/[name][ext], , test:/.(mp4|webm|ogg|mp3|wav|flac|aac)$/, type:asset, parser: dataUrlCondition: maxSize: 10 * 1024, , generator: filename:static/media/[name][ext], , ] reactçƒ­æ›´æ–°ä½¿ç”¨webpackä¸­ï¼ŒdevServer.hotå¼€å¯çš„çƒ­æ›´æ–°æ–¹å¼æ˜¯ç›´æ¥åˆ·æ–°æµè§ˆå™¨ï¼Œå› æ­¤ä¼šå¯¼è‡´æ•°æ®çŠ¶æ€çš„ä¸¢å¤±ï¼Œè¦æƒ³ä¸åˆ·æ–°æµè§ˆå™¨ï¼Œè¿›è¡Œæ¨¡å—çƒ­æ›´æ–°ï¼Œå¯ä»¥å€ŸåŠ©æ’ä»¶ï¼š@pmmmwhreact-refresh-webpack-pluginreact-refreshnpm i @pmmmwh/react-refresh-webpack-plugin react-refresh -Dåœ¨webpack.dev.jsä¸­é…ç½®çƒ­æ›´æ–°æ’ä»¶ï¼šconst ReactRefreshWebpackPlugin = require(@pmmmwh/react-refresh-webpack-plugin)module.exports = merge(baseConfig, plugins:[ new ReactRefreshWebpackPlugin(), // æ·»åŠ çƒ­æ›´æ–°æ’ä»¶ ])éœ€è¦åœ¨babel.config.jsä¸­æ›´æ–°æ’ä»¶ï¼Œå¹¶ä¸”éœ€è¦å¯¹ç¯å¢ƒè¿›è¡Œåˆ¤æ–­ï¼Œå°½åœ¨å¼€å‘ç¯å¢ƒä¸‹å¼€å¯ï¼šconst isDEV = process.env.NODE_ENV === development;module.exports = plugins:[ isDEV require.resolve(react-refresh/babel), ].filter(Boolean), // è¿‡æ»¤ç©ºå€¼ ä¼˜åŒ–æ„å»ºé€Ÿåº¦æ„ä»¶è€—æ—¶åˆ†æéœ€è¦å€ŸåŠ©åˆ°ä¸€ä¸ªæ’ä»¶ï¼šnpm i speed-measure-webpack-plugin -Dæ„å»ºåˆ†æé…ç½®æ–‡ä»¶webpack.analy.jsï¼šconst prodConfig = require(./webpack.prod)const SpeedMeasurePlugin = require(speed-measure-webpack-plugin)const smp = new SpeedMeasurePlugin() // å®ä¾‹åŒ–åˆ†ææ’ä»¶const merge = require(webpack-merge)// åŠ å…¥ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œå’Œåˆ†æé…ç½®module.exports = smp.wrap(merge(prodConfig,))æ·»åŠ package.jsonè„šæœ¬å¹¶æ‰§è¡Œï¼š scripts: build:analy: cross-env NODE_ENV=production BASE_ENV=production webpack -c build/webpack.analy.js æ§åˆ¶å°è¾“å‡ºç»“æœï¼šPS D:\\webpack-react-ts npm run build:analyActive code page: 65001 webpack-react-ts@1.0.0 build:analy cross-env NODE_ENV=production BASE_ENV=production webpack -c build/webpack.analy.js(node:6120) [DEP_WEBPACK_COMPILATION_NORMAL_MODULE_LOADER_HOOK] DeprecationWarning: Compilation.hooks.normalModuleLoader was moved to NormalModule.getCompilationHooks(compilation).loader(Use `node --trace-deprecation ...` to show where the warning was created) SMP â± # æ€»è¿è¡Œæ—¶é—´General output time took 6.063 secs SMP â± Plugins # æ’ä»¶è¿è¡Œæ—¶é—´HtmlWebpackPlugin took 0.259 secsCopyPlugin took 0.189 secsDefinePlugin took 0.007 secs SMP â± Loaders # è§£æå™¨è¿è¡Œæ—¶é—´babel-loader took 1.52 secs module count = 2css-loader, andpostcss-loader, andless-loader took 1.27 secs module count = 1modules with no loaders took 0.885 secs module count = 156html-webpack-plugin took 0.014 secs module count = 1style-loader, andcss-loader, andpostcss-loader, andless-loader took 0.012 secs module count = 1assets by path static/ 195 KiB asset static/js/main.js 177 KiB [emitted] [minimized] (name: main) 1 related asset asset static/images/toby_dog.jpg 18.5 KiB [compared for emit] [from: src/assets/imgs/toby_dog.jpg] (auxiliary name: main)asset public/toby_dog.jpg 18.5 KiB [compared for emit] [from: public/toby_dog.jpg] [copied]asset index.html 314 bytes [compared for emit]runtime modules 1000 bytes 6 modulesorphan modules 5.59 KiB [orphan] 3 modulesmodules by path ./node_modules/core-js/internals/*.js 80.4 KiB 121 modulesmodules by path ./node_modules/core-js/modules/*.js 30 KiB 17 modulesmodules by path ./node_modules/style-loader/dist/runtime/*.js 5.84 KiB 6 modulesmodules by path ./src/ 6.37 KiB (javascript) 18.5 KiB (asset) 3 modulesmodules by path ./node_modules/react-dom/ 131 KiB 3 modulesmodules by path ./node_modules/react/ 6.95 KiB 2 modulesmodules by path ./node_modules/scheduler/ 4.33 KiB ./node_modules/scheduler/index.js 198 bytes [built] [code generated] ./node_modules/scheduler/cjs/scheduler.production.min.js 4.14 KiB [built] [code generated]modules by path ./node_modules/css-loader/dist/runtime/*.js 2.31 KiB ./node_modules/css-loader/dist/runtime/noSourceMaps.js 64 bytes [built] [code generated] ./node_modules/css-loader/dist/runtime/api.js 2.25 KiB [built] [code generated]webpack 5.94.0 compiled successfully in 6066 ms å¼€å¯æŒä¹…åŒ–å­˜å‚¨ç¼“å­˜webpack4ä¸­æ–‡ä»¶ç¼“å­˜ï¼šä½¿ç”¨babel-loaderç¼“å­˜jsè§£æç»“æœcache-loaderç¼“å­˜cssç­‰èµ„æºè§£æç»“æœæ¨¡å—ç¼“å­˜æ’ä»¶hard-source-webpack-pluginäºŒæ¬¡æ‰“åŒ…æ—¶ä¼šå¯¹æ–‡ä»¶åšå“ˆå¸Œå¯¹æ¯”éªŒè¯æ–‡ä»¶å‰åæ˜¯å¦ä¸€è‡´webpack5å¯¹ç¼“å­˜ç­–ç•¥è¿›è¡Œä¼˜åŒ–ï¼šå¢åŠ äº†æŒä¹…åŒ–ç¼“å­˜æ”¹è¿›äº†ç¼“å­˜ç®—æ³•åœ¨webpack.base.jsä¸­é…ç½®å¼€å¯ç¼“å­˜ç­–ç•¥module.exports = cache: type:filesystem, // ä½¿ç”¨æ–‡ä»¶ç¼“å­˜ ç¼“å­˜ä½ç½®ï¼šnode_modules.cachewebpack å¼€å¯å¤šçº¿ç¨‹loaderå¼€å¯å¤šçº¿ç¨‹loader å¼€å¯å¤šçº¿ç¨‹loaderå¯ä»¥å€ŸåŠ©å¤šæ ¸cpuå¼€å¯å¤šçº¿ç¨‹loaderè§£æï¼Œéœ€è¦å®‰è£…ä¾èµ–ï¼šnpm i thread-loader -Dä½¿ç”¨æ—¶ï¼Œéœ€è¦å°†thread-loaderæ”¾ç½®åœ¨å…¶ä»–loaderä¹‹å‰ï¼Œåœ¨å®ƒä¹‹åçš„loaderä¼šåœ¨ä¸€ä¸ªç‹¬ç«‹çš„workeræ± ä¸­è¿è¡Œå¼€å¯å¤šçº¿ç¨‹éœ€è¦å¯åŠ¨æ—¶é—´ï¼Œé€‚åˆè§„æ¨¡è¾ƒå¤§çš„é¡¹ç›® é…ç½®aliasåˆ«åé…ç½®åˆ«åå¯ä»¥é™ä½é¡¹ç›®å¼€å‘ä¸­èµ„æºå¼•ç”¨çš„å¤æ‚åº¦webpack.base.jsé…ç½®ï¼šmodule.exports = resolve: alias: @:path.join(__dirname, ../src) tsconfig.jsoné…ç½®ï¼š baseUrl: ., paths: @/*: [ src/* ] èµ„æºçš„è·¯å¾„è°ƒç”¨ï¼šimport logo from @/assets/imgs/logo.png ç¼©å°loaderä½œç”¨èŒƒå›´includeexclude å¯ä»¥é€šè¿‡2ä¸ªå±æ€§ï¼Œæ¥å¯¹loaderè§£æçš„èŒƒå›´è¿›è¡Œé™åˆ¶ï¼šinclude åªè§£ææ”¹é…ç½®çš„æ¨¡å—exclude ä¸è§£æçš„æ¨¡å— ç²¾ç¡®ä½¿ç”¨loaderloaderä¼šåœ¨webpackæ„å»ºæ¨¡å—ä¾èµ–å…³ç³»å¼•å…¥æ–°æ–‡ä»¶æ—¶æ‰§è¡Œï¼Œé€šè¿‡testå¯¹æ–‡ä»¶åç§°è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†ï¼Œå°±ä»å³å‘å·¦ä¾æ¬¡æ‰§è¡Œuseä¸­çš„loaderï¼Œå¯ä»¥æ›´ç²¾ç¡®çš„æ ¹æ®æ–‡ä»¶çš„åç¼€ï¼ŒåŒºåˆ†éœ€è¦æ‰§è¡Œçš„loaderï¼Œæ¯”å¦‚ï¼Œå¯ä»¥å°†csså’Œlessæ‹†åˆ†ï¼Œä»¥å‡å°‘cssæ”¶åˆ°less-loaderå¤„ç†çš„è¿™ä¸€æ­¥ï¼šmodule.exports = module: rules:[ // é…ç½®cssæ–‡ä»¶ include: [path.resolve(__dirname, ../src)], test: /\\.css$/, use:[style-loader, css-loader, postcss-loader] , // é…ç½®lessæ–‡ä»¶ include: [path.resolve(__dirname, ../src)], test: /\\.less$/, use:[style-loader, css-loader, postcss-loader, less-loader] , ] ç¼©å°æ¨¡å—æœç´¢èŒƒå›´Nodeä¸­å­˜åœ¨3ä¸­æ¨¡å—ï¼šnodeæ ¸å¿ƒæ¨¡å—node_modulesæ¨¡å—è‡ªå®šä¹‰æ–‡ä»¶æ¨¡å—åœ¨é¡¹ç›®ä¸­å¦‚æœæ²¡æœ‰æŒ‡å®šå‡†ç¡®çš„è·¯å¾„ï¼Œå¼•å…¥æ¨¡å—æ—¶ï¼ŒæŸ¥æ‰¾é¡ºåºå¦‚ä¸‹ï¼šä¼˜å…ˆæŸ¥è¯¢nodeæ ¸å¿ƒæ¨¡å—å½“å‰ç›®å½•ä¸‹node_modulesç¥–è¾ˆç›®å½•çš„node_modulesnodeå…¨å±€æ¨¡å—å¦‚æœæ˜¯è¿½æº¯åˆ°äº†nodeå…¨å±€æ¨¡å—çš„æƒ…å†µï¼Œå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„nodeå…¨å±€å¯èƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤è¦é¿å…è¿™ç§æƒ…å†µï¼Œå°†æŸ¥æ‰¾çš„èŒƒå›´å±€é™åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œåœ¨webpack.base.jsä¸­é…ç½®ï¼šmodule.exports = resolve: modules: [path.resolve(__dirname, ../node_modules)], devtoolé…ç½®å¼€å‘è°ƒè¯•æ—¶éœ€è¦çœ‹åˆ°æºä»£ç ï¼Œç”Ÿäº§æ¨¡å¼ä¸‹åˆ™æ˜¯ç¼–è¯‘åçš„ä»£ç ï¼Œè¿™å°±éœ€è¦SourceMapè¿›è¡Œè½¬æ¢ï¼Œdevtoolå°±æ˜¯ç”¨æ¥æ§åˆ¶SourceMapçš„ç”Ÿæˆçš„ï¼šwebpack.dev.jsmodule.exports = merge(baseConfig, devtool: eval-cheap-module-source-map, // æºç è°ƒè¯•ç»“æ„) ä¼˜åŒ–æ„å»ºç»“æœæ–‡ä»¶webpackåŒ…åˆ†æå·¥å…·webpack-bundle-analyzer éœ€è¦å€ŸåŠ©åº“ï¼šnpm install webpack-bundle-analyzer -Dåœ¨webpack.analy.jsä¸­åŠ å…¥æ’ä»¶ç›¸å…³çš„é…ç½®ï¼šconst BundleAnalyzerPlugin = require(webpack-bundle-analyzer)// åŠ å…¥ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œå’Œåˆ†æé…ç½®module.exports = smp.wrap(merge(prodConfig, plugins:[ new BundleAnalyzerPlugin() ])) æŠ½å–cssæ ·å¼æ–‡ä»¶cssæ–‡ä»¶åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹æœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ï¼šå¼€å‘ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨styleæ ‡ç­¾åµŒå…¥æ–¹ä¾¿çƒ­æ›´æ–°æ›¿æ¢ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå°†cssæ–‡ä»¶å•ç‹¬æ‰“åŒ…æ–¹ä¾¿ç¼“å­˜ç­–ç•¥è¿™é‡Œéœ€è¦ç”¨åˆ°æ’ä»¶ï¼šnpm i mini-css-extract-plugin -Dåœ¨å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨style-loaderï¼ŒæŠ½å–cssï¼Œwebpack.base.jsï¼šconst isDev = process.env.NODE_ENV === developmentconst MiniCssExtractPlugin = require(mini-css-extract-plugin);module.exports = module: rules:[ // é…ç½®cssæ–‡ä»¶ include: [path.resolve(__dirname, ../src)], test: /\\.css$/, use:[ // å¼€å‘ç¯å¢ƒä½¿ç”¨style-loaderï¼Œ æ‰“åŒ…æ¨¡å¼æŠ½å–css isDev?style-loader:MiniCssExtractPlugin.loader, css-loader, postcss-loader ] , // é…ç½®lessæ–‡ä»¶ include: [path.resolve(__dirname, ../src)], test: /\\.less$/, use:[ isDev?style-loader:MiniCssExtractPlugin.loader, css-loader, postcss-loader, less-loader ] ] æ‰“åŒ…æ—¶ï¼Œä½¿ç”¨MiniCssExtractPluginè¿›è¡ŒæŠ½ç¦»ï¼šconst MiniCssExtractPlugin = require(mini-css-extract-plugin);module.exports = merge(baseConfig, mode:production,// å¼€å¯ç”Ÿäº§ç¯å¢ƒ plugins:[ // æŠ½ç¦»cssæ’ä»¶ new MiniCssExtractPlugin( filename: static/css/[name].css ) ]) å‹ç¼©cssæ–‡ä»¶css-minimizer-webpack-plugin ä¸‹è½½csså‹ç¼©æ’ä»¶npm i css-minimizer-webpack-plugin -Dåœ¨webpack.prod.jsä¸­è¿›è¡Œé…ç½®ï¼šconst CssMinimizerPlugin = require(css-minimizer-webpack-plugin)module.exports = merge(baseConfig, optimization: minimizer:[ new CssMinimizerPlugin(), // å‹ç¼©css ] ) å‹ç¼©jsæ–‡ä»¶å®‰è£…terser-webpack-pluginæ’ä»¶ï¼šnpm i terser-webpack-plugin -Dä¿®æ”¹webpack.prod.jsé…ç½®const TerserPlugin = require(terser-webpack-plugin)module.exports = merge(baseConfig, optimization: minimizer:[ new TerserPlugin( // å‹ç¼©js parallel: true, // å¼€å¯å¤šçº¿ç¨‹å‹ç¼© terserOptions: compress: pure_funcs: [console.log] // åˆ é™¤console.log ) ] ) åˆç†é…ç½®æ‰“åŒ…æ–‡ä»¶hashhashæ˜¯æµè§ˆå™¨ç¼“å­˜ç­–ç•¥ä¸­é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œwebpackæä¾›ä¸‰ç§hashï¼šhashå…¨éƒ¨æ–‡ä»¶å…±ç”¨ç›¸åŒçš„hashå€¼é¡¹ç›®æ–‡ä»¶åªè¦ä¿®æ”¹ï¼Œé¡¹ç›®æ„å»ºçš„hashå€¼å°±ä¼šæ”¹å˜chunkhashå¯¹ä¸åŒçš„å…¥å£æ–‡ä»¶è¿›è¡Œä¾èµ–è§£æï¼Œæ„å»ºå¯¹åº”chunkï¼Œç”Ÿæˆç›¸åº”å“ˆå¸Œå€¼æ–‡ä»¶æœ¬èº«ä¿®æ”¹æˆ–è€…ä¾èµ–æ–‡ä»¶ä¿®æ”¹ï¼Œchunkhashä¼šå˜åŒ–contenthashæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„å“ˆå¸Œå€¼é…ç½®hashå€¼çš„æ ¼å¼å¦‚ä¸‹ï¼šfilename: [name].[chunkhash:8][ext]ext æ–‡ä»¶åç¼€name æ–‡ä»¶åpath æ–‡ä»¶ç›¸å¯¹è·¯å¾„folder æ–‡ä»¶å¤¹hash æ¯æ¬¡æ„å»ºç”Ÿæˆçš„å”¯ä¸€hashå€¼chunkhash æ ¹æ®chunkç”Ÿæˆhashå€¼contenthash æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆhashå€¼ä¸€èˆ¬ç”¨äºå›¾ç‰‡ã€cssç­‰èµ„æºæ–‡ä»¶çš„å“ˆå¸Œå€¼ç”Ÿæˆåœ¨webpack.base.jsä¸­å¯¹ç”Ÿæˆçš„æ–‡ä»¶åç§°è¿›è¡Œhashæ˜ å°„é…ç½®ï¼šmodule.exports = // å‡ºå£æ–‡ä»¶ output: filename: static/js/[name].[chunkhash:8].js, // æ¯ä¸ªè¾“å‡ºjsçš„åç§° , module: rules:[ // é…ç½®å›¾ç‰‡æ–‡ä»¶ test: /.(png|jpg|jpeg|gif|svg)$/, generator: filename:static/images/[name].[contenthash:8][ext] // æ–‡ä»¶è¾“å‡ºç›®å½•å’Œå‘½å , test:/.(woff2?|eot|ttf|otf)$/, generator: filename:static/fonts/[name].[contenthash:8][ext], , test:/.(mp4|webm|ogg|mp3|wav|flac|aac)$/, generator: filename:static/media/[name].[contenthash:8][ext], , ] åœ¨æ„å»ºæ¨¡å¼ä¸­ï¼Œå¯¹è¢«æŠ½ç¦»å‡ºæ¥cssæ–‡ä»¶ä¹Ÿè¿›è¡Œhashæ˜ å°„ï¼šmodule.exports = merge(baseConfig, plugins:[ new MiniCssExtractPlugin( filename: static/css/[name].[contenthash:8].css ) ]) ä»£ç åˆ†å‰²ç¬¬ä¸‰æ–¹åŒ…å’Œå…¬å…±æ¨¡å—node_modulesä¸­çš„ä»£ç å˜åŒ–é¢‘ç‡ä¸€èˆ¬æ¯”è¾ƒå°ï¼Œå¯ä»¥å•ç‹¬æ‰“åŒ…ï¼Œå¯¹åº”çš„chunkhashå€¼å¾ˆå°‘å˜åŒ–ã€‚åŒæ ·çš„ï¼Œè¿˜æœ‰ä¸€äº›å…¬å…±æ¨¡å—ï¼Œç”±äºå¾ˆå°‘å˜åŒ–ï¼Œä¹Ÿå¯ä»¥å•ç‹¬åˆ†å‰²å‡ºæ¥ã€‚è¿™éœ€è¦åœ¨webpack.prod.jsä¸­è¿›è¡Œé…ç½®ï¼šmodule.exports = merge(baseConfig, optimization: // åˆ†éš”ä»£ç  splitChunks: cacheGroups: vendors: // æå–node_modulesä»£ç  test: /node_modules/, // åªåŒ¹é…node_modulesä¸­çš„æ¨¡å— name: vendors, // æå–æ–‡ä»¶å‘½åä¸ºvendors, jsåç¼€å’Œchunkhashä¼šè‡ªåŠ¨åŠ  minChunks: 1, // åªè¦ä½¿ç”¨ä¸€æ¬¡å°±æå–å‡ºæ¥ chunks: initial, // åªæå–åˆå§‹åŒ–å°±èƒ½è·å–åˆ°çš„æ¨¡å—ï¼Œä¸ç®¡å¼‚æ­¥çš„ minSize: 0, // ç›®æ ‡ä»£ç ä½“ç§¯å¤§äº0å°±æå–å‡ºæ¥ priority: 1, // æå–ä¼˜å…ˆçº§ä¸º1 , commons: // æå–é¡µé¢å…¬å…±ä»£ç  name: commons, // æå–æ–‡ä»¶å‘½åä¸ºcommons minChunks: 2, // åªè¦ä½¿ç”¨ä¸¤æ¬¡å°±æå–å‡ºæ¥ chunks: initial, // åªæå–åˆå§‹åŒ–å°±èƒ½è·å–åˆ°çš„æ¨¡å—ï¼Œä¸ç®¡å¼‚æ­¥çš„ minSize:0, // ç›®æ ‡ä»£ç ä½“ç§¯å¤§äº0å°±æå–å‡ºæ¥ ) tree-shakingæ¸…ç†æœªä½¿ç”¨çš„jscsswebpackå†…ç½®tree-shakingï¼Œåœ¨è¿›è¡Œprodæ‰“åŒ…æ—¶å°†æ²¡æœ‰ä½¿ç”¨çš„jsæ¸…é™¤æ‰å¯¹äºæ²¡æœ‰ç”¨åˆ°çš„cssçš„æ¸…ç†ï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£…åº“ï¼špurgecss-webpack-pluginglob-all é€‰æ‹©è¦æ£€æµ‹é‚£äº›æ–‡ä»¶é‡Œé¢çš„ç±»å‹ã€idè¿˜æœ‰æ ‡ç­¾åç§°npm i purgecss-webpack-plugin glob-all -Dåœ¨webpack.prod.jsä¸­è¿›è¡Œé…ç½®const PurgeCSSPlugin = require(purgecss-webpack-plugin)const globAll = require(glob-all)module.exports = merge(baseConfig, plugins:[ // æ¸…ç†æ— ç”¨css new PurgeCSSPlugin( // æ£€æµ‹srcä¸‹æ‰€æœ‰tsxæ–‡ä»¶å’Œpublicä¸‹index.htmlä¸­ä½¿ç”¨åˆ°çš„ç±»åã€idã€æ ‡ç­¾ //åªæ‰“åŒ…è¿™äº›æ–‡ä»¶ä¸­ç”¨åˆ°çš„æ ·å¼ paths: globAll.sync([ `$path.join(__dirname,../src)/**/*.tsx`, path.join(__dirname,../public/index.html) ]), // è‡ªå®šä¹‰ç™½åå• safelist: standard:[/^ant-/], // è¿‡æ»¤ä»¥ant-å¼€å¤´çš„ç±»å ) ]) èµ„æºæ‡’åŠ è½½reactæä¾›æ‡’åŠ è½½ç»„ä»¶ï¼Œwebpacké»˜è®¤æ”¯æŒèµ„æºæ‡’åŠ è½½ï¼Œèµ„æºåœ¨éœ€è¦ä½¿ç”¨çš„æ—¶å€™è¿›è¡ŒåŠ¨æ€åŠ è½½ç»„ä»¶çš„æ‡’åŠ è½½ï¼šimport React, lazy, Suspense, useState from react;const LazyDemo = lazy(()=import(@/components/LazyDemo))function App() return ( Suspense fallback=nullLazyDemo//Suspense / ) èµ„æºé¢„åŠ è½½å…³äºlinkæ ‡ç­¾çš„refå±æ€§ï¼špreload èµ„æºå¿…è¦ï¼Œæµè§ˆå™¨ä¸€å®šä¼šåŠ è½½prefetchèµ„æºå¯èƒ½éœ€è¦ï¼Œæµè§ˆå™¨ç©ºé—²æ—¶åŠ è½½webpackä¸­æ”¯æŒåœ¨importæ—¶ï¼Œä½¿ç”¨æ³¨é‡Šè¿›è¡Œé¢„è·å–é¢„åŠ è½½é…ç½®ï¼š// å•ä¸ªç›®æ ‡import( /* webpackChunkName: my-chunk-name */ // èµ„æºæ‰“åŒ…åçš„æ–‡ä»¶chunkname /* webpackPrefetch: true */ // å¼€å¯prefetché¢„è·å– /* webpackPreload: true */ // å¼€å¯preloadé¢„åŠ è½½ ./module ) æ‰“åŒ…æ—¶ç”Ÿæˆgzipæ–‡ä»¶nginxå¯ä»¥é€šè¿‡é…ç½®gzip:onå¼€å¯å‹ç¼©ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æœåŠ¡å™¨çš„èµ„æºï¼Œå› æ­¤å¯ä»¥åœ¨å‰ç«¯æ„å»ºç”Ÿäº§é¡¹ç›®æ—¶ï¼Œå°±å¯¹å†…å®¹è¿›è¡Œgzipå‹ç¼©ã€‚éœ€è¦ç”¨åˆ°æ’ä»¶ï¼šnpm i compression-webpack-plugin -Dåœ¨webpack.prod.jsä¸­æ·»åŠ é…ç½®ï¼šconst CompressionPlugin = require(compression-webpack-plugin);module.exports = merge(baseCofig, plugins:[ // æ‰“åŒ…å‹ç¼©é…ç½® new CompressionPlugin( test: /.(js|css)$/, // åªç”Ÿæˆcssã€jsçš„å‹ç¼©æ–‡ä»¶ filename:[path][base].gz, // æ–‡ä»¶å‘½å algorithm: gzip, // å‹ç¼©æ ¼å¼ threshold: 10240, // æœ€å°å‹ç¼©å°ºå¯¸ minRatio: 0.8, // å‹ç¼©ç‡ ) ]) React + Ts é¡¹ç›®å¼€å‘ä»£ç è§„èŒƒå‚è€ƒåšå®¢ editorconfigç»Ÿä¸€ç¼–è¾‘å™¨é…ç½®åœ¨VSCodeç¼–è¾‘å™¨é‡Œï¼Œæ·»åŠ editorconfigéœ€è¦å®‰è£…EditorConfig for VSCodeæ’ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•é‡Œæ·»åŠ .editorconfigé…ç½®æ–‡ä»¶ï¼šroot = true # æ§åˆ¶é…ç½®æ–‡ä»¶ .editorconfig æ˜¯å¦ç”Ÿæ•ˆçš„å­—æ®µ[**] # åŒ¹é…å…¨éƒ¨æ–‡ä»¶indent_style = space # ç¼©è¿›é£æ ¼ï¼Œå¯é€‰spaceï½œtabindent_size = 2 # ç¼©è¿›çš„ç©ºæ ¼æ•°charset = utf-8 # è®¾ç½®å­—ç¬¦é›†trim_trailing_whitespace = true # åˆ é™¤ä¸€è¡Œä¸­çš„å‰åç©ºæ ¼insert_final_newline = true # è®¾ä¸ºtrueè¡¨ç¤ºä½¿æ–‡ä»¶ä»¥ä¸€ä¸ªç©ºç™½è¡Œç»“å°¾end_of_line = lf[**.md] # åŒ¹é…mdæ–‡ä»¶trim_trailing_whitespace = falseeditorconfigä¸€èˆ¬ç”¨äºè§„èŒƒé¡¹ç›®ä¸­çš„ç¼©è¿›é£æ ¼ Prettieråœ¨IDEæ’ä»¶ä¸­å®‰è£…Prettieråœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ·»åŠ .prettierrc.jsé…ç½®æ–‡ä»¶ï¼Œç”¨äºå¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–å¤„ç†module.exports = printWidth: 100, // ä¸€è¡Œçš„å­—ç¬¦æ•°ï¼Œå¦‚æœè¶…è¿‡ä¼šè¿›è¡Œæ¢è¡Œ tabWidth: 2, // ä¸€ä¸ªtabä»£è¡¨å‡ ä¸ªç©ºæ ¼æ•°ï¼Œé»˜è®¤å°±æ˜¯2 useTabs: false, // æ˜¯å¦å¯ç”¨tabå–ä»£ç©ºæ ¼ç¬¦ç¼©è¿›ï¼Œ.editorconfigè®¾ç½®ç©ºæ ¼ç¼©è¿›ï¼Œæ‰€ä»¥è®¾ç½®ä¸ºfalse semi: false, // è¡Œå°¾æ˜¯å¦ä½¿ç”¨åˆ†å·ï¼Œé»˜è®¤ä¸ºtrue singleQuote: true, // å­—ç¬¦ä¸²æ˜¯å¦ä½¿ç”¨å•å¼•å· trailingComma: none, // å¯¹è±¡æˆ–æ•°ç»„æœ«å°¾æ˜¯å¦æ·»åŠ é€—å· none| es5| all jsxSingleQuote: true, // åœ¨jsxé‡Œæ˜¯å¦ä½¿ç”¨å•å¼•å·ï¼Œä½ çœ‹ç€åŠ bracketSpacing: true, // å¯¹è±¡å¤§æ‹¬å·ç›´æ¥æ˜¯å¦æœ‰ç©ºæ ¼ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ•ˆæœï¼š foo: bar arrowParens: avoid, // ç®­å¤´å‡½æ•°å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°åˆ™çœç•¥æ‹¬å·åœ¨webstormä¸­ï¼Œéœ€è¦é¦–å…ˆå®‰è£…prettieråŒ…ï¼šnpm install --save-dev --save-exact prettieråœ¨è®¾ç½®prettierä¸­ï¼Œå°†prettieræŒ‡å‘æœ¬åœ°npmåŒ…é‡Œçš„prettierï¼Œå¼€å¯run on saveï¼Œè¿™æ ·åœ¨ä¿å­˜é¡¹ç›®æ—¶å°±ä¼šè‡ªåŠ¨æ‰§è¡Œprettieræ ¼å¼åŒ–ä»£ç  eslint + lint-stagedç›‘æµ‹ä»£ç é¡¹ç›®å®‰è£…eslintä¾èµ–npm i eslint -Dé…ç½®.eslintrc.jsæ–‡ä»¶ï¼Œä½¿ç”¨å¿«æ·å‘½ä»¤ï¼šnpm init @eslint/configæ ¹æ®æ§åˆ¶å°é—®é¢˜çš„å›ç­”æƒ…å†µï¼Œæœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ªeslint.config.jsæ–‡ä»¶ï¼šimport globals from globals;import pluginJs from @eslint/js;import tseslint from typescript-eslint;import pluginReact from eslint-plugin-react;export default [ files: [**/*.js,mjs,cjs,ts,jsx,tsx], languageOptions: globals: globals.browser , pluginJs.configs.recommended, ...tseslint.configs.recommended, pluginReact.configs.flat.recommended,];","tags":["Web"]},{"title":"NestJs","path":"/2024/07/01/NestJs/","content":"å®˜æ–¹åŸºç¡€è¯¾ç¨‹ï¼ˆå¿«é€Ÿä½“éªŒï¼‰å¿«é€Ÿåˆ›å»ºnesté¡¹ç›®å…¨å±€å®‰è£…nestnpm i -g nestå¿«é€Ÿåˆ›å»ºnesté¡¹ç›®nest newåˆ›å»ºå‡ºæ¥ç›®å½•ç»“æ„ï¼šmain.js ä¸»å…¥å£app.module.ts åˆ›å»ºçš„æ§åˆ¶å™¨ä¼šè¢«controllersé›†æˆapp.service.tsapp.controller.tsç”Ÿæˆcontrollernest generate controller controllerNamenest g co controllerNamenuxtå¼€å‘æ—¶çƒ­æ›´æ–°å‘½ä»¤ï¼šnpm run start:dev æ§åˆ¶å™¨ Controller@Controllerå®šä¹‰æ˜ å°„å™¨ç±»coffee@Controller(coffee)export class CoffeeController // æ§åˆ¶å™¨çš„å†…éƒ¨å®ç°@Getcoffeeflavors@Controller(coffee)export class CoffeeController // è·¯å¾„æ˜ å°„ @Get(flavors) findAll() return You find all coffees @Paramcoffee123456@Controller(coffee)export class CoffeeController // å¸¦å‚æ•°æ˜ å°„ @Get(:id) // findOne(@Param() params) // è·å–æ‰€æœ‰paramså‚æ•° findOne(@Param(id) id: string) // è·å–æŒ‡å®šparanå‚æ•° return `get #$id coffee` @Post@Body@HttpCodecoffeecreate@Controller(coffee)export class CoffeeController // postè¯·æ±‚ @Post() @HttpCode(HttpStatus.BAD_GATEWAY) // è‡ªå®šä¹‰çŠ¶æ€ç  // Bodyå‚æ•° // create(@Body() body) // è·å–ç‰¹å®šçš„å±æ€§ create(@Body(message) body) return body; @Rescoffeeyummy@Controller(coffee)export class CoffeeController // ç›´æ¥è°ƒç”¨expressåº“æ–¹æ³• @Get(candy) yummy(@Res() response) response.status(200).send(yummy candy) @Patchæ›´æ–°æ•°æ®coffee1234@Controller(coffee)export class CoffeeController // patch æ›´æ–° @Patch(:id) update(@Param(id) id: string, @Body() body) return message:`This action updates #$id coffee`, data:body @Deleteåˆ é™¤æ•°æ®coffee1234@Controller(coffee)export class CoffeeController @Delete(:id) remove(@Param(id) id:string) return `delete #$id` æœåŠ¡ Service|Provideråˆ›å»ºService nest generate servicenest g sserviceä¼šè¢«åˆ›å»ºåœ¨srcå¯¹åº”è·¯å¾„ä¸‹ï¼ŒåŒæ—¶æ›´æ–°åœ¨app.modules.tsä¸‹çš„providersæ•°ç»„ä¸­æ¯ä¸ªServiceéƒ½æ˜¯ä¸€ä¸ªproviderï¼Œproviderå†…å¯ä»¥æ³¨å…¥ä¾èµ–providerå¯ä»¥ä½œä¸ºä¾èµ–è¢«æ³¨å…¥åˆ°controllerä¸­serviceè´Ÿè´£å¤„ç†æ•°æ®å­˜å‚¨ã€æ£€ç´¢ç­‰å·¥ä½œï¼Œä¸ºcontrolleræä¾›æ•°æ®ã€‚ entity åˆ›å»ºå®ä½“ï¼Œä½œä¸ºserviceæ§åˆ¶çš„å¯¹è±¡ï¼šnestä¸­å°†controllerå’Œserviceé›†æˆåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œentityå®ä½“ä¹Ÿåˆ›å»ºåœ¨æ­¤ç›®å½•ä¸‹ã€‚srccoffeeentitiescoffee.entity.tsexport class Coffee id: number; name: string; brand: string; flavors: string[]; Controller+Serviceå®ç°CRUD import Injectable from @nestjs/common;import Coffee from ./entities/coffee.entity;// @Injectableæ ‡è¯†è¡¨ç¤ºservice@Injectable()export class CoffeeService private coffees: Coffee[] = [ id: 1, name: Shipwreck Roast, brand: Buddy Brew, flavors: [chocolate, vanilla], , ]; /** * æŸ¥æ‰¾å…¨éƒ¨ */ findAll()return this.coffees /** * æ ¹æ®idè¿”å›æŒ‡å®šå€¼ * @param id */ findOne(id:string) return this.coffees.find(item=item.id === +id) /** * æ–°å»º * @param createCoffeeDto */ create(createCoffeeDto: any) this.coffees.push(createCoffeeDto); return this.coffees /** * æ›´æ–° * @param id * @param updateCoffeeDto */ update(id: string,updateCoffeeDto: any) const existingCoffee = this.findOne(id) if(existingCoffee) // update this entoty Object.assign(existingCoffee, updateCoffeeDto) return existingCoffee return cant find /** * * @param id åˆ é™¤ */ remove(id:string) const coffeeIndex = this.coffees.findIndex(item=item.id == + id) if(coffeeIndex = 0) this.coffees.splice(coffeeIndex,1) åœ¨controllerä¸­é€šè¿‡æ„é€ å‡½æ•°ï¼Œæ³¨å…¥serviceï¼š@Controller(coffee)export class CoffeeController // service/provideræ³¨å…¥ constructor(private readonly coffeeService) // æŸ¥è¯¢æ‰€æœ‰ @Get(findAll) findAll() return this.coffeeService.findAll() // æŒ‡å®šæŸ¥è¯¢ @Get(:id) // findOne(@Param() params) // è·å–æ‰€æœ‰paramså‚æ•° findOne(@Param(id) id: string) return this.coffeeService.findOne(id) // æ–°å¢ @Post() create(@Body() body) return this.coffeeService.create(body); // æ›´æ–° @Patch(:id) update(@Param(id) id: string, @Body() body) return this.coffeeService.update(id,body) // åˆ é™¤ @Delete(:id) remove(@Param(id) id:string) return this.coffeeService.remove(id) a hrefhttps://docs.nestjs.cn/10/exceptionfilters?id=%e5%9f%ba%e7%a1%80%e5%bc%82%e5%b8%b8%e7%b1%bbå¼‚å¸¸è¿‡æ»¤å™¨ @Injectable()export class CoffeeService findOne(id: string) const coffee = this.coffees.find(item = item.id === +id) if (!coffee) // æŠ›å‡ºå¯¹åº”ç½‘ç»œå¼‚å¸¸ // throw new HttpException(`Coffee #$id not found`, HttpStatus.NOT_FOUND) throw new NotFoundException(`Coffee #$id not found`) return coffee æ¨¡å— Modulemodule é›†æˆmodulenest g module moduleNameåœ¨app.modules.tsæ¨ªçºµçš„importså†…ä¼šè‡ªåŠ¨å¼•å…¥æ–°åˆ›å»ºçš„Moduleä½¿ç”¨moduleå°†controllerså’Œprovidersé›†æˆåœ¨ä¸€èµ·ï¼šimport Module from @nestjs/common;import CoffeeController from ./coffee.controller;import CoffeeService from ./coffee.service;@Module( controllers:[CoffeeController], providers:[CoffeeService] )export class CoffeeModule å°†app.module.tsçš„ä»£ç æ¸…ç†ä¸€ä¸‹ï¼Œä¿è¯controllerå’Œserviceä»…è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼šimport Module from @nestjs/common;import AppController from ./app.controller;import AppService from ./app.service;import CoffeeModule from ./coffee/coffee.module;@Module( imports: [CoffeeModule], controllers: [AppController], providers: [AppService],)export class AppModule DTOdata transfer objectç”¨äºå°è£…è§„èŒƒæ¥å£ä¼ è¾“çš„æ•°æ®ç±»å‹ç”ŸæˆDTOnest g class classNamenest g class coffee/dto/create-coffee.dto --no-specdtoçš„å®šä¹‰ï¼šcreate-coffee.dto.tsexport class CreateCoffeeDto readonly name: string; readonly brand: string; readonly flavors: string[];dtoçš„ä½¿ç”¨ï¼šcoffee.controller.ts@Controller(coffee)export class CoffeeController constructor(private readonly coffeeService: CoffeeService) @Post() create(@Body() createCoffeeDto:CreateCoffeeDto) return this.coffeeService.create(createCoffeeDto) æ•°æ®éªŒè¯ æ•°æ®éªŒè¯è¦ç”¨åˆ°ValidationPipeéœ€è¦ä¸‹è½½å¦‚ä¸‹åŒ…ï¼šnpm i class-validator class-transformer @nestjs/mapped-typesåœ¨main.tsä¸­åŠ å…¥pipewhitelist ç™½åå•æ¨¡å¼forbidNonWhitelisted éç™½åå•æ•°æ®æŠ¥é”™transform å°†ä¼ å…¥æ•°æ®è½¬åŒ–ä¸ºæŒ‡å®šçš„æ•°æ®ç±»å‹import NestFactory from @nestjs/core;import AppModule from ./app.module;import ValidationPipe from @nestjs/common;async function bootstrap() const app = await NestFactory.create(AppModule); app.useGlobalPipes(new ValidationPipe( whitelist:true, forbidNonWhitelisted: false, transform: true, )) // é…ç½®éªŒè¯ç®¡é“ await app.listen(3000);bootstrap();åœ¨DTOä¸­åŠ å…¥æ•°æ®éªŒè¯æè¿°ç¬¦ï¼š// create-coffee.dto.tsimport IsString from class-validatorexport class CreateCoffeeDto @IsString() readonly name: string; @IsString() readonly brand: string; @IsString(each:true) readonly flavors: string[];ä½¿ç”¨mapped-typesåŒ…ï¼Œå®ç°æ•°æ®éªŒè¯çš„ç»§æ‰¿ä¸é™„åŠ å±æ€§é…ç½®ï¼šimport PartialType from @nestjs/mapped-typesimport CreateCoffeeDto from ../create-coffee.dto/create-coffee.dto;// PartialTypeç”¨äºç»™å°†æ¯ä¸ªå±æ€§å˜ä¸ºå¯é€‰å€¼ @IsOptional()// åŒæ—¶ç»§æ‰¿è£…é¥°å™¨ç±»å‹export class UpdateCoffeeDto extends PartialType(CreateCoffeeDto) Dockeræ ¹ç›®å½•ä¸‹é…ç½®docker-compose.ymlæ–‡ä»¶ï¼šversion: 3services: db: image: postgres restart: always ports: - 5432:5432 environment: POSTGRES_PASSWORD: ashley122 å¯åŠ¨é•œåƒï¼šdocker-compose up -ddockeræ‹‰å–é•œåƒåœ°å€ registry-mirrors: [https://dockerhub.icu] ORMå®‰è£…ormç›¸å…³åŒ…ï¼š@nestjstypeorm typeormpg postgresç›¸å…³åŒ…npm i @nestjs/typeorm typeorm pgapp.module.tsä¸­å¼•å…¥TypeOrmModuleï¼šimport TypeOrmModule from @nestjs/typeorm;@Module( imports: [ CoffeeModule, CakeModule, TypeOrmModule.forRoot( type: postgres, host: localhost, port: 5432, username:postgres, password:ashley122, database:postgres, autoLoadEntities:true, // ä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸­å°½é‡å…³é—­ synchronize:true, // å®ä½“ä¸æ•°æ®åº“åŒæ­¥ ) ], controllers: [AppController], providers: [AppService],)å°†ä¹‹å‰ä»…ä½œä¸ºæ¥å£ç±»å‹çº¦æŸçš„entitiesä¸‹çš„å®ä½“å®šä¹‰æ–‡ä»¶ï¼Œè¿›è¡ŒORMæ¨¡å‹åŒ–ï¼šimport Entity, PrimaryGeneratedColumn, Column from typeorm// å®ä½“ç±»æè¿°ç¬¦@Entity(cake)export class Cake // ä¸»é”®æè¿°ç¬¦ @PrimaryGeneratedColumn() id: number; @Column() name: string; @Column() price: number; // å¯ç©ºæè¿° @Column(json, nullable:true) flavors: string[];åœ¨cakeå­æ¨¡å—ä¸­æ³¨å†Œå†…éƒ¨å®ç°çš„å®ä½“ï¼š@Module( // æ¯ä¸ªå­æ¨¡å—ä¸ºè‡ªå·±æ³¨å†Œå®ä½“ imports:[TypeOrmModule.forFeature([Cake])], controllers:[CakeController], providers:[CakeService])export class CakeModule repository åˆ›å»ºå¥½Entityä¹‹åï¼ŒORMæ¨¡å‹ä¼šè‡ªåŠ¨æ˜ å°„æˆä¸ºæ•°æ®åº“è¡¨ï¼Œåœ¨serviceä¸­ä½œä¸ºæ•°æ®åº“è¿›è¡Œå…³è”ï¼š@Injectable()export class CakeService // å…³è”æ•°æ®åº“ constructor( // æ•°æ®åº“æ³¨å…¥ @InjectRepository(Cake) private readonly cakeRepository: RepositoryCake ) å°†ä¹‹å‰çš„CURDæ“ä½œå¯¹è±¡è¿ç§»åˆ°æ•°æ®åº“ä¸Šï¼šæŸ¥è¯¢find æŸ¥è¯¢æ‰€æœ‰findOne æŸ¥è¯¢æŒ‡å®š/** * æŸ¥æ‰¾å…¨éƒ¨ */findAll() return this.cakeRepository.find()/** * æŸ¥æ‰¾æŒ‡å®šè›‹ç³• */async findOne(id:number) const cake = await this.cakeRepository.findOne( where: id:id ) // let cake = this.cakes.find(item=item.id == id) if(!cake) throw new NotFoundException(`Cake #$id is not find`) return cakeæ–°å¢create åˆ›å»ºsave ä¿å­˜/** * æ–°å¢è›‹ç³• * @param cake */async create(createCakeDto: CreateCakeDto) const cake = this.cakeRepository.create(createCakeDto) return this.cakeRepository.save(cake)æ›´æ–°preload/** * ä¿®æ”¹è›‹ç³• * @param id * @param cake */async update(id:number, updateCoffeeDto:UpdateCakeDto) // preload æ›´æ–° æ‰¾ä¸åˆ°æŒ‡å®šidè¿”å›undefined const cake = await this.cakeRepository.preload( id:id, ...updateCoffeeDto ) if(!cake) throw new NotFoundException(`Cake #$id is not exit`) return this.cakeRepository.save(cake)åˆ é™¤remove/** * åˆ é™¤è›‹ç³• * @param cake */async delete(id: number) const cake = await this.findOne(id) return this.cakeRepository.remove(cake) Relationè¡¨é—´å…³è”ç±»å‹ï¼š@OneToOne()@OneToMany()@ManyToOne()@ManyToMany()å…³è”æ“ä½œï¼šåˆ›å»ºå…³ç³»åˆ›å»ºä¸€ä¸ªæ–°çš„Entityï¼šFlavorsï¼Œè¡¨ç¤ºé£å‘³nest g class cake/entities/flavor.entity --no-spec æ–°è¡¨åŠ å…¥æ¨¡å—å®šä¹‰ä¸­@Module( imports:[TypeOrmModule.forFeature([Cake,Flavor])] )ä½¿ç”¨æè¿°ç¬¦å¯¹cake.flavorsè¿›è¡Œå…³è”ï¼š@JoinTable() æ ‡è¯†å…³è”å±æ€§æ‰€æœ‰è€…@JoinTable()@ManyToMany( type = Flavor, // å…³è”è¡¨ç±»å‹ flavor = flavor.cakes, // åå‘æ”¶é›† cascade:true // çº§è”å…³ç³»)flavors: Flavor[];åœ¨è¢«å…³è”è¡¨ä¸­è¿›è¡Œå…³è”é…ç½®ï¼š@Entity()export class Flavor @PrimaryGeneratedColumn() id: number; @Column() name: string; @ManyToMany( type = Cake, cake = cake.flavors ) cakes: Cake[]å…³è”æŸ¥è¯¢ï¼šfindAll() return this.cakeRepository.find( relations: [flavors], // é…ç½®æ”¶é›†flavors )async findOne(id:number) const cake = await this.cakeRepository.findOne( where: id:id , relations:[flavors] ) if(!cake) throw new NotFoundException(`Cake #$id is not find`) return cakeçº§è”æ’å…¥cakeä½œä¸ºå…³ç³»æ‹¥æœ‰è¡¨ï¼Œå½“ç”¨æ–°çš„flavoråˆ›å»ºæ–°çš„cakeæ—¶ï¼Œæ–°çš„flavoræ•°æ®ä¹Ÿä¼šè¢«çº§è”åˆ›å»º/** * è·å–/æ–°å¢flavor * @param name * @returns */private async preloadFlavorByName(name: string): PromiseFlavor const existingFlavor = await this.flavorRepository.findOne( where:name:name ) if(existingFlavor) return existingFlavor return this.flavorRepository.create(name)/** * æ–°å¢è›‹ç³• * @param cake */async create(createCakeDto: CreateCakeDto) const flavors = await Promise.all( createCakeDto.flavors.map(name=this.preloadFlavorByName(name)) ) const cake = this.cakeRepository.create( ...createCakeDto, flavors ) return this.cakeRepository.save(cake)/** * ä¿®æ”¹è›‹ç³• * @param id * @param cake */async update(id:number, updateCoffeeDto:UpdateCakeDto) const flavors = updateCoffeeDto.flavors (await Promise.all( updateCoffeeDto.flavors.map(name=this.preloadFlavorByName(name)) )) // preload æ›´æ–° æ‰¾ä¸åˆ°æŒ‡å®šidè¿”å›undefined const cake = await this.cakeRepository.preload( id:id, ...updateCoffeeDto, flavors ) if(!cake) throw new NotFoundException(`Cake #$id is not exit`) return this.cakeRepository.save(cake) PaginationQueryDtoåˆ†é¡µæŸ¥è¯¢ ä¸ºåˆ†é¡µæŸ¥è¯¢å‚æ•°åˆ›å»ºdtonest g class common/dto/pagination-query.dto --no-specimport IsOptional, IsPositive from class-validator;import Type from class-transformer;export class PaginationQueryDto @IsOptional() @IsPositive() // æ­£æ•° // @Type(()=Number) // å¼ºåˆ¶è½¬æ¢ä¸ºNumberç±»å‹ limit: number; @IsOptional() @IsPositive() // @Type(()=Number) offset: number;å¯ä»¥åœ¨ValidationPipeä¸­ï¼Œé…ç½®å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šapp.useGlobalPipes(new ValidationPipe(// ... transformOptions: enableImplicitConversion: true )) ä¿®æ”¹controllerå’Œserviceä¸­æŸ¥è¯¢é…ç½®// æŸ¥è¯¢æ‰€æœ‰è›‹ç³•@Get(getMenu)getMenu(@Query() paginationQueryDto:PaginationQueryDto) return this.cakeService.findAll(paginationQueryDto)/** * æŸ¥æ‰¾å…¨éƒ¨ */findAll(paginationQueryDto: PaginationQueryDto) const limit, offset = paginationQueryDto return this.cakeRepository.find( relations: [flavors], // é…ç½®æ”¶é›†flavors skip: offset, // é¡µæ•° take: limit, // é¡µå¤§å° ) Transaction äº‹åŠ¡äº‹åŠ¡ï¼šä¸€ç»„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œä½¿ç”¨äº‹åŠ¡æ§åˆ¶ï¼Œåœ¨serviceä¸­å£°æ˜typeorm.DataSourceç±»å±æ€§ï¼š// å…³è”æ•°æ®åº“constructor( //... private readonly connection: DataSource,)ä½¿ç”¨QueryRunnerå’Œtrycatchfinallyè¿›è¡Œäº‹åŠ¡å¤„ç†ï¼š// æ¨èè›‹ç³•async recommendCake(cake: Cake) const queryRunner = this.connection.createQueryRunner(); await queryRunner.connect(); await queryRunner.startTransaction(); try cake.recommendations++ this.cakeRepository.preload(cake) this.cakeRepository.save(cake) const recommendEvent = new Event() recommendEvent.name = recommend_cake recommendEvent.type = cake recommendEvent.payload = cakeId: cake.id await queryRunner.commitTransaction() catch(err) // å›æ»šäº‹åŠ¡ await queryRunner.rollbackTransaction() finally await queryRunner.release() return cake æ•°æ®åº“è¿ç§»è¿ç§»æŠ¥é”™è§£å†³æ–¹æ³•é¦–å…ˆéœ€è¦åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºormconfig.tsæ–‡ä»¶ï¼šimport DataSource from typeorm;export const connectionSource = new DataSource( // migrationsTableName: migrations, type: postgres, host: localhost, port: 5432, username: postgres, password: ashley122, database: postgres, entities: [dist/**/*.entity.js], migrations: [dist/migrations/*.js], subscribers:[src/subscriber/**/*.ts]); create åˆ›å»ºè¿ç§»è„šæœ¬ï¼šnpx typeorm migration:create ./src/migrations/CoffeeRefactor generate ç”Ÿæˆè¿ç§»è„šæœ¬npx typeorm migration:generate ./src/migrations/CoffeeRefactor -d ./dist/ormconfig.jsrun è¿è¡Œè¿ç§»è„šæœ¬npx typeorm migration:run -d ./dist/ormconfig.jsrevert æ¢å¤npx typeorm migration:revert -d ./dist/ormconfig.jså¯¹è¦ä¿®æ”¹çš„è¡¨å¯¹åº”çš„ORMè¿›è¡Œä¿®æ”¹ï¼Œå†åœ¨ç”Ÿæˆçš„è¿ç§»æ–‡ä»¶ä¸­è¿›è¡Œè¡¨æ“ä½œï¼š// å®ä½“ç±»æè¿°ç¬¦@Entity(cake)export class Cake // ... // å°†nameè¡¨æ®µé‡å‘½åä¸ºlabel @Column() label: string;import MigrationInterface, QueryRunner from typeorm;export class CakeRefactor1720149725474 implements MigrationInterface public async up(queryRunner: QueryRunner): Promisevoid await queryRunner.query( `ALERT TABLE cake RENAME COLUMN name TO label` ) public async down(queryRunner: QueryRunner): Promisevoid await queryRunner.query( `ALERT TABLE cake RENAME COLUMN label TO name` ) ä¾èµ–æ³¨å…¥ Dependency Injectionåº”ç”¨é…ç½® Application ConfigurationNextå…¶å®ƒåŠŸèƒ½æ¨¡å—Exception Filters å¼‚å¸¸è¿‡æ»¤å™¨Exception Filtersç”¨äºå¤„ç†åº”ç”¨ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ Pipes ç®¡é“Pipesç”¨äºå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡ŒéªŒè¯è½¬æ¢ Guards å®ˆå«Guardsç”¨äºå¯¹è®¿é—®çš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ Interceptors æ‹¦æˆªå™¨Interceptorsç”¨äºåœ¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹å‰è¿›è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œ","tags":["Web"]},{"title":"HarmonyOS ArkTS å¼€å‘ä½“éªŒ","path":"/2024/06/28/ArkTs/","content":"DevEco StudioDevEco Studio æŒ‡å®šç¼–è¯‘å™¨ï¼ŒJetBrainsé£æ ¼ç•Œé¢ï¼Œå¯¹äºWebStormç”¨æƒ¯çš„Webå¼€å‘è€…éå¸¸ç†Ÿæ‚‰ã€‚ä½¿ç”¨æŒ‡å—å½“å‰é—®é¢˜æ’ä»¶æ¯”è¾ƒå°‘ç‰ˆæœ¬æ··ä¹±æ–‡æ¡£ç‰ˆæœ¬å’ŒSDKç‰ˆæœ¬ç›¸å…³ï¼Œå®˜æ–¹æ¨èçš„NEXTæ–‡æ¡£ä¸»è¦é’ˆå¯¹APIï¼ˆ9-11ï¼‰SDKç‰ˆæœ¬å’ŒDevEcoç‰ˆæœ¬æŒ‚é’©ï¼Œç¨³å®šç‰ˆæœ¬çš„DevEcoåªèƒ½å®‰è£…9åŠä»¥ä¸‹çš„APIï¼Œé«˜ç‰ˆæœ¬éœ€è¦ä¸‹è½½Betaç‰ˆæœ¬æ¨¡æ‹Ÿå™¨ç‰ˆæœ¬éœ€è¦å’ŒAPIä¸€è‡´ï¼Œé«˜ç‰ˆæœ¬æ¨¡æ‹Ÿå™¨ç°åœ¨è¦ä½¿ç”¨éœ€è¦ç”³è¯·æƒé™ é¡¹ç›®ä¸æ–‡ä»¶é¡¹ç›®åˆ›å»ºï¼šé¡¹ç›®åˆ›å»ºæ—¶é€‰SDKä¸€å®šè¦çœ‹æ¸…æ¥šå¦‚æœæ²¡æœ‰é«˜ç‰ˆæœ¬çš„SDKï¼Œå¯èƒ½æ˜¯å› ä¸ºDevEco Studioçš„ç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦æ›´æ–°æ–‡ä»¶æ–°å»ºArkTsä¸­å¤§éƒ¨åˆ†æŒ‡å‘æ˜ç¡®çš„æ–‡ä»¶ç»“æ„ï¼Œéƒ½èƒ½åœ¨ç›®å½•ç»“æ„æ ‘ä¸­æ‰¾åˆ°å¿«æ·æ–¹å¼åˆ›å»ºDevEcoæœ‰æ—¶ä¼šæŠŠtsæ–‡ä»¶ç¼–è¯‘æˆjså’Œjs.mapç±»å‹çš„æ–‡ä»¶ï¼Œç ´åé¡¹ç›®ç›®å½•ç»“æ„ï¼Œç›®å‰ç¤¾åŒºå†…çš„è§£å†³æ–¹æ¡ˆæ˜¯ç”¨æ’ä»¶ä¸€é”®åˆ é™¤ï¼šArkCompilerSupport Previewer è§†å›¾è§†å›¾ä¼šæ˜¾ç¤ºé¼ æ ‡æœ€è¿‘ä¸€æ¬¡èšç„¦çš„é¡µé¢è§†å›¾è°ƒè¯•çš„æ—¥å¿—ï¼Œéœ€è¦åœ¨Logé€‰é¡¹å¡ä¸­å¯¹æ—¥å¿—è¿›è¡Œç­›é€‰ï¼šPreviewerè§†å›¾æä¾›å¯è§†åŒ–ç¼–è¾‘çš„ç”»é¡µé¢æ–¹æ³•è§†å›¾å†…èƒ½å¯¹å±å¹•è¿›è¡Œæ‹‰ä¼¸æ“ä½œè§†å›¾ä¸ä»…ä»…æ˜¾ç¤ºé™æ€é¡µé¢ï¼Œç½‘ç»œè¯·æ±‚ä¹Ÿä¼šæ‰§è¡Œè§†å›¾å†…ä¸èƒ½æ˜¾ç¤ºWebæ ‡ç­¾åŠ è½½é¡µé¢ è°ƒè¯•æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå™¨çš„SDKéœ€è¦å’Œé¡¹ç›®çš„SDKåŒ¹é…æ¨¡æ‹Ÿå™¨é…ç½®åèƒ½å¤Ÿçƒ­æ›´æ–°ï¼Œä½†æ˜¯çƒ­æ›´æ–°çš„èŒƒå›´å¾ˆå°ï¼Œå¤§å¤šæ•°æƒ…å†µè¿˜æ˜¯ä½¿ç”¨Previeweræ—¥å¿—Logæ‰“å°æ—¥å¿—å°½é‡å¸¦ä¸Šæ ‡è¯†ç¬¦ï¼Œä¸ç„¶è¢«æ—¥å¿—åˆ·å±æ—¶ä¸€è„¸æ‡µé€¼ åŸºäºArkTSçš„å£°æ˜å¼å¼€å‘èŒƒå¼ArkTS ArkTSå£°æ˜å¼è¯­æ³•ä¹ æƒ¯äº†å°±è¿˜å¥½ï¼Œæ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯æ²¡æœ‰æ ·å¼å¤ç”¨ï¼Œæ•´ä½“çœ‹æ¥æ¯”è¾ƒç±»ä¼¼äºVue2çš„æ¡†æ¶é£æ ¼UIAbilityetsä¸‹ä¼šè‡ªåŠ¨ç”ŸæˆentryabilityEntryAbility.tsæ–‡ä»¶ï¼Œç”ŸæˆUIAbilityçª—å£ï¼ŒåŒ…å«Appé¦–é¡µçš„åŠ è½½ï¼Œå¯¹æ•´ä¸ªAppç”Ÿå‘½å‘¨æœŸä»¥åŠäº‹ä»¶çš„æŒ‚è½½ï¼šUIAbilityç»„ä»¶ä¿®é¥°ç¬¦ArkTsä½¿ç”¨ä¿®é¥°ç¬¦æ¥æ ‡æ˜æ•°æ®ã€æ–¹æ³•çš„å±æ€§ï¼Œçˆ¶å­ç»„ä»¶ä¹‹é—´å€¼çš„ä¼ é€’ä¸vueæ¯”è¾ƒç›¸ä¼¼ç»„ä»¶çŠ¶æ€ç®¡ç†è‡ªå®šä¹‰ç»„ä»¶å’ŒVueçš„ä½¿ç”¨æ–¹å¼ä¹Ÿå¾ˆåƒï¼ŒåŒ…æ‹¬çˆ¶å­ç»„ä»¶ä¹‹é—´æ•°å€¼çš„ä¼ é€’ã€‚ä½†æ˜¯èƒ½å¤Ÿå°†ç»„ä»¶é€»è¾‘ç›´æ¥ä¹¦å†™åœ¨ç»„ä»¶å£°æ˜å†…éƒ¨è¿™ä¸€ç‚¹è¿˜æ˜¯ç›¸å½“æ–¹ä¾¿çš„ã€‚å…¶å®ƒç»„ä»¶ç”Ÿå‘½å‘¨æœŸUIAbilityç»„ä»¶ç”Ÿå‘½å‘¨æœŸé¡µé¢å’Œè‡ªå®šä¹‰ç»„ä»¶å£°æ˜å‘¨æœŸrouterè·¯ç”±æ¯”è¾ƒç®€å•ï¼Œç±»ä¼¼äºuniappæ§åˆ¶è·¯ç”±çš„æ–¹å¼ç»„ä»¶æä¾›äº†å¾ˆå¤šå¸ƒå±€çš„ç»„ä»¶ï¼šFlexã€Rowã€Columnã€Gridç­‰ç­‰ï¼Œå¾ˆæ–¹ä¾¿å¾ˆå¤šç»„ä»¶éƒ½æä¾›äº†å“åº”å¼å¸ƒå±€çš„æ€è·¯ä¸€äº›ç»„ä»¶çš„è‡ªç”±åº¦ä¾æ—§å­˜åœ¨é™åˆ¶äº‹ä»¶æ ·å¼å‘½åé£æ ¼å’ŒcssåŸºæœ¬ä¸€è‡´ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰éšœç¢ demo å‚è€ƒé¡¹ç›®ï¼šè‹¥ä¾ç§»åŠ¨ç«¯é¸¿è’™ç‰ˆé¡¹ç›®åœ°å€ï¼šAPPæˆªå›¾ ç™»å½•é¡µ é¦–é¡µ åˆ—è¡¨é¡µ ä¸ªäººä¸»é¡µ å…¼å®¹JSçš„ç±»Webå¼€å‘èŒƒå¼å¼€å‘é£æ ¼æ¯”è¾ƒç±»ä¼¼äºVueï¼Œhtmlã€jsã€cssä¸‰éƒ¨åˆ†æ‹†åˆ†ååˆä½œä¸ºä¸€ä¸ªæ•´ä½“é¡µé¢ç»„ä»¶ï¼Œæ•´ä½“æ„Ÿè§‰æ¯”è¾ƒåšé‡ï¼Œæ—¢æ²¡æœ‰åŸç”ŸJsçš„é‚£ç§é«˜åº¦æ•´åˆæ€§ï¼Œåˆä¸å¦‚ArkTSé«˜æ•ˆAPPæˆªå›¾ ç™»å½•é¡µ æ³¨å†Œé¡µ é¦–é¡µ åˆ—è¡¨ èœå• æ•´ä½“æµç¨‹","tags":["APP"]},{"title":"mongodb + mongoose","path":"/2024/06/17/MongoDB/","content":"MongoDBå‘½ä»¤è¡Œæ–°ç‰ˆmongoDBçš„binæ–‡ä»¶ä¸­æ²¡æœ‰shå·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨ä¸‹è½½mongoshmongo shell åŸºç¡€æ“ä½œMongoDB èœé¸Ÿæ•™ç¨‹# è¿›å…¥mongoå‘½ä»¤è¡Œï¼šmongosh# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“show dbs# åˆ‡æ¢åˆ°æŒ‡å®šæ•°æ®åº“ï¼ˆåˆ›å»ºæ•°æ®åº“ï¼‰use dbName# åˆ é™¤æ•°æ®åº“db.dropDatabase() #æ˜¾ç¤ºæ‰€æœ‰é›†åˆshow collections# æ–°å¢é›†åˆdb.createCollection(name,option)# é›†åˆé‡å‘½ådb.adminCommand( renameCollection: sourceDb.sourceCollection, to: targetDb.targetCollection, dropTarget: boolean)#æŸ¥è¯¢é›†åˆæ‰€æœ‰æ•°æ®db.collectionName.find()#æ–°å¢ä¸€æ¡æ•°æ®db.users.insertOne(name:admin,age:24,status:1) #åˆ é™¤ä¸€æ¡æ•°æ®db.users.deleteOne()#åˆ é™¤æŒ‡å®šè¡¨db.collectionName.drop()#æ¸…ç©ºæŒ‡å®šè¡¨æ•°æ®db.collectionName.remove()#åˆ›å»ºç´¢å¼•db.collectionName.ensureIndex(useranme:1)#è·å–é›†åˆç´¢å¼•db.user.getIndexes()#ç®¡é“æŸ¥è¯¢db.user.aggregate( [ $lookup: from: news, localField: sn, foreignField: authorSn, as: workList ] ) å¤‡ä»½ã€è¿˜åŸã€å¯¼å…¥ã€å¯¼å‡º æ•°æ®åº“å¯¼å…¥ã€å¯¼å‡ºæ“ä½œå‰ï¼Œç¡®ä¿æ•°æ®åº“æ‰“å¼€# æ•°æ®åº“å¯¼å‡ºmongodump -h dbhost -d dbname -o dbdirectory# æ•°æ®åº“å¯¼å…¥mongorestore -h dbhost -d dbname path MongooseåŸºæœ¬æ“ä½œæ­¥éª¤æ­¥éª¤1ï¼šå¼•å…¥mongoosenpm i --save mongooseconst mongoose = require(mongoose)æ­¥éª¤2ï¼šå»ºç«‹è¿æ¥mongoose.connect(mongodb://127.0.0.1:27017/test)æ­¥éª¤3ï¼šå®šä¹‰Schemaè¡¨æ¨¡ç‰ˆï¼šconst UserSchema = mongoose.Schema( name:String, age:Number, status:Number)æ­¥éª¤4ï¼šå®šä¹‰æ•°æ®åº“æ¨¡å‹ï¼š// modelç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé¦–å­—æ¯éœ€è¦å¤§å†™// mongoDBä¸­æ•°æ®åº“å‘½åï¼Œå•æ•°å’Œå¤æ•°ä¹‹é—´ä¼šé»˜è®¤äº§ç”Ÿè”ç³» user-users// ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°å»ºç«‹è”ç³»const User = mongoose.model(User,UserSchema,user)æ­¥éª¤5ï¼šæ“ä½œæ“ä½œæ–‡æ¡£å¢ saveåˆ  deleteOneæ”¹ updateOneæŸ¥ find SchemaSchemaç±»å‹SchemaéªŒè¯å™¨é™æ€ä¸åŠ¨æ€æ–¹æ³• ç®¡é“æŸ¥è¯¢aggregate UserModel.aggregate([ $lookup: from:news, localField:sn, foreignField:authorSn, as:workList , // ç­›é€‰ $match:name:root ]).then(res= console.log(å…³è”æˆåŠŸ) console.log(res)).catch(err= console.log(å…³è”å¤±è´¥) console.log(err)) å¤šç®¡é“æŸ¥è¯¢ AricleModel.aggregate([ //æ‹‰å–åˆ†ç±»ä¿¡æ¯ $lookup: from:articlecate, // ç›®æ ‡è¡¨ localField:cid, // æœ¬è¡¨å­—æ®µ foreignField:_id, // å¤–è¡¨å­—æ®µ as:cate, // è½¬æ¢å­—æ®µ , // æ‹‰å–ä½œè€…ä¿¡æ¯ $lookup: from:user, localField:author_id, foreignField:_id, as:author, ])","tags":["æ•°æ®åº“"]},{"title":"c#åŸºç¡€å­¦ä¹ ","path":"/2024/06/08/C-Learning/","content":"C#ç¼–ç¨‹å…¥é—¨ï¼ˆBrackeysï¼‰bç«™æ¬è¿ç¿»è¯‘ç‰ˆ .NET VSCodeå®‰è£… å®‰è£….NETæ¡†æ¶å®‰è£…VSCodeVSCodeå®‰è£…C#æ’ä»¶æ§åˆ¶å°è¾“å…¥åˆ›å»ºæ–°é¡¹ç›®å‘½ä»¤ï¼šdotnot newå¯åŠ¨é¡¹ç›®å‘½ä»¤ï¼šdotnet runè‡ªå®šä¹‰é¡¹ç›®å¯åŠ¨æ§åˆ¶å°ï¼šCtrl+Shift+Pæ‰“å¼€VSCodeæ§åˆ¶å°é€‰æ‹©.NET:Generate Assets For Build and DebugVSCodeè‡ªåŠ¨ç”Ÿæˆlaunch.jsoné…åˆ¶æ–‡ä»¶ä¿®æ”¹controlå±æ€§ä¸ºexternalTerminalå…¥å£ç¨‹åºProgram.csConsole.WriteLine(Hello, World!);Console.ReadKey(); How to Program in C#åœ¨Program.csä¸­ï¼Œä½“éªŒä¸€ä¸‹C#è¯­æ³•çš„æ‰‹æ„Ÿï¼šConsole.ForegroundColor è®¾ç½®è¾“å‡ºé¢œè‰²Console.Title è®¾ç½®çª—å£æ ‡é¢˜Console.WriteLine è¾“å‡ºConsole.ReadLine è¯»å–ç”¨æˆ·è¾“å…¥Console.ReadKey è¯»å–ç”¨æˆ·æŒ‰é”®ä¸€ç¯‡åªç”¨Consoleçš„Visual Novel // See https://aka.ms/new-console-template for more informationConsole.Title = ä¿„ç½—æ–¯è½®ç›˜;// æ—ç™½void BackVoice(string mes)Console.ForegroundColor = ConsoleColor.Green;Console.WriteLine(æ—ç™½ï¼š+ mes + );Console.ReadKey();// æ¶é­”void DemonVoice(string mes, Boolean stop = true)Console.ForegroundColor = ConsoleColor.Red;Console.WriteLine(æ¶é­”ï¼š+ mes + );if(stop)Console.ReadKey();// ç©å®¶çš„å£°éŸ³void PlayerVoice(string mes)Console.ForegroundColor = ConsoleColor.Blue;Console.WriteLine(ä½ ï¼š+ mes + );Console.ReadKey();// ç©å®¶çš„å›ç­”string PlayerRes()Console.ForegroundColor = ConsoleColor.Yellow;string res = ;Console.Write(ä½ ï¼š);while(res.Trim()==)res = Console.ReadLine();Console.WriteLine();return res;BackVoice(ä½ ç›¯ç€é¢å‰çš„å·¦è½®æ‰‹æª);BackVoice(å†·æ±—ç›´æµ);DemonVoice(æ¥ä¸‹æ¥ï¼Œè¯¥ä½ äº†ï¼Œå®è´);BackVoice(ä½ çš„çœ¼ç¥åœ¨å·¦è½®æ‰‹æªå’Œå®ƒä¹‹é—´åå¤å¾˜å¾Š);BackVoice(æœ‰ä¸€ç¬é—´ï¼Œä½ æƒ³ç›´æ¥ç”¨æ‰‹æªå´©çƒ‚å®ƒçš„ç¬‘è„¸);BackVoice(ä½†é‚£æ ·åšæœ‰å¤±é£åº¦);BackVoice(ä½ æ“¦äº†æŠŠå¤´ä¸Šçš„æ±—ï¼Œéª‚é“ï¼š);string dirtyWord = PlayerRes();DemonVoice(å˜¿å˜¿å˜¿......);DemonVoice(å¾ˆä¸é”™çš„æ°”åŠ¿);BackVoice(é­”é¬¼é˜´æ²‰çš„å‘ç¬‘);BackVoice(ä½ æ”¥ç´§è¿™æŠŠæ²‰ç”¸ç”¸çš„æ‰‹æª);BackVoice(æ‰‹å¿ƒæ¹¿æ¼‰æ¼‰çš„ï¼Œæœ‰äº›æ‰“æ»‘);PlayerVoice(ç¦»è¿œç‚¹æ¬£èµï¼Œå°å¿ƒè¡€å–·ä½ ä¸€èº«);BackVoice(å®ƒç”¨æ¼†é»‘çš„ç›®å…‰æ³¨è§†ç€ä½ ï¼Œä»¿ä½›è¦å°†ä½ çœ‹ç©¿);PlayerVoice(å“¼);BackVoice(ä½ ç”¨çœ¼ç¥è”‘ç€å®ƒå‚æ¶æ¬²æ»´çš„è ¢æ ·);PlayerVoice(åæ­£æˆ‘éƒ½ä¼šæ´»ä¸‹æ¥å°±æ˜¯äº†);DemonVoice(æˆ‘å¾ˆæ¬£èµä½ çš„è‡ªè´Ÿ..., false);BackVoice(å’”å“’......ç¢°ï¼);PlayerVoice(!!!);DemonVoice(!!!);BackVoice(æœªç­‰å®ƒè¯´å®Œï¼Œä½ å°±å©å“äº†æ‰³æœº);BackVoice(......);BackVoice(æ²¡æœ‰å­å¼¹ï¼Œä½ è¿˜æ´»ç€ï¼Œç©ºæª);BackVoice(ä½ åå‡ºä¸€å£æ°”);PlayerVoice(é‚£ä¹ˆç°åœ¨ï¼Œå±¥è¡Œè¯ºè¨€çš„æ—¶å€™åˆ°äº†);BackVoice(ä½ å°†å¾®å¾®é¢¤æŠ–çš„æ‰‹æ”¾ä¸‹);PlayerVoice(æˆ‘è¦ä½ å»æ€ä¸€ä¸ªäºº);DemonVoice(å“¼ï¼Œçœ‹æ¥ä½ å¾ˆæ¸…æ¥šæ€ä¹ˆå’Œæ¶é­”æ‰“äº¤é“ã€‚);DemonVoice(å‘Šè¯‰æˆ‘é‚£ä¸ªäººçš„åå­—ã€‚);BackVoice(ä½ ç´§æ¡ç€æ‰‹ä¸­çš„æª);BackVoice(å±…äºé»‘æš—ä¸­çš„åŒçœ¼å†·é™çš„å‡è§†ç€è¿œå¤„æ˜æš—çš„ç¯å…‰);BackVoice(ç¼“ç¼“å¼ å£ï¼Œè¯´å‡ºäº†é‚£ä¸ªäººçš„åå­—......);string name = PlayerRes();DemonVoice(...... + name + ?);DemonVoice(å˜¿å˜¿......);DemonVoice(ä½ çš„çœ¼å…‰å¾ˆä¸é”™);DemonVoice(æŒ‘äº†ä¸ªæŠ˜ç£¨èµ·æ¥å¾ˆæœ‰è¶£çš„çµé­‚);BackVoice(é­”é¬¼çš„è„¸ä¸Šéœ²å‡ºé˜´é™©çš„ç¬‘å®¹);BackVoice(å®ƒç«™èµ·èº«ï¼Œç¼“ç¼“åé€€);DemonVoice(ä¸‰å¤©åï¼Œä¸€åˆ‡å¦‚ä½ æ‰€æ„¿);BackVoice(å®ƒä¸‘é™‹çš„èº«å½±æ¸æ¸ä¸èº«åçš„é»‘æš—æ¶ˆèåœ¨ä¸€èµ·);DemonVoice(å˜¿å˜¿å˜¿......);BackVoice(å®ƒé‚£å¤æ€ªè€Œä½æ²‰çš„ç¬‘å£°ï¼Œä¹Ÿéšä¹‹å˜å¾—æ¨¡ç³Š);DemonVoice(å¯æ€œçš„ç¾”ç¾Š......);DemonVoice(ä¹Ÿè®¸æœ‰ä¸€å¤©ä½ ä¼šåæ‚”è¿™ç¬”äº¤æ˜“);DemonVoice(ä½†è‡³å°‘ï¼Œä½ ç°åœ¨æ ¹æœ¬ä¸çŸ¥é“è‡ªå·±éƒ½åšäº†äº›ä»€ä¹ˆã€‚);BackVoice(å®ƒçš„èº«å½±å½»åº•æ¶ˆå¤±åœ¨é»‘æš—ä¹‹ä¸­);BackVoice(åªç•™ä¸‹ä½ ä¸€äºº);BackVoice(è¿˜æœ‰é‚£å›è¡åœ¨é»‘æš—ä¹‹ä¸­çš„ç¬‘å£°);Console.ReadKey(); ã€ŠC#è¯­è¨€å…¥é—¨è¯¦è§£ã€‹â€”â€”åˆ˜é“çŒ›1. C#è¯­è¨€ä»‹ç»ç¼–ç¨‹å­¦ä¹ è·¯å¾„ï¼šçºµå‘ï¼š è¯­è¨€ â†’ ç±»åº“ â†’ æ¡†æ¶æ¨ªå‘ï¼š å‘½ä»¤è¡Œ â†’ æ¡Œé¢ç¨‹åº â†’ è®¾å¤‡ï¼ˆå¹³æ¿æ‰‹æœºï¼‰ç¨‹åº â†’ Webç¨‹åº â†’ æ¸¸æˆ â†’ â€¦Visual Studioæ–‡æ¡£C#æ–‡æ¡£WPFç¨‹åºåˆä½“éªŒä¸»çª—å£ä»£ç ï¼štitle:MainWindow.xamlWindow Grid Grid.ColumnDefinitions/Grid.ColumnDefinitions Grid.Background/Grid.Background TextBox x:Name=textBox/TextBox Button Click=Button_Click/Button /Grid/Windowå¯¹Buttonçš„Clickäº‹ä»¶è¿›è¡Œç›‘å¬ï¼štitle:MainWidnow.xaml.csnamespace HelloWPF public partial class MainWindow : Window // ä¸»çª—å£ç¨‹åº public MainWindow() InitializeComponent(); // æ–‡æœ¬æ¡†è¾“å…¥æ¡†æ–‡æœ¬å˜åŒ–äº‹ä»¶ private void TextBox_TextChanged(object sender, TextChangedEventArgs e) // æŒ‰é’®ç‚¹å‡»äº‹ä»¶ private void Button_Click(object sender, RoutedEventArgs e) this.textBox1.Text = Hello World; 2. C#åº”ç”¨ç¨‹åºä»‹ç»Solutionå’ŒProject Solutionï¼šé’ˆå¯¹å®¢æˆ·éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆç”¨æˆ·éœ€è¦åˆ¶ä½œä¸€ä¸ªç®¡ç†ç³»ç»ŸProjectï¼š è§£å†³å…·ä½“é—®é¢˜é‡‡å–çš„æ–¹æ¡ˆæ•°æ®å­˜å‚¨ï¼Ÿæ•°æ®åº“é¡¹ç›®æ•°æ®è¯»å–è¡¨å•å¤„ç†ï¼ŸæœåŠ¡å™¨é¡¹ç›®ç½‘ç«™æ“ä½œï¼Ÿå®¢æˆ·æµè§ˆå™¨åº”ç”¨é¡¹ç›®æ‰‹æœºæ“ä½œï¼Ÿæ‰‹æœºç«¯åº”ç”¨é¡¹ç›®å¹³æ¿æ“ä½œï¼Ÿå¹³æ¿åº”ç”¨é¡¹ç›®â€¦ å„ç±»C#ç¼–å†™çš„åº”ç”¨ç¨‹åº ConsoleConsole App æ§åˆ¶å°ç¨‹åº Console.WriteLine(Hello World); Windows Forms(Old)WinFormsApp æ—§ç‰ˆæœ¬æ¡Œé¢åº”ç”¨ç¨‹åº namespace HelloWinFormsApp public partial class Form1 : Form public Form1() InitializeComponent(); private void HelloButton_Click(object sender, EventArgs e) this.HelloTextBox.Text = Hello World; color:darkWPFï¼ˆWindows Presentation Foundationï¼‰WPF æ–°ç‰ˆæ¡Œé¢åº”ç”¨ç¨‹åº ASP.NET Web Forms(Old) ç½‘ç«™åº”ç”¨ASP.NET MVC(Model-View-Controller) ç½‘ç«™åº”ç”¨Windows Store Application å¹³æ¿åº”ç”¨Windows Phone Application æ‰‹æœºåº”ç”¨Cloudï¼ˆWindows Azureï¼‰ äº‘è®¡ç®—å¹³å°WFï¼ˆWorkflow Foundationï¼‰å·¥ä½œæµWCF çº¯ç½‘ç»œæœåŠ¡ 3. ç±»ä¸åç§°ç©ºé—´class namespace c#ä¸­ï¼Œç¨‹åºä½œä¸ºç±»å®ç°ï¼Œå› æ­¤éœ€è¦å°†å…¥å£å‡½æ•°åŒ…åœ¨ç±»ä¸­å‘½åç©ºé—´æ–¹ä¾¿å®ç°ç±»é—´çš„ä¾èµ–å…³ç³»é˜²æ­¢å‘½åå†²çª ç±»åº“å¼•ç”¨ DLLï¼ˆDynamic Link Library åŠ¨æ€é“¾æ¥åº“ç±»åº“ï¼‰å¼•ç”¨é»‘ç›’å¼•ç”¨ï¼Œæ— æºä»£ç  NuGetï¼Œè‡ªåŠ¨åŒ–ç»´æŠ¤ç±»ä¾èµ–å…³ç³»é¡¹ç›®å¼•ç”¨ç™½ç›’å¼•ç”¨ï¼Œæœ‰æºä»£ç é¡¹ç›®å¼•ç”¨ä¸‹é¢æ˜¯ä¸€ä¸ªç±»åº“ï¼ˆ.NET Frameworkï¼‰çš„ä¸»ä»£ç title:Calculatorç±»using System;using System.Collections.Generic;using System.Linq;using System.Text;using System.Threading.Tasks;namespace Tools public class Calculator // åŠ æ³• public static double Add(double a, double b) return a + b; // å‡æ³• public static double Sub(double a, double b) return a - b; // ä¹˜æ³• public static double Mul(double a, double b) return a * b; // é™¤æ³• public static double Div(double a, double b) if (b == 0) return Double.PositiveInfinity; else return a / b; åœ¨éœ€è¦å¼•ç”¨è¯¥ç±»çš„ä¸»é¡¹ç›®æ‰€åœ¨çš„Solutionä¸­ï¼Œå°†ç±»åº“é¡¹ç›®æ·»åŠ è¿›å»ï¼Œå¼•å…¥ç±»åº“ä¾èµ–ï¼Œä¹‹åå†ä¸»é¡¹ç›®ä¸­ä½¿ç”¨è¯¥ç±»ï¼štitle:Program.csusing Tools;namespace ConsoleApp internal class Program static void Main(string[] args) double result = Calculator.Add(1.14, 4.15); Console.WriteLine(result); 4. ç±»ã€å¯¹è±¡ã€ç±»æˆå‘˜ç®€ä»‹å®ä¾‹å’Œå¯¹è±¡ ä¸¤è€…çš„åŒºåˆ«ä¸»è¦åœ¨è¯­å¢ƒä¸Šï¼šåœ¨è®¨è®ºç±»åœ¨ç°å®ä¸–ç•Œä¸­çš„å¯¹åº”æ—¶ï¼Œä¸€èˆ¬ç§°ä¸ºå¯¹è±¡åœ¨è®¨è®ºç±»åœ¨ç¨‹åºä¸­çš„å¯¹åº”æ—¶ï¼Œä¸€èˆ¬ç§°ä¸ºå®ä¾‹ C#ä¸­ç±»çš„ä¸‰è¦ç´ ï¼šå±æ€§ Propertyæ–¹æ³• Functionäº‹ä»¶ EventVisual Studioä¸­ï¼Œå°†å…‰æ ‡æ”¾åœ¨ç±»ä¸Šï¼Œç‚¹å‡»F1ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç±»å¯¹åº”çš„MSDNæ–‡æ¡£ä¸Šä½¿ç”¨Eventå®ç°æ¡Œé¢æ—¶é’Ÿusing System.Windows.Threading;public partial class MainWindow : Window public MainWindow() InitializeComponent(); // åˆ›å»ºå®šæ—¶å™¨ DispatchTimer timer = new DispatchTimer(); // é…ç½®å®šæ—¶å™¨é—´éš”æ—¶é—´ timer.Interval = TimeSpan.FromSeconds(1); // å®šæ—¶äº‹ä»¶ timer.Tick += Time_Tick; // å¼€å¯å®šæ—¶å™¨ timer.Start(); // å®šæ—¶äº‹ä»¶ private void Time_Tick(object? sender, EventArgs e) this.TimeTextBox.Text = DateTime.Now.ToString() é™æ€æˆå‘˜ä¸å®ä¾‹æˆå‘˜ é™æ€æˆå‘˜ï¼šç±»çš„æˆå‘˜å®ä¾‹æˆå‘˜ï¼šå¯¹è±¡çš„æˆå‘˜ 5. æ„æˆC#è¯­è¨€çš„åŸºæœ¬å…ƒç´ å˜é‡ç±»å‹ int x_int = 2; // 32bit long y_long = 3L; // 64bit é•¿æ•´å‹float x_float = 3.0F; // 32 // å•ç²¾åº¦ double y_double = 40.0; // 64 // åŒç²¾åº¦char c = 1; // å•å­—ç¬¦string str = 12323; // å­—ç¬¦ä¸²bool flag = true; // å¸ƒå°”å€¼string isNull = null; // nullvar thisIsNumber = 3; // æ¨æ–­ç±»å‹é™¤äº†è¿™äº›é™æ€ç±»å‹ï¼ŒC#ä¸­è¿˜æä¾›2ä¸­æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹ï¼švar å¯ä»¥ä¸ºä»»æ„åŸºç¡€ç±»å‹dynamic åŠ¨æ€ç±»å‹ 6. ç±»å‹ã€å˜é‡ä¸å¯¹è±¡C#å˜é‡ã€å †ã€æ ˆã€åƒåœ¾å›æ”¶ å † å­˜å‚¨å®ä¾‹åˆ†é…å†…å­˜å¤§åˆ†é…ä¸åˆç†ä¼šå¯¼è‡´å†…å­˜æ³„æ¼C#æä¾›åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼æ ˆç”¨äºå­˜å‚¨è¿è¡Œçš„å‡½æ•°å¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡º Performance Monitor æ€§èƒ½ç›‘è§†å™¨ ä½¿ç”¨Performance Monitorï¼Œèƒ½å¤Ÿç›‘æ§è¿›ç¨‹çš„å †å†…å­˜ä½¿ç”¨é‡ã€‚Win+R â†’ perfmon â†’ æ€§èƒ½ç›‘è§†å™¨ â†’ +å· â†’ Process â†’ Private Bytesï¼ˆå·²åˆ†é…å­—èŠ‚æ•°ï¼‰â†’ é€‰å®šå¯¹è±¡å®ä¾‹ï¼ˆè¦ç›‘æ§çš„ç¨‹åºï¼‰â†’ æ·»åŠ  â†’ åŒå‡»å®ä¾‹ï¼ˆè¿›è¡Œå›¾è¡¨å®šåˆ¶ï¼‰ C#äº”å¤§æ•°æ®ç±»å‹ C#çš„æ‰€æœ‰æ•°æ®ç±»å‹éƒ½ä»¥Objectä¸ºåŸºç±»å¼•ç”¨ç±»å‹ç±» classæ¥å£ interfaceå§”æ‰˜ delegateå€¼ç±»å‹ç»“æ„ä½“ structstringã€charboolã€trueã€falsebyteã€intã€longã€floatã€doubleã€sbyteã€shortã€uintã€ulongã€ushortã€decimalvoidã€nullã€varã€dynamicæšä¸¾ enum 7ç§å˜é‡ç±»å‹ é™æ€å˜é‡ ï¼ˆconstä¿®é¥°ç¬¦ï¼‰å®ä¾‹å˜é‡ï¼ˆæˆå‘˜å˜é‡ï¼Œå­—æ®µï¼‰ï¼ˆpublicstaticprivateä¿®é¥°ç¬¦ï¼‰æ•°ç»„å˜é‡å€¼å‚æ•°å¼•ç”¨å‚æ•° ï¼ˆrefä¿®é¥°ç¬¦ï¼‰è¾“å‡ºå½¢å‚ ï¼ˆoutä¿®é¥°ç¬¦ï¼‰å±€éƒ¨å˜é‡ 7. è¿ç®—ç¬¦è¿ç®—ç¬¦å®é™…ä¸Šæ˜¯å¯¹å‡½æ•°çš„ä¸€ç§è¯­æ³•ç³–ï¼Œå®šä¹‰ä¸€ä¸ªPersonç±»çš„ç›¸åŠ æ–¹æ³•ï¼šclass Person public string Name; public static ListPerson operator +(Person p1, Person p2) ListPerson children = new ListPerson(); int childrenNumber = 11; for (int i = 0; i childrenNumber; i++) Person child = new Person(); child.Name = p1.Name + å’Œ + p2.Name + çš„ç¬¬ + (i+1) + ä¸ªå­©å­; children.Add(child); return children; è°ƒç”¨åŠ æ³•çš„æ•ˆæœï¼šPerson man = new Person();Person woman = new Person();man.Name = äºšå½“;woman.Name = å¤å¨ƒ;//ListPerson children = Person.GetMarry(man, woman);ListPerson children = man + woman; åŸºæœ¬è¿ç®—ç¬¦ ç‚¹è¿ç®—ç¬¦ï¼šSystem.IO.File.Create(D:\\\\CS_Demo\\\\test\\\\HelloWorld.txt);å‡½æ•°è°ƒç”¨ç¬¦äº‹ä»¶å§”æ‰˜Action sayHello = new Action(Person.SayHello);sayHellow()class Person public static void sayHello() Console.WriteLine(hello); æ•°ç»„è®¿é—®int[] myIntArray = new Int[] 1,2,3,4,5;å­—å…¸è®¿é—®Dictionarystring, Person PersonDic = new Dictionarystring, Person();// å­—å…¸çš„æ·»åŠ for(int i = 1; i 10;i++) Person p = new Person(); p.Name = p_+i.ToString(); p.Age = i * 10; PersonDict.Add(p.Name, p);// å­—å…¸çš„è®¿é—®Person p_3 = PersonDict[p_3];ç±»å‹typeæ“ä½œç¬¦Type t = typeof(int);Console.WriteLine(t.Namespace);Console.WriteLine(t.FullName);Console.WriteLine(t.Name);defaultæ“ä½œç¬¦ï¼šè·å–åˆ°æ­¤ç±»å‹å­˜å‚¨å†…å­˜å…¨éƒ¨åˆ·æˆ0çš„å€¼int a = default(int)newæ“ä½œç¬¦åŠŸèƒ½1ï¼šåˆ›å»ºå®ä¾‹å¹¶å°†å®ä¾‹çš„åœ°å€è½¬äº¤ç»™å˜é‡Form myForm = new Form()åŠŸèƒ½2ï¼šå®ä¾‹åˆå§‹åŒ–Form myForm = new Form()Text=Hello,FormBorderStyle = FormBorderStyle.SizableToolWindowåŠŸèƒ½3ï¼š åˆ›å»ºåŒ¿åç±»å‹var person = new Name = Mr.Okay, Age = 20;Console.WriteLine(person.GetType().Name); // f__AnomymousType0`2 åŠŸèƒ½4ï¼šå­ç±»éšè—çˆ¶ç±»æ–¹æ³•class Student public void Report() Console.WriteLine(im a student); class CS_Student:Student new public void Report() Console.WriteLine(im a cs student); ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿä¾èµ–æ³¨å…¥åˆæ˜¯å¦‚ä½•å¯¹ç¨‹åºè¿›è¡Œè§£è€¦åˆçš„ï¼Ÿchecked uncheckedç”¨äºæ£€æŸ¥æŸä¸ªå€¼çš„æº¢å‡ºæƒ…å†µï¼ŒC#ä¸­é»˜è®¤è¿›è¡Œuncheckedï¼Œè¿›è¡Œå˜é‡çš„checkedæ£€æŸ¥ï¼šuint x = uint.MaxValue;try uint y = checked(x+1); //System.OverflowException:â€œç®—æœ¯è¿ç®—å¯¼è‡´æº¢å‡ºã€‚â€catch(OverflowExcept ex) Console.WriteLine(overflow error);è¿›è¡Œä»£ç å—çš„checkedæ£€æŸ¥checked try uint y = x+1; catch(OverflowExcept ex) Console.WriteLine(overflow error); delegatedelegateæ˜¯å£°æ˜åŒ¿åæ–¹æ³•çš„æ“ä½œç¬¦ï¼Œæ¯”å¦‚ï¼šæŸä¸ªå‡½æ•°å£°æ˜åï¼Œå®é™…åªä½¿ç”¨äº†ä¸€æ¬¡ï¼špublic MainWindow() this.myButton.Click += MyButton_Click;public void MyButton_Click() this.myTextBox.Text = Hello World;è¿™æ—¶å¯ä»¥ä½¿ç”¨delegateæ¥ç›´æ¥å£°æ˜ï¼ˆç°åœ¨å¤šè¢«lambdaå‡½æ•°å–ä»£ï¼‰this.myButtonBox.Click += delegate (object sender, RoutedEventArgs e) this.myTextBox.Text = Hello World;lambdaè¡¨è¾¾å¼çš„æ–¹å¼æ›´åŠ ç®€å•ï¼Œå¹¶ä¸”ç¨‹åºä¼šå¯¹å‚æ•°ç±»å‹è¿›è¡Œæ¨æ–­this.myButton.Click += (sender, e) = this.myTextBox.Text = Hello World;æŒ‡é’ˆä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œä»£ç å—éœ€è¦å¼€å¯unsafeæ¨¡å¼ï¼Œå¹¶ä¸”éœ€è¦è¿›è¡Œé¢å¤–é…ç½®ï¼šé¡¹ç›®Oporatorå±æ€§ç”Ÿæˆå…è®¸ä¸å®‰å…¨ä»£ç ï¼ˆå‹¾é€‰ï¼‰unsafe Student stu = new Student()Name = Jason, Age = 18; // æŒ‡é’ˆç¬¦å· * // å–åœ°å€ç¬¦å· Student * pStu = stu; // ç®­å¤´ç¬¦å· pStu=Age = 20; // å–å¼•ç”¨ç¬¦å· (*pStu).Name = Tim; ç±»å‹è½¬æ¢æ“ä½œ éšå¼ç±»å‹è½¬æ¢ä¸ä¼šå½±å“æ•°å€¼ç²¾åº¦çš„æƒ…å†µä¸‹å®Œæˆè½¬æ¢ï¼ˆä½ç²¾åº¦è½¬é«˜ç²¾åº¦ï¼‰å­ç±»å‘çˆ¶ç±»çš„è½¬æ¢æ˜¾å¼ç±»å‹è½¬æ¢å¯èƒ½ä¸¢å¤±ç²¾åº¦çš„è½¬æ¢ï¼Œcastè½¬æ¢Convertè°ƒç”¨ToStringParseTryParseå­ç±»è½¬çˆ¶ç±»internal class Program static void Main(string[] args) Programmer programmer = new Programmer(); // å­ç±»è½¬çˆ¶ç±» Human human = programmer; Animal animal = programmer; human.Think(); human.Eat(); class Animal public void Eat() Console.WriteLine(Eating); class Human : Animal public void Think() Console.WriteLine(Thinking); class Programmer: Human public void Code() Console.WriteLine(Coding); castè½¬æ¢uint x = ushort.MaxValue + 1;ushort y = (ushort)x;Console.WriteLine(x); // 65536Console.WriteLine(y); // 0 ParseTryParse Parseåœ¨æ— æ³•è½¬æ¢æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯string x = Console.ReadLine();string y = Console.ReadLine();double x_value = double.Parse(x);double y_value = double.Parse(y);Console.WriteLine(x_value + y_value);å¯¹åº”TryParseï¼Œæ¥æ”¶æ— æ³•è½¬æ¢çš„å€¼ä¸ä¼šæŠ¥é”™ï¼Œéœ€è¦ä¸€ä¸ªoutå‚æ•°:string x = Console.ReadLine();string y = Console.ReadLine();double x_value, y_value;double.TryParse(x, out x_value);double.TryParse(y, out y_value);Console.WriteLine(x_value + y_value); è‡ªå®šä¹‰ç±»å®ä¾‹è½¬æ¢ é€šè¿‡åœ¨ç±»ä¸­å®šä¹‰å¸¦å…³é”®å­—å‰ç¼€å‡½æ•°ï¼Œå®ç°ç±»å‹è½¬æ¢ï¼šæ˜¾ç¤ºè½¬æ¢ explicitStone stone = new Stone();stone.Age = 5000;Monkey wukong = (Monkey)stone; // æ˜¾å¼è½¬æ¢Console.WriteLine(wukong.Age); class Stone public int Age; // å®šä¹‰è½¬æ¢æ“ä½œæ–¹æ³• public static explicit operator Monkey(Stone stone) Monkey m = new Monkey(); m.Age = stone.Age/500; return m; class Monkey public int Age; éšå¼è½¬æ¢ implicit// éšå¼è½¬æ¢Monkey m = stoneclass Stone public int Age; public static implicit operator Monkey(Stone stone) Monkey m = new Monkey(); m.Age = stone.Age/500; return m; æµ®ç‚¹æ•°é™¤æ³•|æ­£è´Ÿæ— ç©·å¤§ æµ®ç‚¹æ•°çš„é™¤æ•°å¯ä»¥æ˜¯0ï¼Œç»“æœä¼šæ˜¯æ­£è´Ÿæ— ç©·å¤§double x = -5.0;double y = 0;double z = x / y;Console.WriteLine(z); // -InfinityConsole.WriteLine(double.PositiveInfinity / double.NegativeInfinity); // NaNConsole.WriteLine(double.PositiveInfinity * 0.0); // NaN å­—ç¬¦æ¯”è¾ƒå¤§å° æ¯”è¾ƒASCIIç¼–ç å¤§å°char char1 = A;char char2 = a;ushort u1 = (ushort)char1;ushort u2 = (ushort)char2;Console.WriteLine(char1 + = + u1); // 65Console.WriteLine(char2 + = + u2); // 97 is | as iså®ç°ç±»çš„æ£€æµ‹Person p = new Person();Console.WriteLine(p is Person); // TrueConsole.WriteLine(p is Human); // TrueConsole.WriteLine(p is Animal); // True class Animal class Human : Animal class Person : Human asèƒ½å¤Ÿå®ç°ç±»å‹æ–­è¨€ï¼ˆè½¬æ¢ï¼‰ï¼Œè½¬æ¢ä¸æˆåŠŸåˆ™è¿”å›nullobject p = new Person();Person np = p as Person; // æ— æ³•è½¬æ¢è¿”å›null nullå€¼ å¯ç©ºç±»å‹ï¼šNullableint x = null;è¯­æ³•ç³–ï¼šint? x = null;nullå€¼æ£€æµ‹è¯­æ³•ç³–ï¼Œä¸‹é¢è¯­å¥ï¼Œå¦‚æœxä¸ºnullï¼Œåˆ™è¿”å›1int y = x ?? 1; ä¸‰ç›®è¿ç®—ç¬¦ int x = 80;string str = string.Empty;str = x = 60 ? Pass : Failed;Console.WriteLine(str); 8. è¡¨è¾¾å¼è¯­å¥åç¼–è¯‘ Visual Studioå¯¹é¡¹ç›®ç»è¿‡ç¼–è¯‘åï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•binDebugä¸‹æ‰¾åˆ°.exeæ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨Visual Studioæä¾›çš„å·¥å…·ï¼š Developer Command Promptå‘½ä»¤è¡Œè¾“å…¥ï¼š ildasmå¯¼å…¥å·²ç»è¢«ç¼–è¾‘å¥½çš„exeæ‰§è¡Œæ–‡ä»¶ï¼Œèƒ½å¤Ÿåç¼–è¯‘å‡ºæºç ï¼š å£°æ˜å¸¸é‡ const int x = 100; ä»£ç æµæ§åˆ¶ goto hello: Console.WriteLine(Hello, World!);goto hello; è¡¨è¾¾å¼ç›¸å…³å¿«æ·é”® å¿«æ·é”®ï¼šctrl + } å®ç°ä»£ç å—æ‹¬å·è·³è½¬ctrl + l å¿«é€Ÿå‰ªåˆ‡ä¸€è¡Œ switch visual studioåˆ›å»ºswitchè¯­å¥å¿«æ·é”®ï¼šswcaseè¡¨è¾¾å¼åè·Ÿéšçš„æ•°æ®å¿…é¡»è¦å’Œswitchå˜é‡åæŒ‡å®šçš„è¡¨è¾¾å¼ä¸€è‡´ï¼Œcaseè¡¨è¾¾å¼åï¼Œæœ‰æ‰§è¡Œè¯­å¥ï¼Œå¿…é¡»è¦åŠ breaktry int Score = Int32.Parse(Console.ReadLine()); switch (Score / 10) case 10: if (Score 100) // ç›´æ¥è·³è½¬åˆ°default goto default; else goto case 8; case 9: case 8: Console.WriteLine(A);break; case 7: case 6: Console.WriteLine(B); break; case 5: case 4: Console.WriteLine(C); break; case 3: case 2: case 1: case 0: Console.WriteLine(D); break; default:Console.WriteLine(è¯·è¾“å…¥0-100ä»¥å†…çš„æ•°å­—);break; catch Console.WriteLine(è¯·è¾“å…¥æ•°å­—æ•´æ•°); trycatch-throwfinally class Calculator public int Add(string arg1, string arg2) int a = 0; int b = 0; bool successDone = false; try a = int.Parse(arg1); b = int.Parse(arg2); successDone = true; catch (ArgumentNullException ane) Console.WriteLine(ane.Message); //Console.WriteLine(Argument cant be null); catch (FormatException fe) Console.WriteLine(fe.Message); //Console.WriteLine(Argument must be int); catch (OverflowException oe) Console.WriteLine(oe.Message); throw oe; //Console.WriteLine(Overflow); // æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œ finally if (successDone) Console.WriteLine(Success); else Console.WriteLine(Failed); int result = checked(a + b); return result; foreach å¯¹äºå®ç°IEnumerableæ¥å£çš„ç±»ï¼Œéƒ½èƒ½å¤Ÿé€šè¿‡foreachè¿›è¡Œå¾ªç¯éå†ï¼šIEnumerableç±»æœ¬èº«å®ç°äº†ä¸€äº›ç”¨äºéå†çš„æ–¹æ³•å’Œå±æ€§ï¼šMoveNext æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€é¡¹ï¼Œå¦‚æœæˆåŠŸè¿”å›trueCurrent è¿”å›å½“å‰å€¼Reset é‡ç½®å½“å‰å€¼ä½¿ç”¨IEnumerableå®ç°å¾ªç¯ï¼šListint intList = new Listint() 1, 2, 3 ;IEnumeratorint enumerator = intList.GetEnumerator();while (enumerator.MoveNext()) Console.WriteLine(enumerator.Current);ä½¿ç”¨foreachè¿›è¡Œéå†ï¼šListint intList = new Listint() 1, 2, 3 ;foreach (var current in intList) Console.WriteLine(current); 9. å­—æ®µã€å±æ€§ã€ç´¢å¼•å™¨ã€å¸¸é‡å®ä¾‹å­—æ®µé™æ€å­—æ®µpublicstaticstatic void Main(string[] args) ListTeamMember MemberList = new ListTeamMember(); for (int i = 0; i 10; i++) TeamMember Member = new TeamMember(æ— åæ° + i, å£«å…µ); /** * å›¢é˜Ÿåç§°ï¼šä½œæˆ˜å°é˜Ÿ * å›¢é˜Ÿæˆå‘˜ï¼š10 */ TeamMember.Intro();class TeamMember // å®ä¾‹å­—æ®µ public int Health = 100; // é™æ€å­—æ®µ public static int Amount; // åªè¯»é™æ€å­—æ®µ public readonly static string TeamName = ä½œæˆ˜å°é˜Ÿ; // åªè¯»å®ä¾‹å­—æ®µ public readonly string Progress; public readonly string Name; // æ„é€ å‡½æ•° // åªè¯»å®ä¾‹å­—æ®µåœ¨æ„é€ å‡½æ•°é‡Œè¿›è¡Œåˆå§‹åŒ– public TeamMember(string name,string progress) this.Progress = progress; this.Name = name; TeamMember.Amount++; // é™æ€æ–¹æ³• public static void Intro() // é™æ€æ–¹æ³•ä¸­è®¿é—®é™æ€å˜é‡ Console.WriteLine(å›¢é˜Ÿåç§°ï¼š0, TeamMember.TeamName); Console.WriteLine(æˆå‘˜æ•°é‡ï¼š0, TeamMember.Amount); åªè¯»å­—æ®µ readonlyæ— è®ºæ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œreadonlyå˜é‡éƒ½ä¸èƒ½ä¿®æ”¹ï¼šstatic void Main(string[] args) // æ— æ³•è¿›è¡Œæ›´æ”¹æ“ä½œï¼š //Brush.DefaultColor.Green = 0; Brush.PrintDefaultColor(); Console.ReadKey();struct Color public int Red; public int Green; public int Blue;class Brush public static readonly Color DefaultColor = new Color() Red = 0, Green = 255, Blue = 255, ; public static void PrintDefaultColor() Console.WriteLine( å½“å‰ç¬”åˆ·é¢œè‰²ï¼šRGB(0,1,2), Brush.DefaultColor.Red, Brush.DefaultColor.Green, Brush.DefaultColor.Blue ); ç§æœ‰å­—æ®µ privatestatic void Main(string[] args) TreasureBox box = new TreasureBox(); box.SetTreasure(ä¸€åªç‹—); while (true) Console.WriteLine(è¯·ç»™å‡ºå®ç®±å¯†è¯­ï¼š); string pass = Console.ReadLine(); try string treasure = box.GetTreasure(pass); Console.WriteLine(å¯†è¯­æ­£ç¡®ï¼Œä½ è·å¾—äº†ã€0ã€‘, treasure); break; catch (Exception ex) Console.WriteLine(ex.Message); Console.ReadKey();class TreasureBox // ç§æœ‰å˜é‡ï¼Œä»…èƒ½åœ¨ç±»å†…è¿›è¡Œä¿®æ”¹ private string treasure; private string pass = æœ€å¼ºæ­¦å™¨; public string GetTreasure(string pass) if (pass == this.pass) return this.treasure; else throw new Exception(å¯†ç é”™è¯¯); public void SetTreasure(string treasure) this.treasure = treasure; getset å®ç°å±æ€§å°è£…getset private Visual Studioå¿«æ·é”®ï¼špropfull + tabtab ï¼šå¿«é€Ÿå®šä¹‰å¹¶å°è£…ç§æœ‰å˜é‡prop + tabtab ï¼š ç®€ç•¥å£°æ˜ç§æœ‰å˜é‡ç‚¹å‡»è¦å°è£…çš„å­—æ®µ + ctrl + r + e ï¼šé‡æ„å°è£…å­—æ®µstatic void Main(string[] args) Cat cat = new Cat(); while (true) Console.Write(è¯·é€‰æ‹©æ’¸çŒ«çš„æ¬¡æ•°ï¼š); string inputNumber = Console.ReadLine(); int number = 0; try number = Int32.Parse(inputNumber); cat.PetCount += number; Console.Write(æ˜¯å¦ç»§ç»­ï¼ˆy/nï¼‰ï¼Ÿ); string input = Console.ReadLine(); if (input == n) break; catch (Exception e) Console.WriteLine(e.Message); Console.WriteLine( ================================); Console.WriteLine(æ¸¸æˆç»“æŸ); Console.WriteLine(æœ€ç»ˆäº²å¯†åº¦ï¼š0, cat.love); Console.WriteLine(================================); Console.ReadKey();class Cat public int love = 0; private int petCount; // å¯¹ç§æœ‰å±æ€§çš„å°è£…ï¼Œgetæ§åˆ¶è¯»å–ï¼Œsetæ§åˆ¶å†™å…¥ public int PetCount get return petCount; set love += value * 5; Console.WriteLine(çˆ±æ„å€¼ï¼š0, love); if (love = 100) Console.WriteLine(ä½ çš„çŒ«å› ä¸ºæ„Ÿå—åˆ°å¤ªå¤šçˆ±æ„ï¼Œå³å°†å˜èº«ç«ç®­çŒ«); petCount = value; ç´¢å¼•å™¨ Indexstatic void Index() Coffee coffee = new Coffee(); var mocaPrice = coffee[Moca]; Console.WriteLine(mocaPrice); coffee[Moca] = 15; Console.WriteLine(coffee[Moca]);class Coffee // é”®ç±»å‹ï¼šstring å€¼ç±»å‹ï¼šint private Dictionarystring, int coffeeDictionary = new Dictionarystring, int(); // indexer + tabtab public int? this[string name] get /* return the specified index here */ if (this.coffeeDictionary.ContainsKey(name)) return this.coffeeDictionary[name]; else return null; set if (value.HasValue == false) throw new Exception(Price cannot be null); /* set the specified index to value here */ if (this.coffeeDictionary.ContainsKey(name)) this.coffeeDictionary[name] = value.Value; else this.coffeeDictionary.Add(name, value.Value); 10. å‚æ•°ä¼ å€¼å‚æ•°è¾“å‡ºå‚æ•°å¼•ç”¨å‚æ•°æ•°ç»„å‚æ•°å…·åå‚æ•°å¯é€‰å‚æ•°æ‰©å±•æ–¹æ³•ï¼ˆthiså‚æ•°ï¼‰ ä¼ å€¼å‚æ•° å€¼å‚æ•°ï¼šå£°æ˜æ—¶ä¸å¸¦ä»»ä½•ä¿®é¥°ç¬¦çš„å‚æ•° ä¼ å€¼å‚æ•°ï¼šå€¼ç±»å‹ å‚æ•°ä½œä¸ºä¼ å€¼çš„å‰¯æœ¬static void ValueParam_1() Player player = new Player(); string words = æˆ‘æ˜¯ä¸€ä¸ªæ™®é€šçš„æ—¥æœ¬é«˜ä¸­ç”Ÿ; Player.Say(words); // ä¸»äººå…¬:æˆ‘æ˜¯ä¸€ä¸ªæ™®é€šçš„æ—¥æœ¬é«˜ä¸­ç”Ÿ Console.WriteLine(words); // æˆ‘æ˜¯ä¸€ä¸ªæ™®é€šçš„æ—¥æœ¬é«˜ä¸­ç”Ÿclass Player public readonly static string name = ä¸»äººå…¬; // å€¼å‚æ•°ï¼šå£°æ˜ä¸å¸¦ä»»ä½•ä¿®é¥°ç¬¦çš„å‚æ•° // å‚æ•°ä½œä¸ºä¼ å€¼çš„å‰¯æœ¬ public static void Say(string words) words = Player.name + ï¼š + words; Console.WriteLine(words); ä¼ å€¼å‚æ•°ï¼šå¼•ç”¨ç±»å‹ ç›´æ¥ä¿®æ”¹å‚æ•°å¼•ç”¨çš„å†…å­˜åœ°å€ï¼ˆnewæ“ä½œï¼‰æ—¶ï¼Œå‡½æ•°å†…å¯¹å‚æ•°çš„ä¿®æ”¹ä¸ä¼šå½±å“è¢«ä¼ å…¥å€¼GetHashCodeï¼š è·å–å¼•ç”¨ç±»å‹æŒ‡å‘çš„åœ°å€static void ValueParam_2() // é€šè¿‡newæ“ä½œåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„å‰¯æœ¬ Progress oldPro = new Progress() type = Rapper ; IntroProgress(oldPro); Console.WriteLine(0ï¼š1, oldPro.GetHashCode(), oldPro.type);static void IntroProgress(Progress pro) pro = new Progress() type = Dancer ; Console.WriteLine(0ï¼š1,pro.GetHashCode() ,pro.type); class Progress public string type get; set; ç›´æ¥å¯¹ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ä¼ å€¼å‚æ•°çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹è¢«ä¼ å…¥å‚æ•°è¿›è¡Œä¿®æ”¹ï¼šstatic void ValueParam_3() Enemy enemy = new Enemy() Status = è¢«å‡»ä¸­ ; UpdateEnemy(enemy); Console.WriteLine(0ï¼š1,enemy.GetHashCode(), enemy.Status );static void UpdateEnemy(Enemy enemy) enemy.Status = æ­»äº¡; Console.WriteLine(0ï¼š1, enemy.GetHashCode(), enemy.Status);class Enemy private string status; public string Status get return status; set status = value; å¼•ç”¨å‚æ•° ref å¼•ç”¨ç±»å‹ä½¿ç”¨refè¿›è¡Œæ ‡è¯† å¼•ç”¨å‚æ•°ï¼šå€¼ç±»å‹ static void RefererParam_1() int x = 10; IWantSideEffect(ref x); Console.WriteLine(x);// ä½¿ç”¨refè¿›è¡Œæ ‡è¯†static void IWantSideEffect(ref int x) x = x + 1; å¼•ç”¨å‚æ•°ï¼šå¼•ç”¨ç±»å‹ static void RefererParam_2() Weapen weapen = new Weapen() name = å°åˆ€ ; Console.WriteLine(HashCode:0 name:1,weapen.GetHashCode(), weapen.name); Console.WriteLine(--------------------------------); UpdateWeapen(ref weapen); Console.WriteLine(HashCode:0 name:1, weapen.GetHashCode(), weapen.name);static void UpdateWeapen(ref Weapen weapen) weapen = new Weapen() name = é’¢ä¸ ; Console.WriteLine(HashCode:0 name:1, weapen.GetHashCode(), weapen.name);class Weapen public string name get; set; è¾“å‡ºå½¢å‚ outoutå’Œrefæ•ˆæœç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºoutå¯ä»¥ä¼ å…¥nullå€¼ï¼Œå¹¶ä¸”å¿…é¡»åœ¨å‡½æ•°ä½“ä¸­è¿›è¡Œèµ‹å€¼double.TryParseæ–¹æ³•ä½¿ç”¨çš„å°±æ˜¯outä¼ å‚ï¼šstatic void OutputParam() Console.Write(è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼ˆä¸è¦è½»æ˜“å°è¯•æ•°å­—ä»¥å¤–çš„è¾“å…¥ï¼Œå¦åˆ™...ï¼‰ï¼š); string input = Console.ReadLine(); double inputValue = 0; if (double.TryParse(input, out inputValue)) Console.WriteLine(ä½ æŒ‰ç…§è¦æ±‚è¾“å…¥äº†æ•°å­—ï¼š0, inputValue); else Console.WriteLine(ä½ æ²¡æœ‰æŒ‰ç…§è¦æ±‚è¾“å…¥ï¼Œåº”å½“å—åˆ°æƒ©ç½š);outå£°æ˜å€¼ç±»å‹å‚æ•°ï¼šstatic void TryOut_1 () Console.Write(è¯·æä¾›æ–™ç†é£Ÿæï¼š); string material = Console.ReadLine(); string food = ç©ºç©ºå¦‚ä¹Ÿ; Cooker.CookFood(material,out food); Console.WriteLine(ä½ è·å¾—äº†ï¼šä¸€ä»½0, food);class Cooker public static void CookFood(string material, out string food) if (material != ) if (material.Contains(è‚‰)) food = çƒ­ä¹ä¹çš„ç‚–è‚‰; else if (material.Contains(é¢ç²‰)) food = æ–°é²œå‡ºç‚‰çš„é¢åŒ…; else if (material.Contains(å¥¶æ²¹)) food = é‡‘è‰²å¥¶æ²¹è›‹ç³•; else food = ç¾å‘³æ–™ç†; else food = ç©ºæ°”æ–™ç†; outå£°æ˜å¼•ç”¨ç±»å‹static void TryOut_2() Console.Write(è¯·ä¸ºæ‚¨çš„å·§å…‹åŠ›å–ä¸€ä¸ªåå­—ï¼š); string name = Console.ReadLine(); Console.Write(è¯·ç”¨ä¸€ä¸ªè¯å½¢å®¹å®ƒçš„é£å‘³ï¼š); string flavor = Console.ReadLine(); Chocolate chocolate = null; ChocolateFactory(name, flavor, out chocolate); if (chocolate != null) chocolate.Intro(); else Console.WriteLine(ç”Ÿäº§å¤±è´¥ï¼Œæ˜¯ä¸æ˜¯æ¼äº†ä»€ä¹ˆï¼Ÿ); static bool ChocolateFactory(string name, string flavor, out Chocolate chocolate) chocolate = null; if (name != flavor != ) chocolate = new Chocolate() name = name, flavor = flavor; chocolate.wrapper = é”¡çº¸åŒ…è£…â†’çƒ«é‡‘èŠ±çº¹; return true; return false;class Chocolate public string name get; set; public string flavor get; set; public string wrapper get; set; public void Intro() Console.WriteLine(æ–°æ¬¾å·§å…‹åŠ›ï¼š0ï¼Œæ–°å£å‘³ï¼š1ï¼Œæ–°åŒ…è£…ï¼š2, this.name, this.flavor, this.wrapper); æ•°ç»„å‚æ•° paramsä½¿ç”¨æ•°ç»„å‚æ•°å£°æ˜ï¼Œä¼šè‡ªåŠ¨å°†ä¼ å‚æ”¶é›†ä¸ºæ•°ç»„æ ¼å¼ï¼Œæ•°ç»„å‚æ•°åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œå¹¶ä¸”æ˜¯è¢«å£°æ˜çš„æœ€åä¸€ä¸ªå‚æ•°static void ArrayParam() // ä¸ä½¿ç”¨æ•°ç»„å‚æ•°çš„æ–¹æ³•ï¼š //int[] intArray = new int[] 1, 2, 3, 4, 5 ; //int sum = CalculateSum(intArray); int sum = CalculateSum(1, 2, 3, 4, 5); Console.WriteLine(sum);static int CalculateSum(params int[] intArray) int sum = 0; for (int i = 0; i intArray.Length; i++) sum += intArray[i]; return sum;string.Splitæ–¹æ³•å‚æ•°å£°æ˜çš„æ–¹å¼å°±æ˜¯paramsstatic void UseSplit() string str = ç©ºè°ƒ;å†°ç®±,å†°æ·‡æ·‹.å¤§æµ·; // æ­¤å¤„splitå‚æ•°ä¸ºæ•°ç»„ä¼ å‚ string[] result = str.Split(;,,,.); foreach (string word in result) Console.WriteLine(word); å…·åå‚æ•°ä¸€ç§å…è®¸ä¹±åºçš„ä¼ å‚æ–¹å¼ï¼šstatic void NameParam() LoadGame(å­˜æ¡£1,DateTime.Now); LoadGame(time: DateTime.Now, name:æœªå‘½åå­˜æ¡£);static void LoadGame(string name, DateTime time) Console.WriteLine(æ–°å»ºå­˜æ¡£ï¼š0 åˆ›å»ºæ—¶é—´ï¼š1, name, time.ToString()); å¯é€‰å‚æ•°å¯é€‰å‚æ•°éœ€è¦èµ‹é»˜è®¤å€¼ï¼šstatic void SelectableParam() OrderCoffee(orderer:å¼ ä¸‰, name:å†°ç¾å¼); OrderCoffee();static void OrderCoffee(string name = æ‹›ç‰Œæ‹¿é“, string orderer = æ— åæ°) Console.WriteLine(æ‚¨æ”¶åˆ°äº†æ–°çš„ç¾å›¢è®¢å•ï¼š0ä¸€ä»½ è®¢é¤äººï¼š1,name, orderer); æ‰©å±•æ–¹æ³• thisä½¿ç”¨thisæ ‡è¯†å‚æ•°ï¼Œèƒ½å¤Ÿå®ç°æ‰©å±•æ–¹æ³•å¯¹doubleç±»å‹çš„æ‰©å±•ï¼š// 3. å¿…é¡»æ˜¯é™æ€ç±»// 4. é™æ€ç±»å‘½åæ ‡å‡†ï¼š// SomeTypeç±» æ‰©å±•â†’ SomeTypeExtensionç±»static class DoubleExtension // 1. æ–¹æ³•å¿…é¡»æ˜¯public static // 2. å½¢å‚ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯thisä¿®é¥° public static double Round(this double input, int digits) double result = Math.Round(input, digits); return result; Linq Language Integrated Query è¯­è¨€é›†æˆæŸ¥è¯¢Linqå†…å®ç°äº†å¯¹Enumerableçš„æ‰©å±•static void UseExtension() Listint myList = new Listint 11, 12, 13, 14 ; bool res = myList.All(i = i 10); bool result = AllGreaterThenTen(myList); Console.WriteLine(result); 11. å§”æ‰˜Actionã€Funcæ–¹æ³•å§”æ‰˜å°±æ˜¯å°†æ–¹æ³•ï¼Œç”¨æŒ‡é’ˆè¿›è¡Œè°ƒç”¨ï¼Œä¸€èˆ¬ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼šæ¨¡æ¿æ–¹æ³•å›è°ƒæ–¹æ³•å§”æ‰˜æ–¹æ³•1ï¼šAction + Invokestatic void Fun()Action action = new Action(Fun)action.Invoke()å§”æ‰˜æ–¹æ³•2ï¼šFuncæ³›å‹å£°æ˜static int Add(int x, int y)return x + y;static int Minus(int x, int y)return x - y;Funcint, int, int delegateAdd = new Funcint, int, int(Add);Funcint, int, int delegateMinus = new Funcint, int, int(Add);delegateAdd.Invoke(10,20);delegateMinus.Invoke(10,20); delegateå£°æ˜delegateç±»ä¼¼äºå£°æ˜ä¸€ä¸ªæ–¹æ³•ç­¾åï¼Œå£°æ˜ä¸€ä¸ªæœ‰å‚æ•°å’Œè¿”å›å€¼ç‰¹ç‚¹çš„æ¨¡å…·static void DelegateClass() Calculate calculator = new Calculate(); Calc calcAdd = new Calc(calculator.Add); Calc calcSub = new Calc(calculator.Sub); Calc calcMul = new Calc(calculator.Mul); Calc calcDiv = new Calc(calculator.Div); double x = 10, y = 20; calcAdd(x, y); calcSub(x, y); calcMul(x, y); calcDiv(x, y);// å§”æ‰˜ä¸å°è£…æ–¹æ³•å¿…é¡»ç±»å‹å…¼å®¹public delegate double Calc(double x, double y); class Calculate public double Add(double x, double y) return x + y; public double Sub(double x, double y) return x - y; public double Mul(double x, double y) return x * y; public double Div(double x, double y) return x / y; æ¨¡ç‰ˆæ–¹æ³•å’Œå›è°ƒæ–¹æ³•static void TempFunc() WrapFactory wrapFact = new WrapFactory(); ProductFactory prodFact = new ProductFactory(); Logger logger = new Logger(); ActionProduct log = new ActionProduct(logger.Log); FuncProduct ChocoFact = new FuncProduct(prodFact.MakeChocolate); FuncProduct PizzaFact = new FuncProduct(prodFact.MakePizza); Box chocoBox = wrapFact.Wrap(ChocoFact, log); Box pizzaaBox = wrapFact.Wrap(PizzaFact, log); chocoBox.Open(); pizzaaBox.Open(); class Logger public void Log(Product product) Console.WriteLine(äº§å“ 0| ç”Ÿäº§æ—¶é—´ 1 | ä»·æ ¼ 2, product.Name, DateTime.UtcNow, product.Price); class Product public string Name get; set; public double Price get; set; class Box public Product Product get; set; public void Open() if (this.Product == null) Console.WriteLine(ç›’å­é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰); return; Console.WriteLine(æ‰“å¼€ç›’å­ï¼Œé‡Œé¢æ˜¯0,this.Product.Name); class WrapFactory public Box Wrap(FuncProduct GetProduct, ActionProduct logCallback) Box box = new Box(); // æ¨¡æ¿æ–¹æ³• box.Product = GetProduct.Invoke(); // å›è°ƒæ–¹æ³• logCallback(box.Product); return box; class ProductFactory public Product MakeChocolate() Product product = new Product(); product.Name = æ—ºå¡å·§å…‹åŠ›; product.Price = 15; return product; public Product MakePizza() Product product = new Product(); product.Name = ç›æ ¼ä¸½ç‰¹æŠ«è¨; product.Price = 50; return product; ä½¿ç”¨Interfaceæ¥å£ä»£æ›¿delegateå§”æ‰˜æ¥å£å£°æ˜ä¸å®ç°interface IProductFactory Product Make();class CandyFactory : IProductFactory public Product Make() Product product = new Product(); product.Name = ç³–æœ; product.Price = 15.0; return product; class BreadFactory : IProductFactory public Product Make() Product product = new Product(); product.Name = å·§å…‹åŠ›é¢åŒ…; product.Price = 20.0; return product; ä¿®æ”¹åŸæœ¬çš„å§”æ‰˜æ–¹æ³•å‚æ•°ä¸ºæ¥å£å‚æ•°ï¼šclass WrapFactory public Box Wrap(IProductFactory prodFact, ActionProduct logCallback) Box box = new Box(); box.product = prodFact.Make(); logCallback(box.product); return box; ä¿®æ”¹æ–¹æ³•è°ƒç”¨çš„ä¼ å‚ï¼šstatic void Main(string[] args) WrapFactory wrapFact = new WrapFactory(); IProductFactory candyFact = new CandyFactory(); IProductFactory breadFact = new BreadFactory(); Log log = new Log(); ActionProduct logging = new ActionProduct(log.Logging); Box candyBox = wrapFact.Wrap(candyFact, logging); Box breadBox = wrapFact.Wrap(breadFact, logging); Console.ReadKey(); å¤šæ’­å§”æ‰˜ï¼ˆmulticastï¼‰å°†å¤šæ’­è¿›è¡Œåˆå¹¶ï¼ŒæŒ‰ç…§åˆå¹¶é¡ºåºæ‰§è¡Œstatic void Multicast() Student stu1 = new Student() ID = 1, PenColor = ConsoleColor.Yellow ; Student stu2 = new Student() ID = 2, PenColor = ConsoleColor.Green ; Student stu3 = new Student() ID = 3, PenColor = ConsoleColor.Red ; Action action1 = new Action(stu1.DoHomework); Action action2 = new Action(stu2.DoHomework); Action action3 = new Action(stu3.DoHomework); action1 += action2; action1 += action3; action1.Invoke();class Student public int ID get; set; public ConsoleColor PenColor get; set; public void DoHomework() for (int i = 0; i 5; i++) Console.ForegroundColor = this.PenColor; Console.WriteLine(Student 0 doing homework 1 hour(s), this.ID, i); Thread.Sleep(500); å®ç°å¼‚æ­¥çš„æ–¹æ³•å®ç°å¼‚æ­¥çš„ä¸‰ç§æ–¹æ³•ï¼šéšå¼å¼‚æ­¥ BeginInvokeAction action1 = new Action(Func1);Action action2 = new Action(Func2);Action action3 = new Action(Func3);// éšå¼å¼‚æ­¥è°ƒç”¨action1.BeginInvoke(null, null);action2.BeginInvoke(null, null);action3.BeginInvoke(null, null);çº¿ç¨‹ ThreadThread thread1 = new Thread(new ThreadStart(Func1));Thread thread2 = new Thread(new ThreadStart(Func2));Thread thread3 = new Thread(new ThreadStart(Func3));thread1.Start();thread2.Start();thread3.Start();TaskTask task1 = new Task(new Action(Func1));Task task2 = new Task(new Action(Func2));Task task3 = new Task(new Action(Func3));task1.Start();task2.Start();task3.Start(); 12. äº‹ä»¶äº‹ä»¶åŸºæœ¬æ¦‚å¿µäº‹ä»¶çš„è§¦å‘ä¸å“åº” äº‹ä»¶çš„æœ¬è´¨æ˜¯å‡è£…åœ¨å§”æ‰˜å­—æ®µä¸Šçš„ä¸€ä¸ªè’™ç‰ˆäº‹ä»¶æ¨¡å‹ç»„æˆéƒ¨åˆ†ï¼šäº‹ä»¶æ‹¥æœ‰è€… eventSourceäº‹ä»¶æˆå‘˜ eventäº‹ä»¶å“åº”è€… eventSubscriberäº‹ä»¶å¤„ç†å™¨ eventHandleräº‹ä»¶è®¢é˜…æŒ‚æ¥äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨çš„æ˜¯è¯­æ³•ç³–ï¼ševentSource.evnet += eventSubscriber.eventSubscriber;è§¦å‘Timer.Elapsedäº‹ä»¶ï¼šstatic void UseEvent() System.Timers.Timer timer = new System.Timers.Timer(); timer.Interval = 1000; Boy boy = new Boy(); Girl girl = new Girl(); timer.Elapsed += boy.Action; timer.Elapsed += girl.Action; timer.Start();class Boy internal void Action(object sender, ElapsedEventArgs e) Console.WriteLine(Jump); class Girl internal void Action(object sender, ElapsedEventArgs e) Console.WriteLine(Sing); static void UseEvent() ExtendForm form = new ExtendForm(); form.ShowDialog();class ExtendForm : Form private TextBox textBox; private Button button; public ExtendForm() this.textBox = new TextBox(); this.button = new Button(); this.button.Text = Click Me; this.button.Top = 150; this.Controls.Add(this.button); this.Controls.Add(this.textBox); this.button.Click += this.ButtonClicked; private void ButtonClicked(object sender, EventArgs e) this.textBox.Text = Hello, World!; äº‹ä»¶ç»‘å®šçš„å‡ ç§æ–¹å¼ è¢«ç»‘å®šäº‹ä»¶çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼å¦‚ä¸‹ï¼šprivate void ButtonClick(object sender, EventArgs e)è¯­æ³•ç³–this.button.Click += this.ButtonClickEventHandlerthis.button.Click += new EventHandler(this.ButtonClick)delegate åŒ¿åå‡½æ•°å§”æ‰˜this.button.Click += delegate (object sender, EventArgs e) this.textBox1.Text = Button Clicked; lambdaè¡¨è¾¾å¼this.button,Click += (sender, e) = // event detail å®ç°æ•´ä½“äº‹ä»¶æµç¨‹ä¸‹é¢æ˜¯ä¸€ä¸ªç‚¹é¤çš„äº‹ä»¶æ¨¡å‹ï¼šäº‹ä»¶æ‹¥æœ‰è€…ï¼šCustomerå®¢æˆ·äº‹ä»¶æˆå‘˜ï¼šOrderEventArgsç‚¹é¤äº‹ä»¶å“åº”è€…ï¼šWaiteræœåŠ¡å‘˜äº‹ä»¶å¤„ç†å™¨ï¼šActioné€é¤äº‹ä»¶è®¢é˜…ï¼šä¸ºå®¢æˆ·çš„ç‚¹é¤äº‹ä»¶æŒ‡æ´¾ä¸€ä¸ªæœåŠ¡å‘˜å¹¶è¿›è¡Œå“åº”å®šä¹‰ç‚¹é¤äº‹ä»¶å§”æ‰˜ï¼Œä»¥åŠäº‹ä»¶å‚æ•°ï¼špublic delegate void OrderEventHandler(Customer customer, OrderEventArgs e);public class OrderEventArgs : EventArgs public string DishName get; set; // è®¢é¤èœå public string Size get; set; // è®¢é¤åˆ†é‡å®šä¹‰å®¢æˆ·ï¼špublic class Customer public double Bill get; set; // æ”¯ä»˜è´¦å• public void PayBill() Console.WriteLine(Pay the billï¼š0, this.Bill); // èµ°è¿› public void WalkIn() Console.WriteLine(Walk In,,,); // æ‰¾ä½ç½®åä¸‹ public void SitDown() Console.WriteLine(Sit Down...); ä¸ºCustomerç±»å£°æ˜äº‹ä»¶ç±»å‹å±æ€§ï¼špublic class Customer // å£°æ˜äº‹ä»¶ private OrderEventHandler orderEventHandler; public event OrderEventHandler Order add this.orderEventHandler += value; remove this.orderEventHandler -= value; ç®€åŒ–å†™æ³•ï¼špublic class Customer public event OrderEventHandler Order;å®šä¹‰æœåŠ¡å‘˜ä»¥åŠè®¢é¤å“åº”æ–¹æ³•ï¼špublic class Waiter internal void Action(Customer customer, OrderEventArgs e) Console.WriteLine(Got Order: 0, e.DishName); double price = 10; switch (e.Size) case small: price *= 0.5; break; case big: price *= 1.5; break; default: break; customer.Bill += price; ä¸ºå®¢æˆ·å®šä¹‰äº‹ä»¶è§¦å‘æ–¹æ³•ï¼špublic class Customer public void Thinking() for (int i = 0; i 3; i++) Console.WriteLine(Thinking...); Thread.Sleep(1000); if (this.orderEventHandler != null) OrderEventArgs e = new OrderEventArgs(); e.DishName = French Eggs; e.Size = small; this.orderEventHandler.Invoke(this, e); // è§¦å‘äº‹ä»¶ public void Action() Console.ReadLine(); this.WalkIn(); this.SitDown(); this.Thinking(); é€šè¿‡äº‹ä»¶è§¦å‘å’Œå“åº”ä¸²é€šæ•´ä¸ªæµç¨‹ï¼šCustomer customer = new Customer();Waiter waiter = new Waiter();customer.Order += waiter.Action;customer.Action();customer.PayBill(); 13. ç±»ææ„å‡½æ•° destructorææ„å‡½æ•°å’Œconstructç›¸å¯¹åº”ï¼Œåœ¨å®ä¾‹è¢«é”€æ¯æ—¶æ‰§è¡Œclass Chocolate // ctor åˆ›å»ºæ„é€ å™¨å¿«æ·é”® public string Name get; set; public double Price get; set; public Chocolate(string Name, double Price) this.Name = Name; this.Price = Price; // ææ„å‡½æ•° ~Chocolate() Console.WriteLine(Chocolate 0 be destroyed, this.Name); public void Report() Console.WriteLine(this.Name); åå°„é€šè¿‡classçš„ç±»å‹åˆ›å»ºobjetæˆ–dynamicå˜é‡æ‰¿æ¥objectå®ç°åå°„ï¼šType t = typeof(Chocolate);object o = Activator.CreateInstance(t,å’–å•¡å¤¹å¿ƒå·§å…‹åŠ›,25.5);// ä¸èƒ½ç›´æ¥è°ƒç”¨Chocolateä¸Šçš„å®ä¾‹ï¼Œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼šChocolate choco = o as Chocolate;dynamicåå°„Type t = typeof(Chocolate);// åŠ¨æ€ç±»å‹å¯ä»¥ç›´æ¥è°ƒç”¨dynamic o = Activator.CreateInstance(t,å’–å•¡å¤¹å¿ƒå·§å…‹åŠ›,25.5); é™æ€æ„é€ å‡½æ•°VSCodeæ„é€ å‡½æ•°å¿«æ·é”®ï¼šctorclass Pie public static int Amount get; set; // åœ¨ç±»å£°æ˜æ—¶å°±æ‰§è¡Œ static Pie() Amount = 100; public Pie() Amount += 1; Console.WriteLine(æ¡Œå­ä¸Šæœ‰æ´¾ç«¯ä¸Šæ¥ï¼Œç°åœ¨æ˜¯0ä¸ªæ´¾, Amount); ~Pie() Amount -= 1; Console.WriteLine(æ¡Œå­ä¸Šçš„æ´¾è¢«æ‹¿èµ°äº†ï¼Œå‰©ä¸‹0ä¸ªæ´¾, Amount); ç±»çš„å£°æ˜å…³é”®å­— newpublicprotectedinternal å†…éƒ¨ç±»ï¼Œåªæœ‰åŒä¸€è£…é…é›†å†…æˆå‘˜èƒ½å¤Ÿè®¿é—®privateabstractsealed å¯†å°ç±»ä¸å¯ä½œä¸ºçˆ¶ç±»static Assembly Tip: Ctrl + - è·³è½¬åˆ°ä¸Šæ¬¡å…‰æ ‡å¿«æ·é”®æ¯ä¸ªé¡¹ç›®çš„ç¼–è¯‘ç»“æœå°±æ˜¯Assemblyè£…é…é›†ï¼ŒAssemblyä¸»è¦åˆ†ä¸º2ç±»ï¼šexe å¯æ‰§è¡Œæ–‡ä»¶dll ç±»åº“ ç±»ç»§æ‰¿C#å†…æ‰€æœ‰ç±»çš„åŸºç±»éƒ½æ˜¯ObjectType t = typeof(Candy);Type tb = t.BaseType;Console.WriteLIne(tb.FullName); // System.Objectå¸¦æœ‰sealedå…³é”®å­—å£°æ˜çš„ç±»æ— æ³•è¢«ç»§æ‰¿ï¼Œpublic sealed NoChildClassc#ä¸­åªèƒ½ç»§æ‰¿è‡ªä¸€ä¸ªåŸºç±»ï¼Œä½†èƒ½å®ç°å¤šä¸ªåŸºæ¥å£å­ç±»çš„è®¿é—®æƒé™ä¸èƒ½è¶…è¿‡çˆ¶ç±» ç±»æ‰©å±• ç±»ç»§æ‰¿å°±æ˜¯å¯¹çˆ¶ç±»è¿›è¡Œæ¨ªå‘å’Œçºµå‘çš„æ‰©å±•ï¼šæ¨ªå‘ï¼š ç±»å±æ€§å’Œæ–¹æ³•çš„å¢åŠ çºµå‘ï¼šå¯¹çˆ¶ç±»å†…å±æ€§å’Œæ–¹æ³•çš„é‡å†™class Chocolate : Candy public Chocolate(string subMaterial) this.mainMaterial = coco + subMaterial; class MilkChocolate : Chocolate // è¡¨ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°æ—¶ä¼ é€’å‚æ•° // æ„é€ å™¨æ—¶ä¸èƒ½è¢«ç»§æ‰¿çš„ public MilkChocolate():base(milk) this.mainMaterial = coco + milk; public void ShowParentMat() Console.WriteLine (base.mainMaterial); ç±»ç»§æ‰¿å’Œç±»æˆå‘˜è®¿é—®çº§åˆ«å…³ç³» é‡å†™å¤šæ€é‡å†™æ ‡è¯†ç¬¦ï¼šçˆ¶ç±» virtualå­ç±» overrideéšè—å’Œé‡å†™çš„åŒºåˆ«ï¼šæ–¹æ³•å±æ€§ä¸åŠ é‡å†™æ ‡è¯†ï¼Œç®—ä½œå­ç±»å¯¹çˆ¶ç±»çš„éšè—éšè—ä¸‹çˆ¶å­ç±»ä¹‹é—´æ²¡æœ‰ç‰ˆæœ¬å…³ç³»æ–¹æ³•å’Œå±æ€§çš„é‡å†™ï¼š// çˆ¶ç±»class Candy private string flavor; public virtual string Flavor get return flavor; set flavor = value; // virtualæ ‡è¯†ç¬¦ public virtual void Cook() Console.WriteLine(Cook Candy); // å­ç±»class Chocolate: Candy private string flavor; public override string Flavor get return flavor; set flavor = å·§å…‹åŠ›+ + value; // overrideæ ‡è¯†ç¬¦ public override void Cook() Console.WriteLine(Cook Chocolate); 14.æ¥å£æŠ½è±¡ç±»æ¥å£æŠ½è±¡ç±»å‡½æ•°æˆå‘˜å¹¶æœªå®Œå…¨å®ç°çš„ç±»è™šæ–¹æ³•æˆå‘˜å¿…é¡»æ˜¯publicæ ‡è¯†ä¸èƒ½å®ä¾‹åŒ–ï¼Œéœ€è¦é æ´¾ç”Ÿç±»æ¥å®ç°æŠ½è±¡æ–¹æ³•çº¯è™šæ–¹æ³•å£°æ˜å…³é”®å­—ï¼šabstractå­æ–¹æ³•å®ç°å…³é”®å­—ï¼šoverrideæ¥å£åŠŸèƒ½ç­‰åŒäºçº¯æŠ½è±¡ç±»// æ¥å£interface IFood void Cook(); void Eat();// æŠ½è±¡ç±»abstract class Candy: IFood public void Eat() Console.WriteLine(ç¾å‘³ï¼) public abstract void Cook();class Chocolate: Candy public override void Cook() Console.WriteLine(Cooking Chocolate...) æ¾è€¦åˆæ¾è€¦åˆ ä½¿ç”¨æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“ç±»æ¥ä½œä¸ºå¦ä¸€ä¸ªç±»çš„æˆå‘˜çš„ç±»å‹ï¼Œæ¥å£ç±»æˆå‘˜ä½¿ç”¨è¯¥ç±»çš„å®ç°ç±»èµ‹å€¼å‡è½»ä¸¤ä¸ªç±»ä¹‹é—´çš„è€¦åˆå…³ç³»æ¥å£å®ç°ï¼špublic interface ICoffin double HasCoffin();æ¥å£å®ç°ç±»ï¼špublic class Coffee: ICoffin public double HasCoffin() return 30.0; ä¸»åŠ¨è€¦åˆç±»ï¼špublic class Custom ICoffin _coffee; public Custom(ICoffin coffee) _coffee = coffee; public string Drink() double coffin = _coffee.HasCoffin(); string mes = ; if(coffin = 0) mes = æ— å’–å•¡å›  else if(coffin=30) mes = ä½å’–å•¡å›  else if(coffin=60) mes = é€‚é‡å’–å•¡å›  else if(coffin=100) mes = å’–å•¡é«˜æµ“åº¦å›  else mes = â€œè‡´æ­»é‡å’–å•¡å› â€ ä¸»åŠ¨è€¦åˆç±»çš„è°ƒç”¨ï¼šCustom custom = new Ciustom(new Coffee());custom.Drink(); å•å…ƒæµ‹è¯•è§£å†³æ–¹æ¡ˆ â†’ æ·»åŠ æ–°é¡¹ç›® â†’ xUnitæµ‹è¯•æ¾è€¦åˆçš„2ç§æµ‹è¯•æ–¹å¼ï¼šåˆ›å»ºç±»Moqæ–¹å¼ä¸€ï¼šåˆ›å»ºç±»public class CoffeeTests [Fact] public void NoneCoffInCoffee_OK() var custom = new Custom(new NoneCoffinCoffee()); var actual = custom.Drink(); var expected = æ— å’–å•¡å› æ·»åŠ ; Assert.Equal(expected, actual); class NoneCoffinCoffee: InterfaceLearning.ICoffin public double HasCoffin() return 0; æ–¹å¼äºŒï¼šMoqç”¨NuGetæœç´¢ä¸‹è½½å¼•å…¥Moqpublic class CoffeeTests [Fact] public void NoneCoffInCoffee_OK() var mock = new MockICoffin(); mock.Setup(coffin = coffin.HasCoffin()).Returns(()=0); var custom = new Custom(mock.Object); var actual = custom.Drink(); var expected = æ— å’–å•¡å› æ·»åŠ ; Assert.Equal(expected, actual);","tags":["ç¼–ç¨‹è¯­è¨€"]},{"title":"ä¼ä¸šå¯è§†åŒ–å¤§å±ï¼šåŸºäºEChartså®ç°çš„æ°´çƒæ°”æ³¡æ•£ç‚¹å›¾","path":"/2024/05/13/LiquidScatter/","content":"é¡¹ç›®ç®€ä»‹é¢„è§ˆåœ°å€é¡¹ç›®æ•ˆæœæ’‡å¼€åˆ—è¡¨è¿›åº¦æ¡ç¯å½¢å›¾è¿™ç§æ¯”è¾ƒä¸€èˆ¬çš„å›¾è¡¨ä¸çœ‹ï¼Œæ•´ä¸ªé¡¹ç›®çš„ä¸»è¦éš¾ç‚¹å°±åœ¨äºæ•£ç‚¹å›¾ã€æ•£ç‚¹å›¾å’Œå®ƒä¹‹åä¸åœ†ç¯å›¾çš„äº¤äº’ï¼Œè¿™ä¹Ÿæ˜¯å®ƒçš„ä¸»è¦äº®ç‚¹ã€‚ é¡¹ç›®éš¾ç‚¹é¡¹ç›®éš¾ç‚¹ æ‹¿åˆ°è®¾è®¡å›¾ä¹‹åï¼Œé¦–å…ˆæ³¨æ„åˆ°å‡ ä¸ªéš¾ç‚¹ï¼šæ°´çƒæ°”æ³¡æ•£ç‚¹å›¾å¦‚ä½•å®ç°å•ä¸ªæ°´çƒå›¾æ°´çƒå›¾å¦‚ä½•æ˜ å°„åˆ°åæ ‡ç³»ä¸­æ°´çƒ+å¤–ç¯å›¾å¦‚ä½•å®ç°è¿™ä¸ªå›¾æ€ä¹ˆå®ç°å’Œå¤–ä¾§æ°´çƒå›¾çš„äº¤äº’åŠ¨ç”»ä»»åŠ¡è¿›åº¦å·¥æ—¶è¶‹åŠ¿æ—¶é—´çº¿å›¾ æŠ€æœ¯é€‰å‹å¼€å‘æ¡†æ¶ Vue3+Vite éƒ½æ˜¯æˆ‘ç”¨çš„æ¯”è¾ƒç†Ÿçš„ï¼šVue3Viteèµ„æºåŠ è½½å¯è§†åŒ–å¤§å±å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œå› æ­¤å›¾ç‰‡å°½é‡é€‰å–webpæˆ–è€…svgæ ¼å¼çš„å›¾ç‰‡æ®è¯´è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼šä¸ºäº†é¿å…é¢‘ç¹çš„å›¾ç‰‡èµ„æºè¯·æ±‚ï¼Œå°†å›¾ç‰‡éƒ½ç”¨dataURLçš„æ ¼å¼åŠ è½½ ç½‘ç»œè¯·æ±‚ axios å› ä¸ºè¿™ä¸ªé¡¹ç›®å¯¹å®æ—¶æ€§è¦æ±‚å¹¶ä¸é«˜ï¼Œå› æ­¤é‡‡ç”¨å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å®šæ—¶è¯·æ±‚çš„æ¨¡å¼ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å°±æ˜¯å½“æ•°æ®è¯·æ±‚ä¸æ¥æ—¶ï¼ˆå¯èƒ½æ˜¯åå°æœåŠ¡500ï¼Œæˆ–è€…è¿”å›ç©ºæ•°æ®ï¼‰ï¼Œè¿™é‡Œå°±æœ‰ä¸‰ç§å¤„ç†æ–¹å¼ï¼šä»€ä¹ˆéƒ½ä¸å¤„ç†ï¼Œåªå¯¹æŠ¥é”™è¿›è¡Œcatchï¼Œè¿™æ—¶é¡µé¢ä¼šç©ºç™½ï¼Œç”¨æˆ·ä½“éªŒä¼šé™ä½ç”¨loadingé¡µä½œé®ç½©ä½¿ç”¨Service Workerï¼Œå¯ä»¥æŠŠä¸Šæ¬¡è¯·æ±‚çš„ç»“æœä½œä¸ºæœ¬æ¬¡çš„ç»“æœè¿”å›ï¼Œé¡µé¢å†…æ•°æ®ä¸å˜çœ‹äº†mdnå…³äº Service Worker çš„ä»‹ç»ï¼Œä¸»è¦æ˜¯é¢å‘PWAåº”ç”¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œå†³å®šé‡‡ç”¨ä½¿ç”¨loadingé¡µä½œé®ç½©çš„æ–¹å¼ã€‚å¯è§†åŒ–å›¾è¡¨å¼€å‘è¿‡ç¨‹ä¸­çš„æ•°æ®è¯·æ±‚é—®é¢˜å¯è§†åŒ–å›¾è¡¨å¼€å‘çš„ä¸¤ä¸ªé‡ç‚¹å°±æ˜¯æ•°æ®å’Œå›¾è¡¨ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸€èˆ¬æˆ‘éƒ½ä¼šæ¨¡æ‹Ÿä¸€äº›å›¾è¡¨ç»˜åˆ¶çš„æ•°æ®ï¼Œå¹¶æŠŠå›¾ç»˜åˆ¶å‡ºæ¥ï¼Œä½†æ˜¯æ¥å£ä¸€æ—¦å¯¹æ¥ä¹‹åå°±ä¼šå‡ºç°å„ç§å„æ ·å¥‡æ€ªçš„é—®é¢˜ã€‚å¯è§†åŒ–å›¾è¡¨çš„æ•°æ®å¤„ç†çœŸçš„éå¸¸é‡è¦ï¼éå¸¸é‡è¦ï¼éå¸¸é‡è¦ï¼æ•°æ®å¤„ç†çš„å‡ ä¸ªå¯èƒ½å‡ºç°çš„é—®é¢˜å¦‚ä¸‹ï¼šåå°æä¾›æ•°æ®å’Œå‰ç«¯æ•°æ®ä¸ä¸€è‡´ï¼šåœ¨è¯·æ±‚åˆ°åå°æ•°æ®ï¼Œå’Œå¾—åˆ°æœ€ç»ˆç»˜åˆ¶å‡ºå›¾è¡¨æ•°æ®ä¹‹é—´ï¼Œå°½é‡æ¯”è¾ƒæ¸…æ™°é›†ä¸­çš„æ·»åŠ ä¸€å±‚æ•°æ®å¤„ç†å±‚ï¼Œä¸è¦æŠŠæ•°æ®å¤„ç†åˆ†æ•£åˆ°å„ç§å„æ ·å¥‡æ€ªçš„åœ°æ–¹è€ƒè™‘æ•°æ®æç«¯æƒ…å†µï¼šé™¤æ•°ä¸º0ã€æ•°ç»„é•¿åº¦ä¸º0ç­‰ç­‰ä¸€ç±»æƒ…å†µéƒ½éœ€è¦è¢«è€ƒè™‘åœ¨å†…ï¼Œè¿™äº›bugå¯èƒ½ä¼šè—å¾—å¾ˆæ·±ï¼Œåˆ°å¾ˆåæœŸçš„æ—¶å€™æ‰æ˜¾ç°å‡ºæ¥è´¯ç©¿æ•´ä¸ªå¼€å‘æµç¨‹çš„å‰ç«¯ç‹¬ç«‹æµ‹è¯•å‰æœŸä½¿ç”¨é™æ€æ•°æ®è¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœåˆ‡æ¢ä¸ºåå°æ•°æ®ï¼Œä¸­é—´é€»è¾‘å¤§æ¦‚ç‡è¦è°ƒæ•´ï¼Œç»˜åˆ¶é€»è¾‘ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœè¦æ¶‰åŠåˆ°ä¸€äº›ç»†èŠ‚éƒ¨åˆ†çš„ä¿®æ”¹ï¼Œå¯èƒ½å°±ä¼šéå¸¸å¤æ‚ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦è®©å›¾è¡¨æŸä¸ªç±»åˆ«æ˜¾ç¤ºæŸä¸ªé¢œè‰²å•¦ï¼Œå¦‚æœå¥½å·§ä¸å·§åç«¯å°±ä¸è¿”å›è¿™ä¸ªç±»åˆ«ï¼Œé‚£å°±çœ‹ä¸åˆ°æ•ˆæœæ‰€ä»¥å°±ç®—æ˜¯æ•°æ®å·²ç»ä»æ¥å£ä¸­è·å–äº†ï¼Œä¹Ÿä¸€å®šè¦åšå¥½æµ‹è¯•æ•°æ®çš„ç”Ÿæˆï¼Œå°†æµ‹è¯•æ•°æ®å’Œåå°æ•°æ®åŒæ­¥åå°æœåŠ¡æ–­å¼€æ—¶ï¼Œå‰ç«¯è¦æœ‰ç¦»çº¿æ¨¡å¼ç»§ç»­æ”¯æ’‘å¼€å‘å›¾è¡¨å¼€å‘çš„æ•°æ®æºå¼€å‘ä¾èµ–æ•°æ®è¿›è¡Œå±•ç¤ºçš„å¯è§†åŒ–é¡¹ç›®ï¼Œé¡µé¢çš„å±•ç¤ºä¾èµ–æ•°æ®é©±åŠ¨ã€‚å›¾è¡¨çš„å¼€å‘æ¯”è¾ƒç‰¹æ®Šï¼Œæ¯”å¦‚EChartsï¼Œåœ¨ä½¿ç”¨viteæä¾›çš„å¼€å‘ç¯å¢ƒä¸‹ï¼Œä¿®æ”¹ä»£ç è§¦å‘çš„çƒ­æ›´æ–°æ— æ³•é©±åŠ¨é¡µé¢EChartså›¾è¡¨çš„é‡ç»˜ï¼Œæ‰€ä»¥å°±éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨åˆ·æ–°é¡µé¢æŸ¥çœ‹ä¿®æ”¹åçš„æ•ˆæœï¼Œæ›´è‡´å‘½çš„æ˜¯ï¼Œè¶Šåˆ°åæœŸï¼Œå›¾è¡¨çš„å¾®è°ƒå°±æœ‰å¯èƒ½è¶Šå¤æ‚ï¼Œè¿™æ—¶å¦‚æœå›¾è¡¨çš„æ•°æ®æºå·²ç»ä½¿ç”¨æ¥å£æ•°æ®äº†ï¼Œå°±éœ€è¦ç­‰å¾…æ¥å£æ•°æ®åˆ°æ¥ï¼ˆæ•°æ®é‡å°‘è¿˜å¥½ï¼Œæ•°æ®é‡å¤šç®€ç›´æ˜¯æŠ˜ç£¨ï¼‰ä»¥å‰å‚ä¸å¼€å‘çš„ä¸€ä¸ªå«æ˜Ÿè½¨è¿¹å›¾å°±æœ‰è¿™ç§æƒ…å†µï¼Œä¸Šç™¾æ¡å«æ˜Ÿå¸¦ç€å„è‡ªåœ¨æ—¶é—´æ®µé‡Œçš„è½¨è¿¹æ•°æ®å¯¹å«æ˜Ÿç‚¹è¿¹è¿›è¡Œå¾®è°ƒæ—¶ï¼Œè¦ç”¨3-7sè·å–åå°æ•°æ®ï¼Œå†æ¸²æŸ“ï¼Œå†æŸ¥çœ‹æ•ˆæœï¼Œå¥½çª’æ¯è¿™ä¸ªæ—¶å€™ä¸€èˆ¬éƒ½ä¼šæ­å»ºä¸€ä¸ªä¸´æ—¶çš„æœåŠ¡å™¨ï¼Œæ¨¡æ‹Ÿåå°æ¥å£ï¼Œè¿”å›å›ºå®šæ•°æ® å›¾è¡¨æŠ€æœ¯ï¼šECharts ä¸€å¼€å§‹é€‰ç”¨EChartsï¼Œæ˜¯è€ƒè™‘åˆ°å¼€å‘å·¥æœŸæ¯”è¾ƒæ€¥ï¼ŒæŒ‘ä¸ªæ¯”è¾ƒç†Ÿçš„åº“å°±è¡Œã€‚ä½†æ˜¯éšç€ç»˜åˆ¶çš„è¿›è¡Œï¼Œè¿˜æ˜¯è§‰å¾—å¦‚æœé€‰ç”¨ D3 ï¼Œå¯èƒ½æ›´é€‚åˆè¿™ä¸ªé¡¹ç›®ï¼ˆå¯æƒœæˆ‘å¯¹D3ä¸æ˜¯å¾ˆç†Ÿï¼‰ä½†æ˜¯æˆ‘å¯¹EChartsçš„ä¸€äº›åŸºç¡€è”åŠ¨ï¼Œæ¯”å¦‚dataZoomã€åŠ¨ç”»ã€äº‹ä»¶ç»‘å®šã€åˆ›å»ºé”€æ¯ä¹‹ç±»çš„ï¼Œæˆ‘éƒ½æ¯”è¾ƒç†Ÿæ‚‰æ€»ä½“æ¥çœ‹ï¼Œå¦‚æœæˆ‘å¯¹D3çš„ç†Ÿæ‚‰ç¨‹åº¦å…è®¸çš„è¯ï¼Œåº”è¯¥ä¼šé€‰æ‹©D3ã€‚ä½†æ˜¯ç›®å‰æ¥çœ‹EChartsç»˜åˆ¶å‡ºæ¥çš„æ•ˆæœä¹Ÿè¿˜å¯ä»¥ï¼ˆå°±æ˜¯ä¸­é—´æœ‰ç‚¹å°å·®é”™ï¼‰å›¾è¡¨çš„é€‰æ‹©äº‹å®ä¸Šï¼Œè¿™ä¸ªé¡¹ç›®æœ€åçš„å¤§éƒ¨åˆ†æ•ˆæœéƒ½èƒ½ç”¨EChartså®ç°ï¼Œå¹³é¢ç»˜åˆ¶ï¼Œå¤§å¤šæ•°æ¶‰åŠåˆ°çš„æ•ˆæœæ— éå°±æ˜¯ï¼šå°ºå¯¸ã€è‰²å½©ã€å¸ƒå±€ï¼Œé™æ€é¡µé¢çš„ç»˜åˆ¶ä¸€èˆ¬æ¶‰åŠåˆ°çš„ï¼Œå¤§å¤šæ•°ä¸»æµå›¾è¡¨åº“éƒ½èƒ½å¤Ÿå®ç°ã€‚å½“æˆ‘è¯´å›¾è¡¨çš„é€‰æ‹©æ—¶ï¼Œå®é™…ä¸Šä¸€èˆ¬éœ€è¦è€ƒè™‘çš„ï¼Œæ˜¯è¿™ä¸ªå›¾è¡¨è¦å®ç°çš„äº¤äº’çš„ä¸Šé™æ˜¯ä»€ä¹ˆã€‚å› æ­¤é¦–å…ˆå°±è¦å…ˆç†Ÿæ‚‰å„ä¸ªå›¾è¡¨åº“çš„äº¤äº’çš„ç‰¹ç‚¹ï¼Œè¿™ä¸ªå¹¶ä¸ç®€å•ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå¯ä»¥ç®€åŒ–æ€ç»´ï¼šå¦‚æœäº§å“ç»ç†å’Œè®¾è®¡æ ¹æœ¬æ²¡è®¾è®¡äº¤äº’ï¼Œç”¨EChartsï¼Œå› ä¸ºEChartsçš„äº¤äº’å’ŒåŠ¨ç”»æ•ˆæœæœ€ä¸ºä¸»æµæ¥å—å¦‚æœè®¾è®¡äº†äº¤äº’ï¼Œä½†æ˜¯äº¤äº’éƒ½æ¯”è¾ƒä¿å®ˆï¼Œç”¨EChartsï¼Œç†ç”±è¿˜æ˜¯ä¸€æ ·å¦‚æœè®¾è®¡çš„äº¤äº’éå¸¸æ–°é¢–ï¼ŒEChartså·²ç»æ»¡è¶³ä¸äº†ï¼Œç”¨è‡ªç”±åº¦æœ€é«˜çš„ï¼ŒD3å½“ç„¶è¿˜æœ‰HighChartã€AntVç­‰ç­‰å…¶å®ƒçš„é€‰æ‹©ï¼Œä½†æœ‰çš„æ—¶å€™çœŸçš„ä¸æƒ³è€ƒè™‘å¤ªå¤šï¼Œé¡ºæ‰‹å°±è¡Œã€‚ä½†æ˜¯è¿™æ¬¡çš„è®¾è®¡æœ‰ä¸€ä¸ªç‚¹ï¼Œç”¨EChartsè¿˜æ˜¯æ²¡æœ‰åŠæ³•å®ç°çš„ï¼Œå°±æ˜¯åŠé€æ˜é¢œè‰²ä¹‹é—´äº¤å æ—¶å‡ºç°çš„åŠ æ·±æ•ˆæœï¼š è®¾è®¡å›¾ å®é™…æ•ˆæœ å¯ä»¥çœ‹åˆ°è®¾è®¡å›¾ä¸­ï¼Œé¢œè‰²äº¤å å¤„æœ‰ç§psä¸­æ­£ç‰‡å åº•åŠ æ·±å›¾å±‚çš„æ„Ÿè§‰ï¼Œä½†æ˜¯å®é™…çš„å›¾è¡¨ç»˜åˆ¶ä¸­ï¼Œé¢œè‰²çš„äº¤å éƒ¨åˆ†æ˜¯ä¸Šå±‚çš„é¢œè‰²è¦†ç›–ä¸‹å±‚çš„é¢œè‰²ï¼ŒEChartså®é™…æ˜¯æä¾›æ··åˆæ¨¡å¼é…ç½®é¡¹çš„ï¼Œä¹Ÿå°±æ˜¯blendMode ä¸å¼€å¯blendMode å…¨å¼€å¯blendMode ä¸‹å±‚å›¾å±‚å¼€å¯blendMode ä¸Šå±‚å›¾å±‚å¼€å¯blendMode ä½†éå¸¸å‘çˆ¹çš„æ˜¯ï¼ŒblendModeåªæ”¯æŒ2ä¸ªå€¼ï¼šlighter å˜äº®source-over é»˜è®¤å€¼å¹¶ä¸”åªæœ‰åœ¨æ¸²æŸ“å™¨rendererä¸ºcanvasç±»å‹æ—¶ï¼ŒblendModeæ‰ç”Ÿæ•ˆå› ä¸ºè¿™é‡Œæˆ‘ç”¨çš„æ˜¯svgï¼Œæ‰€ä»¥å¤§æ¦‚ç‡æ˜¯æ²¡æˆäº†ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆï¼šç»˜åˆ¶ä¸¤å±‚å›¾å±‚ï¼Œä¸€å±‚ç”¨canvasç»˜åˆ¶ï¼Œç”¨äºé¢œè‰²æ§åˆ¶ï¼Œä¸€å±‚ç”¨svgç»˜åˆ¶ï¼Œç”¨äºäº¤äº’é…ç½®ï¼Œä¸è¿‡å¤ªéº»çƒ¦äº†ï¼ŒæŸ¥çœ‹echarts-liquidåº“æºç ï¼Œgithubä¸Šå·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°è¿‡äº†ï¼Œå®é™…ä¸Šç»“æ„å¹¶ä¸å¤æ‚ï¼Œå¦‚æœèŠ±è¿™ä¹ˆå¤šæ—¶é—´åŸºäºç°æœ‰çš„åº“å»å®ç°è¿™æ ·ä¸€ç§é¢œè‰²æ··åˆçš„åŠŸèƒ½ï¼Œè¯´å®è¯è¿˜ä¸å¦‚ç ”ç©¶ä¸€ä¸‹å¦‚ä½•è‡ªå®šä¹‰EChartsç±»å‹ç®€å•è¿™é‡Œçš„labelå’Œtextçš„é¢œè‰²æœ‰ä¸€ä¸ªåç›¸æ•ˆæœï¼ˆsvgæ¸²æŸ“ä¸­ï¼‰ï¼Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªæ–‡å­—å åœ¨ä¸€èµ·ï¼Œä¸€å±‚ä½œä¸ºåº•å±‚ï¼Œä¸€å±‚ä½œä¸ºä¸Šå±‚ï¼Œä¸Šå±‚æ–‡å­—è¢«æ°´æ³¢å›¾å½¢ç»™å‰ªæ‰äº†ä½†æ˜¯èƒ½çœ‹åˆ°ï¼Œå› ä¸ºclip-pathæŒ‡å®šçš„ä»…ä»…æ˜¯å¯¹åº”seriesä¸­çš„æ°´æ³¢pathï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºcanvaså’Œsvgå¤„ç†å›¾åƒçš„ä¸åŒï¼Œsvgæ²¡æœ‰é¢œè‰²ç¼“å†²åŒºçš„æ¦‚å¿µï¼Œæ›´å¼ºè°ƒå…ƒç´ ä¹‹é—´çš„ç»‘å®šå…³ç³»canvasä¼šæŠŠç”»å¸ƒä¸Šçš„é¢œè‰²ä½œä¸ºç¼“å†²åŒºè¿›è¡Œç»´æŠ¤ï¼ŒååŠ çš„é¢œè‰²ä¼šåœ¨ä¹‹å‰è®¡ç®—çš„é¢œè‰²çš„åŸºç¡€ä¸Šè¿›è¡Œæ··åˆ æ—¶é—´çº¿è¡¨æŠ€æœ¯ï¼šVis-Timeline é€‰ç”¨ vis-timeline ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°å®ƒè‡ªå¸¦ç¼©æ”¾å’Œæ»šåŠ¨çš„æ—¶é—´è½´ç»„ä»¶ åŠ¨ç”»ï¼šGSAP æ²¡æ³•ç”¨cssåŠ¨ç”»æ’å€¼çš„å±æ€§ï¼Œå¯ä»¥ç”¨ GSAP å¤„ç†ã€‚ç”¨æ¥å¤„ç†ä¸ç†Ÿæ‚‰çš„svgåŠ¨ç”»ä¹Ÿå¾ˆæ–¹ä¾¿ æ³¨æ„äº‹é¡¹å¯è§†åŒ–å¤§å±ç›¸å¯¹ä¸€èˆ¬é¡¹ç›®æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼šè‡ªé€‚åº”æ ·å¼æ€§èƒ½resizeåŠ¨ç”»è‡ªé€‚åº”ç”¨remï¼ç”¨remï¼ç”¨remï¼remä¾èµ–æ ¹èŠ‚ç‚¹çš„font-sizeè¿›è¡Œå°ºå¯¸åˆ¤æ–­ï¼Œå› æ­¤ä»…éœ€è¦åœ¨é¦–æ¬¡è¿›å…¥é¡µé¢å’Œä¹‹åresizeæ—¶åŠ¨æ€ä¿®æ”¹æ ¹èŠ‚ç‚¹çš„font-sizeè¿›è¡Œé‡æ–°è®¡ç®—ï¼š// æ­¤å¤„æœ€å¤§é€‚é…å®½åº¦3840ï¼Œæœ€å°é€‚é…å®½åº¦1024export function resize() return new Promise((resolve,reject)= let rootWidth = document.documentElement.clientWidth || document.body.clientWidth let rootDom = document.querySelector(html) let k = 16/1920 let b = 16 - 1920*k rootDom.style.fontSize = (k * rootWidth + b) + px )window.addEventListener(resize,resize)æˆ‘ç”¨çš„æ˜¯Vueæ¡†æ¶ï¼Œç»„ä»¶çš„mountä¸€å®šè¦åœ¨resizeä¹‹åè¿›è¡Œï¼Œå¦åˆ™ä¸€äº›echartsè¡¨æ ¼å¼€å§‹ç»˜åˆ¶æ—¶ï¼Œæ­£ç¡®çš„remå¤§å°è¿˜æ²¡æœ‰è¢«è®¡ç®—å‡ºæ¥ï¼šresize().then(res= app.mount(#app))å¦å¤–ï¼Œéœ€è¦å¯¹ç½‘é¡µèƒ½å…¼å®¹çš„æœ€å¤§å°ºå¯¸å’Œæœ€å°å°ºå¯¸è¿›è¡Œé…ç½®ï¼š.wrapper background: #e9effa; width: 100%; height:67.5rem; min-width: 1024px; min-height:768px; max-width: 3840px; max-height:1838px; display: flex; flex-direction: column; position:absolute; overflow-x: hidden;å°†remçš„åŠ¨æ€èŒƒå›´ä¹Ÿé™åˆ¶åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ï¼Œå’Œã€ŠCSSæ­ç§˜ã€‹è¿™æœ¬ä¹¦ä½œè€…å¼ºè°ƒçš„ä¸€æ ·ï¼Œæ ·å¼ç¼–å†™éœ€è¦DRYï¼ˆDonâ€™t Repeat Yourselfï¼‰èƒ½ç”¨åŠ¨æ€å•ä½ï¼ˆemã€remã€vhã€vwï¼‰å°±ç”¨åŠ¨æ€å•ä½ï¼Œçµæ´»ä½¿ç”¨csså˜é‡ã€å‡½æ•°ã€å“åº”å¼å¸ƒå±€å¦‚æœä½ åªæœ‰é€šè¿‡ä¿®æ”¹å¤§é‡cssä»£ç æ‰èƒ½å®ç°é¡µé¢é€‚é…ï¼Œé‚£å°±è¦åæ€ä¸€ä¸‹æ˜¯ä¸æ˜¯ä½ çš„é¡µé¢å®ç°å­˜åœ¨é—®é¢˜ã€‚ â€”â€”â€”â€”ã€ŠCSSæ­ç§˜ã€‹æ ¹æ®å°ºå¯¸è‡ªé€‚åº”é¡µé¢å¤§å°æ ·å¼æ€§èƒ½cssåŸç”Ÿå˜é‡éå¸¸å¥½ç”¨èƒŒæ™¯å›¾ç‰‡å°½é‡é€‰ç”¨svgæˆ–è€…webpæ ¼å¼ç›´æ¥ä½¿ç”¨dataurlç¼–ç çš„å›¾ç‰‡ï¼Œæ— éœ€è¯·æ±‚èµ„æºï¼Œæ€§èƒ½æ›´é«˜é€šè¿‡åŠ¨æ€è®¡ç®—çš„é…è‰²æ–¹æ¡ˆå¾€å¾€æ•ˆæœæ›´å¥½ï¼Œå¹¶ä¸”å¯ç»´æŠ¤æ€§æ›´å¥½hslaéå¸¸å¥½ç”¨resizeresizeå®é™…ä¸Šå°±æ˜¯å¦ä¸€ç§æ„ä¹‰ä¸Šçš„â€œè‡ªé€‚åº”â€ï¼Œä½†æ˜¯ä¸åŒç‚¹åœ¨äºæˆ‘ç”¨äº†echartsï¼ŒEChartsçš„resizeéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼Œä¸ä»…å¦‚æ­¤ï¼Œç”¨cssçš„remæ§åˆ¶çš„é¡µé¢å±æ€§åœ¨resizeæ—¶èƒ½å¤Ÿè‡ªé€‚åº”ï¼Œä½†æ˜¯echartsé‡Œoptionçš„é…ç½®åŸºæœ¬åœ¨åˆ›å»ºçš„æ—¶å€™å°±å†™æ­»äº†ï¼Œæˆ‘çš„åšæ³•æ˜¯åœ¨window.resizeæ—¶ï¼Œé‡æ–°è®¡ç®—optioné‡Œé¢æ‰€æœ‰æ¶‰åŠå•ä½çš„å±æ€§ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚animeä¸ä»…ä»…æ˜¯å¯è§†åŒ–å¤§å±ï¼Œä»»ä½•æœ‰å¾ˆå¤šåŠ¨æ•ˆéœ€è¦é…åˆçš„é¡¹ç›®éƒ½æ˜¯å¦‚æ­¤ï¼Œé‚£å°±æ˜¯éœ€è¦å¯¹è¿™äº›è¢«æ‰“çš„ä¹±ä¸ƒå…«ç³Ÿçš„åŠ¨ç”»å¸§è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå¦åˆ™åæœŸå¯¹æŸä¸ªåŠ¨ç”»å¸§çš„æ”¹å˜ï¼Œä¼šæ³¢åŠåˆ°æ•´ä¸ªé¡µé¢å…¶å®ƒåŠ¨ç”»çš„æ•ˆæœã€‚ æ°´çƒæ°”æ³¡æ•£ç‚¹å›¾å¦‚ä½•å®ç°åŸºæœ¬æ€è·¯ é¦–å…ˆæŠ›å¼€èŠ±é‡Œèƒ¡å“¨çš„åŒ…è£…ï¼Œå•çœ‹å®ƒè¦å®ç°ä»€ä¹ˆï¼šXè½´ï¼šä»»åŠ¡æ•°é‡Yè½´ï¼šå‚ä¸äººæ•°æ°´æ³¢é«˜åº¦ï¼šä»»åŠ¡è¿›åº¦æ°”æ³¡åŠå¾„ï¼šé¡¹ç›®å·¥æ—¶æ°”æ³¡é¢œè‰²ï¼šé¡¹ç›®çŠ¶æ€ä¹Ÿå°±æ˜¯è¯´ä¸€å¼ å›¾å±•ç¤º5ä¸ªè¦ç´ ï¼Œæ ¹æ®Xè½´ã€Yè½´åæ ‡è¿›è¡Œæ˜ å°„ï¼Œæ˜¯æ•£ç‚¹å›¾çš„ç‰¹æ€§ï¼Œæ ¹æ®æ°´æ³¢é«˜åº¦åˆ¤æ–­è¿›åº¦ï¼Œæ˜¯æ°´çƒå›¾çš„ç‰¹æ€§ï¼Œæ ¹æ®å·¥æ—¶å¯¹åŠå¾„è¿›è¡Œæ§åˆ¶ï¼Œæ˜¯æ°”æ³¡å›¾çš„ç‰¹æ€§ï¼Œä½†æ˜¯æ•£ç‚¹å›¾ä¹Ÿæ”¯æŒä¸‰ç§æ–¹å¼æ‰€ä»¥æœ€æ¥è¿‘æˆ‘ä»¬è¦ç»˜åˆ¶çš„ç›®æ ‡çš„å®é™…æ˜¯æ•£ç‚¹å›¾ï¼Œä½†æ˜¯æ•£ç‚¹å›¾ä¸Šéœ€è¦æœ‰ä¸€ä¸ªç±»ä¼¼æ°´çƒå›¾çš„æ³¢æµªåŠ¨ç”»ï¼Œå› æ­¤æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼šåˆ©ç”¨æ•£ç‚¹å›¾çš„symbolå±æ€§symbolå±æ€§æ”¯æŒDataURLç±»å‹çš„æ•°æ®ï¼Œå› æ­¤å®Œå…¨å¯ä»¥å¯¹æ•£ç‚¹å›¾çš„èŠ‚ç‚¹è¿›è¡Œè‡ªå®šä¹‰åŒ–ä½†æ˜¯é—®é¢˜åœ¨äºå¦‚æœæ˜¯å§å¦ä¸€å¼ echartså›¾è¡¨çš„ç»˜åˆ¶ç»“æœcanvassvgï¼Œè½¬åŒ–ä¸ºdataurlä½œä¸ºæ–°èŠ‚ç‚¹çš„symbolï¼Œè¿™æ˜¯ä¸€å¼ å†™æ­»çš„å›¾ç‰‡ï¼Œäº¤äº’æ€§éå¸¸æœ‰é™ï¼Œå› æ­¤passæ”¹è¿›æ–¹å¼ï¼šä¸åˆ©ç”¨echartså®ç°çš„å›¾è¡¨ï¼Œè€Œæ˜¯è‡ªå®šä¹‰svgï¼Œå°†åŠ¨ç”»æ•ˆæœå’Œäº¤äº’éƒ½ä½œä¸ºsvgçš„ä¸€éƒ¨åˆ†è½¬æ¢ä¸ºdataUrlï¼Œä¿ç•™äº¤äº’æ€§å’ŒåŠ¨ç”»åˆ©ç”¨echartsçš„customå›¾è¡¨çŸ¥é“æœ‰è¿™ç§æ–¹å¼ï¼Œä½†æ˜¯ä¸ç†Ÿï¼Œæ‰€ä»¥passåˆ©ç”¨echartsçš„æ°´çƒå›¾echartsæœ¬èº«æ”¯æŒæ°´çƒå›¾ï¼Œå¯ä»¥å°†æ°´çƒå›¾ä½œä¸ºæ•£ç‚¹æ˜ å°„åˆ°åæ ‡ç³»ä¸Šï¼Œä¼¼ä¹åªåœ¨åæ ‡æ˜ å°„ä¸Šæœ‰å·¥ä½œé‡ï¼Œæœ€ç»ˆé€‰æ‹©è¿™ç§æ–¹å¼ åæ ‡ç³»æ˜ å°„è¿™é‡Œçš„æ€è·¯å°±æ˜¯æŠŠåæ ‡ç³»å’Œä¸Šé¢çš„æ•£ç‚¹å›¾ä»ç»˜åˆ¶å±‚é¢å®Œå…¨åˆ†ç¦»ï¼Œä¸ç”¨EChartsæä¾›çš„åæ ‡ç³»å’Œæ•°æ®çš„è”åŠ¨ï¼Œè€Œæ˜¯æ‰‹åŠ¨å®ç°ä¸­é—´çš„ä¸€äº›è”åŠ¨ï¼Œä¹Ÿæ˜¯è€ƒè™‘åˆ°è¿™å¼ å›¾åœ¨åæ ‡ç³»ä¸Šéœ€è¦å®ç°çš„è”åŠ¨æ•ˆæœä¸å¤šï¼Œå¦‚æœè¿˜è¦åŠ ä¸Šdatazoomä¹‹ç±»çš„åæ ‡è½´ç¼©æ”¾ã€å¹³ç§»è”åŠ¨ï¼Œå¯èƒ½ä¼šæ›´åŠ å¤æ‚æ‹¿åˆ°ä¸€å †æ•°æ®åï¼Œéœ€è¦åšå¦‚ä¸‹æ“ä½œï¼šè®¡ç®—å‡ºè¿™æ‰¹æ•°æ®æ˜ å°„å‡ºçƒä½“çš„åŒ…å›´ç›’ï¼Œå¾—åˆ°æ•´å¼ å›¾çš„leftã€rightã€topã€bottomè¾¹ç•Œæ ¹æ®è¾¹ç•Œå€¼ï¼ŒåŠ¨æ€è®¡ç®—å‡ºåæ ‡ç³»çš„è¾¹ç•Œæ‹¿åˆ°è¾¹ç•Œï¼Œç»˜åˆ¶å‡ºåæ ‡ç³»å†å°†æ•°æ®çš„xã€yå€¼åœ¨åæ ‡ç³»ä¸­çš„ä½ç½®æ˜ å°„ä¸ºpxå®šä½å€¼ï¼Œè¿™é‡Œç”¨çš„æ˜¯EChartsæä¾›çš„convertToPixelå‡½æ•°function convertAxisToPixel(data) return data.map(node= node.center = chart.convertToPixel( xAxisIndex:0, yAxisIndex:0, [node.taskNum, node.peopleNum] ) return node )æœ€ç»ˆå°±èƒ½å°†æ°´çƒæ˜ å°„åˆ°é¡µé¢ä¸­äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä¹Ÿæœ‰å¼Šç—…ï¼šæ€§èƒ½é—®é¢˜ï¼Œæ¯ä¸€ä¸ªæ°´çƒéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„seriesï¼Œå’ŒçœŸæ­£çš„æ•£ç‚¹å›¾çš„æ€§èƒ½ç›¸æ¯”å¾ˆä½åæ ‡ç³»è¾¹ç¼˜çš„è®¡ç®—æ¯”è¾ƒå¤æ‚ï¼Œæ¶‰åŠåˆ°æ›´å¤šæ•°æ®å¤„ç†çš„é€»è¾‘åæ ‡ç³»è¾¹ç•Œæ£€æµ‹è¿™é‡Œæ²¡æœ‰ä½¿ç”¨echartsè‡ªå¸¦çš„åæ ‡ç³»ï¼Œæ‰‹åŠ¨å®ç°åæ ‡ç³»çš„è‡ªé€‚åº”ï¼Œå¹¶éæœ€åˆæƒ³çš„è¿™ä¹ˆå®¹æ˜“ã€‚ç”±äºçƒä½“å’Œåæ ‡ç³»ä¸åœ¨ä¸€å¼ ç”»å¸ƒä¸Šï¼Œæ‰€ä»¥è¦çŸ¥é“çƒä½“æ˜¯å¦å‡ºç•Œï¼Œå°±å¿…é¡»çŸ¥é“ç”»å¸ƒçš„åŒ…å›´ç›’å’Œåæ ‡å•ä½ä»¥è®¡ç®—å³è¾¹ç¼˜åæ ‡ä¸ºä¾‹ï¼ŒåŸºæœ¬çš„å®ç°æ€è·¯å°±æ˜¯ï¼šåˆå§‹åŒ–åæ ‡è½´å³è¾¹ç¼˜ä¸º0å¼€å§‹éå†æ¯ä¸ªç‚¹è®¡ç®—ç‚¹çš„å³è¾¹ç¼˜å¦‚æœç‚¹çš„å³è¾¹ç¼˜è¶…è¿‡å½“å‰åæ ‡è½´å³è¾¹ç¼˜éœ€è¦å‘åæ ‡è½´å³ä¾§æ·»åŠ å•ä½ï¼ˆæ³¨æ„ï¼Œåœ¨æ·»åŠ å•ä½çš„åŒæ—¶ï¼Œæ•´ä½“åæ ‡å•å…ƒä¹Ÿä¼šç¼©å°ï¼‰è®¡ç®—å‡ºæ·»åŠ çš„å•ä½æ•°é‡å³è¾¹ç¼˜åŠ ä¸Šæ·»åŠ æ•°é‡ï¼Œé‡æ–°è®¡ç®—åæ ‡å•ä½éå†ç»“æŸï¼Œè®¡ç®—å®Œæ¯•data.forEach((node, index)= // è®¡ç®—xè½´ï¼Œyè½´èŒƒå›´ let r2px = node.mapRadius/2/100*content_h // åŠå¾„ let x = (node.x - axis_range.x[0]) * x_unit let y = (axis_range.y[1] - node.y) * y_unit let left = x - r2px - gap_left let right = x + r2px + gap_right let top = y - r2px - gap_top let bottom = y + r2px + gap_bottom if(left0) // å·¦ä¾§è¶…è¿‡ let n = axis_range.x[1] - axis_range.x[0] let left_add = Math.ceil(((node.x - axis_range.x[0]) * content_w -r2px*n)/(r2px - content_w)) axis_range.x[0] -= left_add x_unit = countUnit(content_w, axis_range.x[1] - axis_range.x[0] ) if(rightcontent_w) // å³ä¾§è¶…è¿‡ let n = axis_range.x[1] - axis_range.x[0] let right_add = Math.ceil((content_w * n - (node.x - axis_range.x[0]) * content_w - r2px*n) / (r2px - content_w)) axis_range.x[1] += right_add x_unit = countUnit(content_w, axis_range.x[1] - axis_range.x[0] ) if(top0) // ä¸Šä¾§è¶…è¿‡ let n = axis_range.y[1]-axis_range.y[0] let top_add = Math.ceil( (r2px*n - content_h*axis_range.y[1] + content_h * node.y) / (content_h - r2px) ) axis_range.y[1] += top_add y_unit = countUnit(content_h, axis_range.y[1] - axis_range.y[0] ) if(bottomcontent_h) // ä¸‹ä¾§è¶…è¿‡ let n = axis_range.y[1]-axis_range.y[0] let bottom_add = Math.ceil( (content_h*axis_range.y[1] - content_h*node.y)/(content_h-r2px) - n ) axis_range.y[0] -= bottom_add y_unit = countUnit(content_h, axis_range.y[1] - axis_range.y[0] ) // æ¨å…¥å‡åŒ€æ¨¡å¼ä¸‹çš„xã€yå€¼ x_category.push(node.x) y_category.push(node.y)) æ•°æ®é‡å é—®é¢˜ å¯è§†åŒ–å›¾è¡¨å¼€å‘ï¼Œæ•°æ®éå¸¸é‡è¦ï¼Œå›¾è¡¨æ˜¯ç”¨æ¥çªæ˜¾æ•°æ®çš„ç‰¹æ€§çš„ï¼Œä½†å¦‚æœæ•°æ®æ²¡æœ‰è¿™ç§ç‰¹æ€§ï¼Œå›¾è¡¨çš„ä¼˜åŠ¿å°±å¾ˆéš¾å¾—åˆ°å‘æŒ¥ï¼Œæœ‰æ—¶ç”šè‡³ç»™äººçš„è§‚æ„Ÿä¼šéå¸¸ç³Ÿç³•è¿™ä¸ªå›¾è¡¨çš„è®¾è®¡å°±æ˜¯ä¸ªä¾‹å­ï¼Œè¿™ç§å›¾ç”¨äºå±•ç¤ºé‚£äº›åœ¨xè½´ã€yè½´ä¸Šåˆ†æ•£æ¯”è¾ƒå‡åŒ€ï¼Œå¹¶ä¸”å½¼æ­¤å¾ˆéš¾é‡å çš„æ•°æ®è¾ƒå¥½ï¼Œä½†æ˜¯è¿™é‡Œè®¾è®¡çš„æ˜¯å‚ä¸äººæ•°å’Œä»»åŠ¡æ•°é‡ï¼Œä¼ä¸šçš„é¡¹ç›®ä¸€èˆ¬éƒ½è¶‹äºåŒè´¨åŒ–ï¼Œå¤§å¤šæ•°é¡¹ç›®çš„å‚ä¸äººæ•°å’Œä»»åŠ¡æ•°é‡éƒ½å·®ä¸å¤šï¼Œæ‰€ä»¥æœ€ç»ˆçœŸå®æ•°æ®å¡«å…¥åï¼Œä¸€å®šä¼šæ˜ å°„å‡ºéå¸¸å¯†é›†çš„æ•ˆæœã€‚ä½†è¿™æ˜¯è®¾è®¡å±‚é¢çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨çŸ¥é“ç‚¹å¯èƒ½ä¼šå˜å¾—å¾ˆå¯†é›†çš„æƒ…å†µä¸‹ï¼Œä»çŸ¢é‡å±‚é¢ä¹Ÿå¥½ï¼Œä»è§†è§‰å±‚é¢ä¹Ÿå¥½ï¼Œå°†å›¾è¡¨çš„æ•ˆæœä¼˜åŒ–å‘¢ï¼Ÿåæ ‡è½´æ¨¡å¼è½¬æ¢å¥½åœ¨äº§å“ç»ç†æå‡ºä¸€å¼ å›¾æœ€å¤šåªç»˜åˆ¶20ä¸ªçƒï¼ˆåé¢æ”¹æˆäº†15ä¸ªï¼‰ï¼Œæœ‰äº†æ•°é‡æ§åˆ¶ï¼Œå°±èƒ½æä¾›ä¸€ç§å‡åŒ€æ¨¡å¼ï¼Œä¹‹å‰ä¹‹æ‰€ä»¥ä¸å‡åŒ€çš„åŸå› å°±åœ¨äºxè½´ã€yè½´éƒ½é€‰ç”¨çš„æ˜¯æ•°æ®è¿ç»­ç±»å‹ï¼Œæ•°æ®æ˜¯åœ¨0-maxä¹‹é—´è¿è´¯æ˜ å°„çš„ï¼Œå› æ­¤è¿˜å¯èƒ½å‡ºç°å™ªç‚¹æ•°æ®ï¼Œç ´åæ•´ä¸ªæ˜ å°„çš„æ•ˆæœï¼Œå‡åŒ€æ¨¡å¼å°±æ˜¯å°†xè½´ã€yè½´è®¾ç½®ä¸ºç¦»æ•£ç±»å‹ï¼Œä»…ä»…æ˜¯æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åºï¼Œä¸‹é¢æ˜¯è¿ç»­æ¨¡å¼å’Œç¦»æ•£æ¨¡å¼ä¹‹é—´çš„å¯¹æ¯”ï¼šç¦»æ•£æ¨¡å¼ï¼ˆå…ˆï¼‰&& è¿ç»­æ¨¡å¼ï¼ˆåï¼‰åŠå¾„æ•£å°„è¿™é‡Œæ°´çƒçš„åŠå¾„éœ€è¦èƒ½å¤Ÿåæ˜ æƒé‡çš„å¤§å°ï¼Œæœ€åˆçš„åšæ³•æ˜¯å°†æœ€å¤§åŠå¾„å’Œæœ€å°åŠå¾„åˆ†åˆ«è®¾ç½®ä¸ºé«˜åº¦çš„50%å’Œ10%ï¼Œå°†æ°´çƒçš„æƒé‡ï¼ˆ0-1ï¼‰çº¿æ€§æ˜ å°„åˆ°è¿™ä¸ªèŒƒå›´ä¹‹ä¸­ï¼šlet minRadius = 10, maxRadius = 50// node.effectä¸ºæƒé‡let radius = node.effect * (maxRadius - minRadius) + minRadius // çº¿æ€§æ˜ å°„ç»“æœç»“æœå¾ˆå¿«å‘ç°æœ‰é—®é¢˜ï¼šå¦‚æœæ•°æ®ä¹Ÿæ˜¯çº¿æ€§åˆ†å¸ƒçš„ï¼Œé‚£æ•ˆæœè¿˜å¥½ï¼Œä½†æŠ›å»è¿™ä¸ªå‡ ä¹ä¸ä¼šå‡ºç°çš„çº¿æ€§åˆ†å¸ƒï¼Œå…¶ä»–æ—¶å€™æ•ˆæœéƒ½æ˜¯å¾ˆç¾éš¾çš„æ•°æ®ç¦»æ•£åº¦é«˜æ•°æ®åé«˜ï¼Œå¤§çƒé‡å  [y (max-min)x^2 + min]æ•°æ®åå°ï¼Œå°çƒé‡å  [y (max-min)x^(13) + min]æ•°æ®ç¦»æ•£åº¦ä½ä¸€èˆ¬æ•°æ®éƒ½æ˜¯æŒ¤åœ¨ä¸­é—´ï¼Œå¯¼è‡´ä¸å¤§ä¸å°çš„æ•°æ®é‡å åœ¨ä¸€èµ·ï¼Œæœ€ç¾éš¾çš„æƒ…å†µgt å¤§äºå¹³å‡å€¼çš„æ•°æ®æ•°é‡lt å°äºå¹³å‡å€¼çš„æ•°æ®æ•°é‡n æ•°æ®æ€»æ•°é‡a (gt - lt)ny aÂ·x^2+(max-a-min)x+minå¦‚ä½•è®¡ç®—æ•°æ®çš„ç¦»æ•£ç¨‹åº¦å¦‚ä½•åˆ¤æ–­ä¸€ç»„æ•°æ®ç¦»æ•£ç¨‹åº¦çš„é«˜ä½ï¼Ÿè¿™é‡Œä½¿ç”¨çš„æ˜¯æ ‡å‡†å·®æ–¹æ³•ï¼šlet variance = data.reduce((a,b)= return a + Math.pow(b-ave, 2),0)/data.length // æ–¹å·®let standard_var = Math.sqrt (variance) // æ ‡å‡†å·®let effect = standard_var/avelet SDR = effect 0.25 // trueè¡¨ç¤ºæ•°æ®ç›¸å·®å¤§ï¼Œfalseè¡¨ç¤ºæ•°æ®ç›¸å·®å°console.log(`æ ‡å‡†å·®ï¼š$standard_varï¼Œæ ‡å‡†å·®å¤§äºæŒ‡å®šå€¼ï¼š$SDRï¼Œæ•°æ®åå‘ï¼š$dir`)å› æ­¤ä¹Ÿå°±æ˜¯ä½¿ç”¨å¹‚å‡½æ•°çš„æ–¹å¼è¿›è¡Œæ˜ å°„å¤„ç†å¹‚å‡½æ•°æ˜ å°„æœ€ç»ˆçš„æ˜ å°„æ•ˆæœè¦å¥½ä¸€äº›ï¼šé¢œè‰²åˆ’ç•Œå¦‚æœç›¸é‚»ä¸¤ä¸ªå…ƒç´ çš„é¢œè‰²èƒ½åŒºåˆ†å¼€ï¼Œé‚£æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ï¼Œï¼ˆæœ¬é¡¹ç›®ä¸­ï¼Œæœ€ç»ˆç»ˆäºæŠŠé¢œè‰²ä»å›¾ä¾‹çš„æ„ä¹‰ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œç”¨äºåŒºåˆ†ç›¸é‚»2ä¸ªå…ƒç´ çš„é¢œè‰²äº†ï¼‰ æ°´çƒé€‰ä¸­å½“å‰é—®é¢˜ è¿™å¼ å›¾ç»˜åˆ¶åˆ°ç°åœ¨éƒ½è¿˜ç®—æ¯”è¾ƒé¡ºåˆ©ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œäº†ï¼Œå› ä¸ºæˆ‘ç°åœ¨æƒ³è¦é€‰ä¸­æ°´çƒï¼Œä½†æ˜¯æˆ‘ä»¬æ­¤åˆ»å¸Œæœ›æŠŠå®ƒå½“åšä¸€ä¸ªæ•´ä½“è¿›è¡Œé€‰ä¸­ï¼Œè¿™ä¹Ÿæ˜¯éµä»æ•£ç‚¹å›¾çš„symbolé€‰ä¸­ç‰¹æ€§çš„ä¸€ç§äº¤äº’ï¼Œä½†æ˜¯æ°´çƒå›¾çš„å¼Šç—…ç°åœ¨æš´éœ²å‡ºæ¥äº†ï¼šå®ƒçš„é€‰ä¸­æœºåˆ¶åœ¨æ°´æ³¢ä¸Šï¼Œæ²¡æœ‰æä¾›æ•´ä½“é€‰ä¸­çš„é…ç½®é¡¹ï¼ˆWTFï¼‰ä¸ä»…å¦‚æ­¤ï¼Œå°±è¿ç”¨echarts.onç»‘å®šçš„ä»»ä½•é¼ æ ‡äº‹ä»¶ï¼Œç«Ÿç„¶ä¹Ÿåªèƒ½ç”±æ°´æ³¢è§¦å‘ï¼Œé‚£è¿™ç”¨æˆ·è‚¯å®šä¸èƒ½æ¥å—ã€‚ è§£å†³æ–¹æ³• å¥‡æ€ªçš„æ˜¯ï¼Œè™½ç„¶æˆ‘é¼ æ ‡ç§»å…¥çƒä½“ï¼ˆæ²¡åˆ°æ°´æ³¢éƒ¨åˆ†ï¼‰æ—¶ï¼Œè™½ç„¶é¼ æ ‡äº‹ä»¶æ²¡æœ‰è¢«è§¦å‘ï¼Œä½†æ˜¯é¼ æ ‡çš„pointeræ ·å¼å´æ”¹å˜äº†ï¼Œå› æ­¤ä¸€å®šæ˜¯æœ‰æŸç§åˆ¤æ–­é¼ æ ‡ç§»å…¥çš„æ–¹å¼çš„ï¼Œåœ¨zrenderlibHandler.jsä¸­ï¼Œæ‰¾åˆ°äº†å¯¹é¼ æ ‡pointerè¿›è¡Œä¿®æ”¹çš„ä»£ç ï¼šHandler.prototype.mousemove = function (event) var x = event.zrX; // é¼ æ ‡x var y = event.zrY; // é¼ æ ‡y var isOutside = isOutsideBoundary(this, x, y); // åˆ¤æ–­é¼ æ ‡æ˜¯å¦è½åœ¨åŒ…å›´ç›’å¤– var lastHovered = this._hovered; // ä¸Šä¸€æ¬¡hoverçš„ä½ç½® var lastHoveredTarget = lastHovered.target; // ä¸Šä¸€æ¬¡hoverçš„ç›®æ ‡ if (lastHoveredTarget !lastHoveredTarget.__zr) lastHovered = this.findHover(lastHovered.x, lastHovered.y); lastHoveredTarget = lastHovered.target; // å¦‚æœè½åœ¨åŒ…å›´ç›’å¤–ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„hoverå¯¹è±¡ï¼Œåä¹‹ï¼Œæ‰¾åˆ°å½“å‰hoverå¯¹è±¡ var hovered = this._hovered = isOutside ? new HoveredResult(x, y) : this.findHover(x, y); var hoveredTarget = hovered.target; // hoverç›®æ ‡ var proxy = this.proxy; proxy.setCursor proxy.setCursor(hoveredTarget ? hoveredTarget.cursor : default); if (lastHoveredTarget hoveredTarget !== lastHoveredTarget) this.dispatchToElement(lastHovered, mouseout, event); this.dispatchToElement(hovered, mousemove, event); if (hoveredTarget hoveredTarget !== lastHoveredTarget) this.dispatchToElement(hovered, mouseover, event); ;å®é™…ä¸Šèƒ½çœ‹åˆ°ä¸€ä¸ªisOutsideBoundaryå‡½æ•°æ˜¯ç”¨äºåšé¼ æ ‡ç§»å…¥åˆ¤æ–­çš„ï¼Œäºæ˜¯æˆ‘å°±æƒ³æ‰‹åŠ¨å®ç°ä¸€ä¸ªåŒæ ·çš„åŒ…å›´ç›’åˆ¤æ–­ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œcanvasç»˜å›¾çš„å¼Šç—…å°±å‡ºæ¥äº†ï¼Œå°±æ˜¯è¾ƒä½çš„domäº¤äº’è‡ªç”±åº¦ï¼Œæˆ‘çš„æ‰€æœ‰æ°´çƒéƒ½æ˜¯ç»˜åˆ¶åœ¨ä¸€å¼ canvasä¸Šçš„ï¼Œè¿™å°±æ„å‘³ç€æˆ‘éœ€è¦è·å–åˆ°æ¯ä¸ªå½¢çŠ¶çš„å…ƒä¿¡æ¯ï¼Œç»è¿‡éå¸¸å¤æ‚çš„åˆ¤æ–­æ‰èƒ½çŸ¥é“æˆ‘é¼ æ ‡ç‚¹å‡»çš„æ˜¯ä»€ä¹ˆï¼è¿˜å¥½EChatsè¿˜æä¾›äº†svgç»˜åˆ¶çš„é€‰é¡¹ï¼Œç”¨svgå®ç°domäº¤äº’å°±ç®€å•å¤šäº†ï¼šecharts.init(chartDom,,renderer:svg)æˆ‘æ˜¯å¯ä»¥è·å–åˆ°è‡ªå·±ç‚¹å‡»çš„å…ƒç´ äº†ï¼Œä½†æ˜¯æ€ä¹ˆçŸ¥é“ç‚¹å‡»çš„æ˜¯å“ªä¸€ä¸ªæ°´çƒå‘¢ï¼Ÿæ‰“å¼€chromeæ§åˆ¶å°æŸ¥çœ‹domæ ‘ï¼Œèƒ½å‘ç°echartsä½¿ç”¨svgç»˜åˆ¶å¤šä¸ªseriesçš„ä¸€ä¸ªè§„å¾‹ï¼šå®ƒä¼šæŠŠæ‰€æœ‰seriesç»˜åˆ¶åœ¨ä¸€ä¸ªsvgå†…éƒ¨çš„ä¸€ä¸ªgä¸­ï¼Œå¹¶ä¸”æŒ‰ç…§zé¡ºåºè¿›è¡Œä»ä¸Šåˆ°ä¸‹çš„ç»˜åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå®ƒç»˜åˆ¶ä¸€ä¸ªæ°´çƒéœ€è¦16ä¸ªæ ‡ç­¾ï¼Œæ€»ç»˜åˆ¶20ä¸ªæ°´çƒå›¾ï¼Œé‚£ä¹ˆgä¸­å°±ä¼šæœ‰16*20320ä¸ªæ ‡ç­¾ä¸€ä¸ªæ°´çƒ16ä¸ªæ ‡ç­¾äº‹å®ä¸Šï¼Œè¿™é‡Œç»˜åˆ¶æ ‡ç­¾çš„æ•°é‡ä¸ä¸€å®šæ˜¯16ï¼ŒæœŸé—´å¯èƒ½æœ‰æ¶‰åŠåˆ°å¯Œæ–‡æœ¬çš„æ ‡ç­¾ï¼ˆå¤šä¸ªtextæ ‡ç­¾ï¼‰ï¼Œä¸ºå®ç°é˜´å½±æ•ˆæœçš„æ ‡ç­¾ï¼Œç­‰ç­‰ï¼Œä½†é‡ç‚¹æ˜¯ç»˜åˆ¶æ¯ä¸ªæ°´çƒçš„æ ‡ç­¾æ•°é‡éƒ½æ˜¯å›ºå®šçš„ï¼Œä¸”é¡ºåºä¸å˜ï¼Œè¿™å°±å¥½åƒWebGLç»˜å›¾ä¸­å¸¸ç”¨çš„ArrayBufferä¸€æ ·ï¼Œç”¨ç´¢å¼•è¿›è¡ŒåŒºåˆ†ã€‚æ‰€ä»¥è¿™é‡Œåªéœ€è¦æ ¹æ®ç»˜åˆ¶æ¯ä¸ªæ°´çƒçš„æ ‡ç­¾æ•°nï¼Œå’Œé¼ æ ‡ç§»å…¥æ ‡ç­¾åœ¨çˆ¶å…ƒç´ gä¸­çš„é¡ºåºï¼Œå°±èƒ½è·çŸ¥ç‚¹å‡»çš„æ˜¯ç¬¬ä¸€ä¸ªæ°´çƒï¼šconst svg = document.querySelector(`#$props.domId svg`)const svg_g = document.querySelector(`#$props.domId svg g`)const svg_children = Array.from(svg_g.children)const domNum = 16; // ä¸€ä¸ªsvgåŒ…å«16ä¸ªæ ‡ç­¾let index = svg_children.indexOf(e.target)if(index0) let parent = e.target.parentNode index = svg_children.indexOf(parent) let seriesIndex = Math.floor(index/domNum) currentSeriesIndex = seriesIndex // å½“å‰è¢«è§¦å‘çš„æ°´çƒç´¢å¼•èƒ½è·å–åˆ°æ°´çƒç´¢å¼•ï¼Œä½†æ˜¯è¿™æ—¶è¿˜æœ‰é—®é¢˜ï¼Œå°±æ˜¯å­˜åœ¨ä¸€äº›å¹²æ‰°å› ç´ ï¼Œæ°´çƒçš„é˜´å½±æ ‡ç­¾ä¼šå¯¼è‡´å®é™…çš„é¼ æ ‡è§¦å‘èŒƒå›´è¦å¤§å¾ˆå¤šæ°´çƒçš„æ³¢æµªæ ‡ç­¾æ˜¯ä¸€ä¸ªè¢«clipçš„pathï¼Œå®é™…çš„å°ºå¯¸ä¹Ÿè¦å®½å¾ˆå¤šæ‰€ä»¥åº”è¯¥æŠŠè¿™ä¸¤ä¸ªå…ƒç´ çš„é¼ æ ‡äº‹ä»¶ç¦æ‰ï¼ˆpointer-events:noneï¼‰ï¼Œå¥½åœ¨è¿™ä¸¤ä¸ªæ•ˆæœéƒ½æ˜¯ç”¨gæ ‡ç­¾å®ç°çš„ï¼Œå’Œå…¶å®ƒå…ƒç´ å¾ˆå¥½åŒºåˆ†ï¼š// å¯¹svgäº‹ä»¶è¿›è¡Œå¤„ç† æ³¢æµªå’Œé˜´å½±ä¸å¯ç‚¹å‡»function svgEventHandle(svg) const allG = svg.querySelector(g).querySelectorAll(g) allG.forEach(g=g.style.pointerEvents = none)æœ€åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œechartsä½¿ç”¨pathç»˜åˆ¶åœ†çƒï¼Œä½†æ˜¯pathæœ€ç»ˆçš„domç›‘å¬åŒºåŸŸæ˜¯ä¸€ä¸ªæ–¹å½¢ï¼Œå°†è¿™ä¸ªåœ†çƒåŒ…å›´ä½ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®pathçš„åŒ…å›´ç›’æ‰‹åŠ¨åˆ¤æ–­é¼ æ ‡æ˜¯å¦ç§»å…¥çš„æ˜¯åŒ…å›´ç›’å†…çš„åœ†çƒåŒºåŸŸï¼Œä»…æœ‰ç§»å…¥åœ†çƒåŒºåŸŸæ—¶æ‰åˆ¤æ–­å½“å‰æ°´çƒè¢«é€‰ä¸­ï¼šcurrentSeriesIndex = undefinedcurrentRect = undefinedsvg.style.cursor = defaultif(index=0) // svg domåˆ¤æ–­ç‚¹å‡»åˆ°äº†ä¸œè¥¿ let seriesIndex = Math.floor(index/domNum) let path = svg_children[seriesIndex * domNum] // ç›®æ ‡seriesçš„èŒƒå›´åœ† let rect = path.getBoundingClientRect() // èŒƒå›´åœ†çš„åŒ…å›´ç›’å­ let x = e.x , y = e.y; if(x=rect.left x=rect.right y=rect.top y=rect.bottom) // ç›®æ ‡åœ¨åŒ…å›´ç›’å­å†… let radius = rect.width/2 // åŒ…å›´åœ†åŠå¾„ let cx = rect.right - radius, cy = rect.bottom - radius // åœ†å¿ƒç»å¯¹ä½ç½® let dx = Math.abs(x - cx) , dy = Math.abs(y - cy) let diff = Math.sqrt(dx*dx + dy*dy) if(diff = radius) svg.style.cursor = pointer currentSeriesIndex = seriesIndex // å½“å‰æ¿€æ´»æ°´çƒ currentRect = rect // å½“å‰åŒ…å›´ç›’ è¾å°„æ°´çƒå›¾ å¦‚ä½•å®ç°pie+liquid ä¹ä¸€çœ‹è¿™ä¸ªå›¾ï¼Œä¼¼ä¹å¾ˆåƒæ—­æ—¥å›¾ï¼Œå› ä¸ºä¸­å¿ƒçƒå››å‘¨çš„å¼§åº¦è¾å°„å‡ºå»çš„åŠå¾„é•¿çŸ­ä¸ä¸€ï¼Œä½†æ˜¯æ—­æ—¥çš„åŠå¾„å»¶é•¿å‡ºå»æ˜¯æœ‰å±‚çº§å…³ç³»çš„æ„ä¹‰çš„ï¼Œè¿™é‡Œåˆ™ä¸æ˜¯ï¼Œå› æ­¤è¿™é‡Œé‡‡ç”¨çš„æ˜¯å¼§åº¦é¥¼å›¾çš„æ–¹å¼ï¼Œå³æœ‰å‡ ä¸ªåœ†å¼§ï¼Œå°±è¦åœ¨option.seriesä¸­å¡å…¥å‡ ä¸ªå…ƒç´ ï¼Œç„¶åè®¡ç®—å‡ºæ¯ä¸ªåœ†å¼§çš„åˆå§‹è§’åº¦å’Œç»“æŸè§’åº¦ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸€æ®µåœ†ç¯çš„æ¸å˜è‰²ï¼ŒEChartsæ˜¯æä¾›æ¸å˜è‰²çš„ï¼Œåœ¨çº¿æ€§æ¸å˜ä¸­ï¼Œè®¾ç½®æ¸å˜è‰²çš„2ç«¯åªèƒ½é€šè¿‡æŒ‡å®šç»˜åˆ¶å…ƒç´ ä¸Šçš„ä¸€æ¡æ–¹å‘å‘é‡çš„æ–¹å¼è¿›è¡Œç»˜åˆ¶å°±ç®—æ˜¯è¿™é‡Œç”¨çš„é¥¼å›¾ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè®¾ç½®radialæ¸å˜ä¹Ÿæ˜¯ä»¥æ¯ä¸ªå¼§æ®µä»¥è‡ªå·±çš„ä¸­å¿ƒåšradialæ¸å˜æ‰€ä»¥è¿™é‡Œæ¯ä¸ªå¼§æ®µæ¸å˜è‰²çš„æ–¹å‘å‘é‡éƒ½éœ€è¦æ‰‹åŠ¨è®¡ç®—ï¼šlet minRadius = innerRadius + 1 // æœ€å°å¤–åŠå¾„ï¼ˆ40 - 80ï¼‰let maxRadius = 75 // æœ€å¤§å¤–åŠå¾„let angleDiff = 135 // è§’åº¦åç§»data.forEach((node,index)= let temp = [0,1].includes(index)?(index+1):index const i = (temp+1)%pieColor.length const color = pieColor[i] let pieOption = copy(pieOptionTemp) /** è®¡ç®—å¤–åŠå¾„ */ const outerRadius = useEffectMap(node.valueEffect, minRadius, maxRadius) pieOption.radius[1] = `$outerRadius%` /** è®¡ç®—èµ·å§‹è§’åº¦ */ pieOption.startAngle = - index * (angle + gap) + angleDiff // let realAngle = angle20? 20:angle // çœŸæ­£çš„è·¨è¶Šè§’åº¦ pieOption.endAngle = pieOption.startAngle - angle // è¡Œé«˜åº”è¯¥ä¸ºå¼§åº¦çš„é•¿åº¦ let height = outerRadius * canvasSize[1]/100 * Math.sin(angle/180*Math.PI/2) pieOption.label.lineHeight = height pieOption.label.height = height let middle = (pieOption.endAngle + pieOption.startAngle)/2 /** è®¡ç®—æ¸å˜ */ let x = Math.cos(-middle/180*Math.PI) let y = Math.sin(-middle/180*Math.PI) pieOption.itemStyle.color.x = x/2+0.5 pieOption.itemStyle.color.y = y/2+0.5 pieOption.itemStyle.color.x2 = -x/2+0.5 pieOption.itemStyle.color.y2 = -y/2+0.5 // å¤–åœˆé¢œè‰² pieOption.itemStyle.color.colorStops[0].color = getHSL(color.color, color.alpha) // å†…åœˆé¢œè‰² pieOption.itemStyle.color.colorStops[1].color = getHSL(color.color, 30) options.push(pieOption))è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯å½“è¾å°„å¼§æ®µè¿‡å¤šæ—¶ï¼Œå¦‚æœè®¾ç½®å›ºå®šçš„å­—ä½“å¤§å°ï¼Œå°±ä¼šå‡ºç°labelæŒ¤åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™é‡Œçš„labelå­—ä½“å¤§å°ä¹Ÿéœ€è¦åŠ¨æ€è®¡ç®— è¿‡æ¸¡åŠ¨ç”»ç‚¹å‡»æ°´çƒåï¼Œæ°´çƒä»å›¾ä¸Šä½ç½®æµ®ç°å‡ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ›¿èº«ï¼Œç„¶åè¿ç§»åˆ°ç”»å¸ƒ[30%, 50%]çš„ä½ç½®ã€‚å¦‚ä½•å®ç°è¿™ä¸ªæ•ˆæœï¼Ÿå®é™…ä¸Šå°±æ˜¯è®¡ç®—è¢«ç‚¹å‡»ç‚¹å’Œç›®æ ‡ç‚¹ä½ä¹‹é—´çš„dxã€dyï¼Œç„¶åå¯¹è¾å°„å›¾çš„ç”»å¸ƒè¿›è¡Œå¹³ç§»ã€‚ä½¿ç”¨gsapè¿›è¡Œcss transformæ’å€¼ï¼ŒåŒ…å›´ç›’å‚ä¸è®¡ç®—çš„æ³¨æ„äº‹é¡¹è¿™é‡Œè®¡ç®—å®é™…çš„åç§»é‡ï¼Œä½¿ç”¨åˆ°äº†åŒ…å›´ç›’ï¼Œå³è¢«ç‚¹å‡»çƒä½“çš„åŒ…å›´ç›’ã€‚ç›®æ ‡ç‚¹ä½æ˜¯[30%, 50%]ï¼Œå®ƒçš„pxåæ ‡ä¹Ÿæ¯”è¾ƒå¥½è®¡ç®—ï¼š// è·å–ç”»å¸ƒé¥¼å›¾å±•ç¤ºçš„ä¸­å¿ƒç‚¹ [30%, 50%]function getCanvasPieCenter() const target = document.getElementById(props.domId) const boundBox = target.getBoundingClientRect() const grid = props.grid let canvasWidth = boundBox.width - grid.left - grid.right // ç”»å¸ƒå®½åº¦ let canvasHeight = boundBox.height - grid.top - grid.bottom // ç”»å¸ƒé«˜åº¦ canvasSize = [canvasWidth,canvasHeight] let halfWidth = canvasWidth * 0.3, halfHeight = canvasHeight * 0.5 // ä¸€åŠçš„å®½é«˜ center[0] = halfWidth + boundBox.left + grid.left center[1] = halfHeight + boundBox.top + grid.top + window.scrollYè¿™é‡Œå¾—å‡ºçš„æ˜¯ç›®æ ‡ç‚¹ç›¸å¯¹æ•´ä¸ªpageï¼ˆåŒ…æ‹¬æ‰€æœ‰å¯æ»šåŠ¨åŒºåŸŸï¼‰çš„åæ ‡ï¼Œä½†æ˜¯åŒ…å›´ç›’æ˜¯ç›¸å¯¹viewè§†å£çš„ï¼Œæ‰€ä»¥åœ¨é¡µé¢æœ‰æ»šåŠ¨æ—¶ï¼Œä¸€å®šè¦å°†scrollTopçš„å€¼è€ƒè™‘åœ¨å†…ï¼Œä¸‹é¢æ˜¯åŒ…å›´ç›’ä¸­å¿ƒç‚¹ä»¥åŠåç§»è·ç¦»çš„è®¡ç®—ï¼š// è·å–åç§»é‡function getRectCenter() // å½“é¡µé¢å‚ç›´æ»šåŠ¨æ—¶ï¼ŒåŒ…å›´ç›’ä¸­å¿ƒç‚¹ä¼šè®¡ç®—ä¼šå¿½ç•¥é¡µé¢æ»šåŠ¨å€¼scrollTop rectCenter = [ // åŒ…å›´ç›’çš„ä¸­å¿ƒç‚¹ boundRect.left + boundRect.width/2, boundRect.top + boundRect.height/2 + window.scrollY ] // ç›®æ ‡åœ†å½“å‰ä¸­å¿ƒç‚¹ const dX = center[0] - rectCenter[0] const dY = center[1] - rectCenter[1] // console.log(`centerX:$center[0] centerY:$center[1] rectCenterX:$rectCenter[0] rectCenterY:$rectCenter[1] dX:$dX dY:$dY`) return [dX,dY] ä»»åŠ¡è¿›åº¦å·¥æ—¶è¶‹åŠ¿æ—¶é—´çº¿å›¾æ—¶é—´çº¿å›¾ è‡³æ­¤ï¼Œçœ‹ä¼¼æ‰€æœ‰æœ€å…³é”®çš„é—®é¢˜éƒ½è¢«è§£å†³äº†ï¼Œä½†ç°åœ¨é¡µé¢çš„åˆ‡å›¾åˆºå®¢æ¥äº†ï¼Œä»¥å‰å¯¹è¿™ç§æ—¶é—´è½´å›¾è¡¨äº†è§£çš„ç¡®å®ä¸å¤šï¼Œè¿™é‡Œå°±ç”¨çš„æˆ‘å”¯ä¸€æ¯”è¾ƒç†Ÿæ‚‰çš„ vis-timelineä¹‹æ‰€ä»¥é€‰æ‹©å®ƒï¼Œä¹Ÿæ˜¯è€ƒè™‘åˆ°å®ƒæä¾›çš„ä¸‹é¢å‡ ä¸ªåŠŸèƒ½ï¼šæ—¶é—´è½´ç¼©æ”¾æ—¶é—´è½´æ‹–åŠ¨æ—¶é—´å•ä½è‡ªé€‚åº”çˆ†æ”¹vis-timelinevis-timelineä¸åƒechartsï¼Œå®ƒæ˜¯åŸºäºdomçš„ï¼Œæ‰€ä»¥cssé…ç½®é¡¹å…¨éƒ½ä¸¢ç»™ç”¨æˆ·è‡ªå·±é€šè¿‡classNameè¿›è¡Œé…ç½®ï¼Œè¿™ä¸€ç‚¹è®©vis-timelineçš„æ ·å¼è‡ªç”±åº¦å˜å¾—éå¸¸é«˜ï¼Œvis-timelineæœ¬èº«åº”è¯¥æ˜¯æ”¯æŒç”¨htmlå®šåˆ¶å…¶ä¸­çš„å†…å®¹çš„ï¼Œä½†æ˜¯æ— å¥ˆè¿™ä¸€ç‚¹æ˜¯æˆ‘å¼€å‘ä¸€åŠä¹‹åæ‰åœ¨æ–‡æ¡£çš„çŠ„è§’æ—®æ—¯é‡Œæ‰¾åˆ°çš„ï¼ˆvis-timelineçš„æ–‡æ¡£ç²¾ç®€åˆ°ä¸€é¡µå°±æ²¡äº†ï¼‰æ‰€ä»¥æˆ‘ä½¿ç”¨çš„æ–¹æ³•å°±æ˜¯ç®€å•ç²—æš´çš„domæ“ä½œã€‚è¿™è¦ä»vis-timelineçš„ä¸€ä¸ªé’©å­å‡½æ•°è¯´èµ·â€”â€”onInitialDrawCompleteè¿™ä¸ªå‡½æ•°ä»£è¡¨æ—¶é—´è½´è¡¨å·²ç»ç»˜åˆ¶å®Œæ¯•äº†ï¼Œæˆ‘éœ€è¦æ ¹æ®ä¹‹å‰æ ‡è¯†çš„classNameï¼Œæ‰¾åˆ°å¯¹åº”çš„domï¼Œç„¶åæ‰‹åŠ¨ç»™é‡Œé¢åŠ ä¸œè¥¿ï¼Œvis-timelineæ­¤æ—¶çš„ä½œç”¨å°±åƒæ˜¯æä¾›ä¸€ä¸ªæ¨¡å…·ï¼Œè‡³äºé‡Œé¢æ˜¯ä»€ä¹ˆï¼Œæˆ‘è‡ªå·±æ·»åŠ ã€‚ let options = onInitialDrawComplete:()= // ç»˜åˆ¶ç»“æŸçš„å›è°ƒ setProgressStyle() // è‡ªå®šä¹‰è¿›åº¦å›¾æ ·å¼ setHeadStyle() // è‡ªå®šä¹‰è¡¨å¤´æ ·å¼ addEvent() // æ·»åŠ äº‹ä»¶ loading.value = false , // ...timeline = new vis.Timeline(targetDom, itemData, groupData, options)æ‡’åŠ è½½å¸¦æ¥çš„é—®é¢˜vis-timelineä¸­ï¼Œè§†å£èŒƒå›´å†…çš„æ¦‚å¿µéå¸¸é‡è¦ï¼Œæ—¶é—´å•ä½è·Ÿéšè§†å£èŒƒå›´å†…çš„æ•°æ®è¿›è¡Œè‡ªé€‚åº”ï¼ŒåŒæ—¶è§†å£èŒƒå›´è¿˜è§„å®šäº†éœ€è¦å¤„ç†çš„æ•°æ®æœ‰å“ªäº›ã€‚ä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼Œèƒ½å¤Ÿå‡å°‘æ¸²æŸ“æ—¶éœ€è¦å¤„ç†çš„æ•°æ®æ•°é‡ã€‚ä½†æ˜¯è¿™ä¹Ÿæ˜¯æ¯”è¾ƒå‘çˆ¹çš„ï¼Œè¿™å°±è¯´æ˜ä¸€æ—¦æˆ‘è§„èŒƒäº†è§†å£çš„å¤§å°ï¼Œåœ¨å›¾è¡¨å®ä¾‹åŒ–ç»“æŸåï¼Œåªæœ‰è§†å£å†…çš„domä¼šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘å°±å¿…é¡»è¦åœ¨é¼ æ ‡æ‹–åŠ¨æˆ–ç¼©æ”¾åˆ°å…¶å®ƒèŒƒå›´æ—¶ï¼Œå¯¹domè¿›è¡Œé‡æ–°å¡«å……æ“ä½œï¼Œä¹Ÿå°±æ˜¯é…åˆvis-timelineçš„æ‡’åŠ è½½è¿›è¡Œdomæ“ä½œï¼ˆå™©æ¢¦ï¼‰ã€‚ä½†æ˜¯è¿™é‡Œæ°´å¹³å’Œå‚ç›´çš„æ‡’åŠ è½½ç­–ç•¥ä¹Ÿä¸åŒï¼šå‚ç›´æ‡’åŠ è½½ï¼Œæ²¡æœ‰æ»šåŠ¨åˆ°çš„groupåœ¨å‹æ ¹å°±ä¸å­˜åœ¨domæ ‘ä¸­æ°´å¹³æ‡’åŠ è½½ï¼Œæ²¡æœ‰æ»šåŠ¨åˆ°çš„itemå­˜åœ¨åœ¨domæ ‘ä¸­ï¼Œä½†æ˜¯è¢«é€šè¿‡cssçš„transformå±æ€§ç§»åŠ¨åˆ°çœ‹ä¸è§çš„åœ°æ–¹ï¼Œå¹¶ä¸”vis-timelineå°†è¿™äº›è¢«éšè—çš„å…ƒç´ ç§»åŠ¨åˆ°çˆ¶å®¹å™¨çš„ååˆ—ï¼ˆdomæ ‘é¡ºåºè¢«ä¿®æ”¹äº†ï¼‰é’ˆå¯¹è¿™ä¸¤ç‚¹ï¼Œé‡‡å–å¦‚ä¸‹ç­–ç•¥ï¼šå‚ç›´æ‡’åŠ è½½ç›´æ¥ä¸€æ¬¡æ€§å°†æ‰€æœ‰é«˜åº¦éƒ½ç»˜åˆ¶å‡ºæ¥ï¼Œä¸è¦æ‡’åŠ è½½äº†è‡³äºæ»šåŠ¨ï¼Œé€šè¿‡csså®ç°æ³¨æ„ç‚¹ï¼šè¿™é‡Œå›¾è¡¨å†…æœ‰ä¸€ä¸ªä¸‹æ‹‰æ“ä½œï¼Œæ‰€ä»¥å®¹å™¨å®é™…é«˜åº¦éœ€è¦è¿›è¡ŒåŠ¨æ€è®¡ç®—æ°´å¹³æ‡’åŠ è½½é¦–å…ˆå’Œå‚ç›´ä¸€æ ·ï¼Œæ—¶é—´èŒƒå›´é¦–å…ˆæ‹‰å€’æœ€å¤§è‡³äºä¸‹æ‹‰çš„æŸ±çŠ¶å›¾çš„æ¸²æŸ“ï¼Œéœ€è¦åœ¨ä¸‹æ‹‰æ—¶ï¼Œæ ¹æ®å…ƒç´ çš„transformåˆ¤æ–­è¿™ä¸ªå…ƒç´ æ˜¯å¦è¢«éšè—äº†ï¼Œè·å–åˆ°æ²¡æœ‰è¢«éšè—çš„å…ƒç´ å¯¹æ²¡æœ‰è¢«éšè—çš„å…ƒç´ è¿›è¡Œæ“ä½œ æœªä¿®å¤æ—¶ï¼Œæ‡’åŠ è½½å¯¼è‡´çš„domè®¡ç®—é”™è¯¯ ä¿®å¤å æ­¤å¤„æ—¶é—´è½´å¼€å‘è¿‡ç¨‹é—®é¢˜ç™¾å‡ºï¼Œä»£ç ä¹Ÿæ˜¯ä¿®ä¿®è¡¥è¡¥ï¼Œæ‹†äº†ä¸œå¢™è¡¥è¥¿å¢™ï¼Œå°½ç®¡æœ€ç»ˆå®ç°äº†äº§å“æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯ä»ä»£ç å±‚é¢ä¸Šçš„å¯å¤ç”¨æ€§ä¸é«˜ å…¶ä»–æ— é™æ»šåŠ¨åŠŸèƒ½æè¿°åˆ—è¡¨æ æ— é™æ»šåŠ¨ï¼Œé¼ æ ‡ç§»å…¥ååœæ­¢æ»šåŠ¨ï¼Œé¼ æ ‡ç§»å‡ºç»§ç»­æ»šåŠ¨å®ç°æ–¹å¼gsapæ’å€¼æ§åˆ¶domçš„scrollTopåˆ—è¡¨å°¾éƒ¨åŠ ä¸Šå‡ ä¸ªé‡å¤é¡¹ï¼Œä»¥å®ç°å¾ªç¯å‡è±¡æ¯”å¦‚å®¹å™¨è§†å£å†…å±•ç¤º5ä¸ªï¼Œåˆ—è¡¨æ•°æ®ä¸º[1,2,3,4,5,6,7,8,9,10]åˆ—è¡¨æ•°æ®åº”å½“å¡«å……ä¸º[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5]ç”¨æˆ·é¼ æ ‡æ§åˆ¶åŠ¨ç”»mouseenter tween.pauseæš‚åœåŠ¨ç”»mouseleave tween.playç»§ç»­åŠ¨ç”»é¼ æ ‡æ§åˆ¶åŠ¨ç”»çœ‹ä¼¼æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œé—®é¢˜å°±æ¥äº†ï¼šå½“ç”¨æˆ·é¼ æ ‡ç§»å…¥æ»šåŠ¨domæ—¶ï¼Œdomçš„scrollTopè¢«æ”¹åŠ¨äº†ï¼Œæ­¤æ—¶é¼ æ ‡ç§»å‡ºï¼Œtweenå¦‚æœæ¥ç€ä¹‹å‰çš„ä½ç½®å‘ä¸‹æ»šåŠ¨ï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„å¿…é¡»å¾—æ¥ç€ç”¨æˆ·æ»šåŠ¨åˆ°çš„ä½ç½®ç»§ç»­æ»šåŠ¨æ‰€ä»¥åœ¨åŠ¨ç”»æš‚åœæ»šè½®è‡ªå®šä¹‰æ»šåŠ¨ä¹‹åï¼Œéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªtweenï¼Œå®ƒçš„ç›®æ ‡å€¼ä¸å˜ï¼Œä¾æ—§æ˜¯å®¹å™¨çš„scrollHeight-scrollTopï¼Œä½†æ˜¯å®ƒçš„æŒç»­æ—¶é—´éœ€è¦æŒ‰ç…§æ¯”ä¾‹è®¡ç®—äº†ï¼Œå¾—æ˜¯å½“å‰åŠ¨ç”»æ»šåŠ¨è·ç¦»åˆå§‹åŠ¨ç”»æ»šåŠ¨è·ç¦»*åˆå§‹åŠ¨ç”»æŒç»­æ—¶é—´ï¼Œç„¶åå†è¿™ä¸ªåŠæˆªåŠ¨ç”»ç»“æŸä¹‹åï¼Œå°†å®¹å™¨scrollTopç½®é¡¶ï¼Œé‡æ–°å‘èµ·å¾ªç¯çš„å®Œæ•´æ»šåŠ¨åŠ¨ç”»ï¼šwatch(loading,(nv,ov)= let dom = document.querySelector(#hot-kanban) if(nv == false) dom.scrollTop = 0 let scroll_h = dom.scrollHeight let dom_h = dom.clientHeight let offset = scroll_h - dom_h let delay = 3 let duration = 30 if(offset0) let initTweenOption = scrollTop:offset, duration:duration, ease:none, tween = gsap.to(dom, ...initTweenOption, delay:delay, ) dom.onmouseenter = e = tween.pause() // åŠ¨ç”»æš‚åœ dom.onscroll = e =dom.scrollTop == offset (dom.scrollTop = 0) // å¼€å§‹ç›‘å¬ç”¨æˆ·æ»šåŠ¨äº‹ä»¶ dom.onmouseleave = e = let current_offset = offset - dom.scrollTop let radio = current_offset / offset * duration tween = gsap.to(dom, // é‡æ–°å¼€å¯åŠ¨ç”» scrollTop:offset, duration:radio, ease:none, onComplete:()= dom.scrollTop = 0 tween = gsap.to(dom,initTweenOption) tween.play() tween.repeat(-1) ) tween.play() tween.repeat(-1) else tween tween.kill() tween = null dom.onmouseenter = undefined dom.onmouseleave = undefined dom.onscroll = undefined ) é˜²é®é®æŒ¡æµ®çª—å­—ä½“èƒŒæ™¯åç›¸å¤„ç† æ­£å¸¸æƒ…å†µä¸‹ æµ®çª—ä¸é®æŒ¡ä¸Šé¢å­—ä½“å­—ä½“åœ¨ç©ºé—´ä¸è¶³æ—¶åç›¸å¤„ç† è¿™é‡Œçš„å­—ä½“å’ŒèƒŒæ™¯é¢œè‰²åç›¸å¤„ç†ï¼Œä½¿ç”¨åˆ°cssçš„mix-blend-modeå±æ€§ loadingæ•ˆæœ CodePenå‚è€ƒï¼šChokcoco CodePen è¿™é‡Œçš„æ•ˆæœéƒ½æ˜¯ç”¨cssçš„filterå®ç°çš„ï¼Œçˆ¶å®¹å™¨çš„contractå’Œå­å®¹å™¨çš„blurç»“åˆï¼Œèƒ½å®ç°æ¶²ä½“èåˆçš„æ•ˆæœï¼Œéå¸¸æœ‰è¶£ï¼Œå¦å¤–ï¼Œç”¨æ¯›ç»ç’ƒå¯¹å½©è‰²èƒŒæ™¯è¿›è¡Œé®ç½©ä¹Ÿèƒ½å®ç°æ¯”è¾ƒé«˜çº§çš„æ•ˆæœã€‚ ç»“è¯­ä¸Šé¢è®°å½•äº†å¾ˆå¤šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å¤§ä½“çœ‹æ¥ï¼Œè¦ä¹ˆæ˜¯åœ¨æ‰‹åŠ¨æ‹“å±•ç»„ä»¶æ— æ³•å¸¦æ¥çš„æ•ˆæœï¼Œechartsæœ‰è¿™ä¸ªå›¾å—â†’å¦‚ä½•å®ç°â†’å¦‚ä½•è‡ªå®šä¹‰äº¤äº’â†’å¦‚ä½•å®ç°é¢œè‰²æ··åˆè¦ä¹ˆæ˜¯ä¿®å¤ç»„ä»¶ç‰¹æ€§å¸¦æ¥çš„bugï¼Œvis-timelineæ€ä¹ˆä¼šå¯¼è‡´æˆ‘æ‰¾ä¸åˆ°ç›®æ ‡domâ†’åŸæ¥æ˜¯æ‡’åŠ è½½å¯¼è‡´çš„â†’å¦‚ä½•ä¿®å¤å†å›é¡¾è¿™äº›ï¼Œæœ€åˆé€‰æ‹©å›¾è¡¨åº“æ˜¯ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œä½†æ˜¯æœ€ç»ˆä¸ºäº†å¼¥è¡¥åº“æ— æ³•å®ç°çš„æ•ˆæœï¼ŒèŠ±è´¹çš„æ—¶é—´å’Œä¹¦å†™çš„ä»£ç å¯èƒ½è¿˜è¦å¤šå¾—å¤šï¼ˆå†™æ°´çƒæ•£ç‚¹å›¾çš„ä»£ç æ¯”echarts-liquidè¿™ä¸ªåº“çš„ä»£ç è¿˜è¦å¤šï¼Œè¿˜ä¸å¦‚ç ”ç©¶ç ”ç©¶echartsçš„customç±»ï¼‰æœ€é‡è¦çš„è¿˜æ˜¯æŠŠsvgã€canvasã€domã€æ•°å­¦è¿™äº›åŸºç¡€çŸ¥è¯†å¹³æ—¶å¤¯åŸºç¡€ã€‚ åè®°VisualMapä¹‹ååˆä»”ç»†é˜…è¯»äº†ä¸€ä¸‹echartså®˜ç½‘å…³äºdatasetå’ŒvisualMapéƒ¨åˆ†çš„ä»‹ç»ï¼Œå‘ç°å½“å‰çš„è¿™ç§å®ç°æ°”æ³¡å›¾çš„æ–¹æ³•ï¼Œç¡®å®æ¯”è¾ƒç”Ÿç¡¬ï¼Œæ¯”å¦‚æ•°æ®æ˜ å°„ï¼ŒvisualMapå¯ä»¥éå¸¸ç®€å•çš„å°±å®ç°æŸä¸ªå±æ€§æ ¹æ®æƒé‡åœ¨æŸä¸ªèŒƒå›´å†…çš„æ˜ å°„ï¼šoption = dataset: source:[ // x y size [12, 323, 400, 11.2], [23, 167, 300, 8.3], [81, 284, 100, 12], [91, 413, 450, 4.1], [13, 287, 140, 13.5], [50, 250, 310, 15.5], ] , visualMap: show:false, dimension:3, // æ˜ å°„ç»´åº¦ min:2, max:15, inRange: symbolSize:[5,60] // æ°”æ³¡å°ºå¯¸çš„èŒƒå›´ , xAxis:, yAxis:, series:[ type:scatter, encode:x:0,y:1, type:scatter, encode:x:0,y:2, ] åæ ‡æ˜ å°„bugæ‰‹åŠ¨å®ç°åæ ‡æ˜ å°„ï¼ˆä»”ç»†æƒ³æƒ³æœç„¶è¿˜æ˜¯æ²¡æœ‰å¿…è¦å§ï¼‰ï¼Œä¹‹åæµ‹è¯•è¿‡ç¨‹ä¸­è¿˜æ˜¯å‘ç°æœ‰bugï¼Œè¿™æ˜¯å› ä¸ºæ˜¯ä¸€æ¬¡éå†æ‰€æœ‰æ°´çƒè®¡ç®—å‡ºä¸Šä¸‹å·¦å³è¾¹ç•Œçš„ï¼Œéå†è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°è¿™æ ·çš„æƒ…å†µï¼šæ°´çƒAä¸‹è¾¹ç•Œå‡ºç•Œï¼Œåæ ‡ç³»yè½´ä¸‹é¢åŠ ä¸Šå‡ ä¸ªå•ä½ï¼Œç»§ç»­éå†æ°´çƒBä¸Šè¾¹ç•Œå‡ºç•Œï¼Œåæ ‡ç³»yè½´ä¸Šé¢åŠ ä¸Šå‡ ä¸ªå•ä½æ­¤æ—¶ç”±äºå•ä½å˜å¤šï¼Œå•ä½ç»å¯¹é•¿åº¦å˜å°ï¼Œæ°´çƒAåˆè¢«æŒ¤å‡ºä¸‹è¾¹ç•Œäº†é’ˆå¯¹è¿™ä¸ªbugï¼Œå¯ä»¥å°†çƒä½“æ ¹æ®åŠå¾„ç”±å°åˆ°å¤§æ’åºï¼Œä»å°çš„å¼€å§‹è®¡ç®—æ·»åŠ å•ä½ï¼Œè¿™æ ·æ›´ä¸å®¹æ˜“å‡ºç°åœ¨è¿™ç§bugï¼Œä¹Ÿå¯ä»¥å¾ªç¯éå†ï¼Œç›´åˆ°éå†ç»“æœä¸ºæ²¡æœ‰ä¸€ä¸ªæ°´çƒå‡ºç•Œä¸ºæ­¢ã€‚","tags":["Web","å¯è§†åŒ–"]},{"title":"Web Video ä½¿ç”¨é—®é¢˜è®°å½•","path":"/2024/04/01/BlobVideoUrl/","content":"é—®é¢˜èƒŒæ™¯å‚è€ƒæ–‡ç« ï¼š ä¸ºä»€ä¹ˆè§†é¢‘ç½‘ç«™çš„è§†é¢‘é“¾æ¥åœ°å€æ˜¯blobï¼Ÿæœ€è¿‘åœ¨åšä¸€ä¸ªwebå¤§å±é¡¹ç›®ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šè§†é¢‘éœ€è¦åŒæ—¶æ’­æ”¾ï¼Œæ¯ä¸ªé¡µé¢åŒ…æ‹¬8ä¸ªå®æ—¶ç›‘æ§è§†é¢‘ï¼Œå†åŠ ä¸Š1ä¸ªèƒŒæ™¯è§†é¢‘ï¼Œå†åŠ ä¸Šé¡µé¢ä¸Šç¹é‡çš„domæ¸²æŸ“å’ŒcssåŠ¨ç”»ï¼Œè¿è¡Œèµ·æ¥å·¨å¡ï¼Œå¥½ä¸å®¹æ˜“ä¼˜åŒ–äº†ä¹‹åï¼Œdomæ²¡è¿™ä¹ˆå¡äº†ï¼Œä½†è§†é¢‘è¿˜æ˜¯å¡çš„å‡ºå¥‡ï¼Œäºæ˜¯å°±ç‰¹åœ°ç ”ç©¶äº†ä¸‹è¿™å—ã€‚ åŒæºç­–ç•¥ç›‘æ§è§†é¢‘æ€ä¹ˆå°±åŠ è½½ä¸å‡ºæ¥å‘¢ï¼Ÿ è§†é¢‘åŠ è½½æ…¢å’Œè§†é¢‘æ ¼å¼æœ‰å…³å—è§†é¢‘åŠ è½½ä¸ºä»€ä¹ˆä¼šæ…¢ï¼Ÿç¡¬ä»¶é—®é¢˜ï¼šæ£€æŸ¥ä¸€ä¸‹æµè§ˆå™¨è¿è¡Œç½‘é¡µæ—¶çš„ä»»åŠ¡ç®¡ç†å™¨èµ„æºå ç”¨å€¼ï¼ŒCPUéƒ½é£šåˆ°ä¸ƒå…«åçš„ï¼Œç”µè„‘æ˜¯çœŸçš„*GPUçƒ‚çš„å°±æŠŠæµè§ˆå™¨çš„ç¡¬ä»¶åŠ é€Ÿå…³äº†å§ï¼ŒCPUæ›´çƒ‚çš„å½“æˆ‘æ²¡è¯´æ¸²æŸ“ç­–ç•¥é—®é¢˜ï¼šä¸è¯¥æ¸²æŸ“çš„å…ƒç´ å»æ‰ï¼Œå°‘åŠ åŠ¨ç”»æœ¬åœ°è§†é¢‘ï¼Œä¸è€ƒè™‘ç½‘ç»œé—®é¢˜ï¼Œç©ºç™½é¡µé¢ï¼Œä¸è€ƒè™‘æ¸²æŸ“é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè§†é¢‘åŠ è½½ä¼šè¿™ä¹ˆæ…¢å‘¢ï¼Œéš¾é“å’Œç¼–ç ç›¸å…³å—ï¼Ÿå®æ—¶è§†é¢‘æ˜¯ä»¥FMP4æµçš„æ ¼å¼ä¼ è¾“æ¥çš„,åç«¯è¿˜æä¾›äº†å…¶å®ƒä¸€äº›æ ¼å¼çš„è§†é¢‘æµï¼šå…³äºè§†é¢‘æ ¼å¼é—®é¢˜ï¼Œå®é™…ä¸Šåˆ°ç°åœ¨ä¹Ÿæ²¡æœ‰å¼„æ¸…æ¥šï¼šå‡ ä¸ªæœç´¢å…³é”®å­—ï¼šWebRTC-Streamer RTSP Fetchæµåª’ä½“æ’­æ”¾ç­–ç•¥å†æ—¶æ•°æœˆé’»ç ”æ¨æµå¯¹æ¯”å„ç§æµåª’ä½“æœåŠ¡ç¨‹åºPKæ€»ç»“ç›‘æ§å®æ—¶ç›´æ’­çš„å››åˆ†å±çš„å‰ç«¯å±•ç¤ºwebrtcVUE3+TS+VITE+webrtc-streamerå®ç°å®æ—¶è§†é¢‘æ’­æ”¾åœ¨webä¸­æ’­æ”¾rtspè§†é¢‘æ–¹æ¡ˆå¯¹æ¯”HTML5 æ’­æ”¾ RTSP è§†é¢‘fetch+Blobä» Fetch åˆ° Streams â€”â€” ä»¥æµçš„è§’åº¦å¤„ç†ç½‘ç»œè¯·æ±‚Fetch API æ•™ç¨‹ä½†å®é™…ä¸Šï¼Œ8ä¸ªè§†é¢‘ä»æ¥éƒ½æ²¡æœ‰ä¸€é½è¢«åŠ è½½å‡ºæ¥è¿‡ï¼Œä»æ¥éƒ½æ˜¯åŠ è½½å‡º6ä¸ªï¼Œåé¢å°±æ²¡éŸ³äº†ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°8ä¸ªè¯·æ±‚ä¸­æ€»æ˜¯æœ‰2ä¸ªè¯·æ±‚æ²¡æ³•å‡ºå»ï¼Œè¢«æŒ‚èµ·äº†ï¼šç„¶åæˆ‘æ‰çŸ¥é“åŒæºç­–ç•¥æœ‰ä¸ªè·¯æ•°é™åˆ¶ï¼Œå°±æ˜¯æœ€å¤šåªèƒ½åŒæ—¶å¯¹ä¸€ä¸ªåè®®+ip+ç«¯å£è¯·æ±‚6æ¬¡ï¼Œè¿™é‡Œå®æ—¶è§†é¢‘ä»¥FMP4æµæ ¼å¼è¿›è¡Œä¼ è¾“ï¼Œæ¥å£éœ€è¦ä¸€ç›´ä¿æŒè¿æ¥ï¼Œæ‰€ä»¥åé¢å†å‘èµ·çš„è¯·æ±‚å°±åˆ†ä¸åˆ°è¿™6ä¸ªåé¢äº†ï¼Œå‚è€ƒIssuesè§£å†³æ–¹æ³•HTTPå‡çº§åˆ°2.0ä½¿ç”¨HTTP2.0è§£å†³æµè§ˆå™¨é™åˆ¶åŒæºHTTP1.xè¿æ¥å¹¶å‘ä¸ªæ•°çš„é—®é¢˜æ€æ ·æŠŠç½‘ç«™å‡çº§åˆ°http2websocket + flvæµè§ˆå™¨åªèƒ½æ’­æ”¾6è·¯http-flvæµçš„è§£å†³æ–¹æ³•nginxä»£ç†è§£å†³ç½‘é¡µè§†é¢‘æœ€å¤§åªèƒ½æ’­æ”¾6è·¯çš„é—®é¢˜ Blob Urlæœç´¢å…³é”®å­—ï¼š Video Fetch Blob Urlæ¯”è¾ƒå¥‡ç‰¹çš„ä¸€ç‚¹å°±æ˜¯ï¼Œè¿™8ä¸ªå®æ—¶è§†é¢‘ä¸€ç•ªæŠ˜è…¾åç»ˆäºè¯·æ±‚è¿‡æ¥äº†ï¼Œä½†å®æ—¶è§†é¢‘è¦æ¯”æœ¬åœ°è§†é¢‘æµç•…çš„å¤šã€‚ä¸ºä»€ä¹ˆæœ¬åœ°è§†é¢‘ä¼šè¿™ä¹ˆå¡å‘¢ï¼Ÿä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯è§†é¢‘ç¼–ç çš„åŸå› ï¼Œäºæ˜¯å°†MP4ç±»å‹çš„è§†é¢‘è½¬æ¢ä¸ºwebmç±»å‹çš„è§†é¢‘ï¼Œç»“æœä¸çŸ¥é“ä¸ºä»€ä¹ˆwebmè§†é¢‘ä¸€è·³è½¬å°±å¡ä½ã€‚å…¶å®è§†é¢‘ä¹Ÿä¸æ˜¯ä¸€ç›´å¾ˆå¡ï¼Œè€Œæ˜¯å’Œç½‘é¡µè§†é¢‘ç¼“å­˜æ¡ä¸€æ ·ï¼Œæ—¶å¥½æ—¶åï¼Œç›´åˆ°æˆ‘çœ‹åˆ°è¿™ç¯‡åšå®¢ï¼šhtml5 video è§†é¢‘é¡µé¢å†…ç¼“å­˜ - å…¨é‡åŠ è½½æ–¹æ³•é‡ç‚¹æ˜¯ï¼Œå¯¹æ™®é€šè§†é¢‘ï¼Œæµè§ˆå™¨ä¼šæ’­æ”¾ä¸€ä¼šç¼“å†²ä¸€ä¼šï¼Œå³å±€éƒ¨ä¸‹è½½ï¼Œæˆ‘çš„è§†é¢‘å¾ˆçŸ­ï¼Œä½†æ˜¯ä¼šæœ‰å¾ˆå¤šè·³è½¬æ“ä½œï¼Œå¦‚æœèƒ½åœ¨ä¸€å¼€å§‹å°±æŠŠè§†é¢‘å…¨é‡åŠ è½½ï¼Œå°±ä¸æ€•åé¢å±€éƒ¨åŠ è½½æ—¶å‡ºç°å¡é¡¿çš„æƒ…å†µäº†ï¼Œå®ç°è§†é¢‘å…¨é‡åŠ è½½è€Œä¸æ˜¯è·ŸæŒ¤ç‰™è†ä¸€æ ·çš„æ–¹æ³•å°±æ˜¯fetch+blobfetch(url).then(res= if(!res.ok) throw new Error(network response was not ok) return res.blob()).then(blob= const url = URL.createObjectURL(blob) const sourceDom = document.createElement(source) video.src = url)éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯videoJsæ’­æ”¾å™¨ï¼Œä½¿ç”¨blob urlåŠ è½½è§†é¢‘ï¼Œéœ€è¦å°†åˆ›å»ºplayerçš„optionä¸­çš„typeé…ç½®æˆè§†é¢‘å¯¹åº”çš„ç¼–ç let options = autoPlay:true, muted:true, loop:true, preload:auto, type:video/mp4 IndexedDBå¯¹è§†é¢‘è¿›è¡Œåˆ‡ç‰‡ç¼“å­˜fetché‡è¯·æ±‚å¯¼è‡´çš„é—®é¢˜ ä½¿ç”¨fetchèƒ½å¤Ÿä¸€æ¬¡æ€§åŠ è½½å®Œblobæ ¼å¼çš„è§†é¢‘ï¼Œä½†æ˜¯åˆå‡ºç°æ–°çš„é—®é¢˜ï¼šæœ¬åœ°å¼€å‘æ—¶ï¼Œè§†é¢‘ä»æœ¬åœ°åŠ è½½ï¼Œå› æ­¤é€Ÿåº¦å¿«ï¼ŒæœåŠ¡éƒ¨ç½²åï¼Œé™æ€èµ„æºè¿œç¨‹fetchéœ€è¦ä¸€äº›æ—¶é—´ï¼ˆ3åˆ†é’Ÿè§†é¢‘éœ€è¦åŠ è½½2åˆ†é’Ÿï¼‰å¹¶ä¸”æ¯æ¬¡åŠ è½½ç½‘é¡µéƒ½éœ€è¦é‡æ–°åŠ è½½è§†é¢‘æˆ‘å°è¯•é…ç½®fetchçš„optionä¸­çš„ cacheé€‰é¡¹fetch(./xxx.mp4, cache:no-cache).then(res=)å®é™…ä¸Šæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºï¼šé…ç½®ä»…æ˜¯å‘Šè¯‰æœåŠ¡å™¨å®¢æˆ·ç«¯æœŸå¾…çš„å›å¤æ–¹å¼ï¼ŒæœåŠ¡ç«¯å¦‚æœä¸æ”¯æŒé…ç½®çš„æ–¹å¼çš„è¯ä¹Ÿæ˜¯æ— ç”¨çš„ã€‚å¯¹äºicoã€å­—ä½“è¿™ç§å°æ–‡ä»¶ï¼Œè¿˜æ¯”è¾ƒå¥½ç¼“å­˜ï¼Œè§†é¢‘è¿™ä¹ˆå¤§çš„æ–‡ä»¶å°±ä¸æ€ä¹ˆå¥½ç¼“å­˜äº†ã€‚ æµè§ˆå™¨å­˜å‚¨è§†é¢‘ è§†é¢‘å¤§å°ï¼š300MBå·¦å³è§†é¢‘é•¿åº¦ï¼š2åˆ†åŠMIME Typeï¼švideomp4ä¸€å¼€å§‹å› ä¸ºä¸çŸ¥é“æœ‰â€œå­˜å‚¨é™åˆ¶â€è¿™ä¸ªä¸œè¥¿ï¼Œæˆ‘å°è¯•ä½¿ç”¨localStorageå­˜å‚¨è¿™ä¸ª300MBå¤§å°çš„è§†é¢‘ï¼Œç»“æœæŠŠæµè§ˆå™¨å¡æ­»å¥½å‡ æ¬¡ï¼Œè¿™æ˜¯å› ä¸ºlocalStorageæœ‰å­˜å‚¨é™åˆ¶æµ‹è¯•localStorageå¤§å°Web Storageäºæ˜¯æˆ‘æƒ³åˆ°æœ‰ indexedDB è¿™ä¸ªä¸œè¥¿ã€‚åœ¨ç”¨bç«™çœ‹è§†é¢‘æ—¶ï¼ŒåŒæ ·æ˜¯ç”¨blobæ ¼å¼fetchçš„è§†é¢‘æ•°æ®å°±éå¸¸æµç•…ï¼Œå¹¶ä¸”æ‰“å¼€æ—¶ä¼šæ¥ç€ä¸Šä¸€æ¬¡æ’­æ”¾ï¼Œè¿™é‡Œä½¿ç”¨çš„ä¹Ÿæ˜¯ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ã€‚é™¤äº†å¯¹è§†é¢‘çš„metaæ•°æ®å’Œæ—¶é—´å¸§è¿›è¡Œç¼“å­˜å¤–ï¼Œæœ‰äº›æ—¶å€™è¿˜ä¼šå¯¹blobæ ¼å¼çš„è§†é¢‘æœ¬èº«è¿›è¡Œç¼“å­˜ï¼š indexedDBçš„ä½¿ç”¨ å‚è€ƒæ–‡ç« IndexedDBä½¿ç”¨ä¸å‡ºå‘æŒ‡å—ï¼ˆ16å¹´çš„æ–‡ç« ï¼‰ç”¨promsieè§£å†³IndexedDbå¼‚æ­¥é—®é¢˜","tags":["Web"]},{"title":"Electron","path":"/2024/03/30/Electron/","content":"https://www.bilibili.com/video/BV1xd4y1J7dB/?p=2&spm_id_from=pageDriver&vd_source=f55c755ba9aae4a4382a0f9d56858d01https://puyixiu.github.io/%E5%8E%9F%E8%A7%86%E9%A2%91%E8%B5%84%E6%BA%90 Electronä»‹ç»electronæ ¸å¿ƒæŠ€æœ¯ Electronçš„ä¸‰ä¸ªæ ¸å¿ƒç»„æˆï¼šChromiumï¼šæµè§ˆå™¨æ¸²æŸ“Node.jsï¼šæ–‡ä»¶è¯»å–Native apisï¼šæä¾›ç»Ÿä¸€åŸç”Ÿç•Œé¢èƒ½åŠ›ï¼ˆæ“ä½œç³»ç»Ÿäº¤äº’ï¼‰ç”¨Electronåšçš„æ¯”è¾ƒå‡ºåçš„è½¯ä»¶å¤§æ¦‚å°±æ˜¯VSCodeäº†ï¼Œelectronä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯è·¨å¹³å°å…¼å®¹æ€§å¥½ï¼Œä½†æ˜¯åœ¨å†…å­˜å ç”¨æ–¹é¢ä¹Ÿç»å¸¸è¢«äººè¯Ÿç—…ï¼Œå› ä¸ºelectronåº”ç”¨å°±ç®—ä»€ä¹ˆå†…å®¹éƒ½æ²¡æœ‰ï¼Œè¿˜æœ‰æ•´æ•´200MBçš„Chromiumå¼•æ“åŒ…åœ¨é‡Œé¢ electronå·¥ä½œæµç¨‹ æ¡Œé¢åº”ç”¨å’Œwebåº”ç”¨ä¸åŒçš„æ˜¯æ¶‰åŠåˆ°å¯¹æ“ä½œç³»ç»Ÿçš„æ“ä½œï¼Œä½†è¿™ä¸€éƒ¨åˆ†éƒ½ç”±Native apiså®ç°ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆåªéœ€è¦å…³å¿ƒæ¸²æŸ“å±‚é¢çš„ä¸œè¥¿å°±å¯ä»¥ã€‚electronä¸­çš„ä¸¤ç§è¿›ç¨‹ï¼šä¸»è¿›ç¨‹ Main Processä¸€ä¸ªåº”ç”¨ä¸»è¿›ç¨‹å”¯ä¸€å¯åŠ¨å…¥å£ä¸€èˆ¬åœ¨main.jsä¸­ï¼ˆpackage.jsonä¸­mainé…ç½®å…¥å£ï¼‰é¦–å…ˆå¯åŠ¨ï¼Œå¯åŠ¨åè°ƒç”¨Native UIåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªBrowsersWindowç•Œé¢æ¸²æŸ“è¿›ç¨‹ Renderer Processä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰å¤šä¸ªæ¸²æŸ“è¿›ç¨‹åœ¨BrowersWindowä¸Šè¿è¡Œçš„è¿›ç¨‹å„ä¸ªæ¸²æŸ“è¿›ç¨‹äº’ä¸å¹²æ‰°ï¼Œåœ¨è‡ªå·±çš„æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œå„ä¸ªè¿›ç¨‹ä¹‹é—´ä½¿ç”¨IPCè¿›è¡Œé€šä¿¡step1å¯åŠ¨APPstep2ä¸»è¿›ç¨‹åˆ›å»ºwindowstep3windowåŠ è½½ç•Œé¢step4ç•Œé¢äº¤äº’æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿï¼Œæ¸²æŸ“è¿›ç¨‹é€šè¿‡IPCå’Œä¸»è¿›ç¨‹é€šä¿¡ï¼Œä¸»è¿›ç¨‹å†è°ƒç”¨native apis Electronå¼€å‘æ¡†æ¶ç»“æ„ä»£ç ç»“æ„ å®˜æ–¹æä¾›çš„æ¡†æ¶æ¡ˆä¾‹ï¼šå…¥å£æ–‡ä»¶main.jsconst app, BrowserWindow = require(electron)app.whenReady().then(()= let mainWin = new BrowserWindow( width:800, height:600 ) mainWin.loadFile(index.html) mainWin.on(close,()= console.log(close) mainWin = null ))app.on(window-all-closed,()= console.log(window-all-closed) app.quit()) ä½¿ç”¨nodemonè¾…åŠ©å¼€å‘nodemon ä½¿ç”¨nodeå‘½ä»¤å¯åŠ¨serveræ—¶ï¼Œæ¯å½“ä»£ç ä¿®æ”¹ï¼Œéƒ½éœ€è¦é‡å¯serverï¼šnode server.jselectronå¼€å‘ä¹Ÿæ˜¯è¿™æ ·ï¼Œæ¯å½“ä¸»è¿›ç¨‹ä»£ç ï¼ˆmain.jsï¼‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦é‡å¯é¡¹ç›®ï¼šelectron . ä½¿ç”¨nodemonï¼Œå¯ä»¥ç›‘å¬æŒ‡å®šæºç çš„å˜åŒ–ï¼Œè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ï¼šscripts: test: echo \\Error: no test specified\\ exit 1, start: nodemon --watch main.js --exec npm run dev, dev: electron . ç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸ readyappåˆå§‹åŒ–å®Œæˆdom-readywebContentsç›‘å¬ï¼Œçª—å£æ–‡æœ¬åŠ è½½å®Œæˆdid-finish-loadwebContentsç›‘å¬ï¼Œå¯¼èˆªå®Œæˆæ—¶è§¦å‘window-all-closedæ‰€æœ‰çª—å£éƒ½è¢«å…³é—­æ—¶è§¦å‘before quitå…³é—­çª—å£å‰è§¦å‘will-quitçª—å£å…³é—­åº”ç”¨ç¨‹åºé€€å‡ºæ—¶è§¦å‘quitæ‰€æœ‰çª—å£è¢«å…³é—­æ—¶è§¦å‘closedçª—å£è¢«å…³é—­æ—¶è§¦å‘ï¼Œæ­¤æ—¶åº”åˆ é™¤çª—å£å¼•ç”¨å¯ä»¥åœ¨closedä¸­å°†çª—å£å¯¹è±¡ç½®nullè¿›è¡Œå†…å­˜å›æ”¶ çª—ä½“çª—ä½“æ˜¾ç¤º ç”±äºçª—ä½“å…ˆåˆ›å»ºåæ˜¾ç¤ºï¼Œå› æ­¤åœ¨domæ¸²æŸ“ä¹‹å‰ä¼šå‡ºç°ç™½å±çš„æƒ…å†µï¼Œå¯ä»¥å…ˆå°†çª—å£showè®¾ç½®ä¸ºfalseï¼ŒloadFileåç›‘å¬ready-to-showäº‹ä»¶ï¼Œå†ç”¨win.showå°†çª—å£è°ƒå‡ºï¼šlet mainWin = new BrowserWindow( width:800, height:600, show:false)mainWin.loadFile(index.html)mainWin.on(ready-to-show,()= mainWin.show())è°ƒå‡ºæ§åˆ¶å°å¿«æ·é”®ï¼šCtrl+Shift+iå¤šä¸ªçª—ä½“åˆ›å»ºå¤šä¸ªçª—ä½“å¦‚æœMainWindowé‡Œæ¸²æŸ“çš„ç•Œé¢æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç•Œé¢ï¼Œè¿™æ„å‘³ç€éœ€è¦ç»™æŒ‰é’®ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶åœ¨å¯¹åº”äº‹ä»¶ä¸­è¿›è¡Œçª—å£è°ƒç”¨æ“ä½œã€‚åœ¨çª—å£å¯¹åº”çš„htmlæ–‡ä»¶ä¸­ï¼Œå¼•å…¥jsè„šæœ¬ï¼Œè„šæœ¬å†…å¼•å…¥electronæä¾›çš„ç”¨äºåˆ›å»ºçª—å£çš„å¯¹è±¡ï¼šï¼ˆè¿™éƒ¨åˆ†å‚è€ƒElectronæœ€æ–°ç‰ˆremoteé—®é¢˜ï¼‰æ³¨æ„ï¼šéœ€è¦æ‰“å¼€MainWindowä¸­çš„WebPreferences.nodeIntegrationåæ‰èƒ½åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨nodeã€‚è°ƒç”¨Electronçš„APIè¿˜éœ€è¦æ‰“å¼€WebPreferencesä¸­çš„ä¸¤ä¸ªå±æ€§ï¼šcontextIsolation:false; // ä¸Šä¸‹æ–‡éš”ç¦»enableRemoteModule:true; // è¿œç¨‹è°ƒç”¨æ–°ç‰ˆæœ¬çš„electronè¿œç¨‹è°ƒç”¨éœ€è¦å®‰è£…@electronremoteåº“ï¼Œæ³¨æ„ï¼Œå®‰è£…@electronremoteåº“æ—¶æŠ¥é”™å¯ä»¥ç”¨cnpmå®‰è£…ï¼šcnpm install @electron/remoteåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œé€šè¿‡å¼•å…¥@electronremoteè¿œç¨‹è°ƒç”¨apiåœ¨ä¸»è¿›ç¨‹ä¸­éœ€è¦å¯¹remoteè¿›è¡Œåˆå§‹åŒ–ï¼šapp.whenReady().then(()= let mainWin = new BrowserWindow(...) require(@electron/remote/main).initialize() require(@electron/remote/main).enable(mainWin.webContents))index.htmlå¼•å…¥çš„index.jsconst BrowserWindow = require(@electron/remote)window.addEventListener(DOMContentLoaded,()= const oBtn = document.getElementById(open-btn) oBtn.addEventListener(click,()= let win = new BrowserWindow( width:200, height:200 ) win.loadFile(remoteIndex.html) win.on(close,()= win = null ) )) è‡ªå®šä¹‰çª—ä½“è‡ªå®šä¹‰çª—å£ å’Œåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çª—å£ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨ä»remoteä¸­å¼•ç”¨apiè¿›è¡Œçª—å£æ“ä½œï¼šgetCurrentWindow è·å–å½“å‰çª—å£win.close() å…³é—­å½“å‰çª—å£ï¼Œä¼šè§¦å‘window.onbeforeunloadäº‹ä»¶win.isMaximized() æŸ¥è¯¢å½“å‰çª—å£æ˜¯å¦å·²ç»æœ€å¤§åŒ–win.maximize() çª—å£æœ€å¤§åŒ–æ˜¾ç¤ºwin.restore() çª—å£å›å½’åŸå§‹çŠ¶æ€win.isMinimized() çª—å£æ˜¯å¦å·²ç»æœ€å°åŒ–æ˜¾ç¤ºwin.minimize() çª—å£æœ€å°åŒ–æ˜¾ç¤ºwin.destroy() æ‘§æ¯å½“å‰çª—å£ï¼Œä¸ä¼šè§¦å‘onbeforeunloadäº‹ä»¶ä»£ç å®ç°const getCurrentWindow = require(@electron/remote)window.addEventListener(DOMContentLoaded,()= let mainWindow = getCurrentWindow() // è·å–å½“å‰Window const closeBtn = document.getElementById(close-btn) const maxBtn = document.getElementById(maximize-btn) const miniBtn = document.getElementById(minimize-btn) closeBtn.addEventListener(click,()= mainWindow.close() ) maxBtn.addEventListener(click,()= if(!mainWindow.isMaximized()) mainWindow.maximize() // æœ€å¤§åŒ– else mainWindow.restore() // å›åˆ°åŸå§‹çŠ¶æ€ ) miniBtn.addEventListener(click,()= if(!mainWindow.isMinimized()) mainWindow.minimize() // æœ€å°åŒ– ) window.onbeforeunload = ()= let mainWindow = getCurrentWindow() const dialogDom = document.getElementsByClassName(close-dialog)[0] dialogDom.style.display = flex const yesBtn = document.getElementsByClassName(close-yes)[0] const noBtn = document.getElementsByClassName(close-no)[0] yesBtn.addEventListener(click,()= mainWindow.destroy() // éœ€è¦é”€æ¯ï¼Œä½¿ç”¨closeè¿˜ä¼šè§¦å‘unbeforeLoadäº‹ä»¶ ) noBtn.addEventListener(click,()= dialogDom.style.display = none ) return false ) çˆ¶å­å’Œæ¨¡æ€çª—ä½“çˆ¶å­å’Œæ¨¡æ€çª—å£ æœ‰äº›åº”ç”¨ç¨‹åºç‚¹å‡»æŒ‰é’®ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—ï¼Œå¹¶ä¸”ä¸èƒ½è·¨è¶Šå¼¹çª—ç‚¹å‡»åˆ°åé¢çš„çª—å£ï¼Œè¿™å°±æ˜¯çˆ¶å­å’Œæ¨¡æ€çª—å£ï¼Œéœ€è¦åœ¨å­çª—å£ä¸Šé…ç½®parentå’Œmodalå±æ€§ï¼šlet win = new BrowserWindow( parent:getCurrentWindow(), width:300, height:300, show:false, modal:true)æ¸²æŸ“è¿›ç¨‹ä¸­åˆ›å»ºå­çª—ä½“ï¼Œéœ€è¦é€šè¿‡getCurrentWindow()è®¾ç½®parentçˆ¶çª—ä½“ï¼Œä½†æ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­åˆ›å»ºå­çª—ä½“æ—¶ï¼Œéœ€è¦ç»™ä¸»è¿›ç¨‹æä¾›ä¸€ä¸ªçˆ¶çª—ä½“æ ‡è¯†ï¼Œç„¶åç”±BrowserWindow.fromIdè·å–åˆ°ç›®æ ‡çª—ä½“ï¼šä¿å­˜çˆ¶çª—ä½“çš„idï¼šlet mainWindowId = null //ä¸»çª—å£idapp.whenReady().then(()= let mainWindow = new BrowserWindow(...) mainWindowId = mainWindow.id // è®°å½•id)å­çª—å£åˆ›å»ºæ—¶ï¼ŒparentæŒ‡å‘idä»£è¡¨çš„çª—ä½“ï¼šlet subWin1 = new BrowserWindow( width:400, height:300, parent:BrowserWindow.fromId(mainWindowId), webPreferences: nodeIntegration:true, contextIsolation:false, )çˆ¶å­çª—ä½“è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šçˆ¶çª—ä½“åœ¨å…³é—­åï¼Œå­çª—ä½“åŒæ—¶ä¹Ÿä¼šè¢«å…³é—­ èœå•è‡ªå®šä¹‰èœå• Menuä»‹ç»è‡ªå®šä¹‰èœå•éœ€è¦ä¸€ä¸ªæ•°ç»„å˜é‡ä½œä¸ºèœå•é…ç½®ï¼šlet menuTemp = [ label:æ–‡ä»¶, submenu:[ // å­èœå• label:æ‰“å¼€, click() // èœå•ç‚¹å‡»äº‹ä»¶ console.log(ä½ æŒ‰ä¸‹æ‰“å¼€æŒ‰é’®) , type:separator, // åˆ†éš”ç¬¦ label:å…³äº, role:about // electronå†…ç½®çš„é»˜è®¤è¡Œä¸º , ] , label:è§’è‰², submenu:[ label:å¤åˆ¶,role:copy, label:å‰ªåˆ‡,role:cut, label:é»è´´,role:paste, label:æœ€å°åŒ–,role:minimize, ] , label:ç±»å‹, submenu:[ // å¤šé€‰ label:é€‰é¡¹1, type:checkbox, label:é€‰é¡¹2, type:checkbox, label:é€‰é¡¹3, type:checkbox, type:separator, // å•é€‰ label:item1, type:radio, label:item2, type:radio, label:item3, type:radio, type:separator, label:windows, type:submenu, role:windowMenu ] , label:å…¶ä»–, submenu: [ label:crazy, icon:./assets/crazy.png, // è‡ªå®šä¹‰å›¾æ ‡ accelerator: ctrl + p, // è‡ªå®šä¹‰å¿«æ·é”® click() console.log(going crazy) ] ]ç”¨é…ç½®ç”Ÿæˆèœå•é¡¹ï¼Œç„¶åå°†ç”Ÿæˆçš„èœå•é¡¹è®¾ç½®åˆ°åº”ç”¨çš„èœå•ä¸­ï¼šlet menu = Menu.buildFromTemplate(menuTemp)Menu.setApplicationMenu(menu) åŠ¨æ€åˆ›å»ºèœå• åŠ¨æ€åˆ›å»ºèœå•éœ€è¦ä½¿ç”¨åˆ°MenuItemæ–¹æ³•ï¼Œç°æœ‰ä¸€ä¸ªèœå•é¡¹çš„å­èœå•æŒ‡å‘ä¸€ä¸ªMenuç±»å‹çš„æ•°æ®let menuItem = new Menu()let customMenu = new MenuItem( label:è‡ªå®šä¹‰, submenu:menuItem // å­èœå•ä¸ºä¸€ä¸ªMenu)è¦ä¸ºå­èœå•åŠ¨æ€æ·»åŠ èœå•é¡¹ï¼Œéœ€è¦ç”¨åˆ°Menu.appendæ–¹æ³•ä¸ºèœå•æ·»åŠ å­é¡¹ï¼šmenuItem.append( new MenuItem( // æ–°èœå•é¡¹ label:new menu item, type:normal )) å³é”®èœå• å³é”®èœå•çš„åˆ›å»ºå’Œå¯¼èˆªæ èœå•åˆ›å»ºä¸€æ ·ï¼Œéƒ½æ˜¯ç”±Menu.buildFromTemplateå®Œæˆï¼Œä¸åŒåœ¨äºä¸ä¼šä½¿ç”¨Menu.setApplicationMenu,è€Œæ˜¯Menu.popupï¼šconst Menu,getCurrentWindow = require(@electron/remote)let contextTemp = [ label:æµ‹è¯•, type:separator, label:å…¶ä»–,click:()=console.log(click click),]let menu = Menu.buildFromTemplate(contextTemp)window.addEventListener(DOMContentLoaded,()= window.addEventListener(contextmenu,ev= ev.preventDefault() menu.popup( window:getCurrentWindow() ) ,false)) å¼¹çª—dialog Dialog Docå¼¹çª—æ–¹æ³•apiï¼šelectron.dialogå¼‚æ­¥è·å–æ–‡ä»¶å¼¹çª—é…ç½®ï¼šbtn.addEventListener(click,()= // è¿”å›Promise dialog.showOpenDialog( defaultPath: __dirname, // é»˜è®¤è·¯å¾„ï¼šå½“å‰ç›®å½• buttonLabel: é€‰å¥½äº†, title:è‡ªå®šä¹‰æ ‡é¢˜, // openFile æ‰“å¼€æ–‡ä»¶ // openDirectory æ‰“å¼€ç›®å½• // multiSelections å¤šé€‰ properties:[openFile, multiSelections], filters:[ // é…ç½®è·å–æ–‡ä»¶çš„ç±»å‹ name:code, extensions:[js,json,html], name:img, extensions:[ico,jpeg,png], name:media, extensions:[avi,mp4,mp3], ] ).then((ret)= console.log(ret.canceled) console.log(ret.filePaths) ))é”™è¯¯å¼¹çª—ï¼šerrBtn.addEventListener(click,()= dialog.showErrorBox( Errorrrrrrrr, é”™è¯¯å†…å®¹ )) shellshell Shellå¯ä»¥ç”¨æ¥ï¼šæ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨å°†é€šè¿‡æµè§ˆå™¨æ‰“å¼€urlshell docä½¿ç”¨shellåœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€æ–‡ä»¶ç›®å½•ï¼šconst shell = require(electron)const path = require(path)shell.showItemInFolder(path.resolve(__filename))shellåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ï¼šshell.openExternal(urlPath) // å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€é“¾æ¥ æ¶ˆæ¯æç¤ºNotification Notifications Docåœ¨electronåº”ç”¨ä¸­è§¦å‘window.Notificationï¼Œèƒ½å¤Ÿè§¦å‘æ“ä½œç³»ç»Ÿçš„æ¶ˆæ¯æç¤ºï¼ŒåŒæ—¶ï¼Œè¿˜èƒ½ç›‘å¬åˆ°æ¶ˆæ¯æç¤ºçš„ç‚¹å‡»äº‹ä»¶let option = title:title123, body:something, icon:./app.ico// åˆ›å»ºæ¶ˆæ¯let my_noti = new window.Notification(option.title, option)// ç›‘å¬æ¶ˆæ¯çš„ç‚¹å‡»my_noti.onclick = ()= console.log(æ¶ˆæ¯è¢«ç‚¹å‡») è¿›ç¨‹é€šä¿¡ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æœ‰å‡ ç±»ï¼šæ¸²æŸ“è¿›ç¨‹å‘èµ· - ipcRendererå¼‚æ­¥åŒæ­¥ä¸»è¿›ç¨‹å‘èµ·çš„é€šä¿¡ - ipcMainå¼‚æ­¥åŒæ­¥ï¼ˆä¸æ”¯æŒï¼‰å¼‚æ­¥é€šä¿¡ sendå¼‚æ­¥é€šä¿¡æ˜¯æ²¡æœ‰è¿”å›å€¼çš„é€šä¿¡æ¸²æŸ“è¿›ç¨‹ â†’ ä¸»è¿›ç¨‹æ¸²æŸ“è¿›ç¨‹å‘é€ï¼šasyncBtn.addEventListener(click,()= ipcRenderer.send(msg1,Render å‘é€å¼‚æ­¥è¯·æ±‚åˆ° Main))ä¸»è¿›ç¨‹å›å¤ï¼šipcMain.on(msg1, (ev, data)= // main å‘ render å‘é€å¼‚æ­¥æ¶ˆæ¯ ev.sender.send(msg1Re, Main å¼‚æ­¥å›å¤åˆ° Render))æ¸²æŸ“è¿›ç¨‹æ¶ˆæ¯çš„å‘é€&&ä¸»è¿›ç¨‹æ¶ˆæ¯çš„å›å¤æ§åˆ¶å°æ‰“å°ä¸­æ–‡ä¹±ç bugä½¿ç”¨chcp 65001å‘½ä»¤æ”¹å˜å½“å‰æ´»åŠ¨ä»£ç é¡µæ ¼å¼ä¸ºutf-8ä¸»è¿›ç¨‹ â†’ æ¸²æŸ“è¿›ç¨‹ä¸»è¿›ç¨‹éœ€è¦é€šè¿‡æ ¹æ®å½“å‰focusçš„çª—å£çš„WebContentï¼Œæ¥å®ç°å‘æŒ‡å®šæ¸²æŸ“è¿›ç¨‹çš„é€šä¿¡ï¼šlet menuTemp = [ label:send, click() // å®ç°ä¸€ä¸ªå‘æ¸²æŸ“è¿›ç¨‹é€šä¿¡çš„èœå•æŒ‰é’® BrowserWindow.getFocusedWindow().webContents.send(mtp,æ¥è‡ªäºè‡ªè¿›ç¨‹çš„æ¶ˆæ¯) ]å­è¿›ç¨‹å¼€å¯äº‹ä»¶çš„onç›‘å¬ï¼š // è‡ªè¿›ç¨‹å‘é€çš„æ¶ˆæ¯ipcRenderer.on(mtp,(ev,data)= console.log(data))ç‚¹å‡»sendèœå•æŒ‰é’®ï¼Œä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œå­è¿›ç¨‹æ‰“å°æ¶ˆæ¯åŒæ­¥é€šä¿¡ sendSyncåŒæ­¥é€šä¿¡åªæ”¯æŒæ¸²æŸ“è¿›ç¨‹å‘ä¸»è¿›ç¨‹å‘é€ï¼Œæ¸²æŸ“è¿›ç¨‹å¯ä»¥ç”¨ä¸€ä¸ªå€¼æ¥æ”¶sendSyncçš„è¿”å›å€¼ï¼š // å‘é€åŒæ­¥è¯·æ±‚syncBtn.addEventListener(click,()= let res = ipcRenderer.sendSync(msg2,Render å‘é€åŒæ­¥è¯·æ±‚åˆ° Main) console.log(res))ä¸»è¿›ç¨‹é€šè¿‡è®¾ç½®returnValueä½œä¸ºè¿”å›å€¼ï¼šipcMain.on(msg2,(ev,data)= console.log(data) // åŒæ­¥å›å¤ ev.returnValue = Main åŒæ­¥å›å¤åˆ° Render)æ¸²æŸ“è¿›ç¨‹è¯·æ±‚ï¼Œä¸»è¿›ç¨‹è¿”å›å€¼ æ¸²æŸ“è¿›ç¨‹ä¹‹é—´ä¼ å€¼æ–¹æ³•1ï¼šlocalStorageä¼ å€¼ ä½¿ç”¨localStorageèƒ½å¤Ÿè·¨çª—å£ä¼ å€¼ï¼Œä¹‹å‰åœ¨ä¸€ä¸ªvueé¡¹ç›®ä¸­å°±é‡åˆ°äº†è·¨çª—å£ä¼ å€¼çš„éœ€æ±‚ï¼Œç»“æœå‘ç°vuexæ— æ³•è·¨çª—å£ä¼ å€¼ï¼Œæ‰€ä»¥ç”¨çš„localStoragelocalStorageçš„è·¨é¡µé¢åŒæ­¥localStorageé€‚åˆå…·æœ‰çˆ¶å­å…³ç³»çš„çª—å£ä¹‹é—´ä¼ å€¼ æ–¹æ³•2ï¼šé€šè¿‡ä¸»è¿›ç¨‹é€šä¿¡ Aè¿›ç¨‹å’ŒMainå»ºç«‹é€šé“Bè¿›ç¨‹å’ŒMainå»ºç«‹é€šé“ABè¿›ç¨‹å°±èƒ½é€šè¿‡Mainè¿›è¡Œé€šä¿¡ï¼šAè¿›ç¨‹å’ŒMainå»ºç«‹çš„é€šé“ï¼šipcRenderer.send(stm, text) // A â†’ MainMainå°†Aè¿›ç¨‹æ•°æ®è½¬å‘åˆ°Bè¿›ç¨‹ipcMain.on(stm,(ev,data)= // Main â† A let targetWindow = BrowserWindow.fromId(id) // è·å–åˆ°Bçª—å£ targetWindow.webContents.send(msgAtoB,data) // Main â†’ B )Bè¿›ç¨‹æ¥æ”¶æ•°æ®ipcRenderer.on(msgAtoB,(ev,data)= // B â† Main // do something )é€šè¿‡ä¸»è¿›ç¨‹å®ç°å­çª—å£åˆ›å»ºæ—¶ä¼ å€¼é€šè¿‡ä¸»è¿›ç¨‹é€šä¿¡æ–¹å¼åˆ›å»ºçª—å£çš„åŒæ—¶ä¼ å€¼ï¼Œçˆ¶çª—å£æ¸²æŸ“éœ€è¦åœ¨å‘ŠçŸ¥ä¸»è¿›ç¨‹å¼€å¯æ–°çª—å£çš„åŒæ—¶ä¼ é€’å€¼ï¼Œç„¶ååœ¨ä¸»çª—å£å°†å­çª—å£è¿›ç¨‹åˆ›å»ºå¥½åï¼Œå°†å€¼é€šè¿‡è‡ªé€šä¿¡çš„æ–¹å¼ä¼ é€’è¿‡å»ï¼šçˆ¶çª—å£é€šçŸ¥ä¸»è¿›ç¨‹åˆ›å»ºå­çª—å£è¿›ç¨‹ï¼ˆç›‘å¬did-finish-loadäº‹ä»¶ï¼‰ï¼šipcRenderer.send(openWin,123)ä¸»è¿›ç¨‹åˆ›å»ºæ–°çª—å£å¹¶ä¼ å€¼ï¼šipcMain.on(openWin,(ev,data)= let subWin1 = new BrowserWindow( width:400, height:300, parent:BrowserWindow.fromId(mainWindowId), webPreferences: nodeIntegration:true, contextIsolation:false, ) require(@electron/remote/main).enable(subWin1.webContents) subWin1.loadFile(subIndex.html) subWin1.on(close,()= subWin1 = null ) // åœ¨åˆ›å»ºçª—å£æ—¶ä¼ å€¼ subWin1.webContents.on(did-finish-load,()= subWin1.webContents.send(its,data) ))å­çª—å£ç›‘å¬ï¼šipcRenderer.on(its,(ev,data)= alert(`çˆ¶çª—å£ä¼ æ¥çš„å€¼ï¼š$data`)) å¿«æ·é”®globalShortcut globalShortcut docglobalShortcutå¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­æ³¨å†Œé”€æ¯å…¨å±€å¿«æ·é”®ã€‚è¿™ç§ç»‘å®šæ˜¯å…¨å±€ï¼Œå³ä¾¿æ˜¯åº”ç”¨å¤±å»ç„¦ç‚¹ï¼Œä¹Ÿèƒ½æŒç»­ç›‘å¬ã€‚åœ¨readyä¸­æ³¨å†Œå¿«æ·é”®app.on(ready,()= let res = globalShortcut.register(ctrl + q,()= console.log(something be active) ) if(!res)console.log(register fail) // åˆ¤æ–­å¿«æ·é”®æ˜¯å¦å·²ç»è¢«æ³¨å†Œ console.log(`[ctrl + q] è¢«æ³¨å†Œæƒ…å†µï¼š$globalShortcut.isRegistered(ctrl + q)`) console.log(`[tab] è¢«æ³¨å†Œæƒ…å†µï¼š$globalShortcut.isRegistered(tab)`))å¿«æ·é”®çš„é”€æ¯ï¼šapp.on(will-quit,()= console.log(å¿«æ·é”®è§£ç»‘) globalShortcut.unregister(ctrl + q) globalShortcut.unregisterAll()) å‰ªåˆ‡æ¿clipboard clipboard docnativeImage docå‰ªåˆ‡æ¿æ–‡æœ¬çš„è¯»å†™ï¼šlet res = null // å¤åˆ¶å†…å®¹copyBtn.onclick = ()= res = clipboard.writeText(copyInput.value) // å†™å…¥pasteBtn.onclick = ()= pasteInput.value = clipboard.readText(res) // è¯»å–å‰ªåˆ‡æ¿å›¾ç‰‡çš„å¤åˆ¶ï¼šconst clipboard, nativeImage = require(electron)// è¯»å…¥å›¾ç‰‡let imgData = nativeImage.createFromPath(assets/app.ico)clipboard.writeImage(imgData) // å‰ªåˆ‡æ¿å†™å…¥å›¾ç‰‡let imgFromCb = clipboard.readImage() // å‰ªåˆ‡æ¿è¯»å‡ºå›¾ç‰‡let imgDom = new Image()imgDom.src = imgFromCb.toDataURL() // nativeImageè¿›è¡Œå›¾ç‰‡æ ¼å¼è½¬æ¢document.body.appendChild(imgDom)notenativeImageæ˜¯electronä¸ºå¤šç§ç¼©æ”¾å¤§å°å‡†å¤‡çš„å›¾æ ‡æ“ä½œç±»ï¼Œè¯»å–çš„å›¾æ ‡å…·æœ‰ä¸€å®šæ ¼å¼è¦æ±‚ï¼ˆpngã€jpgã€icoï¼‰ï¼Œè¿˜æœ‰ä¸€å®šå°ºå¯¸è¦æ±‚ï¼ˆè§å®˜ç½‘ä»‹ç»ï¼‰å¦‚æœå°ºå¯¸å’Œæ ¼å¼ä¸æ»¡è¶³è¦æ±‚ï¼Œè¯»å…¥è¿›æ¥çš„å›¾ç‰‡å°±é»˜è®¤ä¸ºç©º","tags":["Web"]},{"title":"electron-egg + vue3 + vite å®ç°æ¡Œé¢åº”ç”¨","path":"/2024/03/28/ElectronEgg/","content":"Electron-eggElectron-egg å®˜ç½‘åœ°å€Electronä¸­æ–‡æ–‡æ¡£Electron-eggæ˜¯å¯¹electronçš„äºŒæ¬¡åŒ…è£…ï¼Œå…¶ä¸­ä½¿ç”¨åˆ°çš„å¤§éƒ¨åˆ†APIéƒ½å’Œelectronéå¸¸ç±»ä¼¼ï¼Œä½¿ç”¨èµ·æ¥æœ€å¤§çš„äº®ç‚¹å°±æ˜¯ è·¨å¹³å°æ€§å¥½å› ä¸ºæˆ‘ä¹Ÿæ²¡ç”¨electronæ‰“è¿‡åŒ…å°±ä¸è¿‡å¤šèƒ¡è¯Œäº† å®ç°è¿‡ç¨‹STEP 1: æ‹‰å–electron-eggæ¡†æ¶ æŒ‰ç…§å®˜ç½‘çš„ä»‹ç»ï¼Œæ‹‰å–electron-eggæ¡†æ¶ï¼šgit clone https://github.com/dromara/electron-egg.gitæ‹‰å–ä¸‹æ¥çš„æ–‡ä»¶ç›®å½•ç›®å½•ä»‹ç»è¿™é‡Œåªä»‹ç»æˆ‘æœ¬æ¬¡é¡¹ç›®ç”¨åˆ°çš„æ–‡ä»¶ï¼šbuild æ‰“åŒ…ç”¨åˆ°çš„èµ„æºå’Œè„šæœ¬icons åé¢æ‰“åŒ…æˆåº”ç”¨ç¨‹åºä¼šç”¨çš„å›¾æ ‡data å†…ç½®æ•°æ®åº“æ–‡ä»¶ï¼ˆæ²¡ç”¨åˆ°ï¼‰electron ä¸»è¿›ç¨‹æœåŠ¡addon æ’ä»¶ç›®å½•config é…ç½®æ–‡ä»¶bin.js å¼€å‘ç¯å¢ƒé…ç½®config.default.js é»˜è®¤é…ç½® config.local.js devç¯å¢ƒåŠ è½½config.prod.js ç”Ÿäº§ç¯å¢ƒåŠ è½½encrypt.js åŠ å¯†é…ç½®æ–‡ä»¶builder.json æ‰“åŒ…é…ç½®controller æ§åˆ¶å™¨service ä¸šåŠ¡å±‚preload é¢„åŠ è½½jobs ä»»åŠ¡index.js ä¸»è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸfrontend å‰ç«¯ç›®å½•logs æ—¥å¿—out æ‰“åŒ…å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•public èµ„æºç›®å½•dist å‰ç«¯æ‰“åŒ…æ”¾åœ¨è¿™html æ¨¡ç‰ˆelectron jsåŠ å¯†æ–‡ä»¶images ä¸€äº›å›¾ç‰‡main.js å…¥å£æ–‡ä»¶ STEP 2: frontendåŒ…å£³ ä½¿ç”¨electron-eggæ¡†æ¶ï¼Œå‰ç«¯å¼€å‘å®é™…çš„æ–‡ä»¶éƒ½æ˜¯æ”¾åœ¨frontendç›®å½•ä¸‹çš„ï¼Œå› æ­¤é™¤äº†ä¸€äº›ä¸å¿…è¦çš„æ–‡ä»¶ï¼Œæˆ‘å°±ç›´æ¥æŠŠåŸå…ˆçš„vue+viteç›®å½•ä¸‹çš„æ–‡ä»¶æŒªåˆ°frontendä¸‹äº†ï¼Œfrontendç›®å½•ä¸‹çš„æ–‡ä»¶è½¬åˆ°æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…electron-eggæ¡†æ¶ä¾èµ–åŒ…ï¼š npm run installè½¬åˆ°frontendç›®å½•ä¸‹ï¼Œå®‰è£…å‰ç«¯é¡¹ç›®ä½¿ç”¨åˆ°çš„ä¾èµ–åŒ…ï¼š cd frontend npm run installè¿è¡Œå‰ç«¯é¡µé¢ï¼š npm run dev-frontendè¿è¡Œåº”ç”¨ç¨‹åºï¼š npm run dev STEP 3: æ‰“åŒ… æ‰“åŒ…å‰ç«¯ç¨‹åºï¼š npm run dev-frontendæ‰“åŒ…æˆå¯æ‰§è¡Œç¨‹åºä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠæ‰“åŒ…å¥½çš„å‰ç«¯ç¨‹åºç§»åŠ¨åˆ°æ ¹ç›®å½•ä¸‹publicæ–‡ä»¶å¤¹ä¸­ï¼Œç”¨æ‰“åŒ…çš„distæ›¿æ¢åŸæœ¬çš„publicdistã€‚è¿™é‡Œæ¡†æ¶ä¹Ÿæä¾›äº†å‘½ä»¤ï¼š npm run rdæ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶exeï¼š npm run build-w-64 è¸©å‘è®°å½•è¿è¡Œç™½å±è¿è¡Œç™½å± é—®é¢˜æè¿°ç”¨npm run devå¯åŠ¨é¡¹ç›®ï¼Œelectronå¼¹å‡ºï¼Œä¸€ç›´åœåœ¨loadingçš„ç•Œé¢ã€‚è§£å†³æ–¹å¼å®˜æ–¹æ•´ç†çš„é—®é¢˜ä¸­ä¹Ÿæåˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œé¡µé¢ä¸€ç›´loadingæˆ–ç™½å±ï¼Œå°±è¯´æ˜æ²¡æœ‰è¯·æ±‚åˆ°å¯¹åº”çš„å‰ç«¯èµ„æºï¼Œå®˜æ–¹æåˆ°å¯èƒ½æ˜¯å‰ç«¯è·¯ç”±æ¨¡å¼é”™è¯¯ï¼Œä¸èƒ½æ˜¯historyï¼Œå¿…é¡»æ”¹æˆhashhashå’Œhistoryçš„åŒºåˆ«è§£å†³æ–¹æ³•1ï¼šæ£€æŸ¥ç«¯å£å·é…ç½®ç¡®ä¿ä¸‹é¢ä¸¤ä¸ªç«¯å£ä½ç½®ä¸€è‡´ï¼švite.config.js server.portserver: port:8090, // æŒ‡å®šç«¯å£ host:trueelectronconfigbin.js dev.frontend.portdev: frontend: directory: ./frontend, cmd: npm, args: [run, dev], protocol: http://, hostname: localhost, port: 8090, // æŒ‡å®šç«¯å£ indexPath: index.html ,,å¹¶ä¸”ç¡®ä¿æ­¤ç«¯å£æ²¡æœ‰è¢«å…¶å®ƒæœåŠ¡å ç”¨è§£å†³æ–¹æ³•2ï¼šæ£€æŸ¥vite.config.jsä¸­çš„baseè·¯ç”±è®¾ç½®vite.config.jsä¸­ï¼ŒbaseåŸºç¡€è·¯ç”±å¿…é¡»æ˜¯â€™.â€˜base:./ å›¾æ ‡æ— æ³•æ›´æ¢å›¾æ ‡æ— æ³•æ›´æ¢ é—®é¢˜æè¿°electronconfigbuilder.jsonä¸­èƒ½å¤Ÿé…ç½®exeæ‰“åŒ…å›¾æ ‡çš„æ ·å¼ï¼Œbuildiconsä¸­å­˜æ”¾ç€å›¾æ ‡èµ„æºï¼Œä½†æ˜¯æ›´æ¢å›¾æ ‡åä¾æ—§æ— æ•ˆé—®é¢˜è§£å†³å› ä¸ºwindowsç¼“å­˜åº”ç”¨å›¾æ ‡ï¼Œæ¸…ç†å›¾æ ‡ç¼“å­˜çš„æ–¹æ³•cmdæ§åˆ¶å°è¾“å…¥ï¼štaskkill /im explorer.exe /fcd /d %userprofile%\\appdata\\localdel iconcache.mongodb /astart explorer.exeexitå›¾æ ‡ç¼“å­˜çš„ä½ç½®åœ¨ï¼šC:\\Users\\Administrator\\AppData\\Local\\Microsoft\\Windows\\Explorerexplorer.exeï¼š èµ„æºç®¡ç†å™¨iconcache.db å›¾æ ‡ç¼“å­˜æ–‡ä»¶ æ‰“åŒ…ç”¨åˆ°çš„iconç”Ÿæˆæ‰“åŒ…ç”¨åˆ°çš„iconç”Ÿæˆ é—®é¢˜æè¿°å› ä¸ºä¸Šé¢æåˆ°çš„windowså›¾æ ‡ç¼“å­˜çš„åŸå› ï¼Œæ”¹äº†å¾ˆå¤šæ¬¡iconéƒ½æ²¡ç”¨ï¼Œä»¥ä¸ºæ˜¯iconçš„é—®é¢˜ï¼Œäºæ˜¯è¯•äº†å¾ˆå¤šç”Ÿæˆiconçš„æ–¹æ³•ï¼Œéƒ½å¾ˆè‰°éš¾è§£å†³æ–¹æ³•egg-electronå®˜ç½‘ä¹Ÿæä¾›äº†2ä¸ªå›¾æ ‡ç”Ÿæˆå·¥å…·ï¼Œå…¶ä¸­æœ‰ä¸ªå«åšicon-gençš„npmåŒ…ï¼Œèƒ½ç”¨å‘½ä»¤ä¸€é”®ç”Ÿæˆå°ºå¯¸ä¸åŒçš„iconï¼ˆå¤§å–œï¼‰ï¼Œè€Œä¸”ä½œè€…ç”šè‡³è¿˜è´´å¿ƒçš„æŠŠicon-gençš„å‘½ä»¤é›†æˆè¿›å»äº†ï¼ˆè™½ç„¶æˆ‘è°ƒç”¨å‘ç°æ²¡ç”¨ï¼‰æ‹‰å–icon-genåº“ï¼šicon-genå‘½ä»¤ï¼šicon-gen -i sample.png -o ./dist --ico --ico-sizes 16 # 16x16icon-gen -i sample.svg -o ./dist --ico # è½¬icoæ ¹æ®å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼Œæ‰“åŒ…å›¾æ ‡éœ€è¦ä¸‹é¢è¿™äº›ï¼Œè€Œä¸”åç§°ä¸èƒ½ä¿®æ”¹ï¼š çª—å£zoomä¸ç”Ÿæ•ˆçª—å£zoomä¸ç”Ÿæ•ˆ é—®é¢˜æè¿°ä¸€ä¸ªè ¢é—®é¢˜å¯¼è‡´äº†å¦ä¸€ä¸ªè ¢é—®é¢˜â€¦â€¦ç”¨æˆ·å±å¹•åˆ†è¾¨ç‡æ˜¯3840x2160çš„ï¼Œå¼€å‘ç”¨å±å¹•æ˜¯1920x1080çš„ï¼Œå› ä¸ºæ­£å¥½æ˜¯æˆ‘çš„ä¸¤å€ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠæµè§ˆå™¨çš„æ”¾å¤§å€æ•°ç¼©å°åˆ°50%ï¼Œç„¶åæŠŠå›¾åˆ‡å®Œäº†â€¦â€¦ è¿™å°±ç­‰äºæ²¡åšå±å¹•é€‚é…ï¼Œåœ¨æµè§ˆå™¨å¯ä»¥é€šè¿‡ctrl+æ»šè½®æ”¾å¤§ç¼©å°å€æ•°ï¼Œä½†æ˜¯æ¡Œé¢åº”ç”¨ä¸è¡Œï¼Œä½†æ˜¯åœ¨windowsOptionä¸­æœ‰ä¸ªzoomFactoré…ç½®ï¼Œå¯ä»¥é…ç½®æ”¾å¤§å€æ•°ï¼Œæˆ‘æƒ³è®©è¿™ä¸ªzoomFactorèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„å±å¹•è¿›è¡Œé€‚é…ï¼Œä½†åˆ«è¯´é€‚é…äº†ï¼Œè¿™ä¸ªå€¼ç”Ÿæ•ˆéƒ½éš¾ï¼Œå°±ç¬¬ä¸€æ¬¡é…ç½®ç”Ÿæ•ˆäº†ï¼Œä¹‹åæ¥è¿ä¿®æ”¹å¥½å‡ æ¬¡éƒ½æ²¡ååº”ã€‚æ°”éº»äº†ã€‚é—®é¢˜è§£å†³ç¼“å­˜ï¼Œç¼“å­˜ï¼Œæ˜¯å› ä¸ºæœ‰ç¼“å­˜ï¼ï¼ˆéº»äº†ï¼‰Previous zoomFactor is getting cached, unless you manually reset browserWindowâ€™s zoomç¼“å­˜åœ°å€ï¼šC:\\Users\\Administrator\\AppData\\Roamingåˆ æ‰å°±è¡Œäº†ã€‚è‡³äºæ ¹æ®å±å¹•åˆ†è¾¨ç‡è®¾ç½®zoomFactorè¿™äº‹ï¼Œæˆ‘ä¸€æ‰‹å‡†å¤‡å¥½electronæä¾›çš„screen.getPrimaryDisplay().sizeï¼Œè·å–ä¸»å±å¹•å°ºå¯¸ï¼Œä¸€æ‰‹å‡†å¤‡å¥½win.setZoomFactorè®¾ç½®ç¼©æ”¾ç‡ã€‚ç»„åˆåœ¨ä¸€èµ·ï¼Œæ— äº‹å‘ç”Ÿã€‚è‡³äºä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœï¼Œåˆ°ç°åœ¨æˆ‘éƒ½æ²¡å¼„æ˜ç™½ã€‚æ‰€ä»¥æœ€åæˆ‘è¿˜æ˜¯ä¹–ä¹–çš„æŠŠpxå…¨éƒ½è½¬æ¢æˆäº†remåšé¡µé¢é€‚é…â€¦â€¦ electronå®‰è£…å¤±è´¥electronå®‰è£…å¤±è´¥ é—®é¢˜æè¿°npm install electron -gæŠ¥é”™ï¼šRequestError: unable to verify the first certificateè§£å†³æ–¹å¼å‚è€ƒåšå®¢cnpmå®‰è£…ï¼šnpm install cnpm -gcnpm install electron -g windowsæ‰“åŒ…å¡é¡¿windowsæ‰“åŒ…å¡é¡¿ é—®é¢˜æè¿°ä½¿ç”¨electron-eggæä¾›çš„winæ‰“åŒ…å‘½ä»¤ï¼ˆé¦–æ¬¡ï¼‰ï¼Œä¸€ç›´å¡åœ¨åŒ…çš„ä¸‹è½½ä¸Šï¼šdownloading url=https://github.com/electron/electron/releases/download/v11.2.1/electron-v11.2.1-win32-ia32.zip size=74 MB parts=8è¿˜ä¸åªå¡åœ¨è¿™ä¸ªåŒ…ä¸Šï¼Œåé¢è¿˜æœ‰å¥½å‡ ä¸ªåŒ…ã€‚è§£å†³æ–¹æ³•å‚è€ƒåšå®¢é•œåƒèµ„æºç›´æ¥ç½‘ä¸Šæ‰‹åŠ¨ä¸‹è½½å¡ä½çš„åŒ…ï¼Œæ”¾åœ¨C:\\Users\\Administrator\\AppData\\Local\\electron\\Cacheç›®å½•ä¸‹ electronå’Œchromeç‰ˆæœ¬å¯¹åº”electronå’Œchromeç‰ˆæœ¬å¯¹åº” é—®é¢˜æè¿°æ‰“å¼€electroné¡¹ç›®ï¼Œå‘ç°åƒbackground-clipã€text-wrapç­‰cssæ ·å¼å¤±æ•ˆï¼Œå¤§æ¦‚å’Œelectronå¯¹åº”çš„chromeç‰ˆæœ¬è¾ƒä½æœ‰å…³ã€‚è§£å†³æ–¹å¼æ ¹ç»electorn-eggæä¾›çš„è¿™ä»½ç‰ˆæœ¬å¯¹åº”è¡¨è¿›è¡Œæ›´æ–°ï¼šç‰ˆæœ¬å…³ç³» sslè¯ä¹¦é”™è¯¯sslè¯ä¹¦é”™è¯¯ é—®é¢˜æè¿°electronåº”ç”¨æ— æ³•è®¿é—®ä¸å®‰å…¨åœ°å€è§£å†³æ–¹å¼åœ¨index.jsä¸­çš„readyå›è°ƒå‡½æ•°ä¸­å¿½ç•¥è¯ä¹¦éªŒè¯ï¼šasync ready () // sslè¯ä¹¦é”™è¯¯app.commandLine.appendSwitch(ignore-certificate-errors) æ‰“åŒ…æˆexeåç½‘ç»œè¯·æ±‚é”™è¯¯æ‰“åŒ…æˆexeåç½‘ç»œè¯·æ±‚é”™è¯¯ é—®é¢˜æè¿°æ‰“å¼€electionæ‰“åŒ…æˆçš„exeç¨‹åºï¼Œå‘ç°ç½‘ç»œè¯·æ±‚è·¯å¾„å…¨éƒ½å˜æˆäº†file:å¼€å¤´çš„è¯·æ±‚è§£å†³æ–¹å¼1ã€å°†axioså‘é€è¯·æ±‚æ—¶æ›¿æ¢æˆå…¨è·¯å¾„æ‰“åŒ…åç®—æ¡Œé¢ç¨‹åºï¼Œæ²¡æœ‰httpæœåŠ¡å™¨æ”¯æŒï¼ŒåŠ è½½çš„æ˜¯é™æ€é¡µé¢2ã€ electronå¼€å¯å…è®¸è·¨åŸŸæ¨¡å¼ webSecurity:falseå…¨è·¯å¾„è¯·æ±‚ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ï¼Œå› æ­¤è¦è®¾ç½®å¿½ç•¥å®‰å…¨ç­–ç•¥å‚è€ƒåšå®¢const getData = params = axios( method:get, // å…¨è·¯å¾„ url:https:192.168.0.1:8090/123/abc, params)webPreferences: webSecurity: false // ç¦ç”¨åŒæºç­–ç•¥ electronæ‰“åŒ…ååº”ç”¨æ–‡ä»¶ä½“ç§¯å¤§electronæ‰“åŒ…ååº”ç”¨æ–‡ä»¶ä½“ç§¯å¤§ é—®é¢˜æè¿°æš‚ä¸”è¿˜ä¸çŸ¥é“è¿™ä¸ªå¦‚ä½•è§£å†³ï¼Œä½†åŒ…å£³å‰æ¯”åŒ…å£³åå¤šäº†250MBå·¦å³ï¼Œå…¶ä¸­è¿˜åŒ…å«Chromiumå†…æ ¸ã€‚è§£å†³æ–¹å¼","tags":["Web"]},{"title":"äº‘æœåŠ¡å™¨ä½¿ç”¨å’ŒæœåŠ¡éƒ¨ç½²ï¼ˆé˜¿é‡Œäº‘ECS+åŸŸåæ³¨å†Œ+SSLè¯ä¹¦ï¼‰","path":"/2024/03/25/AliECS/","content":"äº‘æœåŠ¡å™¨è´­ä¹°äº‘æœåŠ¡å™¨è´­ä¹° è¿™éƒ¨åˆ†å‚è€ƒåšå®¢ï¼š è®°å½•ç¬¬ä¸€æ¬¡Vueé¡¹ç›®éƒ¨ç½²åˆ°é˜¿é‡Œäº‘LinuxæœåŠ¡å™¨ä¸Šçº¿çš„è‰°éš¾å†ç¨‹å€Ÿæ­¤æ–‡ç« è®°å½•ä¸€ä¸‹è‡ªå·±çš„è¸©å‘é—®é¢˜ã€‚ åŸŸåç”³è¯·åŸŸåç”³è¯· å‚è€ƒåšå®¢ï¼š å¦‚ä½•ç”³è¯·åŸŸåã€è´­ä¹°è¯ä¹¦å¹¶åœ¨NginxæœåŠ¡å™¨ä¸Šå®ç°HTTPSï¼ŸåŸŸååœ¨é˜¿é‡Œä¸Šä¹°çš„ï¼Œxyzåç¼€åŸŸåï¼Œé¦–å¹´6å—é’±ï¼ˆæŒºä¾¿å®œï¼‰ä¹‹åéœ€è¦èµ°å®åè®¤è¯ï¼Œå¾ˆå¿«ï¼Œä½†æ¯”è¾ƒå‘çš„æ˜¯é˜¿é‡Œå®åè®¤è¯å®Œè¿˜å¾—å…¥åº“å·¥ä¿¡éƒ¨ç³»ç»Ÿï¼Œè¿™å¾—èŠ±2-3å¤©çš„æ—¶é—´ï¼Œå¦‚æœå·¥ä¿¡éƒ¨ç³»ç»Ÿæ²¡æœ‰å…¥åº“åŸŸåï¼ŒåŸŸåç½‘ç«™å°±æ— æ³•å¤‡æ¡ˆï¼Œæ²¡æœ‰å¤‡æ¡ˆçš„ç½‘ç«™åœ¨ç½‘ä¸ŠæŒ‚ä¸€æ®µæ—¶é—´å°±ä¼šè¢«é™åˆ¶ï¼šæœ‰äº†åŸŸåä¹‹åå°±å¯ä»¥å°†åŸŸåå’Œè§£æè®°å½•è”ç³»åœ¨ä¸€èµ·ï¼Œé€šè¿‡åŸŸåç›´æ¥è®¿é—®åˆ°æŒ‡å®šipåœ°å€ï¼š NginxNginxåŸºç¡€é…ç½®nginxé…ç½® é…ç½®Nginxå¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯ä»¥ä¸‹2ä¸ªæ­¥éª¤ï¼šé…ç½®nginx.confæ–‡æ¡£vim /etc/nginx/nginx.confé‡å¯nginxsystemctl restart nginxå…¶ä»–å‘½ä»¤ç”¨çš„æ¯”è¾ƒå¤šçš„ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™äº›ï¼šå¯åŠ¨nginxsystemctl start nginxç»“æŸnginxsystemctl end nginxæŸ¥çœ‹æ‰€æœ‰å¼€å¯çš„nginxæœåŠ¡è¿›ç¨‹ps -ef | grep nginxæ€æ­»æ‰€æœ‰nginxè¿›ç¨‹killall nginxæ£€æŸ¥nginx.confé…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯nginx -té…ç½®æ–‡ä»¶ nginx.confè¿™é‡Œæˆ‘åœ¨8080918092ä¸‰ä¸ªç«¯å£ä¸Šé…äº†æœåŠ¡ï¼š# Homeserver listen 80; listen [::]:80; server_name www.e-duck.xyz; location / root /var/myapp/home/dist/; index index.html; try_files $uri $uri/ /index.html; error_page 404 /404.html; location = /404.html error_page 500 502 503 504 /50x.html; location = /50x.html # ThreeJsserver listen 8091; server_name www.e-duck.xyz; location / root /var/myapp/three/dist/; index index.html; try_files $uri $uri/ /index.html; # Lotteryserver listen 8092; server_name www.e-duck.xyz; location / root /var/myapp/lottery/dist/; index index.html; try_files $uri $uri/ /index.html; å°±æ˜¯éå¸¸æ™®é€šçš„é…ç½®ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œä¸€å¼€å§‹æˆ‘è§‰å¾—åé¢çš„ç«¯å£å·ä¸å¥½çœ‹ï¼Œæƒ³ç”¨è·¯ç”±æ˜ å°„çš„æ–¹å¼æ˜ å°„åˆ°ä¸åŒçš„æœåŠ¡ä¸Šï¼Œä¼¼ä¹ç”¨proxy_passæˆ–è€…aliaséƒ½èƒ½å®ç°ï¼Œproxy_passé…ç½®server listen 80; server_name www.e-duck.xyz; location / root /var/myapp/home/dist/; index index.html; try_files $uri $uri/ /index.html; location /lottery/ proxy_pass: www.e-duck.xyz:8091; server listen 8091; server_name www.e-duck.xyz; location / root /var/myapp/three/dist/; index index.html; try_files $uri $uri/ /index.html; aliasé…ç½®server listen 80; server_name www.e-duck.xyz; location / root /var/myapp/home/dist/; index index.html; try_files $uri $uri/ /index.html; location /lottery/ root /var/myapp/three/dist/; index index.html; try_files $uri $uri/ /index.html; ä½†æ˜¯å®é™…è¿™æ ·é…ç½®çš„æ—¶å€™å´å‘ç°ï¼Œé™æ€æ–‡ä»¶æ— æ³•åŠ è½½å‡ºæ¥ï¼Œæ‰“å¼€ç½‘é¡µæ§åˆ¶å°æŠ¥é”™ï¼šFailed to load module script: Expected a JavaScript module script but the server responded with a MIME type of text/html. Strict MIME type checking is enforced for module scripts per HTML spec.è¿™ä¸ªé—®é¢˜æˆ‘æ‰¾äº†å¾ˆä¹…çš„è§£å†³æ–¹æ¡ˆï¼Œåæ­£ç°åœ¨è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œæ‰€ä»¥å¹²è„†å°±æ¢å¤äº†ç«¯å£çš„å†™æ³•ã€‚ Nginxæ­å»ºé™æ€èµ„æºæœåŠ¡å™¨å‚è€ƒåšå®¢æ·»åŠ è™šæ‹Ÿä¸»æœºæ—¶ï¼Œå°†rootæ˜ å°„åˆ°æœ¬æœºå­˜å‚¨èµ„æºçš„ç›®å½•ä¸‹ï¼Œå¼€å¯æµè§ˆç›®å½•æƒé™ï¼šserver listen 8008; server_name localhost; location / root /root/pic_lib; autoindex on; Nginxä»£ç†äºŒçº§åŸŸåç”³è¯·äºŒçº§åŸŸåç”³è¯·äºŒçº§åŸŸåï¼ˆé˜¿é‡Œï¼‰åœ¨ã€é˜¿é‡Œæ§åˆ¶å°äº‘è§£æDNSåŸŸåè§£æè§£æè®¾ç½®ã€‘ä¸­ï¼Œæ·»åŠ è®°å½•ï¼Œæ–°å¢äºŒçº§åŸŸååœ¨å¼¹å‡ºçš„ã€æ·»åŠ è®°å½•ã€‘è¡¨å•ä¸­ï¼Œå¡«å†™åŸºç¡€ä¿¡æ¯ï¼šè®°å½•ç±»å‹ï¼šé€‰æ‹©A- æŒ‡å‘IPV4ç±»å‹ä¸»æœºè®°å½•ï¼šå¡«å†™äºŒçº§åŸŸåçš„å‰ç¼€è®°å½•å€¼ï¼šå¡«å†™åŸŸåä»£ç†çš„IPV4åœ°å€TTLï¼šDNSåŸŸåè§£æçš„è®°è¿‡åœ¨LocalDNSçš„ç”Ÿå­˜æ—¶é—´ ç»™äºŒçº§åŸŸåç”³è¯·è¯ä¹¦ä¸€çº§åŸŸååœ¨ä½¿ç”¨urlè®¿é—®æ—¶ï¼Œå®é™…ä¸Šä¹Ÿé»˜è®¤åŠ ä¸Šäº†wwwå‰ç¼€ï¼Œç”³è¯·æ–¹å¼å‚è€ƒä¸‹é¢ã€SSLé…ç½®ã€‘éƒ¨åˆ†é¡¶çº§åŸŸåå’ŒäºŒçº§åŸŸåé¡¶çº§åŸŸåï¼ˆTLDï¼‰ï¼šxxx.comä¸å¸¦wwwç›´æ¥ä»¥å®šä¹‰åŸŸåç»“å°¾çš„ç½‘å€æ³¨å†Œå’Œç®¡ç†ç”±å›½é™…äº’è”ç½‘åç§°ä¸æ•°å­—åœ°å€åˆ†é…æœºæ„è´Ÿè´£äºŒçº§åŸŸåï¼šwww.xxx.comä¾é™„äºä¸€çº§åŸŸååœ¨ä¸€çº§åŸŸåå‰åŠ ä¸Šä¸€ä¸ªç‰¹å®šå‰ç¼€ç”±å„ä¸ªå›½å®¶å’Œåœ°åŒºçš„æ³¨å†ŒæœåŠ¡å•†å’Œæœºæ„è´Ÿè´£ é…ç½®Nginxä»£ç†å‚è€ƒé…ç½®ï¼šnginxå¼€å¯HTTP2Nginxé…ç½®ä¸»åŸŸåå’ŒäºŒçº§åŸŸåæ³¨æ„ç‚¹ï¼šåœ¨listençš„ç«¯å£ååŠ ä¸Šhttp2è¡¨ç¤ºå¼€å¯http2ä¼ è¾“åœ¨80ç«¯å£å¤„è¿›è¡Œæ‹¦æˆªé‡å®šå‘ä¸»åŸŸåå’ŒäºŒçº§åŸŸåçš„å…³é”®åœ¨äºserver_nameçš„è®¾ç½®ä¸»åŸŸåäºŒçº§åŸŸåe-duck.xyz############## ä¸»åŸŸåç«™ç‚¹ ##################server listen 80; server_name e-duck.xyz; rewrite ^(.*)$ https://$host$1 permanent;server listen 443 ssl http2; #åŸŸå server_name e-duck.xyz; #sslè¯ä¹¦çš„pemæ–‡ä»¶è·¯å¾„ ssl_certificate /etc/nginx/cert.pem; #sslè¯ä¹¦çš„keyæ–‡ä»¶è·¯å¾„ ssl_certificate_key /etc/nginx/key.pem; location / root /var/myapp/home/dist/; index index.html; error_page 404 /404.html; location = /404.html error_page 500 502 503 504 /50x.html; location = /50x.html next-lab.e-duck.xyz################ Next-Three-Lab ################server listen 443 ssl http2; # å…³é”®éƒ¨åˆ†ï¼šè®¾ç½®æœåŠ¡å™¨åŸŸå server_name next-lab.e-duck.xyz; #sslè¯ä¹¦çš„pemæ–‡ä»¶è·¯å¾„ ssl_certificate /home/key_cert/next_lab_e_duck_xyz/cert.pem; #sslè¯ä¹¦çš„keyæ–‡ä»¶è·¯å¾„ ssl_certificate_key /home/key_cert/next_lab_e_duck_xyz/key.pem; ssl_session_timeout 5m; ssl_prefer_server_ciphers on; # ä½¿ç”¨çš„åŠ å¯†å¥—ä»¶ ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; # ä½¿ç”¨çš„TLSåè®®ç±»å‹ï¼Œè‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®® ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; location / root /var/myapp/next_react_lab/out/; index index.html; server listen 80; server_name next-lab.e-duck.xyz; return 301 https://$host$request_uri; ç«¯å£é…ç½®ç«¯å£é…ç½® å‚è€ƒåšå®¢ï¼š é˜¿é‡Œäº‘æœåŠ¡å™¨å¼€æ”¾ç«¯å£çš„æ­£ç¡®æ–¹å¼éœ€è¦å¤–ç•Œè®¿é—®çš„ç«¯å£æœåŠ¡éœ€è¦å†äº‘æœåŠ¡å™¨ä¸­è¿›è¡Œå¼€æ”¾ï¼Œè¿™ä¸ªå¯ä»¥åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šé…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé…ç½®ï¼šå¼€æ”¾æŒ‡å®šç«¯å£firewall-cmd --zone=public --add-port=80/tcp --permanenté‡å¯é˜²ç«å¢™systemctl restart firewalld.service Tomcatæµ…é…ä¸€ä¸‹ æ“ä½œç³»ç»Ÿ CentOS 7.9 64ä½Java 1.7.0tomcat 8.5.99é…ç½®Javaå‚è€ƒåšå®¢ï¼š CentOS 7 å®‰è£…å’Œé…ç½®javaç¯å¢ƒ | tomcatå¯åŠ¨â€œæˆåŠŸâ€ï¼Œä½†æ˜¯æµè§ˆå™¨æ— æ³•è®¿é—®éœ€è¦æ³¨æ„çš„æ˜¯TomCatçš„ç‰ˆæœ¬å’ŒJavaçš„ç‰ˆæœ¬ä¸€å®šè¦åŒ¹é…ï¼Œå¦åˆ™tomcatè¿è¡Œä¸èµ·æ¥ï¼Œæˆ‘æ˜¯æŠ¥ç¼ºåŒ…é”™è¯¯ï¼šException in thread main java.lang.UnsupportedClassVersionError: org/apache/catalina/startup/Bootstrap æ£€æµ‹Tomcatæ˜¯å¦å¼€å¯çš„æ–¹å¼ï¼šps -ef | grep tomcat SSLé…ç½®æµç¨‹ç®€è¿° é…ç½®ACMEä½¿ç”¨ACMEå®‰è£…è¯ä¹¦nginxé…ç½®sslæœåŠ¡ é…ç½®ACMEACMEï¼šè‡ªåŠ¨è¯ä¹¦ç®¡ç†ç¯å¢ƒï¼Œæ˜¯è¯ä¹¦çš„ç­¾å‘å·¥å…·acme.shCAï¼šè¯ä¹¦é¢å‘æœºæ„Letâ€™s Encryptå‚è€ƒå†…å®¹ï¼šLetâ€™s Encrypt è¯ä¹¦ç”³è¯·åŠé…ç½®acme.shå®˜æ–¹ä¸­æ–‡æ–‡æ¡£acme.shçš„å®‰è£…å®‰è£…acme.chï¼Œé¡ºä¾¿æ³¨å†Œé‚®ç®±curl https://get.acme.sh | sh -s email=my@example.comå®‰è£…åˆ°rootç›®å½•ä¸‹ï¼š~/.acme.sh/åœ¨rootç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª.bashrcï¼švim .bashrcåœ¨bashä¸­é…ç½®ä¸€ä¸ªshellçš„aliasï¼šalias acme.sh=~/.acme.sh/acme.shè¿™æ ·ä½¿ç”¨acme.shå‘½ä»¤æ›´åŠ æ–¹ä¾¿ï¼šacme.sh -h å®‰è£…è¯ä¹¦ä½¿ç”¨acme.shå®‰è£…è¯ä¹¦ ä¸€å…±æœ‰2ç§ç”Ÿæˆè¯ä¹¦çš„æ–¹å¼ï¼šhttp dnsè¿™é‡Œä½¿ç”¨çš„æ˜¯httpæ–¹å¼ç”Ÿæˆè¯ä¹¦éœ€è¦å°†caæœåŠ¡å™¨ä¿®æ”¹ä¸ºletsencryptï¼Œé»˜è®¤æ˜¯zerosslï¼šacme.sh --set-default-ca --server letsencryptæŒ‡å®šåŸŸåå’Œç½‘ç«™æ ¹ç›®å½•ï¼Œå°±å¯ä»¥ç”Ÿæˆè¯ä¹¦äº†ï¼šacme.sh --issue -d mydomain.com -d www.mydomain.com --webroot /home/wwwroot/mydomain.com/æŒ‡å®šè¯ä¹¦çš„å®‰è£…ä½ç½®ï¼šApacheacme.sh --install-cert -d example.com \\--cert-file /path/to/certfile/in/apache/cert.pem \\--key-file /path/to/keyfile/in/apache/key.pem \\--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\--reloadcmd service apache2 force-reloadNginxacme.sh --install-cert -d example.com \\--key-file /path/to/keyfile/in/nginx/key.pem \\--fullchain-file /path/to/fullchain/nginx/cert.pem \\--reloadcmd service nginx force-reloadæ£€æŸ¥å·²å®‰è£…è¯ä¹¦ä¿¡æ¯ï¼šacme.sh --info -d example.com Nginxé…ç½®Httpså‚è€ƒåšå®¢æ£€æŸ¥nginxæ˜¯å¦å­˜åœ¨sslæ¨¡å—ï¼šcd /usr/sbin./nginx -Vå¦‚æœconfigure argumentså­˜åœ¨â€“with-https_ssl_moduleï¼Œè¯´æ˜å­˜åœ¨sslæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œé…ç½®æ³¨æ„è¦æ£€æŸ¥æœåŠ¡å™¨çš„443ç«¯å£æ˜¯å¦å¼€æ”¾é…ç½®æ¨¡ç‰ˆå°†80ç«¯å£é‡å®šå‘åˆ°443ç«¯å£ jenkinsçš„å®‰è£…å’Œé…ç½®jenkinsçš„å®‰è£…ç¯å¢ƒç‰ˆæœ¬ æ“ä½œç³»ç»Ÿï¼šCentOS 7jdkï¼š21.0.5maven: 3.8.8jenkins: 2.463 å‚è€ƒèµ„æ–™ centos7 + jdk 1.8+ maven + jenkins2.346çš„å®‰è£…é…ç½®æŒ‡å—æ³¨æ„ï¼šç”±äºè¿™ç¯‡æ–‡ç« é‡Œä½¿ç”¨çš„jenkinså’Œjdkç‰ˆæœ¬éƒ½æ¯”è¾ƒä½ï¼Œåˆ°åé¢jenkinså®‰è£…çš„æ’ä»¶éƒ½æœ‰ä¸å…¼å®¹çš„é—®é¢˜å®‰è£…Maven2.4æ–°ç‰ˆæœ¬jenkinsé…ç½®æ–¹å¼jenkinså¸è½½æ–¹å¼å®˜æ–¹æä¾›çš„jenkinså®‰è£…æ–¹å¼jdk21çš„å®‰è£… å®‰è£…jdkå’Œmavenå®‰è£…jdk å®‰è£…åœ°å€ä¸‹è½½tar.gzå‹ç¼©åŒ…ï¼Œä¼ è¾“åˆ°optæ–‡ä»¶å¤¹ä¸­ï¼Œ-bash-4.2# cd /opt # è¿›å…¥å­˜æ”¾taråŒ…çš„æ–‡ä»¶å¤¹å†…-bash-4.2# mkdir /usr/java # åˆ›å»º/usrä¸‹çš„javaæ–‡ä»¶å¤¹-bash-4.2# tar -zxvf jdk-21_linux-x64_bin.tar.gz -C /usr/java #è§£å‹æ–‡ä»¶åˆ°/usr/javaå†…é…ç½®ç¯å¢ƒå˜é‡-bash-4.2# vim /etc/profile # ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶æ’å…¥ç¯å¢ƒå˜é‡ï¼šexport JAVA_HOME=/usr/local/jdk-21.0.5export PATH=$PATH:$JAVA_HOME/binç¼–è¾‘ç»“æŸåescé€€å‡ºç¼–è¾‘å™¨è¾“å…¥:wqä¿å­˜ä¿®æ”¹é‡å¯å¹¶æ£€æŸ¥javaç‰ˆæœ¬-bash-4.2# source /etc/profile # ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ-bash-4.2# java --version # æŸ¥è¯¢javaç‰ˆæœ¬ å®‰è£…maven ä¸‹è½½åœ°å€å°†å®‰è£…å‹ç¼©åŒ…ç§»åŠ¨åˆ°optç›®å½•ä¸‹å®‰è£…ç»“æŸååŸºæœ¬å’Œjdkçš„å®‰è£…ç›¸åŒçš„æ­¥éª¤ï¼šè§£å‹æ–‡ä»¶åˆ°usrlocalä¸‹-base-4.2# cd /opt-base-4.2# tar -zxvf apache-maven-3.8.8-bin.tar.gz -C /usr/localé…ç½®mavenç¯å¢ƒå˜é‡ç¼–è¾‘é…ç½®æ–‡ä»¶etcprofilevim /etc/profileæ·»åŠ ç¯å¢ƒå˜é‡export MAVEN_HOME=/usr/local/apache-maven-3.8.8 export PATH=$MAVEN_HOME/bin:$PATHåˆ·æ–°é…ç½®æ–‡ä»¶ï¼Œæ£€æµ‹æ˜¯å¦æˆåŠŸsource /etc/profilemvn -v å®‰è£…jenkinsç›´æ¥ç…§æ¬å®˜æ–¹çš„æ•™ç¨‹ï¼šå®‰è£…jenkinsæ‹‰å–å®‰è£…åŒ…ï¼šsudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat/jenkins.reposudo rpm --import https://pkg.jenkins.io/redhat/jenkins.io-2023.keyè¿˜è¦å®‰è£…jenkinsä¸­ç”¨åˆ°çš„å­—ä½“ï¼šsudo yum install fontconfigå®‰è£…jenkinsï¼šyum install jenkinsé…ç½®åŠè¿è¡Œjenkinsï¼šå¦‚æœéœ€è¦ä¿®æ”¹jenkinsçš„ç«¯å£ï¼Œéœ€è¦ä¿®æ”¹jenkins.serviceæ–‡ä»¶ï¼švim /usr/lib/systemd/system/jenkins.serviceä¿®æ”¹å…¶ä¸­çš„ç¯å¢ƒå˜é‡JENKINS_PORTï¼šEnvironment=â€œJENKINS_PORT=8888â€ä¿®æ”¹å®Œä¹‹åéœ€è¦é‡æ–°åŠ è½½ç³»ç»Ÿé…ç½®ï¼šsystemctl daemon-reloadå¯åŠ¨jenkinsï¼šsystemctl start jenkins é—®é¢˜ä»¥åŠè§£å†³æ–¹æ³•é…ç½®çš„æ—¶å€™é‡åˆ°äº†å¾ˆå¤šå‘ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯ç”±äºjdkå’Œjenkinsç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´çš„å„ç§æŠ¥é”™ã€‚javaç‰ˆæœ¬åˆ‡æ¢æ—¶ï¼Œjavaå‘½ä»¤åˆ·æ–°å¤±è´¥å› ä¸ºä¸€å¼€å§‹å®‰è£…çš„æ˜¯1.8ä½ç‰ˆæœ¬çš„jdkï¼Œjenkinsçš„å¾ˆå¤šæ’ä»¶éƒ½æ— æ³•è¿è¡Œï¼Œäºæ˜¯è¦æŠŠæ—§ç‰ˆæœ¬çš„jdkåˆ é™¤æ‰ï¼Œæ¢æ–°ç‰ˆæœ¬çš„ï¼Œåˆ é™¤æ–¹å¼å¦‚ä¸‹ï¼šåˆ é™¤æ‰€æœ‰åä¸ºjavaçš„æ–‡ä»¶find / -iname java | xargs -n 1000 rm -rfåˆ é™¤etcprofileä¸­æ—§çš„jdkç¯å¢ƒå˜é‡æ¸…é™¤bash shellå†…éƒ¨çš„å“ˆå¸Œè¡¨ç¼“å­˜çš„å‘½ä»¤ï¼ˆé‡è¦ï¼‰å¦‚æœä¸æ‰§è¡Œè¿™ä¸€æ­¥ï¼Œå³ä¾¿æ˜¯åˆ é™¤äº†usrbinjavaï¼Œæ‰§è¡Œjavaå‘½ä»¤æ—¶è¿˜æ˜¯ä¼šè½¯é“¾æ¥åˆ°åŸå…ˆçš„æ–‡ä»¶å¤¹hash -rè¿è¡Œjavaå‘½ä»¤æ—¶æŠ¥é”™ï¼šlibjli.so not foundæŠŠæ—§ç‰ˆæœ¬çš„javaåˆ é™¤å¹²å‡€ä¹‹åï¼Œé‡æ–°å®‰è£…javaè¿è¡ŒjenkinsæŠ¥é”™ï¼šusrsharejavajenkins.war not installedæŠ¥é”™å‘ç”Ÿåœ¨åˆ‡æ¢javaç‰ˆæœ¬ä¹‹åï¼ŒæŠŠjenkinsåˆ é™¤åé‡æ–°å®‰è£…åº”è¯¥å¯ä»¥è¿è¡ŒjenkinsæŠ¥é”™ï¼šWARNING: An illegal reflective access operation has occurredé«˜ç‰ˆæœ¬javaé…ä½ç‰ˆæœ¬jenkinså¯¼è‡´çš„é”™è¯¯ï¼Œæ¢é«˜ç‰ˆæœ¬jenkinsè¿è¡ŒjenkinsæŠ¥é”™ï¼šCaused by: java.io.IOException: Failed to bind to 0.0.0.00.0.0.0:80808080ç«¯å£å·²ç»è¢«äººå ç”¨äº†ï¼Œç°ç”¨lsofå‘½ä»¤æ£€æŸ¥ä¸€ä¸‹ç«¯å£çŠ¶æ€ï¼šé¦–å…ˆå®‰è£…lsofå‘½ä»¤ï¼ˆå¦‚æœæ²¡æœ‰è¯¥å‘½ä»¤çš„è¯ï¼‰ï¼šsudo yum install lsofç”¨lsofå‘½ä»¤æ£€æŸ¥8080ç«¯å£æƒ…å†µï¼šsudo lsof -i 8080COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAMEjava 6056 root 108u IPv6 6181134 0t0 TCP *:webcache (LISTEN)å¦‚æœç«¯å£è¢«å ç”¨ï¼Œæ€æ­»å ç”¨ç«¯å£çš„æœåŠ¡ï¼šsudo kill -9 6056å¸è½½jenkins# rpm å¸è½½rpm -e jenkins# æ£€æŸ¥æ˜¯å¦å¸è½½æˆåŠŸrpm -ql jenkins# å½»åº•åˆ é™¤æ®‹ç•™æ–‡ä»¶find / -iname jenkins | xargs -n 1000 rm -rf jenkinsçš„é…ç½®","tags":["DevOps"]},{"title":"PicBoo","path":"/2023/11/03/PicBoo/","content":"4e553101230d2a6139bf4ebca5206e100865995d37b8e5259c13d18d8c77dbdafb8ba61642286de09c14681a287b2e542d144b2ec91ec502e64d3fb9e91828c92f89a571518577749915c7162ff85fb458d7a0386d4d89a51b7e85cfa277cd1cb81a91b27142bcfc952b04a24c720a992ee665cff3ed2b5580ca496ceae617e0b6926fd0b62b49eaa29114fd1b6f00c1d4044cc69aedcd184cd6d9c69600f649e700fc993a24854a64df208028741bc197e71e69c4f8698e80217d582269283c9b170b574b6f4f70c0b5eee7f7779cd18d39663b17e31da4c52b77d6647e7561f6c59295a726fb513b8b449db6d69bab3471165ce663d862da4d075e39ddaef2725716b61e93e5ad27e7d3464a5a0d83236885b4b8030e607e08ed344f48b9f2c963c3fd472cc566ff22f1983c30a29afa4ba768b6de84926998e298d524d0fdc4d7a81cf5e6ea0522ca7d1b6de921882e9b873ea1949697f140b4c9d18d955ee57284b3755f5bd34eae6561c8cc5fd5e14a3c38dabc93bec185a89bb19400ebc872e82826ad29a95013585272c20c08e72e5062624e77ead6aee02c66783f8aff248a45b2a361888f613ae34d51201b4cfb838af21cdc1be13843c6b615cabb42f07f9e3c18130de48b90f4fc9139fab9cb01744e7c87d627e012d9b9842c10d96c7ae8318a12887baa1f5b90d98253868ef497cb3005fe0576523085007462bdb42c10c1086482864a64cfa97648f833f2eb1c032b76b05b46ec4ea160aa7fc9da874f7e8beaa60574cf47eb52d1dbce48fa477da0b9533e6ceb3975c598d0335277950fd1e067e25ca0e9405434a5186d3d0a1984e698b38905b009f255c28e3c20d366d4f563b9de0a9fbe9b911bc01644950fcf1662fa4d095ec0f5f685a06f46a8200acf3f8c9076a674b6ac478cf632affa0d7a2937c8d6bf14ed5f54f790c3ccb95e9b94e674cb2f35e90ef06517517b0c4b78e5e7a4643a753d724c36001d8415e41251d7ddaa259fe398f127c30e6b4191a55fefdeb347a1b47288a7c44e9d3a499c76e7f9d80202b0afdbb687b48695a24a38af82cb9e492b51497599b8c3a2dc8097902dac224b15ba69d62e6d08c4d22b683f4dc0dab597f6a88e9885e29afe10dc439ab44be0351f80dd1e89780a94c288a0215c8d2ede3a32bad31df945d25c671dc5355ae08ce0638a1409f8fd74bb268cccc163ec6a9dc0021648792063242e7f3685e15768edf6ca7f0e25fd7241c7ff10bd0cb094fb10f2f6c8e727a2632967aa2172f1bc131ddfa90fb43f7de28199448e4b0f31b258040e00f2c0e257e4970ff1ac81e0d2b68d2c46252491349258dd0b782354ccd65f98201852affe000ecb60c2e2bf61bb2631287da55d48a8acb12287615ba15177c87ff4eb64a42c2367f3849f6ee0cab9477b6c1681ac5c3b4f01b80c38b242a40830015d4002d2aef9e67efb71441a226e007b88a54804cf726f92184ed1395c84594f7a19e60db4577ebb2ee911dd3b8a23d39f519d7bb80c0cbb453714c88dcf85936e5022020b643dbafa7fd803f890a3cbbe134072f6964a73dcc7b9f264a9ee48185ffe29b8209344e6d1b41a2b94af3c4f52ac61d2932835df0ca7ceacad47ef03aba39f840f632029656027ea41c7afa7b42608e4341d9212f6fbac8620f0af63ea5eeb82591de72e30fe3c8fa3d9fa9ff828cfcd0a7a8a1c25fceb54ee9bcf8b876d097bf09cd58d43fb1b6b3c117bbcd6b51d6307b291a30427c59b258aef7d9b9056865ef24e3791010fdff19f56c9ed038922155b9275194c586bfb33c626c5a2601c8f87162437c861c66194221c7e8e93bba553839957855dbc6f8cced6ea027a77526df4a9cf5776980d89b54721e89a18f647850f029035a3c5754c21811c0d3a14b0cb4ebcc0c8e723f0820d0d9ff1d3d7d569109b8db4d4ef54c0082018087a8e707adcd9f461a7db2eba72e41d8c9b8bac3e0c5880fd5e007faaf01b408424807f743980dcd0db917caf0b46833e689290295ee97f4675381bd02db71dd8058b0dc9df9beb269209ec541cdd84ae317d4b9b9aa25c649f2cb630e4d013d30c89de74474b341401e93a69a471ee7f9eb288aea6981e794e760f1521858c76e72bba7299e763a8bd32ace659fe4becb160455b7288fb23ee7ba2676a645fa7beed6ca133155cb5bc4f9f63164a85f47c081996180099c9663d35a0a0ded2355c1c5962688d5439c4fa5e533897a31a3f65468bed9de0fc99ebcbd9e5baf34bf6ec8d47ae62c4e911505140f11ce708d24e8cdda04b7bddfd04314fccbf1d32f2d1a6545897f2488e720283ad74cc772766d8ade7d7118206f0d59d5d6fe54f48138f156fc3633eda0ee3af8983f5091409bb7062d366847582b53cf5db06933f11cb4003f6c8e3c191bf1145c70cffc5801d92f62be2838273882a3942e8fc4fbaf61c0a7bc544a0faf6e2efd984cf38ec9915e8fcc604dde7c604ff61b34e736dba5d422d45b3bf7acb6c924dbb4cd24d2fd9e4e2568988708c6a6d572be6d724b54f00bf5e025c227d4c2f12cc55cb840be6b68ec2ef40758028c78186368a35523ee4772cf5426342308f062bcf3862304b91f72610dfd76fcf3f45d4ea082251601e0200f0e102daed4e8ca7ce09d32de4b6ad1d453cf22b2115cec7dfb140d0c576a0bc88adcd226c24ea50adfe8befb47dbaaa5313b932fa8c9765b8fded7af8b56fbfe9830ea26eeda50e87dc51875cfcfb45f83bcb0b7b61bfe8d2175e7d0fce9fb2618e8351a3d7182f0a6b12126d996a74caea11d77b9a5a86ce3432de3c764156de9058b132d59a6272e5ce35cbffdbd1d5b4c416c5b38e8f658d54613ab83315658c86140298146455429f4cd48ff149335a491e585e8be9b8d55e48e4a12764b6fa8ff06392f3d1232b79d465975e139b7a23868ba7967751f23b1b713626efbdb70462da74e8cd31d6b5a4a869b4f0abaeee41fa4457df7dc9e50415cc50c542596e7d7bffda2dc62b19bec156c8c13ad4d86e6de16665bbb77f0fcc67a7cd71c135cdcd8aa7e91eed3a57b7c364f99fca3cb3136d8be214165f06e96eae4b99272378c2b185865250581cefdc6acb1ee95133a12468c75f41fac5f603e768d128002c3413ebf91df8ab547107c075025724b8bc08a218529916e7b840e9ade53bb2db7d1241f5ec7387aa2c1fad94420f936938ff207e09f0393cb691d130c32c33f1b138789ca934dd85b4883c27a1a743490c37872375f109c7fbb10c57f7d271f3610ab6a2c0ef06dde4e7bbdfa3ec1bc6df68bd6565c1dcd4518ba84dcfd131722208007e79b3b1b024fc67bc6e077e18875d537e2d474ce9464c17c374864be43e93e1bfdc549eff68a93a8f129ab1d6088d05ca62519dbf1195072aa1c7db2cdfa802e5b013b2815dd6fa0de7f93c8ace4f6b54e0c8203a8a7a379cd44a4735a710dcfb8bdce9fc61783a591fde7cad01dfe8c87e01cd835a284005bdcb5ff5d0e20ae801dfedd03a368ea0e27fb12cd105c5a0e41131ded27deb8fdb547a780bdc5ae984a4d57ff0f5b6af1e87b8bc85706ac625a988e5c60ebceafafef983c1ef38210466ee1ca65401c7c4ac2fcd4a9d08f8be2d1b4f98495666b62cc967dc589f807782a8c6c90c314aa31c8849c665848a40e3ab580dd86f38c119023cad35f92b990089237354ebcccd70ce1b65b6a4e6c788495ddf4bae618efcc019e10a4066609a16f9fd15e7ddde2b8a7f05c97d8410e9e7f5a66cdfbf56a20abb74b89e9950f270dfe9e6e794b2410e4c02c3370faf37712f43ffeedba2bd8e0adc7ff4cfd9e284db41fed369e275f83a1f6d8aed5521edab9327bf4b519bdc6dbd25f8499839b02f22b6674c817174fd6820aa336f048630611591361e125f9b9c7dcd1e7a0df2905aaa9ff6a9f812e431f0a9dabab6bfd1b5fb029b9f7af1310d0c8c764a7817fc3fc482c1802a9ac07adfc88763a1ffca91e33e7d4c524d2d6c625baceb41bb51c376471c91a3e63454fb2bb98d89943c16be82ad4be4a38d6d4816d2f7f3d8a2cbc028352da5bc5bac1762e27f07aa073b4dc733ac72d0e8ff13156313fbf52b15a43c610807682835ef3409ec60a406d47e70f93276c03bf2da9e3fb3791010b1874573092a0634830259cdce0af6f055a108a52037c93f3ebeac3c20f9f89bd7d6be9dfe8921e0fb8c6562816a1e78b6d33a9ee24bc7033ff5cdc945cc7cffbfca2476c0e54d118b888b666268c761527e5c273423b707cf785cb913562a6a2de73d43fa3580532554d2e7c5ee5c300d65959d4d244a25ca72767c350a6a2fb95a7b86a12a1c633a779943186604e1f0871bdf8b77dab9d98c209d922191ca05e0810ef24173d53eb03fad9652cc6b9bfaac290ecceefaf46a88bf4e13e4733c791fae28d05c60d0a61c80744d7ad6f83f0029e02f1417da4271a25846756bec506c0667eb12322ff8bc47c1b54e25592b39c9c689cf02a4f08aa88e2ec0a4e5f4e21af2aebd63a7542099c35dc85cf7dab8c9735d5c9c67d1a9aacfd256d7d50706d988ff92cf981bf659e2aec29221815e61473920174e03fb238eb3b65327b2fc63b04bce7aed20fc7fe9f13e3a8a53e2d45a9f44e1098d2c39462224fc7bdca22eb1bf80cf5e2c68b6b28d6ef33119d0c3f72824fa3e14dc95c8b15e85f8fee7d67925eb5ee79e2c04136b6f3d10fe9578ce54f18a1e1c49f9cadf36a18a2ffd2bcd85257b9f7082c427424ed625188f2578b823d8d0098de0f63615417b4bcc88e6df74898c9287532c032d4c48dce7a7fa9f0ba96822859d91fec31054392f2444158588e9daa83cd1070ad092eb1a9c3f6407137aa60f9176b2e65e480f7d476d5a08ad3542ff4866f5bbbee3aab85cdd7ca79a51abc380599858aadf2e04e9282195e20ebf01fd1744a83e8fc2218660a92793ac33fe0a8632446c5196cffd45665394a1425dc9a1839a46dd06155d8949e6f11768d95e8359f83e33d1451bdf869c0cb92916f2d2daa1abf040f6efdabee3adc44d6f9c97273c5e3838ca4506874a92068a71a04a63a145a3bbddb8ae7cd9ad0eae427f4355f1426da56872c5c993aa6cbd40ded51d13e35db9850923d8999cef9df951034cd9b9552709f44f37e7873301ea1ee6c7cf8cef3149c944202abe9140eb0e46b295feaea595998708e6d14482bbdb1ef752c6970d8f3e7d59071f7f6f12878a657612980acaf172c668dfd8bac5d9b36778c3461bd1c3108434e098ffdb71d597bb0143b9865b3351b16b3ef7bdcf7d15e2be9c853dae72d35bd8fdd673d0ee8ef0d361fc99acdd53f5a8bd88a95f3d021bfda7e9c7daf47ebba53d81308d943b3387279f705e6570c7221964975b20453e1af3392967246ec7c7943697b3abac2ffed7dd3ce3448c3d5e7754db9d5e2a2d62b7b6c362b639dd82fd0fe339d945e08e2eeb698dd949138470f3cd570808859d7a8934532e9e402f37fb0a51644d97b4d2fe52aac8feab02347bb7179673751129fb9277426ff2cc16d292a8ef7ac48a45cecb48ba6410065e68a05ef447a1bad8a4e142376dfea6cd14b23bd0c71e4659f4c4fa1a6514b14b546003d4982821145c914bead5d1cdab897f9aacbc008c5625f1d2b0c4211cec2ea8104383aed343ce5d9a65806f5ac4ddbf1590f4b26673b1f38311e0dfe379e46e0cae0f01841c8f8103e015401e7999cf7077141ea7dc8c147cdf8be5d70aabb37c88148db5bb341bd032c706fea1ad42ef76c60d7a97cf3d5d9405c4be59c6342d199e329f95a4724b57d3b76d75746a08567d694fe16eb7246bdfc6b49d9f00391f3034b3e15f9c71af2630ec97dd6a438fae71ae7770b607238b0ec30638af021dccf0d0e0500a4f6a4c2c2c41b0ca903027b8d2e575b4487c5e847df4fa817c8d2b2cae6c90f490531abf5884baaf8e9399312463498fc4ebd56f21c2ae7e63e1d3c1fe9b54e5e0a07ccfa22732baef83e7dc6cfb9de5011237939660a418265abcec03db5f11613d09e3863395cc263e5005002e6ca46dcf986be80f112e480bd7ef0c7ace36de3fc9acebcdc653f0ffde40dd5f8b9d7e064cb039cedd53afb3075684d624af420ebe834bd0006a51fb073c922e193d4e9212568ae21ef39a379ad663c0dbe9de570d8eec64e2ac7bf013c45f9ce2016751af5a0dfc9ad8adf8fb50d8b8abca2f2ae28c868fc30c5b8b43dddfa8774e9f144a5dcf388d7703641e26b9a99a4632da3913ebecf2758678c8277e52c4f2ad588f6277f5f368e17beeacbfd535d7530f904863722343cffdfde4f394ddbe30a1a93b84cd04bf8dbf8e0e33320f6fe828869283be8c48ca21c4c52c8bad747c45ed2be66410932ebdca56564236a8032d6cd3c4d67475232ae33d26ca7624d78a3bdf8db2538a79d2039f31bdbaa205de4292491f52ae707c433f99f88d0d00b3ebe93ab50d49f2b3b48a43a303bb90260c7b725f373dc2dabdbe9599d39fd0c26925d88e9f8d5695847760dbf6c39bc6a571885d04440b73e2a9cfd49758cf23cdd372b7c35491703734c6fcbf48fe72da3300c936cce9231aec11e32cf46a12813bcfecc9e1fa926e76688c7b68d214f9445cd09398a0311a4093ec56fdff7a456fa66007a30837090b6d2405c39d9aa987fcc81804def1b5dd4c3b21c28080c8954de538c59783ca4bdb8aadb7c6462652b8256ee095e40f54ab4bfef8be99cb2425a2eca61686fb1e0b8879b52b15750a5eae00a24caa6968235b0b32ac72521c060de6f59d340f6ed9dcd86f3b7675488eae41c17c327c2f13c389b22523627dfaffdef5b6ae02e9b9ceb5a2bfeac1b6a4289d742d54e55983eb6673a267e8fe938310f10e96cf4fbcf47111b78e653193d7275cab0d21058dd93b9f5aff51435963462a31211d4751861abe12b2cf2ddc738a0457039a088c0a1cf2ac90d22f1bd65372a0202e1a24e13c839188044f42d06ba9501cb42a884924df43039db0ae4a82e53a9c317007a7727c73cc73dd19bb7232b9fa4b8d415e2353881ab43d73a7ac201e881fb34e9adad159e600797b507fa660ae1bd09160488091a1bfc579f1e4613f71f6b03df12daf6a6eb7d64864a308e6b66a4f3e87357be6e0f8b7e48222cc3ab4f20a130a5c763140c92c59db35b1de6fb5ac7898737592578c2189eed6cc544f260df7e85416e7be48a4560239370ae5e16df3437e4d9b3b99b4c1cc7ea691b6108af3f1114ca8ab4ed333a74ebd85771f0a577609e8c3d52c90b066fa79bc334abc4ced0a38865a633fe66d27ec230e787afac7cda3e42d9d89dd29f1afd87d44f20f04dd897e45a493d24ef17f3ce77293e5616b6749f197313a1f604f0625cd18ae28745623ba1efede1ea1ec1b93a9157fc80269ff5b4d5ee6c9e3bf84ce672ee6200864dd002c0edf2672cd1b69003a5b5438cf083a963316e7a262ed895b129935ec6a207d3e5a1e063fb8b0d2cae8a142ec96c0656f1e85d3aa5847396c3d2c248b47daf4c329d0b64a4cd825817048e08b97d694829cf327cbcd8c4ff8b83a3fe75fa3796ed365415c4322a6128da722ce46899ab0d8b51d57b98b844fb195f68c8db9ec3914420e649fe26d5bf746079a8e8b7efc77385190d1773c889a7f83155de229d1a5b6907777d705c8f07d218c130e36a5f277215fbfa3e49cc22571b68611896b8d0ab3357b0491ec22b05d1e236290711db59c05bf621b9aec189637eafbb6ec9aae66a3a06606e796e262dba24a0ff636e701ace6158dff245dc59b2f7f5b43a9e65376ceea907a0bcaf52fdbe9d6048f4aec8210ac37ca4406aaae0c48b3a8bc82fd037e299a310c8a696b2f87084a2cf928e3082a88fd6859a1a24003147d133c3f3a6b632d88cd9303e0927ecc468b86e0fdce29ecb9875cf471ea5155d48a1715e7829f682e26f74c1a08a62899d57a4e1614e7bbf7e9a000cf71564a524b8ccfbf4a8c712ae40d950ca7f7a6a0819dfb8988ceeff94634629e0fbc9121262e4675ae16ae9080eeeb1273859a962674fc2818c1136d8d59f1b6bcd01f76a941f77d608053e8045736f3f54982379d06c71a6c75d818b1d9eff1ed5a8e85c8f63cff98c09215b3428d0e23ce2c6c5eda6de56084d2f8651ab3c1d5f1d1901162cb2cf288e4b8a06ef206695220dc3ab13a777d1ebd796d8084bc5c41dce853a170a041894e2d69b6d748127af94f1d89acc07fca144c9e7a5ab983eab624543be3939b13ea7f0695e21742f90663ec079874ae11d2ae5a8a506bef8d1ed18795e371d0d722eac0167317e05ece12ec3642afd2cfe329286a1e288dc676390c98abae8270b776e9deb2507cd2915d0a3dc2e371d8d64c20c3fa3e0b8e6f8d1c50baee126301013fcf4d8c68847dca5ac6f294d2d925a470792588caac1fbf6749d227558cd072174d7d5c262c550d02713219393195ccabdd0218f55a90131199fcaf68b1403425d1a55acc0696c885357493605c10c6754d7d194102954b6b2773664855221e1e92ef31e3e96576154a39a49e5f227872053871b07dd10055f6bd6a2b0314383da59472a6a55b9400954cd11953d7ff6b0a152df41534970927fa8fdfe153ddcfea6c89aa164ca54161f5ba99232283025fa5be45d06096977c0796b60cf619f2a864df869a7e856ef50407148a286000c5896f57d53b8834347e8728ca4f6607a58569c8ec044280ab426c1235f10859500fc98911ebca60b29e95c49b95d0a719759c00531440f5f650a57f8315fe4405ea42a2f0ffe1881476169021b914ed3fb8d9e73a8381bbccb03e9e4847adb6773f51c0a15534433be102e1808104a3524fba515b01666a7ed130cc61ac6b56b2f9e3f98553495520e0c15489d19a0416c965884257b62ad611845d380847da71d87948ce089ed0c7bfda8cfaad52a0662ab3cb72a99c8cea627173803c3bf965358e257d002ecd0b90366a3fbedf04d00782b17de53adec17622a61ebbe8acd3fdfbbf407e960ee0374968b2b76f57807630900994ea15386372d9ac7b317fe8b0a104b5dbba0641c174ed98ab520b8edf99a9e8aee86d304b3d49595b3b3c074afd4f44edf5b58bcaf611b41911c9bcbbe1505de9bd9849369ebfbf2298d476bd712bd713453c1661ed4c6b07589775e10d089fc5895c8ef4725a61925e9b63c2f4efb08a20228951237c0b29ce519a54b025a9f328785c2005b8b960743fdc9677451a624a38723525e03e1179f6019eda73e6101f35b0cada02ecdeed907cb878bcdb599c66fdf5f1bcfe31e98a32043f403563d42fa6e476cbc2cffdf49d68c032dc7f26f8bf1a31faf82f122a5717133b127a3e95c8a63ce9f549e54e7ec621ab80fa5b938318c0aa18eeefed43d656c4d8cd9c433af07996861acb361bdec70b4a172a95a09f933b81ea664064e7d99014d44c2652f616d357d6d94c597ee08f13165d9df0985d17e4437470439e703e7aa83e422010ee4f98bf94ecb9835553be73d4305e4243609af5cbad047134465479daaf17171d617f516f38491afe2ee2c8ecda8ca593fc6d62610c1c54ebdff9d54a1a07ed29f3f32c8a8b73c9254aa57cb0e341c7c74f98968a9bc0153d1b5e8d3fc56a460a16fc7b3fb22033c281ecb87eed3a636eae596e07b2829dceb785304f934c616e9e134c973169115ca268d61f44f50c8ee7ddbe942697e35fce70d72542982baea1b3a7b4772def2675e031b75da085b81a01a0f87d462eff45a7a734f383b2493d939ade0dfaa7588b204da379e7389112450a321137d6eb5c87df48af6bcaa950f1ca02d0d54543f376d558306ca853bc6aba8b1882c09ad88bfb63f874745860a262d947fdf5e894d6f2d28caa3af84728baa675303df70c000587c179119e52ae8922bce4741eed2b6baf657a0a0e0eff09c37889feaa0df37ff34dd37b0f20ae9c051022d80f7370ed14717514a0dbde0473ddd84b738cfb22c1f46fbddf5c5a230eaa27990f2ddd92b1df0c8b69218bbbea13cf0de7f6ee1f681aaa8215ac70c923478fc0d8910b7a19bdc5ddc2ac741ed38d11689b34be886b4896e5e5664cef2a3ced0d863d515391d86c25815b368adf0971e12b831ef5cac612a662e8c132ee0837ffe0a24a69251c2dce2c88c329e3cd6c57b606116cafb66669e7fe9315a39baf8a7e6d1eff9afbdd0203c7967c587ecb73d0c16abc8c841276422472bd8ce5aae861cc3ace7593b95e1dbb77fca7b7d96764eb03d243bb855ccaf53985e5ed5bfe75caded489d9049ae9634a62ab9ad80f22dc8b3355981e53a02ca18632ef5c8d33c82b40fe5b1e0181bea6259c1064f8ba35311752e3ee906582925645d614b525db7aafedc108e7550bdc359ed5b9902dd4a9ae9330c668e7e040ec31eca321c47d4fdd6ff0fb85f83f7f3e03926c83cfdbf920aad69bdba03a45372892c04c71e8d4eef69cb096511354d162bd37b9f6467714eec2e74c7cf6045e3f18c5926e3efd78e9667c7f155b7fb0624bfa2d2cc31f62b81923228b7c4d6d1ab3a6d0e32857462fc2973129e049931a93b804ed6c009b9a0bbf08e23c16bc188ad630bf51e6f4a6ba272186ad29311c7dae47924ee16846e98fe2d752f026ce24ab161a952f86834c399312304db07b85a0d159b6408777c304e35b42ee3f71eced879ed5e80b61cb199e0e1fde5b3b9aece168d6f854df3894595e6218daf837dffdee61f54f2e7f26153e59b72ebabd7ee61adb7dbee22f5378745e62b0f838d739f4f8899737eda5d94f51e9b7d3ab7c32b4379248d50c4318922489e055a15c8f8aef6beb3903b3678975368565ed6ad1374a35c08cfd970533f9fdb8af4695b1d7fc1553807e14548b9b7db203a92ab268fd683b5da583a058f7f4f69eb34c2032f448a2b4da65c269a20ec6ccbe1639cd2a2b0da5c478812c0448e28a14a5e591e04c2338a2e6dab7c56436845a72397b3b515ae2a0be25a252f53897506b6ddc9b10fb89c85215a521257689c127dde4fa56adc9469ec16522431a633a022077370ecf45c0032de3b3954ca38f1a4f66f0a380861570a0c8e968878b1d116b7bcecae148e3a8ed836fdb58bfc667c1c78fb0393961218e769d651d64962c75da97e966e4cd40dcb4ac83b48fb512a137d09e7d25ba5aabfaae92299e7102c24c88e8a26d8815f5db6348c97014d0786312afe094b5071e80b4da5dbe639367d85ecdda7a68f14862cdb938a9ad863416394e5d3af0a656f9df125108cc63d595dd4b5902e56f6ee928e63d70dd80a31e9ebc5aad4e0a6cd520d5870170653fac23982289dae95905cdfe56a7dee963131f09c85f48cdbf840569aa748e4b925fcae61efe742677b18f8b72214169f34559345a936f7fb8569de5323b7a6aaa34fb889458beea552ec394bcae0313363c54a68fce492271b15d570249cb3003ea7af235cad179521404cc834b8f0964afb6d0c30ac84a4605b5db964775ab0eb9c51e87444208c04738f50819e086cb8055a627ef658ac361317c5526c8f1d9069fbe2fb4181d8d10e32fe3a89ea3f038aa5b1f0456b97e5692cbb51d1cd3859fa2dbfb5b3bdcea296a7fbdf59647131f6fcca2f60e8a6ffec285ac393d40c8770df5a4b0a1014407549df96eec772b0916ca313f6477e08b74e28adf658b7c712f057e2975e241a16a9ac53c4339fe0176e24ea9c3368401f4ccbc329c69455afff37096a77a830493b052a261301022647f10d81cce02af1111b8b2c1bce1f206501f0e457072092b9144999a1d7b62f6f7626ae34c37f7c70fb8d3a981f78946381d6a44958854ffc06be0f08f335d91e76b1822d16c26dccdcbe00906e067b99bf931bffb4625a29ee7d187e827b8b8fc006a2478e5f241d6d424025e107c6681f3deda7c84c19561d292154cce271cc1c2ebf3b8ce21f1953b3b8c2b32d279a0d2182fa657b153c22fdf9479b8cc4c4c25145688e19b4bed32def5900fe10efb455ec0343ec4ec4d5a7fc8a5451a542006a5942475133e1e142d66389884e7ddf7aff5e955a87aba0716995dcbadc5818ade3cb4ac9b8cdf6654f3bfc18df5e309af9d16c77aceddc0726e49bf05a10d66c1bbe53a1ef24532e6ffff4cc94fcf5ab2d925597df75a96045236afa54432c614f314745980aabfefa1519cbb3128aadf5b25c0517365df591b7df9ebd25dce654270264933ddd8abd9295a826d5644d7ce6c3fdd54a10a435bb43704d01986befac2c7eccdb0deb1cc8877d44bbefd4617fbe4a269a733c46083cb3a1f5e5e7ddf8d9f47db292a8a8c8ad7322beb734f4557319acd0bd223fcd6cf0139f37d5d2f934339f1c3248985ad1a6e068b2c3434f73b8cbec56a52f49bc9530cbc902fd756ab0ba0ffc1d75baf43f577e0e8894ff6db890c85bc589753565ece4ba506863a7b9317a8ba4b5b8250d271c60677c2f2bf8a7357f386e8c8551c796f629092e58a472b705ac8c5c77b84aea9fd37385475ca66b092ba4dafe854f0de41b51be1f5ad9c08a79c0c5065898277b187391a9446177cbd7c1cd9525a74fa193df4d6f91efca29a4d0f9f75f87adf89d9c5e05876fbd32646ce17e15165858cef5114c352c5ae6ed0ac3167c4ced7ba40e2149df67179b7cb958900f0433ba0fbb9d14bd76c0d1d24bace7261f8c5ced3f912d08319001917424d10d1537f6ad381bca25756a1e04931890e84ba13728468d0f7c01ff41d6aa09a7e7be209fb6ca5d2f78f6366146d4e428f744f479255eae1dcc0c53a7e576b575f0fdff45d13f84f87ec5da1e3f99828bd02fecd127ae671b15091a634fb0e93168ade51676c3c3f6a34e917ae2492df5ca7dc8a60ce417641e9a2efb88a77d4f557f060dda25750515ce8da9245be81562ae6bd331faa5fb8585a2e51443f918245c7d8e3b36f38caf019b7c87bec6720062f0223298b6f4a5855755a0efeb37eeb63df4e0f6c60c84433c12b743d8b187a4dee8770f151a8c37c6c31068a104dbe7956c6ab17e584b85ea5c7e7356043b2f120f5c6c6b166e735e5078c3904c0408589a360164fd50d5088584c4c8bb681388cf02bae24d44248cf549d60b582a009995640e737b63593b49b32e24882627f36de7e34209dd41bd42119f9b15b67e686bf9a3ef727d65154135274248968ffc1c9372602936c1bd7abe7144eb61d5b5e4d82c09bfd915011e92d93e578ef0f31380711ef6c5e053f5382692430f864d77986614f3353e8b95bd668b7b276519ea5f34fae1805be8207b81bdd7de09ffec328b09f858472b02423fdb04112734e4d358d4901d8db6c48fefe0438dfca87f1e01f03e6b9adf31ed14046e52a808b8afda043cf3548a418053da2acd3bdb93a7c903f6da3f819b4212f57cf9d503bb2e5931f5536d45b22db3092135744926adaab94aa010c5ec923444dcb425d83dccd7fe33bc243096cb1b14f8283b9303009d0c285343d8753a0de84039f790dde3036f85f0404685c2ba546a44097d111c3b66dec6e21055501ee188f5eccba175cd91d41abe499c015101b0d7e895af0137218ae4bf7cba4c4beb4e06b499db5dee9a7fdb2a0caca4dda63cecdc25527de33622334c4cf5a93fc4dd907415c91268aabf7aff934e1108d1f13f34ea04efd1ccef1d38d888216918c6ee919c38517fba82a93afec97bc71cfa31e61654511edd98b605c8e8ddbc1521d2f6b0c21ab48fefeb93b2c05b647d4f39f081d9463bfcbf8775226388479b8d1e3ac5b9db76abf78b61085870d2ddac22f6d2c5389e49ffaa5eb72de049764ef86cab3aa79a6877820cf5b709abc18470c69451f3dad1ba027fb862838b46fa827d13f39cd20f951e038b2523bf0f93d01d5009b8d21fd165aa30631033f69e9e1924ce91f1ead2ca52789b45f2d47009cd9f67a33765ec80e5bcfbe32ac6335bb703d573d5db9a347dedc5c1a02945a7c8c0628925df7f229f720561fd4abd3ce7e2dd12b1dc7cd60b9b9e59e563b8ada9363033b7b84e4156f841f59be1bb3be1cd16a70c21e15301244c7f88b31d420c51699067f3ba7379a3b2557560fbbed6daa20cbb53b850c8b1777e80f71dd687c81b101ca3509969184237eeb1843bef4d73a8a7e61431212cfabd297635ba8294e4b7a6ca5e5a3e9b16efb2bc20d845b5db62ced0b866534bfd07f1ccc9b644186df175206650d0cea07978bd3d3899f6e9880d7c8dbd050988c07142d4266166f048b190403c8d60086cf0318c81ee5808672a6706323a9047ff2775b2aa5701513ef52e7b45a35fcfdfe1846db2ed5a04c8b57b58ef744db15873df2b3af0cd4f31835f4799413868eb8034bf702d9bc74747911beb6962957000765dd30c83bf82a175cb8183a011fd8f28390ddda89ffbaa57c4d8a56d474dacbfb1fb95b26ee65792a794e8574f27c76b8691a13404f65b1b11bea02c54dcb995c7ebf9d7926db2b2df6ad4c6df77cddce90d172a3bcb51ee55847c9beca85e75b21f47c4b6873a3558c5c0e5a1cc1859c8a891405b5ccbd52758f46c6985ba4bc8f6221e1a212dc5dda29fe5ba3103ab5ea873f9b18d7adf0bbb1e2ca147f3a16baf5fb46fa4d9c11dbc6141c15668ad8b55f08aed450b40a37b6ead504b3714c1392ad1c029c713308e79105ed95adcdbe6412d4e775ac345eb5c189da140141cf4902ff3939a4cf7b3a8b5e388b1e1b323d374c3d91629c945f389045191ea3c3ca51a38b85482534f724aa3997ac9cbb9df3a94a8a93027fae232dc67d54141d40ddc2ed18a5e02a350d14bc938b360bb22c6fac12b23ebebbed9fa27edc8a1f8d1ca908830d0a98fc37b9c873028798cffec6f5e5bd2fb7a490f0042361f2b1cda23abe14a91fdabf599b98421cbb9b2f8449b4b701f41081aa1b3f5abdb1a8abfb91e5329b4fe56769f376a14030d8c1fb429527b5d08d59fa1a64cff1ccb4811fb1e625213b933ca37d829a192785872668adef997317e5f96d431e2809c0b255df583c316a67a693396f62719bd9538eb0ae15138bee54d5d36751ca2d6b0da42d3ca719ededb98f3f0bedeb5ccaf808037627d38b29dafc521174ae06f307c5af2d29ff84d0614902b54d5a2c8478c47ef5413963dfcfe2ff8dbab4cf149aa21d067fe6607fa420339bb56f4332b1bb719d5b77442b202ef14e6aa6e794172f188c7d1c21c09dfeb97de81c0c6c0ddfd76b6b41abdb6b28638b38af19c2fac88ad38b07c0b5994e3662f9364e36b55e375334184ea25d406730dae049af9750b75206b006a9b3b34843a2b6403749096bbb9698e35a6bf4e2a1812d5a52b469a0155db938f19d5b17f3196d1edb142dea4c45f436531cb982d57a19358a3dbed1f8f69b2869ab12a3dda04a2f0187e101e12c2a68053884c0531c6b3d94644ea9affd966781b0790d63c2b708bc3a4c96989e5adebb63ad95c45e41ec31318cdf3ab854950be418ff68ce0a0c18512233d2c96f440b70eeadad9915b04ffea1b80323d3f1c1cd9cda1d1b621ea5befe6a440492a55bcf72b1c4e58c692d7229bb1cec2462f3ca69972586e2ece33027ee8b94ed32913a154209bdb894f9eb809139cdb7759880129a90138de4d62bdd4299694fa4963cc4c5e07b2ed217e7af5135eda09d9119596af87b6cf51f9de146e5866650c6754502ea32df9bb8dea864fbdc016d9dc02d27935f7d6e76687dd341dd3cdef40940b10a9965bae9f759d815e37761c9cac8cfb6bbb9be307c376e9ae80b044178537e2822ac69832b66ea5475354dbec6f8ac41e6534c0aaa7772408872418122b137eff0d47c609aef29b27ae0cc301dce207b362b9d9c1eb51ebfe3d67d1dba7af89cae2cf5058e63f26d9f195e77b62d023f338abb80940c6bef1add0b14473cff0eda5cdb884e9dfe8f61aedef107c62ac9b91f6abfb7e7c344f54d381be0339227819c2858e4b9cf68245884a9e5e060d23f4a5c3f04820db5c2bed928e277ed04fac03aea1d7ff9156236c7b16e4bf9e788e4c1e7211f5595d1c26158af4c88cd26c7fc728062238ed1c67b6422623ecf91792dc7648ea03f144ec26fe8eef4aac7ad54d65ffc6dbb88e258ff7bdf500657e7d905aa0461e4ce8990931ae4c72b21ea3f1625a67e8da783b69c19c8aed5d17133c53db309b35e0fffeae53e202f24f6109a4242cf15fe0d5aca3cdf612d2efa4bb7cb89e2147b4fdbd43b87fc442692ac08f2e9b116436205ab04758572d30b03afb95e6a2de5c027b49c1ec8aa6db9c848069265403a1ad054a35ea9706c35c6a038c9fad5ce689cf7d8ebfc004d84577de9fb139386a37859b43345839c5bfa671f8a0c804f004417983c56fab65bcce5233761e1db821a00a0ec2cbc241301f7dc6324adfc192b57f73c8bd574b63ac3a10612c33a7a52efeca2f59ef5e586ad424211b77c001c9c1ad543e41ef1c7fb2c085b48169a35298c3394c3b1cbe6ecf66a93c8c76b89795bee1eba2d357347e400062cf22e3d087ba5b03cad2ef1b4d5ddb07d701fdebfdf68d238f721b5b08bb5610e1c2a7fe4d7cd66e15bfbe8c01c78cc3a28ef3e530fd561aaba2ecdc6c4961a4ec4bd13b6e06f089de51ed7da5906d4406c9ea15f8e0e6a4d1385d4919ab9ab03fcaddfdb7678186478e5d07331a61df5980cf0f608b8353579d51bc577b059e158233da5714e282fd60172285570c73e4428e2c200b12c8083b1ccddb023bc2f013c3ed06398fa0686297cfd11c830fd4f8ecc478df7f5d328142d82a5b80422da4208122b02ec2f776887ad5b1fd49acad0168207228109b3d083c495ebc51f6fe0ae7f8b72b7af27ad9a39ce150e93c0e8af0ea6040f6f47e7431e25ada39ebfab389d614589e7a0228f60855836fa510b0e5b3b5066914965dd11bd9462dbc941b79cca483bbfe656f71c08fc3224fcda9fb456eec024341d3857989986d6e92433083844268e6b3de3207ab87b9b2e6607d7906e9e89ffd1064121e459a797340b67f9f6f0244910c41dc173ced5f9ffa4fc2583e96596558f4c05a5863f3b75fe4e29a7fefc7150e24cac2b71bc618c08752f93cefed7b8b4e91c7aff52bf1ba55e2604d28ad9ca0a89e5dec9178a43579af7d55dce913e30d112247bd67fddc2b0428f510cadadfaf7a6ae280134df1fb9eb5ca12c1122bc9c9e48024d952344b0c9eb6ebefed356dd422fdbd2bb3f2ffd8d924093f070a6a8dc6dbfda8a56db3a68f051f282c787d08adedaf409a3e648f42aaaee9859eb123afdff9b4e65b92fad98417fd00b52045df424f7a26389572f658c24bd58ef241b3aa504853e0ff396212a8fa573f2645914d8fcf88e5afd0731645fc6fe9be8fb555d51fbe1b9d1e400b3aeb34f3962488b0d3e90792a58d42d159e91c3f8edfaab033cec36c583a0b7135e4794e06b6ebbc9258dc328cd912f4999d4aca16ab254127677e8057e536136435e50201fff4bbf2a3a3f2a77d1730d961c8b2be644d99703c187c4b87f5def534397398fdf6d6de8aa12cba466c68f00e95d7fd2c498e5b2ee6986d776c0013c5f27506c5c9933e8376b2de0d36dd0bf8088d0ec0978c4a8fd73c9c093d4dcd81e73362037b77f944f28c6feacd71cf461f81d1b36c78d1bef0715cb4c8d2d21226a1db76ab6df73d76644dc98798a766a8f663148748962d3945f9e7ca04e2a73fd25c64c364daaa2fe2beb09b9f7214570eb20183103cf5b82d22bda034c2892dc2d25ead01d577ad94ccd02f77d085817b949b74a5783641016e0f59fd58e7e2e8a92336f42a2edbfefe5733157a3f6537eb9e9f09586418273047312cb66a479df241e53b0ed6fedcd89e28bccd3bca90c634390e2289bc3ca9768cc5c708df1d75c348b3d6553878a3f6bfe472161fd10e4b20e7c8b38afca79268ef6c9df853b72ead87d574ca4c4e8071dc868419f93b95f55e33e04b15d8fb1f625f4a67e708c2306c0b00fdddfe46419c10654a8a3738138abb67e2e32769fde5650cdd75dc55e5018987bb683a342dceca6a6e452d52a6f9778446f27cab8305ee212b779dbec79e87dbe52680349150b80f731b86588dc9d55bbd0e0e5509b3f4ff03e2a56526c726f81446c5d1420d562fdaa4ded0a91b813c42f4c7b1d0f43de5631377e5e4f9ff81ae28ba805b0cbc4ef99adc2bffd43918e680a818b70dfee8de2df16e89f57ec519c8cc27031f52458b7c1581c5320efc8d42ad3b29eddfba5e3987c9e1c1ff15cd439efc137a8a80ac9908ecf7c9395f746e82261fdb771454a1cc34092f0e14706fb5c270728dd3a8f157d07f7afe0d8d7432ff75db8e90360f2ffcf5b8ff9acd14ae2d32775ff866468f66da3f54c2887d14d51ca8a0cb50777a9cc0efd2b99b409dc36c3b08aaf9103f2c985c136bd99cded9a19e82621bd2fcb0898f68c183df2fc3c34ccda6bef21fa91441ba7bc7e2e283fd4817e24e30d0cde31fd33fb882262d3d36ac74c6c83e6324ad1e67f203cd83a6d310ac6738f864bf26a9dd462ef7f026225e8177f560fcdacb512ee82eb5353d1dd5aa75aef11fca569326594e2cca3330f01b4853a5eb612c99021155eb94be6a132ede4ccc6fc3806460ee717473947c950f6279425dec82369d852f30c06d3043c6651446c5ce5f5314c43259276d383ae100e5f0901f12a6cc622839a3858a9b113981f194175566041bc022a0445033c52aecec4bb0b11e43b35ad191e26c2188120771721b04c67767cab2f4d5282d32ea34efa35e61a0defb8917bbdf03de9ce3716b00705c1b3429b83d3d74ab72826d03c93dc276f9fae0a540c1bf34ad4f6d4c314d10d1d40ab0757f9534f6f7f1e981b78b409f596ffb295ea2943297dd3bdd50100a03d14869c6e2fb37f9296b73d49709477278e83b119bbc0bdbcca154dbd847ffd4cb13db7d4e0c55e3880a0a7be33d08e3981666647d5c9623474cb1b268355a4278a0ea8967702fd48a620f92ec7f52226b5c9744cf47bef6a0940ec0b91d4fe2062eb41d500f69264c1959fc8f8df49c76ad2fb8db3b9dd7fe1b56af67241b0557a983113ba94314b2f9a4d2a2519a43df37e4c3e6e34b7f216bccd82608ad917760aff2b90d5b46ca73081c8de4c45981258bd9f510223ac8f917261fe79f89c71a981a013b085fd255338e614e69a31f1509872850b494713356e259f8f9034550a2206b5d1ac814071158152e00891212259a3dc9fbe4461825a8b727ae109da62fa653cf9d5533d4c06217e134c5a4d7a60169e6f1d446ba0dc7755438e16ed420a89b84bf79d8f74a342375cad1af0c371e61ecec16cee9c873a2876a0a7cdae0bf3987283e62c59a84005b527c7075491beedd9fa8c0433b4d1bea456a15f66f1a9f9744b324f8b9e111cb23427a943b43c21e5dd191cad068de09a45265264971a5fb62d501b8eb54b4f516b86cf30ff596666031047c7293883eaf40d9cb8598969b5f9119b8a31dd19c0132731ab8b381fa27f4ff70788293cac0dc4b6e73aadc1b41b7983dbdda557c57ddf95996eb9ab9ac24998cf46874e564f7471d91789ec737f3c37186c2c4b1e7665a3ba1caae29fdfedcced40e41efe32c9fb65d730f00df6404c58192a7fd335fc75eeb06f0f029bcffee3758b7969d512ee5ca02e57ecf27c7f840bec56fc57480d4a185a4ebb1e2cb494705f90ff187852b3fb18b1f951584d25cca601cd97a6b7c0b92b031c794110d5fba64447b6bd73b21fa3ef76298089bf6b33b72636b2c4497e3e53412a71b772c73a8fcca20ae133b69fdb1519148d18762ba8c84e7c8ff62432a30aed8d9ea728d67e528c3a2a0b8567307fd6e3cb38e0c42cb003c24f6dd69eccf213077dd2ced4f41c9c364ecb9411809b158e4658865f4c464acd07eafc51a30ffcdd74e0a6b3603151dbef38e7967847f64658a9d3d848d09a0ad1bf5ef0fec9d1b53c679e747623c92550dbfbf2a3378f8c15f518ffc63be63c57e39330c9651393b37fe3bb9ab220b7e27ac5fe9cae324f4ed11e9ccb84eea188719d74aafebf1dcc71d080b3184b532ae0b709e493d7c34cfb1dc48ebd8b06e1d1ef398173a408fe0c654b16fbe7bb4d446722125c7ab0e20581b51d24e646e6a8122204cffdc6c594622372afe15a6495e80cc67b3e0775f740dea70f42116c25b18ee5c3b02f2fed7a6c65a00e1e47afc063f94cb8dbb07df863371928c75521ebe7f4f5284098c4e239669e06d2de468263360c64b1493239785c045a916469ed49a2f9a2afccfaf7c7274a0daf31bbbc83edabcb9738fd186589f67b2e6fd2395910a1fb0e106254457582acbcecfdf273bf020602e35d878a624fe912658c6a0201663b0849e013dbb7a63c419d005399f9069581c0c9fcbb1965dcd21961a2ce34b7c9b336122d1d670e31a9891dd37313ec1288195c868cc2cc23c5cff8009cba49aa595e277ad58cc7a39cdcd00f74d0cbddf0e056027cf66288f7c87a2a914360ff615ad2323e82b6e8fd78bf315a49fcd116c972bf06456f9aec03c11165d05c4da7b807cb44a593cb5ba7137cea3cab52709e5f4ceafc9533918a2d06241c6bda5b9433b40e50a157229737ed7057a71675716d94db545728ccad9f5181d5b580f00b8fa669c859728364a2b7bd12dc1eef793aa32260f692fd66b030bdb824e62265f1c8508dc5ab98f93f17fe0344fd81a00242f54c461f0017bcd31f00818444412c925af017a799782609817b7664ce5198f3365ade25ae5294527a9893823910a673ecd19c1fb000ca609b24c12c57257f217c1d6e6dab585101575b9dd6c024ebf8c4911910d00229fd2724fcb99e0d8538a5eea2659b0b03fbb8e3803d40abebbe23e648a46ce3cf45586143366201bb134681ebe8c5bb22a0f561053879e91dd2b5b83535971d009df4002a0131761c79fc35bb918f6675c553dcf08ddff26defd43f9b5ff8809170d458f036cf9fdb9cb69fead895a362f661b29359be1b2d878e585b534ba6605b288b06c79ddaf190442302cc5d08124f5ba2d82050175abbff36684dcae99e7ceb9e9503f30dd496fd6445b100bbc4e3fd426f40b1ccf29fc87eacf319c6a50388c7addb4d1d196bccb8a14c636dbcc9de6aaf230293e7e0bbcdac339d8790f4895b2d974afde165634d54c672943b4f945bbe2651127cfd3bf221fc064286507829435bb64cb6b1e9044c3d11b03342a8984ea3a5e8c0e52660d0f70a0f014463d4903a01d8f52f0928ad46d47c5876200dca96984f1809ce8b948bf3a1b1a39bb57e8d6d3fe381524c1fb818866e91343ee03c609e6395ebc476e9b5392aa38ea22cd12ab60afbecccca24164e135a1ddae8222a30dbcd542ff0da890abc3e87bae4af70201ac121d9a1080b8b1385e46e5ae8dc5560a7d1ea7c1cd9725c1882362b696f47976a0ff8de440145ab48e1fa20483826607076d97a7edd2339b7dc0405efca13c4084f3dc085c408dd1aac55a991f31aad801cea6995d182839dbfdabf070a20b0980e9c9a852cc0497a8077b4782456746b24e296a70cd045e3146276c85cb2fa7b7dec8fcce4a63b1a22a6143283558650707a98b08910e487317bd2b2c76e3c201de67607a6a17a43d8a9ad42f5c8ce01a73126a81031c757e5d05689be42402df87f6369303df60b41b23fffe6ee1b5c138a242a09c91f653e915d0af8cfa0b773964abce025458636c885b4e5c853598520e61c750e2897eae5a94217918f24efb161ce01c110efbae259f276ba63db13ca8523d39d083693de4d21cadf83e72a60a7356d006b3d2eb744b2282c95e2e77a4a7f9d32d49ea2860b66402bf36934eb54d2e475def6a9acddc43f1ab7f1ee72857652e0848302dbcee7fe3eeb99aad63b288439707b403f2e0dcf1aad02219e537a35ae5bf33225d11eef776f3f19ca17ac14dc027dabf7599baf2d640b2b275ae704d5e3d754e8e9c4857ab82bd25f8351ca20716b38c13f6bc438a99ad11acdaf3daecfa4ae771bc015efc9e6235009d6b923bc1166199dbddaab298578a9fd37289bed3658987b385764b4216e068cb7091f97be5e134bec1d35eaf11d444817c609937154d254c95b91ce0fc2550eff49339418f844f0e6388aaf9a5e540df9ef6a1c0a75c9bd7b1ec439bcd840a7ddb5841e19d6765f10498a8c8a5a4033e2e5bae4a8d22fd1fdfdb6ba78fd3d3ce6ace8f2d984cd6966f021d56874380800adef61d6fc55c58038a17f47d6f43cde4a539971439730e53ac27c268691ac26124c45b651bc7aa403e6f4672aaba59d62b89f9214e72807668aab93e449d08e98677f35ae36da2444da5d1c51c2dea21fa6bb0c686377dc948badab3db8e3f1a24658307abd87cfc380096c1c4b13f6b428459174ae813703f646caee2d9787528ef05c41a8db34214f656ce95377885800cea3c9b78df10e0550db636298f3b8b514c5053dddb844e94cd7b1ee5fc6aa1dd0b04df6f25fda82d3a4335b7aa829360e55dc838793dec0f0d268edef6f4956c7386dabdb52250ac0212d54c540fe77cf8270b82fb0a3f85bb936bf58274020cd3a6b2624546daea851f2286fb63f606d2cf6b1204001a400c271a0d569f4238e504d8102ec5ac4da3abbb8dc70efbaf67bfb14cd0353df9f7674c489e369181a5a2dae694ed93b08439324280537f3c6c38757c83b2e737953cc0a9616b8d28eaaa8ccfeea2dd00659d059e847eb5c5339954d35e52742a077de3c346618323d33573cc2f7935384df98ae0921c685c98bc0d1ad1577c835b7ccd0e32758ab11084cb32841846116fe857ac268ad1fd775fa693f55806df52b22c5a06010e1fcf84d448ca11407af4220bb9de1e5b92197fd260087c292e71b82de677d040051a321931ed109ef92ac5215b8b902be4395f072d834c921ef6823aa3a5685ce3773b5dafc560e1b8f56a349b9a9b1d8985f32e5e49487bbf0fe9e12ab859de962a2dd7bc097a506a56d6169240c2e2f9919a909635fe0e37cce2428ca9d0cfce8fc2aa5b9e0dee9375425ba246576d343d7f1e420fdac3f8af99729322d65ddece41ea95a6f9b9ea830ceef9cfa6afcdeaca6b69152933f5b52ed82ed5be393edfde2132af25957e034d3d07c92b3601dbcf9afd82ef6820b01d8ad736ebb2a15e5cd0ee24cb005ce21e9a720d7821539c4209bb29353cd9388923b95f9c26243b773e7d4e3cc270e7dcbc4101b9dc861fca35bb33383a933d72b338ab357f1 è¯·è¾“å…¥å¯†é’¥ğŸ”‘"},{"title":"Nginxå…¥é—¨","path":"/2023/10/12/Nginxå…¥é—¨/","content":"01 nginxç®€ä»‹https://lnmp.org/nginx.htmlhttps://lnmp.org/nginx.html åˆç§° engin xï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ ç‰¹ç‚¹ å†…å­˜å°‘ï¼Œä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–å¼€å‘ å¹¶å‘èƒ½åŠ›å¼ºï¼Œèƒ½ç»å—é«˜è´Ÿè½½è€ƒéªŒ 02 nginxæ¦‚å¿µæ­£å‘å’Œåå‘ä»£ç†æ­£å‘ä»£ç†NginxåŒæ ·å¯ä»¥ç”¨ä½œæ­£å‘ä»£ç†è¿›è¡Œä¸Šç½‘ã€‚æ­£å‘ä»£ç†ï¼š å…¸å‹çš„å°±æ˜¯VPNä¸Šç½‘ï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨ åå‘ä»£ç†å®¢æˆ·ç«¯å¯¹ä»£ç†æ— æ„ŸçŸ¥ï¼Œå®¢æˆ·ç«¯æ— éœ€åšä»»ä½•é…ç½®ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš´éœ²ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œéšè—ç›®æ ‡æœåŠ¡å™¨åœ°å€ è´Ÿè½½å‡è¡¡å•ä¸ªæœåŠ¡å™¨æ€§èƒ½ä½ï¼Œå¯ä»¥å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚ åŠ¨é™åˆ†ç¦»ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨è§£æã€‚ 03 nginxçš„å®‰è£…å’Œä½¿ç”¨3.1 nginxçš„å®‰è£…Nginxå…¨éƒ¨å®‰è£…æ­¥éª¤https://blog.csdn.net/weixin_37056888/article/details/107326131 XShellå®‰è£…https://baijiahao.baidu.com/s?id=1747920954538162924&wfr=spider&for=pc SHHæœåŠ¡å™¨æ‹’ç»å¯†ç è§£å†³æ–¹æ³•https://huaweicloud.csdn.net/63561cd9d3efff3090b5abe7.html?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Eactivity-1-124917457-blog-128695452.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Eactivity-1-124917457-blog-128695452.pc_relevant_aa&utm_relevant_index=1 error: You need a C++ compiler for C++ support.è§£å†³æ–¹æ³•https://blog.csdn.net/qq_17496365/article/details/97019490 pcre-8.37 make installæŠ¥é”™https://blog.csdn.net/weixin_37056888/article/details/107326131 ubuntuå®‰è£…zlibæ–¹æ³•https://blog.csdn.net/wu_cai_/article/details/80278611?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-80278611-blog-124211318.pc_relevant_multi_platform_whitelistv3&spm=1001.2101.3001.4242.1&utm_relevant_index=3 nginx makeæŠ¥é”™https://blog.csdn.net/weixin_46273997/article/details/115550134?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-115550134-blog-121437087.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-115550134-blog-121437087.pc_relevant_recovery_v2&utm_relevant_index=1 æ°¸ä¹…ä¿å­˜ä¿®æ”¹è¿‡è§„åˆ™çš„æ›´æ”¹http://www.manongjc.com/detail/25-zqxeremurgqyisq.html 3.2 nginxå¸¸ç”¨å‘½ä»¤å‰ææ¡ä»¶ï¼š å¿…é¡»è¦è¿›å…¥nginxç›®å½•ã€‚å…·ä½“ç›®å½•ä½ç½®ï¼š usrlocalnginxsbin å‘½ä»¤ï¼š æŸ¥çœ‹ç‰ˆæœ¬å·.nginx -v æŸ¥çœ‹è¿›ç¨‹ps -ef | grep nginx å¯åŠ¨nginx.nginx å…³é—­nginx.nginx -s stop é‡æ–°åŠ è½½nginxï¼ˆç‰¹åˆ«æ˜¯ä¿®æ”¹nginx.confä¹‹åï¼‰.nginx -s reload 3.3 nginxé…ç½®æ–‡ä»¶é…ç½®æ–‡ä»¶ä½ç½®ï¼š usrlocalnginxconfnginx.conf usrlocalnginxconfnginx.conf #user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events worker_connections 1024;http include mime.types; default_type application/octet-stream; #log_format main $remote_addr - $remote_user [$time_local] $request # $status $body_bytes_sent $http_referer # $http_user_agent $http_x_forwarded_for; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server # listen 80; listen 8080; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / root html; index index.html index.htm; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html root html; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ # proxy_pass http://127.0.0.1; # # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; # # deny access to .htaccess files, if Apaches document root # concurs with nginxs one # #location ~ /\\.ht # deny all; # # another virtual host using mix of IP-, name-, and port-based configuration # #server # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / # root html; # index index.html index.htm; # # # HTTPS server # #server # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / # root html; # index index.html index.htm; # # å…¨å±€å—eventså—httpå—ä»å¼€å§‹åˆ°eventså—ä¹‹é—´çš„å†…å®¹ï¼Œå½±å“nginxæœåŠ¡å™¨çš„æ•´ä½“è¿è¡Œ #user nobody;worker_processes 1; # è¡¨ç¤ºnginxæœåŠ¡å™¨å¹¶å‘å¤„ç†çš„æ•°é‡ï¼Œè¶Šå¤§è¡¨ç¤ºå¤„ç†å¹¶å‘é‡è¶Šå¤š#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;å½±å“NginxæœåŠ¡å™¨ä¸ç”¨æˆ·ç½‘ç»œçš„è¿æ¥ events worker_connections 1024; # æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°nginxæœåŠ¡å™¨ä¸­é…ç½®æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—éƒ½åœ¨è¿™ï¼Œhttpå—åŒ…æ‹¬ï¼š httpå…¨å±€å— åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPEå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ serverå— å’Œè™šæ‹Ÿä¸»æœºæœ‰å¯†åˆ‡å…³ç³» åˆåŒ…æ‹¬å…¨å±€serverå’Œlocation http include mime.types; default_type application/octet-stream; #log_format main $remote_addr - $remote_user [$time_local] $request # $status $body_bytes_sent $http_referer # $http_user_agent $http_x_forwarded_for; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server # listen 80; listen 8080; # ç«¯å£å· server_name localhost; # ä¸»æœºå· #charset koi8-r; #access_log logs/host.access.log main; location / root html; index index.html index.htm; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html root html; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ # proxy_pass http://127.0.0.1; # # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; # # deny access to .htaccess files, if Apaches document root # concurs with nginxs one # #location ~ /\\.ht # deny all; # # another virtual host using mix of IP-, name-, and port-based configuration # #server # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / # root html; # index index.html index.htm; # # # HTTPS server # #server # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / # root html; # index index.html index.htm; # # 04 nginxé…ç½®å®ä¾‹4.1 åå‘ä»£ç†åå‘ä»£ç†é…ç½®å…¨è¿‡ç¨‹https://blog.csdn.net/XJ0927/article/details/109501032 rzä¼ è¾“é”™è¯¯é—®é¢˜è§£å†³æ–¹æ¡ˆhttps://blog.csdn.net/qq_40443457/article/details/86595668?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-86595668-blog-128444598.pc_relevant_recovery_v2&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-86595668-blog-128444598.pc_relevant_recovery_v2&utm_relevant_index=2 linuxä¸­é…ç½®javahttps://zhuanlan.zhihu.com/p/492149414 linuxä¸­é…ç½®tomcathttps://baijiahao.baidu.com/s?id=1752814258019071848&wfr=spider&for=pc 4.2 è´Ÿè½½å‡è¡¡è´Ÿè½½å‡è¡¡å…¨æ¡ˆä¾‹https://blog.csdn.net/XJ0927/article/details/109501188 4.3 åŠ¨é™åˆ†ç¦»05 nginxåŸç†","tags":["DevOps"]},{"title":"Reactç¬”è®°","path":"/2023/07/27/ReactNotes/","content":"ç¬¬ä¸€æ¬¡å­¦ä¹ ï¼ˆå¤±è´¥ï¼‰ï¼šæŒ–å‘ç³»åˆ—Reactç®€ä»‹Reactä¸­æ–‡å®˜ç½‘https://zh-hans.react.dev/ Reactå®˜ç½‘https://react.dev/ Reactæ˜¯ä»€ä¹ˆï¼Ÿ ä¸€ä¸ªç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„JavaScriptåº“ã€‚å¼ºè°ƒå°†æ•°æ®æ¸²æŸ“ä¸ºHTMLè§†å›¾ Reactç”±è°å¼€å‘çš„ï¼Ÿ Metaï¼ˆFacebookï¼‰ åŸç”ŸJSçš„é—®é¢˜ DOM-APIæ“ä½œUIæ•ˆç‡ä½ JSç›´æ¥æ“ä½œDOMä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡é‡ç»˜é‡æ’æ“ä½œ åŸç”ŸJSä»£ç å¤ç”¨ç‡ä½ Reactçš„ç‰¹ç‚¹ å£°æ˜å¼ç¼–ç ï¼Œç»„ä»¶åŒ–æ¨¡å¼ å‘½ä»¤å¼ç¼–ç ï¼š ä½ å…ˆåç”µæ¢¯ä¸‹æ¥¼å·¦è½¬ï¼Œèµ°åˆ°è‡ªåŠ¨è´©å–æœºå‰ï¼Œä¹°ä¸€æ¯æ°´ï¼ŒæŒ‰åŸè·¯è¿”å›ç»™æˆ‘ å£°æ˜å¼ç¼–ç¨‹ï¼š æˆ‘æ¸´äº† React Nativeæ”¯æŒç§»åŠ¨ç«¯å¼€å‘ è™šæ‹ŸDOM+Diffingç®—æ³•ï¼Œå‡å°‘ä¸DOMçš„äº¤äº’ï¼Œæ€§èƒ½å¥½ Reactå…¥é—¨Hello React éœ€è¦å¼•å…¥ä¾èµ–ï¼š babel.js ES6 â†’ ES5 jsx â†’ js react.js reactæ ¸å¿ƒåº“ react-dom.js reactæ‰©å±•åº“ï¼ˆdomæ“ä½œï¼‰ prop-types.js hello_react.html htmlä¾èµ–å¼•å…¥jsdiv id=test/divä¾èµ–çš„å¼•å…¥éœ€è¦æŒ‰ç…§ä¸€å®šé¡ºåºï¼š!--å¼•å…¥reactæ ¸å¿ƒåº“ --script src=../React-js/react.development.js/script!-- å¼•å…¥reactæ“ä½œdomçš„æ‰©å±•åº“ --script src=../React-js/react-dom.development.js/script!-- å¼•å…¥babel --script src=../React-js/babel.min.js/scriptscriptæ ‡ç­¾çš„srcä¸€å®šè¦æ˜¯textbabelscript type=text/babel // srcä¸€å®šè¦ä¸ºtext/babel // 1. åˆ›å»ºè™šæ‹ŸDOM const VDOM = h1Hello React/h1 // 2. æ¸²æŸ“è™šæ‹ŸDOMåˆ°é¡µé¢ // ReactDOM.render(è™šæ‹ŸDOMï¼Œå®¹å™¨) ReactDOM.render(VDOM,document.getElementById(test))/script JSXjsxä¸jsçš„å¯¹æ¯” jsxèƒ½å¤Ÿç®€åŒ–jsçš„domæ“ä½œä½†ç®€åŒ–æ“ä½œåªé’ˆå¯¹ç¼–ç è€…è€Œè¨€ï¼Œå®é™…ç”±babelç¼–è¯‘åçš„jsxä¾æ—§æ˜¯æŒ‰éƒ¨å°±ç­çš„åœ¨æ“ä½œdom jsx script type=text/babel let VDOM = ( h1 spanHello World/span /h1 ) ReactDOM.render(VDOM,document.getElementById(test))/script js script const VDOM = React.createElement( h1, // æ ‡ç­¾å id:title, // æ ‡ç­¾å±æ€§ React.createElement(span,,Hello World) //æ ‡ç­¾å†…å®¹ ) ReactDOM.render(VDOM,document.getElementById(test))/script è™šæ‹ŸDOMä¸çœŸå®DOMå¯¹æ¯” çœŸå®DOMdiv id=test h1 spanHello World/span /h1/div è™šæ‹ŸDOMObjectå¯¹è±¡æŒ‚è½½çš„å±æ€§æ•°é‡è¾ƒå°‘ type: h1, key: null, ref: null, props: children: type: span, key: null, ref: null, props: children: Hello World , _owner: null, _store: , _owner: null, _store: JSXè¯­æ³•è§„åˆ™ æ ‡ç­¾ä¸­æ··å…¥jsè¡¨è¾¾å¼æ—¶ä½¿ç”¨ èŠ±æ‹¬å·{} åŒ…è£¹let name = Johnlet VDOM = h1name/h1ç±»åæŒ‡å®šä½¿ç”¨classNameä¹‹æ‰€ä»¥é¿å¼€classï¼Œæ˜¯ç”±äºclassä¸ES6ç±»å®šä¹‰çš„å…³é”®å­—æœ‰å†²çªlet VDOM = h1 className=titleHello/h1å†…è”æ ·å¼éœ€è¦æ³¨æ„ä»¥ä¸‹è¦ç‚¹ï¼šstyle {{æ ·å¼å†…å®¹éœ€è¦ä½¿ç”¨åŒæ‹¬å·åŒ…è£¹}}æ ·å¼çš„èµ‹å€¼é‡‡ç”¨é”®å€¼å¯¹æ ¼å¼æ ·å¼å€¼é‡‡ç”¨å­—ç¬¦ä¸²æ ¼å¼æ ·å¼åé‡‡ç”¨é©¼å³°æ ‡è¯†let VDOM = ( h1 style= color:#fff, border:1px solid #000, fontSize:14px Hello World /h1) jsxå†…çš„éå†æ¡ˆä¾‹ const data = [AAA, BBB, CCC]const VDOM = ( div ul data.map(item = (li key=itemitem/li)) /ul /div)ReactDOM.render(VDOM, document.getElementById(test)) Reactç»„ä»¶React Developer Toolshttps://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi ç»„ä»¶å®šä¹‰Reactæä¾›ä¸¤ç§å®šä¹‰ç»„ä»¶çš„æ–¹å¼ï¼š å‡½æ•°å¼å®šä¹‰ç»„ä»¶ ç±»å¼å®šä¹‰ç»„ä»¶ å‡½æ•°å¼å®šä¹‰ç±»å¼å®šä¹‰ç»„ä»¶ä½¿ç”¨å‡½æ•°å½¢å¼å®šä¹‰ï¼Œå‡½æ•°åé¦–å­—æ¯ä¸€å®šè¦å¤§å†™ function MyComponent() return h1My Component/h1ReactDOM.render(MyComponent/,document.getElementById(root)) å®šä¹‰ç»„ä»¶çš„å‡½æ•°å†…éƒ¨ï¼ŒthisæŒ‡å‘å“ªé‡Œï¼Ÿ ç­”ï¼š thisæŒ‡å‘undefinedã€‚è¿™æ˜¯å› ä¸ºä»£ç ç»è¿‡babelç¿»è¯‘ä¹‹åï¼Œä¼šè¿›è¡Œä¸¥æ ¼æ¨¡å¼è§„èŒƒï¼š use strict ä¸¥æ ¼æ¨¡å¼ç¦æ­¢è‡ªå®šä¹‰å‡½æ•°çš„thisæŒ‡å‘windowã€‚ç»„ä»¶ç±»ä¸€å®šè¦ç»§æ‰¿React.Componentç±» class MyComponent extends React.Component render() return ( h1Hello MyComponent/h1 ) ReactDOM.render(MyComponent/, document.getElementById(root)) ç±»å®šä¹‰æµç¨‹ æ‰¾åˆ°MyComponentç»„ä»¶ç±»åˆ›å»ºæ–°å®ä¾‹new MyComponent()é€šè¿‡åˆ›å»ºå‡ºæ¥çš„å®ä¾‹è°ƒç”¨åŸå‹çš„renderæ–¹æ³•å°†renderè¿”å›çš„è™šæ‹ŸDOMè½¬ä¸ºçœŸå®DOMå‘ˆç°åœ¨é¡µé¢ä¸Š ç±»ç»„ä»¶ä¸­çš„thisæŒ‡å‘å“ªé‡Œï¼Ÿ ç­”ï¼š ç»„ä»¶ç±»å®ä¾‹ ç»„ä»¶å®ä¾‹ä¸‰å¤§å±æ€§ state props refs statestateä¸­ç”¨äºå­˜æ”¾ç»„ä»¶ä¸­çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ class MyComponent extends React.Component constructor(props) super(props) this.state = // æ„é€ å™¨ä¸­åˆå§‹åŒ–state country: UK, color: #00ffff åœ¨renderä¸­ä½¿ç”¨stateä¸­çš„æ•°æ®ï¼Œæ³¨æ„ï¼š æ¯æ¬¡æ›´æ–°stateæ•°æ®éƒ½ä¼šé‡æ–°è°ƒç”¨ä¸€æ¬¡render render()return( h1 style=color:this.state.color this.state.country === UK?Hello:ã“ã«ã¡ã¯ /h1 ) ç»„ä»¶ä¸­äº‹ä»¶å‡½æ•°çš„å£°æ˜æ–¹å¼ domäº‹ä»¶å¯¹åº”çš„å›è°ƒå‡½æ•°å¹¶éç”±ç»„ä»¶å®ä¾‹è°ƒç”¨ï¼Œå› æ­¤ä¼šå¯¼è‡´å›è°ƒå‡½æ•°ä¸­çš„thiså®é™…ä¸ŠæŒ‡å‘çš„æ˜¯undefinedå› æ­¤éœ€è¦å…ˆä¸€æ­¥æŒ‡å®šäº‹ä»¶è§¦å‘çš„å›è°ƒæ–¹æ³•çš„ä¸Šä¸‹æ–‡class MyComponent extends React.Component constructor(props) super(props) this.state = country:UK, color:#00ffff // bindæŒ‡å®šä¸Šä¸‹æ–‡ this.sayHello = this.sayHello.bind(this) render() return( h1 style=color:this.state.color onClick=this.sayHello this.state.country === UK?Hello:ã“ã«ã¡ã¯ /h1 ) sayHello() if(this.state.country == UK) this.state.country = Japan else this.state.country = UK this.setState( country:this.state.country ) stateè¯­æ³•ç³– class MyComponent extends React.Component state = // ç±»ä¸­ç›´æ¥å®šä¹‰state country:UK, color:#00ffff sayHello = ()= //ç±»ä¸­å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°ä¸€å®šè¦ç”¨ç®­å¤´å‡½æ•° if(this.state.country == UK) this.state.country = Japan else this.state.country = UK this.setState( country:this.state.country ) render() return( h1 style=color:this.state.color onClick=this.sayHello this.state.country === UK?Hello:ã“ã«ã¡ã¯ /h1 ) ReactDOM.render(MyComponent/,document.getElementById(root)) props propsç”¨äºå­˜æ”¾éœ€ç”±å¤–ç•Œä¼ å…¥ç»„ä»¶çš„åŠ¨æ€æ•°æ® åŸºæœ¬ç”¨æ³• const sayHello = ()=console.log(sayHello)class Person extends React.Component render() return ( ul li onClick=this.props.sayHelloNameï¼šthis.props.name/li liAgeï¼šthis.props.age+1/li liSexï¼šthis.props.sex/li /ul ) React.render( // é€šè¿‡æ ‡ç­¾çš„å±æ€§å®ç°propså€¼çš„ä¼ å…¥ Person name=aaa age=19 sayHello=sayHello/, document.getElementById(root))ä¼ å…¥ç»„ä»¶çš„å‚æ•°è¿˜å¯ä»¥é€šè¿‡è§£æ„èµ‹å€¼å®ç°æ›´ç®€æ´çš„å†™æ³•let p = name:bbb, age:20, sex:maleReact.render( // æ­¤å¤„ä½¿ç”¨è§£æ„è¯­æ³• Person ...p/, document.getElementById(root))babelåœ¨å¯¹JSXåšè½¬æ¢çš„æ—¶å€™ä¼šå¯¹ä¸‹é¢è¿™ç§è¯­æ³•åšç‰¹æ®Šå¤„ç†ï¼šComponent ...obj/å®é™…ä¸Šå°±ç›¸å½“äºå°†objçš„é”®å€¼å¯¹ä½œä¸ºComponentç»„ä»¶çš„å±æ€§å€¼ propsé™åˆ¶ PropTypeså®˜æ–¹æ–‡æ¡£https://legacy.reactjs.org/docs/typechecking-with-proptypes.htmléœ€è¦å¼•å…¥prop-types.jsç±»å‹æ£€éªŒåº“Person.propTypes = name:PropTypes.string.isRequired, age:PropTypes.number, sex:PropTypes.string, sayHello:PropTypes.funcç±»å‹æ£€éªŒéœ€è¦æ”¾åœ¨ç»„ä»¶ç±»çš„propTypeså±æ€§ä¸­ï¼šPerson.propTypes = // ç±»å‹é™åˆ¶ç±»å‹é…ç½®ä¹‹å‰éœ€è¦åŠ ä¸ŠPropTypesç±»çš„å¼•ç”¨ï¼š age:PropTypes.numberå¤šä¸ªé™åˆ¶ä½¿ç”¨é“¾å¼å£°æ˜ï¼š name:PropTypes.string.isRequired // å¿…é¡»å­—ç¬¦ä¸²æ•°æ®ç±»å‹æ ‡å¿—ä¸å…³é”®å­—çš„å†²çªé¿å…ï¼šä¸ºé˜²æ­¢å…³é”®å­—ä¸æ•°æ®ç±»å‹çš„å†²çªï¼Œå°†ç±»å‹é¦–å­—æ¯å°å†™å¤„ç†ï¼šPropTypes.numberPropTypes.stringPropTypes.boolPropTypes.objectPropTypes.arrayfunctionç”±äºæ˜¯å…³é”®å­—ï¼Œå› æ­¤ç®€å†™å¤„ç†ï¼šPropTypes.func sayHello:PropTypes.funcå®šä¹‰å±æ€§é»˜è®¤å€¼ä½¿ç”¨ç»„ä»¶ç±»çš„defaultPropså±æ€§å®šä¹‰é»˜è®¤å€¼ï¼šPerson.defaultProps = sex: female propsè¯­æ³•ç³– æ³¨æ„ï¼špropsä¸€æ—¦ä¼ å…¥ç±»ç»„ä»¶åå³ä¸ºåªè¯»å±æ€§ï¼Œä¸å¯ä¿®æ”¹propsçš„è¯­æ³•ç³–å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨staticé™æ€å±æ€§ç»™ç±»æœ¬èº«å®šä¹‰å±æ€§class Character extends React.Component static propTypes = name: PropTypes.string.isRequired, age: PropTypes.number, sex: PropTypes.string, makeQitatapu: PropTypes.func static defaultProps = sex: male render() return ( ul li onClick=this.props.makeQitatapuNameï¼šthis.props.name/li liAgeï¼šthis.props.age + 1/li liSexï¼šthis.props.sex/li /ul ) function makeQitatapu() // to doReactDOM.render(Person name=aaa age=19 sayHello=sayHello /, document.getElementById(root)) å‡½æ•°å¼ç»„ä»¶çš„props ç»„ä»¶å‡½æ•°åªèƒ½ç”¨propsï¼Œå¹¶ä¸”propTypeså’ŒdefaultPropsåªèƒ½å®šä¹‰åœ¨å‡½æ•°å¤–ï¼ˆè¿™æ˜¯å› ä¸ºå‡½æ•°å†…çš„thisæŒ‡å‘undefinedï¼‰å‡½æ•°ç»„ä»¶æ— æ³•ä½¿ç”¨stateå’Œrefsfunction MyComponent(props) return ( div h1Hello props.name/h1 h2props.age/h2 /div )MyComponent.propTypes = name: PropTypes.string.isRequired, age: PropTypes.numberMyComponent.defaultProps = age: 20ReactDOM.render(MyComponent name=Jerry /,document.getElementById(root)) refsrefç”¨äºæ ‡è¯†domå®¹å™¨ï¼Œä¸€èˆ¬æœ‰ä¸‰ç§å®šä¹‰å½¢å¼ï¼š å­—ç¬¦ä¸²å½¢å¼ å½±å“æ•ˆç‡ï¼Œä¸æ¨è å†…è”å›è°ƒå‡½æ•°å½¢å¼ å®˜æ–¹æ›´ä¸ºæ¨èçš„æ–¹æ³• ä½†æ˜¯é‡ç»˜æ—¶ä¼šå¯¼è‡´æ¯æ¬¡renderè°ƒç”¨ä¸¤æ¬¡ ç¬¬ä¸€æ¬¡ï¼šä¼ å…¥å‚æ•°null ç¬¬äºŒæ¬¡ï¼šä¼ å…¥å½“å‰domå…ƒç´  ç»‘å®šå›è°ƒå‡½æ•°å½¢å¼ èƒ½å¤Ÿè§£å†³é‡ç»˜å‚æ•°ä¼ å…¥nullçš„é—®é¢˜ createRef å­—ç¬¦ä¸²å½¢å¼çš„ref class MyComponent extends React.Component alertInput = ()= this.alert(this.refs.input.value) render() return( div /* å®šä¹‰å­—ç¬¦ä¸²æ ¼å¼çš„ref */ input ref=input onBlur=this.alertInput/ /div ) å›è°ƒæ ¼å¼çš„ref æœ‰å†…è”å’Œç»‘å®šä¸¤ç§å®šä¹‰æ ¼å¼ï¼šclass MyComponent extends React.Component bindRef = (currentNode)= this.input2Ref = currentNode render() return ( div /% å†…è”æ ·å¼ %/ input ref=currentNode=this.input1Ref = currentNode/ /% ç»‘å®šæ ·å¼ %/ input ref=this.bindRef/ /div ) createRef React.createRefè°ƒç”¨åè¿”å›ä¸€ä¸ªå®¹å™¨ï¼Œå­˜å‚¨è¢«refæ ‡è¯†çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªå®¹å™¨ä¸­åªèƒ½å­˜å‚¨ä¸€ä¸ªdomå…ƒç´ class MyComponent extends React.Component state = value: myRef = React.creaeRef() myRef2 = React.createRef() setValue = ()= this.setState( value:this.myRef.current.value ) render() return( div input ref=myRef onBlur=this.setValue / input ref=myRef2 / h1this.state.value/h1 /div ) å—æ§ä¸éå—æ§ç»„ä»¶ éå—æ§ç»„ä»¶ç»„ä»¶ä¸­çš„æ•°æ®ç°ç”¨ç°å–ï¼Œä¸€èˆ¬éœ€è¦ä¾èµ–refmyRef = React.createRef()state = value:// éå—æ§ç»„ä»¶å€ŸåŠ©refè·å–åˆ°æ•°æ®inputInfo = ()= this.setState( value:this.myRef.current.value )render() return( form input ref=this.myRef type=text/ button onClick=this.inputInfoClick me/button /form ) å—æ§ç»„ä»¶stateä¸­ä¸ç»„ä»¶ç›¸å…³è”çš„æ•°æ®å®æ—¶æ›´æ–°ï¼Œç±»ä¼¼Vueçš„åŒå‘ç»‘å®šç»„ä»¶ï¼Œå—æ§ç»„ä»¶å¯ä»¥å‡å°‘refçš„ä½¿ç”¨state = value:// å—æ§ç»„ä»¶é€šè¿‡åŸç”Ÿäº‹ä»¶ä¸­çš„eventå‚æ•°è·å–ç»„ä»¶çš„çŠ¶æ€å€¼inputInfo = (e)= this.setState( value:e.target.value )render() return( form input ref=this.myRef onChange=this.inputInfo type=text/ /form ) è™šæ‹ŸDOMçš„Diffingç®—æ³•Reactä¸­ä½¿ç”¨keyå±æ€§å¯¹è™šæ‹ŸDOMè¿›è¡Œå”¯ä¸€æ ‡è¯†ï¼Œæ¯æ¬¡è°ƒç”¨renderé‡æ–°æ¸²æŸ“å‰ï¼Œä¼šå°†ç”¨æœ€æ–°æ•°æ®ç”Ÿæˆçš„è™šæ‹Ÿdomå’Œæ—§çš„è™šæ‹Ÿdomè¿›è¡Œæ¯”è¾ƒï¼Œæ¯”è¾ƒæ˜¯å°†keyå€¼ç›¸åŒçš„ä¸¤ä¸ªdomå…ƒç´ æ‹¿æ¥å¯¹æ¯”å…¶ä¸­çš„å†…å®¹ï¼Œå¦‚æœå†…å®¹æ”¹å˜ï¼Œå°±ç”¨æ–°çš„è™šæ‹Ÿdomä»£æ›¿æ—§domï¼Œå› æ­¤ï¼Œdomå…ƒç´ çš„keyå€¼å¿…é¡»å”¯ä¸€å¹¶ä¸”å°½é‡å¯ä»¥ä¿æŒä¸å˜ ä½¿ç”¨å˜åŒ–keyå€¼å’Œä¸å˜keyå€¼æ›´æ–°domæ—¶çš„å¯¹æ¯”ï¼š keyå€¼çš„å”¯ä¸€æ€§ä¼šå†³å®šç»„ä»¶æ›´æ–°çš„domå…ƒç´ æœ‰å“ªäº› å°†keyå€¼å…¨éƒ¨æ›´æ¢ul ref=list inputList.map((item, index)= return li key=indexitem=input type=text//li ) /ul ä½¿ç”¨å”¯ä¸€æ ‡è¯†ä½œä¸ºkeyå€¼ul ref=list inputList.map((item, index)= return li key=itemitem=input type=text//li ) /ul Reactç”Ÿå‘½å‘¨æœŸæ—§ç”Ÿå‘½å‘¨æœŸReactæ—§ç”Ÿå‘½å‘¨æœŸ ç»„ä»¶æŒ‚è½½è§†è§’ ç»„ä»¶åˆå§‹åŒ–constructorç»„ä»¶æŒ‚è½½å‰componentWillMount æ¸²æŸ“ç»„ä»¶render ç»„ä»¶æŒ‚è½½åcomponentDidMount ç»„ä»¶å¸è½½å‰componentWillUnmount çˆ¶ç»„ä»¶æ›´æ–°å­ç»„ä»¶è§†è§’ å­ç»„ä»¶å³å°†è·å–åˆ°propsä¼ å‚componentWillReceivePropsåˆ¤æ–­ç»„ä»¶æ˜¯å¦æ›´æ–°shouldComponentUpdateç»„ä»¶æ›´æ–°ä¹‹å‰componentWillUpdateç»„ä»¶é‡æ¸²æŸ“renderç»„ä»¶æ›´æ–°ä¹‹åcomponentDidUpdateç»„ä»¶å¸è½½ä¹‹å‰componentWillUnmount ä¸¤ç§å¼•å‘ç»„ä»¶æ›´æ–°çš„æ“ä½œ ä¸¤ç§æ“ä½œä¼šå¼•å‘ç»„ä»¶æ›´æ–°ï¼šsetState æ›´æ–°stateforceUpdate å¼ºåˆ¶æ›´æ–° setState åˆ¤æ–­ç»„ä»¶æ˜¯å¦æ›´æ–°shouldComponentUpdateç»„ä»¶æ›´æ–°å‰componentWillUpdateç»„ä»¶é‡æ¸²æŸ“renderç»„ä»¶æ›´æ–°åcomponentDidUpdate forceUpdateç»„ä»¶æ›´æ–°å‰componentWillUpdateç»„ä»¶é‡æ¸²æŸ“renderç»„ä»¶æ›´æ–°åcomponentDidUpdate æ–°ç”Ÿå‘½å‘¨æœŸReactæ–°ç”Ÿå‘½å‘¨æœŸ React17å¼ƒç”¨çš„é’©å­å‡½æ•° ComponentWillMountComponentWillUpdateReact17å¯¹å¼ƒç”¨çš„æ—§é’©å­å‡½æ•°åšäº†å…¼å®¹ï¼Œéœ€è¦åœ¨å‡½æ•°åå‰åŠ ä¸Š UNSAFE_ å‰ç¼€UNSAFE_componentWillMountUNSAFE_componentWillUpdate æ–°æ·»åŠ çš„é’©å­å‡½æ•° getDerivedStateFromPropsgetSnapshotBeforeUpdateä¸‰ç§ä¼šè§¦å‘getDerivedStateFromPropsçš„æ“ä½œï¼šNew props ä¼ å…¥æ–°å‚æ•° setState ä¿®æ”¹çŠ¶æ€forceUpdate å¼ºåˆ¶æ›´æ–°getDerivedStateFromPropsä¸»è¦ç”¨äºå¤„ç†ç»„ä»¶çš„stateä¾èµ–propsçš„æƒ…å†µgetDerivedStateFromPropsstatic getDerivedStateFromProps(nextProps,prevState) return nextStateå°†æ›´æ–°å‰é¡µé¢çš„çŠ¶æ€ä¼ é€’åˆ°æ›´æ–°åçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡ŒgetDerivedStateFromPropsgetSnapshotBeforeUpdate() // è¿”å›å€¼ä¼šä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’åˆ°ComponentDidUpdateå‡½æ•°ä¸­ return snapshotComponentDidUpdate(prevProps,prevState,snapshot) // ç¬¬ä¸‰ä¸ªå‚æ•°æ¥è‡ªgetSnapshotBeforeUpdateçš„è¿”å›å€¼ React17ç”Ÿå‘½å‘¨æœŸ ç»„ä»¶æŒ‚è½½æµç¨‹ç»„ä»¶åˆå§‹åŒ–constructorçŠ¶æ€ç®¡ç†getDerivedStateFromPropsç»„ä»¶æ¸²æŸ“renderç»„ä»¶æŒ‚è½½åcomponentDidMount ç»„ä»¶æ›´æ–°æµç¨‹çŠ¶æ€ç®¡ç†getDerivedStateFromPropsåˆ¤æ–­ç»„ä»¶æ˜¯å¦æ›´æ–°shouldComponentUpdateç»„ä»¶æ¸²æŸ“renderç»„ä»¶å³å°†æ›´æ–°getSnapshotBeforeUpdateç»„ä»¶æŒ‚è½½åcomponentDidMount Reactè„šæ‰‹æ¶create-react-app å…¨å±€å®‰è£…reactè„šæ‰‹æ¶ä¾èµ–åŒ…npm i -g create-react-appä½¿ç”¨è„šæ‰‹æ¶åˆ›å»ºæ–°é¡¹ç›®create-react-app æ–°å»ºé¡¹ç›®åè„šæ‰‹æ¶æ­å»ºé¡¹ç›®çš„ç›®å½•ç»“æ„é»˜è®¤æä¾›å››ä¸ªè¿è¡Œè„šæœ¬ï¼šstart è¿è¡Œé¡¹ç›®ï¼Œé»˜è®¤ç«¯å£3000build é¡¹ç›®æ‰“åŒ…ï¼Œä½¿ç”¨webpacké¡¹ç›®ç®¡ç†å·¥å…·test å‰ç«¯æµ‹è¯•eject å°†éšè—çš„webpacké…ç½®æ–‡ä»¶æš´éœ²å‡ºæ¥ï¼Œæ­¤è¿‡ç¨‹ä¸å¯é€†å¯åŠ¨é¡¹ç›®åçš„åˆå§‹åŒ–ç•Œé¢ publicæ–‡ä»¶å¤¹ publicæ–‡ä»¶å¤¹å­˜æ”¾ä¸€äº›é™æ€æ–‡ä»¶index.htmlmanifest.jsrobots.txt!DOCTYPE htmlhtml lang=en head meta charset=utf-8 / link rel=icon href=%PUBLIC_URL%/favicon.ico / meta name=viewport content=width=device-width, initial-scale=1 / meta name=theme-color content=#000000 / meta name=description content=Web site created using create-react-app / link rel=apple-touch-icon href=%PUBLIC_URL%/logo192.png / link rel=manifest href=%PUBLIC_URL%/manifest.json / titleReact App/title /head body noscriptYou need to enable JavaScript to run this app./noscript div id=root/div /body/htmlç½‘é¡µåšappå¥—å£³æ—¶çš„é…ç½®æ–‡ä»¶ short_name: React App, name: Create React App Sample, icons: [ src: favicon.ico, sizes: 64x64 32x32 24x24 16x16, type: image/x-icon , src: logo192.png, type: image/png, sizes: 192x192 , src: logo512.png, type: image/png, sizes: 512x512 ], start_url: ., display: standalone, theme_color: #000000, background_color: #ffffffç½‘é¡µçˆ¬å–å†…å®¹çš„ç›¸å…³æ–‡ä»¶# https://www.robotstxt.org/robotstxt.htmlUser-agent: *Disallow: srcæ–‡ä»¶å¤¹ srcä¸ºå¼€å‘ä½¿ç”¨åˆ°çš„çš„ä¸»è¦ç›®å½•,åˆå§‹åŒ–çš„srcç›®å½•ç»“æ„å¦‚ä¸‹ï¼šApp.css æ ¹ç»„ä»¶æ ·å¼æ–‡ä»¶App.js æ ¹ç»„ä»¶jsæ–‡ä»¶App.test.js æ ¹ç»„ä»¶æµ‹è¯•æ–‡ä»¶index.css å…¨å±€æ ·å¼index.js é¡¹ç›®å…¥å£jsæ–‡ä»¶reportWebVitals.js ç”¨äºè®°å½•é¡µé¢æ€§èƒ½ï¼Œä¾èµ–web-vitalsåº“setupTests.js æµ‹è¯•æ–‡ä»¶ï¼Œä¾èµ–jest-domåº“index.jsimport React from reactimport ReactDOM from react-dom/clientimport ./index.cssimport App from ./Appimport reportWebVitals from ./reportWebVitals// åˆ›å»ºæ ¹èŠ‚ç‚¹const root = ReactDOM.createRoot(document.getElementById(root))// æ¸²æŸ“æ ¹ç»„ä»¶root.render( // React.StricModeç”¨äºæ£€æŸ¥Appå†…å­ç»„ä»¶æ˜¯å¦åˆç† // å¦‚ å­—ç¬¦ä¸²ç±»å‹ref ç­‰ ç±»ä¼¼Eslint React.StrictMode App / /React.StrictMode)// å¼•å…¥reportWebVitalsæ–‡ä»¶// ä¾èµ–web-vitalsåº“ ç”¨äºè®°å½•é¡µé¢æ€§èƒ½reportWebVitals(); React Ajaxè·¨åŸŸ æœ¬æœº3000ç«¯å£æœåŠ¡éœ€è¦è¯·æ±‚æœ¬æœº5000ç«¯å£æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è¯·æ±‚å—ï¼Ÿaxios.get(http://localhost:5000/simData)ç­”ï¼š ä¸èƒ½ï¼Œå› ä¸ºè·¨åŸŸï¼Œåˆ°åº•æ˜¯åœ¨å“ªä¸€æ­¥è·¨åŸŸå¤±è´¥å‘¢ï¼Ÿè·¨åŸŸå‘é€è¯·æ±‚ âˆš è·¨åŸŸè¿”å›æ•°æ® Ã— è·¨åŸŸçš„è§£å†³ è§£å†³æ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨3000ï¼ˆClientï¼‰ å’Œ 5000ï¼ˆServerï¼‰ ä¹‹é—´ï¼Œå†é…ç½®ä¸€å°ä»£ç†æœåŠ¡å™¨ï¼ˆåŒæ ·åœ¨3000ç«¯å£ï¼‰ï¼Œ3000ç«¯å£åŒæ—¶æä¾›å¾®å‹ä»£ç†åŠŸèƒ½ å’Œ å®¢æˆ·ç«¯åŠŸèƒ½ã€‚è§£å†³æ–¹å¼1ï¼špackage.jsoné…ç½®é€‚åˆçš„ä¸šåŠ¡åœºæ™¯ï¼šä»£ç†ç›®æ ‡å”¯ä¸€é…ç½®ä½ç½®ï¼špackage.jsonproxy:http://localhost:5000è¿™æ ·é¡¹ç›®ä¸­æ‰€æœ‰å‘é€åˆ°3000ç«¯å£çš„è¯·æ±‚éƒ½ä¼šè¢«è½¬å‘åˆ°5000ç«¯å£è§£å†³æ–¹å¼2ï¼šhttp-proxy-middlewareé€‚åˆçš„ä¸šåŠ¡åœºæ™¯ï¼šéœ€è¦ä»£ç†å¤šä¸ªç›®æ ‡åœ°å€æ—¶é…ç½®ä½ç½®ï¼šsrc/setupProxy.jslet createProxyMiddleware = require(http-proxy-middleware)module.exports = function(app) app.use( createProxyMiddleware(/api1, target: http://localhost:5000, changeOrigin: false, pathRewrite: ^/api1 : ), createProxyMiddleware( /api2, target: http://localhost:5001, changeOrigin: false, pathRewrite: ^/api2 : ) )changeOriginchangeOriginç”¨äºå†³å®šæ˜¯å¦åœ¨æœåŠ¡å™¨ç«¯æš´éœ²è¯·æ±‚æºchangeOrigin true ä¸æš´éœ²è¯·æ±‚æºæ­¤æ—¶3000è¯·æ±‚5000ï¼ŒæœåŠ¡å™¨ç«¯æ”¶åˆ°å“åº”å¤´ä¸­Hostå¦‚ä¸‹ï¼šHOST = localhost:5000ï¼ˆæœåŠ¡å™¨ç«¯åœ°å€ï¼‰changeOrigin false æš´éœ²è¯·æ±‚æºæ­¤æ—¶3000è¯·æ±‚5000ï¼ŒæœåŠ¡å™¨ç«¯æ”¶åˆ°å“åº”å¤´ä¸­Hostå¦‚ä¸‹ï¼šHOST = localhost:3000ï¼ˆå®¢æˆ·ç«¯åœ°å€ï¼‰pathRewriteè¡¨ç¤ºæ˜¯å¦å¯¹urlçš„éƒ¨åˆ†è·¯å¾„è¿›è¡Œé‡å†™ï¼Œè¢«æ›¿æ¢çš„éƒ¨åˆ†å¾€å¾€æ˜¯ç”¨äºè¿›è¡Œä»£ç†è½¬å‘è¯†åˆ«çš„è·¯å¾„æ®µï¼Œæ¯”å¦‚é…ç½®å¦‚ä¸‹ï¼šcreateProxyMiddleware(/api1, target: http://localhost:5000, changeOrigin: false, pathRewrite: ^/api1: )åˆ™å½“è¯·æ±‚çš„urlä¸º http://localhost:3000/api1/simData æ—¶ï¼Œurlä¼šç»å†å¦‚ä¸‹å¤„ç†ï¼šåŸå§‹è·¯ç”±http://localhost:3000/api1/simDataè·¯ç”±æ›¿æ¢http://localhost:3000/simDataä»£ç†è½¬å‘http://localhost:5000/simData ç¬¬äºŒæ¬¡å­¦ä¹ ï¼ˆå¤±è´¥ï¼‰ï¼šå¿«é€Ÿç³»åˆ—npx create-react-app app-name æ•°æ®æ³¨å…¥ åˆ—è¡¨æ¸²æŸ“ äº‹ä»¶ çŠ¶æ€å¤„ç† useState åŸºç¡€ç±»å‹ æ•°ç»„ç±»å‹ å¯¹è±¡ç±»å‹ å‚æ•°ä¼ é€’ çˆ¶ä¼ å­ï¼šprops å­ä¼ çˆ¶ï¼šå‡½æ•°å‚æ•°è£¹æŒŸå€¼ä¼ é€’ åŒçº§ä¼ é€’ï¼šçˆ¶ç»„ä»¶ä¸­è½¬ å¤šçº§ä¼ é€’ï¼šContext Hook å‚æ•°ä¼ é€’åœºæ™¯ç»ƒä¹  ä¸€ä¸ªç”¨æˆ·è¯„è®ºåˆ—è¡¨ï¼Œæœ‰ä¸‰å±‚ç»“æ„ï¼šList åˆ—è¡¨ListItem åˆ—è¡¨é¡¹Button ç‚¹èµæŒ‰é’®contextçŠ¶æ€é¡¹ï¼š theme æ§åˆ¶æ ·å¼é£æ ¼ filterOption ç­›é€‰é¡¹ - userName ç”¨æˆ·å - isSort æ˜¯å¦æŒ‰ç…§ç‚¹èµæ•°æ’åº ç¬¬ä¸‰æ¬¡å­¦ä¹ ï¼ˆå®Œç»“ï¼‰ï¼šé¢å‘VueåŸºç¡€ç³»åˆ—bç«™æ•™ç¨‹ jsxåŸºç¡€ç»„ä»¶é¦–å­—æ¯ä¸€å®šè¦å¤§å†™å‡½æ•°å¼ç»„ä»¶function FunHelloComp() return divFunc Comp/divç±»å¼ç»„ä»¶class ClassHelloComp extends React.Component constructor(prop) super(prop); render() return divClass Comp/div reactä¸­åˆ›å»ºç»„ä»¶çš„2ç§æ–¹æ³•ï¼šjsxï¼šéœ€è¦ç”±babelå°†jsxç¿»è¯‘ä¸ºjsReact.createElement å®é™…å®ç°jsxçš„æ¥å£ äº‹ä»¶ä¼ é€’reactäº‹ä»¶ç»‘å®šçš„å‡½æ•°è¢«è§¦å‘æ—¶ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œthisçš„æŒ‡å‘æ˜¯undefinedæœ‰å¦‚ä¸‹æ–¹å¼ä½¿å¾—thisæŒ‡å‘å½“å‰ç»„ä»¶ï¼šç®­å¤´å‡½æ•°å®šä¹‰äº‹ä»¶æ–¹æ³•äº‹ä»¶ç»‘å®šæ—¶ç”¨bindå‡½æ•°å¤„ç†äº‹ä»¶æ–¹æ³•è¡Œå†…å®šä¹‰äº‹ä»¶æ–¹æ³•ä¼ å‚æ–¹å¼ï¼šé«˜çº§å‡½æ•°ä½¿ç”¨bindè·å–æ–°å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºthisæœ€åä¸€ä¸ªå‚æ•°ä¸ºäº‹ä»¶å¯¹è±¡event å“åº”å¼æ•°æ®reactå“åº”å¼åŸç† vueï¼šç›‘å¬å“åº”å¼å˜é‡çš„getå’Œsetæ–¹æ³•reactï¼šæ‰‹åŠ¨è°ƒç”¨setStateè¿›è¡Œæ›´æ–°å¾€setStateå†…ä¼ å…¥ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«éœ€è¦æ›´æ–°çš„æ•°æ®å°†ä¼ å…¥çš„æ–°å¯¹è±¡ä¸æ—§stateè¿›è¡Œåˆå¹¶ä½¿ç”¨åˆå¹¶åçš„stateå¯¹é¡µé¢è§†å›¾è¿›è¡Œæ›´æ–° å“åº”å¼çš„ä¼˜åŒ– æ— è®ºæ•°æ®æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œç›´æ¥è°ƒç”¨setStateéƒ½ä¼šè§¦å‘é¡µé¢çš„é‡ç»˜ï¼Œè¦æƒ³ä¼˜åŒ–è¿™ä¸€ç‚¹å¯ä»¥ä½¿ç”¨PureComponentï¼šclass App extends React.PureComponentä½¿ç”¨PureComponentæ—¶ï¼Œå¦‚æœå“åº”å¼æ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå°±ä¸ä¼šè§¦å‘å¤šä½™çš„é¡µé¢é‡ç»˜ã€‚æ³¨æ„ï¼šä½¿ç”¨PureComponentæ˜¯å¯¹æ•°æ®æ›´æ–°çš„ä¸€ç§ä¼˜åŒ–ä¼šç›‘å¬å˜é‡çš„å†…å­˜åœ°å€çš„å˜åŒ–å› æ­¤ä»…ä»…æ˜¯æ•°ç»„å’Œå¯¹è±¡çš„æˆå‘˜å˜åŒ–æ˜¯ç›‘å¬ä¸åˆ°çš„å¿…é¡»è¦å¯¹åŸæ•°ç»„æˆ–è€…å¯¹è±¡è¿›è¡Œæ‹·è´æ›´æ–° ç»„ä»¶é—´å‚æ•°ä¼ é€’props reactä¸éœ€è¦åœ¨å­ç»„ä»¶å†…å¯¹propå£°æ˜ï¼Œåªè¦ä¼ å…¥çš„å‚æ•°ï¼Œ éƒ½å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨propç±»å‹éªŒè¯ï¼špropTypesç±»å‹éªŒè¯åº“ï¼šproptypesnpm install proptypes â€“saveChildComp.propTypes = // reactä¸­ï¼Œç±»å‹éªŒè¯å¿…é¡»æ˜¯ä¸ªå‡½æ•° mes: function(props) if(typeof(props.mes) !== string) throw new Error(Mes must be a string); , count: PropTypes.numberé»˜è®¤å€¼ï¼šdefaultPropsChildComp.defaultProps = mes:Default Mes æ’æ§½ é»˜è®¤æ’æ§½props.childrenå…·åæ’æ§½ä½¿ç”¨HtmlElementå…ƒç´ ä½œä¸ºpropså‚æ•°ä¼ é€’ä½œç”¨åŸŸæ’æ§½å“¦è¿”å›HtmlElementå…ƒç´ çš„propså‡½æ•°ç”±çˆ¶ç»„ä»¶åˆ›å»ºï¼Œèƒ½è·å–åˆ°å­ç»„ä»¶å€¼çš„æ’æ§½ æ ·å¼å¼•ç”¨.cssåç¼€çš„æ ·å¼æ–‡ä»¶ï¼Œä½œç”¨åŸŸä¸ºå…¨å±€ã€‚å¼•ç”¨.module.cssåç¼€æ ·å¼æ–‡ä»¶ï¼Œç›¸å½“äºvueä¸­çš„scopedï¼Œå¯¹å…¨å±€ä½œç”¨åŸŸåšäº†é™åˆ¶è¿™ç§å¼•å…¥æ–¹å¼éœ€è¦å¯¹æ ·å¼æ–‡ä»¶è¿›è¡Œå‘½åå¼•ç”¨import childStyle from child.module.css;//.....div className=childStyle.title/divclassnamesåº“ä½¿ç”¨classnamesåº“ï¼Œèƒ½å¤Ÿå¿«é€Ÿç”¨jså˜é‡æ§åˆ¶classç±»åçš„toggleåˆ‡æ¢npm install classnames â€“saveimport classnames from classnames;// ...state= hasClass2:false//...div className=classnames( class1:true, class2:this.state.hasClass2) /divä¹Ÿå¯ä»¥é€šè¿‡classnames.bindï¼Œå°†æ ·å¼æ–‡ä»¶ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œæ§åˆ¶import classnames from classnames/bindimport childStyle from ./child.module.cssconst childBindClassNames = classnames.bind(childStyle)//...div className=childBindClassNames( class1: true, class2: false )/div ç”Ÿå‘½å‘¨æœŸReact.StrictModeæ¨¡å¼ä¸‹ï¼Œç”Ÿå‘½å‘¨æœŸæ‰§è¡Œä¸¤æ¬¡shouldComponentUpdateè¡¨ç¤ºæ˜¯å¦åº”è¯¥æ›´æ–°PureComponentä¼˜åŒ–çš„åŸç†æ ¹æ®è·å–åˆ°çš„æ–°å€¼åˆ¤æ–­æ˜¯å¦è¿›è¡Œæ›´æ–°componentDidMountç›¸å½“äºvueä¸­çš„mountedå¯¹æ¯”vueå’Œreactçš„æ›´æ–°vueåœ¨getå’Œsetå‡½æ•°ä¸­è§¦å‘æ›´æ–°åœ¨getå‡½æ•°ä¸­è¿›è¡Œä¾èµ–æ”¶é›†åœ¨æ•°æ®æ›´æ–°åï¼Œåªæ›´æ–°ç”¨åˆ°è¯¥æ•°æ®çš„åœ°æ–¹reactè°ƒç”¨æ–¹æ³•è§¦å‘æ›´æ–°æ›´æ–°æ•´ä¸ªç»„ä»¶æ ‘ å¢åˆ æ”¹æŸ¥æ¡ˆä¾‹ ref contextref çˆ¶ç»„ä»¶è®¿é—®å­ç»„ä»¶å‚æ•°const childRef = React.createRef();childRef.current.addCount() // currentä»£è¡¨å­ç»„ä»¶çš„this context ä½¿ç”¨ React.createContext åˆ›å»ºcontextä½¿ç”¨ContextName.Providerè¿›è¡Œvalueçš„ä¼ é€’ä½¿ç”¨ContextName.Consumeræ¥å—å‚æ•°å¹¶ç”¨å›è°ƒå‡½æ•°è·å–åˆ°valueå€¼// çˆ¶ç»„ä»¶export const Context1 = React.createContext();export default class Parent extends React.PureComponent render() return ( Context1.Provider value=key:123,label:å¤–å¤ªç©º Child ref=childRef/Child /Context1.Provider / ) // å­ç»„ä»¶export default class Parent extends React.PureComponent render() return GrandSon/ // å­™ç»„ä»¶import Context1 from ./Parent.js;export default class GrandSon extends React.PureComponent render() return ( Context1.Consumer value=return ( div pvalue.key/p pvalue.label/p /div ) /Context1.Consumer ) å‡½æ•¸ç»„ä»¶å’Œç±»ç»„ä»¶çš„åŒºåˆ« æ— ç”Ÿå‘½å‘¨æœŸä¸ç”¨è€ƒè™‘thisé€šè¿‡hookå®Œæˆæ“ä½œå‡½æ•°ä½“ç›¸å½“äºrenderå‡½æ•°propsä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•° Hook Reactå†…ç½®HookuseStateuseEffectç±»watchåŠŸèƒ½useMemoç±»computedåŠŸèƒ½é˜²æ­¢ä¸å¿…è¦çš„æ•°æ®æ›´æ–°æ“ä½œuseCallbackæ–¹æ³•çš„ç¼“å­˜ï¼Œé˜²æ­¢ä¸å¿…è¦å‡½æ•°æ›´æ–°æ“ä½œuseRefuseContextæ›´æ–¹ä¾¿è·å–Context.Providerä¸­æä¾›çš„å€¼ é«˜é˜¶ç»„ä»¶å’Œé«˜é˜¶å‡½æ•°ï¼ˆè¿”å›å‡½æ•°çš„å‡½æ•°ï¼‰æ¦‚å¿µç›¸ä¼¼ï¼Œé«˜é˜¶ç»„ä»¶ç›¸å½“äºä¸€ä¸ªè¿”å›ç»„ä»¶çš„å‡½æ•°ï¼Œä¸»è¦ç”¨äºï¼šåœ¨å¤šä¸ªç»„ä»¶ä¸Šè£…è½½ç›¸åŒçš„é€»è¾‘ç‰‡æ®µå¯¹å¤šä¸ªç»„ä»¶è¿›è¡Œç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå¤„ç†åœºæ™¯ï¼šä¿®æ”¹çˆ¶ç»„ä»¶çš„stateæ•°æ®æ—¶ï¼Œå¯¹å­ç»„ä»¶è¿›è¡Œé€‰æ‹©æ€§æ›´æ–°ï¼ˆshouldComponentUpdateï¼‰ä½¿ç”¨ä¸€å¥—é€»è¾‘å°è£…çš„é¼ æ ‡å®šä½ç»„ä»¶ï¼š å…³äºæ€§èƒ½ä¼˜åŒ– Reactçš„æ€§èƒ½ä¼˜åŒ–éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»å®ç°ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œä¸€ä¸ªçˆ¶ç»„ä»¶çš„æ›´æ–°å¾€å¾€ä¼šè§¦å‘å®ƒæ‰€æœ‰å­ç»„ä»¶çš„æ›´æ–°ã€‚React.memo å¯¹ç»„ä»¶å°½å¿ƒä¼˜åŒ–çš„é«˜é˜¶ç»„ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„ç»„ä»¶æ›´æ–°ç›¸å½“äºç±»ç»„ä»¶ä¸­çš„PureComponentuseMemo å¯¹é™æ€ç±»è¿›è¡Œä¼˜åŒ–useCallback å¯¹é™æ€æ–¹æ³•è¿›è¡Œä¼˜åŒ– React-routernpmä¾èµ– React-router æœåŠ¡ç«¯æ¸²æŸ“SSRReact-router-dom æµè§ˆå™¨æ¸²æŸ“React-router-native ReactNativeæ··åˆå¼€å‘ React-router-dom é¦–å…ˆè¦ç»™éœ€è¦è·¯ç”±çš„ç»„ä»¶æ·»åŠ æœ€å¤–å±‚æ ‡ç­¾åŒ…è£¹ï¼šä¸¤ç§åŒ…è£¹æ–¹å¼ï¼šHashRouterBrowserRouterHashRouter App//HashRouterè·¯ç”±è·³è½¬RoutesRoute å£°æ˜è·¯ç”±è·³è½¬çš„é¡µé¢NavLink å¤šç”¨äºå¯¼èˆªæ ï¼Œæœ€è¿‘è¢«ç‚¹å‡»çš„navlinkä¼šå¤šå‡ºactiveç±»Link çº¯è·¯ç”±è·³è½¬ç”¨æ ‡ç­¾è·¯ç”±é‡å®šå‘Navigateå­è·¯ç”±OutletRoute path=/wish element=token?Wish/:Navigate to=/home/Navigate Route path=createWish element=CreateWish/CreateWish/Route Route path=destroyWish element=DestroyWish/DestroyWish/Route/Routeexport default function Wish(props) return ( div Best Wish: Outlet/Outlet /div )å¼‚æ­¥åŠ è½½è·¯ç”±LazySuspenseconst LazyKill = lazy(()=return import (./pages/Kill);)function App() let token = 12 return ( div className=App ul className=nav-ul li className=nav-linkNavLink to=/homeHOME/NavLink/li li className=nav-linkNavLink to=/mineMINE/NavLink/li li className=nav-linkNavLink to=/killKILL/NavLink/li li className=nav-linkNavLink to=/wish/createWishCreate/NavLink/li li className=nav-linkNavLink to=/wish/destroyWishDestroy/NavLink/li li className=nav-linkNavLink to=/work/123Work/NavLink/li /ul /* v5ï¼šSwitch v6ï¼šRoutes*/ Suspense fallback=h1åŠ è½½ä¸­ã€‚ã€‚ã€‚/h1 Routes Route path=/home element=Home/Home/Route Route path=/mine Component=token?Mine:Home/Route Route path=/kill element=LazyKill/LazyKill/Route Route path=/wish element=token?Wish/:Navigate to=/home/Navigate Route path=createWish element=CreateWish/CreateWish/Route Route path=destroyWish element=DestroyWish/DestroyWish/Route /Route Route path=/work/:id Component=Work/Route /Routes /Suspense /div ) è·¯ç”±å‚æ•° paramså‚æ•°useParams ç›´æ¥è¿”å›paramså‚æ•° Routes Route path=/work/:id Component=Work/Route/Routesexport default function Work() let params = useParams() return ( div Work No. params.id /div )queryå‚æ•°useSearchParams è¿”å›ç±»ä¼¼useStateæ ¼å¼çš„æ•°æ®mine?nameLilyAndAndyexport default function Home() const [searchParams, setSearchParams] = useSearchParams() console.log(searchParams.get(name)) // LilyAndAndy setSearchParams( name:NiceBoy ) return ( div className=Home app-page mine mine mine /div )locationè·¯ç”±è·³è½¬ï¼šuseNavigateè¿”å›è·¯ç”±è·³è½¬æ—¶çš„ä¸€äº›æ•°æ®ï¼šconst location = useLocation()è·¯ç”±è·³è½¬æ—¶ï¼Œå¯ä»¥è·³è¿‡paramså’Œqueryæ–¹å¼ï¼Œä¼ é€’æ•°æ®ï¼š/* stateå†…çš„æ•°æ®åœ¨nextPageä¸­å¯ä»¥é€šè¿‡locationçš„æ–¹å¼è·å–åˆ° */button onClick=()=goto(/nextPage, state:mes:hello world)Go to kill/button æƒé™æ§åˆ¶ Route.elementComponentä¸­åšåˆ¤æ–­ï¼šä½¿ç”¨Navigateé‡å®šå‘Route path=/wish element=token?Wish/:Navigate to=/home/Navigate å¼‚æ­¥è·¯ç”± LazySuspense// å¼‚æ­¥å¼•å…¥ç»„ä»¶const LazyKill = lazy(()=return import(./pages/Kill))Suspense fallback=h1åŠ è½½ä¸­ã€‚ã€‚ã€‚/h1 Routes Route path=/kill element=LazyKill/LazyKill/Route /Routes/Suspense å…¨å±€çŠ¶æ€ç®¡ç†npmåº“ react-reduxRedux@reduxjstoolkitreact-mobxMobx Redux éœ€è¦æ‰‹åŠ¨å®ç°storeé€»è¾‘çš„ä¿®æ”¹ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼šreducerä»“åº“åˆ›å»ºstateï¼šç®¡ç†çš„çŠ¶æ€actionï¼šæ“ä½œç›¸å…³çš„è‡ªå®šä¹‰å‚æ•°çº¦å®šä¿—æˆtypeä¸ºæ“ä½œç±»å‹ï¼Œpayloadä¸ºç›®æ ‡å€¼import legacy_createStore as createStore from redux;// åˆ›å»ºreducerçŠ¶æ€ç®¡ç†å‡½æ•°function mesReducer(state=mes:hello, action) switch(action.type) case changeMes: state.mes = action.payload; return ...state case resetMes: state.mes = hello; return ...state default: return state // åŒ…è£…æˆstoreå¹¶è¿”å›let store = createStore(reducer)export default storeæ‹†åˆ†æˆæ¨¡å—åˆå¹¶åŒ…è£…import combineReducers from redux;function mesReducer(state=mes:hello, action)/**/function numReducer(state=version:1, action) switch(action.type) case addVersion: state.version ++; return ...state case resetVersion: state.version = 1; return ...state default: return state const reducer = combineReducers( mesReducer, numReducer)store.stateçš„åŒå‘ç»‘å®šReduxä¸­ç»´æŠ¤çš„çŠ¶æ€å¹¶ä¸ä¼šåƒstateæˆ–propsä¸€æ ·ï¼Œè¢«ç›‘å¬æ˜¯å¦æ”¹å˜å¹¶åˆ·æ–°é¡µé¢ã€‚æ€è·¯ä¸€ï¼šstore.subscribeï¼ˆä¸æ¨èï¼‰ä½¿ç”¨store.subscribeè¿›è¡Œç›‘å¬ï¼Œæ¯å½“æœ‰æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œé‡æ–°æ¸²æŸ“ç»„ä»¶æ€è·¯äºŒï¼šä½¿ç”¨react-reduxreact-reduxæä¾›connectå‡½æ•°ï¼Œèƒ½å¤Ÿåœ¨stateå’Œpropsä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œä»è€Œå®ç°å“åº”å¼æ›´æ–°react-reduxä½¿ç”¨æ­¥éª¤ï¼šå¯¹æ ¹ç»„ä»¶è¿›è¡ŒProvideråŒ…è£…åœ¨è°ƒç”¨çŠ¶æ€çš„ç»„ä»¶ä¸­ä½¿ç”¨connectè¿›è¡Œå…³è”connectæ˜¯ä¸€ä¸ªè¿”å›åŒ…è£…åç»„ä»¶çš„é«˜çº§ç»„ä»¶connectå…³è”çš„çŠ¶æ€åœ¨æ–°ç»„ä»¶ä¸­çš„propsä¸­åŒ…è£¹connectçš„2ä¸ªå‚æ•°ï¼šå‚æ•°1ï¼šå¯¹stateè¿›è¡Œæ˜ å°„è¿”å›å‚æ•°2ï¼šå¯¹dispatchè¿›è¡ŒåŒ…è£…è¿”å›import connect from react-redux;const connectApp = connect( (state= console.log(state) return mes:state.mesReducer.mes ), (dispatch= return dispatch, customFun:()=console.log(print something...) ))(App)export default connectApp; @reduxjstoolkit toolkitæ˜¯reduxçš„ä¼˜åŒ–ç‰ˆï¼Œä¸åŒç‚¹åœ¨äºï¼šçŠ¶æ€ç®¡ç†æ¨¡å—åˆ›å»ºæ–¹å¼ä¸åŒï¼šreduxåˆ›å»ºreducerå‡½æ•°ï¼Œlegacy_createStoreå¯¹storeè¿›è¡ŒåŒ…è£…toolkitä½¿ç”¨createSliceåˆ›å»ºåˆ‡ç‰‡sliceconfigureStoreå¯¹åˆ‡ç‰‡è¿›è¡Œæ•´åˆè°ƒç”¨æ–¹å¼ä¸åŒreduxä¸­dispathä¼ é€’çš„actions.typeç±»å‹è¦äº²è‡ªå®šä¹‰å¯é€‰æ“ä½œå’Œé€»è¾‘toolkitä¸­æ ¹æ®åˆ‡ç‰‡çš„nameå’Œreducersä¸­çš„æˆå‘˜åè¿›è¡Œè°ƒç”¨åˆ›å»ºçŠ¶æ€åˆ‡ç‰‡ï¼šlet mesSlice = createSlice( name:mes, // åˆ‡ç‰‡åç§°ï¼Œç”¨æ¥åœ¨dispatchä¸­å®šä½ initialState: mes:hello, , reducers: changeMes(state,action) console.log(state,action) state.mes = action.payload , resetMes(state,action) state.mes = hello )ç»„åˆåˆ‡ç‰‡ï¼šlet mesSlice = createSlice( name:mes, initialState:/**/, reducers:/**/)let numSlice = createSlice( name:num, initialState:/**/, reducers:/**/)let store = configureStore( reducer: mesReducer:mesSlice.reducer, numReducer:numSlice.reducer, )åˆ‡ç‰‡reducerçš„è°ƒç”¨export default function App() const state = useSelector((state= return state.numReducer )) const dispatch = useDispatch() return ( div Version: state.version br/ button onClick=()=dispatch(type:num/addVersion)/button /div )å“åº”å¼ä¿®æ”¹çŠ¶æ€çš„å‡ ç§æ–¹å¼connectå‡½æ•°é€šè¿‡å°†propså’Œstore.stateè¿›è¡Œæ˜ å°„å…³è”HookuseStateï¼šç»„ä»¶çš„stateå’Œstore.stateè¿›è¡Œæ˜ å°„å…³è” useDispatchï¼šè·å–åˆ°storeçš„å¯æ“ä½œæ–¹æ³•useDispatchä¸éœ€è¦ç”¨actionè°ƒç”¨åˆ°ç›®æ ‡æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥å°†æ–¹æ³•ä»åˆ‡ç‰‡ä¸­æš´éœ²å‡ºæ¥ï¼š// å°†æ–¹æ³•ä»åˆ‡ç‰‡çš„actionsä¸­æš´éœ²å‡ºæ¥export const changeMes = mesSlice.actionsexport const addVersion,asyncAddVersion = numSlice.actions// ç›´æ¥åœ¨dispatchä¸­è°ƒç”¨import addVersion from ./store/toolkit_index;const dispatch = useDispatch();button onClick=()=dispatch(addVersion())æ–°å¢ç‰ˆæœ¬å·ï¼ˆå¼•å…¥ç‰ˆæœ¬ï¼‰/buttonå¼‚æ­¥ä¿®æ”¹å…¨å±€çŠ¶æ€reduxçš„actionä¸­æ˜¯ä¸æ”¯æŒç›´æ¥æ‰§è¡Œå¼‚æ­¥ä¿®æ”¹çŠ¶æ€çš„æ“ä½œçš„ï¼Œè¦æƒ³å¼‚æ­¥ä¿®æ”¹çŠ¶æ€ï¼Œå¿…é¡»å¯¹å¼‚æ­¥çš„ä¸‰ä¸ªçŠ¶æ€ï¼ˆpendingã€failingã€fulfilledï¼‰å„è‡ªçš„æ“ä½œè¿›è¡Œå®šåˆ¶ï¼ˆå¥½éº»çƒ¦ï¼‰å…¶é—´éœ€è¦ä½¿ç”¨åˆ°createAsyncThunkï¼Œåˆ›å»ºå¼‚æ­¥æ‰§è¡Œå¯¹è±¡ï¼š/** * createAsyncThunk ä¸ºå¼‚æ­¥æ“ä½œåšåŒ…è£…ï¼š * å‚æ•°1ï¼šæ“ä½œå * å‚æ•°2ï¼šå¼‚æ­¥æ‰§è¡Œå‡½æ•° */export let changeNumThunk = createAsyncThunk(numSlice/asyncAddVersion, async (params)= return await new Promise((res,rej)= console.log(params) setTimeout(()= res(999) ,1000) ))æ‰§è¡Œå¯¹è±¡éœ€è¦åŒ…è£¹åœ¨åˆ‡ç‰‡ä¸­çš„extraReducersä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“é—¨å¤„ç†åˆ‡ç‰‡å†…éƒ¨é€»è¾‘ï¼ˆä¸ç”¨äºæš´éœ²åˆ°dispatchï¼‰çš„reducerså®šä¹‰æ¨¡å—ï¼šlet numSlice = createSlice( name:num, initialState:/**/, reducers:/**/, extraReducers:(chunk)= // pendingçŠ¶æ€çš„é…ç½® chunk.addCase(changeNumThunk.pending,()= console.log(pending) ).addCase(changeNumThunk.fulfilled,(state, action)= console.log(fulfilled) state.version = action.payload ) )// æš´éœ²å‡ºæ¥export const asyncAddVersion = numSlice.actionså¼‚æ­¥æ“ä½œçš„ä½¿ç”¨ï¼šimport asyncAddVersion from ./store/toolkit_index;button onClick=()=dispatch(changeNumThunk(456))æ–°å¢ç‰ˆæœ¬å·ï¼ˆå¼‚æ­¥+å¼•å…¥ç‰ˆæœ¬ï¼‰/button è·¯ç”±æƒé™æ¡ˆä¾‹æ¡ˆä¾‹æè¿° æ ¹æ®ç”¨æˆ·ç™»å½•èº«ä»½ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸åŒçš„è·¯ç”±å®¢æˆ·ç«¯æ ¹æ®è¿”å›çš„è·¯ç”±ç”Ÿæˆè·¯ç”±æ˜ å°„å½“ç”¨æˆ·è®¿é—®æ²¡æœ‰ç”Ÿæˆçš„è·¯ç”±æ—¶ï¼Œé‡å®šå‘åˆ°é»˜è®¤é¡µé¢ Reactç”Ÿæ€Reactç”Ÿæ€å¸¸ç”¨åº“ UIç»„ä»¶ï¼šAnt Design Ant Design Mobileåº”ç”¨æ¡†æ¶ï¼šUmi å®˜æ–¹æ–‡æ¡£é˜…è¯»HookmemouseCallbackuseMemomemo Reactå­ç»„ä»¶æ›´æ–°çš„è§¦å‘æ–¹å¼æœ‰å‡ ç§ï¼šçˆ¶ä¼ å­çš„propsæ”¹å˜åŸºç¡€å˜é‡ç±»å‹propsï¼ˆmemoåŒ…è£…ï¼‰å‡½æ•°ç±»å‹propsï¼ˆuseCallbackï¼‰å¼•ç”¨ç±»å‹propsï¼ˆuseMemoï¼‰è‡ªèº«stateæ”¹å˜å†…éƒ¨ç”¨åˆ°çš„contextæ”¹å˜ä¼˜åŒ–æ„è§éœ€è¦å°†propsçš„å˜åŒ–èŒƒå›´æ§åˆ¶åœ¨æœ€å°é˜²æ­¢ä¸€ä¸ªæ€»ä¼šå˜åŒ–çš„propsæ— æ•ˆåŒ–memoå¦‚æœä¸æ˜¯ç»˜å›¾çº§åˆ«ç»†ç²’åº¦çš„ç»„ä»¶æ›´æ–°ï¼Œmemoä¼˜åŒ–ç¨‹åº¦ä¸å¤§æ•°æ®è§†å›¾çš„å±•ç¤ºæ”¾åœ¨çˆ¶ç»„ä»¶ï¼Œä¿®æ”¹æ•°æ®æ–¹æ³•ç”¨useCallbackåŒ…è£…ä¼ å…¥å­ç»„ä»¶ useContextuseContextcreateContextæ­é…å®ç°ç»„ä»¶å¯¹contextçš„è®¢é˜…contextæ”¯æŒåŸºç¡€ç±»å‹ã€å¼•ç”¨ç±»å‹é˜²æ­¢Providerç»“æ„è¿‡äºå†—æ‚ï¼Œå¯ä»¥å°†Providerå°è£…æˆç»„ä»¶contextå¯ç”¨äºåœ¨ä¼ é€’å¯¹è±¡å’Œå‡½æ•°æ—¶è¿›è¡Œä¼˜åŒ–é‡æ–°æ¸²æŸ“ useReduceruseReduceræ—¨åœ¨å¯¹å¤§é‡stateç›¸å…³æ“ä½œè¿›è¡Œé€»è¾‘é›†ä¸­ä¹¦å†™ï¼Œreducerå‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šstateï¼šè¢«æ“ä½œçš„stateæ•°æ®actionï¼šé€‰æ‹©çš„æ“ä½œreducerå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯stateè¢«ä¿®æ”¹çš„ç»“æœæ¯”å¦‚éœ€è¦å¯¹åŒä¸€ä¸ªåˆ—è¡¨listè¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œactionä¸€å…±æœ‰4ç§ï¼šå¢åˆ æ”¹æŸ¥reducerä¸­æ ¹æ®actionçš„ä¸åŒï¼Œé›†ä¸­å®ç°å››ç§æ“ä½œå¯¹åº”çš„é€»è¾‘ï¼Œå¯¹å¤–åªæš´éœ²å‡º4ç§actionä½¿ç”¨reducerå¾€å¾€å‡ºäºä»¥ä¸‹å‡ ç‚¹è€ƒè™‘ï¼šä»£ç å¯è¯»æ€§å¯è°ƒè¯•æ€§å¯æµ‹è¯•æ€§ useEffectä¸€èˆ¬ç”¨äºå°†ç»„ä»¶å’Œå¤–éƒ¨ç»„ä»¶åŒæ­¥å¸¸å¸¸å°†é‡å¤çš„useEffectç”¨è‡ªå®šä¹‰Hookçš„æ–¹å¼å•ç‹¬æ‹‰å‡ºæ¥å°è£…å¯ä»¥å®šä¹‰setupå’Œcleanupæ“ä½œå¸¸ç”¨åœºæ™¯å°è£…å’Œç¬¬ä¸‰æ–¹ç»„ä»¶ä¹‹é—´çš„æ¥å£æŒ‚è½½å’Œæ¸…ç†Eventäº‹ä»¶è¯·æ±‚æ•°æ®useEffectå¯ä»¥æŒ‡å®šä¾èµ–é¡¹ï¼šä¾èµ–ä¸º[]ï¼Œåªæ‰§è¡Œä¸€æ¬¡ä¸åŠ ä¾èµ–æ•°ç»„ï¼Œæ¯æ¬¡useEffectå†…å®¹éƒ½ä¼šé‡æ–°æ‰§è¡Œæœ‰ä¾èµ–é¡¹ï¼Œä¾èµ–é¡¹æ”¹å˜ï¼ŒuseEffectå†…å®¹ä¼šé‡æ–°æ‰§è¡Œåœ¨ä½¿ç”¨å¼•ç”¨ç±»å‹ï¼ˆå‡½æ•°å¯¹è±¡ï¼‰ä½œä¸ºä¾èµ–é¡¹æ—¶éœ€è¦è°¨æ… forwardRef useImperativeHandleç”¨forwardRefè¿›è¡ŒåŒ…è£…çš„å­ç»„ä»¶ï¼Œå¯ä»¥å°†refèŠ‚ç‚¹æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œç›¸å½“äºvueä¸­çš„defineExposeï¼šè¿™ç§æš´éœ²å¯ä»¥è·¨è¾ˆè·å–ã€‚é…åˆuseImperativeHandleå¯ä»¥è‡ªå®šä¹‰å­ç»„ä»¶æš´éœ²çš„å†…å®¹ useLayoutEffectåœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ä¹‹å‰è§¦å‘ä½¿ç”¨åœºæ™¯ï¼šç½‘é¡µå†…å®¹çš„å¸ƒå±€æœ‰æ—¶ä¼šæ ¹æ®æ˜¾ç¤ºå†…å®¹è€Œæ”¹å˜ï¼Œå½“å¸Œæœ›ç”¨é¡µé¢ä¸Šä¸€å¸§çš„ä¿¡æ¯è®¡ç®—ä¸‹ä¸€å¸§çš„å¸ƒå±€æ—¶ï¼Œå°±å¯ä»¥åœ¨useLayoutEffectä¸­è¿›è¡Œ useOptimisticå…è®¸åœ¨å¼‚æ­¥æ“ä½œæ—¶æ›´æ–°stateï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒï¼Œä½¿ç”¨åœºæ™¯ï¼š ç±»ä¼¼äºæ•°æ®æœªåŠ è½½åˆ°å®¢æˆ·ç«¯æ—¶çš„loadingä½œç”¨ useSyncExternalStoreä¸»è¦æ˜¯ä¸ºäº†åœ¨ç»„ä»¶ä¸­ï¼Œå“åº”å¼å±•ç¤ºç¬¬ä¸‰æ–¹æ•°æ®æºã€‚éœ€è¦2ä¸ªå‚æ•°ï¼šsubscribeå‚æ•°ä¸ºè§¦å‘ç»„ä»¶æ¸²æŸ“çš„å‡½æ•°è¿”å›å€¼ä¸ºclenaupå‡½æ•°getSnapshotè¿”å›å€¼å†³å®šæš´éœ²é‚£äº›æ•°æ®ä½¿ç”¨åœºæ™¯ï¼šç±»ä¼¼storeçš„ç”¨æ³•ï¼Œä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†å™¨ç›‘å¬æµè§ˆå™¨çš„å˜é‡å˜åŒ– ç»„ä»¶Fragment ç”¨äºç»„åˆå¤šä¸ªç»„ä»¶çš„ç©ºæ ‡ç­¾Profiler æµ‹é‡ç»„ä»¶æ¸²æŸ“æ€§èƒ½StrictMode ä¸¥æ ¼æ¨¡å¼Suspense åœ¨ç»„ä»¶åŠ è½½å®Œæˆä¹‹å‰æä¾›æ›¿ä»£æ¸²æŸ“å†…å®¹ APIcreateContext åˆ›å»ºä¸Šä¸‹æ–‡forwardRef åˆ›å»ºå¯ä»¥å°†å†…å®¹æš´éœ²ç»™çˆ¶ç»„ä»¶çš„ç»„ä»¶memo åˆ›å»ºæ ¹æ®propsstatecontextè¿›è¡Œç¼“å­˜çš„ç»„ä»¶ï¼ˆè€Œéå¼ºåˆ¶æ ¹æ®çˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“è€Œé‡æ–°æ¸²æŸ“ï¼‰lazy ç»„ä»¶æ‡’åŠ è½½startTransition ä¸é˜»å¡UIçš„æƒ…å†µä¸‹æ›´æ–°state lazyç”¨äºå®ç°ç»„ä»¶æ‡’åŠ è½½å¯ä»¥é…åˆSuspenseå®ç°ç»„ä»¶çµæ•åŠ è½½ ç»¼åˆç»ƒä¹ Hookç»¼åˆç»ƒä¹ ä¸€ä¸ªèŠå¤©è½¯ä»¶ç•Œé¢ï¼šé¼ æ ‡ç§»å…¥æ—¶ï¼Œå…‰æ ‡å˜ä¸ºåœ†ç‚¹useEffectè‡ªå®šä¹‰Hookå°è£…ç‚¹å‡»äººï¼Œè¾“å…¥é‚®ä»¶å†…å®¹ï¼Œå‘é€é‚®ä»¶èŠå¤©å†…å®¹æ¨¡å—ï¼Œæä¾›è·³è½¬åˆ°æœ€æ—©èŠå¤©è®°å½•æŸ¥çœ‹æœ€æ–°èŠå¤©è®°å½•æŒ‰é’®çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³• forwardRef useImperativeHandle2ä¸ªä¸»è¦ç»„ä»¶ï¼šè”ç³»äººåˆ—è¡¨prop1 è”ç³»äººåˆ—è¡¨ context1 å½“å‰å‘é€ä¿¡æ¯çš„è”ç³»äººcontext1 åœ¨æ­¤å¤„è¢«ä¿®æ”¹èŠå¤©ç•Œé¢context1 å½“å‰å‘é€ä¿¡æ¯çš„è”ç³»äººå…¨å±€å­˜å‚¨ï¼šuseContextå½“å‰å‘é€ä¿¡æ¯çš„è”ç³»äººç•Œé¢ä¸»é¢˜é¢œè‰²ç›‘å¬ç½‘ç»œï¼šuseSyncExternalStoreç›‘å¬æµè§ˆå™¨ç½‘ç»œè¿æ¥ ç»„ä»¶çº¯ç²¹æ€§ Reactæå€¡ç»„ä»¶è¦ä¿æŒçº¯ç²¹ï¼Œæ„æ€å°±æ˜¯ç»„ä»¶å‡½æ•°æ— è®ºè¢«è°ƒç”¨åˆ›å»ºå¤šå°‘æ¬¡ï¼Œæ¸²æŸ“ç»“æœåº”å½“éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±å’Œçº¯å‡½æ•°ä¸€æ ·ï¼Œåªè¦è¾“å…¥å€¼ä¸å˜ï¼Œè¾“å‡ºå€¼æ°¸è¿œç›¸åŒï¼Œè¿™å°±æ„å‘³ç€ä¸åº”å½“å¼•å…¥å…¨å±€å˜é‡ç­‰å¯èƒ½å‡ºç°mutationï¼ˆçªå˜ï¼‰çš„å†…å®¹æ¥æ±¡æŸ“ç»„ä»¶è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨å¼€å‘ç¯å¢ƒã€ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReactä¼šå°†æ¯ä¸ªç»„ä»¶å†…å®¹æ‰§è¡Œ2æ¬¡çš„åŸå› ï¼Œå°±æ˜¯ä¸ºäº†æ£€æŸ¥ç»„ä»¶çš„çº¯ç²¹æ€§ React18 + Redux + React Routerç¯å¢ƒé…ç½®reactå¼€å‘ä¾èµ–å®‰è£… å®‰è£…ä¸‹é¢çš„ä¾èµ–åŒ…ï¼š react: ^18.2.0, react-dom: ^18.2.0, react-redux: ^9.1.2, react-router: ^6.26.2, react-router-dom: ^6.26.2, redux: ^5.0.1 åˆå§‹åŒ–é¡¹ç›®æ ·å¼ ä»¥å‰éƒ½æ˜¯æ‰‹åŠ¨æ·»åŠ ï¼Œå¯ä»¥æœ€ç›´æ¥npmä¸‹è½½åŒ…npm i reset-css é…ç½®è·¯å¾„åˆ«å é¦–å…ˆå®‰è£…nodeåº“çš„tså£°æ˜é…ç½®ï¼ˆä¸ºäº†åœ¨tsæ–‡ä»¶ä¸­ä½¿ç”¨pathï¼‰npm i -D @types/nodeåœ¨vite.config.tsä¸­é…ç½®è·¯å¾„åˆ«åï¼šexport default defineConfig( plugins: [react()], // è·¯å¾„åˆ«å resolve: alias: @: path.resolve(__dirname, ./src) )åœ¨tsconfig.jsonä¸­é…ç½®ï¼Œä½¿ç¼–è¯‘å™¨ä¸­æç¤ºè·¯å¾„åˆ«åä¸‹çš„ç›®å½•ç»“æ„ï¼šé…ç½®æ–¹æ³• baseUrl: ., paths: @/*: [ src/* ] antd è®°ä½ç»„ä»¶å’Œå›¾æ ‡æ˜¯åˆ†å¼€å®‰è£…çš„å°±oknpm install antd @ant-design/icons --save è·¯ç”±é…ç½®æ–¹æ³•1ï¼šç»„ä»¶å¼è·¯ç”±é…ç½® åœ¨srcç›®å½•ä¸‹åˆ›å»ºrouteræ–‡ä»¶ï¼Œå…¶ä¸­åˆ›å»ºè·¯ç”±ç»„ä»¶index.tsxï¼šimport BrowserRouter, Route, Routes from react-router-dom;import App from @/App.tsximport Home from @/views/Home;import About from @/views/About;const baseRouter = () = ( BrowserRouter Routes Route path=/ element=App/ Route path=/home element=Home//Route Route path=/about element=About//Route /Route /Routes /BrowserRouter)export default baseRouterå…¶ä¸­å°†æ ¹è·¯å¾„çš„ç»„ä»¶è®¾ç½®ä¸ºAppï¼Œå…¶å®ƒçš„ç»„ä»¶éƒ½æ˜¯Appä¸‹çš„å­ç»„ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨Appç»„ä»¶å†…æ·»åŠ Outletç»„ä»¶ä½œä¸ºå­ç»„ä»¶å®¹å™¨ï¼šfunction App() return ( div ä¸‹é¢æ˜¯å­ç»„ä»¶ï¼š Outlet/ /div )åœ¨å…¥å£ç»„ä»¶main.tsxä¸­æŠŠRouterç»„ä»¶åµŒå…¥ï¼šimport Router from @/routerReactDOM.createRoot(document.getElementById(root)!).render( React.StrictMode Router/ /React.StrictMode,) æ–¹å¼2ï¼šè·¯ç”±è¡¨é…ç½® è¿™ç§æ–¹å¼ç±»ä¼¼äºvue-routerçš„è·¯ç”±é…ç½®ï¼šimport Home from @/views/Homeimport About from @/views/About;import Navigate from react-router;const routes = [ path:/, element:Navigate to=/home/Navigate , path:/home, element:Home/, , path:/about, element:About/ ]export default routes;å…¥å£æ–‡ä»¶ä¸­çš„Appç…§å¸¸å¼•å…¥ï¼Œå¹¶ç”¨RouteråŒ…è£¹ï¼šimport React from reactimport ReactDOM from react-dom/clientimport App from ./App.tsximport BrowserRouter from react-router-dom;ReactDOM.createRoot(document.getElementById(root)!).render( React.StrictMode BrowserRouter App/ /BrowserRouter /React.StrictMode,)åœ¨App.tsxä¸­ä½¿ç”¨useRouterå¼•å…¥routerï¼šfunction App() const outlet = useRoutes(router) return ( div outlet /div )export default App è·¯ç”±æ‡’åŠ è½½ ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½lazy+Suspenseç»„ï¼Œå¯ä»¥å¯¹loadingé¡µé¢è¿›è¡Œå°è£…ï¼šconst withLoadingComponent = (comp: JSX.Element) = ( React.Suspense fallback=divLoading.../div comp /React.Suspense)const routes = [ path:/, element:Navigate to=/home/Navigate , path:/home, element:withLoadingComponent(Home/) , path:/about, element:withLoadingComponent(About/) ] å­è·¯ç”± å’Œvue-routerä¸­åŒæ ·ä½¿ç”¨childrenå±æ€§ï¼šconst routes = [ // å­è·¯ç”± path:/home, element:withLoadingComponent(Home/), children:[ path:page1, element:withLoadingComponent(Page1/) , ] ,] å…¨å±€åŒ¹é…è·¯ç”± åœ¨è·¯ç”±é…ç½®è¡¨æœ€åæ·»åŠ ä¸€ä¸ªé…ç½®é¡¹ï¼šconst routes = [ path:*, element:Navigate to=/home/page1/ ] Reduxå…·ä½“å†…å®¹å‚è€ƒè¿™é‡Œ ä½¿ç”¨æµè§ˆå™¨æ’ä»¶Redux DevToolså¯ä»¥ååŠ©è¿›è¡Œå¼€å‘åœ¨srcç›®å½•ä¸‹åˆ›å»ºstoreæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­å­˜æ”¾åˆ›å»ºreduxä»“åº“çš„ä»£ç ã€‚storeindex.tsimport legacy_createStore from redux;import reducer from ./reducerconst store = legacy_createStore( reducer, window.__REDUX_DEVTOOLS_EXTENSION__ window.__REDUX_DEVTOOLS_EXTENSION__())export default storestorereducer.ts// é»˜è®¤çŠ¶æ€const defaultState = num: 20// let reducer = (state = defaultState) = const newState = JSON.parse(JSON.stringify(state)) return newStateexport default reducerè¿˜éœ€è¦åœ¨æ ¹ç»„ä»¶main.tsxä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå…¨å±€æ•°æ®æä¾›ç»„ä»¶å¯¹Appç»„ä»¶è¿›è¡ŒåŒ…è£¹ï¼šimport Provider from react-reduximport store from @/storeReactDOM.createRoot(document.getElementById(root)!).render( Provider store=store BrowserRouter App/ /BrowserRouter /Provider,)åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ä»“åº“æ•°æ®ï¼Œéœ€è¦ç”¨åˆ°useSelectorimport useSelector from react-redux;function Page1() const num = useSelector(state=( num:state!.num )) return ( divnum = num/div )export default Page1;ä½¿ç”¨useDispatchè°ƒç”¨ä»“åº“é‡Œå®šä¹‰çš„æ–¹æ³•,åœ¨reducerå›è°ƒæ·»åŠ actionå‚æ•°ï¼Œç”¨äºåˆ¤æ–­é€‰æ‹©æ“ä½œçš„ç±»å‹ï¼Œlet reducer = ( state = defaultState, action:type:string ) = // å¯¹stateè¿›è¡Œæ·±æ‹·è´ const newState = JSON.parse(JSON.stringify(state)) switch(action.type) case addOne: newState.num++ break case addTen: newState.num+=10 break return newStateåœ¨é¡µé¢ä½¿ç”¨useDispatchè°ƒç”¨æ“ä½œï¼šconst dispatch = useDispatch()const addNum = (type) = dispatch(type) å…³äºå…¨å±€ä»“åº“tsæ•°æ®ç±»å‹çš„å®šä¹‰ åœ¨å…¨å±€ç±»å‹å£°æ˜æ–‡ä»¶vite-env.d.tsä¸­æ·»åŠ å£°æ˜ï¼šdeclare module *.tsåœ¨srcä¸‹åˆ›å»ºtypesç›®å½•ç”¨äºå­˜æ”¾ä¸€äº›ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œåˆ›å»ºstore.d.tsï¼š/** * ç±»å‹å£°æ˜é‡Œé¢ä¸è¦ç›´æ¥ä½¿ç”¨import... from ... * ä½¿ç”¨è¡Œå†…å¼•å…¥import(@/) */type RootState = ReturnTypetypeof import(@/store).getStateinterface Window __REDUX_DEVTOOLS_EXTENSION__:function;å¼•ç”¨storeçš„æ•°æ®æ—¶ï¼Œå°†å¯¹åº”çš„æ•°æ®ç±»å‹å®šä¹‰å†™ä¸Šï¼š// å‚æ•°å®šä¹‰ä¸ºRootStateconst num = useSelector((state:RootState)=( num:state.num)) åˆå¹¶å¤šä¸ªstore å°†å¤šä¸ªstoreæŠ½å–åˆ°å•ç‹¬çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œåœ¨storeindexä¸‹å°†å¤šä¸ªstoreé›†ä¸­è¿”å›ç›®å½•ç»“æ„ï¼š- store - status_1 - index - reducer - status_2 - index -reducer - index.tsä½¿ç”¨combineReducerså°†2ä¸ªreducerç»“åˆèµ·æ¥ï¼šimport combineReducers, legacy_createStore from redux;import NumStatusReducer from @/store/NumStatus/reducer.tsimport ArtStatusReducer from @/store/ArtStatus/reducer.tsconst reducers = combineReducers( NumStatusReducer, ArtStatusReducer)const store = legacy_createStore( reducers, window.__REDUX_DEVTOOLS_EXTENSION__ window.__REDUX_DEVTOOLS_EXTENSION__())export default store","tags":["Web"]},{"path":"/å¾…æ•´ç†èµ„æ–™.html","content":"Markdown All in Oneå¸¸ç”¨æ“ä½œæ±‡æ€»ï¼ˆfor Windowsï¼‰ Markdown ç¬”è®°å¿…è£…ç¥å™¨ mermaidå›¾è¡¨å®˜ç½‘ Googleå‘å¸ƒ2023å¹´CSSçš„æ–°ç‰¹æ€§"},{"title":"SVG å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢","path":"/notes/cg_svg.html","content":"svgå…ƒç´ è½¬æ¢ä¸ºdataUrlå‚è€ƒåšå®¢ä½¿ç”¨window.btoaæ¥å£èƒ½å°†svgå­—ç¬¦ä¼ è½¬æ¢ä¸ºdataUrllet svg = svg xmlns=\\http://www.w3.org/2000/svg\\ width=\\40\\ height=\\40\\ viewBox=\\-10 -18 100 135\\circle cx=\\50\\ cy=\\50\\ r=\\40\\ fill=\\red\\ stroke=\\%23ededed\\ stroke-width=\\3\\//svg;// å‰é¢éœ€è¦åŠ ä¸Š data:image/svg+xml;base64, å‰ç¼€let dataUrl = data:image/svg+xml;base64, + window.btoa(svg);"},{"title":"å‹é“¾","path":"/friends/index.html","content":"ğŸ±æ¨¡å—å¼€å‘ä¸­ï¼Œå³å°†å¼€æ”¾â€¦"},{"title":"three.js 3Dåº“","path":"/notes/cg_threejs.html","content":"controlsæ»šè½®æ»šåŠ¨å¯¼è‡´æ— æ³•æ¸²æŸ“é—®é¢˜æè¿° OrbitControlså¼•å…¥åï¼Œé¼ æ ‡æ‹–åŠ¨äº‹ä»¶æ­£å¸¸ï¼Œä½¿ç”¨æ»šè½®è¿›è¡Œç¼©æ”¾æ“ä½œæ—¶ï¼Œæ•´ä¸ªç”»é¢æ— æ³•é‡ç»˜ã€‚æ£€æŸ¥äº†cameraçš„å‰ªè£é¢é…ç½®ï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚ è§£å†³æ–¹æ³• threejsç‰ˆæœ¬é—®é¢˜ï¼Œä½¿ç”¨0.160.0ç‰ˆæœ¬çš„threejsä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ”¹æˆæ›´ä½ç‰ˆæœ¬0.133.0å°±è§£å†³äº†ã€‚ Controlsæ²¡æœ‰ä»»ä½•ååº”é—®é¢˜æè¿° é…ç½®äº†Orbitcontrolsä½†æ²¡æœ‰ä»»ä½•ååº”ï¼Œèƒ½è¿›controlsæ·»åŠ çš„é¼ æ ‡äº‹ä»¶çš„æ–­ç‚¹ï¼Œä½†å°±æ˜¯æ¯«æ— ååº”ã€‚ è§£å†³æ–¹æ³• è°ƒè¯•äº†å¤§æ¦‚ä¸€ä¸ªå°æ—¶ï¼Œç»ˆäºææ¸…æ¥šäº†ï¼Œå› ä¸ºæˆ‘æŠŠç›¸æœºå’ŒOrbitControls.targetéƒ½æ”¾åœ¨äº†åŸç‚¹ä½ç½®ï¼šcamera.position.set(0,0,0)controls.target.set(0,0,0)è¿™ä¼šå¯¼è‡´OrbitControlsçš„æ—‹è½¬çŸ©é˜µè®¡ç®—å‡ºç°é—®é¢˜ï¼Œéœ€è¦ç§»åŠ¨ç›¸æœºæˆ–è€…controls.targetçš„ä½ç½®ï¼šcamera.position.set(-0.001,0,0)è¿™æ ·å°±è§£å†³äº† ç§»åŠ¨ç«¯uniappä¸­ä½¿ç”¨threejsé—®é¢˜æè¿° æƒ³åœ¨ç”¨uniappæ­å»ºçš„appç«¯å†™ä¸€ä¸ªç”¨åˆ°threejsçš„é¡¹ç›®ï¼Œä½†æ˜¯åœ¨ç¬¬ä¸€æ­¥å°±å¡å£³äº†ï¼Œå…ˆæ˜¯çœŸæœºæµ‹è¯•ï¼Œå•¥éƒ½æ¸²æŸ“ä¸å‡ºæ¥ï¼Œè¿ä¸ªæŠ¥é”™éƒ½æ²¡æœ‰ï¼Œæµè§ˆå™¨æ§åˆ¶å°ä¹Ÿçœ‹ä¸åˆ°ï¼Œåªæœ‰HBuilderçš„æ§åˆ¶å°ä¸Šé¢ï¼Œæ—¶ä¸æ—¶çš„ç»™æˆ‘æŠ¥å‡ºæ¥ä¸€ä¸ªé”™ï¼Œå¤§æ¦‚æ„æ€æ˜¯è¯´è·å–ä¸åˆ°render.domElementéœ€è¦è¢«appendä¸Šå»çš„é‚£ä¸ªdomå…ƒç´ ã€‚ è§£å†³æ–¹æ³• PCç«¯è°ƒè¯•Androidæ‰‹æœºçš„æ–¹æ³•å‚è€ƒæ–‡ç« æ–‡ç« ä½œè€…çš„æ€»ç»“éå¸¸ç®€å•æ˜“æ‡‚ï¼švueæœ¬èº«ä¸æ”¯æŒç›´æ¥é€šè¿‡åŸç”ŸJSæ“ä½œDOMï¼Œäºæ˜¯åœ¨uniappé‡Œï¼Œå¯ä»¥é€šè¿‡renderjsæ¥å®ç°é€»è¾‘å±‚(vueçš„templateæˆ–è€…è¯´è™šæ‹Ÿdom)ä¸è§†å›¾å±‚(åŸç”Ÿdom)ä¹‹é—´çš„é€šè®¯ï¼Œæˆ–è€…è¯´æ“ä½œã€‚åœ¨å†…è”renderä¸­å†™éœ€è¦æ“æ§domçš„ä»£ç ï¼Œé—®é¢˜é¡ºåˆ©è§£å†³ï¼štemplate view view class=renderjs id=renderjs-view/view /view/templatescript module=render lang=renderjs import * as THREE from three import OrbitControls from three/examples/jsm/controls/OrbitControls export default mounted() const view = document.getElementById(renderjs-view) const renderer = new THREE.WebGLRenderer() renderer.setSize(window.innerWidth, window.innerHeight) view.appendChild(renderer.domElement) const scene = new THREE.Scene() const camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.01, 10000 ) scene.add(camera) camera.position.set(30,30,30) camera.lookAt(0,0,0) const controls = new OrbitControls(camera, renderer.domElement) controls.update() const axesHelper = new THREE.AxesHelper(5) scene.add(axesHelper) const boxGeometry = new THREE.BoxGeometry(3,3,3) const boxMetarial = new THREE.MeshBasicMaterial( color:0x00ff00 ) const box = new THREE.Mesh(boxGeometry, boxMetarial) scene.add(box) renderer.setAnimationLoop(animate) function animate() renderer.render(scene,camera) , ;/script PostprocessingUnrealBloomPassæ— æ³•æ¸²æŸ“é€æ˜é€šé“é—®é¢˜æè¿° å¤§å±é¡¹ç›®ä¸­æœ‰ä¸ªæ¨¡å—ï¼Œéœ€è¦ç»˜åˆ¶èƒŒæ™¯é€æ˜çš„3Dåœºæ™¯ï¼Œé‡Œé¢è¿˜æœ‰æ³›å…‰æ•ˆæœï¼Œå› æ­¤æˆ‘ä½¿ç”¨setOpacity+UnrealBloomPassçš„æ–¹å¼æ¥å®ç°ï¼Œä½†æ˜¯å®é™…æ¸²æŸ“å‡ºæ¥å‘ç°åœºæ™¯èƒŒæ™¯å§‹ç»ˆæ˜¯é»‘è‰²çš„ï¼Œå…³é—­UnrealBloomPasså‘ç°é€æ˜èƒŒæ™¯æ¢å¤æ­£å¸¸ã€‚çœ‹æ¥é—®é¢˜å‡ºåœ¨UnrealBloomPassä¸Š è§£å†³æ–¹æ³• å‚è€ƒï¼šUnrealBloomPass makes background blackUnreal Bloom and Renderer Transparency issueå½“å‰ç‰ˆæœ¬çš„threeä¸­ï¼ŒUnrealBloomPassç¡®å®ä¸æ”¯æŒé€æ˜é€šé“æ¸²æŸ“ï¼Œä½†æ˜¯è¿™ä¸ªè€å“¥æ”¹äº†å‡ è¡ŒUnrealBloomPass.jsé‡Œçš„ä»£ç ï¼šæ”¹åŠ¨è¯¦æƒ…å®é™…ä¸Šå°±æ˜¯æŠŠæè´¨çš„transparentæ‰“å¼€ï¼Œè®¡ç®—çº¹ç†çš„æ—¶å€™åŠ å…¥alphaé€šé“çš„æ•°å€¼ï¼Œä½†æ˜¯è¿™è€å“¥ä¹Ÿåœ¨åº•ä¸‹è¯´äº†ï¼šunrealBloomPassçš„æ³›å…‰æ•ˆæœå’Œhtmlå…ƒç´ æ— æ³•å¾ˆå¥½çš„èåˆåœ¨ä¸€èµ·ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚è¿™ä¸ªissuesåº•ä¸‹è¿˜æœ‰ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç”¨åˆ°çš„æ˜¯shaderPassçš„æ–¹å¼ï¼šselective bloom exampleæˆ‘ä¸€å¼€å§‹ä¹Ÿæƒ³åˆ°ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³unrealBloomPassåªæ¸²æŸ“åˆ°æŒ‡å®šå›¾å±‚éƒ¨ä½ï¼Œçœ‹æ¥æ˜¯å¯è¡Œçš„"},{"title":"Github","path":"/notes/devOps_github.html","content":"GitHubæ‰˜ç®¡ä¸ªäººç½‘ç«™ä¸ªäººåšå®¢æ­å»ºåˆ©ç”¨GitHubæ­å»ºä¸ªäººåšå®¢ä¸»è¦å‚è€ƒæ­¤ç¯‡åšæ–‡ï¼šhttps://pdpeng.github.io/2022/01/19/setup-personal-blog/#%E5%BA%8F%E8%A8%80https://pdpeng.github.io/2022/01/19/setup-personal-blog/#%E5%BA%8F%E8%A8%80 é™æ€ç½‘ç«™æ‰˜ç®¡åˆ©ç”¨GitHubå¯ä»¥æ‰˜ç®¡é™æ€ç½‘ç«™https://www.youtube.com/watch?v=gyAdWWZRNBY&list=PLjcjAqAnHd1EIxV4FSZIiJZvsdrBc1Xho&index=49https://www.youtube.com/watch?v=gyAdWWZRNBY&list=PLjcjAqAnHd1EIxV4FSZIiJZvsdrBc1Xho&index=49åœ¨çŸ¥ä¹ä¸Šè¿˜å‘ç°ä¸€ç¯‡ä»‹ç»githubç½‘ç«™æ‰˜ç®¡çš„æ–‡ç« ï¼Œå†™çš„ä¸é”™ï¼šhttps://zhuanlan.zhihu.com/p/76063614https://zhuanlan.zhihu.com/p/76063614 GitæŠ¥é”™error: RPC failed; HTTP 400 curl 92 HTTP2 stream 5 was not closed cleanly: CANCEL (err 8)æŠ¥é”™ä¿¡æ¯ åœ¨æ‰§è¡Œhexo deployçš„æ—¶å€™æŠ¥é”™ï¼šTotal 129 (delta 121), reused 0 (delta 0), pack-reused 0error: RPC failed; HTTP 400 curl 92 HTTP/2 stream 5 was not closed cleanly: CANCEL (err 8)fatal: the remote end hung up unexpectedlyEverything up-to-dateFATAL Somethings wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.htmlError: Spawn failedat ChildProcess.anonymous (D:\\HelloWorld\\Code\\Project_Indie\\Project_Web\\hexo_blog ode_modules\\hexo-util\\lib\\spawn.js:51:21)at ChildProcess.emit (node:events:519:28)at cp.emit (D:\\HelloWorld\\Code\\Project_Indie\\Project_Web\\hexo_blog ode_modules\\cross-spawn\\lib\\enoent.js:34:29)at ChildProcess._handle.onexit (node:internal/child_process:294:12) å¤„ç†æ–¹å¼ çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œæ˜¯ç”±äºç½‘ç»œé€Ÿåº¦æ…¢å¯¼è‡´è¿æ¥å…³é—­æŒ‚VPNå†éƒ¨ç½²ä¸€éå°±è¡Œäº†"},{"title":"ğŸ±BlobCat Emoji","path":"/notes/emoji_BlobCat.html","content":"copy copy"},{"title":"ğŸ§QQ Emoji","path":"/notes/emoji_qq.html","content":"emoji copy emoji copy"},{"title":"å¤‡å¿˜å½•","path":"/notes/index.html","content":""},{"title":"JavaScript è¯­è¨€","path":"/notes/lang_javascript.html","content":"Blobæ–‡ä»¶æµçš„ä¸‹è½½function blobDownload(value, fileName, type) let blob = new Blob([value], type: type) let downloadElement = document.createElement(a) downloadElement.href = window.URL.createObjectURL(blob) downloadElement.setAttribute(download, fileName) document.body.appendChild(downloadElement) downloadElement.click() document.body.removeChild(downloadElement) window.URL.revokeObjectURL(downloadElement.href) // é‡Šæ”¾blobå¯¹è±¡revokeObjectURLwindow.URL.createObjectURL å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡URLå­—ç¬¦ä¸²ï¼ŒæŒ‡å‘æŒ‡å®šçš„èµ„æºï¼Œåœ¨èµ„æºä½¿ç”¨ç»“æŸåæœ€å¥½é€šè¿‡revokeObjectURLæ‰‹åŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²"},{"title":"Python è¯­è¨€","path":"/notes/lang_python.html","content":"python pipå®‰è£…è¶…æ—¶Python pipå®‰è£…è¶…æ—¶çš„å‡ ç§è§£å†³åŠæ³•"},{"title":"Webå¼€å‘ ç½‘ç»œç›¸å…³","path":"/notes/net_webDev.html","content":"Axiosaxiosä¼ é€’FormDataç±»å‹æ•°æ®å‚æ•°ä¸ºç©ºé—®é¢˜æè¿° é€šè¿‡axiosä¸Šä¼ æ–‡ä»¶ï¼Œæ•°æ®ä¸ºFormDataç±»å‹ï¼Œä½†æ˜¯é€šè¿‡æµè§ˆå™¨çœ‹åˆ°ä¼ é€’çš„å®é™…å‚æ•°æ€»æ˜¯åªæœ‰ä¸€ä¸ªuuidï¼Œæ–‡ä»¶å†…å®¹ç¼ºå¤± è§£å†³æ–¹æ³• å‰ç«¯é€šè¿‡axioså’ŒFormDataå®ç°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½é‡åˆ°çš„å‘è¿™æ˜¯å› ä¸ºä¼ é€’FormDataç±»å‹çš„æ•°æ®æ—¶ï¼ŒContent-Typeå¿…é¡»è¦æ˜¯multipartform-dataï¼Œä½†æ˜¯åœ¨å¯¹axiosæ–‡ä»¶çš„é…ç½®ä¸­ï¼Œæ·»åŠ äº†é»˜è®¤å¤´ï¼šâ€™applicationjson;charsetutf-8â€™ï¼Œæ‰€ä»¥å°†é»˜è®¤å¤´å»æ‰å°±è¡Œï¼Œå¦‚æœä¸åŠ é»˜è®¤å¤´ï¼Œaxiosæ£€æµ‹åˆ°ä¼ é€’æ•°æ®ç±»å‹ä¸ºFormDataæ—¶ï¼Œä¼šè‡ªåŠ¨å»æ‰Content-Typeï¼Œæ„æ€å°±æ˜¯å«æµè§ˆå™¨å»è½¬æ¢è¿™ä¸ªçš„æ„æ€ã€‚ä½†æ˜¯ä½ç‰ˆæœ¬çš„axioså°±ç®—æ˜¯åŠ äº†é»˜è®¤å¤´ä¹Ÿä¼šå¯¹FormDataçš„Content-Typeè¿›è¡Œå»é™¤æ“ä½œï¼Œè™½ç„¶è¿™ä¸€æ­¥éƒ½æ˜¯åœ¨axioslibadaptersxhr.jsä¸­å®ç°çš„ï¼Œä½†æ˜¯ä¸åŒç‰ˆæœ¬å¯¹å»é™¤Content-Typeçš„æ¡ä»¶ä¸åŒï¼šä½ç‰ˆæœ¬axiosï¼š// ç›´æ¥åˆ¤æ–­æ•°æ®ç±»å‹if (utils.isFormData(requestData)) delete requestHeaders[Content-Type]; // Let the browser set ité«˜ç‰ˆæœ¬axiosï¼š// åˆ¤æ–­æ˜¯å¦ä¸ºFormDataif (utils.isFormData(requestData)) // æ˜¯å¦å¯ä»¥æŠ›ç»™æµè§ˆå™¨åš if (platform.hasStandardBrowserEnv || platform.hasStandardBrowserWebWorkerEnv) requestHeaders.setContentType(false); // Let the browser set it else if ((contentType = requestHeaders.getContentType()) !== false) // fix semicolon duplication issue for ReactNative FormData implementation const [type, ...tokens] = contentType ? contentType.split(;).map(token = token.trim()).filter(Boolean) : []; requestHeaders.setContentType([type || multipart/form-data, ...tokens].join(; )); åœ¨é«˜ç‰ˆæœ¬çš„axiosä¸­ï¼Œå¯¹axiosé…ç½®é»˜è®¤å¤´ä¼šå¯¹æµè§ˆå™¨é€ æˆå¹²æ‰°ï¼Œå› æ­¤ä¼ è¾“çš„Content-Typeæ²¡æœ‰è¢«æ­£ç¡®è®¾ç½®ï¼Œéœ€è¦å°†é»˜è®¤é…ç½®å¤´å»é™¤ webChannelé—®é¢˜æè¿° æµè§ˆå™¨ç½‘ç»œç›‘æ§ç½‘ç»œå±‚æ—¥å¿— net logchrome net log å‚è€ƒåšå®¢chrome åœ°å€æ è¾“å…¥:ç‚¹å‡»Start Logging to DiskæŒ‰é’®å½•åˆ¶net logå½•åˆ¶ç»“æŸåï¼Œåœ¨ netlog-viewer ä¸ŠæŸ¥çœ‹ç½‘ç»œæ—¥å¿—çš„å…·ä½“å†…å®¹"},{"title":"npm æ’ä»¶","path":"/notes/npm_npm.html","content":"ğŸŒ‰é¡¹ç›®å·¥ç¨‹åŒ–æ’ä»¶PrettierPrettier | æ–‡æ¡£https://www.prettier.cn/ Prettier.jsåœ¨é¡¹ç›®ä¸­é…ç½®æ— æ•ˆï¼Œå¦‚ä½•è§£å†³ï¼Ÿ é—®é¢˜æè¿° ç¼–è¯‘å™¨ï¼šCursor 0.49.6Prettierç‰ˆæœ¬ï¼š3.0.0é¡¹ç›®æ ¹ç›®å½•ä¸‹é…ç½®çš„.prettierrc.jså¦‚ä¸‹.prettierrc.jsmodule.exports = semi: false, // æ— åˆ†å· printWidth: 100, // æ¯è¡Œæœ€å¤šå®½åº¦ singleQuote: true, // å•å¼•å· endOfLine: auto, // ä¿æŒç°æœ‰çš„è¡Œå°¾ importOrder: [^@/(.*)$, ^@yige/(.*)$, ^[./]], importOrderSeparation: true, importOrderSortSpecifiers: true, plugins: [ require(@trivago/prettier-plugin-sort-imports), require(prettier-plugin-tailwindcss), ], tailwindConfig: ./tailwind.config.js,å‘ç°å½“æ ¼å¼åŒ–çš„æ—¶å€™ï¼ŒPrettierçš„æ§åˆ¶å°æŠ¥é”™ï¼šPrettier Error resolving prettier configuration for x:\\xxx\\.prettierrc.jsæ ¹æ®æŠ¥é”™ä¿¡æ¯å¯ä»¥çœ‹å‡ºæ ¼å¼åŒ–æ—¶ï¼Œé…ç½®æ–‡ä»¶ç¡®å®ä½¿ç”¨çš„æ˜¯æ ¹ç›®å½•ä¸‹çš„.prettierrc.jsæ–‡ä»¶ï¼Œä½†æ˜¯æ–‡ä»¶çš„é…ç½®å†…å®¹ä¼¼ä¹ä¸å¯¹ã€‚ è§£å†³æ–¹æ³• å¯¼è‡´Prettieræ ¼å¼åŒ–å¤±æ•ˆ+æŠ¥é”™ï¼Œä¸€å…±æœ‰ä¸¤ä¸ªåŸå› ï¼šåŸå› 1ï¼šprettierç‰ˆæœ¬ä¸pluginé…ç½®çš„è¯­æ³•ä¸åŒ¹é…ä¸»è¦æ˜¯å…¶ä¸­æœ‰ä¸ªé…ç½®é¡¹pluginsï¼Œåœ¨prettier 3.x.xç‰ˆæœ¬ä¸­å’Œ2.x.xç‰ˆæœ¬ä¸­çš„è¯­æ³•æ˜¯ä¸åŒçš„ï¼Œ3.x.xä¸­ï¼Œä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œå®šä¹‰ï¼šmodule.exports = // ... plugins: [@trivago/prettier-plugin-sort-imports, prettier-plugin-tailwindcss],2.x.xä¸­ï¼Œä½¿ç”¨å¼•ç”¨æ–¹å¼è¿›è¡Œå®šä¹‰ï¼šmodule.exports = // ... plugins: [ require(@trivago/prettier-plugin-sort-imports), require(prettier-plugin-tailwindcss), ],åŸå› 2ï¼š.prettierrc.js ä¿®æ”¹åéœ€è¦é‡å¯ç¼–è¯‘å™¨æ‰èƒ½ç”Ÿæ•ˆ ï¼ˆå‚è€ƒæ¥æºï¼‰prettieræä¾›å¾ˆå¤šç§é…ç½®æ¨¡å¼ï¼š.prettierrc.jsonyamlymljson5toml.prettierrc.jstsmjsmtscjsctsprettier.config.jstsmjsmtscjsctsä½†æ˜¯ä¸åŒé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åç”Ÿæ•ˆçš„æ–¹å¼ä¸åŒï¼š.prettierrc.jsonï¼šæ— éœ€é‡å¯ç¼–è¯‘å™¨å°±èƒ½é‡æ–°ç”Ÿæ•ˆ.prettierrc.jscjsmjstsï¼šå¿…é¡»é‡å¯ç¼–è¯‘å™¨æ‰èƒ½ç”Ÿæ•ˆè¿™ä¸ªé¡¹ç›®çš„ prettier ç‰ˆæœ¬æ˜¯3.0.0ï¼Œå¯¹åº”çš„pluginsä¸åº”è¯¥ä½¿ç”¨requireå¼•å…¥ï¼Œå› æ­¤å¯¼è‡´æŠ¥é”™ï¼Œå†åŠ ä¸Šä¸€ç›´éƒ½æ²¡å‘ç°å¿…é¡»è¦é‡å¯ç¼–è¯‘å™¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æ³•è§£å†³è¿™ä¸ªé—®é¢˜ğŸ˜­æœ€ç»ˆæœ‰2ç§è§£å†³æ–¹å¼ï¼šæ–¹å¼1ï¼šå°†prettierç‰ˆæœ¬é€€å›åˆ°2.x.xç‰ˆæœ¬ï¼ˆæ¯”å¦‚2.8.8ï¼‰æ–¹å¼2ï¼šä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼å¼•å…¥plugins npmåŒ…å®ç°å„ç§npmåŒ…çš„å°è£… åŸºäºvueçš„ç»„ä»¶åŒ…å°è£…å·¥å…·å‡½æ•°åŒ…å°è£…npmä¸­æ–‡æ–‡æ¡£ npm installæŠ¥é”™ï¼šCertificate has expiredé”™è¯¯æè¿° E:\\register\\other\\threejs-factorynpm install -g cnpm -registry=https://registry.npm.taobao.orgnpm ERR! code CERT_HAS_EXPIREDnpm ERR! errno CERT_HAS_EXPIREDnpm ERR! request to https://registry.npm.taobao.org/cnpm failed, reason: certificate has expirednpm ERR! A complete log of this run can be found in: C:\\Users\\Administrator\\AppData\\Local pm-cache\\_logs\\2024-01-23T01_39_23_371Z-debug-0.logçœ‹é”™è¯¯åº”è¯¥æ˜¯ç¼ºç­¾åè¯ä¹¦ é—®é¢˜è§£å†³ åŸBloghttps://blog.csdn.net/qq_42761482/article/details/121018086å½“ strict-ssl è®¾ç½®ä¸º true æ—¶ï¼Œnpm ä¼šå¯¹è¿æ¥çš„æœåŠ¡å™¨çš„ SSL è¯ä¹¦è¿›è¡Œä¸¥æ ¼çš„æ ¡éªŒï¼Œå¹¶è¦æ±‚å®ƒæ˜¯ç”±å¯ä¿¡çš„è®¤è¯æœºæ„é¢å‘çš„ã€‚å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œnpmå°†æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä¼šæŠ¥é”™ã€‚å½“ strict-ssl è®¾ç½®ä¸º false æ—¶ï¼Œnpm å°†ä¸ä¼šå¯¹æœåŠ¡å™¨çš„ SSL è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œ å¹¶ä¸”å³ä½¿è¯ä¹¦æ˜¯ç”±ä¸å¯ä¿¡çš„è®¤è¯æœºæ„é¢å‘çš„ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› ä¸ºç½‘ç»œæµé‡å¯èƒ½è¢«åŠ«æŒæˆ–ç¯¡æ”¹ã€‚å¦‚æœçŸ­æœŸå†…å› ä¸ºç¼ºå°‘SSLè¯ä¹¦æ— æ³•installä¾èµ–ï¼Œå¯ä»¥ç°å°†strict-sslè®¾ç½®ä¸ºfalseï¼Œå®‰å…¨èµ·è§ï¼Œä¸‹è½½å®Œåå°½å¿«ä¿®æ”¹å›truenpm set strict-ssl false åç»­è¡¥å…… https://blog.csdn.net/m0_74802419/article/details/135832868?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170625330016800184187977%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170625330016800184187977&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-135832868-null-null.142https://blog.csdn.net/m0_74802419/article/details/135832868?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170625330016800184187977%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=170625330016800184187977&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-135832868-null-null.142æˆ‘æ˜¯ç”¨çš„æ˜¯æ·˜å®é•œåƒåŸŸåï¼šregistry.npm.taobao.orgè‡ª2024.1.22æ—¥å¼€å§‹ï¼Œæ·˜å®åŸé•œåƒåŸŸåçš„HTTPSè¯ä¹¦æ­£å¼åˆ°æœŸï¼Œè¿™ä¹Ÿæ˜¯æŠ¥ç¼ºå°‘ç­¾åè¯ä¹¦é”™è¯¯çš„åŸå› ï¼Œéœ€è¦å°†npmæºåˆ‡æ¢åˆ°æ–°çš„æºæ‰è¡Œï¼šregistry.npmmirror.com npm install æŠ¥æƒé™é”™è¯¯ï¼šnpm EPERM: operation not permittedé—®é¢˜æè¿° åœ¨å®‰è£…cnpmæ—¶ï¼ŒnpmæŠ¥é”™ï¼šnpm EPERM: operation not permittedçœ‹æ¥æ˜¯æ“ä½œæƒé™é—®é¢˜ï¼Œä½†æ˜¯cmdæ˜¯ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ï¼Œç¯å¢ƒå˜é‡ä¸€ä¸ªä¸ç¼ºï¼Œæ–‡ä»¶æƒé™ä¹Ÿå…¨æœ‰ è§£å†³æ–¹æ³• æœ€åå‘ç°æ˜¯npmç‰ˆæœ¬å¤ªä½ï¼ˆnpm6 + node14ï¼‰ï¼Œæ¢æˆé«˜ç‰ˆæœ¬npmå°±å¥½äº†ï¼ˆnpm9 + node18ï¼‰ npm install ä¾èµ–ç‰ˆæœ¬å†²çªnpm install --legacy-peer-deps cnpm install å¯¼è‡´vueé¡¹ç›®å¯åŠ¨å @vueruntime-core æŠ¥ç¼ºé”™é—®é¢˜æè¿° å®‰è£…npmåŒ…ä¸ºäº†æ›´å¿«ï¼Œç”¨çš„cnpmè¿›è¡Œå®‰è£…ï¼Œä½†æ˜¯é¡¹ç›®è¿è¡Œçš„æ—¶å€™æŠ¥é”™ï¼šFailed to resolve import @vue/runtime-core è§£å†³æ–¹å¼ å•ç‹¬å®‰è£…@vueruntime-coreç”¨npmé‡è£…ä¸€éï¼ˆç®€å•ç²—æš´ç‰ˆï¼‰å‚è€ƒæ–‡ä»¶ï¼špnpm å¯¼è‡´d.tsä¸­@vueruntime-core ç”³æ˜å¤±æ•ˆé—®é¢˜è§£å†³æ–¹æ¡ˆ parcel.jsparcelå‘½ä»¤æŠ¥ç‰ˆæœ¬ä¸åŒ¹é…é”™è¯¯é—®é¢˜æè¿° [ThrowableDiagnostic [Error]: The plugin @parcel/reporter-dev-server is not compatible with the current version of Parcel. Requires ^2.11.0 but the current version is 2.10.3.] diagnostics: [ message: The plugin @parcel/reporter-dev-server is not compatible with the current version of Parcel. Requires ^2.11.0 but the current version is 2.10.3., origin: @parcel/core, codeFrames: [Array] ]æåˆ° @parcelreporter-dev-server å’Œå½“å‰ parcel çš„ç‰ˆæœ¬ä¸åŒ¹é…éœ€è¦2.11.0ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯å½“å‰æ˜¯2.10.3ç‰ˆæœ¬çš„ï¼Œä½†æ˜¯package.jsoné‡Œçš„parcelç‰ˆæœ¬æ˜æ˜æ˜¯2.11.0 é—®é¢˜è§£å†³ å¯åŠ¨é¡¹ç›®çš„æ˜¯å…¨å±€parcelä¸æ˜¯é¡¹ç›®é‡Œå®‰è£…çš„parcelï¼Œå› æ­¤éœ€è¦æ›´æ–°å…¨å±€parcelæ‰è¡Œï¼šnpm i -g parcel@2.11.0 SheetJSSheetJSå®˜æ–¹æ–‡æ¡£https://docs.sheetjs.com/docs/ å¯¼å…¥excelè¡¨æ ¼æ—¶é—´æ ¼å¼é”™è¯¯é—®é¢˜æè¿° æ­£åœ¨ä¿®å¤ä¸€ä¸ªå‡ ç™¾å¹´å‰çš„ç¥–ä¼ é¡¹ç›®ï¼Œå…¶ä¸­ç‰µæ‰¯åˆ°ä¸€ä¸ªå¯¼å…¥excelè¡¨æ ¼çš„æ“ä½œï¼Œç»“æœå‘ç°excelé‡Œé¢è¢«è§„èŒƒåŒ–ä¸ºæ—¥æœŸçš„å­—æ®µå¯¼å…¥ç½‘é¡µå°±å…¨å˜æˆäº†ä¸€ä¸ªå¾ˆç¦»è°±çš„æ•°å­—ï¼Œæˆ‘çŒœæƒ³å¯èƒ½æ˜¯æ ¼å¼è½¬æ¢å¯¼è‡´çš„é”™è¯¯ï¼Œä¸‹é¢å°±æ˜¯ä¿®æ”¹æ–¹æ³•ï¼šå‚è€ƒåšå®¢https://blog.csdn.net/m0_60694178/article/details/126389187 node-sasså®‰è£…æŠ¥é”™é—®é¢˜æè¿° è™½ç„¶åœ¨è¿™ä¸ªåº“å·²ç»å¤§éƒ¨åˆ†çš„è¢«sasså–ä»£ï¼Œä½†æ˜¯å¾ˆå¤šè€é¡¹ç›®è¿˜åœ¨ä½¿ç”¨ï¼Œnode-sassè¿™ä¸ªåº“å®‰è£…10æ¬¡ï¼Œ10æ¬¡æŠ¥é”™ï¼ŒçœŸçš„å¾ˆçƒ¦ã€‚ é—®é¢˜è§£å†³ æ’æŸ¥1ï¼šæ£€æŸ¥nodeç‰ˆæœ¬nodeå’Œnode-sassæœ‰ä¸¥æ ¼çš„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œå¦‚æœç‰ˆæœ¬ä¸å¯¹åº”å°±ä¼šæŠ¥é”™ï¼šå®˜æ–¹æ–‡æ¡£æˆ‘å®‰è£…1.14.0ç‰ˆæœ¬çš„node-sassï¼Œå› æ­¤å°±éœ€è¦å®‰è£…14ç‰ˆæœ¬çš„nodeæ’æŸ¥2ï¼šError: EPERM: operation not permittedå­—é¢æ„æ€ä¸Šä¼¼ä¹æ˜¯è¯´ï¼šæ“ä½œä¸è¢«å…è®¸ã€‚è¿™ç§æŠ¥é”™ä¸€èˆ¬æƒ…å†µä¸‹éƒ½èƒ½ç”¨ è¿™ç¯‡åšå®¢ ä¸­æä¾›çš„è§£å†³æ–¹å¼è§£å†³å¦‚æœæ˜¯å®‰è£…é€Ÿåº¦æ…¢çš„è¯å¯ä»¥å‚è€ƒ è¿™ç¯‡åšå®¢ å…ˆæ˜¯é™ä½npmç‰ˆæœ¬åˆ°5.3.0ï¼Œå®‰è£…å¡åœ¨äº†\\vendor\\win32-x64-83\\binding.nodeä¸Šunlink E:\\wsy\\register\\fork\\vue3-drag-resize-rotate ode_modules\\.node-sass.DELETE\\vendor\\win32-x64-83\\binding.nodeåˆšçœ‹è¿™ä¸€è¡Œï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¿™ä¸ªæ–‡ä»¶ä¸‹è½½ä¸ä¸‹æ¥ï¼Œä½†æ˜¯ä»”ç»†çœ‹çš„è¯å°±ä¼šå‘ç°æŠ¥çš„æ˜¯unlinké”™ï¼Œå¹¶ä¸”è¿˜ä¼´éšoperation not permittedï¼Œåæ¥æ‰å‘ç°åŸæ¥æ˜¯åœ¨æˆ‘è¯•å›¾install node-sassåŒ…çš„æ—¶å€™ï¼Œé¡¹ç›®ç«Ÿç„¶è¿˜ä¸€ç›´å¯ç€ï¼ˆnpm run devï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸€ç›´éƒ½åœ¨è¢«å ç”¨ï¼ˆä¹‹å‰å®‰è£…è¿‡ä¸€ä¸ªé«˜ç‰ˆæœ¬çš„node-sassï¼Œæƒ³è¦ç›´æ¥æŠŠå®ƒæ›¿æ¢ï¼‰ï¼Œæ‰€ä»¥åœ¨å®‰è£…æ–°ç‰ˆæœ¬åŒ…çš„æ—¶å€™ä¸€ç›´éƒ½æç¤ºä¸å…è®¸ï¼ˆnpm removeæ²¡æœ‰æ¸…ç†å¹²å‡€ï¼Œå¿½è§†äº†è¢«å ç”¨çš„æ–‡ä»¶ï¼‰ï¼ŒæŠŠé¡¹ç›®å…³é—­åï¼Œå°±èƒ½æ­£å¸¸å®‰è£…node-sassäº†ã€‚ vis-timelineä¸­æ–‡zh-chæœ¬åœ°åŒ–å‚è€ƒåšå®¢import moment/dist/locale/zh-cn.jslet opiton = // ... locale:zh-cn, // æœ¬åœ°åŒ–é…ç½®let timeline = new vis.Timeline(targetDom, itemData, groupData, option)è¿™é‡Œä¼¼ä¹åªèƒ½ç”¨momentçš„zh-cnï¼Œå¼•å…¥dayjslocalezh-cn.jsæ— æ•ˆ"},{"title":"ECharts å›¾è¡¨åº“","path":"/notes/npm_echarts.html","content":"echartsä¸­æ–‡å®˜ç½‘https://echarts.apache.org/zh/index.html echartsçš„customç±»å‹å®ç°çš„ç”˜ç‰¹å›¾ç”˜ç‰¹å›¾æ¡ˆä¾‹åœ°å€https://echarts.apache.org/examples/zh/editor.html?c=custom-profile ToolTipè§¦å‘æ—¶å¯¹å›¾ä¾‹è¿›è¡Œæ’åºæ“ä½œ å…³é”®ä»£ç  tooltip.formatter é…ç½®ä¸ºå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å‚æ•°ä¸ºåŒ…å«æ‰€æœ‰seriesçš„æ•°ç»„seriesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰å¦‚ä¸‹å±æ€§ seriesItem.seriesIndex seriesçš„ç»˜åˆ¶ç´¢å¼•seriesItem.seriesName seriesçš„åç§°seriesItem.value seriesçš„å€¼seriesItem.marker echartsçš„åŸç”Ÿå›¾ä¾‹å‰å½©è‰²åŸç‚¹htmlå…ƒç´ seriesItem.axisValueLabel è§¦å‘tooltipçš„åæ ‡è½´å€¼tooltip: trigger: axis, axisPointer: type: shadow , // é‡ç»„ä»£ç  formatter: function (params) if(!Array.isArray(params)) return params = params.sort((a, b) = (b.value - a.value)).map((i,index) = i.seriesIndex = index return i ) let axis = params[0].axisValueLabel let head = `div style=margin-bottom:10px;font-size:14px;color:#666;font-weight:400;line-height:1;$axis/div` return head+ params.map(i = let name = `span style=font-size:14px;color:#666;font-weight:400;margin-left:2px$i.seriesName/span` let value = `span style=float:right;margin-left:20px;font-size:14px;color:#666;font-weight:900$i.value/span` return i.marker+ name +value ).join(br/); , axisPointer: type: shadow å¤šæŠ˜çº¿å›¾ç›¸äº’å †å çš„emphasisæ ·å¼é—®é¢˜ å¤šæŠ˜çº¿å›¾å †å æœ¬æ¥èƒ½å¤Ÿè®©è¢«è§¦å‘seriesä»¥å¤–çš„å…¶ä»–seriesæ·¡å‡ºï¼Œå¦‚ä¸‹é…ç½®ï¼š emphasis: focus:series ä½†æ˜¯å®¢æˆ·ä¸æƒ³è¦æ·¡å‡ºçš„æ•ˆæœï¼Œéå¾—ä¸æ·¡å‡ºæ”¹å˜seriesçš„å±‚çº§ï¼Œé‚£æ€•ä¸æ˜¯è¦åŠ¨æ€æ”¹å˜seriesçš„zLevelï¼Œå¯å¤ªéº»çƒ¦äº†ã€‚è¿™é‡Œçš„æ€è·¯æ˜¯åˆ©ç”¨eChartsåŸç”Ÿçš„é«˜äº®äº‹ä»¶ï¼Œä½†æ˜¯å¯¹seriesçš„æ·¡å‡ºæ ·å¼è¿›è¡Œæ§åˆ¶ï¼Œä»£ç å¦‚ä¸‹ï¼š emphasis: focus:series ,blur: , // è§„èŒƒæ·¡å‡ºæ ·å¼ itemStyle: opacity: 1, lineStyle: opacity: 1 , label: opacity: 1 è™šçº¿å®çº¿æ··åˆä½¿ç”¨çš„æŠ˜çº¿å›¾ é—®é¢˜æè¿° æŠ˜çº¿å›¾å±•ç¤ºå„ä¸ªæœˆä»½æŸé¡¹æ•°å€¼çš„å˜åŒ–ï¼Œä½†æ˜¯æœ‰çš„æœˆä»½æ²¡æœ‰æ•°æ®ï¼Œå®¢æˆ·å¸Œæœ›æ²¡æœ‰æ•°æ®çš„æœˆä»½æ•°æ®å‡å®šä¸ºä¸Šä¸ªæœˆçš„æ•°æ® ï¼Œä¸Šä¸ªæœˆå¦‚æœä¹Ÿæ²¡æœ‰æ•°æ®å†å‡è®¾ä¸ºä¸Šä¸Šä¸ªæœˆçš„æ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå‡æ•°æ®è¦ç”¨è™šçº¿æ ‡å‡ºï¼ŒçœŸæ•°æ®ç”¨å®çº¿ã€‚ å®ç°æ€è·¯ è¿™é‡Œå½“ç„¶å°±ä¸æŒ‡æœ›EChartsåŸç”Ÿçš„æŠ˜çº¿å›¾èƒ½å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œå› æ­¤éœ€è¦éšè—æŠ˜çº¿å›¾çš„è¿çº¿ï¼Œå¯ä»¥æŠŠçº¿å®½è®¾ç½®ä¸º0ï¼Œä¹Ÿå¯ä»¥æŠŠé¢œè‰²é…ç½®ä¸ºé€æ˜ï¼Œç„¶åä½¿ç”¨ markLine ä¾æ¬¡è¿æ¥å‰åä¸¤ç‚¹ï¼Œåˆ¤æ–­æœˆä»½æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœå­˜åœ¨æœˆä»½æ•°æ®ï¼Œä½¿ç”¨å®çº¿è¿æ¥ï¼Œ å¦‚æœç¼ºå¤±æœˆä»½æ•°æ®ï¼Œä½¿ç”¨è™šçº¿è¿æ¥"},{"title":"TypeScript è¯­è¨€","path":"/notes/lang_typescript.html","content":"tsconfig.jsonimportç¬¬ä¸‰æ–¹åº“æ—¶æŠ¥é”™ï¼šä¸å­˜åœ¨æŒ‡å®šæ–‡ä»¶å‚è€ƒåšå®¢åœ¨threejs + tsçš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨threeexamplesjsmä¸‹çš„æ–‡ä»¶ï¼Œç¼–è¯‘å™¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼šä¸€èˆ¬è¿™ç§æƒ…å†µéƒ½æ˜¯æ²¡æœ‰å®‰è£…ç¬¬ä¸‰æ–¹@typeåº“ï¼Œä½†æ˜¯è¿™å›æˆ‘å®‰è£…äº†@typesthreeï¼Œä½†æ˜¯ç¼–è¯‘å™¨å°±æ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨åœ¨tsconfig.jsonæ–‡ä»¶ä¸­é…ç½®ä¸€ä¸‹ï¼Œæ‰‹åŠ¨æŒ‡å®šç±»å‹è§£é‡Šæ–‡ä»¶çš„ä½ç½® compilerOptions: paths: three/examples/jsm/postprocessing/EffectComposer: [./node_modules/@types/three/examples/jsm/postprocessing/EffectComposer] tsæŠ¥é”™: ä¸å…è®¸ä½¿ç”¨å…¶å®ƒå‚æ•°æ‰¿æ¥thisæŠ¥é”™ä¿¡æ¯Unexpected aliasing of â€˜thisâ€™ to local variable.(@typescript-eslint/no-this-alias)è§£å†³æ–¹æ³•å‚è€ƒåšå®¢ä¿®æ”¹eslintrc.jsonçš„é…ç½® rules: @typescript-eslint/no-this-alias: [off] å…¶å®ƒtsé¡¹ç›®çƒ­æ›´æ–°å¤±è´¥é—®é¢˜æè¿° åœ¨vue+tsçš„é¡¹ç›®ä¸­ï¼Œå¯¹tsæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæµè§ˆå™¨ç«¯è¿è¡Œæ— æ•ˆï¼ŒæŸ¥çœ‹æµè§ˆå™¨sourceä¸­tsæ–‡ä»¶æºç ï¼Œå‘ç°ä»£ç ç¡®å®å·²ç»è¢«ä¿®æ”¹è¿‡ï¼Œä½†è¿è¡Œçš„ç»“æœå…¨æ˜¯ä¿®æ”¹å‰çš„ç»“æœã€‚ è§£å†³æ–¹æ³• é‡åˆ°è¿™ç§é—®é¢˜ï¼Œæ— è®ºæ˜¯æ¸…æµè§ˆå™¨ç¼“å­˜ï¼Œè¿˜æ˜¯æ¢æµè§ˆå™¨éƒ½æ˜¯æ²¡ç”¨çš„ï¼Œå› ä¸ºé—®é¢˜ä¸å‡ºåœ¨æµè§ˆå™¨ç«¯ï¼Œè€Œæ˜¯æœåŠ¡ç«¯tsæ²¡æœ‰é‡æ–°ç”Ÿæˆjsï¼Œæµè§ˆå™¨è¿è¡Œçš„å§‹ç»ˆæ˜¯ä¿®æ”¹å‰çš„tsç”Ÿæˆçš„jsä»£ç ï¼Œè€Œä¸”webstormé¡¹ç›®çš„ç›®å½•è¿˜è‡ªåŠ¨å±è”½äº†tsç”Ÿæˆçš„jsæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆç¼–è¯‘åçš„jsæ–‡ä»¶ï¼šä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤çš„æ–¹å¼ï¼ˆsrcç›®å½•ä¸‹ï¼‰ï¼Œåˆ é™¤ç”Ÿæˆçš„*.jså’Œ*.js.mapæ–‡ä»¶ï¼šgit rm -r *.js *.js.mapå‚è€ƒåšå®¢"},{"title":"Node","path":"/notes/server_node.html","content":"nvmnvmçš„å®‰è£…é…ç½® å‚è€ƒåšå®¢ç®€å•çš„æ€»ç»“ä¸‹æ­¥éª¤ï¼šå®˜ç½‘ä¸‹è½½å®‰è£…nvmä¿®æ”¹settings.txtï¼Œæ·»åŠ é•œåƒè„šæœ¬ï¼šnode_mirror: https://npmmirror.com/mirrors/node/node_mirror: https://npmmirror.com/mirrors/npm/ä¿®æ”¹nvmå®‰è£…æ–‡ä»¶çš„æ§åˆ¶æƒé™ä¸ºå®Œå…¨æ§åˆ¶ä¿®æ”¹æ–‡ä»¶æ‰§è¡Œæƒé™é…ç½®ç¯å¢ƒå˜é‡æœ‰å…³ç¯å¢ƒå˜é‡å’Œnpmçš„é…ç½®nvmå‘½ä»¤å®‰è£…åˆ‡æ¢nodeç‰ˆæœ¬æœ€åï¼Œå¯¹äºä½¿ç”¨webstormä½†æ˜¯å‘ç°æ–°æ›´çš„nodeç‰ˆæœ¬æ— è®ºå¦‚ä½•éƒ½æ— æ•ˆçš„ï¼šWindows nvm å®‰è£…åwebstrom vueé¡¹ç›®ç¼–è¯‘æŠ¥é”™ï¼Œæ— æ³•è¯†åˆ«nodeä¿®æ”¹Settingä¸­Nodeçš„ç‰ˆæœ¬åï¼Œç”¨Fileinvalidate cacheé‡å¯npm installæŠ¥é”™ä¸€æ¡é¾™æ“ä½œï¼šåˆ node_modulesåˆ package-lock.jsonæ¸…ç©ºnpmåŒ…ç¼“å­˜ï¼šnpm cache clean â€“forceæ¢nodeç‰ˆæœ¬ nvmåˆ‡æ¢ç‰ˆæœ¬å¤±è´¥é—®é¢˜æè¿° ç”¨nvm use x.x.xå‘½ä»¤ï¼Œå‘½ä»¤è¡Œæ‰“å°åˆ‡æ¢æˆåŠŸï¼Œä½†æ˜¯æ‰“å°nodeç‰ˆæœ¬æ—¶å‘ç°è¿˜æ˜¯åŸæ¥çš„ç‰ˆæœ¬ã€‚ è§£å†³æ–¹å¼1ï¼šç›´æ¥åˆ å ç”¨çš„nodeç‰ˆæœ¬ ä¸€å¼€å§‹è¿˜è§‰å¾—æ˜¯ç‰ˆæœ¬åˆ‡æ¢æœ‰é—®é¢˜ï¼Œä¸€æ°”ä¹‹ä¸‹å¹²è„†åˆ°nvmä¸»ç›®å½•é‡Œè¦æŠŠè¿™ä¸ªç‰ˆæœ¬ç»™åˆ æ‰ï¼Œç»“æœå‘ç°å®ƒå§‹ç»ˆè¢«å ç”¨ï¼Œæ ¹æœ¬åˆ ä¸æ‰ï¼Œåæ¥å‘ç°æ˜¯webstormæœåŠ¡ä¸€ç›´å ç”¨nodeï¼ˆå°±ç®—æ²¡å¼€å‰ç«¯æœåŠ¡ï¼‰æŠŠå ç”¨nodeçš„é‚£ä¸ªè¿›ç¨‹å…³äº†å°±èƒ½æ­£å¸¸åˆ‡æ¢ç‰ˆæœ¬äº†ã€‚ è§£å†³æ–¹æ³•2ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯nodeç‰ˆæœ¬å·çš„é—®é¢˜ å®‰è£…äº†node@14.0.0ç‰ˆæœ¬ï¼Œä½†æ˜¯æ— æ³•åˆ‡æ¢è¿‡å»ï¼šä½†æ˜¯ä½¿ç”¨node@14.16.0ç‰ˆæœ¬æ—¶ï¼Œåˆ‡æ¢å°±æ²¡æœ‰é—®é¢˜ï¼Œå› æ­¤æœ‰å¯èƒ½æ˜¯å› ä¸ºnodeç‰ˆæœ¬å·çš„é—®é¢˜ã€‚"},{"title":"npm æ’ä»¶æ¨è","path":"/notes/npm_packages.html","content":"VDRï¼ˆvue3-drag-resize-rotateï¼‰æŠ€æœ¯ç®€ä»‹ demoåœ°å€VDRæ˜¯ä¸€ä¸ªåŸºäºvueæ¡†æ¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®ç°domå…ƒç´ çš„æ‹–åŠ¨ã€ç¼©æ”¾ã€æ—‹è½¬ã€å›¾å±‚æ§åˆ¶ç­‰æ“ä½œçš„æ’ä»¶ï¼Œæ›´é«˜çº§çš„åŠŸèƒ½è¿˜æœ‰ç½‘æ ¼å¯¹é½ã€ä½ç½®å†²çªæ£€æµ‹ã€å…ƒç´ å¸é™„ã€è¾…åŠ©çº¿ç­‰ç­‰ï¼Œæä¾›äº†å¤§é‡çš„äº‹ä»¶å’Œè‡ªå®šä¹‰æ¥å£ï¼Œéå¸¸çµæ´»ï¼Œå®˜ç½‘æ–‡æ¡£å†™çš„å¾ˆå®Œå¤‡ï¼Œéå¸¸å¥½çš„æ’ä»¶ å®é™…ä½¿ç”¨ï¼šcanvas-base-vdr æœªå¡«å‘ï¼šç”»å¸ƒçš„ç¼©æ”¾æœ€åˆä½¿ç”¨æ»šè½®æ§åˆ¶ç”»å¸ƒzoomå€¼ï¼Œèƒ½å¤Ÿå®ç°ç”»å¸ƒæ”¶ç¼©çš„æ•ˆæœï¼Œå¹¶ä¸”ä¸æ”¹å˜domçš„åŸå§‹å°ºå¯¸ã€‚é—®é¢˜åœ¨äºzoomä¸ vdr çš„æ‹–æ‹½å’Œç¼©æ”¾è®¡ç®—æœ‰å†²çªã€‚å¯¼è‡´å¦‚ä¸‹é—®é¢˜ï¼šæ”¾å¤§åï¼Œç‰©ä½“ç§»åŠ¨è·ç¦»æ¯”é¼ æ ‡å®é™…çš„ç§»åŠ¨è·ç¦»è¦å¤§ï¼Œç¼©å°åï¼Œç‰©ä½“ç§»åŠ¨è·ç¦»æ¯”é¼ æ ‡çš„å®é™…ç§»åŠ¨è·ç¦»è¦å°vdråŸä½œè€…æ˜¯æä¾›domç¼©æ”¾åŠŸèƒ½çš„ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯scaleå˜æ¢ï¼Œä¼šæ”¹å˜å…ƒç´ çš„åŸå§‹å°ºå¯¸ï¼Œå› æ­¤è¿™éƒ¨åˆ†åé¢è¿˜æœ‰å¾…å®ç°ã€‚ vue-print-nb é¡µé¢åˆ†é¡µæŒ‡å®šå…ƒç´ æ‰“å°èƒ½å¤Ÿå¿«é€Ÿå®ç°é¡µé¢domå…ƒç´ æ‰“å°çš„Vueæ‰©å±•ï¼Œéå¸¸æ–¹ä¾¿ã€‚ä»£ç åº“åœ°å€npm install vue-print-nb --save"},{"title":"Vite å‰ç«¯æ„å»ºå·¥å…·","path":"/notes/npm_vite.html","content":"Viteé…ç½®Network: use --host to exposeé—®é¢˜æè¿° npm run devä¹‹åï¼Œä¸èƒ½é€šè¿‡IP + ç«¯å£çš„æ–¹å¼è®¿é—®åˆ°æœåŠ¡é¡µé¢ã€‚æ§åˆ¶å°æœ‰æç¤ºä¿¡æ¯ï¼šNetwork: use --host to expose è§£å†³æ–¹æ³• å‚è€ƒcsdnåšä¸»â€œå‹‡æ•¢çš„é˜¿å‘†â€åšå®¢åœ¨ vite.config.js ä¸­åŠ å…¥ server é…ç½®ï¼š...server: port:xxxx, // ç«¯å£å· host:true..."},{"title":"VSCode ç¼–è¾‘å™¨","path":"/notes/tool_VSCode.html","content":"æ§åˆ¶å°VSCodeæ§åˆ¶å°æ— æ³•ä½¿ç”¨æŸäº›å‘½ä»¤åœ¨ç”¨VSCodeæ§åˆ¶å°æ¿€æ´»condaç¯å¢ƒæ—¶æ€»æ˜¯å¤±è´¥ï¼Œä½†æ˜¯ä½¿ç”¨cmdåœ¨åŒä¸€ç›®å½•ä¸‹å¯ä»¥æˆåŠŸæ¿€æ´»ï¼Œè§£å†³æ–¹æ³•ï¼šhttps://blog.csdn.net/weixin_44566432/article/details/131155615https://blog.csdn.net/weixin_44566432/article/details/131155615VSCodeé»˜è®¤ä½¿ç”¨PowerShellè„šæœ¬ç¯å¢ƒï¼Œéœ€è¦åœ¨command promptè„šæœ¬ç¯å¢ƒä¸‹æ‰§è¡Œcondaå‘½ä»¤PowerShellè„šæœ¬å…·æœ‰è·¨å¹³å°ç‰¹æ€§ï¼ŒCommand Promptè„šæœ¬åˆ™ä¸»è¦åœ¨Windowså¹³å°è¿è¡Œ å¿«æ·é”® å•è¯é€‰ä¸­å¿«æ·é”®"},{"title":"Browser æµè§ˆå™¨","path":"/notes/web_Browser.html","content":"æ§åˆ¶å°è¾“å‡ºæ ·å¼ä¿®æ”¹ console.log( + %c Stellar v + stellar.version + %c + stellar.github + , color:#e8fafe;background:#03c7fa;padding:8px;border-radius:4px, margin-top:8px); windowwindow.openMDNå¯¹window.opençš„è¯´æ˜https://developer.mozilla.org/zh-CN/docs/Web/API/Window/open é—®é¢˜æè¿° å…¼å®¹æ€§ç›¸å…³åšå®¢https://www.codenong.com/cs105814578/window.open()å‚æ•°åŠæµè§ˆå™¨å…¼å®¹ window.topWindow.top ç°åœ¨æ‰‹ä¸Šæ˜¯ä¸€ä¸ªBSç«¯è¡¨æ ¼ç¼–è¾‘å™¨é¡¹ç›®ï¼Œæ”¯æŒè¡¨æ ¼çš„ç¼–è¾‘ã€è‡ªåŠ¨ç”Ÿæˆç­‰åŠŸèƒ½ï¼Œä½¿ç”¨äº†å¤§é‡çš„iframeæ ‡ç­¾ç”¨äºå¯¹ç»„ä»¶è¿›è¡Œæ¨¡å—åˆ’åˆ†ï¼Œå› æ­¤å½“å­çª—å£éœ€è¦è®¿é—®çˆ¶çª—å£çš„å±æ€§æˆ–å¯¹è±¡æ—¶ï¼Œå°±ä¸å¾—ä¸é€šè¿‡window.topè¿›è¡Œè®¿é—®ã€‚è·å–ä¸Šçº§çª—å£çš„APIwindow.top è·å–é¡¶å±‚çª—å£å¯¹è±¡window.parent è·å–çˆ¶çº§çª—å£å¯¹è±¡ æ€§èƒ½Chromeè¶…çº§å¡é—®é¢˜æè¿° å‚è€ƒåšå®¢ï¼šè§£å†³ chromeæ‰“å¼€å¤šä¸ªè§†é¢‘é¡µä¼šå¡é¡¿çš„é—®é¢˜Chrome Edge æµè§ˆå™¨å¡é¡¿å˜æ…¢è§†é¢‘æ‰å¸§é—®é¢˜æ­£åœ¨åšä¸€ä¸ªå¤§å±é¡¹ç›®ï¼Œä¸€ä¸ªé¡µé¢ä¸Šéœ€è¦æ¸²æŸ“8ä¸ªç›‘æ§è§†é¢‘ï¼Œå†åŠ ä¸Šé¢‘ç¹çš„domåŠ¨ç”»echartså›¾è¡¨æ¸²æŸ“threejsæ¸²æ€»çš„æ¥è¯´ï¼šå°±æ˜¯å¯¹æµè§ˆå™¨çš„æ€§èƒ½è¦æ±‚éå¸¸é«˜æˆ‘ä¸€å¼€å§‹æ˜¯ç”¨ chrome å¼€å‘çš„ï¼Œå¼€å‘åˆ°åé¢ 8ä¸ªç›‘æ§è§†é¢‘+6ä¸ªèƒŒæ™¯è§†é¢‘ç›´æ¥å¡åˆ°æˆ‘æ€€ç–‘äººç”Ÿ ï¼ˆè£‚å¼€ï¼‰äºæ˜¯å°±å„ç§ä¼˜åŒ–ï¼Œæ— å¤–ä¹å°±æ˜¯Light Houseæµ‹è¯•æ€§èƒ½ä¸è¯¥æ¸²æŸ“çš„domä¸æ¸²æŸ“ä½†æ˜¯æ— è®ºæ€ä¹ˆä¼˜åŒ–éƒ½å¾ˆå¡ï¼Œåé¢å¹²è„†è§†é¢‘éƒ½åŠ è½½ä¸å‡ºæ¥äº†ã€‚äºæ˜¯æˆ‘å¼€å§‹æ€€ç–‘æ˜¯æµè§ˆå™¨çš„é—®é¢˜ï¼Œæ¢äº†edgeåŠ è½½ä¹‹åï¼Œç½‘é¡µåŠ è½½æœç„¶æµç•…å¾ˆå¤šï¼Œçœ‹åˆ°ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´ å…³é—­æµè§ˆå™¨ç¡¬ä»¶åŠ é€Ÿ ä¹‹åå°±å¥½å¾ˆå¤šçš„ï¼Œä½†æ˜¯æˆ‘çš„ç”µè„‘å…³é—­ç¡¬ä»¶åŠ é€ŸåCPUç›´æ¥é£™åˆ°80%ã€90% åé¢è¯•ç€ç”¨äº†ç”¨ firefox åŠ è½½ï¼Œä¹Ÿå¾ˆå¿«ä½†æ˜¯firefoxçš„æ ·å¼å…¼å®¹ä¸Šé¢æ˜¯ç¡¬ä¼¤ï¼Œ Edgeæ€§èƒ½ç›‘è§†å™¨å·¥å…· å®˜æ–¹æ–‡æ¡£è€Œä¸”Edgeçš„issueæ£€æµ‹æ¯”chromeä¹Ÿçµæ•ä¸€äº›ï¼Œå¾ˆå¤šchromeæ£€æµ‹ä¸å‡ºæ¥çš„issueï¼ŒEdgeéƒ½ä¼šåœ¨è°ƒè¯•å°é‡Œæ‰“å°å‡ºæ¥ã€‚ è·¨åŸŸCORS Webæ€§èƒ½æƒå¨æŒ‡å—Webæ€§èƒ½æƒå¨æŒ‡å—åœ¨å‰åç«¯åˆ†ç¦»å¼€å‘ç¯å¢ƒä¸­ï¼Œåå°æœåŠ¡å™¨å“åº”å¤´ä¸­ Access-Control-Allow-Origin ä¼šä¸€ç›´è®¾ç½®ä¸º * çŠ¶æ€ï¼ˆéƒ¨åˆ†å¼€å‘ç¯å¢ƒä¸‹çš„ç‰¹ä¾‹ï¼‰ï¼Œä½†åœ¨ä¸Šçº¿åï¼ŒCSRæ¨¡å¼çš„é¡µé¢ä½œä¸ºé™æ€èµ„æºï¼Œè¿™æ—¶è¦å’Œåå°æœåŠ¡åœ¨åŒæºç­–ç•¥ä¸‹ä¸€èµ·è¢«æä¾›ï¼Œæ¥å£è¯·æ±‚çš„æ–¹å¼ä¹Ÿç”±ç»å¯¹è·¯å¾„å˜ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶çš„é™æ€èµ„æºæ˜¯æ•´ä¸ªåå°æœåŠ¡çš„é™„å±èµ„æºï¼Œå’Œæ¥å£èµ„æºå¤„äºåŒæºä¹‹ä¸‹ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒè·¨åŸŸçš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœAåº”ç”¨çš„é¡µé¢è¦è°ƒç”¨Båº”ç”¨çš„Xæ¥å£ï¼Œå¹¶ä¸”Båº”ç”¨æ²¡æœ‰å°†Xæ¥å£çš„èµ„æºè®¾ç½®ä¸ºå¯è·¨åŸŸè¯·æ±‚ï¼Œè¿™æ—¶å°±ä¼šé€ æˆè·¨åŸŸï¼Œä¸¤ç§å¸¸ç”¨çš„è§£å†³è·¨åŸŸçš„æ–¹å¼ï¼šjsonPcorsä»£ç†æœåŠ¡å™¨ JsonPåŸç† JsonPéœ€è¦æœåŠ¡å™¨é…åˆä¿®æ”¹æ¥å£è¿”å›æ•°æ®çš„æ–¹å¼ï¼Œå®¢æˆ·ç«¯è¯·æ±‚åˆ†ä¸ºï¼šåŠ¨æ€è¯·æ±‚ï¼šXHRæˆ–Fetchå‘é€çš„Httpè¯·æ±‚å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ç”±è„šæœ¬æ§åˆ¶é™æ€é¡µé¢èµ„æºï¼šscriptæ ‡ç­¾å¼•å…¥çš„èµ„æºå®Œå…¨ç”±æµè§ˆå™¨è¿è¡Œä¸å—è„šæœ¬å¹²é¢„ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯æ‰€ä»¥ï¼Œæµè§ˆå™¨ä¼šå¯¹åŠ¨æ€è¯·æ±‚å®è¡Œä¸¥æ ¼çš„è·¨åŸŸé™åˆ¶ï¼Œå¯¹é™æ€é¡µé¢èµ„æºä¼šæ›´åŠ å®½æ¾JSONPçš„æ–¹å¼ï¼Œå°±æ˜¯å°†åŠ¨æ€èµ„æºè½¬åŒ–ä¸ºé™æ€èµ„æºè¯·æ±‚ ä½¿ç”¨ **å®¢æˆ·ç«¯ï¼š**éœ€è¦å°†å›è°ƒå‡½æ•°ä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œå°†æ¥å£å½“åšé™æ€èµ„æºè¯·æ±‚script function success(data) alert(JSONPè¯·æ±‚æˆåŠŸ) console.log(data) function getJsonP() const script = document.createElement(script) script.src = http://10.5.6.88:4060/jsonpGet?callback=success document.body.append(script) document.getElementById(test-jsonp).onclick = getJsonP/script**æœåŠ¡å™¨ï¼š**æ‰‹åŠ¨åŒ…è£…ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ä¸­// jsonpapp.get(/jsonpGet,(req,res)= console.log(æ¥æ”¶åˆ°jsonpè¯·æ±‚) const callback = req.query.callback // å›è°ƒå‡½æ•° console.log(req) const resData = code:200, message:æ”¶åˆ°äº†ä½ çš„è¯·æ±‚ console.log(callback) if(callback) let data = JSON.stringify(resData) res.end(callback+`($data)`) // æ‰‹åŠ¨åŒ…è£… else res.send(resData) ) CorsåŸç† Corsæ–¹æ³•éœ€è¦æœåŠ¡å™¨ä¿®æ”¹å“åº”å¤´å¦‚æœæœåŠ¡å™¨ä¸»åŠ¨è¡¨æ€ï¼šå¯ä»¥æ¥å—è·¨åŸŸè·å–èµ„æºï¼Œé‚£ä¹ˆè·¨åŸŸè¯·æ±‚ä¹Ÿèƒ½å¤Ÿå®ç°ã€‚è¿™ç§æ–¹å¼å°±æ˜¯æœåŠ¡å™¨é€šè¿‡é…ç½®access-control-allow-originä¸»åŠ¨å¼€æ”¾è·¨åŸŸè¯·æ±‚ å®ç° å®¢æˆ·ç«¯ï¼šæ­£å¸¸è¯·æ±‚script function getCors() fetch(http://10.5.6.88:4060/corsGet,method:GET).then(res= if(res.ok) return res.json() ).then(res= alert(`è¯·æ±‚æˆåŠŸï¼š$res.messasge`) ) document.getElementById(test-cors).onclick = getCors/scriptæœåŠ¡å™¨ï¼šå°†å“åº”å¤´ä¸­çš„access-control-allow-originå¼€æ”¾ï¼šapp.get(/corsGet,(req,res)= res.setHeader(access-control-allow-origin,*) res.send( code:200, messasge:æˆ‘å…è®¸ä½ è·¨åŸŸè¯·æ±‚èµ„æº )) ä»£ç†æœåŠ¡å™¨åŸç† åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨é™åˆ¶çš„ï¼Œé‚£åªè¦ä¸ç»è¿‡æµè§ˆå™¨å‘é€è¯·æ±‚å°±è¡Œï¼Œè¿™æ—¶å€™åŠ å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿèƒ½å¤Ÿç»•è¿‡åŒæºç­–ç•¥ å®ç° å®¢æˆ·ç«¯ï¼šæ­£å¸¸å‘ä»£ç†æœåŠ¡å™¨å‘èµ·è¯·æ±‚script function getCors() fetch(http://10.5.6.88:4060/third,method:GET).then(res= if(res.ok) return res.json() ).then(res= alert(`è¯·æ±‚æˆåŠŸï¼š$JSON.stringify(res)`) ) document.getElementById(test-third).onclick = getCors/scriptæœåŠ¡å™¨ï¼šå‘ç¬¬ä¸‰æ–¹å‘èµ·è¯·æ±‚ï¼Œè¿”å›æ•°æ®const proxy_url = www.third.com // ç¬¬ä¸‰æ–¹åœ°å€// ä»£ç†app.get(/third,(req, res)= res.setHeader(access-control-allow-origin,*) axios.get(proxy_url) .then(data= console.log(è½¬å‘æˆåŠŸ) res.send(data.data) ).catch(err= console.log(è½¬å‘å¤±è´¥,err) res.send(err) ))"},{"title":"å¥½ç”¨çš„è½¯ä»¶å·¥å…·","path":"/notes/tool_tools.html","content":"åŠ é€Ÿå™¨GithubåŠ é€Ÿå™¨æ¨ä»£ç åˆ°githubä¸Šæ€»æ˜¯æ—¶æ–­æ—¶ç»­çš„æ‰¾åˆ°ä¸€ç¯‡çŸ¥ä¹åšä¸»çš„æ–‡ç« ï¼šhttps://zhuanlan.zhihu.com/p/437818581https://zhuanlan.zhihu.com/p/437818581å…¶ä¸­æœ€åä¸€æ¡fastgithubçœŸçš„å¾ˆå¥½ç”¨ï¼Œè½¯ä»¶åŸä»“åº“å·²ç»è¢«åˆ äº†ï¼Œä½†æ˜¯è¢«çƒ­å¿ƒç½‘å‹ç»™æå‰æ‰“åŒ…åˆ°å…¶ä»–ä»“åº“äº†https://gitee.com/XingYuan55/FastGithub/releases/tag/2.1.4https://gitee.com/XingYuan55/FastGithub/releases/tag/2.1.4"},{"title":"CSS é­”æ³•","path":"/notes/web_css.html","content":"Csså…‰æ ‡ caretcaret-color å…‰æ ‡é¢œè‰² caret-colorå¯ä»¥ç”¨æ¥ä¿®æ”¹å…‰æ ‡é¢œè‰²caret-color: red; èƒŒæ™¯backdrop-filter æ¯›ç»ç’ƒæ•ˆæœ å‚è€ƒåšå®¢ï¼š CSSç®€æ˜“æ¯›ç»ç’ƒæ•ˆæœbackdrop-filterç”¨äºç»™èƒŒæ™¯æ·»åŠ æ»¤é•œæ•ˆæœbackdrop-filter: blur(5px); TEXT æ–‡å­—æ–‡å­—æœ«ç«¯æ·»åŠ çœç•¥å· å‚è€ƒï¼šCSSå¤šè¡Œæ–‡æœ¬çœç•¥å·å•è¡Œæœ«ç«¯æ·»åŠ çœç•¥å·.box width:200px; /* è®¾ç½®å®½åº¦ */ white-space: nowrap; /* ç¦æ­¢æ¢è¡Œ */ overflow: hidden; /* è¶…å‡ºéšè— */ text-overflow: ellipsis; /* è®¾ç½®çœç•¥å· */ æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å·æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å·æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å·å¤šè¡Œæœ«ç«¯æ·»åŠ çœç•¥å·.container display: -webkit-box; /* è®¾ç½®webkitæµä½“å¸ƒå±€ */ -webkit-line-clamp: 2; /* å¸Œæœ›å±•ç¤ºçš„è¡Œæ•° */ -webkit-box-orient: vertical; /* å‚ç›´æ’åˆ—çš„æ•ˆæœ */ overflow: hidden; text-overflow: ellipsis; /* è®¾ç½®çœç•¥å· */ æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å·æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å·æ­¤å¤„æ–‡å­—åæ·»åŠ çœç•¥å· å®šä½fixedæ— æ³•ç›¸å¯¹çˆ¶å…ƒç´ å®šä½å‚è€ƒåšå®¢fixedå®šä½ä»…ä»…èƒ½ç›¸å¯¹äºæµè§ˆå™¨çª—å£ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®fixedå…ƒç´ çš„marginæ¥å®ç°div class=wrapper-box div class=scroll-box div class=inner-fix-boxFix Box/div /div/div.wrapper-box width:100px; height:100px; background: #ffaa00; overflow-y:scroll ;.scroll-box width:100%; height:300px; position:relative; z-index:99;.inner-fix-box width:100%; position:fixed; color:#000; colorç›¸å¯¹é¢œè‰²è¯­æ³•Googleä¸“æ ï¼šCSSç›¸å¯¹é¢œè‰²è¯­æ³• ä¿®æ”¹ä¸é€æ˜åº¦ color: rgb(from #00800080 r g b / alpha); /* alpha=50% */color: rgb(from rgba(0,128,0,.5) r g b / alpha); /* alpha=50% */color: rgb(from rgb(0 128 0 / 50%) r g b / alpha); /* alpha=50% */ å¸ƒå±€gridé˜®ä¸€å³°ï¼šCSS Gridç½‘æ ¼å¸ƒå±€æ•™ç¨‹ å“åº”å¼åª’ä½“æŸ¥è¯¢ @mediaMDN"},{"title":"HTML","path":"/notes/web_html.html","content":"WebAPIshadow dom ShadowRoot å…¬å¸çš„é¡¹ç›®ç”¨çš„æ˜¯jqueryæ¡†æ¶ï¼Œç»„ä»¶å°è£…ç”¨çš„æ˜¯HTMLElementï¼Œç»„ä»¶å†…éƒ¨çš„ç»“æ„å…¨éƒ¨ä½¿ç”¨shadowRootè¿›è¡ŒåŒ…è£…ã€‚HTMLElementè‡ªå®šä¹‰ç»„ä»¶class MyHello extends HTMLElement constructor() super(); // åˆ›å»ºç»„ä»¶çš„ Shadow DOM this.attachShadow(mode:open) // åˆ›å»ºç»„ä»¶å†…éƒ¨çš„å…ƒç´  const container = document.createElement(div) container.setAttribute(class, container) const content = ` img width=100px src=./img/toby_dog.jpg alt= div class=li-content p class=li-titleList Tag/p p class=li-contentList Content/p /div ` container.innerHTML = content // æ ·å¼è®¾ç½® const style = document.createElement(style) style.textContent = ` .container border:1px solid #000; display:flex .li-content border:1px solid #000; .li-title font-weight:bold .li-content ` // å°†å…ƒç´ æ·»åŠ åˆ°Shadow DOMä¸­ this.shadowRoot.appendChild(container) this.shadowRoot.appendChild(style) // æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶customElements.define(my-hello, MyHello)head script src=components/my_hello.js/script/headbody my-hello/my-hello/body FullScreen å…¨å±API MDNï¼šå…¨å±API å®ç°ç½‘ç«™è‡ªåŠ¨å…¨å±ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°å¯ä»¥å®ç°çš„æ–¹æ³•ï¼Œç½‘ç«™è¦æƒ³è¿›å…¥å…¨å±å¿…é¡»å¾—è¦äº¤äº’è§¦å‘ï¼Œå¦åˆ™åœ¨è°ƒç”¨requestFullscreenæ—¶ä¼šè¿”å›æŠ¥é”™ï¼šTypeError: Permissions check failed at HTMLHeadingElement.toggleFullscreen (index.html:68:31) at index.html:79:50çœ‹äº†å‡ ä¸ªstackoverflowçš„é«˜èµå›ç­”ï¼Œä¸»è¦ä¹Ÿæ˜¯åŠæ”¾å¼ƒè¿™ç§éœ€æ±‚ï¼šRun a website in fullscreen modeFailed to execute â€˜requestFullScreenâ€™ on â€˜Elementâ€™ [duplicate]è¿™ç§è®¾è®¡æ˜¯å‡ºäºå®‰å…¨å’Œäº¤äº’æ€§çš„è€ƒè™‘ï¼Œ ä¹Ÿæœ‰å›ç­”è¯´å¦‚æœçœŸçš„æƒ³è¦å®ç°è¿™ç§å¼ºåˆ¶å…¨å±æ˜¾ç¤ºçš„é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼SPAç½‘ç«™çš„è®¾è®¡ï¼Œç”¨æˆ·ç‚¹å‡»é¡µé¢åé€šè¿‡å…¨å±åŒä¸€é¡µé¢çš„iframeæ¨¡ä»¿å‡é¡µé¢åˆ‡æ¢å¹¶å…¨å±æ˜¾ç¤ºäº¤äº’æ•ˆæœ APIå®ç°å’Œé”®ç›˜å…¨å±å†²çªé—®é¢˜é—®é¢˜æè¿° å±å¹•ä¸Šæœ‰ä¸ªæŒ‰é’®æ§åˆ¶é¡µé¢å…¨å±ï¼Œéå…¨å±çŠ¶æ€ä¸‹ç‚¹å‡»å˜ä¸ºå…¨å±ï¼Œå…¨å±çŠ¶æ€ä¸‹ç‚¹å‡»é€€å‡ºå…¨å±ï¼ŒæŒ‰é’®çš„æ ·å¼æ˜¾ç¤ºå½“å‰é¡µé¢æ˜¯å¦æ˜¯å…¨å±çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿè¦å…¼é¡¾æµè§ˆå™¨æŒ‰F11å’ŒEscåˆ‡æ¢å…¨å±çš„åŠŸèƒ½ã€‚è®¾ç½®äº†ä¸€ä¸ªå˜é‡è®°å½•å½“å‰æ˜¯å¦å…¨å±ï¼Œåœ¨éå…¨å±çŠ¶æ€ä¸‹ï¼Œå¯ä»¥é€šè¿‡keydownäº‹ä»¶ç›‘å¬F11çš„é”®å…¥ï¼Œä½†æ˜¯åœ¨å…¨å±çŠ¶æ€ä¸‹ï¼Œæµè§ˆå™¨æ— æ³•ç›‘å¬åˆ°keydownäº‹ä»¶ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰å¦‚ä½•è§£å†³ï¼Ÿ è§£å†³æ–¹å¼ å‚è€ƒåšå®¢å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç›‘å¬keydownäº‹ä»¶ï¼ŒF11é”®å…¥æ—¶ï¼Œæ‰§è¡Œe.preventDefault()ï¼Œé˜»æ­¢F11çš„å…¨å±ï¼Œåªç”¨å•ä¸€å…¥å£æ§åˆ¶æ˜¯å¦å…¨å±ï¼Œä½†æ˜¯å¦‚æœåŒæ—¶è¦ä¿ç•™F11å’ŒEscçš„åŠŸèƒ½ï¼Œè¦å¦‚ä½•è§£å†³ æ ‡ç­¾imgimgæ ‡ç­¾å›¾ç‰‡è‡ªé€‚åº”é—®é¢˜æè¿° ä½¿ç”¨imgæ ‡ç­¾å±•ç¤ºå›¾ç‰‡æ—¶ï¼Œä¸€ç›´ä¸çŸ¥é“å¦‚ä½•å®ç°è°ƒæ•´å›¾ç‰‡å°ºå¯¸çš„åŒæ—¶ä¿æŒåŸå§‹é•¿å®½æ¯”ã€‚ä»¥å¾€éƒ½æ˜¯ç”¨cssé‡Œçš„background-imgæ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œ è¿™ä¸ªé—®é¢˜ä¸€ç›´éƒ½æ²¡è§£å†³ã€‚ä¹‹å‰å¬è¯´å¦‚æœåœ¨imgæ ‡ç­¾ä¸Šåªè®¾ç½®widthï¼Œå³å¯ä¿æŒé•¿å®½æ¯”ï¼Œä½†æ˜¯å¥½åƒæ²¡ä»€ä¹ˆç”¨ã€‚ è§£å†³æ–¹æ³• https://blog.csdn.net/z2181745/article/details/114919271https://blog.csdn.net/z2181745/article/details/114919271ä½¿ç”¨cssä¸­çš„object-fitå±æ€§ï¼Œç±»ä¼¼äºbackground-sizeå±æ€§å¯ä»¥æ§åˆ¶imgæ ‡ç­¾å±•ç¤ºå›¾ç‰‡çš„æ¨¡å¼ï¼Œå¯é€‰å€¼æœ‰ï¼šfill|contain|cover|scale-down|none|initial|inherit; inputinput:fileä¸Šä¼ åŒä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œchangeä¸è§¦å‘é—®é¢˜æè¿° åœ¨ä½¿ç”¨input:fileæ—¶ï¼Œä¸€èˆ¬ä¼šç»‘å®šä¸€ä¸ªonChangeäº‹ä»¶ï¼Œç”¨æ¥ç›‘å¬æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ï¼Œä½†æ˜¯å¦‚æœåå¤ä¸Šä¼ åŒä¸€ä»½æ–‡ä»¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¸Šä¼ ä¼šè§¦å‘changeäº‹ä»¶ã€‚ è§£å†³æ–¹æ³• https://blog.csdn.net/chelen_jak/article/details/89358075https://blog.csdn.net/chelen_jak/article/details/89358075ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ä¼šè¢«å­˜å‚¨åœ¨ $event.target.valueä¸­ï¼Œå› æ­¤éœ€è¦æ¯æ¬¡éƒ½å°† $event.target.value æ¸…ç©ºï¼šfunction change(e) e.target.value = null videovideoæ ‡ç­¾æ— æ³•è‡ªåŠ¨æ’­æ”¾é—®é¢˜æè¿° videoæ ‡ç­¾å·²ç»è®¾ç½®äº†autoplayå±æ€§ï¼Œè§†é¢‘ä¾æ—§æ— æ³•è‡ªåŠ¨æ’­æ”¾ è§£å†³æ–¹æ¡ˆ å‚è€ƒåšå®¢ï¼švideo æ ‡ç­¾æ— æ³•è‡ªåŠ¨æ’­æ”¾éœ€è¦æŠŠmutedå±æ€§å’Œautoplayå±æ€§ä¸€èµ·é…ç½®ä¸Šå»:video src=./citywalk.mpp4 autoplay muted/video videoåŠ è½½blobæ ¼å¼è§†é¢‘é—®é¢˜æè¿° metaå¸¸ç”¨HTML Metaæ ‡ç­¾å¤§æ€»ç»“ ç§»åŠ¨ç«¯æµè§ˆå™¨å¦‚ä½•å»æ‰å¤´éƒ¨å¯¼èˆªæ æ˜¯è°è¿˜åœ¨åšæµè§ˆå™¨ä¸Šè¿è¡Œçš„ç§»åŠ¨ç«¯ç½‘é¡µï¼Œè¿™ä¸ªé—®é¢˜çœŸçš„æœ‰è§£å†³çš„å¿…è¦å—ï¼Ÿè€Œä¸”ä¸åŒçš„æµè§ˆå™¨çš„å»é™¤æ–¹å¼è¿˜éƒ½æœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œæ”¾å¼ƒè¿™ä¸ªåŠŸèƒ½å§ã€‚https://blog.csdn.net/hbcui1984/article/details/8350107https://segmentfault.com/a/1190000018559886https://www.jianshu.com/p/61e324e0efa2 Page-EnterPage-Exit æ§åˆ¶é¡µé¢è¿›å…¥é€€å‡ºæ•ˆæœæ’å…¥Page-EnterPage-Exitæ— æ•ˆ Meta http-equiv=Page-Enter Content=blendTrans(Duration=10.5) /Meta http-equiv=Page-Exit Content=blendTrans(Duration=0.5) /Meta http-equiv=Page-Enter Content=revealTrans(duration=3, transition=9)Meta http-equiv=â€Page-Enterâ€ Content=â€revealTrans(duration=x, transition=y)â€Meta http-equiv=â€Page-Exitâ€ Content=â€revealTrans(duration=x, transition=y)â€ ç§»åŠ¨ç«¯æµè§ˆå™¨è‡ªå®šä¹‰å¯¼èˆªæ ç›®å‰ä¼¼ä¹åªèƒ½è®¾ç½®é¢œè‰²ï¼Œé€šè¿‡è®¾ç½®é¡µé¢metaå¤´çš„theme-colorï¼šmeta name=theme-color content=#ff0000/"},{"title":"React æ¡†æ¶","path":"/notes/web_react.html","content":"åˆ›å»ºæ–°çš„Reacté¡¹ç›®npx create-react-app new-app-name æ¨èå®‰è£…çš„åº“ï¼š å¸¸ç”¨å·¥å…·åº“ï¼šlodash ç±»åä¹¦å†™ç®€åŒ–åº“ï¼šclassNames ç”Ÿæˆå”¯ä¸€æ ‡è¯†åº“ï¼šuuid æ¥å£è¯·æ±‚ï¼šaxios çŠ¶æ€ç®¡ç†ï¼š@reduxjstoolkit è·¯ç”±ï¼šreact-router-dom"},{"title":"uniapp å¼€å‘","path":"/notes/web_uniapp.html","content":"uniappä¸­ä½¿ç”¨echartsåœ¨uniappä¸­ä½¿ç”¨echartså¯ä»¥å‚è€ƒè¿™ä¸€ç¯‡ï¼šuniappä¸­ä½¿ç”¨threejs uniappä¸­echarts.tooltipåŠŸèƒ½å¤±æ•ˆé—®é¢˜é—®é¢˜æè¿° åœ¨uniappä¸­ä½¿ç”¨echartsæ—¶ï¼Œå‘ç°é€šè¿‡pcç«¯é€šè¿‡clickè§¦å‘çš„tooltipåœ¨ç§»åŠ¨ç«¯ä¸ç”Ÿæ•ˆã€‚ è§£å†³æ–¹æ³• å‚è€ƒåšå®¢https://blog.csdn.net/weixin_53791978/article/details/127111456echarts å¼•å…¥çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆåˆ¤æ–­å½“å‰çš„ç¯å¢ƒã€‚ç”±äºuni app ä¸­æœ‰ä¸€ä¸ª â€˜wxâ€™ å…¨å±€å˜é‡æ±¡æŸ“äº†echartsä¸­çš„ wx å˜é‡ï¼Œå¯¼è‡´è¿™é‡Œçš„åˆ¤æ–­ç›´æ¥èµ°ç¬¬ä¸€ä¸ªï¼Œecharts éƒ¨åˆ†åŠŸèƒ½æ— æ³•ç”Ÿæ•ˆã€‚å› æ­¤éœ€è¦å†main.jsä¸­ï¼Œå°†å…¨å±€å˜é‡é‡æ–°èµ‹å€¼ï¼šwindow.wx = å½“ç„¶è¿™ä¼šå¯¼è‡´uni-appä¸­çš„wxå…¨å±€å˜é‡æ— æ•ˆï¼Œä¸è¿‡å¦‚æœå¼€å‘çš„ä¸æ˜¯wxç¯å¢ƒä¸‹çš„ç¨‹åºï¼Œ åº”è¯¥ä¸ç”¨æ‹…å¿ƒè¿™ä¸€ç‚¹ uni-app è·¯ç”±è·³è½¬è·³è½¬åˆ°ç»å¯¹è·¯å¾„é—®é¢˜æè¿° uniappä¸­è¿›è¡Œé¡µé¢è·³è½¬æ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·³è½¬ï¼š// å½“å‰çš„è·¯ç”±ä¸ºpages/manager/indexuni.navigatorTo( url:pages/error/AuthError)è·³è½¬æŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯æç¤ºè·¯ç”±è·³è½¬åˆ°äº† pagesmanagerindexpageserrorAuthError è§£å†³æ–¹æ³• https://ask.dcloud.net.cn/question/78943https://ask.dcloud.net.cn/question/78943éœ€è¦åœ¨uniè·¯ç”±è·³è½¬æ¥å£çš„urlå‚æ•°ä¸­ç”¨ æ–œæ å¼€å¤´ï¼šuni.navigatorTo( url:/pages/error/AuthError)æ–œæ å¼€å¤´åè·³è½¬æˆåŠŸã€‚ é’‰é’‰å°ç¨‹åºå¼€å‘é’‰é’‰å…ç™»æŠ¥é”™é—®é¢˜æè¿° å¼€å‘é’‰é’‰H5å¾®åº”ç”¨ï¼Œè°ƒç”¨é’‰é’‰å…ç™»apiæŠ¥é”™,è°ƒç”¨çš„apiæ˜¯è¿™ä¸ªï¼šruntime.permission.requestOperateAuthCodehttps://open.dingtalk.com/document/orgapp/obtain-the-temporary-authorization-code-for-micro-application-feedback-operationhttps://open.dingtalk.com/document/orgapp/obtain-the-temporary-authorization-code-for-micro-application-feedback-operationæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š method:runtime.permission.requestOperateAuthCode, err: errorMessage:1002, è·³è½¬çš„URLä¸æ˜¯å®‰å…¨URL, errorCode:3 , success:falseæ²¾ç‚¹è¾¹çš„å¸–å­ï¼šhttps://developer.aliyun.com/ask/245659https://developer.aliyun.com/ask/245659 è§£å†³æ–¹æ³• æœ€åé—®é¢˜è§£å†³äº†ï¼Œä¸æ¸…æ¥šæ€ä¹ˆè§£å†³çš„ï¼Œæœ€å…ˆæˆ‘è¿˜ä»¥ä¸ºæ˜¯ipæƒé™çš„é—®é¢˜ï¼Œæœ€ååå°å‘Šè¯‰æˆ‘ä»–æŠŠkeyåˆ·æ–°äº†ä¸€ä¸‹ï¼Œå°±ä¸æŠ¥é”™äº†æœ€ç»ˆå…ç™»ç”¨çš„æ˜¯å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œè·å–å°ç¨‹åºå…ç™»æˆæƒç ç”¨çš„ï¼šhttps://open.dingtalk.com/document/orgapp/mini-program-free-login#https://open.dingtalk.com/document/orgapp/mini-program-free-login# é’‰é’‰å…ç™»æŠ¥é”™ï¼ˆåç»­ï¼‰é—®é¢˜æè¿° é’‰é’‰å…ç™»æˆåŠŸä¹‹åï¼Œè¿‡äº†å¤§æ¦‚ä¸€ä¸ªå¤šæœˆçš„ä¸€å¤©ï¼Œæµ‹è¯•çªç„¶åé¦ˆå…ç™»å¤±æ•ˆäº†ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼šdd error:[message.æƒé™æ ¡éªŒå¤±è´¥ Code:52011-Message;jsapi ticket è¯»å–å¤±è´¥errorCode:3 é—®é¢˜è§£å†³ å®˜ç½‘æœ‰å…³jsapi ticketè¯»å–å¤±è´¥çš„åŸå› è§£é‡Šï¼šhttps://www.dingtalk.com/qidian/help-detail-1060077225.htmlhttps://www.dingtalk.com/qidian/help-detail-1060077225.htmlæ ¹æ®å®˜ç½‘çš„è¯´æ³•ï¼Œç»è¿‡æ’æŸ¥åï¼Œå‘ç°åŸå› æ˜¯ç”±äºæ”¾åœ¨åç«¯çš„jsticketç¼“å­˜æ—¶é—´è¿‡é•¿å¯¼è‡´è¿‡æœŸ uv-uiuv-tabå®ç°æ¨ªå‘æ»šåŠ¨åŠŸèƒ½é—®é¢˜æè¿° uv-tabæ¨ªå‘æ»šåŠ¨é€‰é¡¹å¡å¿…é¡»è¦é€šè¿‡åˆ‡æ¢tabé¡µçš„æ–¹å¼ï¼Œä¸èƒ½é€šè¿‡æ‹–æ‹½ç›´æ¥æ»šåŠ¨tabé€‰é¡¹å¡ å°†åŒ…è£¹tab-itemçš„å®¹å™¨çš„scroll-yæ‰“å¼€ï¼Œç„¶åå°†æ»šåŠ¨æ¡éšè—å³å¯:deep .uv-tabs__wrapper__nav overflow-y: scroll; ::-webkit-scrollbar width: 0; height: 0; background-color: transparent;"},{"title":"Vue æ¡†æ¶","path":"/notes/web_vue.html","content":"Vue CLInpm run build æŠ¥é”™Syntax Error: Thread Loader(Worker 0) Syntax Error: Thread Loader(Worker 0)The â€œfromâ€ argument must be of type string. Received undefined. è§£å†³æ–¹æ³•å‚è€ƒåšå®¢https://blog.csdn.net/weixin_62277266/article/details/128437519 npm run server æŠ¥é”™Component provided template option but runtime compilation is not supported in this build of Vue. Component provided template option but runtime compilation is not supported in this build of Vue. Configure your bundler to alias â€œvueâ€ to â€œvuedistvue.esm-bundler.jsâ€ é—®é¢˜æè¿° æœ€è¿‘æœ‰ä¸ªåŸæœ¬ç”¨ vue2+webpack çš„é¡¹ç›®ï¼Œéœ€è¦ç”¨ vue3+vite è¿›è¡Œé‡æ„ï¼ŒåŸé¡¹ç›®é‡Œç”¨äº†å¾ˆå¤šä½¿ç”¨å­—ç¬¦ä¸²templateæ„å»ºçš„ç»„ä»¶ï¼šexport const SearchResetGroupButtons = template: ` divç»„ä»¶/div `, props: [prop1, prop2], data:()=return , // ...;å°†è¿™äº›ä»£ç é‡å†™åˆ°viteæ„å»ºçš„æ–°é¡¹ç›®é‡Œæ—¶ï¼ŒæŠ¥äº†ä¸Šè¿°çš„é”™è¯¯ã€‚ è§£å†³æ–¹æ³• https://blog.csdn.net/huangpb123/article/details/122753934https://blog.csdn.net/huangpb123/article/details/122753934 vite.runtimeCompilerå®ç°templateåŠ¨æ€æ¸²æŸ“Configure your bundler to alias â€œvueâ€œ to â€œvue/dist/vue.esm-bundler.jsâ€œ VueRouteråŠ¨æ€åŠ è½½ç»„ä»¶çš„vueé¡¹ç›®æ‰“åŒ…åæŠ¥é”™é—®é¢˜æè¿° åœ¨å†™ä¸€ä¸ªçº¯demoå±•ç¤ºç±»çš„é¡¹ç›®æ—¶ï¼ˆvite+vue3ï¼‰ï¼Œå› ä¸ºdemoå’Œdemoä¹‹é—´å½¼æ­¤æ²¡ä»€ä¹ˆå…³ç³»ï¼Œçˆ¶å­ä¹Ÿæ¯«æ— å…³ç³»ï¼Œå› æ­¤è¿™äº›demoç»„ä»¶éƒ½èƒ½æ‰¹é‡è‡ªåŠ¨å¯¼å…¥ï¼Œå› ä¸ºæˆ‘æ‡’å¾—åœ¨é¡µé¢ä¸Šä¸€ä¸ªä¸€ä¸ªæŠŠç»„ä»¶å†™è¿›å»ï¼Œæ‰€ä»¥å°±ç”¨å¦‚ä¸‹ä»£ç æ ¹æ®è·¯ç”±å‚æ•°è‡ªåŠ¨å¯¼å…¥ï¼šscript setup import getCurrentInstance, defineAsyncComponent from vue; const proxy = getCurrentInstance() const ThreeComp = defineAsyncComponent( loader:()=import(proxy.$route.query.router) )/scripttemplate!-- åŠ¨æ€ç»„ä»¶ -- ThreeComp/ThreeComp/templateè¿™ä¹ˆå†™åœ¨æœ¬åœ°è¿è¡Œæ—¶æ²¡å‡ºä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯æ‰“åŒ…éƒ¨ç½²åå‘ç°ç¨‹åºè¿è¡Œæ—¶æŠ¥ç»„ä»¶å¼•å…¥çš„é”™è¯¯ï¼šFailed to load module script: Expected a JavaScript module script but the server responded with a MIME type of text/html. Strict MIME type checking is enforced for module scripts per HTML spec. é—®é¢˜è§£å†³ è¿™æ˜¯å› ä¸ºåœ¨viteæ‰“åŒ…æ—¶æ²¡æœ‰æ£€æµ‹åˆ°è¿™äº›åŠ¨æ€å¼•å…¥çš„ç»„ä»¶ï¼Œå› æ­¤è¿™äº›ç»„ä»¶å®é™…ä¸Šæ²¡æœ‰è¢«æ‰“åŒ…è¿›å»ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘å°±æ”¾å¼ƒäº†åŠ¨æ€å¼•å…¥ç»„ä»¶çš„æ–¹å¼ï¼Œé€‰æ‹©æ‰¹é‡å¼•å…¥è·¯ç”±ï¼Œåœ¨viteä¸­æ‰¹é‡å¼•å…¥å¯ä»¥é€šè¿‡import.meta.globçš„æ–¹å¼ï¼šVite Globå¯¼å…¥å‚è€ƒåšå®¢åœ¨routerindex.jsä¸­æ·»åŠ æ‰¹é‡å¼•å…¥çš„ä»£ç ï¼šfunction addRouter() const modules = import.meta.glob([ @/components/GSAP/**.vue, @/components/three/CSS3D/**.vue, ]) for (const path in modules) modules[path]().then((mod) = const file = mod.default router.addRoute( path: / + file.__name, name: file.__name, component: file, ); ); addRouter()"},{"title":"å¾…æ•´ç†æ‚é¡¹","path":"/wiki/CG/other_01_unclassified.html","content":"Shading ç€è‰²æœ€å¸¸è§çš„ç€è‰²ç®—æ³•Flat shading å¹³é¢ç€è‰²æ ¹æ®æ¯ä¸ªä¸‰è§’å½¢æ³•çº¿è®¡ç®—ç€è‰²æ•ˆæœGouraud shading é€é¡¶ç‚¹ç€è‰²é’ˆå¯¹æ¯ä¸ªé¡¶ç‚¹è®¡ç®—é¢œè‰²ï¼Œå†è¿›è¡Œçº¿æ€§æ’å€¼å¾—åˆ°ç‰‡å…ƒé¢œè‰²Lambert Shading å…‰ç…§ç€è‰²ä¸Gouraud shadingéå¸¸ç›¸ä¼¼çš„æ¨¡å‹ï¼ŒåŒæ ·ä½¿ç”¨é€é¡¶ç‚¹è®¡ç®—å…‰ç…§ï¼Œå†è¿›è¡Œç‰‡å…ƒå·®å€¼çš„æ–¹æ³•Phong shading é€ç‰‡å…ƒç€è‰²é’ˆå¯¹ä¸‰è§’å½¢æ¯ä¸ªç‰‡å…ƒè¿›è¡Œç€è‰²è®¡ç®—PBR Shading ç‰©ç†æ¸²æŸ“Physically Based Renderingthreejsä¸­çš„Shadingç®—æ³•threejsä¸­ä¸åŒçš„æè´¨ä½¿ç”¨çš„å…‰ç…§æ¨¡å‹å¯èƒ½æœ‰æ‰€ä¸åŒï¼šMeshPhongMaterialä½¿ç”¨çš„æ˜¯Phong Shadingå¯ä»¥é€šè¿‡å¼€å¯flatShadingå±æ€§ï¼Œä½¿ç”¨å¹³é¢æ¸²æŸ“MeshStandardMaterialä½¿ç”¨PBRæ¨¡å‹ï¼ˆCook-Torranceåå°„æ¨¡å‹ï¼‰Physically Based Rendering åŸºäºç‰©ç†æ¸²æŸ“æ›´çœŸå®æ¨¡æ‹Ÿç°å®ä¸­å…‰ç…§å’Œæè´¨çš„ç›¸äº’ä½œç”¨è€ƒè™‘äº†å…‰çš„æ¼«åå°„ã€é•œé¢åå°„ã€é‡‘å±åº¦ç­‰ç‰©ç†å±æ€§MeshLambertMaterial ä½¿ç”¨çš„æ˜¯ Lambert Shadingå‡ ç§æè´¨çš„æ¯”è¾ƒ"},{"title":"Knovaä»‹ç»","path":"/wiki/Canvas/Konva-01-intro.html","content":"Konvaæ–‡æ¡£ Konvaç‰¹ç‚¹ï¼š é«˜æ€§èƒ½åŠ¨ç”»ã€è¡¥é—´ã€èŠ‚ç‚¹åµŒå¥—ï¼ˆç”šè‡³åŒ…å«æ•°åƒä¸ªå›¾å½¢ï¼‰ å¸ƒå±€ã€æ»¤é•œã€ç¼“å­˜ã€äº‹ä»¶ç»‘å®š ç»“æ„ï¼š æ ‘ç»“æ„ Stageèˆå° â†’ Layerå›¾å±‚ â†’ Groupç»„ â†’ Shapeå›¾å½¢ æ ¹èŠ‚ç‚¹ä¸ºStage å¶å­èŠ‚ç‚¹ä¸ºShape æ‰€æœ‰ç»“æ„éƒ½æ˜¯è™šæ‹ŸèŠ‚ç‚¹ï¼Œç±»ä¼¼äºHtmlçš„DOMèŠ‚ç‚¹ æ¯ä¸ªlayeræœ‰2ä¸ªcanvasæ¸²æŸ“å™¨ï¼ˆQAï¼‰ åœºæ™¯æ¸²æŸ“å™¨ï¼šè¾“å‡ºæ‰€çœ‹å†…å®¹ï¼ˆç±»ä¼¼GPUï¼‰ å›¾å½¢å‘½ä¸­æ£€æµ‹æ¸²æŸ“å™¨ï¼šåœ¨éšè—çš„canvasé‡Œç”¨äºé«˜æ€§èƒ½æ£€æµ‹äº‹ä»¶ æ¦‚å¿µï¼š åŸºæœ¬å›¾å½¢ï¼š æ”¯æŒRectçŸ©å½¢ã€Circleåœ†å½¢ã€Ellipseæ¤­åœ†ã€Staræ˜Ÿå½¢ã€Polygonå¤šè¾¹å½¢ã€Regular Polygonç­‰è¾¹å¤šè¾¹å½¢ Lineç›´çº¿ã€Splineæ ·æ¡æ›²çº¿ã€Blobå›¢å‹ Imageå›¾ç‰‡ Textæ–‡å­—ã€TextPathè·¯å¾„æ–‡å­—ã€Labelæ ‡ç­¾ SVG PathçŸ¢é‡è·¯å¾„ã€custom Shapeè‡ªå®šä¹‰å›¾å½¢ æ ·å¼ fillå¡«å……ï¼ˆsolid colorå®è‰²ã€gradientsæ¸å˜ã€imageså›¾ç‰‡ï¼‰ strokeçº¿æ¡ï¼ˆcolorçº¿æ¡é¢œè‰²ã€widthçº¿å®½ï¼‰ shadowé˜´å½±ï¼ˆcoloré¢œè‰²ã€offsetåç§»ã€opacityé€æ˜åº¦ã€bluræ¨¡ç³Šï¼‰ opacityé€æ˜åº¦ äº‹ä»¶ è¾“å…¥äº‹ä»¶ clickã€dblclickã€mouseoverã€tapã€dbltapã€touchstart attributeså˜åŒ–äº‹ä»¶ scaleXChangeã€fillChange æ‹–æ”¾äº‹ä»¶ dragStartã€dragmove æ»¤é•œ åŠ¨ç”» é€‰æ‹©å™¨ å¯ä»¥æ ¹æ®typeã€idã€nameè¿›è¡Œé€‰æ‹© åºåˆ—åŒ–ååºåˆ—åŒ– å°†å¯¹è±¡ä¿å­˜ä¸ºJsonæ ¼å¼ é€šè¿‡jsonåˆ›å»ºå¯¹è±¡ æ€§èƒ½ ç¼“å­˜Cachingï¼Œå…è®¸åœ¨buffer canvasé‡Œç»˜åˆ¶å…ƒç´ ï¼Œç„¶åå°†buffer canvasä¸­çš„å…ƒç´ ç»˜åˆ¶åˆ°åœºæ™¯ï¼ˆQAï¼‰ å›¾å±‚æ§åˆ¶"},{"title":"æ€§èƒ½æ§åˆ¶","path":"/wiki/Canvas/Konva-02-Performance.html","content":"http://konvajs-doc.bluehymn.com/docs/performance/All_Performance_Tips.html Shape Cachinghttp://konvajs-doc.bluehymn.com/docs/performance/Shape_Caching.htmlhttps://konvajs.org/api/Konva.Node.html#cache é€šè¿‡cacheï¼Œå¯ä»¥å°†nodeè½¬å˜æˆå›¾ç‰‡ï¼Œå†æ¸²æŸ“åˆ°åœºæ™¯ä¸­ é€‚ç”¨äºéœ€è¦å¤§é‡ç»˜åˆ¶é‡å¤å…ƒç´ çš„åœºæ™¯ å®ç°åŸç†ï¼š å°†ç›®æ ‡èŠ‚ç‚¹ï¼ˆShapeGroupï¼‰ç»˜åˆ¶åˆ°ä¸€ä¸ªç¦»å±çš„canvasä¸Šï¼Œç”Ÿæˆä¸€ä¸ªé™æ€å›¾åƒå¿«ç…§ï¼ˆé™æ€ä½å›¾ï¼‰ä»¥æé«˜æ€§èƒ½ ä¹‹åæ¸²æŸ“æ—¶ç›´æ¥å¤ç”¨è¿™å¼ ä½å›¾ï¼Œé¿å…é‡å¤è®¡ç®—å’Œç»˜åˆ¶ï¼Œä»è€Œæé«˜æ€§èƒ½ ç±»ä¼¼äºè›‹ç³•æ¨¡å…·çš„åŠŸèƒ½ è·¨åŸŸé—®é¢˜ï¼š å¦‚æœç›®æ ‡èŠ‚ç‚¹ä¸Šä½¿ç”¨äº†å›¾ç‰‡ï¼Œé‚£è¿™å¼ å›¾ç‰‡ä¸å…è®¸è·¨åŸŸè·å– Canvasæ±¡æŸ“ https://developer.mozilla.org/zh-CN/docs/Web/HTML/How_to/CORS_enabled_image å½“canvasç»˜åˆ¶ä½¿ç”¨åˆ°è·¨åŸŸå›¾ç‰‡æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ‡è®°è¯¥Canvasä¸ºâ€œæ±¡æŸ“â€çŠ¶æ€ å—æ±¡æŸ“çš„Canvasæ— æ³•è¯»å–åƒç´ æ•°æ® cacheæ— æ³•è‡ªåŠ¨æ£€æµ‹åˆ°èŠ‚ç‚¹çš„å°ºå¯¸ï¼Œå› æ­¤éœ€è¦æŒ‡å®šxywidthheightç­‰å˜é‡ ä½¿ç”¨cacheç»˜åˆ¶å¤§é‡é‡å¤å›¾å½¢ Layer Management å±‚çº§ç®¡ç†http://konvajs-doc.bluehymn.com/docs/performance/Layer_Management.html konvaä¸­æ¯ä¸ªlayerå¯¹åº”ç‹¬ç«‹çš„canvaså…ƒç´  åœ¨æ›´æ–°ã€ç§»åŠ¨ã€åŠ¨æ€å˜åŒ–æŒ‡å®šlayerçš„å…ƒç´ æ—¶ï¼Œä¸ä¼šé‡ç»˜å…¶å®ƒå›¾å±‚çš„å…ƒç´  åœ¨konvaä¸­ï¼Œstageå¯¹åº”ä¸€ä¸ªDOMå®¹å™¨ï¼Œlayeråˆ™å¯¹åº”ä¸€ä¸ªcanvaså…ƒç´  å»ºè®®ï¼šä¸€èˆ¬ä¸ä¼šåˆ›å»ºè¿‡å¤šå…ƒç´ ï¼Œæœ€å¤š3-5ä¸ª ä½¿ç”¨layeråŒºåˆ†åŠ¨æ€ç”»å¸ƒå’Œé™æ€ç”»å¸ƒï¼š layeråˆ†å±‚ Optimize Animation Performance ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ä½¿ç”¨animationå‡½æ•°æ§åˆ¶åŠ¨ç”»å¸§çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æŸä¸€å¸§æ²¡æœ‰éœ€è¦æ›´æ–°çš„å†…å®¹ï¼Œå¯ä»¥é€šè¿‡è¿”å›falseçš„æ–¹å¼ç¦æ­¢ç”»å¸ƒåˆ·æ–° ä¼˜åŒ–ç‚¹ï¼šå‡å°‘å¸§åˆ·æ–°æ¬¡æ•° // æŒ¯å¹…const amplitude = 100// å‘¨æœŸconst period = 2000const centerX = stage.width() / 2const anim = new Konva.Animation(function (frame) if (frame.time % (period * 2) period) // ç¬¬ä¸€ä¸ªperiodå‘¨æœŸå†…æ›´æ–° hexagon.x( amplitude * Math.cos((frame.time * 2 * Math.PI) / period) + centerX ) else // ç¬¬äºŒä¸ªå‘¨æœŸåœæ­¢åˆ·æ–° return false , layer)anim.start() é€šè¿‡å‡å°‘åŠ¨ç”»å¸§å®ç°ä¼˜åŒ– Batch Draw æ‰¹é‡ç»˜åˆ¶http://konvajs-doc.bluehymn.com/docs/performance/Batch_Draw.html å…¸å‹åœºæ™¯ ç›‘å¬é¼ æ ‡ä½ç½®æ›´æ–°å•ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå¼•èµ·æ•´å¼ ç”»å¸ƒé¢‘ç¹åœ°æ›´æ–° è¿™ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æåº¦å¯†é›†çš„é‡ç»˜ å¯ä»¥é€šè¿‡batchDrawï¼Œå°†é‡ç»˜ç³»ç»ŸæŒ‚è½½åˆ°åŠ¨ç”»å¼•æ“ä¸Š // æ•´ä½“é‡ç»˜layer.draw()// æ‰¹é‡é‡ç»˜layer.batchDraw() Shape Redraw å›¾å½¢é‡ç»˜// ç”»å¸ƒé‡ç»˜layer.draw()// èŠ‚ç‚¹é‡ç»˜shape.draw() Konvaæ”¯æŒå•ç‹¬é‡æ–°ç»˜åˆ¶æŸä¸ªå›¾å½¢ï¼Œå¹¶ä¸”ä¸ä¼šåˆ·æ–°æ•´å¼ ç”»å¸ƒï¼Œä½†é‡ç»˜èŠ‚ç‚¹å¿…é¡»æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š èŠ‚ç‚¹ä¸èƒ½æ˜¯åŠé€æ˜çš„ èŠ‚ç‚¹ä¸éœ€è¦ä¸å…¶ä»–èŠ‚ç‚¹é‡å  é‡ç»˜çš„èŠ‚ç‚¹ä¼šè¦†ç›–åœ¨å…¶ä»–èŠ‚ç‚¹çš„ä¸Šå±‚ èŠ‚ç‚¹ç»˜åˆ¶ç»“æœä¸éœ€è¦ä¾èµ–ä¸‹å±‚å†…å®¹ï¼ˆæ¯”å¦‚æ²¡æœ‰æ··åˆæ¨¡å¼ï¼‰ é‡ç»˜å•ä¸ªèŠ‚ç‚¹"},{"title":"D3 - Zoom","path":"/wiki/Canvas/d3-01-zoom.html","content":"d3-zoomå®˜æ–¹æ–‡æ¡£https://d3js.org/d3-zoom#zoom Zoomable bar chart å®˜æ–¹ä»£ç åœ°å€ å…³äºzoom è¦å®ç°ä¸€ä¸ªå¯ä»¥å®ç°æ»šåŠ¨ã€å¹³ç§»çš„æŸ±çŠ¶å›¾ï¼ŒEChartsä¸­ç”¨åˆ°çš„ä¸€èˆ¬éƒ½æ˜¯datazoomç»„ä»¶ï¼Œd3ä¸­æä¾›äº†zoomç±»d3-zoomç»å¸¸ç”¨äºd3-scaleå’Œd3-axisçš„äº¤äº’æ“ä½œ æ ¸å¿ƒä»£ç  å’Œæ™®é€šæŸ±çŠ¶å›¾ä¸€æ ·ï¼Œåˆ›å»ºsvgã€æ¨ªçºµåæ ‡ç³»ã€æŸ±çŠ¶å›¾gåï¼Œéœ€è¦ç»™svgæ ‡ç­¾æ·»åŠ zoomåŠŸèƒ½:function zoom(svg) let extents = [ [marginTop - width/2], [width/2 - marginTop] ] svg.call( d3.zoom() .scaleExtent([1,8]) // ç¼©æ”¾çº§åˆ« .translateExtent(extents) // å¹³ç§»èŒƒå›´ .extent(extents) // viewBoxå°ºå¯¸èŒƒå›´ .on(zoom,zoomed) // ç»‘å®šzoomäº‹ä»¶ ) function zoomed(event) // æ›´æ–°xè½´é…ç½® x.range([marginLeft-width/2, width/2-marginLeft].map(d= event.transform.applyX(d) )) // é‡ç»˜æŸ±å­å®½åº¦å’Œä½ç½® svg.selectAll(.bars rect) .attr(x,d=x(d.letter)) .attr(width,x.bandWidth()) // é‡ç»˜xè½´ svg.select(.x-axis) .call(d3.axisBottom(x).tickSizeOuter(0)) svg.call(zoom)æœ¬ä¾‹ä¸ºsvgæŒ‡å®šçš„d3.zoom()é…ç½®äº†4ä¸ªå±æ€§ï¼šscaleExtent ç¼©æ”¾çº§åˆ«translateExtent å¹³ç§»èŒƒå›´extent viewBoxè§†å£èŒƒå›´zoomäº‹ä»¶åœ¨d3.zoom()ç»‘å®šçš„zoomäº‹ä»¶ä¸­ï¼Œåšäº†ä¸‰ä»¶äº‹ï¼šæ›´æ–°xè½´ç”Ÿæˆå™¨å‡½æ•°å°†xè½´çš„èŒƒå›´é€šè¿‡zoom.transform.applyX å‡½æ•°è¿›è¡Œå˜æ¢applyXçš„åŠ å·¥å‡½æ•°ä¸ºxk + txé‡æ–°ç»˜åˆ¶æŸ±å­ï¼Œæ”¹å˜æŸ±å­çš„xåæ ‡å’Œwidthå®½åº¦æ ¹æ®æ›´æ–°çš„xè½´ç”Ÿæˆå™¨å‡½æ•°ï¼Œé‡æ–°ç»˜åˆ¶xè½´"},{"title":"D3 - Selection","path":"/wiki/Canvas/d3-02-selection.html","content":"d3-selection Selection elementsModifying elementsJoining dataHanding eventsControl flowLocal variablesNamespaces Selection elements domé€‰æ‹©å™¨d3.selection()é€‰ä¸­æ ¹domåœ¨åŸå‹é“¾ä¸Šæ·»åŠ è‡ªå®šä¹‰æ–¹æ³• d3.select(selector)é€‰ä¸­ç¬¬ä¸€ä¸ªselectorå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šçš„domå…ƒç´  d3.selectAll(selector)é€‰ä¸­æ‰€æœ‰selectorå¯ä»¥ä½¿å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯æ˜¯ä¸€ä¸ªåŒ…å«æŒ‡å®šdomå…ƒç´ çš„å¯è¿­ä»£å¯¹è±¡ selection.select(selector)selectorå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€domã€å‡½æ•°å‡½æ•°ç±»å‹å¿…é¡»è¿”å›domElementæˆ–null selectionç»‘å®šçš„æ•°æ®ä¼šå‘ä¸‹ä¼ é€’åˆ°è¢«é€‰ä¸­çš„å…ƒç´ ä¸­ selection.selectAll(selector)selectorå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€domã€å‡½æ•°å‡½æ•°ç±»å‹å¿…é¡»è¿”å›domElementç»„æˆçš„å¯è¿­ä»£å¯¹è±¡æˆ–ç©ºæ•°ç»„ selectionAll.selectionAllè¿”å›çš„å…ƒç´ ä¼šè¢«è‡ªåŠ¨åˆ†ç»„ selection.filter(filter)è¿‡æ»¤å™¨filterå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…å‡½æ•° selection.selectChild(selector)é€‰ä¸­ç¬¬ä¸€ä¸ªselectoråŒ¹é…åˆ°çš„å­©å­ï¼Œselectorå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å‡½æ•°æ²¡æŒ‡å®šselectorè¿”å›ç¬¬ä¸€ä¸ªå­©å­ selection.selectChildren(selector)é€‰ä¸­æ¯ä¸€ä¸ªselectoråŒ¹é…åˆ°çš„å­©å­ï¼Œselectorå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å‡½æ•°æ²¡æŒ‡å®šselectorè¿”å›æ‰€æœ‰å­©å­ selection.selection()è¿”å›å¯¹åº”é€‰ä¸­å…ƒç´  d3.matcher(selector)è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æŒ‡å‘çš„thiså¦‚æœæ»¡è¶³selectorè¿”å›trueæ˜¯d3åœ¨selection.filterä¸­ç”¨åˆ°çš„å†…éƒ¨æ–¹æ³• d3.selector(selector)è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æŒ‡å‘çš„thisæ˜¯ç¬¬ä¸€ä¸ªæ»¡è¶³selectorçš„å…ƒç´ selection.selectç”¨åˆ°çš„å†…éƒ¨æ–¹æ³• d3.selectorAll(selector)è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æŒ‡å‘çš„thisæ˜¯æ‰€æœ‰æ»¡è¶³selectorçš„å…ƒç´ selection.selectAllç”¨åˆ°çš„å†…éƒ¨æ–¹æ³• d3.window(node) nodeæ˜¯domèŠ‚ç‚¹ï¼Œè¿”å›æ‰€åœ¨documentçš„é»˜è®¤çª—å£ nodeæ˜¯documentï¼Œè¿”å›æ‰€åœ¨çš„é»˜è®¤çª—å£ å…¶å®ƒï¼Œè¿”å›node d3.style(node, name)è·å–æŒ‡å®šnodeå…ƒç´ çš„æŒ‡å®šnameæ ·å¼å±æ€§å€¼ Modifying elements ä¿®æ”¹å…ƒç´ selection.attr(name, value)ä¿®æ”¹è·å–é€‰åŒºæŒ‡å®šå±æ€§ selection.classed(names, value)selectiohn.classed(foo,false) .classed(bar,true) æ·»åŠ å»é™¤ç±»å selection.style(name, value, priority)ä¿®æ”¹è·å–æ ·å¼å±æ€§ selection.text(value)å°†selectionä¸‹çš„æ‰€æœ‰å†…å®¹æ›¿æ¢æˆvalueæ–‡æœ¬æ— å‚æ•°æ—¶è¿”å›selectionä¸‹ç¬¬ä¸€ä¸ªå­å…ƒç´ çš„æ–‡æœ¬å†…å®¹ selection.html(value)ä¿®æ”¹è·å–selectionçš„innerHTMLï¼Œå¯¹svgæˆ–å…¶ä»–ä¸æ”¯æŒhtmlçš„å…ƒç´ ä¸é€‚ç”¨ selection.append(type)æ–°å¢çš„å…ƒç´ ä»åé¢æ’å…¥ typeå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å‡½æ•°ï¼Œå­—ç¬¦ä¸²å¯ä»¥å¸¦å‰ç¼€ selection.insert(type, before)å°†typeç±»å‹çš„å…ƒç´ æ’å…¥åˆ°beforeä¹‹å‰ selection.remove()ç§»é™¤selection selection.clone(deep)åœ¨selectionåæ’å…¥ä¸€ä¸ªå¤åˆ¶å…ƒç´ ï¼Œdeepä¸ºfalseæ—¶ï¼Œä¸ä¼šå¤åˆ¶å­å…ƒç´  selection.sort(compare)é€‰åŒºæ•°æ®æ’åºï¼Œé»˜è®¤å‡åº selection.order()å¦‚æœselectionç»‘å®šäº†dataæ•°æ®ï¼Œdataæ•°æ®çš„é¡ºåºé‡æ’åéœ€è¦æ ¹æ®æ–°é¡ºåºé‡æ–°å¤„ç†selectionå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨selection.order() selection.raise()selectionçš„æ¯ä¸ªå­å…ƒç´ ä»é˜Ÿå°¾é¡ºåºæ¨å…¥ selection.lower()selectionçš„æ¯ä¸ªå­å…ƒç´ ä»é˜Ÿé¦–é¡ºåºæ¨å…¥ create(name)åˆ›å»ºä¸€ä¸ªnameåç§°çš„å…ƒç´  creator(name)æŒ‡å®šå…ƒç´ ç”Ÿæˆå™¨ï¼Œ selection.appendå’Œselection.insertåˆ›å»ºæ–°å…ƒç´ çš„å†…éƒ¨æ–¹æ³• Joining data æ•°æ®ç»‘å®š By passing separate functions on enter, update and exit,you have greater control over what happens.And by specifying a key function to selection.data,you can minimize changes to the DOM to optimize performance. åœ¨æ•°æ®é©±åŠ¨å˜åŒ–çš„å¯è§†åŒ–å›¾è¡¨ä¸­é€šè¿‡æ§åˆ¶selection.dataçš„keyå€¼ï¼Œå¯ä»¥æœ€å°åŒ–domå˜åŒ–çš„å¼€é”€ï¼Œé€šè¿‡æŒ‡å®šjoinçš„enterã€updateã€exitï¼Œå¯ä»¥å¯¹æ•°æ®ç»˜åˆ¶çš„è¿‡ç¨‹æœ‰æ›´å¤šçš„æ§åˆ¶ã€‚ selection.data(data, key)dataæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡keyæ˜¯dataç”¨äºæ’åºçš„å‡­æ®ï¼Œå¯ä»¥æ˜¯å‡½æ•°ç±»å‹ selection.join(enter, update, exit)å¯¹ç»‘å®šçš„æ•°æ®è¿›è¡Œå¤„ç†enterã€updateã€exitæ˜¯ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œä¸åŒçš„å¤„ç† svg.selectAll(circle) .data(data) .join( enter = enter.append(circle), update = update, exit = exit.remove() ) .attr(fill, none) .attr(stroke, black); selection.enterupdateexitå¦‚æœæœ‰è¿™ä¹ˆä¸€ä¸ªdataåºåˆ—ï¼š[2,3,4,5,6]æŠŠdataä¸æŸä¸€selectionç»‘å®šï¼Œé‚£ä¹ˆåœ¨enteræ—¶ï¼Œdataå°±æ˜¯[2,3,4,5,6] ä¹‹åå¯¹dataåšä¸€å®šçš„ä¿®æ”¹ï¼Œdataå˜æˆäº†[4,5,6,7,8,9]é‚£ä¹ˆenterã€updateã€exitæ¥æ”¶åˆ°çš„æ•°æ®ä¾æ¬¡å¦‚ä¸‹ï¼š enterï¼š[7,8,9] updateï¼š[4,5,6] exitï¼š[2,3] ä¸€èˆ¬åœ¨è¿™ä¸‰ä¸ªæ­¥éª¤ä¸­åšä¸€äº›åŠ¨ç”»è¿‡æ¸¡æ“ä½œï¼Œåœ¨enterä¸­åˆå§‹åŒ–å…ƒç´ ï¼Œåœ¨exitä¸­removeå¯¹åº”å…ƒç´  selection.datum(value)ä¸ºé€‰ä¸­çš„æ‰€æœ‰åŒºåŸŸæä¾›å®Œå…¨ç›¸åŒçš„valueæ•°æ® selection.merge(other)åˆå¹¶selectionä¸ohter selectionï¼Œselection.joinä¸­enterå’Œupdateåˆå¹¶æ—¶ä½¿ç”¨çš„å†…éƒ¨æ–¹æ³• Handling events äº‹ä»¶ç›‘å¬selection.on(typenames, listener, options)typenamesä¸ä»…å¯ä»¥æ˜¯å•ä¸ªäº‹ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„å¤šä¸ªäº‹ä»¶åï¼šâ€input changeâ€åŒæ—¶å¯ä»¥æ·»åŠ åç¼€ï¼šâ€click.foo click.barâ€ selection.dispatch(type, parameters)è°ƒç”¨selectionç»‘å®šçš„typeäº‹ä»¶ï¼Œparameterså¯ä»¥é…ç½®çš„é¡¹æœ‰ï¼š bubblesï¼šå…è®¸å‘ä¸Šå†’æ³¡ cancelableï¼šå…è®¸event.preventDefault detailï¼ševentå‚æ•°å’Œè‡ªå®šä¹‰æ•°æ®å…³è” d3.pointer(event, target)è·äº‹ä»¶eventè§¦å‘æ—¶ï¼Œç›¸å¯¹targetå…ƒç´ çš„åæ ‡ä½ç½® eventå¯ä»¥æ˜¯MouseEventã€PointerEventã€Touchæˆ–è€…å…¶ä»–æ¶‰åŠåˆ°åæ ‡ä½ç½®çš„æ“ä½œ event äº‹ä»¶ç±»å‹ target ç›®æ ‡ç‚¹ d3.pointers(event, target)æ¶‰åŠåˆ°å¤šä¸ªç‚¹ä½è§¦å‘çš„äº‹ä»¶ï¼Œæ¯”å¦‚Touchäº‹ä»¶è¿”å›çš„æ˜¯ç”±å¤šä¸ªç‚¹ä½åæ ‡ç»„æˆçš„æ•°ç»„ Control flow æµå‘æ§åˆ¶selection.each(function)éå†ä¸€ä¸ªå¯è¿­ä»£çš„é€‰ä¸­åŒºåŸŸå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªé€‰ä¸­åŒºåŸŸã€‚ selection.call(function, â€¦arguments)ä¸€èˆ¬ç”¨äºå¯¹ç”Ÿæˆå™¨å‡½æ•°è¿›è¡Œå°è£…åï¼Œå¯é‡å¤è°ƒç”¨ï¼šç”Ÿæˆå™¨å‡½æ•°ï¼š function name(selection, first, last) selection .attr(first-name,first) .attr(last-name,last) ä¹‹åå¯ä»¥æ‰¹é‡è°ƒç”¨è¯¥å‡½æ•°ï¼š d3.selectAll(div).call(name,John,Snow) ç›¸å½“äºï¼š name(d3.selectAll(div),John,Snow) selection.empty()ç”¨äºåˆ¤æ–­selectionæ˜¯å¦ä¸ºç©º selection.nodes()è·å–selectioné€‰ä¸­çš„ä¸€ä¸ªæ•°ç»„ selection.node()è¿”å›selectioné€‰ä¸­çš„å…ƒç´  selection.size()è¿”å›é€‰ä¸­åŒºåŒ…å«å…ƒç´ çš„æ•°é‡ Local variables æœ¬åœ°æ ‡è¯†d3.local()ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å˜é‡å d3.local.set(node, value)ä¸€èˆ¬d3.selection.eaché…åˆä½¿ç”¨ï¼Œç”¨äºç»™æ¯ä¸ªèŠ‚ç‚¹èµ‹äºˆvalueæ ‡ç¤ºå€¼ d3.local.get(node)è·å–èŠ‚ç‚¹çš„å”¯ä¸€æ ‡ç¤ºå€¼ d3.local.remove(node)åˆ é™¤èŠ‚ç‚¹å­˜å‚¨çš„æ ‡ç¤ºå€¼"},{"title":"flattenä»‹ç»","path":"/wiki/Canvas/flatten-01-intro.html","content":"flatten-jsï¼šJavascript å‡ ä½•åæ ‡ç³»åº“ flatten-jså®˜æ–¹æ–‡æ¡£ Observableæ•™ç¨‹"},{"title":"Polygon","path":"/wiki/Canvas/flatten-02-Polygon.html","content":"å®˜æ–¹æ–‡æ¡£ï¼šhttps://alexbol99.github.io/flatten-js/Polygon.html observableç›¸å…³æ•™ç¨‹ï¼šhttps://observablehq.com/@alexbol99/flattenjs-tutorials-polygons Polygon å¤šè¾¹å½¢æ¨¡å‹flattençš„Polygonè¢«ç”±2ä¸ªéƒ¨åˆ†ç»„æˆï¼š edgesï¼šsegmentï¼ˆçº¿æ®µï¼‰æˆ–è€…arcï¼ˆå¼§çº¿ï¼‰ facesï¼šå°é—­çš„é¢ é¢ä¸­çš„è¾¹å½¢æˆçš„æ˜¯ç¯å½¢çš„åŒå‘é“¾è¡¨ï¼Œå› æ­¤å¯ä»¥å‘å‰å’Œå‘åéå†è¿™äº›è¾¹ Polygoné¡¶ç‚¹çš„æ–¹å‘å¯ä»¥é€šè¿‡addFaceåœ¨ä¸€ä¸ªPolygonä¸­æ·»åŠ å¤šä¸ªfaceï¼Œ å¦‚æœæ¯ä¸ªfaceå½¼æ­¤é—´éƒ½æ²¡æœ‰äº¤ç‚¹ï¼Œé‚£ä¹ˆéƒ½ç®—ä½œç‹¬ç«‹çš„å®Œæ•´éƒ¨åˆ† å¦‚æœfaceä¹‹é—´å­˜åœ¨äº¤å‰åŒºåŸŸï¼Œéœ€è¦è€ƒè™‘åˆ°é¡ºé€†æ—¶é’ˆ é‡å è·¯å¾„çš„å¡«å……ä¸€èˆ¬æœ‰2ç§è§„åˆ™ï¼ˆhttps://www.zhangxinxu.com/wordpress/2018/10/nonzero-evenodd-fill-mode-rule/ï¼‰ï¼š nonzero ä»ä»»æ„ç‚¹Oå°„å‡ºä¸€æ¡å°„çº¿ï¼Œå–å°„çº¿å’Œè·¯å¾„ï¼ˆABï¼‰çš„äº¤ç‚¹Pï¼Œå¦‚æœOPå’ŒAPBPç»„æˆé¡ºæ—¶é’ˆæ–¹å‘+1ï¼Œé€†æ—¶é’ˆæ–¹å‘-1, æœ€ç»ˆå¾—åˆ†ä¸æ˜¯0ï¼Œç‚¹åœ¨å†…éƒ¨ï¼Œæ˜¯0ï¼Œç‚¹åœ¨å¤–éƒ¨ evenodd ä»ä»»æ„ç‚¹Oå°„å‡ºä¸€æ¡å°„çº¿ï¼Œå–å°„çº¿å’Œæ‰€æœ‰è·¯å¾„çš„äº¤ç‚¹ äº¤ç‚¹æ•°æ˜¯å•æ•°ï¼Œåœ¨å†…éƒ¨ï¼Œäº¤ç‚¹æ•°æ˜¯å¶æ•°ï¼Œåœ¨å¤–éƒ¨ flattenä¸­ä¸€å¾‹é€‰ç”¨evenoddè§„åˆ™ éƒ¨åˆ†è·¯å¾„é‡å çš„å›¾å½¢ æœ€ç»ˆå›¾å½¢å»é™¤æ‰é‡å åŒºåŸŸ å¯¹äºåŒ…å«å…³ç³»çš„å›¾å½¢ï¼Œåˆ†ä¸ºislandå’ŒholeåŒºåŸŸ åŒ…å«å›¾å½¢ä¸ºislandï¼Œè¢«åŒ…å«å›¾å½¢ä¸ºhole æ„é€ å‡½æ•° é€šè¿‡segarcç»„æˆçš„æ•°ç»„åˆ›å»º é€šè¿‡ç‚¹æ•°ç»„åˆ›å»º é€šè¿‡boxcircleå®ä¾‹åˆ›å»º é€šè¿‡ä»£è¡¨ç‚¹çš„æ•°å­—å¯¹æ•°ç»„åˆ›å»º new Polygon() å±æ€§ edges è¾¹é›†åˆ PlanarSetç±»å‹ faces é¢é›†åˆ PlanarSetç±»å‹ vertices é¡¶ç‚¹é›†åˆ edges faces box vertices addFace addVertex area cut contains cutWithLine deleteFace distanceTo dpath findEdgeByPoint intersect isEmpty isValid reacreateFaces removeChain removeEndVertex reverse rotate scale splitToIslands svg toArray toJSON transform translate æ–¹æ³•"},{"title":"ç®€ä»‹ä¸å¼€å‘å·¥å…·å®‰è£…","path":"/wiki/Cocos/creator_01_intro.html","content":"æ•™ç¨‹èµ„æº é‡ç”Ÿç¨‹åºå›-Paul Cocoså¼•æ“ç®€ä»‹å®˜æ–¹ç½‘ç«™ cocoså¼•æ“ç®€ä»‹ Cocosæ ¸å¿ƒäº§å“åŒ…æ‹¬ï¼šCocos2d-xCocos3dç¼–è¾‘å™¨ Cocos Creatoræ¸¸æˆåŠ é€Ÿæ¡†æ¶ Cocos Runtimeæ™ºèƒ½åº§èˆ±è§£å†³æ–¹æ¡ˆ Cocos HMIäº’åŠ¨è¯¾ä»¶ç¼–è¾‘å™¨ Cocos ICEXRæ–¹å‘å„åˆ›ä½œå·¥å…· Cocos Creator XRä»€ä¹ˆæ˜¯æ¸¸æˆå¼•æ“ï¼Ÿå¯¹äºå¤§éƒ¨åˆ†æ¸¸æˆéƒ½åŒ…å«çš„è¿‘ä¼¼çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼šåŸºç¡€Spriteç±»èµ„æºåŠ è½½å™¨ResourceLoaderå…¶å®ƒçš„å„ç§æ–¹æ³•ç‰©ä½“ç§»åŠ¨ç¢°æ’æ£€æµ‹å­å¼¹å‘å°„â€¦å°†è¿™äº›åŸºç¡€å†…å®¹ç»„åˆèµ·æ¥çš„ç±»åº“ï¼Œå°±æ˜¯åŸºç¡€çš„æ¸¸æˆå¼•æ“æ¯”è¾ƒè‘—åçš„æ¸¸æˆå¼•æ“å›¢é˜Ÿå¤§å‹å¼€å‘å¼•æ“DOOMå¼•æ“ï¼Œã€Šæ¯ç­æˆ˜å£«ã€‹ï¼Œ1993å¹´ï¼Œç¬¬ä¸€ä¸ªå•†ä¸šæˆæƒçš„æ¸¸æˆå¼•æ“Quakeå¼•æ“ï¼Œã€Šé›·ç¥ä¹‹é”¤ã€‹ï¼Œç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰çš„3Då¼•æ“Unrealå¼•æ“ï¼Œ1998å¹´ï¼Œã€Šè’é‡å¤§é•–å®¢ã€‹ï¼ŒEpic Gameså¼€å‘ï¼Œä¸“æ³¨äºå¾®è½¯DirectXSourceèµ·æºå¼•æ“ï¼Œ2004å¹´ï¼ŒValveè‡ªç ”å¼•æ“ï¼Œã€ŠCSï¼šGOã€‹CryEngineå¼•æ“ï¼ŒCryTechï¼Œã€Šå­¤å²›æƒŠé­‚ã€‹ç‹¬ç«‹æ¸¸æˆå¼€å‘å¼•æ“Unityï¼ŒC#ï¼Œè·¨å¹³å°ä¼˜åŠ¿Cocoså¼•æ“ï¼Œè·¨å¹³å°ï¼ŒJsTs Cocos Creatorå®‰è£…æ–°é¡¹ç›® é¦–å…ˆä¸‹è½½Cocos Dashboardï¼Œcocosç‰ˆæœ¬ç®¡ç†å™¨ä¸‹è½½é“¾æ¥è¿™é‡Œå®‰è£…äº†2ç§ç‰ˆæœ¬çš„cocosï¼š2.4.103.6.2é¡¹ç›®ç›®å½•assets æ¸¸æˆèµ„æºaudio éŸ³é¢‘images å›¾ç‰‡scenes åœºæ™¯scripts è„šæœ¬internal å¼•æ“è‡ªå¸¦ç±»åº“scriptsè„šæœ¬çš„æ·»åŠ é¼ æ ‡å³é”®åˆ›å»ºæ–°çš„tsè„šæœ¬ï¼Œä¸»è¦ç›®çš„ï¼Œæ˜¯æ§åˆ¶ç•Œé¢labelç»„ä»¶æ˜¾ç¤ºçš„æ–‡ä»¶å†…å®¹ï¼šconst ccclass, property = cc._decorator;/** * cc å‘½åç©ºé—´ * Component ç»„ä»¶ */@ccclassexport default class HelloWorld extends cc.Component // å°†å½“å‰Labelç»„ä»¶çš„æ˜¾ç¤ºå†…å®¹stringä¿®æ”¹ä¸ºHello World start () console.log(Hello World) this.getComponent(cc.Label).string = Hello World æ¸¸æˆè¿è¡Œç”¨æµè§ˆå™¨æ‰“å¼€çš„ç»“æœ é…ç½®ä»£ç ç¼–è¾‘å™¨ç‚¹å‡»Cocos Creatorå·¦ä¸Šè§’ï¼šæ–‡ä»¶è®¾ç½®ï¼Œåœ¨å¼¹å‡ºçš„Editor Windowä¸­ï¼Œè¿›å…¥ã€æ•°æ®ç¼–è¾‘ã€‘èœå•è¿›è¡Œé…ç½®ï¼šå¤–éƒ¨è„šæœ¬ç¼–è¾‘å™¨å®˜æ–¹æ¨èä½¿ç”¨VSCodeå¤–éƒ¨å›¾ç‰‡ç¼–è¾‘å™¨upä¸»è¿˜ä»‹ç»äº†å‡ ä¸ªæ¯”è¾ƒå®ç”¨çš„VSCodeå¿«æ·é”®ï¼šCtrl+Space è¿›è¡Œä»£ç å¿«é€Ÿæç¤ºï¼šå’Œæ“ä½œç³»ç»Ÿè¾“å…¥æ³•å¿«æ·é”®å†²çªè§£å†³æ–¹æ¡ˆAlt+Shift+F è¿›è¡Œä»£ç æ ¼å¼åŒ–"},{"title":"Nodeçš„å±æ€§ä¸æ“ä½œ","path":"/wiki/Cocos/creator_02_oop_cop.html","content":"NodeèŠ‚ç‚¹OCPï¼ˆé¢å‘ç»„ä»¶å¼€å‘ï¼‰æ˜¯Cocosçš„æ ¸å¿ƒå¼€å‘æ–¹å¼ï¼Œæ ¹æ®æ¯ç§ç»„ä»¶åˆ›å»ºçš„ç¤ºä¾‹å°±æ˜¯ä¸€ä¸ªNodeå•ä½ï¼ŒNodeå…·æœ‰ä»¥ä¸‹ä¸€äº›å±æ€§ï¼šåŸºæœ¬å±æ€§åæ ‡æ—‹è½¬ç¼©æ”¾å°ºå¯¸â€¦Nodeç¼–è¾‘çš„å¿«æ·é”®ï¼š WERTæ¸²æŸ“å±æ€§Spriteç»„ä»¶æ‰€å…·æœ‰çš„ç‰¹æ®Šå±æ€§ å±‚çº§ç®¡ç†å™¨å…·æœ‰çˆ¶å­åµŒå¥—å…³ç³»çš„èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹åŸºç¡€å±æ€§çš„å˜åŒ–ä¼šå½±å“åˆ°å­èŠ‚ç‚¹ï¼ˆæ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼‰ç»‘å®šåœ¨çˆ¶èŠ‚ç‚¹çš„è„šæœ¬ä¸­å¯ä»¥ç›´æ¥è·å–åˆ°å­èŠ‚ç‚¹çš„æ•°ç»„ï¼š// ç›´æ¥ä¿®æ”¹å­èŠ‚ç‚¹çš„å±æ€§this.node.children[0].opacity = 255cc.log(this.node.children.length) Spriteå±æ€§Spriteç»„ä»¶å‚è€ƒCocosä¸­æ”¯æŒåˆ›å»º2ç§æ¸²æŸ“æ¨¡å¼ä¸‹çš„Spriteï¼šç²¾çµSpriteï¼š2D3Dæ¸¸æˆå†…æœ€å¸¸è§çš„æ˜¾ç¤ºå›¾åƒçš„æ–¹å¼çº¯è‰²Spriteï¼šå¸¸ç”¨äºç©ºæ°”å¢™Spriteå±æ€§Atlasä½¿ç”¨æ‹¼è´´ç±»å‹å›¾ç‰‡å’Œplistè¿›è¡Œè´´å›¾å®šä½Sprite Frameè´´å›¾TypeSimple æ™®é€šæ¨¡å¼ æ ¹æ®åŸå§‹å›¾ç‰‡æ¸²æŸ“SpriteSliced ä¹å®«æ ¼æ¨¡å¼ä¸€èˆ¬ç”¨äºUIèµ„æºä¸­é—´æ ¼è‡ªç”±å˜æ¢ï¼Œè¾¹ç¼˜æ ¼æ²¿è¾¹ç¼˜æ–¹å‘æ‹‰ä¼¸Tiled å¹³é“ºæ¨¡å¼ç“¦ç‰‡å¹³é“ºï¼Œå¸¸ç”¨äºåˆ¶ä½œåœ°å½¢Filled å¡«å……æ¨¡å¼æ²¿å›ºå®šæ–¹å‘æ¯”ä¾‹åˆ‡å‰²åŸå§‹å›¾ç‰‡å¸¸ç”¨äºæ•°å€¼æ¡çš„åŠ¨æ€æ˜¾ç¤ºSize ModeBlend æ··åˆæ¨¡å¼Material æè´¨"},{"title":"Event äº¤äº’äº‹ä»¶","path":"/wiki/Cocos/creator_04_interactions.html","content":"äº‹ä»¶ç³»ç»Ÿ äº‹ä»¶ç›‘å¬ç›‘å¬äº‹ä»¶ eventTarget.on(type, func, target?);typeï¼šäº‹ä»¶æ³¨å†Œå­—ç¬¦ä¸²funcï¼šäº‹ä»¶å›è°ƒå‡½æ•°targetï¼šäº‹ä»¶æ¥æ”¶å¯¹è±¡onå’Œonceçš„åŒºåˆ«onç›‘å¬çš„äº‹ä»¶æ¯æ¬¡éƒ½ä¼šè§¦å‘onceç›‘å¬çš„äº‹ä»¶é¦–æ¬¡å“åº”åå°±ä¼šå…³é—­ç›‘å¬å–æ¶ˆç›‘å¬äº‹ä»¶eventTarget.off(type, func?, target?)æŒ‡å®šå¸è½½çš„å“åº”äº‹ä»¶å’Œå¸è½½äº‹ä»¶å¯¹è±¡éƒ½æ˜¯å¯é€‰çš„ è‡ªå®šä¹‰äº‹ä»¶ è‡ªå®šä¹‰äº‹ä»¶ä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ—¶å€™ï¼Œéƒ½èƒ½ç›´æ¥è·å–åˆ°ç›®æ ‡Nodeå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚è‡ªå®šä¹‰äº‹ä»¶æœ‰ä¸¤ç§ä¸»è¦çš„å®šä¹‰æ–¹å¼ï¼šemitdispatchEventä½¿ç”¨onæ¥è‡ªå®šä¹‰èŠ‚ç‚¹äº‹ä»¶ï¼Œemitæ¥è§¦å‘äº‹ä»¶// äº‹ä»¶çš„å®šä¹‰eventTarget.on(self_event,(arg1, arg2)=)// äº‹ä»¶çš„è§¦å‘eventTarget.emit(self_event, arg1, arg2)ä½¿ç”¨EventCustomè‡ªå®šä¹‰äº‹ä»¶dispatchEventè§¦å‘äº‹ä»¶// å‚æ•°1ï¼šäº‹ä»¶å å‚æ•°2ï¼šæ˜¯å¦å†’æ³¡let event = new cc.Event.EventCustom(self_event, true)// ç»™è‡ªå®šä¹‰äº‹ä»¶æ·»åŠ detailå±æ€§ï¼Œä½œä¸ºä¼ é€’å‚æ•°event.setUserData(hello)this.node.dispatchEvent(event) äº‹ä»¶ç³»ç»ŸCocosæä¾›å‡ ç§äº‹ä»¶ç³»ç»Ÿï¼šè¾“å…¥äº‹ä»¶ç³»ç»Ÿå¯¹è±¡ï¼šsystemEventï¼ˆæ—§ç‰ˆï¼‰| inputï¼ˆæ–°ç‰ˆï¼‰ç›‘å¬å¯¹è±¡ä¸ºå…¨å±€èŠ‚ç‚¹äº‹ä»¶ç³»ç»Ÿå¯¹è±¡ï¼šEventTargetç›‘å¬å¯¹è±¡ä¸ºNodeåŒæ ·ä¹Ÿæä¾›äº†ä¸€äº›å†…ç½®äº‹ä»¶ï¼šé¼ æ ‡äº‹ä»¶è§¦æ‘¸äº‹ä»¶event.getID å¯ä»¥è·å–åˆ°è§¦æ§çš„æ‰‹æŒ‡ç¼–ç é”®ç›˜äº‹ä»¶é”®ç›˜äº‹ä»¶æ˜¯æ¸¸æˆå…¨å±€äº‹ä»¶ccæä¾›é”®ç›˜ç¼–ç å…¨å±€å˜é‡ï¼š cc.macro.KEYè®¾å¤‡é‡åŠ›ä¼ æ„Ÿäº‹ä»¶å…¨å±€ä¸èŠ‚ç‚¹è§¦æ‘¸å’Œé¼ æ ‡äº‹ä»¶ API"},{"title":"Script è„šæœ¬","path":"/wiki/Cocos/creator_03_scripts.html","content":"å®˜æ–¹è„šæœ¬ä»‹ç» ä¿®æ”¹æ¨¡ç‰ˆ ç‚¹å‡»å³ä¸Šè§’ã€ç¼–è¾‘å™¨ã€‘æŒ‰é’®ï¼Œæ‰“å¼€æœ¬åœ°èµ„æºæ–‡ä»¶ï¼Œè¿›å…¥Creator\\2.4.10\\resources\\static\\templateæ–‡ä»¶å¤¹ä¸­ï¼Œä¿®æ”¹åˆå§‹åŒ–è„šæœ¬æ–‡ä»¶ï¼šnew-script.jsnew-script.ts æ³¨é‡Šå™¨decorator åŒæ–œæ å’Œå•æ–œæ çš„åŒºåˆ«ä¸€èˆ¬æ¥è¯´ï¼šåŒæ–œæ æ˜¯æ³¨é‡Šï¼Œä¸€èˆ¬ç»™äººçœ‹å•æ–œæ æ˜¯æ³¨è§£ï¼Œä¸€èˆ¬ç»™ç¼–è¯‘å™¨çœ‹const ccclass, property = cc._decorator;// ä½¿ç”¨@ccclassæ ‡æ³¨ç±»@ccclassexport default class HelloWorld extends cc.Component // ä½¿ç”¨@propertyæ ‡æ³¨å±æ€§ @property(cc.Label) label: cc.Label = null; ç”Ÿå‘½å‘¨æœŸLife Cycle Callbacks ä¸‹é¢æ˜¯æŒ‰ç…§æ‰§è¡Œé¡ºåºè¿›è¡Œæ’åºçš„ç”Ÿå‘½å‘¨æœŸé’©å­æ–¹æ³•ï¼šonLoadç»„ä»¶è¢«åŠ è½½æ—¶è°ƒç”¨onEnableå½“åšé”®å¯ç”¨æ—¶æ‰§è¡Œstartåˆå§‹åŒ–æ—¶è°ƒç”¨update(dt)dtè¡¨ç¤ºå¸§é—´éš”æ—¶é—´åˆ·æ–°æ¯ä¸€å¸§æ—¶æ‰§è¡ŒlateUpdate(dt)updateæ‰§è¡Œå®Œåé©¬ä¸Šæ‰§è¡ŒonDisableç»„ä»¶ä¸å¯ç”¨æ—¶æ‰§è¡ŒonDestroyç»„ä»¶è¢«é”€æ¯æ—¶è°ƒç”¨ è„šæœ¬çš„ä½¿ç”¨è„šæœ¬ä½¿ç”¨å®˜æ–¹æ–‡æ¡£å¸¸ç”¨API// è·å–å½“å‰èŠ‚ç‚¹this.node// è·å–èŠ‚ç‚¹å­èŠ‚ç‚¹æ•°ç»„node.children// é€šè¿‡åç§°è·å–å­èŠ‚ç‚¹node.getChildByName(name)// æ ¹æ®èŠ‚ç‚¹è·¯å¾„è·å–èŠ‚ç‚¹cc.find(parentNode/rootNode)// è·å–çˆ¶èŠ‚ç‚¹node.getParent()// å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºnodeAçš„å­èŠ‚ç‚¹node.setParent(nodeA)// ç§»é™¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹node.removeAllChildren()// ç§»é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹nodeAnode.removeChild(nodeA)// å°†èŠ‚ç‚¹ç§»é™¤å‡ºå®ƒçš„çˆ¶èŠ‚ç‚¹node.removeFromParent()// è·å–å½“å‰èŠ‚ç‚¹çš„ç»„ä»¶this.getComponent(cc.Component)// ä»å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸­è·å–ç»„ä»¶this.getComponentInChildren(cc.Component) å®é™…ä½¿ç”¨ æš‚åœæŒ‰é’®é€€å‡ºæ¸¸æˆæŒ‰é’®ç©å®¶æ•ˆæœPauseæŒ‰é’®ç‚¹å‡»æ—¶æ˜¾ç¤ºèœå•åˆ›å»ºPauseButtonçš„Nodeï¼Œåœ¨ä¸Šé¢æ·»åŠ PauseButtonè„šæœ¬ï¼Œå¹¶å°†èœå•çš„Nodeå’ŒPauseButtonçš„menuå…³è”ï¼šconst ccclass, property = cc._decorator;@ccclassexport default class PauseButton extends cc.Component @property(cc.Node) menu: cc.Node = null; isPause: boolean = false start () if(!this.menu) console.log(æ²¡æœ‰æŒ‡å®šMenuèŠ‚ç‚¹) return; this.node.on(cc.Node.EventType.MOUSE_DOWN, () = this.isPause = !this.isPause if (this.isPause) // æ‰§è¡Œæš‚åœ this.menu.active = true // ç›´æ¥è·å–å­èŠ‚ç‚¹ä¸­çš„Labelç»„ä»¶ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ this.getComponentInChildren(cc.Label).string = Continue else // æš‚åœè§£é™¤ this.menu.active = false this.getComponentInChildren(cc.Label).string = Pause ) QuitæŒ‰é’®ç‚¹å‡»æ—¶é€€å‡ºæ¸¸æˆåœ¨QuitæŒ‰é’®ä¸Šç»‘å®šDestroyBtnè„šæœ¬ï¼Œåœ¨æŒ‰é’®çš„MOUSE_DOWNäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œé”€æ¯æ¸¸æˆä¸»ç•Œé¢ï¼š@ccclassexport default class DestroyBtn extends cc.Component @property(cc.Node) GameWindow: cc.Node = null @property(cc.Node) MainTitle: cc.Node = null isEnd: boolean = false start () if(!this.GameWindow || !this.MainTitle) console.log(æ²¡æœ‰æŒ‡å®šæ¸¸æˆçª—å£æˆ–ç»“æŸé¡µé¢) return this.node.on(cc.Node.EventType.MOUSE_DOWN,()= if(!this.isEnd) // å°†æ¸¸æˆä¸»ç•Œé¢é”€æ¯ this.GameWindow.destroy() this.getComponent(cc.Button).interactable = false const back = this.MainTitle.children[0] back.height = 844; back.y = 0 const titleShadow = this.MainTitle.children[1] const titleInner = this.MainTitle.children[2] titleShadow.getComponent(cc.Label).string = Game Over titleInner.getComponent(cc.Label).string = Game Over titleShadow.y = titleInner.y = 500 this.isEnd = true ) åœ¨updateä¸­æ›´æ–°Playerä½ç½®@ccclassexport default class Player extends cc.Component @property speed: number = 5 @property rotateSpeed: number = 1000 update (dt) // ç©å®¶å‘ä¸Šç§»åŠ¨ this.node.y += this.speed * dt; // å›´ç»•ç©å®¶çš„ç‰¹æ•ˆ this.node.children[0].angle += this.rotateSpeed * dt; è·å–å’Œè®¾ç½®èµ„æºAsset Bundlecocosä¸­ï¼Œå›ºå®šä½¿ç”¨assetsä¸‹resourcesæ–‡ä»¶å¤¹ä½œä¸ºåŠ¨æ€åŠ è½½èµ„æºæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨cc.resourcesè·å–åˆ°æŒ‡å®šèµ„æºï¼šcc.resources.load(img/target, cc.SpriteFrame,(error:Error, assets: cc.SpriteFrame) = // assetsä¸ºè·å–åˆ°çš„èµ„æº) å®šæ—¶å™¨cocosæä¾›äº†å®šæ—¶å™¨æ–¹æ³•ï¼šschedule( callback:function, interval:number, repeat:number, delay:number);callback å®šæ—¶å™¨å›è°ƒå¸¦å‚æ•°dtï¼Œè¡¨ç¤ºé—´éš”æ—¶é—´interval é—´éš”æ—¶é—´å•ä½ï¼šç§’repeat æ‰§è¡Œæ¬¡æ•°delay å»¶è¿Ÿæ—¶é—´å•ä½ï¼šç§’"},{"title":"Collision ç¢°æ’æ£€æµ‹","path":"/wiki/Cocos/creator_05_collision.html","content":"2Dç¢°æ’ç»„ä»¶å®˜æ–¹ç¢°æ’æ–‡æ¡£cocosä¸­æä¾›3ç§2Dç¢°æ’æ£€æµ‹ç»„ä»¶ï¼šBox Collider æ–¹å½¢ç›’æ£€æµ‹å™¨Circle Collider åœ†å½¢æ£€æµ‹å™¨Polygon Collider å¤šè¾¹å½¢æ£€æµ‹å™¨æ£€æµ‹å™¨å±æ€§ï¼šThreshold å¿«é€Ÿç”Ÿæˆç¢°æ’è¾¹ç•ŒEditing å¼€å¯å¯ç¼–è¾‘Tag ç”¨äºæ ‡è®°ç¢°æ’ä½“ç±»å‹Offset ç¢°æ’ä½“åç§»Points ç¢°æ’è¾¹ç•Œå¤šè¾¹å½¢é¡¶ç‚¹ç¢°æ’å›è°ƒå‡½æ•°æ·»åŠ ç¢°æ’æ£€æµ‹çš„ç»„ä»¶ï¼Œä¼šå¤šå‡º3ä¸ªç¢°æ’å›è°ƒå‡½æ•°ï¼šonCollisionEnter(other, self) ç¢°æ’å‘ç”Ÿæ—¶è§¦å‘onCollisionStay(other, self) ç¢°æ’æŒç»­æ—¶è§¦å‘onCollisionExit(other, self) ç¢°æ’ç»“æŸæ—¶è§¦å‘å›è°ƒå‡½æ•°çš„2ä¸ªå‚æ•°ï¼šother ç¢°æ’åˆ°çš„å¦ä¸€ä¸ªç‰©ä½“ï¼šcc.Colliderself ç¢°æ’è€…è‡ªå·±ï¼šcc.Colliderå…¶å®ƒAPIè¦æƒ³è®©ç¢°æ’æ£€æµ‹ç”Ÿæ•ˆï¼Œå¿…é¡»æ‰§è¡Œä¸‹é¢ä»£ç ï¼Œè¡¨ç¤ºç¢°æ’ç®¡ç†å™¨å¯ç”¨cc.director.getCollisionManager().enabled = true;CollisionManager.enabledDebugDrawæ˜¯å¦ç»˜åˆ¶ç¢°æ’è¾¹ç•Œçº¿CollisionManager.enabledDrawBoundingBoxæ˜¯å¦ç»˜åˆ¶ç¢°æ’ç»„ä»¶åŒ…å›´ç›’ ç¢°æ’æ£€æµ‹å®ä¾‹ å­å¼¹å‡»ä¸­æ•Œäººæ•ˆæœç‰©ä½“æ”¶é›†è¿™é‡Œæ¶‰åŠåˆ°å­å¼¹Prefabçš„åˆ¶ä½œï¼Œåˆ¶ä½œå¥½å­å¼¹çš„é¢„è®¾ä½“ä¹‹åï¼Œåœ¨å‘å°„å­å¼¹çš„ä¸»ä½“Playerçš„ç±»ä¸­ï¼Œæ·»åŠ æ–°çš„å¯èµ‹å€¼å±æ€§ï¼š@property(cc.Prefab)bulletPre: cc.Prefab = null;ç›‘å¬å…¨å±€çš„é”®ç›˜äº‹ä»¶ï¼Œå½“ç©ºæ ¼è¢«ç‚¹å‡»æ—¶ï¼Œå‘é€å­å¼¹ï¼šcc.instantiate åˆ›å»ºé¢„è®¾ä½“const bullet = cc.instantiate(this.bulletPre)bullet.setPosition(this.node.position)bullet.setParent(this.node.getParent())ä¸ºEnemyå¯¹è±¡æ·»åŠ ç¢°æ’å›è°ƒï¼šonCollisionEnter(other: cc.Collider, self: cc.Collider) // åˆ¤æ–­ç¢°æ’ç‰©æ˜¯å¦æ˜¯å­å¼¹ç±»å‹ if(other.tag == 3 ) // é”€æ¯å­å¼¹å’Œè‡ªèº« other.node.destroy() self.node.destroy() éœ€è¦åˆ¤æ–­Playerå’Œæ”¶é›†ç›®æ ‡çš„ç¢°æ’ï¼š/* ç¢°æ’å‘ç”Ÿæ—¶è§¦å‘ */onCollisionEnter(other: cc.Collider, self: cc.Collider) :void this.isCollision = true switch(other.tag) // ç¢°æ’åˆ°è‰è“ case 5: this.strawberry_value ++ this.strawberry_label.getComponent(cc.Label).string = this.strawberry_value.toString().padStart(2,0) other.node.destroy() break; // ç¢°æ’åˆ°è¥¿ç“œ case 6: this.melon_value ++ this.melon_label.getComponent(cc.Label).string = this.melon_value.toString().padStart(2,0) other.node.destroy() break; default:break;"},{"title":"å‘é‡ Vector","path":"/wiki/Cocos/creator_07_vector.html","content":"è®¡ç®—å…¬å¼å‘é‡ å‘é‡æŒ‡å…·æœ‰å¤§å°å’Œæ–¹å‘çš„é‡åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸­ï¼Œå‘é‡å¯ä»¥åˆ†æ•£ä¸ºæ²¿xè½´å’Œyè½´çš„ä¸¤ä¸ªåˆ†é‡ï¼Œå‡è®¾å‘é‡Væ–¹å‘å’Œxè½´æ­£æ–¹å‘ä¹‹é—´çš„å¤¹è§’è§’åº¦ aåˆ™Væ²¿xè½´å’Œyè½´çš„åˆ†é‡åˆ†åˆ«æ˜¯ï¼šx = |V|cos(a)y = |V|sin(a)åœ¨jsä¸­æä¾›äº†ä¸€äº›ä¸‰è§’å‡½æ•°çš„æ–¹æ³•ï¼Œä½¿ç”¨çš„åŸºæœ¬éƒ½æ˜¯å¼§åº¦åˆ¶ï¼Œå¼§åº¦åˆ¶å’Œè§’åº¦åˆ¶çš„å…¬å¼å…³ç³»å¦‚ä¸‹ï¼š1Â° = Pi/180const radian = this.node.angle * Math.PI / 180 å®ç° è¿™é‡Œè¦å®ç°çš„åŠŸèƒ½æ˜¯ï¼šä¿¯è§†è§’è§’è‰²è·Ÿéšé¼ æ ‡ä½ç½®æ—‹è½¬é¼ æ ‡å³é”®æ§åˆ¶å­å¼¹æ²¿è§’è‰²æ­£å‰æ–¹å‘å°„å‡ºå»å­å¼¹Bulletç±»ç©å®¶Playerç±»æ¯ä¸€å¸§çš„æ›´æ–°éƒ½è¦æ¶‰åŠåˆ°2ä¸ªè®¡ç®—å­å¼¹Nodeçš„æ—‹è½¬è§’åº¦è½¬å¼§åº¦è®¡ç®—å­å¼¹ç§»åŠ¨åˆ†é‡export default class NewClass extends cc.Component @property speed:number = 100 update (dt) // è§’åº¦åˆ¶è½¬å¼§åº¦åˆ¶ const radian = (this.node.angle + 90) * Math.PI / 180 // è®¡ç®—åˆ†é‡ this.node.x += this.speed * dt * Math.cos(radian) this.node.y += this.speed * dt * Math.sin(radian) é¦–å…ˆå®ç°ç©å®¶è·Ÿéšé¼ æ ‡æ—‹è½¬ï¼šç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼Œè®°å½•é¼ æ ‡ç‚¹ä½æ¯å¸§å¯¹ç©å®¶Nodeçš„angleè¿›è¡Œæ›´æ–°export default class Player extends cc.Component mousePosition = [] start() cc.find(scene).on(cc.Node.EventType.MOUSE_MOVE, (event:cc.Event.EventMouse)= // è®°å½•å½“å‰é¼ æ ‡ç‚¹ä½ this.mousePosition = [event.getLocationX(),event.getLocationY()] ) update (dt) let dx = this.mousePosition[0] - this.node.x let dy = this.mousePosition[1] - this.node.y // è®¡ç®—æ—‹è½¬è§’åº¦ let radian = - Math.atan(dx/dy) let angle = radian * 180 / Math.PI if((dx 0 dy0) || (dx0 dy 0)) angle += 180 this.node.angle = angle å®ç°å­å¼¹è¶…å‰å‘å°„ï¼šç›‘å¬é¼ æ ‡ç‚¹å‡»äº‹ä»¶åˆ›å»ºå­å¼¹èŠ‚ç‚¹åˆå§‹åŒ–å­å¼¹è§’åº¦ç•Œé¢åŠ å…¥å­å¼¹ cc.find(scene).on(cc.Node.EventType.MOUSE_UP, (event:cc.Event.EventMouse)= // console.log(event) let type = event.getButton() switch(type) case 0: // ç§»åŠ¨ this.targetPosition = [event.getLocationX(),event.getLocationY()] break; case 2: // å‘å°„å­å¼¹ // loadç”¨äºæ§åˆ¶å­å¼¹é—´éš”æ—¶é—´ if(this.load) return // æ•£å¼¹ï¼šä¸€å‘3æšå­å¼¹ for(let i = 0;i3;i++) let bullet = cc.instantiate(this.bulletPre) // è®¡ç®—å­å¼¹è§’åº¦ bullet.angle = this.node.angle + (1 - i) * 10 // æ³¨æ„ï¼šè¿™é‡Œçš„BulletPositionæ˜¯Playerä¸‹çš„ä¸€ä¸ªå­ç©ºèŠ‚ç‚¹ // è¡¨ç¤ºå­å¼¹å‘å‡ºçš„ä½ç½® // å°†å­å¼¹åæ ‡ç³»æ”¾ç½®åœ¨å…¨å±€åæ ‡ç³»ä¸‹ bullet.setPosition(this.node.getChildByName(BulletPosition).convertToWorldSpaceAR(cc.Vec2.ZERO)) //æ ¹ç»„ä»¶åŠ å…¥å­å¼¹ bullet.setParent(cc.director.getScene()) // æ·»åŠ éŸ³æ•ˆ cc.find(Canvas/Sound).getComponent(cc.AudioSource).play() // é—´éš”æ§åˆ¶ this.load = true setTimeout(()= this.load = false ,this.loadTime * 1000) break; )"},{"title":"Resources å›¾ç‰‡ä¸éŸ³é¢‘èµ„æº","path":"/wiki/Cocos/creator_06_resources.html","content":"resources èµ„æºç®¡ç†Asset Manageræ¦‚è¿°cocosä¸­é»˜è®¤resourcesæ–‡ä»¶å¤¹ä¸ºåŠ¨æ€åŠ è½½èµ„æºçš„æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨cc.resources.loadæ–¹æ³•å¯ä»¥åŠ¨æ€è·å–åˆ°èµ„æº// urlï¼šç›¸å¯¹äºresourcesçš„urlè·¯å¾„// typeï¼šèµ„æºç±»å‹resources.load(url, type, (err, asset)=)åŠ¨æ€åŠ è½½SpriteAtlasèµ„æºï¼š// åŠ¨æ€åŠ è½½cc.SpriteAtlasèµ„æºcc.resources.load(imgs/character/PinkMan/pinkman_idle,cc.SpriteAtlas,(error: Error, assets: cc.SpriteAtlas) = this.idle_atlas = assets // å®šæ—¶å™¨æ§åˆ¶é€å¸§æ’­æ”¾ setInterval(()= this.node.getComponent(cc.Sprite).spriteFrame = this.idle_atlas.getSpriteFrame(this.cur_idle_atlas_index.toString()) this.cur_idle_atlas_index += 1 this.cur_idle_atlas_index %= this.idle_atlas.getSpriteFrames().length ,this.idle_speed)) AudioSourceAudioSource AudioSouceç»„ä»¶å‚è€ƒCocoséŸ³é¢‘èµ„æºå‚è€ƒAudioSourceæ˜¯Cocosä¸­ç”¨äºæ§åˆ¶éŸ³é¢‘çš„ç»„ä»¶ï¼Œcc.AudioSourceç»„ä»¶ä¸­æä¾›ä¸€äº›APIï¼Œç”¨äºéŸ³é¢‘çš„åŸºæœ¬æ§åˆ¶ï¼šplay() ä»å¤´å¼€å§‹æ’­æ”¾stop() ç»“æŸæ’­æ”¾pause() æš‚åœæ’­æ”¾resume() ä»ä¸Šæ¬¡æš‚åœå¤„ç»§ç»­å¼€å§‹isPlaying æ˜¯å¦åœ¨æ’­æ”¾å…¨å±€éŸ³é¢‘å…¨å±€éŸ³é¢‘ç®¡ç†å™¨cocos2.xç‰ˆæœ¬æä¾›cc.audioEngineï¼Œè¿›è¡Œå…¨å±€éŸ³é¢‘æ§åˆ¶ï¼Œå…¶ä¸­æä¾›å¤šä¸ªå£°é“ï¼šplayMusic èƒŒæ™¯éŸ³ä¹playEffect éŸ³æ•ˆplay éŸ³é¢‘cc.audioEngineåœ¨3.xç‰ˆæœ¬ä¸­å¼ƒç”¨ï¼Œå®˜æ–¹æ¨èä½¿ç”¨cc.AudioSourceå°è£…å…¨å±€éŸ³é¢‘æ§åˆ¶å™¨ä¸‹é¢è¿™æ®µè§†é¢‘éœ€è¦æ‰“å¼€å£°éŸ³ï¼š åŠ å…¥ç©å®¶é£æœº é¼ æ ‡æ§åˆ¶ä½ç½® è¿›è¡Œè¾¹ç•Œæ£€æµ‹ åˆ¶ä½œå­å¼¹é¢„è®¾ä»¶ å­å¼¹å‰è¿› å‡ºç•Œåˆ é™¤ æ·»åŠ ç¢°æ’ ç©å®¶å‘å°„å­å¼¹ å®šæ—¶å™¨ é¢„åŠ è½½å­å¼¹éŸ³æ•ˆ åˆ›å»ºç©å®¶ç¢°æ’ç›’ åˆ›å»ºæ•Œæœºé¢„è®¾ä»¶ åˆ›å»ºç¢°æ’ç»„ä»¶ æ•Œæœºè„šæœ¬ åˆå§‹åŒ–ä½ç½®ï¼ˆéšæœºï¼‰ å‘ä¸‹ç§»åŠ¨ è¾¹é™…æ£€æµ‹ è¢«å‡»ä¸­æ’­æ”¾éŸ³æ•ˆï¼Œæ’­æ”¾æ­»äº¡åŠ¨ç”»ï¼Œé”€æ¯å­å¼¹ ç¢°æ’ç©å®¶æ‰£è¡€æ­»äº¡ ç»“ç®—ç”»é¢ ç»“ç®—éŸ³ä¹"},{"title":"UI ç»„ä»¶","path":"/wiki/Cocos/creator_08_UI.html","content":"å®˜æ–¹æ–‡æ¡£3.8å®˜æ–¹æ–‡æ¡£2.4 å¸¸ç”¨UIç»„ä»¶ å…³äºç»„ä»¶äº‹ä»¶çš„ç»‘å®šé¢æ¿ä¸­çš„äº‹ä»¶ç»‘å®šå¯ä»¥æŒ‡å®šä»»æ„ç›®æ ‡ç»„ä»¶ä¸Šçš„æŒ‡å®šè„šæœ¬ç±»çš„æŒ‡å®šæ–¹æ³•ï¼Œè¿˜å¯ä»¥æŒ‡å®šå‚æ•°ï¼Œä¸€èˆ¬åˆ¶å®šæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯eventå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™ä¸ºæŒ‡å®šå‚æ•°Labelæ–‡å­—æ ‡ç­¾ç»„ä»¶RichTextå¯Œæ–‡æœ¬ç»„ä»¶stringå±æ€§ä½¿ç”¨çš„æ˜¯ä¸€ç§ç±»ä¼¼HTMLçš„BBCodeæ ‡ç­¾è¯­è¨€å¯Œæ–‡æœ¬ï¼šcolor=#ffaa00Click Link â†“/coloron click=getPunishment param=YES!!!!uiwww.cantlivewithoutsm.com/i/u/onimg src=0/Button æŒ‰é’®æŒ‰é’®å­˜åœ¨å‡ ç§çŠ¶æ€ï¼šNormalPressedHoverDisabledDurationLayout å¸ƒå±€ä¸‰ç§å¸ƒå±€æ–¹å¼ï¼šHORIZONTALVERTICALGRIDEditBox æ–‡æœ¬è¾“å…¥æ¡†æ”¯æŒå¯¹èƒŒæ™¯ã€placehold labelã€æ–‡æœ¬labelè¿›è¡Œè‡ªå®šä¹‰æ”¯æŒä¸€äº›äº‹ä»¶çš„ç»‘å®šï¼šEditing Did BeganText ChangedEditing Did EndedEditing ReturnMask é®ç½©æ ¹æ®Nodeçš„sizeç¡®å®šç»„ä»¶æœ‰æ•ˆçš„èŒƒå›´æ»šåŠ¨å®¹å™¨ ScrollViewæ”¯æŒæ¨ªå‘ã€çºµå‘æ»šåŠ¨æ¡æ”¯æŒå¯¹æ»šåŠ¨æƒ¯æ€§å’Œå¼¹æ€§æƒ¯æ€§è¿›è¡Œè®¾ç½®scrollEventæœ‰ä¸‰ä¸ªå‚æ•°ï¼šScrollViewæœ¬èº«ScrollViewäº‹ä»¶ç±»å‹CustomEventDataè¿›åº¦æ¡ ProgressBaræ»‘åŠ¨æ¡ Slideræ”¯æŒå¯¹æ»‘åŠ¨è½¨è¿¹å’ŒæŠŠæ‰‹è¿›è¡Œè‡ªå®šä¹‰æ ·å¼å¯ä»¥ç›‘å¬Slideäº‹ä»¶å¤é€‰æ¡† Toggleå’Œbuttonä¸€æ ·ï¼Œtransitionæ”¯æŒå‡ ç§ç±»å‹ï¼šSPRITE è´´å›¾COLOR çº¯è‰²SCALE ç¼©æ”¾åŠ¨ç”»å•é€‰æ¡† ToggleContainerå•é€‰é¡¹ä¸ºToggleç»„ä»¶ç”»å¸ƒ Canvasæ’­æ”¾å™¨ VideoPlayeræ”¯æŒlocalã€remoteåŠ è½½è§†é¢‘ç½‘é¡µè§†å›¾ WebViewå¸¸ç”¨äºé¡µæ¸¸ä¸­ç™»å½•ç•Œé¢"},{"title":"åœºæ™¯ç®¡ç†åŠåŠ¨æ€åŠ è½½","path":"/wiki/Cocos/creator_09_Scene.html","content":"åˆ‡æ¢åœºæ™¯åœºæ™¯åˆ‡æ¢ cocosä¸­åœºæ™¯æ–‡ä»¶çš„åç¼€æ˜¯firecc.director.loadScene( sceneName:string, onLaunched:function )å‚æ•°ï¼šsceneName è¦åŠ è½½çš„åœºæ™¯åç§°onLaunched å›è°ƒå‡½æ•°loadSceneè°ƒç”¨åè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼šåŠ è½½æ–°åœºæ™¯é”€æ¯å½“å‰åœºæ™¯åˆ‡æ¢æ–°åœºæ™¯ é¢„åŠ è½½åœºæ™¯é¢„åŠ è½½åœºæ™¯ å½“æ¸¸æˆåœºæ™¯æ¯”è¾ƒå¤§æ—¶ï¼Œç›´æ¥è¿›è¡Œåœºæ™¯åŠ è½½å’Œåˆ‡æ¢ï¼ŒåŠ è½½æ—¶æ¸¸æˆå¯èƒ½ä¼šå¡ä½ä¸€æ®µæ—¶é—´ï¼Œå½±å“æ¸¸ç©ä½“éªŒï¼Œæ‰€ä»¥éœ€è¦å¯¹è¾ƒå¤§çš„åœºæ™¯è¿›è¡Œé¢„åŠ è½½ï¼Œé¢„åŠ è½½çš„æ—¶æœºå¯ä»¥é€‰åœ¨ç©å®¶ç§»åŠ¨åˆ°æŸä¸€èŒƒå›´å†…æ—¶ï¼Œå¯¹å…¶å¯èƒ½è§¦å‘åˆ‡æ¢çš„åœºæ™¯è¿›è¡Œé¢„åŠ è½½ï¼Œcocosä¸­ï¼Œä½¿ç”¨preLoadSceneè¿›è¡Œåœºæ™¯é¢„åŠ è½½ï¼ŒåŠ è½½åéœ€è¦æ‰‹åŠ¨è¿›è¡Œåˆ‡æ¢ï¼šcc.director.preLoadScene( sceneName:string, onProgress:function, onLoaded:function)å‚æ•°ï¼šsceneName ç›®æ ‡åœºæ™¯åç§°onProgress åŠ è½½è¿›åº¦å‘ç”Ÿæ”¹å˜çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ“ä½œåœºæ™¯é¢„åŠ è½½çš„è¿›åº¦æ¡å‚æ•°1ï¼šcompletedCount:number å·²ç»åŠ è½½çš„èµ„æºä¸ªæ•°å‚æ•°2ï¼štotalCount:number åœºæ™¯æ€»èµ„æºä¸ªæ•°å‚æ•°3ï¼šitem:any æµå‡ºåŠ è½½ç®¡é“çš„æœ€æ–°é¡¹ç›®onLoad åŠ è½½å®Œæˆçš„å›è°ƒå‡½æ•°å”¯ä¸€å‚æ•°ï¼š error:Error åŠ è½½å‡ºé”™æ—¶çš„ä¿¡æ¯ å¸¸é©»èŠ‚ç‚¹å¸¸é©»èŠ‚ç‚¹ cocosä¸­sceneçš„åˆ‡æ¢ä¼šæ‘§æ¯æ—§åœºæ™¯ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸ä¼šä¿å­˜æ—§åœºæ™¯ä¸­çš„ä»»ä½•æ•°æ®ï¼Œå®é™…ä¸Šï¼Œæœ‰äº›æ•°æ®æ˜¯éœ€è¦åœ¨å¤šä¸ªåœºæ™¯ä¹‹é—´å¸¸é©»å­˜åœ¨ï¼Œè¿™äº›æ•°æ®ä¸€èˆ¬éƒ½ç”±ä¸€ä¸ªæ•°æ®å­˜å‚¨ç»„ä»¶è¿›è¡Œä¿ç•™ï¼Œè¿™ç§ç»„ä»¶ä¸€èˆ¬ç§°ä¸ºâ€œå¸¸é©»èŠ‚ç‚¹â€ï¼Œå¸¸é©»èŠ‚ç‚¹åœ¨åœºæ™¯åˆ‡æ¢æ—¶ä¸ä¼šè¢«è‡ªåŠ¨é”€æ¯ã€‚å¸¸é©»èŠ‚ç‚¹çš„æ“ä½œä½¿ç”¨åˆ°ä¸‹é¢2ä¸ªAPIï¼šcc.game.addPresistRootNode(node) æ·»åŠ å¸¸é©»èŠ‚ç‚¹cc.game.removePresistRootNode(node)æ¸…ç†å¸¸é©»èŠ‚ç‚¹å±æ€§æ¸…ç†ä¹‹åå‡ ç‚¹ä¾æ—§ä¼šå­˜åœ¨äºå½“å‰çš„åœºæ™¯ä¸­"},{"title":"Particle ç²’å­ç³»ç»Ÿ","path":"/wiki/Cocos/creator_12_Particle.html","content":"ç²’å­ç³»ç»Ÿ ParticleParticle ParticleSystemæ–‡æ¡£ParticleSystemå±æ€§Preview ç¼–è¾‘å™¨å†…é€‰ä¸­ç²’å­æ˜¯å¦è‡ªåŠ¨æ’­æ”¾PlayOnLoad è‡ªåŠ¨å‘å°„ç²’å­AutoRemoveOnFinish è‡ªåŠ¨é”€æ¯ç²’å­èŠ‚ç‚¹File ç²’å­é…ç½®æ–‡ä»¶Custom è‡ªå®šä¹‰ç²’å­å±æ€§ï¼Œè¯¦æƒ…è§æ–‡æ¡£ç²’å­ç³»ç»Ÿçš„æ•ˆæœéœ€è¦è¿›è¡Œå®æ—¶è®¡ç®—ï¼Œå› æ­¤åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿è¡Œæ—¶å¯èƒ½å‡ºç°æ¶ˆè€—èµ„æºçš„é—®é¢˜ï¼Œåœ¨ä½¿ç”¨å‰å¯ä»¥å’ŒAnimationã€Atlasç­‰æ–¹æ³•æ”¾åœ¨ä¸€èµ·æ¯”è¾ƒä¸€ä¸‹"},{"title":"Animation åŠ¨ç”»ç³»ç»Ÿ && Action åŠ¨ä½œç³»ç»Ÿ","path":"/wiki/Cocos/creator_11_Animation.html","content":"åŠ¨ç”»ç³»ç»ŸAnimation åŠ¨ç”»ç³»ç»ŸåŠ¨ç”»ä¸€èˆ¬åˆ†ä¸º2ç§ï¼šå…³é”®å¸§åŠ¨ç”»è‡ªåŠ¨è®¡ç®—2å¸§ä¹‹é—´çš„ä¸­é—´æ•°å€¼åºåˆ—å¸§åŠ¨ç”»æ¯å¸§éƒ½æœ‰ä¸åŒçš„SpriteFrameå¿«é€Ÿç¿»åŠ¨å¸§ï¼Œäº§ç”Ÿå¸§åŠ¨ç”»AnimationClipè¦æ§åˆ¶æŸä¸ªèŠ‚ç‚¹çš„åŠ¨ç”»ï¼Œéœ€è¦ä¸ºç»„ä»¶æ·»åŠ AnimationåŠ¨ç”»æ§åˆ¶å™¨ç»„ä»¶ï¼ŒAnimationç»„ä»¶ä¸­éœ€è¦æ·»åŠ AnimationClipä½œä¸ºæ“ä½œåŠ¨ç”»çš„æºæ–‡ä»¶ï¼ŒAnimationClipæ–‡ä»¶éœ€è¦å†åŠ¨ç”»ç¼–è¾‘å™¨ä¸­è¿›è¡Œç¼–è¾‘ï¼šæŒ‰å¸§ä¿®æ”¹åŠ¨ç”»èŠ‚ç‚¹çš„å±æ€§ï¼Œä½œä¸ºå…³é”®å¸§ã€‚ AnimationClipç¼–è¾‘å™¨ åŒ…å«ä»¥ä¸‹å±æ€§ï¼šå–æ ·ç‡ Sampleå½±å“å¯è®¾ç½®å¸§çš„æœ€å°ç²¾åº¦å•ä½æ’­æ”¾é€Ÿåº¦ Speedå¾ªç¯æ¨¡å¼ WrapModeå¯ä»¥è®¾ç½®å¾ªç¯æ’­æ”¾ã€æ­£æ”¾å€’æ”¾äº¤æ›¿ç­‰ç­‰æ¨¡å¼æ—¶é—´æ›²çº¿åŒå‡»ç¼–è¾‘åŠ¨ç”»é€Ÿç‡å‡½æ•°å¸§äº‹ä»¶æ”¯æŒæ·»åŠ å¸§äº‹ä»¶ï¼Œäº‹ä»¶åå’Œå‚æ•°éƒ½å¯å®šåˆ¶ä¼šä»æ·»åŠ åˆ°ç»„ä»¶ä¸­çš„è„šæœ¬å†…æ‰¾åˆ°ä¸å®šä¹‰çš„å¸§äº‹ä»¶åŒåçš„æ–¹æ³•è„šæœ¬æ§åˆ¶åŠ¨ç”»æ’­æ”¾è„šæœ¬æ§åˆ¶åŠ¨ç”»æ–‡æ¡£æ’­æ”¾åŠ¨ç”» playå¯é€‰å‚æ•°1ï¼šåŠ¨ç”»åå¯é€‰å‚æ•°2ï¼šå¼€å§‹æ—¶é—´anim.play(test, 1) æš‚åœ pauseæ¢å¤ resumeåœæ­¢ stopè®¾ç½®åŠ¨ç”»çš„å½“å‰æ—¶é—´ setCurrentTimeåŠ¨ç”»äº‹ä»¶å›è°ƒplay å¼€å§‹åŠ¨ç”»stop åœæ­¢åŠ¨ç”»pause æš‚åœåŠ¨ç”»resume æ¢å¤åŠ¨ç”»lastframe å­˜åœ¨å¾ªç¯çš„åŠ¨ç”»æ’­æ”¾åˆ°æœ€åä¸€å¸§æ—¶finished åŠ¨ç”»æ’­æ”¾ç»“æŸäº‹ä»¶å›è°ƒçš„é…ç½®ï¼švar animation = this.node.getComponent(cc.Animation);// æ³¨å†Œanimation.on(play, this.onPlay, this);animation.on(stop, this.onStop, this);animation.on(lastframe, this.onLastFrame, this);animation.on(finished, this.onFinished, this);animation.on(pause, this.onPause, this);animation.on(resume, this.onResume, this);// å–æ¶ˆæ³¨å†Œanimation.off(play, this.onPlay, this);animation.off(stop, this.onStop, this);animation.off(lastframe, this.onLastFrame, this);animation.off(finished, this.onFinished, this);animation.off(pause, this.onPause, this);animation.off(resume, this.onResume, this); åŠ¨ä½œç³»ç»ŸAction åŠ¨ä½œç³»ç»Ÿå®˜æ–¹æ–‡æ¡£cc.Nodeå­˜åœ¨ä»¥ä¸‹æ”¯æŒè¿›è¡ŒåŠ¨ä½œçš„APIï¼šrunAction æ‰§è¡ŒåŠ¨ä½œå‚æ•°actionï¼šcc.Actionï¼ŒæŒ‡å®šæ‰§è¡Œçš„åŠ¨ä½œstopAction åœæ­¢æŒ‡å®šåŠ¨ä½œå‚æ•°actionï¼šcc.Actionï¼ŒæŒ‡å®šæ‰§è¡Œçš„åŠ¨ä½œstopAllActions åœæ­¢æ‰€æœ‰åŠ¨ä½œcc.ActionåŠ¨ä½œç±»å‹å¯ä»¥é€šè¿‡è®¾ç½®tagæ¥å®Œæˆsetgetrunstopç­‰ä¸€ç³»åˆ—æ“ä½œï¼šaction.setTag(0)this.node.getActionByTag(0)this.node.stopActionByTag(0) Action API Action APIcocosä¸­åŠ¨ä½œç³»ç»Ÿä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»å®¹å™¨åŠ¨ä½œç”¨äºç»„ç»‡å•ä¸ªæˆ–å¤šä¸ªåŠ¨ä½œçš„æ‰§è¡Œé¡ºåºã€æ¬¡æ•°ã€é€Ÿåº¦å³æ—¶åŠ¨ä½œæ— å…³æ‰§è¡Œæ—¶é—´ã€ç¬é—´å®ç°çš„åŠ¨ä½œæ—¶é—´é—´éš”åŠ¨ä½œåŸºç¡€åŠ¨ä½œä»å¼€å§‹æ‰§è¡Œåˆ°ç»“æŸæ‰§è¡Œä¹‹é—´ï¼Œå­˜åœ¨ä¸€ç³»åˆ—ä¸­é—´å€¼è®¡ç®—çš„åŠ¨ä½œç¼“åŠ¨åŠ¨ä½œæ—¶é—´é—´éš”åŠ¨ä½œçš„é™„å±å±æ€§ï¼Œæ“ä½œä¸€ç³»åˆ—ä¸­é—´å€¼ä¸æ—¶é—´å˜åŒ–çš„æ–¹å¼å®¹å™¨åŠ¨ä½œå³æ—¶åŠ¨ä½œåŸºç¡€åŠ¨ä½œç¼“åŠ¨åŠ¨ä½œsequence é¡ºåºæ‰§è¡ŒåŠ¨ä½œlet seq1 = cc.sequence(act1, act2)let seq2 = cc.sequence(actArray)repeat é‡å¤æŒ‡å®šæ¬¡æ•°çš„æŸä¸ªåŠ¨ä½œlet rep = cc.repeat(cc.sequence(jump2, jump1), 5)repeatForever æ°¸è¿œé‡å¤ä¸€ä¸ªåŠ¨ä½œlet repeat = cc.repeatForever(act)spawn å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡let action = cc.spawn( cc.jumpBy(2, cc.v2(300, 0), 50, 4), cc.rotateBy(2, 720))speed é€Ÿç‡let action = cc.scaleTo(0.2, 1, 0.6)let newAction = cc.speed(action, 0.5)show ç«‹å³æ˜¾ç¤ºlet action = cc.show()hide ç«‹å³éšè—let action = cc.hide()toggleVisibility æ˜¾éšçŠ¶æ€åˆ‡æ¢var action = cc.toggleVisibility();removeSelf ä»çˆ¶èŠ‚ç‚¹ç§»é™¤è‡ªèº«var action = cc.removeSelf()flipX Xè½´ç¿»è½¬var action = cc.flipX(true)flipY Yè½´ç¿»è½¬var action = cc.flipY(true)place æ”¾ç½®åœ¨ç›®æ ‡ä½ç½®let action = cc.place(cc.v2(200, 200))callFunc æ‰§è¡Œå›è°ƒå‡½æ•°// å‚æ•°1ï¼šå›è°ƒå‡½æ•°// å‚æ•°2ï¼šå›è°ƒç›®æ ‡// å‚æ•°3ï¼šä¼ é€’å‚æ•°var finish = cc.callFunc(this.callbackFunc, this.target, true);moveTo ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®moveBy ç§»åŠ¨æŒ‡å®šçš„è·ç¦»rotateTo æ—‹è½¬åˆ°ç›®æ ‡è§’åº¦rotateBy æ—‹è½¬æŒ‡å®šçš„è§’åº¦scaleTo ç¼©æ”¾åˆ°æŒ‡å®šå€æ•°scaleBy æŒ‰æŒ‡å®šå€æ•°ç¼©æ”¾èŠ‚ç‚¹skewTo åç§»åˆ°ç›®æ ‡è§’åº¦skewBy åç§»æŒ‡å®šçš„è§’åº¦jumpBy è·³è·ƒæŒ‡å®šè·ç¦»jumpTo ç”¨è·³è·ƒçš„æ–¹å¼ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®follow è¿½è¸ªç›®æ ‡èŠ‚ç‚¹ä½ç½®bezierTo æŒ‰ç…§è´å¡å°”æ›²çº¿è½¨è¿¹ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®bezierBy æŒ‰ç…§è´å¡å°”æ›²çº¿è½¨è¿¹ç§»åŠ¨æŒ‡å®šè·ç¦»blink é—ªçƒï¼ˆåŸºäºé€æ˜åº¦ï¼‰fadeTo æ¸éšï¼ˆç»™äºˆé€æ˜åº¦ï¼‰fadeIn æ¸æ˜¾fadeOut æ¸éštintTo ä¿®æ”¹é¢œè‰²åˆ°æŒ‡å®šå€¼tintBy æŒ‰ç…§åˆ¶å®šå¢é‡ä¿®æ”¹é¢œè‰²delayTime å»¶è¿ŸæŒ‡å®šçš„æ—¶é—´é‡reverseTime åè½¬ç›®æ ‡åŠ¨ä½œæ—¶é—´è½´è¿åŠ¨å‡½æ•°ï¼Œè¯¦æƒ…å‚è€ƒ å®˜æ–¹æ–‡æ¡£cocosçš„æ–‡æ¡£é‡Œç«Ÿç„¶è¿˜æœ‰çŸ¥ä¹é¡µé¢çš„å¼•ç”¨è·³è½¬åˆ°çš„çŸ¥ä¹é¡µé¢è¿˜éƒ½æ˜¯åæ§½cocosæ–‡æ¡£çš„è¯„è®ºï¼ŒåŒå‘å¥”èµ´äº†è¿™å±äºâ€¦2.4ç‰ˆæœ¬åï¼Œå¼•å…¥çš„ç¼“åŠ¨ç³»ç»Ÿï¼Œä½¿ç”¨cc.Tweenä»£æ›¿äº†cc.ActionåŠ¨ä½œç³»ç»Ÿï¼Œcc.Tweené‡‡ç”¨çš„æ˜¯é“¾å¼åˆ›å»ºï¼Œæ¯”cc.Actionè¦ç®€æ´å¾—å¤š"},{"title":"ç‰©ç†ç³»ç»Ÿ","path":"/wiki/Cocos/creator_10_Physical.html","content":"2Dç‰©ç†ç³»ç»Ÿ2Dç‰©ç†ç³»ç»Ÿ 2Dç‰©ç†ç³»ç»Ÿå®˜æ–¹æ–‡æ¡£ï¼ˆ2.4ç‰ˆæœ¬ï¼‰2.4ç‰ˆæœ¬cocosä¸­éœ€è¦æ‰‹åŠ¨å¼€å¯ç‰©ç†å¼•æ“ï¼ˆéœ€è¦åœ¨onLoadæ–¹æ³•å†…æ‰§è¡Œï¼‰ï¼šcc.director.getPhysicsManager().enabled = trueæƒ³è¦å¼€å¯ä¸€ä¸ªèŠ‚ç‚¹çš„ç‰©ç†ç³»ç»Ÿï¼Œéœ€è¦ç»™è¿™ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸¤ä¸ªç»„ä»¶ï¼šRigidBody åˆšä½“ç»„ä»¶Collider ç¢°æ’ç»„ä»¶ RigidBody åˆšä½“RigidBody ç‰©ç†å±æ€§åˆšä½“æ–¹æ³•Enabled Contact Listenerå¼€å¯ç‰©ç†ç¢°æ’æ£€æµ‹Bulleté˜²æ­¢é«˜é€Ÿç§»åŠ¨çš„ç‰©ä½“ç©¿è¿‡å¢™é¢æˆ–åœ°é¢ç­‰åˆšä½“Typeå‡ ç§åˆšä½“ç±»å‹static é™æ€åˆšä½“kinematic ä¸å—å¤–åŠ›Dynamic åŠ¨æ€åˆšä½“Animated è®¾ç½®çº¿é€Ÿåº¦å’Œè§’é€Ÿåº¦é©±åŠ¨çš„åˆšä½“Allow Sleepå…è®¸åˆšä½“é™æ­¢ä¸åŠ¨æ—¶è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œé™ä½CPUå ç”¨ç‡Gravity Scaleé‡åŠ›å€æ•°ï¼Œ1ä¸º1å€é‡åŠ›Linear Dampingçº¿æ€§é€Ÿåº¦è¡°å‡ç³»æ•°Angular Dampingè§’é€Ÿåº¦è¡°å‡ç³»æ•°Linear Velocityçº¿æ€§åˆé€Ÿåº¦Angular Velocityè§’åˆé€Ÿåº¦Fixed Rotationç¦æ­¢ç‰©ä½“æ—‹è½¬Awake OnLoad æ˜¯å¦åœ¨åˆå§‹åŒ–æ—¶å”¤é†’æ­¤åˆšä½“å°†AwakeOnLoadè®¾ç½®ä¸ºfalseï¼Œåœ¨ä»£ç ä¸­å¯ä»¥é€šè¿‡ä¿®æ”¹åˆšä½“ç»„ä»¶çš„awakeä¸ºtrueï¼Œæ¥å¼€å¯åˆšä½“ï¼šthis.getComponent(cc.RigidBody).awake = trueåˆšä½“æ–¹æ³•æ–‡æ¡£ç»™åˆšä½“æ–½åŠ åŠ›å‚æ•°1ï¼šforce åœ¨xã€yè½´ä¸Šçš„å¤§å°åˆ†é‡å‚æ•°2ï¼špoint ä½œç”¨ç‚¹å‚æ•°3ï¼šwake æ˜¯å¦å”¤é†’åˆšä½“rb.applyForce(force:cc.Vec2, point:cc.Vec2, wake:boolean)æ–½åŠ åŠ›åˆ°åˆšä½“çš„è´¨å¿ƒä¸Šå‚æ•°1ï¼šforce åœ¨xã€yè½´ä¸Šçš„å¤§å°åˆ†é‡å‚æ•°2ï¼šwake æ˜¯å¦å”¤é†’åˆšä½“rb.applyForceToCenter(force:cc.Vec2, wake:boolean)æ–½åŠ æ‰­åŠ›å‚æ•°1ï¼štorque æ‰­åŠ›å¤§å°å‚æ•°2ï¼šwake æ˜¯å¦å”¤é†’rb.applyTorque(torque:number, wake:boolean)æ–½åŠ å†²é‡å‚æ•°1ï¼šimpulse å†²é‡åœ¨xã€yè½´ä¸Šçš„å¤§å°åˆ†é‡å‚æ•°2ï¼špoint ä½œç”¨ç‚¹å‚æ•°3ï¼šwake æ˜¯å¦å”¤é†’rb.applyLinearImpulse(impulse:cc.Vec2, point:cc.Vec2, wake:boolean)æ–½åŠ è§’é€Ÿåº¦å†²é‡å‚æ•°1ï¼šimpulse è§’é€Ÿåº¦å†²é‡å¤§å°å‚æ•°2ï¼šwake æ˜¯å¦å”¤é†’rb.applyAngularImpulse(impulse:number, wake:boolean) åŠ›ä¸å†²é‡ cocosä¸­ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ç§»åŠ¨ä¸€ä¸ªç‰©ä½“ï¼šåŠ› Forceç‰©ä½“æœ¬èº«ç§»åŠ¨çš„å†…åŠ›åŠ›ä¼šéšæ—¶é—´ä¿®æ”¹ç‰©ä½“çš„åæ ‡å’Œæ—‹è½¬è§’åº¦æ·»åŠ ç‰©ä½“å†…åœ¨åŠ›çš„APIï¼šapplyForceapplyForceToCenterapplyTorqueå†²é‡ Impulseä»å¤–ç•Œæ¨åŠ¨ç‰©ä½“çš„å¤–åŠ›å†²é‡ä¼šç«‹åˆ»æ”¹å˜ç‰©ä½“çš„åæ ‡æˆ–æ—‹è½¬è§’åº¦å†²é‡ï¼ˆå¦‚çº¿æ€§åˆé€Ÿåº¦ã€è§’åˆé€Ÿåº¦ï¼‰ï¼Œä¼šæ ¹æ®è¡°å‡ç³»æ•°è€Œé€æ¸å‡å¼±ï¼Œç›´åˆ°ç‰©ä½“çš„å˜åŒ–å®Œå…¨åœæ­¢æ·»åŠ ç‰©ä½“å¤–åŠ›çš„APIï¼šapplyLinearImpulseapplyAngularImpulse Collider ç‰©ç†ç¢°æ’ä½“ç¢°æ’ç»„ä»¶ RigidBodyå¿…é¡»åœ¨ç»„ä»¶ä¸Šå­˜åœ¨Colliderç¢°æ’ä½“çš„æƒ…å†µä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼ŒColliderç¢°æ’ç»„ä»¶å…·æœ‰ä»¥ä¸‹çš„åŸºç¡€å±æ€§ï¼šDensity å¯†åº¦Sensor æ˜¯å¦æ˜¯ä¼ æ„Ÿå™¨ç±»å‹è®¾ç½®äº†ä¼ æ„Ÿå™¨çš„ç¢°æ’ç‰©æœ¬èº«ä¸ä¼šäº§ç”Ÿç¢°æ’æ•ˆæœï¼Œä½†æ˜¯å¯ä»¥ç›‘å¬åˆ°ç¢°æ’äº‹ä»¶å¸¸ç”¨åœºæ™¯ï¼šæŸä¸ªç‰¹æ®Šç‚¹ç›‘å¬åˆ°ç©å®¶çš„ç¢°æ’ä¹‹åï¼Œè§¦å‘äº‹ä»¶ï¼ˆåœºæ™¯è·³è½¬äº¤äº’æ•ˆæœï¼‰Friction æ‘©æ“¦ç³»æ•°Restitution å¼¹æ€§ç³»æ•°Tagå’Œcolliderå±æ€§ä¸€æ ·ï¼Œtagç”¨äºåœ¨ç¢°æ’å›è°ƒä¸­è¯†åˆ«ç¢°æ’ä½“çš„ç±»å‹ç¢°æ’å›è°ƒç¢°æ’å›è°ƒå®˜æ–¹æ–‡æ¡£æƒ³è¦è§¦å‘ç¢°æ’ä½“çš„ç¢°æ’å›è°ƒï¼Œéœ€è¦å¼€å¯ç¢°æ’ä½“RigidBodyçš„Enabled Contact Listenerå±æ€§ï¼Œç¢°æ’å›è°ƒå‡½æ•°ä¸­æœ‰3ä¸ªå‚æ•°ï¼šcontact ç¢°æ’ä¿¡æ¯self ç¢°æ’ç‰©è‡ªå·±other å¦ä¸€ä¸ªç¢°æ’ç‰©// å¼€å§‹ç¢°æ’onBeginContact(contact:cc.PhysicsContact, self:cc.PhysicsCollider, other:cc.PhysicsCollider)// ç»“æŸç¢°æ’onEndContact(contact:cc.PhysicsContact, self:cc.PhysicsCollider, other:cc.PhysicsCollider)// æ¯æ¬¡å¤„ç†ç¢°æ’ä½“æ¥è§¦é€»è¾‘å‰è°ƒç”¨onPreSolve(contact:cc.PhysicsContact, self:cc.PhysicsCollider, other:cc.PhysicsCollider)// æ¯æ¬¡å¤„ç†å®Œæˆç¢°æ’ä½“æ¥è§¦é€»è¾‘åè°ƒç”¨onPostSolve(contact:cc.PhysicsContact, self:cc.PhysicsCollider, other:cc.PhysicsCollider)å…³äºcc.PhysicsContactç±»å‹ï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ç¢°æ’ä¿¡æ¯ï¼šå‚æ•°æ–¹æ³•colliderA ç¢°æ’ä½“AcolliderB ç¢°æ’ä½“Bdisabled ç¦ç”¨disabledOnce åœ¨å½“å‰æ—¶é—´æ­¥ï¼ˆdtï¼‰ä¸­å¿½ç•¥æ­¤æ¥è§¦ä¿¡æ¯getWorldMainfold() è·å–ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ç¢°æ’ä¿¡æ¯è·å–åˆ°çš„ç¢°æ’ä¿¡æ¯å…·æœ‰ä»¥ä¸‹æˆå‘˜ï¼špoints ç¢°æ’ç‚¹æ•°ç»„ï¼Œå¸¸è§æœ‰1-2ä¸ªç¢°æ’ç‚¹normal ç¢°æ’ç‚¹ä¸Šçš„æ³•å‘é‡ï¼Œç”±è‡ªèº«ç¢°æ’ä½“æŒ‡å‘å¯¹æ–¹ç¢°æ’ä½“getMainfold() è·å–å±€éƒ¨åæ ‡ç³»ä¸‹çš„ç¢°æ’ä¿¡æ¯getImpulse() è·å–å†²é‡ä¿¡æ¯åœ¨onPostSolveå›è°ƒä¸­å¯ä»¥è·å–åˆ°ï¼Œè¿”å›å€¼åŒ…å«2ä¸ªå‚æ•°ï¼šnormalImpulses å‘é‡å†²é‡tangentImpulse åˆ‡çº¿å†²é‡getFrictionsetFrictionresetFriction() è·å–è®¾ç½®é‡ç½®æ‘©æ“¦åŠ›ç³»æ•°getRestitutionsetRestitutionresetRestitution() è·å–è®¾ç½®é‡ç½®å¼¹æ€§ç³»æ•°isTouching() ç¢°æ’ä½“æ˜¯å¦å·²ç»è§£é™¤ ç‰©ç†æ£€æµ‹ç‰©ç†ç³»ç»Ÿç®¡ç†å™¨ ç‰©ç†ç³»ç»Ÿå®˜æ–¹æ–‡æ¡£cocosä¸­æœ‰3ç§ç‰©ç†æ£€æµ‹çš„æ–¹æ³•ï¼šç‚¹æ£€æµ‹çŸ©å½¢æ£€æµ‹å°„çº¿æ£€æµ‹ç‚¹æ£€æµ‹æ£€æµ‹æŸä¸ªæŒ‡å®šç‚¹ä½æ˜¯å¦å­˜åœ¨ç¢°æ’ä½“ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¢°æ’ä½“ï¼Œåªä¼šè¿”å›ä¸€ä¸ªéšæœºç»“æœï¼Œåªèƒ½ç”¨äºæµ‹è¯•dynamicåˆšä½“let pysicsCollider = cc.director.getPhysicsManager().testPoint(point)çŸ©å½¢æ£€æµ‹çŸ©å½¢æ£€æµ‹éœ€è¦æŒ‡å®šä¸€ä¸ªä¸–ç•Œåæ ‡ç³»ä¸‹çš„çŸ©å½¢ï¼Œå¦‚æœä¸€ä¸ªç¢°æ’ä½“çš„åŒ…å›´ç›’ä¸çŸ©é˜µå­˜åœ¨é‡å éƒ¨åˆ†ï¼Œä¼šè¿”å›è¯¥ç¢°æ’ä½“åŒæ ·åªèƒ½æ£€æµ‹dynamicç±»å‹çš„ç¢°æ’ä½“ï¼šlet rect = cc.rect(0, 0, 300, 300)let colliders = cc.director.getPhysicsManager().testAABB(rect)å°„çº¿æ£€æµ‹å°„çº¿æ£€æµ‹æ ¹æ®æŒ‡å®šçš„çº¿æ®µï¼Œæ¥åˆ¤æ–­çº¿æ®µç©¿è¿‡çš„ç¢°æ’ä½“ï¼Œè¿”å›çº¿æ®µåœ¨ç©¿è¿‡ç¢°æ’ä½“çš„æ³•å‘é‡ã€ç‚¹ä½ä»¥åŠå…¶å®ƒä¸€äº›ä¿¡æ¯ç”¨æ³•ï¼šlet p1 = cc.v2(0, 200)let p2 = cc.v2(175, 300)let type = cc.RayCastType.Closestlet results = cc.director.directorgetPhysicsManager().rayCast(p1, p2, type)å‚æ•°è¯´æ˜ï¼šp1 çº¿æ®µèµ·ç‚¹p2 çº¿æ®µç»ˆç‚¹type å°„çº¿ç±»å‹ï¼Œåœ¨cc.RayCastTypeä¸­å®šä¹‰ï¼ŒåŒ…æ‹¬ä»¥ä¸‹4ç§Allï¼šæ£€æµ‹å°„çº¿è·¯å¾„ä¸Šçš„æ‰€æœ‰ç¢°æ’ä½“ï¼Œæ£€æµ‹åˆ°çš„ç»“æœé¡ºåºä¸æ˜¯å›ºå®šçš„AllClosestï¼š è¿”å›å°„çº¿è·¯å¾„ä¸Šçš„æ‰€æœ‰ç¢°æ’ä½“ï¼Œä½†æ˜¯ä¼šå¯¹è¿”å›å€¼è¿›è¡Œç­›é€‰ï¼Œåªè¿”å›æ¯ä¸ªç¢°æ’ä½“ä¸å°„çº¿æ¥è§¦çš„ç¬¬ä¸€ä¸ªç‚¹Anyï¼šå®˜æ–¹è§£é‡Šï¼šæ£€æµ‹å°„çº¿è·¯å¾„ä¸Šä»»æ„ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ä»»ä½•ç¢°æ’ä½“ï¼Œç«‹å³ç»“æŸæ£€æµ‹å®é™…ä½¿ç”¨ï¼šè¿”å›çš„æ˜¯æœ€è¿œçš„ç¢°æ’ä½“Closestï¼šæ£€æµ‹å°„çº¿è·¯å¾„ä¸Šæœ€è¿‘çš„ç¢°æ’ä½“ï¼Œé»˜è®¤å€¼ ç‰©ç†æ£€æµ‹å®ç°è‡ªåŠ¨å¯»è·¯ å®ç°ä»£ç ï¼š@ccclassexport default class AutoFindWay extends cc.Component // ç‰©ç†ç®¡ç†å™¨ manager = null // åˆšä½“ rb:cc.RigidBody = null // æ–¹å‘é¡ºåºï¼Œ é»˜è®¤å‘ä¸Šèµ° dir = [1,0] // é€Ÿåº¦ speed = 50000 onLoad() this.manager = cc.director.getPhysicsManager() this.manager.enabled = true // å¼€å¯ç‰©ç†ç®¡ç†å™¨ start () this.rb = this.getComponent(cc.RigidBody) testRaycast(dt) // å¼€å§‹ç‚¹ let startPoint = this.node.getPosition() // ç»“æŸç‚¹ let endPoint // æ¢æµ‹é•¿åº¦ let len = 100 if(this.dir[0] != 0) // æ²¿xè½´å‰è¿› let points = this.manager.rayCast( startPoint, cc.v2(startPoint.x + len * this.dir[0], startPoint.y), cc.RayCastType.Closest) // xè½´ç§»åŠ¨å—é˜»ï¼Œå¼€å§‹æ£€æµ‹ä¸Šä¸‹æ–¹å‘æ˜¯å¦å¯è¡Œï¼ˆæ’é™¤ç¢°æ’ç‰©ä¸ºé‡ç‚¹çš„å¯èƒ½æ€§ï¼‰ if(points.length0 points[0].collider.tag != 1) let hasChange = false let allDir = [-1,1] // éšæœºé€‰æ‹©å…ˆä¸Šè¿˜æ˜¯å…ˆä¸‹ if(Math.random() 0.5) allDir.reverse() for(let i of allDir) let points = this.manager.rayCast( startPoint, cc.v2(startPoint.x, startPoint.y + len * i), cc.RayCastType.Closest) if(points.length == 0) this.dir = [0, i] hasChange = true break; // å½“å‰æ–¹å‘ä¸å¯è¡Œï¼Œä¸Šä¸‹æ–¹å‘ä¹Ÿä¸å¯è¡Œï¼Œæ­¤æ—¶å›å¤´ if(!hasChange) this.dir[0] *= -1 else if(this.dir[1] != 0) // æ²¿yè½´å‰è¿› let points = this.manager.rayCast( startPoint, cc.v2(startPoint.x , startPoint.y + len * this.dir[1]), cc.RayCastType.Closest) // æ£€æµ‹åˆ°ç‚¹çš„å­˜åœ¨ï¼Œå¼€å§‹æ£€æµ‹å·¦å³æ–¹å‘ if(points.length0 points[0].collider.tag != 1) let hasChange = false let allDir = [-1,1] if(Math.random() 0.5) allDir.reverse() for(let i of allDir) let points = this.manager.rayCast( startPoint, cc.v2(startPoint.x + len * i, startPoint.y ), cc.RayCastType.Closest) if(points.length == 0) this.dir = [i, 0] hasChange = true break; // æœªæ”¹å˜ if(!hasChange) this.dir[1] *= -1 // æ·»åŠ çº¿æ€§é€Ÿåº¦ this.rb.linearVelocity = new cc.Vec2( this.speed * dt * this.dir[0], this.speed * dt * this.dir[1] ) update (dt) this.testRaycast(dt)"},{"title":"Element-Scrolls å…ƒç´ å·è½´","path":"/wiki/Cocos/creator_14_Deploy.html","content":"ç‰ˆæœ¬æ§åˆ¶ ä¸€å®šè¦ç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶å•Šåšäº†ä¸€å¤©çš„ç´ æå› ä¸ºç¼–è¾‘å™¨å¡æ­»ï¼Œåœºæ™¯å…¨ä¸¢å¤±ï¼ˆæ€’å•Šå•Šå•Šå•Šï¼‰ï¼Œæ²¡æ³•é€šè¿‡BackupAssetsæ‰¾å›æ¥äº†wocao æ¸¸æˆç®€ä»‹æ¸¸æˆä»‹ç» å±å¹•åˆ†è¾¨ç‡ï¼š375 * 667æ“ä½œæ–¹å¼ï¼šé¼ æ ‡ç‚¹å‡»å±å¹•è§¦æ§æ¸¸æˆç±»å‹ï¼šå¼¹å¹•ç©æ³•ä¼ ç»Ÿç©æ³•çš„å¼¹å¹•æ¸¸æˆï¼Œæ•Œäººä»å±å¹•ä¸Šæ–¹è¢­æ¥ï¼Œä¸è¦è®©å®ƒä»¬å†²ç ´é˜²çº¿ï¼Œ å¹¶èº²é¿å®ƒä»¬çš„å­å¼¹ï¼Œæœ‰4ç§å¯æ”¶é›†ç‰©å“ï¼šé‡‘å¸ï¼šå¯ä»¥ç”¨æ¥è´­ä¹°æ›´åŠ å¼ºåŠ›çš„å­å¼¹çˆ±å¿ƒï¼šå¢åŠ ç”Ÿå‘½è“è‰²è¯æ°´ï¼šåŠ å¿«å°„å‡»é€Ÿåº¦é¥­å›¢ï¼šè¿›å…¥æŒç»­5ç§’çš„æ•£å°„æ—¶é—´ä¸€å…±æœ‰4ç§å­å¼¹ï¼šèƒ½é‡å¼¹ï¼šåˆå§‹å­å¼¹ç«ç„°å¼¹ï¼šå¨åŠ›åŠ å¼ºå²©çŸ³å¼¹ï¼šå¨åŠ›å¼ºï¼Œå°„é€Ÿæ…¢å¶æ—‹é£ï¼šå¨åŠ›å¼±ï¼Œå°„é€Ÿå¿«æ€»å…±æœ‰5ä¸ªå…³å¡ï¼Œæ¯ä¸ªå…³å¡éƒ½æœ‰ç‹¬ç‰¹çš„æ•Œäºº æ¸¸æˆä½“éªŒä½“éªŒåœ°å€ å¼€å§‹æ¸¸æˆç•Œé¢ å…³äºæ¸¸æˆç•Œé¢ æ¸¸æˆè®¾ç½®ç•Œé¢ å¼¹å¹•å°„å‡»ç•Œé¢ åˆ‡æ¢å­å¼¹ å­å¼¹å•†åº— å¤šé‡å…³å¡ å¤šé‡å°„å‡» æ¸¸æˆèƒœåˆ© æ¸¸æˆç»“æŸ å¼€å‘è¿‡ç¨‹åœºæ™¯æ­å»ºèƒŒæ™¯é‡‡å–2å¼ èƒŒæ™¯å›¾å åŠ å¾ªç¯æ»šåŠ¨çš„æ–¹å¼ï¼šåœºæ™¯æ‹¼æ¥æ»šåŠ¨export default class BackScene extends cc.Component scrollHeight:number = 0 @property scrollSpeed:number = 100 onLoad() this.scrollHeight = cc.view.getVisibleSize().height update(dt) this.backMove(dt) backMove(dt) this.node.y -= this.scrollSpeed * dt if(this.node.y = - this.scrollHeight) this.node.y = 0 return æ•Œæˆ‘è„šæœ¬æ•Œäººå’Œç©å®¶å…·æœ‰2ä¸ªæœ€åŸºæœ¬çš„æœºåˆ¶ï¼šç§»åŠ¨å‘å°„å­å¼¹ç©å®¶è„šæœ¬ç§»åŠ¨ä½¿ç”¨TOUCHç›‘æ§ï¼Œè¿™æ ·èƒ½å…¼å®¹åˆ°PCå’Œç§»åŠ¨ç«¯ï¼šexport default class Player extends cc.Component /** ç§»åŠ¨é€Ÿåº¦ */ @property moveSpeed: number = 100; /** ç§»åŠ¨å»¶è¿Ÿ */ @property moveDuration: number = 8; /** ç›®æ ‡åæ ‡ */ targetPosition = x: 0, y: 0, ; /** å¯ç§»åŠ¨çš„æœ€å¤§yå€¼ */ maxY:number = 0 /** å¯ç§»åŠ¨çš„xå€¼èŒƒå›´ */ minX:number = 0 maxX:number = 0; isMoving: boolean = false; start() // åˆå§‹åŒ–ç›®æ ‡ä½ç½® this.targetPosition.x = this.node.x; this.targetPosition.y = this.node.y; // è®¡ç®—å¯ç§»åŠ¨çš„èŒƒå›´ this.maxY = this.node.getParent().height - cc.find(CompPath.TitleMenu).height - this.node.height let xPad = 15 this.minX = xPad + this.node.width/2 this.maxX = this.node.getParent().width + xPad - this.node.width // ç»‘å®šç§»åŠ¨äº‹ä»¶ this.moveByTouch() moveByTouch() const touchWindow = cc.find(CompPath.MainGameWindow) const titleMenu = cc.find(CompPath.TitleMenu) const maxY = titleMenu.y - titleMenu.height touchWindow.on(cc.Node.EventType.TOUCH_START,(event:cc.Event.EventTouch)= if(globalVar.gamePause) return this.isMoving = true ) touchWindow.on(cc.Node.EventType.TOUCH_END,(event:cc.Event.EventTouch)= if(globalVar.gamePause) return this.isMoving = false ) touchWindow.on(cc.Node.EventType.TOUCH_CANCEL,(event:cc.Event.EventTouch)= if(globalVar.gamePause) return this.isMoving = false ) touchWindow.on(cc.Node.EventType.TOUCH_MOVE,(event:cc.Event.EventTouch)= if(globalVar.gamePause) return if(this.isMoving) let ex = event.getLocationX(), ey = event.getLocationY() if(ey - touchWindow.y =0 || ey = maxY) return else if(ex = this.minX || ex = (this.maxX + 15)) return // ä¿®æ”¹ç§»åŠ¨ç‚¹ä½ç½® this.targetPosition.x = ex - 15 this.targetPosition.y =ey - touchWindow.y ) update(dt) // ç¼“åŠ¨ this.node.x += (this.targetPosition.x - this.node.x) / this.moveDuration; this.node.y += (this.targetPosition.y - this.node.y) / this.moveDuration; è‡³äºå‘å°„å­å¼¹ï¼Œä¸€å¼€å§‹æ˜¯æ‰“ç®—ç”±ç©å®¶æ“æ§å­å¼¹å°„å‡»ï¼Œä½†ç”±äºç§»åŠ¨ç«¯æ“ä½œçš„ç•Œé¢æ¯”è¾ƒå°ï¼Œå¦‚æœè¦æ“æ§å°„å‡»ï¼Œå°±éœ€è¦å•ç‹¬è®¾è®¡æ“æ§é¢æ¿ï¼Œè€ƒè™‘åˆ°åªæ˜¯ä¸ªè¾¹å­¦è¾¹åšçš„å°æ¸¸æˆï¼Œå°±æ²¡è®¾è®¡è¿™ä¸ªï¼ˆå…¶å®å°±æ˜¯æ‡’ï¼‰åæ¥å‘ç°è®©ä¸»è§’è·Ÿéšè§¦ç¢°ç‚¹ç§»åŠ¨ï¼Œä¼šè®©è§’è‰²å®Œå…¨è¢«æ‰‹æŒ‡ç›–ä½ï¼ˆæ‚²ï¼‰è¿™ä¸‹ç†è§£ä¸ºä»€ä¹ˆæ‰‹æœºæ¸¸æˆåŸºæœ¬éƒ½æ˜¯ç”¨æ‘‡æ†æˆ–è€…æŒ‡å‡»æ§åˆ¶è§’è‰²ç§»åŠ¨äº†ã€‚æ•Œäººçš„ç§»åŠ¨æ–¹å‘åªæœ‰å‰æ–¹ï¼Œå¹¶ä¸”å®šæ—¶è®¾è®¡ï¼Œè„šæœ¬å’Œç©å®¶ç±»ä¼¼ ç‰©å“æ¡æ‹¾ä¸€å…±è®¾è®¡äº†4ç§å¯æ¡æ‹¾ç‰©å“ï¼šé‡‘å¸çˆ±å¿ƒåŠ é€Ÿå°„å‡»è¯æ°´æ•£å°„é¥­å›¢æ¡æ‹¾ç‰©å“ æ¢å¼¹ç³»ç»Ÿé‡‘å¸ç”¨äºè´­ä¹°ä¸åŒçš„å·è½´ï¼Œä¸åŒçš„å­å¼¹å…·æœ‰ä¸åŒçš„ä¼¤å®³å’Œå°„é€Ÿï¼šåˆ‡æ¢å·è½´ ç²’å­åŠ¨ç”»ParticleSystem æ¸¸æˆèƒœåˆ©æ•ˆæœ æ¸¸æˆå¼€å§‹æ•ˆæœ æ¸¸æˆé€šå…³æ•ˆæœ æ·»åŠ éŸ³æ•ˆ"},{"title":"Storage å­˜å‚¨æ•°æ®","path":"/wiki/Cocos/creator_13_LocalData.html","content":"LocalStorage æœ¬åœ°å­˜å‚¨localStorage cc.sys.localStorageï¼Œæ˜¯å¯¹Web LocalStorageçš„å°è£…ï¼Œå› æ­¤åªæœ‰åœ¨h5é¡µæ¸¸ä¸Šå¯ä»¥è°ƒç”¨localStorage APIæ•°æ®å­˜å‚¨æ–‡æ¡£setItem å­˜å‚¨æ•°æ®å‚æ•°1ï¼škey é”®åå‚æ•°2ï¼švalue é”®å€¼getItem è¯»å–æ•°æ®å‚æ•°1ï¼škey é”®å€¼removeItem ç§»é™¤é”®å€¼å¯¹å‚æ•°1ï¼škey é”®åclear æ¸…ç©ºæ•°æ®"},{"title":"Socket å®æ—¶é€šä¿¡","path":"/wiki/Cocos/creator_15_Socket.html","content":"SocketSocketæ¦‚å¿µ Webç½‘ç»œè¯·æ±‚ä¸€èˆ¬å¸¸ç”¨çš„å°±æ˜¯Httpå’ŒWebSocketï¼Œåœ¨æ¸¸æˆä¸­ï¼Œå¸¸ç”¨Httpè¯·æ±‚å‘æœåŠ¡å™¨ä¼ é€’è·å–ä¸€äº›æ— éœ€å®æ—¶æ›´æ–°çš„æ•°æ®ï¼šåŠ è½½æ¸¸æˆæ•°æ®èµ„æºï¼ˆç©å®¶ç­‰çº§ã€è£…å¤‡ã€æŠ€èƒ½ç­‰ä¿¡æ¯ï¼‰å‘æœåŠ¡å™¨ä¸Šä¼ æ•°æ®ï¼ˆåˆ†æ•°ã€æ¸¸æˆè¿›åº¦ã€ç©å®¶å½“å‰ä½ç½®â€¦ï¼‰Socketä¸€èˆ¬ç”¨äºéœ€è¦å®æ—¶æ›´æ–°çš„ä¸€äº›æ•°æ®ï¼Œè¿›è¡ŒSocketè¿æ¥ä¸€èˆ¬éœ€è¦3ä¸ªæ­¥éª¤ï¼šæœåŠ¡å™¨å¯åŠ¨ç›‘å¬æœåŠ¡å™¨ç«¯server socketï¼Œå¯¹æŒ‡å®šç«¯å£å·è¿›è¡Œç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥å®¢æˆ·ç«¯client socketï¼Œå¯¹æŒ‡å®šçš„ipå’Œç«¯å£å·å‘é€è¿æ¥è¯·æ±‚å¦‚æœç›®æ ‡ipå’Œç«¯å£å·æ˜¯æœåŠ¡å™¨ç«¯å¯¹åº”çš„ï¼Œåˆ™è¿›è¿æ¥ç»§ç»­æœåŠ¡å™¨è¿æ¥ç¡®è®¤å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå»ºç«‹TCPIPé€šé“è”ç½‘æ¸¸æˆä¸€èˆ¬åˆ†ä¸º2ç§ï¼šå±€åŸŸç½‘å¯¹æˆ˜æ¸¸æˆç½‘ç»œæ¸¸æˆå±€åŸŸç½‘å¯¹æˆ˜æ¸¸æˆæ–¹å¼1ï¼šç©å®¶å……å½“å±€åŸŸç½‘é€šä¿¡æœåŠ¡å™¨ä¸€èˆ¬ä¸ºå±€åŸŸç½‘ä¸­ï¼Œå…¶ä¸­ä¸€ä¸ªç©å®¶çš„ä¸»æœºå……å½“æœåŠ¡å™¨ï¼ˆæˆ¿ä¸»ï¼‰ï¼Œå…¶ä»–ç©å®¶é€šè¿‡æˆ¿ä¸»è¿›è¡Œæ•°æ®å…±äº«ï¼ˆä½ç½®ã€è¡€é‡ç­‰æ•°æ®ï¼‰ï¼Œæ­¤æ—¶çš„æˆ¿ä¸»ç±»ä¼¼äºè·¯ç”±å™¨çš„åŠŸèƒ½ã€‚æˆ¿ä¸»é€šè¿‡UDPåè®®å‘å±€åŸŸç½‘å†…æ‰€æœ‰åœ°å€å¹¿æ’­è‡ªå·±çš„IPåœ°å€å’ŒæœåŠ¡ç«¯å£ï¼ˆå…¬ç¤ºè‡ªå·±çš„æˆ¿é—´å·ï¼‰ï¼Œå¹¶ä¸“é—¨å»ºç«‹ä¸€ä¸ªç«¯å£ï¼Œç”¨äºç›‘å¬ç©å®¶çš„è¿›å…¥ï¼ˆæˆ¿é—¨ç«¯å£ï¼‰ï¼Œä¸€æ—¦æœ‰äººä¸æ­¤ç«¯å£å»ºç«‹èµ·è”ç³»ï¼ˆç›‘å¬åˆ°æœ‰ç©å®¶è¿›å…¥æˆ¿é—¨ï¼‰ï¼Œå°±ç«‹åˆ»ä¸ºè¯¥ç©å®¶åˆ†é…ä¸€ä¸ªä¸“é¡¹ç«¯å£ï¼Œå¹¶å»ºç«‹è¿æ¥ï¼ˆç»™æ–°ç”¨æˆ·åˆ†é…ä¸€ä¸ªä¸“äº«é€šé“ï¼‰ï¼Œå¹¶å…³é—­ç©å®¶ä¸æˆ¿é—¨ç«¯å£çš„è¿æ¥ï¼Œè¿™æ ·ç”±ç©å®¶çš„ä¸»æœºå……å½“é€šä¿¡æœåŠ¡å™¨çš„å±€åŸŸç½‘æ–¹å¼ï¼Œä¸€èˆ¬éƒ½ä¼šå¯¹ç©å®¶æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œæ–¹å¼2ï¼šè™šæ‹ŸIPå¸¸è§ç½‘ç»œåœ¨çº¿å¯¹æˆ˜å¹³å°ï¼Œä¸ºç©å®¶åˆ†å‘è™šæ‹ŸIPï¼Œä»è€Œè¾¾åˆ°å°†å¹¿åŸŸç½‘IPæ˜ å°„åˆ°å±€åŸŸç½‘çš„ç›®çš„ç½‘ç»œæ¸¸æˆä¸éœ€è¦ç©å®¶æ¥å……å½“é€šä¿¡æœåŠ¡å™¨ï¼Œè€Œæ˜¯ç”±è¿è¥æ–¹æä¾›ä¸“é—¨çš„é€šä¿¡æœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯è¿™ç§ç»“æ„ï¼šWebæœåŠ¡å™¨ï¼šæ”¶å‘Httpè¯·æ±‚Socketé€šä¿¡æœåŠ¡å™¨ï¼šä¸“æ³¨äºæ”¶å‘ä¸è½¬å‘æ•°æ®ï¼Œå»ºç«‹ç©å®¶é—´Socketè¿æ¥æ•°æ®å­˜å‚¨æœåŠ¡å™¨ï¼šç”¨äºå­˜å‚¨ç©å®¶æ•°æ® Socketå®ä¾‹ æœåŠ¡å™¨ç«¯å®¢æˆ·ç«¯express-wså‚è€ƒåšå®¢å¯ç”¨expressæ¡†æ¶wsæ— æ•ˆå‚è€ƒåšå®¢æœåŠ¡å™¨æ¡†æ¶ï¼šexpresså®‰è£…express-wsï¼šnpm i express-wsæ·»åŠ wsæ˜ å°„è·¯ç”±ï¼Œåˆ›å»ºwebsocket.jsï¼švar express = require(express)var expressWs = require(express-ws)var router = express.Router()expressWs(router)router.ws(/user, (ws, req)= console.log(æ”¶åˆ°è¿æ¥è¯·æ±‚) ws.send(æ¥è‡ªæœåŠ¡å™¨ç«¯æ¨é€çš„æ¶ˆæ¯) ws.on(message,(msg)= // ä¸šåŠ¡ä»£ç  ws.send(`æœåŠ¡å™¨ç«¯æ”¶åˆ°æ¶ˆæ¯ï¼š$msg`) ) let timer = setInterval(()= ws.send(`æœåŠ¡å™¨ç«¯å®šæ—¶æ¨é€æ¶ˆæ¯ï¼š$new Date().getTime()ms`) , 1000) ws.on(close, e = clearInterval(timer) timer = null clients = clients.filter(client = client !== ws) ))module.exports = router;ä¿®æ”¹app.jsvar express = require(express);var expressWs = require(express-ws);var app = express();expressWs(app) // æ³¨å…¥wsvar webSocketRouter = require(./routes/websocket);// æ˜ å°„é“¾æ¥app.use(/ws_api, webSocketRouter);process.env.PORT = 8201module.exports = app;å¦‚æœæ˜¯ä½¿ç”¨çš„expressè„šæ‰‹æ¶æ­å»ºçš„é¡¹ç›®ï¼Œéœ€è¦åœ¨binwwwä¸­åŠ å…¥ä¿®æ”¹ï¼švar app = require(../app);var http = require(http);var server = http.createServer(app);// æ³¨å…¥var expressWs = require(express-ws)(app, server)å®¢æˆ·ç«¯æ–°å»ºwebsocketè¿æ¥ï¼šexport default class WSConnect extends cc.Component start () let socket = new WebSocket(ws://127.0.0.1:8201/ws_api/user) socket.onopen = ()= console.log(ä¸æœåŠ¡å™¨ç«¯å»ºç«‹è¿æ¥) socket.onmessage = (msg)= console.log(msg) socket.onclose = ()= console.log(CLOSEï¼šä¸æœåŠ¡å™¨è¿æ¥æ–­å¼€) å¸¸ç”¨readyStateçŠ¶æ€ç ï¼š0CONNECTINGæ­£åœ¨å»ºç«‹è¿æ¥ï¼Œè¿æ¥æ²¡æœ‰å»ºç«‹å®Œæˆ1OPENè¿æ¥å·²ç»å»ºç«‹å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œé€šä¿¡2CLOSINGè¿æ¥æ­£åœ¨å…³é—­3CLOSEDè¿æ¥å·²ç»å…³é—­æˆ–ä¸å¯ç”¨websocketå®ç°å¹¿æ’­// å­˜æ”¾å½“å‰æ‰€æœ‰è¿æ¥let clients = []router.ws(/user,(ws, req)= clients.push(ws) ws.on(message,(msg)= broadcast(å¹¿æ’­æ•°æ®) ))function broadcast(data) clients.forEach(client = if(client.readyState === client.OPEN) client.send(data) )"},{"title":"ğŸ«€ç”Ÿå‘½æ¸¸æˆ","path":"/wiki/Cocos/game_02_LifeGame.html","content":"èµ„æºåœ°å€ Conway Life Gameè§†é¢‘æ•™ç¨‹ï¼šé˜¿ä¿¡OLlife game demogithubæºç  ğŸ“–è§„åˆ™è¯´æ˜è§„åˆ™è¯´æ˜ æ ¼å­ä»£è¡¨ç»†èƒç”Ÿå‘½ï¼Œç”Ÿæ­»è§„åˆ™å¦‚ä¸‹ï¼šä¸€ä¸ªç»†èƒå‘¨å›´ä¸€å…±æœ‰8ä¸ªç»†èƒå¦‚æœä¸€ä¸ªç»†èƒå‘¨å›´æœ‰3ä¸ªç»†èƒï¼Œåˆ™ç”Ÿï¼ˆæ­»åˆ™è½¬ç”Ÿï¼‰ä¸€ä¸ªç»†èƒå‘¨å›´æœ‰2ä¸ªç»†èƒï¼ŒçŠ¶æ€ä¸å˜å…¶ä»–æƒ…å†µï¼Œç»†èƒä¸ºæ­» 1ï¸âƒ£æ­¥éª¤ä¸€ï¼šå®ç°ç½‘æ ¼ å®ç°æ€è·¯ åˆ›å»ºç½‘æ ¼å®¹å™¨cellAreaåˆ›å»ºå•ä¸ªç½‘æ ¼é¢„åˆ¶ä»¶cellåŒå±‚æ–¹æ ¼ï¼Œæ¨¡æ‹Ÿè¾¹æ¡†åœ¨cellAreaä¸Šï¼Œä½¿ç”¨ç¨‹åºç”Ÿæˆcellç½‘æ ¼ç»™é¢„åˆ¶ä»¶cellæ·»åŠ è®°å½•å’Œä¿®æ”¹çŠ¶æ€çš„è„šæœ¬ç»™cellAreaæ·»åŠ Touchäº‹ä»¶ï¼Œç›‘å¬ç‚¹å‡»åˆ°çš„ç»†èƒç½‘æ ¼ ç¨‹åºç”Ÿæˆç½‘æ ¼ ç½‘æ ¼å®¹å™¨cellAreaå°ºå¯¸ï¼š8000 * 600å•ä¸ªç½‘æ ¼é¢„åˆ¶ä»¶cellå°ºå¯¸ï¼š10 * 10@ccclassexport default class Game extends cc.Component // æ¸¸æˆæš‚åœ pause: boolean = true // å®¹å™¨ @property(cc.Node) cellArea: cc.Node = null // ç»†èƒé¢„åˆ¶ä»¶ @property(cc.Prefab) cellPre: cc.Prefab = null // ç»†èƒå°ºå¯¸ cellSize: number = 10 // æ¨ªè½½æ•°é‡ cellW_Num: number = 0 // åˆ—è½½æ•°é‡ cellH_Num: number = 0 // å­˜æ”¾ç»†èƒèŠ‚ç‚¹ cells: Arraycc.Node[] = [] onLoad () this.cellW_Num = this.cellArea.width / this.cellSize // 800/10=80 this.cellH_Num = this.cellArea.height / this.cellSize // 600/10=60 for(let i = 0; i this.cellW_Num;i++) this.cells[i] = new Array() // åˆå§‹åŒ–ç»†èƒçŸ©é˜µ start () this.layout() // å¸ƒç½®ç»†èƒ layout() for(let i = 0 ; i this.cellW_Num; i++) for(let j = 0; j this.cellH_Num; j++) let newCell = cc.instantiate(this.cellPre) newCell.x = i * this.cellSize newCell.y = j * this.cellSize newCell.setParent(this.cellArea) this.cells[i][j] = newCell ç»†èƒçŠ¶æ€è„šæœ¬Cell å•ä¸ªç»†èƒä¸­ï¼Œåªæœ‰ä¸€ä¸ªä¿¡æ¯ï¼šæ˜¯å¦å­˜æ´»ï¼Ÿæ‰€ä»¥åœ¨cellè„šæœ¬ä¸­ï¼Œéœ€è¦å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼šè®°å½•cellçš„stateä¿®æ”¹stateï¼Œæ ¹æ®ä¿®æ”¹åçš„stateä¿®æ”¹cellçš„é¢œè‰²æš´éœ²å‡ºä¸€ä¸ªåˆ‡æ¢stateçš„æ¥å£@ccclassexport default class Cell extends cc.Component @property(cc.Node) cellItem:cc.Node = null // 0=å­˜æ´» 1=æ­»äº¡ state:number = 0 setState(state = 0) this.state = state switch(this.state) case 0 : this.cellItem.color = new cc.Color(255,255,255); break; case 1 : this.cellItem.color = new cc.Color(0,0,0); break; switchState() this.setState([1,0][this.state]) ç½‘æ ¼äº¤äº’ é¼ æ ‡ç‚¹å‡»ç½‘æ ¼æ—¶ï¼Œå¯ä»¥åˆ‡æ¢ç»†èƒçš„å­˜æ´»çŠ¶æ€ï¼Œå¯¹cellAreaè¿›è¡Œé¼ æ ‡ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼šè·å–é¼ æ ‡äº‹ä»¶çš„ä¸–ç•Œåæ ‡å°†ä¸–ç•Œåæ ‡è½¬æ¢ä¸ºcellAreaä¸‹çš„å±€éƒ¨åæ ‡æ ¹æ®å±€éƒ¨åæ ‡ï¼Œç»“åˆcellå°ºå¯¸ï¼Œè®¡ç®—å½“å‰é¼ æ ‡äº‹ä»¶è§¦å‘çš„cellçš„ç´¢å¼•åæ ‡æ‰¾åˆ°cellï¼Œåˆ‡æ¢çŠ¶æ€@ccclassexport default class Game extends cc.Component //... start () // ... this.cellArea.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this) onTouchStart(e:cc.Event.EventTouch) let pos = e.getLocation() let n_pos = this.cellArea.convertToNodeSpaceAR(pos) let i = Math.floor(n_pos.x / this.cellSize) let j = Math.floor(n_pos.y / this.cellSize) let cell = this.cells[i][j] // åˆ‡æ¢ç»†èƒç½‘æ ¼çŠ¶æ€ cell.getComponent(Cell).switchState() 2ï¸âƒ£æ­¥éª¤äºŒï¼šå®ç°ç»†èƒæ´»åŠ¨æ¨¡æ‹Ÿç¹è¡é€Ÿåº¦æ§åˆ¶ åœ¨updateä¸­ç´¯åŠ å¸§é—´éš”æ—¶é—´ï¼Œæ¯è¿‡0.1ç§’ï¼Œåˆ·æ–°ä¸€æ¬¡ï¼š@ccclassexport default class Game extends cc.Component // æ¸¸æˆæš‚åœ pause:boolean = true // è®¡æ—¶å™¨ timeStep:number = 0 update (dt) if(this.pause) return this.timeStep += dt if(this.timeStep = 0.1) this.timeStep = 0; this.lifeChange() // ç”Ÿå‘½ç¹è¡ lifeChange() //... å®ç°ç»†èƒç¹è¡æ­»äº¡ å®ç°æ€è·¯ï¼šè®°å½•ç»†èƒçŸ©é˜µcellså½“å‰çŠ¶æ€å¿«ç…§nowStateListå–å‡ºæ¯ä¸€ä¸ªcellï¼Œæ ¹æ®å…¶å…«ä¸ªæ–¹ä½çš„ç»†èƒåˆ¤æ–­å…¶æ˜¯å¦æœ‰å¿…è¦æ”¹å˜ç”Ÿå‘½çŠ¶æ€è®°å½•å¿«ç…§ï¼Œåˆ¤æ–­å…«æ–¹ç»“æœæ˜¯å¦æœ‰å¿…è¦æ”¹å˜ç”Ÿå‘½çŠ¶æ€ï¼š@ccclassexport default class Game extends cc.Component // ç”Ÿå‘½ç¹è¡ lifeChange() let nowStateList = [] // è®°å½•çŠ¶æ€å¿«ç…§ for(let i = 0; i this.cellW_Num; i++) nowStateList[i] = [] for(let j = 0; j this.cellH_Num; j++) let state = this.cells[i][j].getComponent(Cell).state nowStateList[i][j] = state // æ ¹æ®åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ‡æ¢ç»†èƒçŠ¶æ€ for(let i = 0;ithis.cellW_Num;i++) for(let j = 0; j this.cellH_Num; j++) let state = this.getCellNextState(nowStateList, x:i, y:j) if(state) this.cells[i][j].getComponent(Cell).switchState() åˆ¤æ–­æ˜¯å¦æœ‰å¿…è¦æ”¹å˜ç»†èƒçŠ¶æ€ï¼š@ccclassexport default class Game extends cc.Component // è®¡ç®—åœ¨ï¼ˆxï¼Œyï¼‰åæ ‡å¤„ï¼ŒçŠ¶æ€ä¸ºnowStateçš„ç»†èƒçš„ä¸‹ä¸€æ­¥çŠ¶æ€ getCellNextState(nowStateList, x, y) let nowState = nowStateList[x][y] let nearCount = 0 // å…«ä¸ªæ–¹ä½çš„åç§»é‡ let grids = [ dx:1, dy:-1, dx:1, dy:0, dx:1, dy:1, dx:0, dy:-1, dx:0, dy:1, dx:-1, dy:-1, dx:-1, dy:0, dx:-1, dy:1, ] for(let grid of grids) let tx = x + grid.dx; if(tx = this.cellW_Num) tx = 0 if(tx = -1) tx = this.cellW_Num - 1 let ty = y + grid.dy; if(ty = this.cellH_Num) ty = 0 if(ty = -1) ty = this.cellH_Num - 1 let targetState = nowStateList[tx][ty] if(targetState == 1) nearCount += 1 // 2ä¸ªæ´»ç»†èƒï¼Œä¸å˜[nginx.conf](..%2F..%2F..%2F..%2F..%2F..%2F..%2FOneDrive%2F%D7%C0%C3%E6%2Fnginx.conf) if(nearCount == 2) return false // 3ä¸ªæ´»ç»†èƒï¼Œï¼ˆæ­»è½¬ï¼‰ç”Ÿ if(nearCount == 3) if(nowState == 0) return true if(nowState == 1) return false // åŸå…ˆä¸ºç”Ÿï¼Œæ­»å» if(nowState == 1) return true // ä¸å˜ return false"},{"title":"ğŸ”ªé£åˆ€æ¸¸æˆ","path":"/wiki/Cocos/game_03_KnifeGame.html","content":"èµ„æºåœ°å€ è§†é¢‘æ•™ç¨‹ï¼šé˜¿ä¿¡OLKnife Game Demogithubæºç  ğŸ“–è§„åˆ™è¯´æ˜è§„åˆ™è¯´æ˜ æ‰¾åˆ°æ—¶æœºå‘æœ¨æ¡©æŠ•å‡ºé£åˆ€ï¼Œæ³¨æ„ï¼šä¸èƒ½æ’åœ¨å·²ç»å‡»ä¸­çš„ä½ç½® ğŸ’»ä»£ç å®ç°å®ç°ä»£ç  @ccclassexport default class Game extends cc.Component // æœ¨æ¡©ï¼ˆæŠ•æ·ç›®æ ‡ï¼‰èŠ‚ç‚¹ @property(cc.Node) targetNode:cc.Node = null // å°åˆ€ï¼ˆæŠ•æ·ç‰©ç¤ºæ„ï¼‰èŠ‚ç‚¹ @property(cc.Node) knifeNode:cc.Node = null //å°åˆ€é¢„åˆ¶ä»¶ @property(cc.Prefab) knifePrefab:cc.Prefab = null // å·²æŠ•å‡ºçš„å°åˆ€åˆ—è¡¨ knifeList:cc.Node[] = [] // å½“å‰æ˜¯å¦å¯ä»¥æŠ•æ· canThrow:boolean = true // æ—‹è½¬é€Ÿåº¦ rotateSpeed:number = 150 // æ—‹è½¬åŠå¾„ï¼ˆæœ¨æ¡©åŠå¾„ï¼‰ rotateRadius:number = 0 onLoad () // ç‚¹å‡»å±å¹•ï¼Œè§¦å‘ä¸¢å‡ºé£åˆ€äº‹ä»¶ this.node.on(cc.Node.EventType.TOUCH_START, this.throwKnife, this) this.rotateRadius = this.targetNode.width / 2 onDestroy(): void // é”€æ¯é£åˆ€äº‹ä»¶ this.node.off(cc.Node.EventType.TOUCH_START, this.throwKnife, this) // æ¯éš”2sè¿›è¡Œå˜é€Ÿ changeSpeed() let dir = Math.random() 0.5? 1: -1 let speedNum = Math.max(200, Math.abs(this.rotateSpeed) + 150 * (Math.random() - 0.5)) if(speedNum 200) speedNum -= Math.random() * 150 this.rotateSpeed = dir * speedNum // ä¸¢å‡ºé£åˆ€ throwKnife() if(this.canThrow) this.canThrow = false this.targetNode.zIndex = 1 let action = cc.sequence( // å‚ç›´é£åˆ°æœ¨æ¡©çš„åœ†å‘¨ä¸Š cc.moveTo(0.15, new cc.Vec2(this.knifeNode.x, this.targetNode.y - this.targetNode.height / 2)), cc.callFunc(()= // åˆ¤å®šæ˜¯å¦å’Œå·²ç»æ’åœ¨ä¸Šé¢çš„é£åˆ€ç¢°æ’ï¼šéå†knifeListï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ—‹è½¬è§’å°äºgapçš„å°åˆ€ let isHit = this.knifeList.some(knife= let gap = 5 let angle = Math.abs(knife.angle) return angle gap || (360 - angle) gap ) // å½“æ£€æŸ¥åˆ°å°åˆ€æ—‹è½¬çš„è§’åº¦å°äº5æ—¶ï¼Œåˆ¤å®šæ’å‡» if(isHit) // å¼¹å› let action = cc.sequence( cc.spawn( cc.moveTo(0.5, this.knifeNode.x, -cc.winSize.height), cc.rotateBy(0.5, -360) ), cc.callFunc(()= // æ¸¸æˆé‡æ–°å¼€å§‹ cc.director.loadScene(game) ) ) this.knifeNode.runAction(action) else // æ²¡æœ‰ç¢°æ’ï¼Œåˆ›å»ºä¸€æŠŠæ–°çš„å°åˆ€ï¼Œä»£æ›¿knifeNodeæ’åœ¨ä¸Šé¢ï¼ŒknifeNodeå¤ä½ this.canThrow = true let newKnife = cc.instantiate(this.knifePrefab) newKnife.setPosition(this.knifeNode.position) this.node.addChild(newKnife) this.knifeList.push(newKnife) this.knifeNode.setPosition(new cc.Vec2(0, -300)) ) ) this.knifeNode.runAction(action) start () // å®šæ—¶å˜é€Ÿ setInterval(()=this.changeSpeed(), 2000) update (dt) // æœ¨æ¡©æ—‹è½¬ this.targetNode.angle = (this.targetNode.angle + this.rotateSpeed * dt) % 360 //å°åˆ€å’Œæœ¨æ¡©æ—‹è½¬ä¸€è‡´ï¼Œè¦è®¡ç®—ç›¸å¯¹æœ¨æ¡©åœ†å¿ƒçš„ä½ç§»ä½ç½® this.knifeList.forEach((knife:cc.Node)= knife.angle = (knife.angle + this.rotateSpeed * dt) % 360 let rad = Math.PI * (knife.angle - 90) / 180 knife.x = this.targetNode.x + this.rotateRadius * Math.cos(rad) knife.y = this.targetNode.y + this.rotateRadius * Math.sin(rad) )"},{"title":"2Dæ¨ªç‰ˆè§’è‰²ç§»åŠ¨-æ”»å‡»-è·³è·ƒ-å†²åˆº-é—ªé¿","path":"/wiki/Cocos/game_01_MatchMan.html","content":"åŸè§†é¢‘æ•™ç¨‹ PopovStudio å‡†å¤‡å·¥ä½œå°†éª¨éª¼åŠ¨ç”»æ–‡ä»¶ä»DragonBonesä¸­å¯¼å‡ºä¹‹åï¼Œä¸€å…±ç”Ÿæˆäº†3ä¸ªæ–‡ä»¶ï¼šhero_ske.json éª¨éª¼æ•°æ® hero_tex.json texå®šä½æ•°æ®hero_tex.png texæ‹¼æ¥å›¾ç‰‡åˆ›å»ºç©ºèŠ‚ç‚¹ä½œä¸ºheroï¼Œæ–°å¢DragonBonesç»„ä»¶ï¼Œå°†å¯¼å‡ºçš„jsonæ–‡ä»¶èµ‹å€¼åˆ°å¯¹åº”çš„ä½ç½®ï¼š è§’è‰²ç§»åŠ¨ä¸ç›¸æœºè·Ÿéšè§’è‰²æ¨ªå‘ç§»åŠ¨ è§’è‰²æ¨ªå‘ç§»åŠ¨ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼šè§’è‰²å¯ä»¥æ¨ªå‘ç§»åŠ¨ç›¸æœºè·Ÿéšæ–¹å‘æ”¹å˜ç¼“åŠ¨@ccclassexport default class Hero extends cc.Component /** * è·Ÿéšç›¸æœº */ @property(cc.Node) camera: cc.Node = null /** * è‹±é›„é€Ÿåº¦ */ @property heroSpeed:number = 1 /** * ç§»åŠ¨æ–¹å‘ */ dir:number = 1 /** * æ§åˆ¶è‡ªåŠ¨åˆ‡æ¢æ–¹å‘è®¡æ—¶å™¨ */ changeDirTime = 100 update(dt) // è‡ªåŠ¨åˆ‡æ¢æ–¹å‘ this.changeDirFunction() // è‹±é›„ç§»åŠ¨ this.heroMove() // ç›¸æœºè·Ÿéš this.cameraMove() // è‡ªåŠ¨åˆ‡æ¢æ–¹å‘ changeDirFunction() this.changeDirTime -- if(this.changeDirTime = 0) // åƒåæ–¹å‘äº§ç”Ÿä¸€ä¸ªéšæœºçš„åŠ› this.changeDirTime = 50 + Math.floor(Math.random() * 101) this.dir *= -1 // è½¬æ¢æ–¹å‘æ—¶ï¼Œä»0é€Ÿåº¦å¼€å§‹åŠ é€Ÿ this.heroSpeed = 0 // è‹±é›„ç§»åŠ¨ heroMove() // ease-in ç¼“å…¥åŠ¨ç”» if(this.heroSpeed = 3) this.heroSpeed += 0.1 switch(this.dir) case 1: // å‘å³ç§»åŠ¨ this.node.x += this.heroSpeed; break; case -1: this.node.x -= this.heroSpeed break; // æ‘„åƒæœºè·Ÿéš cameraMove() this.camera.x = this.node.x this.camera.y = this.node.y ç§»åŠ¨æ‰‹æŸ„åˆ›å»ºç§»åŠ¨æ‰‹æŸ„åˆ›å»ºç§»åŠ¨æ‰‹æŸ„UIç»„ä»¶ï¼šæ–°å»ºrocker.tsè„šæœ¬ï¼Œç”¨äºæ§åˆ¶æ§åˆ¶å™¨ä¸­ç§»åŠ¨æ‰‹æŸ„çš„æ“ä½œï¼š@ccclassexport default class Rocker extends cc.Component /** * ç§»åŠ¨æ‰‹æŸ„ */ @property(cc.Node) Stick: cc.Node = null /** * æœ€å¤§åŠå¾„ */ @property max_r:number = 100 start () // æ³¨å†Œè§¦æ‘¸äº‹ä»¶ // å¼€å§‹è§¦æ‘¸ this.node.on(cc.Node.EventType.TOUCH_START,(e:cc.Event.EventTouch) = const w_pos = e.getLocation() // è·å–è§¦æ‘¸ç‚¹ä¸–ç•Œåæ ‡ const n_pos = this.node.convertToNodeSpaceAR(w_pos) // è½¬åŒ–ä¸ºè¯¥èŠ‚ç‚¹çš„åæ ‡ // æ§åˆ¶ç§»åŠ¨è·ç¦» let len = n_pos.mag() // è¿”å›åŸç‚¹åˆ°è¯¥ç‚¹åæ ‡å‘é‡çš„é•¿åº¦ if(len this.max_r) // ä½¿ç”¨ä¸‰è§’å‡½æ•°å®ç° n_pos.x = this.max_r * n_pos.x / len n_pos.y = this.max_r * n_pos.y / len this.Stick.setPosition(n_pos) ) // è§¦æ‘¸ç§»åŠ¨ this.node.on(cc.Node.EventType.TOUCH_MOVE, (e:cc.Event.EventTouch) = const w_pos = e.getLocation() const n_pos = this.node.convertToNodeSpaceAR(w_pos) // æ§åˆ¶ç§»åŠ¨è·ç¦» let len = n_pos.mag() if(len this.max_r) n_pos.x = this.max_r * n_pos.x / len n_pos.y = this.max_r * n_pos.y / len this.Stick.setPosition(n_pos) ) // è§¦æ‘¸ç»“æŸ this.node.on(cc.Node.EventType.TOUCH_END, (e:cc.Event.EventTouch) = this.Stick.setPosition(0, 0) ) // è§¦æ‘¸å–æ¶ˆ this.node.on(cc.Node.EventType.TOUCH_CANCEL, (e:cc.Event.EventTouch) = this.Stick.setPosition(0, 0) ) æ§åˆ¶ç©å®¶å·¦å³ç§»åŠ¨æ‰‹æŸ„æ§åˆ¶ç§»åŠ¨ å…³é”®ç‚¹ï¼šæ£€æµ‹æ‰‹æŸ„ç§»åŠ¨åæ ‡çš„xå€¼æ­£å€¼å‘å³ç§»åŠ¨è´Ÿå€¼å‘å·¦ç§»åŠ¨æ£€æµ‹æ‰‹æŸ„çš„è§¦æ‘¸ç»“æŸå’Œå–æ¶ˆäº‹ä»¶å–æ¶ˆæ—¶ç©å®¶åœæ­¢è¡ŒåŠ¨ç›¸æœºè®¾ç½®æœ€å¤§è·Ÿéšå‚æ•°ä¿ç•™ç›¸æœºå’Œç©å®¶ä¹‹é—´çš„ä¸€å®šç§»åŠ¨è·ç¦»æ–¹å‘ç§»åŠ¨å’Œåœæ­¢æ‰‹æŸ„æ¯æ¬¡ç›‘å¬åˆ°ç§»åŠ¨éƒ½è§¦å‘ç©å®¶çš„æ–¹ä½åˆ¤æ–­æ‰‹æŸ„è„šæœ¬ï¼š@ccclassexport default class Rocker extends cc.Component // ... /** * æ‰‹æŸ„ç§»åŠ¨çš„ç©å®¶ */ @property(cc.Node) Hero:cc.Node = null heroJs = null start () this.heroJs = this.Hero.getComponent(HeroComp) this.node.on(cc.Node.EventType.TOUCH_START,(e:cc.Event.EventTouch) = // ... this.heroJs.setDir(n_pos.x) // ç©å®¶è¿›è¡Œæ–¹ä½åˆ¤æ–­ ) // è§¦æ‘¸ç§»åŠ¨ this.node.on(cc.Node.EventType.TOUCH_MOVE, (e:cc.Event.EventTouch) = // ... this.heroJs.setDir(n_pos.x) ) // è§¦æ‘¸ç»“æŸ this.node.on(cc.Node.EventType.TOUCH_END, (e:cc.Event.EventTouch) = // ... this.heroJs.cancelMove() ) // è§¦æ‘¸å–æ¶ˆ this.node.on(cc.Node.EventType.TOUCH_CANCEL, (e:cc.Event.EventTouch) = // ... this.heroJs.cancelMove() ) Heroè„šæœ¬ï¼š@ccclassexport default class HeroComp extends cc.Component /** * ç›¸æœºé€Ÿåº¦ */ @property cameraSpeed:number = 0 /** * è‹±é›„é€Ÿåº¦ */ @property heroSpeed:number = 0 /** * ç§»åŠ¨æ–¹å‘ */ dir:number = 0 // åœæ­¢ç§»åŠ¨ cancelMove() this.dir = 0 // æ ¹æ®xè®¾ç½®ç§»åŠ¨æ–¹å‘ setDir(x) let preDir = this.dir if(x0) // å‘å·¦ this.dir = 1; if(this.node.scaleX != -0.3) this.node.scaleX = -0.3 else if(x0) // å‘å³ this.dir = -1 if(this.node.scaleX != 0.3) this.node.scaleX = 0.3 if(preDir !== this.dir) // ä¿®æ”¹æ–¹ä½/åœä¸‹/å¼€å§‹è¡ŒåŠ¨ï¼Œheroå’Œç›¸æœºçš„ç§»åŠ¨é€Ÿåº¦åŒæ—¶ç½®0 this.heroSpeed = 0 this.cameraSpeed = 0 ç›¸æœºè·Ÿéšæ·»åŠ æœ€å¤§èµ·å§‹è·Ÿéšè·ç¦»ï¼Œå¯¹ç›¸æœºè·Ÿéšé€Ÿåº¦è¿›è¡Œç¼“åŠ¨å¤„ç†ï¼š@ccclassexport default class HeroComp extends cc.Component // ... /** * è·Ÿéšç›¸æœº */ @property(cc.Node) camera: cc.Node = null /** * ç›¸æœºé€Ÿåº¦ */ @property cameraSpeed:number = 0 // æ‘„åƒæœºè·Ÿéš cameraMove() // ç›¸æœºè¿›è¡Œé˜»å°¼å¼è·Ÿéš let dis = Math.abs(this.camera.x - this.node.x) if(dis 5) return if(this.cameraSpeed = 3) this.cameraSpeed += 0.1 if(this.camera.x this.node.x) this.camera.x += this.cameraSpeed else this.camera.x -= this.cameraSpeed åŠ¨ç”»åˆ‡æ¢éœ€è¦ç»™ç©å®¶æ·»åŠ çŠ¶æ€æœºå‚æ•°è¿›è¡Œæ§åˆ¶:@ccclassexport default class HeroComp extends cc.Component // é¾™éª¨ç»„ä»¶ dbDisplay = null dbArmature = null // çŠ¶æ€æœº 0å¾…æœº 1å¥”è·‘ state = 0 onLoad() this.dbDisplay = this.node.getComponent(dragonBones.ArmatureDisplay) this.dbArmature = this.dbDisplay.armature() // æ’­æ”¾åŠ¨ç”» animFunction(animName) // è°ƒç”¨æ¥å£æ’­æ”¾åŠ¨ç”» this.dbArmature.animation.fadeIn(animName,-1, -1, 0, ANI_GROUP, dragonBones.AnimationFadeOutMode.All) // åœæ­¢ç§»åŠ¨ cancelMove() this.dir = 0 this.state = 0 this.animFunction(å¾…æœº) // æ ¹æ®xè®¾ç½®ç§»åŠ¨æ–¹å‘ setDir(x) let preDir = this.dir this.state = 1 if(x0)/*å‘å·¦ç•¥*/ else if(x0)/*å‘å³ç•¥*/ if(preDir !== this.dir) // è½¬æ¢æ–¹å‘/ç”±å¾…æœºåˆ°å¥”è·‘çŠ¶æ€ this.heroSpeed = 0 this.cameraSpeed = 0 this.animFunction(å¥”è·‘) ç‰©ç†ç»„ä»¶ç‰©ç†ç»„ä»¶ å…¨å±€å¼€å¯ç‰©ç†å¼•æ“ï¼š@ccclassexport default class Game extends cc.Component physicDirector = null onLoad() this.physicDirector = cc.director.getPhysicsManager() this.physicDirector.enabled = true ç»™Heroå’ŒGroundåœ°é¢æ·»åŠ ç‰©ç†ç¢°æ’æ£€æµ‹ç»„ä»¶ï¼ŒåŒæ—¶ç»™é¡¹ç›®æ·»åŠ Heroå’ŒGroundçš„åˆ†ç»„å¼€å¯2ç»„ä¹‹é—´çš„ç¢°æ’æ£€æµ‹ç”±äºä¹‹å‰Heroçš„ç§»åŠ¨æ˜¯é€šè¿‡ç›´æ¥ä¿®æ”¹åæ ‡å®ç°çš„ï¼Œè¿™é‡Œæ”¹ä¸ºç»™Heroçš„åˆšä½“æ·»åŠ çº¿æ€§é€Ÿåº¦å®ç°ï¼šheroMove() const v = this.body.linearVelocity // ease-in if(this.heroSpeed = 6) this.heroSpeed += 0.4 switch(this.dir) case 1: // å‘å³ç§»åŠ¨ // this.node.x += this.heroSpeed; v.x += this.heroSpeed break; case -1: // this.node.x -= this.heroSpeed v.x -= this.heroSpeed break; this.body.linearVelocity = v Heroè·³è·ƒJump è·³è·ƒæ—¶ï¼Œæ·»åŠ ä¸€ä¸ªå‘ä¸Šçš„çº¿æ€§é€Ÿåº¦éœ€è¦ç›‘å¬è·³è·ƒåŠ¨ç”»çš„æ’­æ”¾è·³è·ƒå¼€å§‹ï¼Œæ’­æ”¾è·³è·ƒåŠ¨ç”»è·³è·ƒç»“æŸï¼Œéœ€è¦å›åˆ°å¥”è·‘æˆ–å¾…æœºçš„çŠ¶æ€å¢åŠ è·³è·ƒCDçš„è®¾ç½®@ccclassexport default class HeroComp extends cc.Component // é¾™éª¨ç»„ä»¶ dbDisplay = null // çŠ¶æ€æœº 0å¾…æœº 1å¥”è·‘ state = 0 // è·³è·ƒé—´éš” jumpCD:number = 0 onLoad() this.dbDisplay = this.node.getComponent(dragonBones.ArmatureDisplay) // ç»‘å®šåŠ¨ç”»æ’­æ”¾ç»“æŸäº‹ä»¶ this.dbDisplay.on(dragonBones.EventObject.COMPLETE, this.aniComplete, this) update(dt) // CDå‡å°‘ if(this.jumpCD 0) this.jumpCD -- // åŠ¨ç”»æ’­æ”¾ç»“æŸäº‹ä»¶ aniComplete() // å›åˆ°çŠ¶æ€æœºæ‰€åœ¨çš„çŠ¶æ€ if(this.state == 1) this.animFunction(å¥”è·‘) else if( this.state == 0) this.animFunction(å¾…æœº) // æ’­æ”¾åŠ¨ç”» animFunction(animName) // è°ƒç”¨æ¥å£æ’­æ”¾åŠ¨ç”» this.dbArmature.animation.fadeIn(animName,-1, -1, 0, ANI_GROUP, dragonBones.AnimationFadeOutMode.All) // è·³è·ƒ jump() // å¦‚æœè·³è·ƒcdæœªè¿‡ï¼Œæ— æ³•è·³è·ƒ if(this.jumpCD 0) return const v = this.body.linearVelocity v.y = 450 // å¢åŠ ä¸€ä¸ªå‘ä¸Šçš„åŠ› this.body.linearVelocity = v this.animFunction(æ™®é€šè·³è·ƒ) this.jumpCD = 50 // é‡ç½®è·³è·ƒcd Hero æ”»å‡»æ™®é€šæ”»å‡»åŠ¨ç”»æ ¹æ®æ”»å‡»é—´éš”ï¼Œæ’­æ”¾æ”»å‡»åŠ¨ç”»@ccclassexport default class HeroComp extends cc.Component // æ”»å‡»é—´éš” attachCD:number = 0; update(dt) if(this.attachCD 0) this.attachCD -- // æ”»å‡» attack() if(this.attachCD 0) return // æ’­æ”¾æ”»å‡»åŠ¨ç”» this.animFunction(æ™®æ”»_01) this.attachCD = 50 è¿æ‹›æ”»å‡»ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å­˜æ”¾è¿æ‹›éœ€è¦ç”¨çš„åŠ¨ç”»åå­—å¼•å…¥ä¸€ä¸ªè¿æ‹›CDç”¨äºåˆ¤æ–­è§’è‰²æ¯æ¬¡æ”»å‡»ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå¼•å…¥ä¸€ä¸ªç”¨äºè®°å½•å½“å‰è¿æ‹›çš„å˜é‡// è¿æ‹›æ•°ç»„const attAnimList = [æ™®æ”»_01,æ™®æ”»_02,æ™®æ”»_03,æ™®æ”»_04,]@ccclassexport default class HeroComp extends cc.Component // è¿æ‹›é—´éš” combatCD:number = 0 update(dt) if(this.attCount 0) if(this.combatCD 0) this.combatCD -- if(this.combatCD = 0) this.attCount = 0 // æ”»å‡» attack() if(this.attachCD 0) return this.animFunction(attAnimList[this.attCount]) // å¢åŠ è¿æ‹›åºå· this.attCount = (this.attCount + 1) % attAnimList.length switch(this.attCount) // æ ¹æ®å½“å‰è¿æ‹›åºå·ï¼Œä¿®æ”¹è¿æ‹›CD case 1: this.combatCD = 120;break; case 2: this.combatCD = 140;break; case 3: this.combatCD = 160;break; this.attachCD = 50 æ”»å‡»æ£€æµ‹ä½¿ç”¨æ”»å‡»èŒƒå›´å’Œå—å‡»èŒƒå›´åŒ…å›´ç›’å¼æ£€æµ‹ï¼Œéœ€è¦çŸ¥é“å¦‚ä¸‹å‚æ•°ï¼šæ”»å‡»æ–¹ aå½“å‰åæ ‡ a.x, a.yæ­¤æ—¶æœå‘ a.diræ­£é¢æ”»å‡»èŒƒå›´ a.aR.x_01èƒŒé¢æ”»å‡»èŒƒå›´ a.aR.x_02æ”»å‡»é«˜åº¦ a.aR.yå—å‡»æ–¹ nå½“å‰åæ ‡ n.x, n.yæ­¤æ—¶æœå‘ n.diræ­£é¢å—å‡»èŒƒå›´ n.hR.xèƒŒé¢å—å‡»èŒƒå›´ ï¼ˆæ­¤å¤„å’Œå›¾ä¸å¤ªä¸€æ ·ï¼ŒèƒŒé¢å—å‡»å’Œæ­£é¢å—å‡»è®¾ç½®ä¸€æ ·çš„èŒƒå›´ï¼‰å—å‡»é«˜åº¦ n.hR.yå­˜åœ¨ä¸‹é¢å‡ ç§å¯èƒ½ç¬¬ä¸€è¡Œï¼šç©å®¶æœå·¦ç¬¬äºŒè¡Œï¼šç©å®¶æœå³å·²ç»çŸ¥é“ç©å®¶æ”»å‡»æ–¹å‘æœå·¦ï¼Œå°±èƒ½çŸ¥é“ç©å®¶çš„æ”»å‡»åŒ…å›´ç›’å­˜åœ¨ç¢°æ’çš„å¯èƒ½æ€§æœ‰å¾ˆå¤šï¼Œä¸€ä¸€åˆ¤æ–­æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­ä¸ä¼šç¢°æ’çš„æƒ…å†µlet hit = !( a.x - a.aR.x_01 n.x + n.hR.x || // æ­£é¢æ‰“ä¸åˆ° a.x + a.aR.x_02 n.x - n.hR.x || // èƒŒé¢åˆ°ä¸åˆ° a.y n.y + n.hR.y || // ä¸Šé¢æ‰“ä¸åˆ° a.y + a.aR.y n.y // ä¸‹é¢æ‰“ä¸åˆ°)let hit = !( a.x + a.aR.x_01 n.x - n.hR.x || // æ­£é¢æ‰“ä¸åˆ° a.x - a.aR.x_02 n.x + n.hR.x || // èƒŒé¢æ‰“ä¸åˆ° a.y n.y + n.hR.y || // ä¸Šé¢æ‰“ä¸åˆ° a.y + a.aR.y n.y // ä¸‹é¢æ‰“ä¸åˆ°)æ ¹æ®ä¸Šé¢çš„åˆ¤æ–­æ¡ä»¶ï¼Œåˆ›å»ºç”¨äºæ£€æµ‹æˆ˜æ–—æ£€æµ‹çš„æ–¹æ³•ï¼š/** * @param aNode æ”»å‡»æ–¹Node * @param a æ”»å‡»æ–¹è‡ªå®šä¹‰ç»„ä»¶ç±» * @param nNode å—å‡»æ–¹Node * @param n å—å‡»æ–¹è‡ªå®šä¹‰ç»„ä»¶ç±» * @param _faceDir æ”»å‡»æ–¹æœå‘ */export const checkCollide = (aNode, a, nNode, n, _faceDir) = /** * å½“å—æ”»å‡»æ–¹çš„å—å‡»ç›’ å’Œæ”»å‡»æ–¹çš„æ”»å‡»ç›’ æœ‰äº¤å‰éƒ¨åˆ†æ—¶ï¼Œ * æ£€æµ‹åˆ°æ”»å‡» */ switch(_faceDir) case -1: // å‘å·¦ return !( aNode.x - a.aR.x_01 nNode.x + n.hR.x || // æ­£é¢æ‰“ä¸åˆ° aNode.x + a.aR.x_02 nNode.x - n.hR.x || // èƒŒé¢åˆ°ä¸åˆ° aNode.y nNode.y + n.hR.y || // ä¸Šé¢æ‰“ä¸åˆ° aNode.y + a.aR.y nNode.y // ä¸‹é¢æ‰“ä¸åˆ° ) break; case 1: // å‘å³ return !( aNode.x + a.aR.x_01 nNode.x - n.hR.x || // æ­£é¢æ‰“ä¸åˆ° aNode.x - a.aR.x_02 nNode.x + n.hR.x || // èƒŒé¢æ‰“ä¸åˆ° aNode.y nNode.y + n.hR.y || // ä¸Šé¢æ‰“ä¸åˆ° aNode.y + a.aR.y nNode.y // ä¸‹é¢æ‰“ä¸åˆ° ) break; Heroä¸­ç”¨äºè¿›è¡Œå‡»ä¸­æ£€æµ‹çš„è„šæœ¬ï¼š@ccclassexport default class HeroComp extends cc.Component // èº«ä½“æœå‘ 1=å³ä¾§ -1=å·¦ä¾§ bodyDir:number = 1 // æ”»å‡»è·ç¦» aR = x_01: 0, // æ­£é¢æ”»å‡»è·ç¦» x_02: 0, // èƒŒé¢æ”»å‡»è·ç¦» y: 0, // å‚ç›´æ”»å‡»é«˜åº¦ onLoad() // é‡ç½®èº«ä½“è½¬å‘å³ä¾§ this.node.scaleX = -0.3 // åˆå§‹åŒ–ç¢°æ’ç›’ this.aR.x_01 = this.node.width * 0.3 * 1 // æœå‰ä¸€èº« this.aR.x_01 = this.node.width * 0.3 * 0.5 // æœååŠèº« this.aR.y = this.node.height * 0.3 // é«˜åº¦å…¨èº« // æ·»åŠ ä¸€ä¸ªåŠ¨ç”»å¸§æ¥æ§åˆ¶ this.dbDisplay.on(dragonBones.EventObject.FRAME_EVENT, this.frameEvent, this) // åŠ¨ç”»ä¸­çš„å¸§äº‹ä»¶éœ€è¦åœ¨é¾™éª¨ä¸­åŠ å…¥ frameEvent(e) switch(e.name) // æ”»å‡»åŠ¨ç”»æ’­æ”¾åˆ°ä¸€åŠï¼Œå¼€å§‹åˆ¤å®šæ•Œäººå—ä¼¤ case attack: let enemyNode = window.game.getComponent(Game).enemy_01 let enemy = enemyNode.getComponent(Enemy) // åˆ¤æ–­æ˜¯å¦å‡»ä¸­ let hit = checkCollide( this.node, this, enemyNode, enemy, this.bodyDir ) if(hit) // è°ƒå–æ•Œäººçš„è¢«å‡»ä¸­æ–¹æ³• enemy.getHit() break; Enemyä¸­ç”¨äºæ£€æµ‹è¢«å‡»ä¸­çš„è„šæœ¬ï¼šconst ANI_GROUP = normalGroupconst ccclass, property = cc._decorator;// å—å‡»æ•°ç»„const hitAnimList = [å—å‡»_01,å—å‡»_02,å—å‡»_03,å—å‡»_04,]@ccclassexport default class Enemy extends cc.Component // æ•Œäººå—å‡»èŒƒå›´ hR = x:0, y:0 dbDisplay = null dbArmature = null // èº«ä½“æœå‘ bodyDir = 1 onLoad() this.setFaceDir(1) this.dbDisplay = this.node.getComponent(dragonBones.ArmatureDisplay) this.dbArmature = this.dbDisplay.armature() this.dbDisplay.on(dragonBones.EventObject.COMPLETE, this.aniComplete, this) // æ’­æ”¾åŠ¨ç”» animFunction(animName) // è°ƒç”¨æ¥å£æ’­æ”¾åŠ¨ç”» this.dbArmature.animation.fadeIn(animName,-1, -1, 0, ANI_GROUP, dragonBones.AnimationFadeOutMode.All) // è¢«å‡»ä¸­è„šæœ¬ getHit() // éšæœºé€‰æ‹©è¢«å‡»ä¸­åŠ¨ç”» let index = Math.floor(Math.random() * hitAnimList.length) let ani_name = hitAnimList[index] this.animFunction(ani_name) // æ”¶åˆ°ä¼¤å®³åï¼Œé¢å‘hero let dir = 1 if(this.node.x window.game.hero.x) dir = -1 // å‘å³è½¬ this.setFaceDir(dir) setFaceDir(dir) this.bodyDir = dir this.node.scaleX = 0.3*-dir // åŠ¨ç”»æ’­æ”¾ç»“æŸäº‹ä»¶ aniComplete() this.animFunction(å¾…æœº) start () // åˆå§‹åŒ–æ•Œäººå—ä¼¤å®³çš„èŒƒå›´ this.hR.x = this.node.width * 0.3 this.hR.y = this.node.height * 0.3 å¯¹å…¨å±€å¯¹è±¡çš„æ‰©å……ç”±äºåƒenemyã€heroè¿™ç§èŠ‚ç‚¹æ¯”è¾ƒå…³é”®ï¼Œå…¨å±€éƒ½æœ‰å¯èƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥å¯ä»¥å°†ä»–ä»¬é›†ä¸­æŒ‚è½½åˆ°windowå…¨å±€å¯¹è±¡ä¸‹,å…ˆåœ¨æ ¹ç›®å½•ä¸‹åŠ å…¥global.d.tsæ–‡ä»¶ç”¨äºè¦†å†™windowçš„å±æ€§declare interface Window game?: anyåœ¨å…¨å±€æŒ‚è½½è„šæœ¬gameä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š@ccclassexport default class Game extends cc.Component physicDirector = null @property(cc.Node) enemy_01:cc.Node = null @property(cc.Node) hero:cc.Node = null onLoad() // æŒ‚è½½gameåˆ°windowä¸Š window.game = this this.physicDirector = cc.director.getPhysicsManager() this.physicDirector.enabled = true"},{"title":"ğŸ§©æ‹¼å›¾æ¸¸æˆ","path":"/wiki/Cocos/game_04_PuzzleGame.html","content":"èµ„æºåœ°å€ è§†é¢‘æ•™ç¨‹ï¼šé˜¿ä¿¡OLæ‹¼å›¾æ¸¸æˆDemogithubæºç  ğŸ“–å®ç°æ€è·¯å®ç°æ€è·¯ å°†ä¸€å¼ å®Œæ•´çš„çº¹ç†åˆ†å‰²æˆ4*4çš„æ–¹å—ç»™æ¯ä¸ªæ–¹å—éšæœºåˆ†é…ä½ç½®é’ˆå¯¹æ¯ä¸ªæ–¹å—çš„å¼€å§‹ç§»åŠ¨ã€ç§»åŠ¨ä¸­ã€ç§»åŠ¨ç»“æŸäº‹ä»¶æ‰§è¡ŒæŒ‡å®šæ“ä½œæ¯æ¬¡ç§»åŠ¨ä¹‹åï¼Œæ£€æµ‹æ‹¼å›¾æ˜¯å¦å®Œæˆ ğŸ’»ä»£ç å®ç°æ–¹å—é¢„åˆ¶ä½“ç»„ä»¶Block @ccclassexport default class Block extends cc.Component startPos:cc.Vec3 = null initialIndex:row:Number, col:Number = row:0, col:0 protected onLoad(): void this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart, this) this.node.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this) this.node.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this) protected onDestroy(): void this.node.off(cc.Node.EventType.TOUCH_START, this.touchStart, this) this.node.off(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this) this.node.off(cc.Node.EventType.TOUCH_END, this.touchEnd, this) // é€‰ä¸­ç¢ç‰‡å¼€å§‹ç§»åŠ¨ï¼Œç¢ç‰‡é€æ˜åº¦é™ä½ï¼Œå±‚çº§å‡é«˜ï¼Œè®°å½•ç¢ç‰‡åˆå§‹åæ ‡ touchStart(e:cc.Event.EventTouch) this.node.opacity = 128 this.node.zIndex = 1 this.startPos = this.node.position // ç¢ç‰‡ç§»åŠ¨ä¸­ï¼Œ= touchMove(e:cc.Event.EventTouch) this.node.x += e.getDeltaX() this.node.y += e.getDeltaY() // ç¢ç‰‡ç§»åŠ¨ç»“æŸï¼Œé€æ˜åº¦å’Œå±‚çº§æ¢å¤ touchEnd(e:cc.Event.EventTouch) this.node.opacity = 255 this.node.zIndex = 0 // è·å–ç¢ç‰‡å½“å‰åæ ‡çš„åºå·åæ ‡ let targetIndex = this.getIndex(this.node.position) let originIndex = this.getIndex(this.startPos) try // äº¤æ¢2ä¸ªç¢ç‰‡çš„åæ ‡å’Œåœ¨æ•°ç»„ä¸­çš„ä½ç½® let targetNode = window.blockArray[targetIndex.row][targetIndex.col] this.node.setPosition(targetNode.position) targetNode.setPosition(this.startPos) window.blockArray[targetIndex.row][targetIndex.col] = this.node window.blockArray[originIndex.row][originIndex.col] = targetNode window.checkOver() catch(error) this.node.setPosition(this.startPos) // åƒç´ åæ ‡è½¬åºå·åæ ‡ getIndex(position:cc.Vec3) return col:Math.floor(Math.abs(position.x / this.node.width + 0.5)), row:Math.floor(Math.abs(position.y / this.node.height - 0.5)) // åˆå§‹åŒ–é¢„åˆ¶ä½“ init(picTexture:cc.Texture2D, pos:x:number, y:number) let sprite = this.node.getComponent(cc.Sprite) let width = this.node.width let height = this.node.height // åˆ‡å‰²çº¹ç† let frame = new cc.SpriteFrame(picTexture, cc.rect(pos.x * width, pos.y * height, width, height)) sprite.spriteFrame = frame; æ¸¸æˆç»„ä»¶Game @ccclassexport default class Game extends cc.Component @property(cc.Prefab) // ç¢ç‰‡é¢„åˆ¶ä½“ blockPrefab:cc.Prefab = null blockArray:Arraycc.Node[] = [] // ç¢ç‰‡å°ºå¯¸ blockSize : number = 720 / 4 win:Boolean = false start () window.blockArray = this.blockArray window.checkOver = this.checkOver // åŠ¨æ€åŠ è½½æ‹¼å›¾å›¾ç‰‡ cc.resources.load(img/cats,cc.Texture2D,(error:Error,assets:cc.Texture2D)= if(error) console.log(error) return for(let row = 0; row 4; row++) this.blockArray[row] = [] for(let col = 0; col 4; col ++) let newBlock = cc.instantiate(this.blockPrefab) newBlock.getComponent(Block).initialIndex.row = row newBlock.getComponent(Block).initialIndex.col = col newBlock.getComponent(Block).init(assets,x:col, y:row) newBlock.setPosition(new cc.Vec2(this.blockSize * col, -this.blockSize * row)) this.node.addChild(newBlock) this.blockArray[row][col] = newBlock this.randomBlock() ) // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ checkOver() if(this.win) return try for(let row = 0; row4; row++) for(let col = 0; col4; col++) let node = this.blockArray[row][col] let block = node.getComponent(Block) let curPos = block.getIndex(node.position) if(curPos.row != block.initialIndex.row || curPos.col != block.initialIndex.col) return this.win = true setTimeout(()= alert(You Winï¼) ,300) catch(err) console.log(err) // æ‰“ä¹±ç¢ç‰‡é¡ºåº randomBlock() for(let row = 0; row4; row++) for(let col = 0; col4; col++) let exRow = Math.floor(Math.random() * 4) // 0-4 let exCol = Math.floor(Math.random() * 4) // 0-4 let exNode = this.blockArray[exRow][exCol] let curNode = this.blockArray[row][col] let tempPos = exNode.position exNode.setPosition(curNode.position) curNode.setPosition(tempPos) this.blockArray[exRow][exCol] = curNode this.blockArray[row][col] = exNode"},{"title":"Trae","path":"/wiki/AI/ai-03-Trae.html","content":"ç®€ä»‹å®˜ç½‘ï¼šhttps://docs.trae.ai/ide/what-is-trae?_lang=zh Trae: The Real AI Engineer å…³é”®åŠŸèƒ½ ä¾§è¾¹æ æ™ºèƒ½é—®ç­” ä»£ç è‡ªåŠ¨è¡¥å…¨ ä»£ç ç‰‡æ®µç”Ÿæˆ ä»0-1å¼€å‘é¡¹ç›® åŸºç¡€æ¡ˆä¾‹æ¡ˆä¾‹1ï¼šMCPç”¨ä¾‹ï¼šå°†Figmaè®¾è®¡ç¨¿è½¬åŒ–ä¸ºå‰ç«¯ä»£ç "},{"title":"Cursorå‚è€ƒæ–‡æ¡£","path":"/wiki/AI/cursor-01-doc.html","content":"æ ¸å¿ƒ Coreå¿«é€Ÿå¼€å§‹ Quickstartæ¦‚å¿µ ConceptsTabä»£ç è‡ªåŠ¨è¡¥å…¨ Autocomplete with Tabæ“ä½œå¿«æ·é”®æ¥å—å»ºè®®Tabæ‹’ç»Escé€è¯æ¥å—Ctrl+Arrow-RightğŸ”å·¥ä½œåŸç†ä¸Šä¸‹æ–‡çª—å£ä¸­çš„ä»£ç è¢«åŠ å¯†å‘é€åˆ°åç«¯åç«¯è§£å¯†åè¯»å–ä¸Šä¸‹æ–‡Cursor Tabæ¨¡å‹ é¢„æµ‹ä»£ç å»ºè®®ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºå†…è”ç¼–è¾‘é€‰ä¸­å†…å®¹ Inline Edit a selectionæ“ä½œå¿«æ·é”®æ‰“å¼€å†…è”æµ®çª—Ctrl+Kåˆ‡æ¢è¾“å…¥ç„¦ç‚¹Ctrl+Shift+Kæäº¤Enterå–æ¶ˆCtrl+Shift+BackSpaceå¿«é€Ÿæé—®Alt+Enterå‘é€åˆ°èŠå¤©Ctrl+Lå†…è”æ¨¡å¼æ¨¡å¼æè¿°Edit Selection é€‰åŒºç¼–è¾‘é’ˆå¯¹é€‰ä¸­ä»£ç ä¿®æ”¹Edit Full File å…¨æ–‡ä»¶ç¼–è¾‘æ•´ä¸ªæ–‡ä»¶èŒƒå›´çš„æ›´æ”¹Quick Question å¿«é€Ÿé—®ç­”é’ˆå¯¹é€‰ä¸­ä»£ç æé—®Send to Chat å‘é€åˆ°èŠå¤©å‘é€åˆ°èŠå¤©ï¼Œæ”¯æŒæ›´é«˜çº§çš„AgentåŠŸèƒ½é»˜è®¤ä¸Šä¸‹æ–‡å†…è”æ¨¡å¼ä¹Ÿæ”¯æŒä½¿ç”¨ @ç¬¦å· ï¼Œæ·»åŠ é»˜è®¤ä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡ç±»å‹å¯ä»¥æ˜¯ï¼šç›¸å…³æ–‡ä»¶ @Filesæœ€è¿‘æŸ¥çœ‹çš„ä»£ç  @Codeç›¸å…³ä¿¡æ¯ @DocsWebç›¸å…³ä»£ç å®šä¹‰ @Definitionsç»ˆç«¯å†…è”ç¼–è¾‘åœ¨ ç»ˆç«¯ ä¸­æŒ‰å¿«æ·é”® Ctrl+Kæè¿°å¸Œæœ›æ‰§è¡Œçš„æ“ä½œï¼Œå¯ä»¥ç”Ÿæˆç›¸åº”çš„å‘½ä»¤ä¸AgentèŠå¤© Chat with AgentCursorä¸Šé™å’Œä¸‹é™è·¨åº¦æœ€å¤§çš„åŠŸèƒ½ä¸Šåˆ°ä¸²é€šå·¥ä½œæµä¸‹åˆ°è”ç½‘æŸ¥é—®é¢˜é«˜åˆ°MCPä¸Šä¸‹æ–‡ä½åˆ°CMDæ§åˆ¶å°Agentåå°å¤„ç† Handoff word to Background Agentç”¨æˆ·å’ŒCursorå¼‚æ­¥å¹¶è¡Œå·¥ä½œå¯ä»¥é€šè¿‡ç¼–è¾‘å™¨æˆ–å¤–éƒ¨é›†æˆï¼ˆå¦‚Slackï¼‰è®¿é—®ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œæœ‰éœ€è¦å‚è€ƒæ–‡æ¡£ç¼–å†™è§„åˆ™ Write a ruleåˆ›å»º mdcæ–‡ä»¶ å®šä¹‰ä¸€äº›è§„åˆ™ï¼Œç›¸å½“äºé€šç”¨æŒä¹…è®°å¿†MCPæœåŠ¡å™¨ Set up an MCP serveré›†æˆå¤–éƒ¨å·¥å…·çš„æ¨¡å‹ä¸Šä¸‹æ–‡åè®®è¿æ¥æ•°æ®åº“ã€APIå’Œæ–‡æ¡£æºTabè‡ªåŠ¨è¡¥å…¨å¤šè¡Œå’Œä»£ç å—åœ¨æ–‡ä»¶å†…å’Œè·¨æ–‡ä»¶è·³è½¬åˆ°ä¸‹ä¸€ä¸ªè‡ªåŠ¨è¡¥å…¨å»ºè®®AgentAgentç›¸å½“äºä¸€ä¸ªè™šæ‹ŸåŠ©ç†ï¼Œèƒ½å¤Ÿæ ¹æ®ç›®æ ‡ã€è§„åˆ™å’Œç¯å¢ƒåšå‡ºå†³ç­–å’Œè¡ŒåŠ¨å¯¹äºCursor Agentï¼Œç¯å¢ƒå°±æ˜¯èƒ½å¤Ÿè¯»å–åˆ°çš„ä»£ç å’Œæ–‡ä»¶å†…å®¹Background Agentä¸€è¾¹å·¥ä½œä¸€è¾¹å¼‚æ­¥è¿è¡Œä»»åŠ¡å¯ä»¥é€šè¿‡ç¼–è¾‘å™¨æˆ–å¤–éƒ¨é›†æˆï¼ˆå¦‚Slackï¼‰è®¿é—®Inline Editç²¾ç®€ç‰ˆAgenté’ˆå¯¹é€‰ä¸­ä»£ç å—è¿›è¡Œç¼–è¾‘Chatä¼ ç»Ÿå¯¹è¯å¼æ™ºèƒ½ä½“Ruleså®šä¹‰AIè¡Œä¸ºçš„è‡ªå®šä¹‰æŒ‡ä»¤ã€‚è®¾ç½®ç¼–ç æ ‡å‡†ã€æ¡†æ¶åå¥½Memoryéœ€è¦æŒä¹…å­˜å‚¨çš„ä¸Šä¸‹æ–‡å’Œå¯¹è¯æ˜¯å¦ä¸€ç§å½¢å¼çš„rulesè®°å¿†å¦‚ä½•åˆ›å»º Sidecarè§‚å¯Ÿæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å‹ï¼Œè§‚å¯Ÿå¯¹è¯å¹¶è‡ªåŠ¨æå–è®°å¿†åœ¨åå°è¢«åŠ¨è¿›è¡Œåå°ç”Ÿæˆçš„è®°å¿†éœ€è¦ç”¨æˆ·æ‰¹å‡†æ‰èƒ½ä¿å­˜ï¼Œç¡®ä¿å¯¹å†…å®¹çš„ä¿¡ä»»å’Œæ§åˆ¶ å·¥å…·è°ƒç”¨å½“ç”¨æˆ·æ˜ç¡®è¦æ±‚Agentè®°ä½æŸäº›å†…å®¹æˆ–å½“å®ƒæ³¨æ„åˆ°åº”è¯¥ä¸ºæœªæ¥çš„ä¼šè¯ä¿ç•™é‡è¦ä¿¡æ¯æ—¶Agentå¯ä»¥ç›´æ¥ä½¿ç”¨å·¥å…·è°ƒç”¨åˆ›å»ºè®°å¿† ç®¡ç†è®°å¿†Cursor Setting Rules ä¸­ç®¡ç†è®°å¿†Indexingå½“æ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ—¶ï¼ŒCursorå¼€å§‹å­¦ä¹ è¯¥é¡¹ç›®çš„ä»£ç ï¼Œå³â€œç´¢å¼•â€æ‰“å¼€é¡¹ç›®æ—¶ï¼Œç´¢å¼•è‡ªåŠ¨å¼€å§‹å¯¹ä»£ç åº“è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œæ”¯æŒä»£ç æœç´¢ã€å¼•ç”¨æŸ¥æ‰¾å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥å»ºè®®MCPé›†æˆå¤–éƒ¨å·¥å…·çš„æ¨¡å‹ä¸Šä¸‹æ–‡åè®®è¿æ¥æ•°æ®åº“ã€APIå’Œæ–‡æ¡£æºæ¨¡å‹ç”¨äºä»£ç ç”Ÿæˆä¸åŒçš„AIæ¨¡å‹æ¯ä¸ªæ¨¡å‹å…·æœ‰ä¸åŒçš„é€Ÿåº¦å’Œèƒ½åŠ›ç‰¹æ€§ æ ¸å¿ƒï¼šğŸ¤–æ™ºèƒ½ä½“æ¨¡å¼ Modes Agentè‡ªä¸»æ¢ç´¢ã€å¤šæ–‡ä»¶ç¼–è¾‘æƒé™ï¼šæ‰€æœ‰å·¥å…· Askåªè¯»æ¢ç´¢ã€æ— è‡ªåŠ¨æ›´æ”¹æƒé™ï¼šæœç´¢å·¥å…· Manualç›´æ¥æ–‡ä»¶ç¼–è¾‘ã€å…·æœ‰æ˜ç¡®æ§åˆ¶æƒé™ï¼šç¼–è¾‘å·¥å…·åªç¼–è¾‘æ˜ç¡®é€‰æ‹©çš„æ–‡ä»¶åœ¨ç¡®åˆ‡çŸ¥é“è¦ç¼–è¾‘ä»€ä¹ˆæ—¶æ•ˆæœæœ€ä½³ï¼Œé€‰æ‹©æ­£ç¡®çš„æ–‡ä»¶å¹¶ç»™å‡ºæ¸…æ™°çš„æŒ‡ä»¤ Customç”¨æˆ·å®šä¹‰çš„åŠŸèƒ½å¯¹ç‰¹å®šçš„å·¥å…·ç»„åˆå’ŒæŒ‡ä»¤åˆ›å»ºè‡ªå®šä¹‰æ¨¡å¼ å·¥å…· Toolsåœ¨Customæ¨¡å¼ä¸‹ï¼Œæ™ºèƒ½ä½“çš„è¿™äº›å·¥å…·å¯ä»¥è¢«è‡ªç”±çš„å¯ç”¨ç¦ç”¨åº”ç”¨æ›´æ”¹ Apply Changesåº”ç”¨ã€æ¥å—æˆ–æ‹’ç»èŠå¤©ä¸­çš„ä»£ç å»ºè®®åŸç†ç®€è¿°Applyæ˜¯ä¸€ä¸ªä¸“é—¨çš„Cursoræ¨¡å‹ä¸“é—¨æ¥æ”¶Agentç”Ÿæˆçš„ä»£ç ï¼Œå¹¶é›†æˆåˆ°æ–‡ä»¶ä¸­Applyä¸ç”Ÿæˆä»£ç ï¼Œåªè´Ÿè´£é›†æˆå¯ä»¥å¤„ç†å¤šä¸ªæ–‡ä»¶å’Œå¤§å‹ä»£ç åº“çš„æ›´æ”¹å®¡æŸ¥å·®å¼‚ Review Diffså®¡æŸ¥å’Œç®¡ç†ç”±AIä»£ç†ç”Ÿæˆçš„ä»£ç æ›´æ”¹é€æ–‡ä»¶å®¡æŸ¥é€‰æ‹©æ€§æ¥å—å®¡æŸ¥æ›´æ”¹ï¼ˆreview changesï¼‰æŸ¥çœ‹æ›´æ”¹çš„å®Œæ•´å·®å¼‚èŠå¤©æ ‡ç­¾é¡µ Chat Tabså¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå¯¹è¯æ¯ä¸ªæ ‡ç­¾é¡µéƒ½ç»´æŠ¤è‡ªå·±çš„ä¸Šä¸‹æ–‡ã€å†å²è®°å½•å’Œæ¨¡å‹é€‰æ‹©æ£€æŸ¥ç‚¹ Checkpointsè‡ªåŠ¨å¿«ç…§è·Ÿè¸ªAgentæ›´æ”¹ï¼Œå¯ä»¥è¿›è¡Œrestoreæ¢å¤ç»ˆç«¯é›†æˆ Terminal Integrationå¯ä»¥ä½¿ç”¨Agentæ‰§è¡Œç»ˆç«¯å‘½ä»¤ã€ç›‘æ§è¾“å‡ºå¹¶å¤„ç†å¤šæ­¥éª¤æµç¨‹ä¸ºå¯ä¿¡å·¥ä½œæµé…ç½®è‡ªåŠ¨è¿è¡ŒèŠå¤©å†å² Chat Historyå›é¡¾ä¹‹å‰è®¨è®ºã€è·Ÿè¸ªç¼–ç ä¼šè¯ã€å‚è€ƒæ—©æœŸèŠå¤©ä¸Šä¸‹æ–‡å¯¼å‡ºèŠå¤© Export Chatså¯¼å‡ºä¸º markdownæ ¼å¼ ä¸å›¢é˜Ÿæˆå‘˜åˆ†äº«è§£å†³æ–¹æ¡ˆã€æˆ–ä»ç¼–ç ä¼šè¯ä¸­åˆ›å»ºçŸ¥è¯†åº“è§„åˆ™ Ruleså¯ä»¥ä½¿ç”¨rulesï¼Œä¸ºAgentçš„è¡Œä¸ºå®šä¹‰è‡ªå®šä¹‰æŒ‡ä»¤æœ‰åŠ©äºç»´æŠ¤ç¼–ç æ ‡å‡†ã€å¼ºåˆ¶æ‰§è¡Œæ¨¡å¼ã€ä¸ªæ€§åŒ–Agent æ™ºèƒ½ä½“ï¼šğŸ’¬èŠå¤© æ ‡ç­¾é¡µ Tabs æ²™ç›’éš”ç¦»ï¼š æ¯ä¸ªæ ‡ç­¾é¡µçš„å¯¹è¯å†å²ã€ä¸Šä¸‹æ–‡ã€æ¨¡å‹é€‰æ‹©ç‹¬ç«‹å†²çªï¼š å¤šä¸ªæ ‡ç­¾é¡µç¼–è¾‘ç›¸åŒçš„æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºè§£å†³å†²çªï¼ˆå’Œgit mergeç›¸ä¼¼ï¼‰å¼•ç”¨å…¶ä»–èŠå¤©è®°å½•ï¼š ä½¿ç”¨ Past Chats æ¥åŒ…å«å…¶ä»–æ ‡ç­¾é¡µæˆ–è€…ä¹‹å‰ç»˜ç”»çš„ä¸Šä¸‹æ–‡ğŸ’¡å»ºè®®æ¯ä¸ªæ ‡ç­¾é¡µä½¿ç”¨ä¸€ä¸ªä»»åŠ¡ï¼Œæä¾›æ¸…æ™°çš„åˆå§‹æè¿°å…³é—­å·²å®Œæˆçš„æ ‡ç­¾é¡µä»¥ä¿æŒå·¥ä½œåŒºæ•´æ´æ£€æŸ¥ç‚¹ Checkpoints ç”¨é€”ï¼š åœ¨Agentæ›´æ”¹åä¿å­˜å’Œæ¢å¤ä¹‹å‰çš„çŠ¶æ€æç¤ºï¼š æ£€æŸ¥ç‚¹ä¸æ˜¯ç‰ˆæœ¬æ§åˆ¶ï¼Œè¿˜æ˜¯éœ€è¦ä½¿ç”¨gitæ¥ä¿å­˜æ°¸ä¹…å†å²è®°å½•ğŸ”å·¥ä½œåŸç†æœ¬åœ°å­˜å‚¨ä»…è·Ÿè¸ªAgentæ›´æ”¹è‡ªåŠ¨æ¸…ç†ï¼ˆåœ¨å½“å‰ä¼šè¯å’Œæœ€è¿‘çš„å†å²è®°å½•ä¸­ä¿å­˜ï¼‰å¯¼å‡º Export å¯¼å‡ºå†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼‰æ‰€æœ‰æ¶ˆæ¯å’Œå“åº”è¯­æ³•é«˜äº®ä»£ç å—æ–‡ä»¶å¼•ç”¨å’Œä¸Šä¸‹æ–‡æŒ‰æ—¶é—´é¡ºåºçš„å¯¹è¯æµç¨‹ğŸ’¡æ³¨æ„å¯¼å‡ºæ—¶è¯·æ£€æŸ¥æ•æ„Ÿæ•°æ®ï¼šAPIå¯†é’¥ã€å†…éƒ¨URLã€ä¸“æœ‰ä»£ç ã€ä¸ªäººä¿¡æ¯ç­‰å¤åˆ¶ Duplicate ä»å¯¹è¯ä¸­çš„ä»»æ„ç‚¹åˆ›å»ºåˆ†æ”¯ï¼Œé€‰æ‹© Duplicate Chat åˆ°è¯¥æ—¶é—´ç‚¹çš„ä¸Šä¸‹æ–‡ä¼šè¢«ä¿ç•™ï¼ŒåŸå§‹å¯¹è¯ä¿æŒä¸å˜ä¸¤ä¸ªèŠå¤©éƒ½ç»´æŠ¤å„è‡ªç‹¬ç«‹çš„å†å²è®°å½•å†å²è®°å½• History å†å²èŠå¤©è®°å½•å¯ä»¥æ‰“å¼€ã€åˆ é™¤ã€é‡å‘½åè®°å½•ä¼šå­˜å‚¨åœ¨æœ¬æœºå™¨ SQLiteæ•°æ®åº“ ä¸­åå°ä»£ç†ï¼š ä¸åœ¨å¸¸è§„çš„å†å²è®°å½•ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨è¿œç¨‹æ•°æ®åº“ä¸­å¼•ç”¨è¿‡å¾€èŠå¤©è®°å½•ï¼š @Past Chatsæ‘˜è¦åŠŸèƒ½ Summarization èŠå¤©ä¸­é•¿å¯¹è¯çš„ä¸Šä¸‹æ–‡ç®¡ç†Cursorä¼šè‡ªåŠ¨æ‘˜è¦å’Œç®¡ç†ä¸Šä¸‹æ–‡ï¼Œä¿æŒèŠå¤©çš„é«˜æ•ˆğŸ”å·¥ä½œåŸç†å½“å¯¹è¯å˜å¾—è¶Šæ¥è¶Šé•¿æ—¶ï¼ŒCursorä¼šå¯¹æ¯”è¾ƒæ—§çš„æ¶ˆæ¯è¿›è¡Œæ‘˜è¦ï¼ˆå‹ç¼©ï¼‰å¯¹æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼ŒCursorä½¿ç”¨å¦ä¸€ç§å¤„ç†æ–¹å¼ï¼šæ™ºèƒ½å‹ç¼©Cursorä¼šæ ¹æ®æ–‡ä»¶å¤§å°å’Œå¯ç”¨ä¸Šä¸‹æ–‡ç©ºé—´ç¡®å®šå‘ˆç°å®ƒä»¬çš„æœ€ä½³æ–¹å¼æ–‡ä»¶å‹ç¼©çš„å‡ ç§æƒ…å†µï¼šå·²å‹ç¼©æ˜¾è‘—å‹ç¼©æœªåŒ…å«ï¼ˆè­¦å‘Šï¼‰å‹ç¼©ä¼šå‘æ¨¡å‹æ˜¾ç¤ºå…³é”®çš„ç»“æ„å…ƒç´ ï¼Œå¦‚å‡½æ•°ç­¾åã€ç±»ã€æ–¹æ³•ã€‚æ¨¡å‹æœ‰éœ€è¦æ—¶å±•å¼€ç‰¹å®šæ–‡ä»¶æœ€å¤§åŒ–äº†å¯¹å¯ç”¨ä¸Šä¸‹æ–‡çª—å£çš„æœ‰æ•ˆåˆ©ç”¨æ–‡ä»¶å¤ªå¤§è€Œæ— æ³•å®Œæ•´åŒ…å«ï¼Œå‹ç¼©ä¹Ÿä¸è¡Œï¼Œæ¨¡å‹åªèƒ½è·å–åˆ°æ–‡ä»¶åé¡¹ç›®å¤ªå¤§æ— æ³•åŒ…å«åœ¨ä¸Šä¸‹æ–‡çª—å£ æ™ºèƒ½ä½“ï¼šğŸ§¾è§„åˆ’ Agentå¦‚ä½•é€šè¿‡è§„åˆ’å’Œç®¡ç†å¤æ‚ä»»åŠ¡æå‰è§„åˆ’ç»“æ„åŒ–çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ã€æ¶ˆæ¯é˜Ÿåˆ— ğŸ—’ï¸Agentå¾…åŠäº‹é¡¹å°†è¾ƒé•¿çš„ä»»åŠ¡åˆ†è§£ä¸ºå¯ç®¡ç†çš„æ­¥éª¤å»ºç«‹ä¾èµ–å…³ç³»ï¼Ÿç»“æ„åŒ–è®¡åˆ’ä¼šéšå·¥ä½œè¿›å±•è€Œæ›´æ–° ğŸ”å·¥ä½œåŸç† è‡ªåŠ¨ä¸ºå¤æ‚ä»»åŠ¡åˆ›å»ºå¾…åŠäº‹é¡¹åˆ—è¡¨æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥ä¾èµ–äºå…¶ä»–ä»»åŠ¡åˆ—è¡¨éšå·¥ä½œè¿›å±•å®æ—¶æ›´æ–°å·²å®Œæˆçš„ä»»åŠ¡ä¼šè‡ªåŠ¨æ ‡è®°ä¸ºå®Œæˆ å¯è§æ€§ æ–¹å¼1ï¼šæ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ä¸­æ–¹å¼2ï¼šSlacké›†æˆæ˜¾ç¤ºï¼Ÿ ğŸ’¡æ³¨æ„æœ€å¥½æ¸…æ¥šåœ°æè¿°æœ€ç»ˆç›®æ ‡ï¼Œè®©Agentäº†è§£å®Œæ•´èŒƒå›´ï¼Œæ‰èƒ½åˆ›å»ºæ›´å‡†ç¡®çš„ä»»åŠ¡åˆ†è§£ ä½¿ç”¨é˜Ÿåˆ— å½“Agentæ­£åœ¨å·¥ä½œæ—¶ï¼Œè¾“å…¥ä¸‹ä¸€ä¸ªæŒ‡ä»¤ Enterå°†å…¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ æ¶ˆæ¯æŒ‰é¡ºåºæ˜¾ç¤ºåœ¨æ´»åŠ¨ä»»åŠ¡ä¸‹æ–¹ ç‚¹å‡»ç®­å¤´å¯ä»¥é‡æ–°æ’åˆ—é˜Ÿåˆ—æ¶ˆæ¯ Agentä¼šåœ¨å®ŒæˆåæŒ‰é¡ºåºå¤„ç†å®ƒä»¬ è¦†ç›–é˜Ÿåˆ—ï¼šå¼ºåˆ¶æ¨é€æ¶ˆæ¯ï¼Œä¼šç»•è¿‡é˜Ÿåˆ—ç«‹å³æ‰§è¡Œ æ™ºèƒ½ä½“ï¼šğŸ”§å·¥å…· æœç´¢ Search ï¼ˆæœç´¢ä»£ç åº“ç½‘ç»œä»¥æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯ ï¼‰ å·¥å…·åæè¿°è¯»å–æ–‡ä»¶Read filesæœ€å¤š250è¡Œï¼Œæœ€å¤§æ¨¡å¼ä¸‹ä¸º750è¡Œåˆ—å‡ºç›®å½•List directoryåªè¯»å–ç›®å½•ç»“æ„ï¼Œä¸è¯»å–æ–‡ä»¶å†…å®¹ä»£ç åº“Codebaseåœ¨å·²ç´¢å¼•ä»£ç åº“ä¸­æ‰§è¡Œè¯­ä¹‰æœç´¢Grepåœ¨æ–‡ä»¶ä¸­æœç´¢ç¡®åˆ‡çš„å…³é”®è¯æˆ–æ¨¡å¼æœç´¢æ–‡ä»¶Search filesä½¿ç”¨æ¨¡ç³ŠåŒ¹é…æŒ‰åç§°æŸ¥æ‰¾æ–‡ä»¶ç½‘ç»œWebç”Ÿæˆæœç´¢æŸ¥è¯¢å¹¶æ‰§è¡Œç½‘ç»œæœç´¢è·å–è§„åˆ™Fetch rulesæ ¹æ®ç±»å‹å’Œæè¿°æ£€ç´¢ç‰¹å®šçš„è§„åˆ™ç¼–è¾‘ Editï¼ˆå¯¹æ–‡ä»¶å’Œä»£ç åº“è¿›è¡Œç‰¹å®šç¼–è¾‘ï¼‰ å·¥å…·åæè¿°ç¼–è¾‘å’Œé‡æ–°åº”ç”¨Edit Reapplyæ–‡ä»¶ç¼–è¾‘å¹¶è‡ªåŠ¨åº”ç”¨åˆ é™¤æ–‡ä»¶Delete fileåˆ é™¤æ–‡ä»¶è¿è¡Œ Runï¼ˆä¸ç»ˆç«¯è¿›è¡Œäº¤äº’ï¼‰ Cursorå¯ä»¥è¿è¡Œç»ˆç«¯å‘½ä»¤å¹¶ç›‘æ§è¾“å‡ºCursorä½¿ç”¨é»˜è®¤çš„ç»ˆç«¯é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸­ç«¯é…ç½®æ–‡ä»¶ï¼šTerminal:Select Default ProfileMCP å¯ä»¥ä½¿ç”¨é…ç½®çš„MCPæœåŠ¡å™¨ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹APIé«˜çº§é€‰é¡¹ å·¥å…·åæè¿°è‡ªåŠ¨åº”ç”¨ç¼–è¾‘Auto-apply Editsè‡ªåŠ¨åº”ç”¨ç¼–è¾‘æ— éœ€æ‰‹åŠ¨ç¡®è®¤è‡ªåŠ¨è¿è¡ŒAuto-runè‡ªåŠ¨æ‰§è¡Œç»ˆç«¯å‘½ä»¤å¹¶æ¥å—ç¼–è¾‘,é€‚ç”¨äºè¿è¡Œæµ‹è¯•å¥—ä»¶å’ŒéªŒè¯æ›´æ”¹å®‰å…¨é˜²æŠ¤Guardrailsä¸€å¤§å †å…è®¸é…ç½®ï¼Œæ¥ç¡®ä¿å“ªäº›å·¥å…·å¯ä»¥è‡ªåŠ¨æ‰§è¡Œè‡ªåŠ¨ä¿®å¤é”™è¯¯Auto-fix Errorså½“Agenté‡åˆ°ä»£ç æ£€æŸ¥é”™è¯¯å’Œè­¦å‘Šæ—¶è‡ªåŠ¨è§£å†³ æ ¸å¿ƒï¼šğŸš©è§„åˆ™è§„åˆ™ä»‹ç» é€šè¿‡å¯é‡ç”¨çš„ä½œç”¨åŸŸæŒ‡ä»¤æ§åˆ¶Agentæ¨¡å‹çš„è¡Œä¸ºå¯ä»¥è§†ä¸ºé¡¹ç›®çš„æŒä¹…ä¸Šä¸‹æ–‡ã€åå¥½è®¾ç½®æˆ–å·¥ä½œæµç¨‹**è§„åˆ™é€‚ç”¨èŒƒå›´ï¼š**ä¸ºAgentå’Œå†…è”ç¼–è¾‘æä¾›ç³»ç»Ÿçº§æŒ‡ä»¤ï¼ˆtabä¸é€‚ç”¨ï¼‰ è§„åˆ™ç±»å‹ é¡¹ç›®è§„åˆ™ç”¨æˆ·è§„åˆ™å­˜å‚¨åœ¨ .cursorrules ä¸­å—ç‰ˆæœ¬æ§åˆ¶ä½œç”¨äºä»£ç åº“å¯ä»¥ä½¿ç”¨è·¯å¾„æ¨¡å¼è¿›è¡Œè§„åˆ™é™å®šæ‰‹åŠ¨è°ƒç”¨åŸºäºç›¸å…³æ€§åŒ…å«åµŒå¥—è§„åˆ™ï¼šå­ç›®å½•å¯ä»¥åŒ…å«è‡ªå·±çš„ .cursorrules ç›®å½•ï¼ŒèŒƒå›´é™å®šåœ¨è¯¥æ–‡ä»¶å¤¹å†…åµŒå¥—è§„åˆ™ä¼šæ ¹æ®é¡¹ç›®å±‚çº§è‡ªåŠ¨é™„åŠ ğŸ’¡å¯ä»¥ä½¿ç”¨Ruleså¤„ç†çš„åœºæ™¯ ç¼–ç å…³äºä»£ç åº“çš„é¢†åŸŸç‰¹å®šçŸ¥è¯† è‡ªåŠ¨åŒ–é¡¹ç›®ç‰¹å®šçš„å·¥ä½œæµç¨‹æˆ–æ¨¡ç‰ˆ æ ‡å‡†åŒ–æ ·å¼æˆ–æ¶æ„å†³ç­– å…¨å±€åº”ç”¨äºCursorç¯å¢ƒè®¾ç½®ä¸­å®šä¹‰å¹¶å§‹ç»ˆç”Ÿæ•ˆæ¯”è¾ƒé€‚åˆè®¾ç½®é¦–é€‰çš„æ²Ÿé€šé£æ ¼æˆ–ç¼–ç çº¦å®š ğŸ”ä½œç”¨åŸç† æä¾›æŒä¹…çš„ã€å¯é‡ç”¨çš„ä¸Šä¸‹æ–‡åº”ç”¨æ—¶ï¼Œè§„åˆ™å†…å®¹ä¼šåŒ…å«åœ¨æ¨¡å‹ä¸Šä¸‹æ–‡çš„å¼€å§‹éƒ¨åˆ† åˆ›å»ºè§„åˆ™ è§„åˆ™ç»“æ„ MDC ç¼–å†™ï¼Œæ”¯æŒå…ƒæ•°æ®å’Œå†…å®¹æ ¼å¼å±æ€§ Property å±æ€§ æè¿° description è§„åˆ™æè¿° globs ä½œç”¨åŸŸ alwaysApply åº”ç”¨èŒƒå›´ è§„åˆ™ä½œç”¨ç±»å‹ Rule Type å±æ€§ æè¿° Always å§‹ç»ˆåŒ…å«åœ¨æ¨¡å‹ä¸Šä¸‹æ–‡ä¸­ Auto Attached å¼•ç”¨åŒ¹é…globæ¨¡å¼çš„æ–‡ä»¶æ—¶åŒ…å« Agent Requested ç”±AIå†³å®šæ˜¯å¦åŒ…å«ï¼Œå› æ­¤å¿…é¡»æä¾›æè¿° Manual ä»…åœ¨ä½¿ç”¨@ruleNameæ˜¾å¼æåŠæ—¶åŒ…å« åˆ›å»ºè§„åˆ™ åˆ›å»ºæ–¹å¼1Cursor Settings Rules å¯ä»¥çœ‹åˆ°å¹¶ç®¡ç†æ‰€æœ‰è§„åˆ™åˆ›å»ºæ–¹å¼2New Cursor Rule å‘½ä»¤åˆ›å»ºæ–¹å¼3Generate Cursor Rules å‘½ä»¤ï¼Œæ ¹æ®å½“å‰å’Œæ™ºèƒ½ä½“çš„å¯¹è¯ï¼Œç”Ÿæˆè§„åˆ™ æ¡ˆä¾‹ è¿™é‡ŒCursoræ–‡æ¡£é‡Œæä¾›äº†å‡ ä¸ªè§„åˆ™æ ‡å‡†ï¼Œè¿˜æŒºæœ‰æ„æ€çš„ã€‚è¿˜æœ‰æ›´å¤šç¤ºä¾‹å¯ä»¥ä»æä¾›å•†ã€æ¡†æ¶ã€ç¤¾åŒºè´¡çŒ®çš„åœ¨çº¿ä¼—åŒ…é›†åˆå’Œå‚¨å­˜åº“ä¸­æ‰¾åˆ°ã€‚ ---alwaysApply: trueglobs:description: è‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµç¨‹å’Œæ–‡æ¡£ç”Ÿæˆ---æ­¤è§„åˆ™è‡ªåŠ¨åŒ–åº”ç”¨åˆ†æï¼šå½“è¢«è¦æ±‚åˆ†æåº”ç”¨æ—¶ï¼š1. ä½¿ç”¨ npm run dev è¿è¡Œå¼€å‘æœåŠ¡å™¨2. ä»æ§åˆ¶å°è·å–æ—¥å¿—3. å»ºè®®æ€§èƒ½æ”¹è¿›æ­¤è§„åˆ™å¸®åŠ©ç”Ÿæˆæ–‡æ¡£ï¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼å¸®åŠ©èµ·è‰æ–‡æ¡£ï¼š- æå–ä»£ç æ³¨é‡Š- åˆ†æREADME.md- ç”Ÿæˆmarkdownæ–‡æ¡£ ğŸ’¡å»ºè®® è§„åˆ™åº”è¯¥æ˜¯ä¸“æ³¨çš„ã€å¯æ“ä½œçš„ã€æœ‰æ˜ç¡®èŒƒå›´çš„ ä¿æŒè§„åˆ™åœ¨500è¡Œä»¥å†… å°†å¤§å‹è§„åˆ™æ‹†åˆ†ä¸ºå¤šä¸ªå¯ç»„åˆçš„è§„åˆ™ æä¾›å…·ä½“çš„å®ä¾‹æˆ–å¼•ç”¨æ–‡ä»¶ é¿å…æ¨¡ç³ŠæŒ‡å¯¼ï¼Œç¼–å†™è§„åˆ™æ—¶è¦åƒæ¸…æ™°çš„å†…éƒ¨æ–‡æ¡£ä¸€æ · åœ¨èŠå¤©ä¸­é‡å¤æç¤ºæ—¶é‡ç”¨è§„åˆ™ ä¸Šä¸‹æ–‡ Contextä¸Šä¸‹æ–‡ä¸è¶³ä¼šå¯¼è‡´å¹»è§‰æˆ–æ•ˆç‡ä½ä¸‹ï¼Œè€Œè¿‡å¤šçš„ä¸Šä¸‹æ–‡ä¼šç¨€é‡Šä¿¡å·ã€‚æ‰¾åˆ°åˆé€‚çš„å¹³è¡¡ç‚¹ä»¥è·å¾—æœ€ä½³æ•ˆæœ â”ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ ç­”ï¼šä¸Šä¸‹æ–‡æ˜¯æŒ‡æä¾›ç»™æ¨¡å‹çš„ä¿¡æ¯ æ¨¡å‹éšåä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥é¢„æµ‹åç»­ä¿¡æ¯ æœ‰ä¸¤ç§ç±»å‹çš„ä¸Šä¸‹æ–‡ï¼š çŠ¶æ€ä¸Šä¸‹æ–‡ State Contextå¯¹å½“ä¸‹çŠ¶æ€çš„æè¿°æè¿°æ€§â€œè¿™æ˜¯ä¸€å¼ æ–°çš„è®¾è®¡å›¾çº¸ï¼Œå¯¹ç°æœ‰çš„é¢œè‰²ä¸»é¢˜åšäº†ä¸€äº›è°ƒæ•´â€ æ„å›¾ä¸Šä¸‹æ–‡ Intent Contextç”¨æˆ·å¸Œæœ›è¾¾åˆ°çš„ç›®æ ‡è§„å®šæ€§â€œæˆ‘éœ€è¦ä½ æŒ‰ç…§è¿™å¼ å›¾çº¸ï¼Œä¿®æ”¹ç•Œé¢çš„é¢œè‰²æ ·å¼â€ ç¼ºå°‘ä¸Šä¸‹æ–‡æ—¶ï¼ŒAgentå¯èƒ½åšå‡ºçš„åæ˜ ï¼š åå‘å¯¹åº”ï¼šå¹»è§‰ Hallucination æ¨¡å‹åœ¨ç¼ºä¹è¶³å¤Ÿä¸Šä¸‹æ–‡æƒ…å†µä¸‹ï¼Œç”Ÿæˆçœ‹ä¼¼åˆç†ä½†äº‹å®ä¸Šè™šæ„çš„å†…å®¹Userï¼šç§¦å§‹çš‡æœ€è¿‘ç¼ºé’±å—ï¼ŸAIï¼šæ˜¯çš„ï¼Œä»–ç›®å‰æ­£åœ¨ç­¹å¤‡ä¿®å»ºæ–°çš„é•¿åŸé¡¹ç›®ï¼Œé‡åˆ°èµ„é‡‘çŸ­ç¼ºçš„æƒ…å†µéå¸¸æ­£å¸¸â€¦ æ­£å‘å¯¹åº”ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥ Agentå°è¯•é€šè¿‡æœç´¢ä»£ç åº“ã€è¯»å–æ–‡ä»¶å’Œè°ƒç”¨å·¥å…·è‡ªè¡Œæ”¶é›†ä¸Šä¸‹æ–‡ã€‚Cursorçš„æ ¸å¿ƒæ„å»ºç†å¿µå³ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼Œæ—¨åœ¨æœ€å¤§ç¨‹åº¦å‡å°‘ç”¨æˆ·çš„å¹²é¢„ ğŸ•Šï¸ä¸Šä¸‹æ–‡ä½¿ç”¨å»ºè®® æ¸…æ™°è¡¨è¾¾æ¸…æ™°è¡¨è¾¾çŠ¶æ€ ï¼ˆå½“ä¸‹æƒ…å†µï¼‰ å’Œ æ„å›¾ ï¼ˆå¸Œæœ›è¾¾æˆï¼‰ç²¾ç¡®å®šä½ä½¿ç”¨ @ç¬¦å· è¿›è¡Œç²¾å‡†ä¸Šä¸‹æ–‡å®šä½æ€»ç»“ç»éªŒé‡å¤ä½¿ç”¨çš„çŸ¥è¯†å¯ä»¥æ€»ç»“ä¸ºè§„åˆ™ï¼Œæˆä¸ºé•¿æœŸè®°å¿†å¯¹å¤–äº¤æµé€šè¿‡ MCP æ¥è¿æ¥å¤–éƒ¨ç³»ç»Ÿ ä¸Šä¸‹æ–‡ï¼šä»£ç åº“ç´¢å¼•é€šè¿‡ä¸ºæ¯ä¸ªæ–‡ä»¶è®¡ç®—åµŒå…¥å‘é‡æ¥ç´¢å¼•ä»£ç åº“å¦‚æœå·²ç´¢å¼•ä»£ç åº“ 6å‘¨ ä¸æ´»è·ƒåä¼šè¢«åˆ é™¤æ£€æŸ¥ç´¢å¼•çŠ¶æ€ï¼š Cursor Setting Indexing Docs é…ç½®é¡¹ å¿½ç•¥æ–‡ä»¶ï¼ˆ .gitignore ã€ .cursorignore ï¼‰ æç¤ºï¼š å¿½ç•¥å¤§å‹å†…å®¹æ–‡ä»¶å¯ä»¥æé«˜ç­”æ¡ˆå‡†ç¡®æ€§ æŸ¥çœ‹å·²ç´¢å¼•æ–‡ä»¶ï¼š View included files å¤šæ ¹å·¥ä½œåŒº æ‰€æœ‰ä»£ç åº“éƒ½ä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼• AIå¯ç”¨æ¯ä¸ªä»£ç åº“çš„ä¸Šä¸‹æ–‡ .cursorrules åœ¨æ‰€æœ‰æ–‡ä»¶å¤¹ä¸­éƒ½æœ‰æ•ˆ PRæœç´¢ é€šè¿‡è®©å†å²å˜æ›´å¯æœç´¢å’Œé€šè¿‡AIè®¿é—®ï¼Œå¸®åŠ©ç«‹å³ä»£ç åº“çš„æ¼”è¿›è¿‡ç¨‹ ğŸ”å·¥ä½œåŸç† è‡ªåŠ¨ç´¢å¼•æ‰€æœ‰å·²åˆå¹¶çš„PRï¼Œæ¥è‡ªä»“åº“è®°å½•æ‘˜è¦ä¼šå‡ºç°åœ¨è¯­ä¹‰æœç´¢ç»“æœä¸­é€šè¿‡æ™ºèƒ½è¿‡æ»¤æ¥ä¼˜å…ˆæ˜¾ç¤ºæœ€è¿‘çš„å˜æ›´Agentå¯ä»¥ä½¿ç”¨@è·å–PRã€æäº¤ã€é—®é¢˜æˆ–åˆ†æ”¯åˆ°ä¸Šä¸‹æ–‡ä¸­@[PR ç¼–å·]@[commit hash]@[branch name]æ”¯æŒå¹³å°æœ‰é™ï¼Œç›®å‰ä¸»è¦æ˜¯ github å’Œ bitbucket ä¸Šä¸‹æ–‡ï¼šå¿½ç•¥æ–‡ä»¶é…ç½®æ–‡ä»¶ .cursorignore .cursirindexingignore ä»…ä»ç´¢å¼•ä¸­æ’é™¤æ–‡ä»¶ï¼Œæ–‡ä»¶å¯ä»¥è¢«AIè®¿é—®ï¼Œä½†ä¸ä¼šå‡ºç°åœ¨ä»£ç åº“æœç´¢ä¸­é…ç½®æ–¹å¼å…¨å±€å¿½ç•¥æ–‡ä»¶ Settings Global Cursor Ignore List é…ç½®.cursorignoreåœ¨æ ¹ç›®å½•ä¸­ä½¿ç”¨ .gitignore è¯­æ³•åˆ›å»º .cursorignore æ–‡ä»¶é»˜è®¤å¿½ç•¥æ–‡ä»¶.gitignore ä¸­çš„æ–‡ä»¶ä¸€äº›é»˜è®¤å¿½ç•¥åˆ—è¡¨ï¼ˆæ–‡æ¡£é‡Œæœ‰ï¼‰åœ¨ .cursorignore ä¸­å¯ä»¥ä½¿ç”¨ !å‰ç¼€ è¦†ç›–å¦å®šæ¨¡å¼é™åˆ¶ä»¥ ! ä¸ºå‰ç¼€å¦‚æœçˆ¶ç›®å½•é€šè¿‡ * è¢«æ’é™¤ï¼Œåˆ™æ— æ³•é‡æ–°åŒ…å«æ–‡ä»¶ ï¼ˆå¥½å¾®å¦™â€¦ï¼‰ å»ºè®®ï¼š æ˜¾å¼æ’é™¤åµŒå¥—ç›®å½• é˜»æ­¢èŒƒå›´ index tab ã€agent ã€inline edit @ğŸ’¡æ³¨æ„Agentå‘èµ·çš„å·¥å…·è°ƒç”¨ï¼ˆç»ˆç«¯MCPï¼‰æ— æ³•é˜»æ­¢ ä¸ºä»€ä¹ˆè¦å¿½ç•¥ æ€§èƒ½ï¼š æ’é™¤æ— å…³éƒ¨åˆ†å¯ä»¥å®ç°æ›´å¿«çš„ç´¢å¼•ï¼Œå’Œæ›´å‡†ç¡®çš„æ–‡ä»¶å‘ç° å®‰å…¨æ€§ï¼š é™åˆ¶å¯¹APIå¯†é’¥ã€å‡­æ®ã€æœºå¯†ä¿¡æ¯çš„è®¿é—® è™½ç„¶å¯ä»¥é™åˆ¶è®¿é—®ï¼Œä½†ç”±äºLLMçš„ä¸å¯é¢„æµ‹æ€§ï¼Œæ— æ³•ä¿è¯å®Œå…¨ä¿æŠ¤ï¼Ÿï¼Ÿï¼Ÿ ä¸Šä¸‹æ–‡ï¼šMCPMCPï¼ˆModel Context Protocolï¼‰ MCPä½¿Cursorèƒ½å¤Ÿè¿æ¥åˆ°å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºæ— éœ€é‡å¤è§£é‡Šé¡¹ç›®ç»“æ„ï¼Œç›´æ¥ä¸å·¥å…·é›†æˆ ğŸ”å·¥ä½œåŸç† MCPæœåŠ¡å™¨é€šè¿‡åè®®å…¬å¼€åŠŸèƒ½ï¼Œå°†Cursorè¿æ¥åˆ°å¤–éƒ¨å·¥å…·æˆ–æ•°æ®æºæ”¯æŒä¸‰ç§ä¼ è¾“æ–¹å¼ï¼šstdioCursorç®¡ç†å•ç”¨æˆ·shellå‘½ä»¤æ‰‹åŠ¨SSEéƒ¨ç½²ä¸ºæœåŠ¡å™¨å¤šç”¨æˆ·SSEç«¯ç‚¹URLOAuthStreamable HTTPéƒ¨ç½²ä¸ºæœåŠ¡å™¨å¤šç”¨æˆ·HTTPç«¯ç‚¹URLOAuth ä¸Šä¸‹æ–‡ï¼š@ç¬¦å·@æè¿°@Fileså¼•ç”¨ç‰¹å®šæ–‡ä»¶@Folderså¼•ç”¨æ•´ä¸ªæ–‡ä»¶å¤¹@Codeå¼•ç”¨ç‰¹å®šä»£ç ç‰‡æ®µæˆ–ç¬¦å·@Docsè®¿é—®æ–‡æ¡£å’ŒæŒ‡å—@Gitè®¿é—®gitå†å²è®°å½•å’Œæ›´æ”¹@PastChats ä½¿ç”¨æ±‡æ€»çš„ç¼–è¾‘å™¨å›è¯@Rulesä½¿ç”¨cursorè§„åˆ™@Terminalsç»ˆç«¯@ActiveTabs æ¿€æ´»çš„æ™ºèƒ½ä½“@LinterErrors å¼•ç”¨linté”™è¯¯@Webå¤–éƒ¨ç½‘ç»œèµ„æºå’Œæ–‡æ¡£@Linkç²˜è´´URLæ—¶ï¼ŒCursorä¼šå°†å…¶è‡ªåŠ¨æ ‡è®°ä¸º@Linkï¼Œæ”¯æŒPDF@RecentChanges åˆ›å»ºæŒ‡å‘ç‰¹å®šä»£ç æˆ–æ–‡æ¡£çš„è”æœº#Fileså°†æ–‡ä»¶æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­è€Œä¸å¼•ç”¨Commandså°†æ‰“å¼€å’Œæ´»åŠ¨çš„æ–‡ä»¶æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­"},{"title":"aiä»‹ç»","path":"/wiki/AI/index.html","content":"chatgpt å…è´¹ç‰ˆä½¿ç”¨ claude codeï¼ˆå¾ˆå¼ºï¼‰ ä½¿ç”¨æ•™ç¨‹ traeå›½å†…ç‰ˆä½¿ç”¨ ç›¸å…³æŠ€æœ¯æ¦‚å¿µè§£é‡ŠMCPæŠ€æœ¯ç®€ä»‹MCPï¼ˆModel Context Protocolï¼‰æ¨¡å‹ä¸Šä¸‹æ–‡åè®® gptç­”æ¡ˆï¼šhttps://chatgpt.com/c/688d6f54-7534-800a-b951-7f09a2a39c7b ä¸Šä¸‹æ–‡åè®®å¯¹æ—¥å¸¸ç”Ÿæ´»ä¸­çš„äººä¹Ÿé€‚ç”¨ï¼Œæ¯”å¦‚å½“å‰ç½‘ç»œä¸Šå‡ºç°çš„MEMEæ–‡åŒ–ï¼Œï¼ˆæ­¤å¤„è´´è¡¨æƒ…åŒ…ï¼‰åªæœ‰ç»“åˆä¼—å¤šç½‘ç»œæ–‡åŒ–å’Œæ•…äº‹èƒŒæ™¯å»çœ‹ï¼ŒMEMEæ‰æœ‰çœŸæ­£çš„æ„ä¹‰ã€‚è¿™ç‚¹å¯¹AIæ¨¡å‹æ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·ï¼ŒMCPèƒ½å¸®åŠ©æ¨¡å‹è®°å¿†å’Œç†è§£å¯¹è¯èƒŒæ™¯ï¼Œæ¯”å¦‚ï¼šç”¨æˆ·ï¼šâ€œæˆ‘æ²¡ä»€ä¹ˆæœ‹å‹ï¼Œå¹³æ—¶ä¸€ä¸ªäººåº”è¯¥æ€ä¹ˆæ’è§£å­¤ç‹¬ï¼Ÿâ€æ¨¡å‹ï¼šâ€œæˆ‘æ¨èå°‘å®…åœ¨å®¶é‡Œï¼Œå¤šå‡ºé—¨è¿›è¡Œæˆ·å¤–ä½“è‚²è¿åŠ¨ã€‚â€ç”¨æˆ·ï¼šâ€œæœ‰ä»€ä¹ˆæ¨èçš„æˆ·å¤–è¿åŠ¨ç±»å‹å—ï¼Ÿâ€æ¨¡å‹ï¼ˆå¤±å¿†ç‰ˆï¼‰ï¼šâ€œæˆ‘æ¨èä¸‰äº”å¥½å‹ç»“ä¼´æ‰“ç¾½æ¯›çƒã€‚â€æ¨¡å‹ï¼ˆä¸Šä¸‹æ–‡ç‰ˆï¼‰ï¼šâ€œç‹¬è‡ªä¸€äººçš„è¯å¯ä»¥é€‰æ‹©å¾’æ­¥æˆ–è€…å•è½¦æ—…è¡Œã€‚â€ æ‰€è°“Protocolï¼Œå³ç”¨äºè§„èŒƒå¦‚ä½•ä¼ é€’è¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ¯”å¦‚å¤šè½®å¯¹è¯åï¼Œå“ªäº›ä¿¡æ¯æ˜¯æœ‰æ•ˆçš„ï¼Œå“ªäº›å¯ä»¥è¢«å¿˜è®°ã€‚ä¸¾ä¸ªä¾‹å­ï¼šæœŸæœ«è€ƒè¯•å‰ï¼Œä¸ºäº†ä¸æŒ‚ç§‘ç†¬å¤œèƒŒçš„é‚£äº›çŸ¥è¯†ç‚¹ï¼Œè€ƒå®Œä¹‹åå°±å¯ä»¥å¿˜è®°äº†ã€‚"},{"title":"â™¦ï¸å®Œç¾æ–¹å—","path":"/wiki/Cocos/game_05_PerfectCubeGame.html","content":"èµ„æºåœ°å€ è§†é¢‘æ•™ç¨‹ï¼šé˜¿ä¿¡OLå®Œç¾æ–¹å—æ¸¸æˆDemogithubæºç "},{"title":"vue","path":"/wiki/Job/front_01_vue.html","content":"å…³äºå‰ç«¯é¢è¯•é¢˜webå‰ç«¯é¢è¯•-é¢è¯•å®˜ç³»åˆ—ã€æ•´ç†çš„éå¸¸å…¨é¢ã€‘yyshinoã€ä¸€ä¸ªæœ‰è¶£çš„åšå®¢ï¼Œæ•´ç†äº†ä¸å°‘é¢ç»ã€‘ ç‰¹æ€§ç›¸å…³Vueå’ŒReactçš„åŒºåˆ«vueä½¿ç”¨ç±»ä¼¼htmlçš„templateæ¨¡æ¿è¯­æ³•ï¼Œreactä½¿ç”¨jsxç»„ä»¶é€šä¿¡æ–¹å¼ä¸åŒvueç»„ä»¶ä¸­å­ç»„ä»¶ä¼ å€¼ç»™çˆ¶ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡emitäº‹ä»¶reactä¸­ï¼Œåˆ™éœ€è¦çˆ¶ç»„ä»¶ä¼ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œç”±å­ç»„ä»¶è°ƒç”¨çŠ¶æ€ç®¡ç†vueä½¿ç”¨vuexpiniaè¿›è¡ŒçŠ¶æ€ç®¡ç†reactä½¿ç”¨çš„æ˜¯reduxç”Ÿå‘½å‘¨æœŸvueç»„ä»¶æœ‰ç”Ÿå‘½å‘¨æœŸé’©å­reactç±»ç»„ä»¶å¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œå‡½æ•°å¼ç»„ä»¶ä¸€èˆ¬ä½¿ç”¨hooksä»£æ›¿ç”Ÿå‘½å‘¨æœŸdiffç®—æ³•çš„å®ç°ä¸åŒreactä½¿ç”¨åŸºäºå±‚çº§çš„diffç®—æ³•é¦–å…ˆæ¯”è¾ƒä¸¤æ£µæ ‘çš„æ ¹èŠ‚ç‚¹æ ¸å¿ƒæ€æƒ³æ˜¯æ¯”è¾ƒå’Œæ›¿æ¢èŠ‚ç‚¹vueä½¿ç”¨çš„æ˜¯åŒç«¯æ¯”è¾ƒdiffç®—æ³• ç”Ÿå‘½å‘¨æœŸç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼Ÿ beforeCreate ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºä¹‹å‰ create ç»„ä»¶å®ä¾‹å®Œå…¨åˆ›å»º beforeMount ç»„ä»¶æŒ‚è½½ä¹‹å‰ mounted ç»„ä»¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå beforeUpdate ç»„ä»¶æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°ä¹‹å‰ updated ç»„ä»¶æ•°æ®æ›´æ–°ä¹‹å beforeDestroy ç»„ä»¶å®ä¾‹é”€æ¯ä¹‹å‰ destroyed ç»„ä»¶å®ä¾‹é”€æ¯ä¹‹å activated keep-aliveç¼“å­˜çš„ç»„ä»¶æ¿€æ´»æ—¶ deactivated keep-aliveç¼“å­˜çš„ç»„ä»¶åœç”¨æ—¶ errorCaptured æ•è·ä¸€ä¸ªæ¥è‡ªå­å­™ç»„ä»¶çš„é”™è¯¯æ—¶è¢«è°ƒç”¨ è¿›å…¥ç»„ä»¶ä¹‹åä¼šæ‰§è¡Œå“ªäº›ç”Ÿå‘½å‘¨æœŸ beforeCreate ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºä¹‹å‰ dataä¸å­˜åœ¨ï¼Œdomæœªæ¸²æŸ“ create ç»„ä»¶å®ä¾‹å®Œå…¨åˆ›å»º dataå­˜åœ¨ï¼Œdomæœªæ¸²æŸ“ beforeMount ç»„ä»¶æŒ‚è½½ä¹‹å‰ dataå­˜åœ¨ï¼Œdomæœªæ¸²æŸ“ mounted ç»„ä»¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå dataæ•°æ®å­˜åœ¨ï¼Œdomä¹Ÿå·²ç»è¢«æ¸²æŸ“å‡ºæ¥äº† çˆ¶ç»„ä»¶å¼•å…¥å­ç»„ä»¶ï¼Œç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåºæ˜¯ï¼Ÿ çˆ¶ç»„ä»¶-beforeCreate çˆ¶ç»„ä»¶-created çˆ¶ç»„ä»¶-beforeMount å­ç»„ä»¶-beforeCreate å­ç»„ä»¶-created å­ç»„ä»¶-beforeMount å­ç»„ä»¶-mounted çˆ¶ç»„ä»¶-mounted æ€»ç»“ï¼šçˆ¶ç»„ä»¶å…ˆå‡†å¤‡æ•°æ®ï¼Œå­ç»„ä»¶æ¥ç€æ¸²æŸ“domåï¼Œçˆ¶ç»„ä»¶æ¸²æŸ“dom createdä¸­å¦‚ä½•è·å–domè·å–æ—¶æœºï¼š ç”±äºjsæ‰§è¡Œä»£ç éµå¾ªå…ˆåŒæ­¥åå¼‚æ­¥çš„æœºåˆ¶ï¼Œå› æ­¤åªè¦åœ¨å¼‚æ­¥å›è°ƒä¸­å°±èƒ½è·å–åˆ°dom åœ¨setTimeoutç­‰å®ä»»åŠ¡ä¸­è·å– $nextTick è·å–æ–¹å¼ï¼š domæ–¹æ³• ref å‘é€è¯·æ±‚åœ¨createdè¿˜æ˜¯mountedï¼Ÿç­”ï¼š è¿™ä¸ªé—®é¢˜å…·ä½“è¦çœ‹é¡¹ç›®å’Œä¸šåŠ¡æƒ…å†µäº†ï¼Œ å› ä¸ºç»„ä»¶çš„åŠ è½½é¡ºåºæ˜¯ï¼šçˆ¶ç»„ä»¶å¼•å…¥äº†å­ç»„ä»¶ï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œçˆ¶ç»„ä»¶çš„å‰3ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå†æ‰§è¡Œå­ç»„ä»¶çš„å‰4ä¸ªç”Ÿå‘½å‘¨æœŸ å¦‚æœéœ€è¦ä¼˜å…ˆåŠ è½½å­ç»„ä»¶çš„æ•°æ®ï¼Œé‚£ä¹ˆçˆ¶ç»„ä»¶çš„è¯·æ±‚éœ€è¦æ”¾åœ¨mountedä¸­ å¦‚æœç»„ä»¶æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆè¯·æ±‚æ”¾åœ¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯å¯ä»¥çš„ã€‚ ä¸ºä»€ä¹ˆå‘é€è¯·æ±‚ä¸åœ¨beforeCreateé‡Œï¼ŸbeforeCreateå’Œcreatedæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”ï¼š åœ¨beforeCreateé‡Œï¼Œæ˜¯è·å–ä¸åˆ°methodsé‡Œçš„æ–¹æ³•çš„ã€‚ beforeCreateé˜¶æ®µï¼Œè·å–ä¸åˆ°$elå’Œ$data createdä¸­èƒ½è·å–åˆ°$dateï¼Œä¹Ÿèƒ½è®¿é—®methodsé‡Œçš„æ–¹æ³• ç¬¬2æ¬¡ï¼Œæˆ–è€…ç¬¬Næ¬¡è¿›å…¥ç»„ä»¶ä¼šæ‰§è¡Œå“ªäº›ç”Ÿå‘½å‘¨æœŸç­”ï¼š å¦‚æœåŠ å…¥äº†keep-aliveï¼Œåªæ‰§è¡Œactivated å¦‚æœæœªåŠ å…¥ï¼Œæ‰§è¡Œå‰4ä¸ªç”Ÿå‘½å‘¨æœŸ åŠ å…¥keep-aliveä¼šæ‰§è¡Œå“ªäº›ç”Ÿå‘½å‘¨æœŸï¼Ÿ activated deactivated ç”Ÿå‘½å‘¨æœŸçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿç­”ï¼š created å•ä¸ªç»„ä»¶è¿›è¡Œæ•°æ®è¯·æ±‚ mounted è·å–dom æ§åˆ¶çˆ¶å­ç»„ä»¶è¯·æ±‚é¡ºåº activated ç»„ä»¶å…¥å£æºå¸¦ä¸åŒçš„è·¯ç”±å‚æ•°è¿›å…¥æ—¶ï¼Œå¤„ç†å‚æ•° destroyed æ¸…ç†ç›‘å¬å™¨å’Œå®šæ—¶å™¨ è®°å½•é¡µé¢è§†é¢‘ä¸Šæ¬¡æ’­æ”¾çš„æ—¶é—´ ç»„ä»¶keep-aliveç­”ï¼š ç”¨é€”ï¼šç¼“å­˜å½“å‰ç»„ä»¶ï¼Œæå‡æ€§èƒ½ï¼Œå‡å°‘å‘é€è¯·æ±‚çš„æ•°é‡ å¦‚æœç”¨æˆ·è¯·æ±‚çš„é¡µé¢ç»„ä»¶å’Œå½“å‰ç»„ä»¶ç›¸åŒï¼Œä¸ä¼šå‘èµ·æ–°çš„è¯·æ±‚ è¢«keep-aliveåŒ…è£¹çš„ç»„ä»¶ï¼Œå†æ¬¡è¿›å…¥æ—¶ï¼Œä»…ä¼šè§¦å‘activatedç”Ÿå‘½å‘¨æœŸï¼Œä¸å†æ‰§è¡Œå‰å››ä¸ªç”Ÿå‘½å‘¨æœŸ ç»„ä»¶ä¼ å€¼æœ‰å‡ ç§æ–¹å¼ çˆ¶ä¼ å­ æ–¹æ³•1ï¼šçˆ¶ç»„ä»¶å¼•ç”¨å­ç»„ä»¶ï¼Œå­ç»„ä»¶ä½¿ç”¨propsæ¥æ”¶å‚æ•°ï¼Œç¼ºç‚¹æ˜¯çˆ¶ç»„ä»¶æ— æ³•ä¼ å€¼ç»™å­™å­è¾ˆç»„ä»¶ ä¸å…è®¸å­ç»„ä»¶ç›´æ¥ä¿®æ”¹propä¼ å…¥çš„æ•°æ® éœ€è¦é€šè¿‡äº‹ä»¶æˆ–è€…å›è°ƒçš„æ–¹å¼é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶è¿›è¡Œä¿®æ”¹ æ–¹æ³•2ï¼šå­ç»„ä»¶ä½¿ç”¨$parentç›´æ¥è·å–çˆ¶ç»„ä»¶æ•°æ®ï¼Œå­™å­è¾ˆå¯ä»¥ä½¿ç”¨this.$parent.$parentè·å–ï¼Œå­ç»„ä»¶å¯ä»¥ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ® provideinjectè¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œçˆ¶ç»„ä»¶ç›´æ¥å‘å­ä»£ç»„ä»¶æ³¨å…¥æ•°æ® ä¼ å…¥ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æ—¶ï¼Œinjectæ¥æ”¶å€¼ä¸ºå‰¯æœ¬ï¼Œå­ç»„ä»¶ä¿®æ”¹æ•°æ®ä¸ä¼šå½±å“ç»„ä»¶å…¶å®ƒåä»£ç»„ä»¶ä¸­çš„æ•°æ® ä¼ å…¥ä¸ºå¼•ç”¨ç±»å‹æ—¶ï¼Œä¼šå½±å“ å­ä¼ çˆ¶ é€šè¿‡äº‹ä»¶æˆ–è€…å›è°ƒæ–¹å¼ é€šè¿‡this.$children[index].xxxï¼Œç›´æ¥è·å–å­ç»„ä»¶å®ä¾‹ä¸­çš„æ•°æ® å½“å­˜åœ¨æ¡ä»¶æ¸²æŸ“æ—¶ï¼Œä½¿ç”¨ç´¢å¼•è®¿é—®ä¼šå˜å¾—å¾ˆä¸å¯é  ç»‘å®šrefï¼Œé€šè¿‡this.$refs.å­ç»„ä»¶refåç§° å…„å¼Ÿäº’ä¼  é€šè¿‡bus import bus from @/utils/bus.jsbus.$emit(change,new-value)bus.$on(change,val= console.log(val)) å­ç»„ä»¶å¦‚ä½•ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„å€¼ this.$parent.xxxçŸ¥å·±ä¿®æ”¹ å­ç»„ä»¶å¦‚ä½•æ‰¾åˆ°çˆ¶ç»„ä»¶ this.$parent å¦‚ä½•æ‰¾åˆ°æ ¹ç»„ä»¶ this.$root provideinject ç¥–å…ˆç»„ä»¶é€šè¿‡provideæ³¨å…¥æ•°æ® å­å­™ç»„ä»¶é€šè¿‡injectæ¥æ”¶æ•°æ® slotæ’æ§½ åŒ¿åæ’æ§½ å…·åæ’æ§½slot name=header/slottemplate #header/template ä½œç”¨åŸŸæ’æ§½ï¼ˆå¯ä»¥ä¼ å€¼ï¼‰slot name=header :arr=[a,b,c] :brr=123/slottemplate #header=arr,brr/template å¦‚ä½•å°è£…ç»„ä»¶ ç»„ä»¶å°½é‡å¤æ‚ï¼Œæ¶‰åŠåˆ°slotç»„ä»¶é€šä¿¡â€¦ ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘å°è£…è¿‡ä¸€ä¸ª2då¯è§†åŒ–åœ°å›¾ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä¸»è¦ä½œç”¨æ˜¯å®æ—¶è¿½è¸ªå«æ˜Ÿè½¨è¿¹ï¼Œå¯¹ä¸åŒç§ç±»çš„å«æ˜Ÿè¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶å±•ç¤ºï¼ŒåŸæœ¬æ˜¯ä½œä¸ºç‹¬ç«‹é¡¹ç›®è¿›è¡Œå¼€å‘çš„ï¼Œåˆ°äº†åæœŸï¼Œä¸šåŠ¡è¦æ±‚å°†è¿™ä¸ªåŠŸèƒ½åµŒå…¥åˆ°å…¶å®ƒå¤šä¸ªç³»ç»Ÿä¸­ï¼Œæ‰€ä»¥å°±éœ€è¦å°è£…æˆç»„ä»¶è¿™ä¸ªç»„ä»¶ä¸€å…±æœ‰2ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯æä¾›ç²¾å‡†è¿½è¸ªè½¨è¿¹çš„æ–¹å¼ï¼Œå«æ˜Ÿä¼šæ ¹æ®ä¼ å…¥ç»„ä»¶å†…çš„è½¨è¿¹å‚æ•°ä¸¥æ ¼è¿è¡Œä¸€ç§æ˜¯æ™ºèƒ½æ¨æ¼”æ–¹å¼ï¼Œä»¥ä¼ å…¥ç»„ä»¶çš„è½¨è¿¹ç‚¹ä½ä¸ºé”šç‚¹ï¼Œæ¨æ¼”å„ä¸ªé”šç‚¹é—´çš„è½¨è¿¹å¦å¤–ï¼Œåƒåœ°å›¾æ ·å¼ã€å«æ˜Ÿå›¾ä¾‹æ ·å¼éƒ½æ˜¯å¯ä»¥æ ¹æ®ä¼ å…¥ç»„ä»¶çš„å‚æ•°è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶ç»„ä»¶å†…æä¾›ä¸€äº›äº‹ä»¶å›è°ƒï¼šè½¨è¿¹è¿½è¸ªå¼€å§‹ã€è¿½è¸ªç»“æŸã€å«æ˜Ÿå‘ç”Ÿç¢°æ’ã€æ•Œæˆ‘å«æ˜Ÿè¶…è¿‡å±é™©è·ç¦»ç­‰äº‹ä»¶å¦å¤–ï¼Œå…³äºå«æ˜Ÿå›¾ä¾‹ä¸­ï¼Œåƒå›¾è¡¨æ ‡é¢˜ã€å›¾ä¾‹ã€è¡¨å¤´ã€è¡¨å°¾ã€å·¥å…·æ ç­‰ä½ç½®ï¼Œéƒ½æ˜¯æä¾›æ’æ§½å®šåˆ¶åŠŸèƒ½çš„ï¼Œå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰æ“ä½œã€‚ propså’Œdataä¼˜å…ˆçº§è°é«˜ç­”ï¼špropsçš„ä¼˜å…ˆçº§é«˜ åˆå§‹åŒ–çŠ¶æ€ä¼˜å…ˆçº§ï¼š props methods data computed watch ä¸ºä»€ä¹ˆdataæ˜¯ä¸€ä¸ªå‡½æ•° é‡å¤åˆ›å»ºå®ä¾‹æ—¶é¿å…æ•°æ®æ±¡æŸ“ ä¿è¯å¯¹è±¡ç‹¬ç«‹ vuexVuexæœ‰å“ªäº›å±æ€§ state å…¨å±€å…±äº«å±æ€§ $store.state.str mapState getters é’ˆå¯¹stateæ•°æ®è¿›è¡ŒäºŒæ¬¡è®¡ç®— $store.getters.xxx mapGetters gettersæ•°æ®æ— æ³•ä¿®æ”¹ mutations å­˜æ”¾åŒæ­¥æ–¹æ³•çš„ åœ¨mutationsä¸­ä¿®æ”¹state actions å­˜æ”¾ä¸€æ­¥æ–¹æ³•çš„ï¼Œæäº¤mutations modules æŠŠvuexå†æ¬¡è¿›è¡Œæ¨¡å—å°è£… vuexä½¿ç”¨stateå€¼ this.$store.state.xxx å¯ä»¥ç›´æ¥ä¿®æ”¹vuexçš„stateæ•°æ®çš„ mapState vuexçš„getterså€¼ä¿®æ”¹vuexæ˜¯å•é¡¹æ•°æ®æµè¿˜æ˜¯åŒå‘æ•°æ®æµç­”ï¼šå•å‘æ•°æ®æµå¯ä»¥é€šè¿‡mutationè¿›è¡Œä¿®æ”¹ vuexçš„mutationså’ŒactionsåŒºåˆ«mutations: add(state) state.number += 2 ,actions: addNumber(commit,state) commit(add) mutationsæ— è¿”å›å€¼ï¼ŒåŠŸèƒ½å±€é™åœ¨çŠ¶æ€å˜æ›´ä¸Š actionsè¿”å›Promiseå¯¹è±¡ï¼Œèƒ½å¤Ÿè¿›è¡Œä¸€æ­¥æ“ä½œ actionsç”¨äºæäº¤mutationï¼Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ vuexæŒä¹…åŒ–å­˜å‚¨vuexæœ¬èº«æ— æ³•å®ç°æŒä¹…åŒ–å­˜å‚¨ æ–¹å¼1ï¼šlocalStorage æ–¹å¼2ï¼švuex-persistedstate è·¯ç”±è·¯ç”±çš„æ¨¡å¼å’ŒåŒºåˆ« hash urlåœ¨æ ¹è·¯å¾„åè·Ÿéš# å½“è¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨æ—¶ï¼Œä¸ä¼šå‘åå°è¯·æ±‚èµ„æºï¼Œè‡ªåŠ¨è·³è½¬æ ¹è·¯å¾„ åŸç†ï¼šåŸºäºurlçš„hashå€¼æ¥å®ç°è·¯ç”±ï¼Œhashå€¼å˜åŒ–ï¼Œæµè§ˆå™¨ä¸ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯è§¦å‘hashChangeäº‹ä»¶ï¼Œå‰ç«¯è·¯ç”±åº“ç›‘å¬è¯¥äº‹ä»¶ï¼Œæ ¹æ®hashå€¼çš„å˜åŒ–åŠ¨æ€æ¸²æŸ“å¯¹åº”ç»„ä»¶ æ— éœ€æœåŠ¡å™¨é…ç½®ï¼Œæ— è®ºhashå€¼å¦‚ä½•å˜åŒ–ï¼ŒæœåŠ¡å™¨è¿”å›åŒä¸€ä¸ªé¡µé¢ ä¸åˆ©äºSEOä¼˜åŒ– ç”¨äºéœ€è¦å…¼å®¹æµè§ˆå™¨è·ä¸éœ€è¦æœåŠ¡å™¨é…ç½®çš„é¡¹ç›® æ‰“åŒ…åå‰å°å¯ä»¥è‡ªæµ‹çœ‹åˆ°é¡µé¢å†…å®¹ history è¯·æ±‚é¡µé¢ä¸å­˜åœ¨æ—¶ï¼Œä¾æ—§å‘é€è¯·æ±‚ ä¸€èˆ¬ä¼šè·³è½¬404é¡µé¢ åŸç†ï¼šåŸºäºhtml5çš„history api éœ€è¦æœåŠ¡å™¨é…ç½®å’Œæµè§ˆå™¨å…¼å®¹ ç”¨äºå¯¹urlç¾è§‚æ€§å’Œseoè¦æ±‚è¾ƒé«˜çš„é¡¹ç›® æ‰“åŒ…åå‰å°è‡ªæµ‹æ— æ³•æ­£å¸¸è®¿é—®è·¯ç”± å­è·¯ç”±åŠ¨æ€è·¯ç”±ç­”ï¼š å¸¸ç”¨äºè¯¦æƒ…é¡µ path:/list, name:List, children:[ path:/list:id, name:Detail, component:()=import(../views/Detail.vue) ] è·¯ç”±ä¼ å€¼ æ˜¾å¼ä¼ å€¼ // http://localhost:8000/about?a=1this.$router.push( path:/about, query: a:1 ) éšå¼ä¼ å€¼ // http://localhost:8000/about?a=1this.$router.push( path:/about, params: a:1 ) å¯¼èˆªæ•…éšœ å½“å‰é¡µè·³è½¬å½“å‰é¡µçš„æ—¶å€™ï¼Œä¼šæŠ¥å¯¼èˆªæ•…éšœé”™è¯¯ äº§ç”ŸåŸå› ï¼šåœ¨historyæ¨¡å¼ä¸‹ï¼Œä½¿ç”¨html5çš„history apiå®ç°è·¯ç”±è·³è½¬ï¼Œå¦‚æœå‰ç«¯è·¯ç”±æ²¡æœ‰å¤„ç†ã€åŒé¡µé¢è·³è½¬ã€‘çš„æƒ…å†µï¼Œå°±å¯èƒ½å¯¼è‡´å¯¼èˆªæ•…éšœ è§£å†³æ–¹æ³•ï¼šé‡å†™VueRouter.prototype.pushæ–¹æ³•ï¼š import VueRouter from vue-routerconst routerPush = VueRouter.prototype.pushVueRouter.prototype.push = function(location) return routerPush.call(this, location).catch(error=error) $routerå’Œ$routeçš„åŒºåˆ« $router åŒ…å«å½“å‰è·¯ç”± åŒ…å«æ•´ä¸ªè·¯ç”±çš„å±æ€§å’Œæ–¹æ³• $route ä»…åŒ…å«å½“å‰è·¯ç”±å¯¹è±¡ å¯¼èˆªå®ˆå« å…¨å±€å®ˆå« beforeEach è·¯ç”±è¿›å…¥ä¹‹å‰ afterEach è·¯ç”±è¿›å…¥ä¹‹å è·¯ç”±ç‹¬äº«å®ˆå« beforeEnter è·¯ç”±è¿›å…¥ä¹‹å‰ path:/about, name:about, beforeEnter:function(to,from,next) if(true) next() else next(/login) ç»„ä»¶å†…å®ˆå« beforeRouteEnter è·¯ç”±è¿›å…¥ä¹‹å‰ beforeRouteUpdate è·¯ç”±æ›´æ–°ä¹‹å‰ beforeRouteLeave è·¯ç”±ç¦»å¼€ä¹‹å‰ ä½¿ç”¨åœºæ™¯ï¼šä¸€äº›åªæœ‰åœ¨ç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½å¼€å‘çš„é¡µé¢ï¼Œæˆ–è€…æ˜¯éœ€è¦å¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œåˆ’åˆ†çš„ç»„ä»¶ ä»‹ç»ä¸€ä¸‹SPAä»¥åŠSPAæœ‰ä»€ä¹ˆç¼ºç‚¹SPAï¼šå•é¡µé¢åº”ç”¨ ç¼ºç‚¹ï¼š SEOä¼˜åŒ–ä¸å¥½ æ€§èƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ routerè·³è½¬å’Œaæ ‡ç­¾è·³è½¬åŒºåˆ« aæ ‡ç­¾è·³è½¬å›é‡æ–°ä»æœåŠ¡å™¨ç«¯è¯·æ±‚èµ„æºï¼Œè€—æµé‡ã€è€—æ€§èƒ½ spaå•é¡µè·¯ç”±æ¨¡å¼ï¼Œrouterè·³è½¬åªæ˜¯åŠ è½½ä¸­é—´çš„htmlä»£ç ï¼Œä¸ä¼šè¯·æ±‚èµ„æº api$set $set(target,key,value) // [1,2,3]å˜ä¸º[1,5,3]// this.arr[1] = 5this.$set(this.arr, 1, 5) $nextTick ä¼ å…¥çš„å›è°ƒå‡½æ•°ä¼šè¢«å¼‚æ­¥æ‰§è¡Œ å¸¸ç”¨äºæ‰§è¡Œç»„ä»¶æ¸²æŸ“åçš„æ“ä½œ æ˜¯å¾®ä»»åŠ¡ï¼Œå› ä¸ºä½¿ç”¨Promise.resolveå®ç° class Vue $nextTick(callback) return Promise.resolve().then(()= callback() ) $refsè·å–dom $elè·å–å½“å‰ç»„ä»¶çš„æ ¹èŠ‚ç‚¹ $dataè·å–å½“å‰ç»„ä»¶dataæ•°æ® $childrenè·å–å½“å‰ç»„ä»¶çš„æ‰€æœ‰å­ç»„ä»¶ï¼ˆæ•°ç»„æ ¼å¼ï¼‰ $parent æ‰¾åˆ°å½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å›è‡ªèº« $rootè·å–æ ¹ç»„ä»¶ dataå®šä¹‰æ•°æ®data() this.num = 222 return str:111 ä½¿ç”¨this.xxxå®šä¹‰çš„æ•°æ®ï¼Œæ²¡æœ‰getterå’ŒsetteråŠ«æŒå¤„ç†ï¼Œå•ç‹¬ä¿®æ”¹æ—¶æ•°æ®ä¸ä¼šåˆ·æ–° computedè®¡ç®—å±æ€§computedè®¡ç®—çš„å€¼å¯ä»¥è¢«ä¿®æ”¹å—ï¼ˆåŒ…æ‹¬v-modelåŒå‘ç»‘å®šï¼‰ï¼Ÿ å¯ä»¥ï¼Œé€šè¿‡getå’Œset changeStr: get() return this.sre.slice(-2) , set(val) this.sre = val watch watchçš„åˆå§‹åŒ–ç›‘å¬ åŠ ä¸Šé…ç½®é¡¹ï¼šimmediate:true æ·±åº¦ç›‘å¬ deep:true methodsã€computedã€watchåŒºåˆ« computedæœ‰ç¼“å­˜æœºåˆ¶ å½“å‚ä¸è®¡ç®—çš„å€¼è¢«æ”¹å˜æ—¶ï¼Œè®¡ç®—å±æ€§ä¼šç›‘å¬åˆ°å¹¶è¿›è¡Œè¿”å› methodsæ²¡æœ‰ç¼“å­˜æœºåˆ¶ watch ç›‘å¬æ•°æ®è·¯ç”±çš„å˜åŒ– ç›‘å¬å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šæ‰§è¡Œ æŒ‡ä»¤å¦‚ä½•è‡ªå®šä¹‰æŒ‡ä»¤vueå•é¡¹ç»‘å®šv-ifå’Œv-showçš„åŒºåˆ« v-if æ·»åŠ åˆ é™¤domèŠ‚ç‚¹ ä¸€èˆ¬ç”¨äºæ˜¾éšåˆ‡æ¢ä¸é¢‘ç¹çš„æ¸²æŸ“èŠ‚ç‚¹ v-show ä½¿ç”¨display:noneå¯¹å…ƒç´ è¿›è¡Œæ˜¾éšæ§åˆ¶ ä¸€èˆ¬ç”¨äºæ˜¾éšåˆ‡æ¢é¢‘ç¹çš„æ¸²æŸ“èŠ‚ç‚¹ v-ifå’Œv-forä¼˜å…ˆçº§ç­”ï¼š vue2ä¸­ï¼šv-forä¼˜å…ˆçº§é«˜ï¼Œè¿™æ˜¯vueçš„æºç å†³å®šçš„ vue3ä¸­ï¼šv-ifä¼˜å…ˆçº§é«˜ åŸç†$nextTickåŸç†v-modelåŒå‘ç»‘å®šåŸç†scopedåŸç†ç»™å…ƒç´ èŠ‚ç‚¹æ–°å¢è‡ªå®šä¹‰å±æ€§ï¼š div data-v-xxxx class=hello-boxHello/divstyle.hello-box[data-v-xxxx] background:red/style æ ·å¼ç©¿é€ scssstylusä¸­çš„æ ·å¼ç©¿é€ï¼š æ–¹å¼1ï¼šçˆ¶å…ƒç´  deep å­å…ƒç´  æ–¹å¼2ï¼šçˆ¶å…ƒç´  å­å…ƒç´  renderå‡½æ•° renderå‡½æ•°æ”¯æŒç”¨jsè¯­è¨€æ¥æ„å»ºdom vueæ˜¯è™šæ‹Ÿdomï¼Œæ‹¿åˆ°templateæ¨¡ç‰ˆä¹Ÿä¼šè½¬è¯‘æˆvnodeå‡½æ•° ä½¿ç”¨renderæ„å»ºdomï¼Œå°±ç›´æ¥çœå»äº†è½¬è¯‘çš„è¿‡ç¨‹ ä½¿ç”¨renderæ—¶ï¼Œä½¿ç”¨hå‡½æ•°æ„å»ºè™šæ‹Ÿdom axiosäºŒæ¬¡å°è£…vue3ç›¸å…³vue2å’Œvue3åŒºåˆ« åŒå‘ç»‘å®šæœºåˆ¶ä¸åŒ vue2ï¼šObject.defineProperty() ä½¿ç”¨å¾ªç¯å¯¹dataè¿”å›çš„å¯¹è±¡è¿›è¡Œéå†ï¼Œå®šä¹‰getå’Œset åæ·»åŠ çš„å±æ€§æ˜¯åŠ«æŒä¸åˆ°çš„ æœ‰äº›æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨$setè¿›è¡Œæ•°æ®åˆ·æ–° vue3ï¼šnew Proxy() ä½¿ç”¨new Proxyå¯¹å“åº”å¼æ•°æ®è¿›è¡ŒåŒ…è£¹ æ—¢ä¸éœ€è¦å¾ªç¯éå†ï¼Œåæ·»åŠ çš„å±æ€§ä¹Ÿå¯ä»¥è¢«åŠ«æŒåˆ° ä¸éœ€è¦$setåˆ·æ–° // vue2 åŒå‘ç»‘å®šåŸç†let data = a:1, b:2let vue = for(let key in data) Object.defineProperty(vue, key, get() console.log(æ•°æ®è¢«è·å–) return data[key] , set(value) console.log(æ•°æ®è¢«è®¾ç½®) data[key] = value ) // vue3 åŒå‘ç»‘å®šåŸç†let data = a:1, b:2const vue = new Proxy(data, get(target, propKey, receiver) console.log(æ•°æ®è¢«è·å–) return Relect.get(targte, propKey, receiver) , set(target, propKey, value, receiver) console.log(æ•°æ®è¢«è®¾ç½®) return Reflect.set(target, propKey, value, receiver) ) vue2æ˜¯é€‰é¡¹å¼APIï¼Œvue3å¯ä»¥å‘ä¸‹å…¼å®¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„åˆå¼apiæˆ–è€…æ˜¯setupè¯­æ³•ç³–çš„å½¢å¼ v-ifå’Œv-forçš„ä¼˜å…ˆçº§ä¸åŒäº† refå’Œ$childrenä¹Ÿä¸åŒ vue3ä½¿ç”¨Tree-shaking æ‰“åŒ…æ—¶ä¼šå¯¹æ²¡æœ‰ç”¨åˆ°çš„apiè¿›è¡Œå‰”é™¤ï¼Œè¿™æ ·bundleçš„ä½“ç§¯æ›´å° åˆ›å»ºappå®ä¾‹ç”±new Vue()å˜ä¸ºcreateApp suspenseå…è®¸ç¨‹åºåœ¨ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“ä¸€äº›åå¤‡å†…å®¹ ä¸€æ­¥ç»„ä»¶ä½¿ç”¨defineAsyncComponentè¿›è¡ŒåŠ è½½ vue3ä½¿ç”¨setupæ€ä¹ˆç»„ç»‡ä»£ç ç­”ï¼šå¯ä»¥ä½¿ç”¨hookså¯¹å¤ç”¨é€»è¾‘è¿›è¡Œå°è£… ä¹Ÿå°±æ˜¯ç»„åˆå¼å‡½æ•°ï¼Œç”¨æ¥å°è£…å’Œæœç”¨é€»è¾‘çš„å‡½æ•°ï¼š import ref from vuefunction useSameLogic() let xxx = ref(123) return xxxexport default useSameLogic vue3ä½¿ç”¨setupå†™å¦‚ä½•è·å–ç±»ä¼¼vue2ä¸­çš„thislet proxy = getCurrentInstance() vue3å¸¸ç”¨apiæœ‰å“ªäº›createApp åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹ ç›¸å½“äºVue2çš„new Vue() ä½¿ç”¨åœºæ™¯ï¼šå†™æ’ä»¶å°è£…å…¨å±€ç»„ä»¶æ—¶ä¼šä½¿ç”¨ provideinject ä¾èµ–æ³¨å…¥ï¼Œè·¨è¾ˆä¼ å€¼ çˆ¶ç»„ä»¶ä¼ å€¼åˆ°åä»£ç»„ä»¶ï¼Œè·¨è¶Šå¤šä¸ªå±‚çº§ ä¸å¥½ç»´æŠ¤å’ŒæŸ¥è¯¢æ•°æ®æ¥æº directive è‡ªå®šä¹‰æŒ‡ä»¤ ä½¿ç”¨åœºæ™¯ï¼šåå°ç®¡ç†ç³»ç»Ÿä¸­çš„æŒ‰é’®æƒé™æ§åˆ¶ï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²å†³å®šæŒ‰é’®æ“ä½œæƒé™ mixin å…¨å±€æ··å…¥ å¯ä»¥æ·»åŠ ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å°ç¨‹åºçš„åˆ†äº«åŠŸèƒ½ä¼šç”¨åˆ° ä¸å¥½ç»´æŠ¤å’ŒæŸ¥è¯¢æ•°æ®æ¥æº app.config.globalProperties è·å–vueè¿™ä¸ªå…¨å±€å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³• è‡ªå·±å°è£…æ’ä»¶çš„æ—¶å€™éœ€è¦æŠŠæ–¹æ³•æ·»åŠ åˆ°å¯¹è±¡ä¸­ nextTick ç­‰å¾…ä¸‹ä¸€æ¬¡Domæ›´æ–°åˆ·æ–°çš„å·¥å…·æ–¹æ³• è¿”å›ä¸€ä¸ªPromiseï¼Œå›è°ƒå‡½æ•°å‚æ•°å¼‚æ­¥æ‰§è¡Œ computed è®¡ç®—å±æ€§ å¯ä»¥ç¼“å­˜è¿”å›ç»“æœ reactiveã€ref æ¥å®šä¹‰æ•°æ®å’Œvue2çš„dataç±»ä¼¼ watch ç›‘å¬ï¼ˆvue3ä¸éœ€è¦æ·±åº¦ç›‘å¬ï¼‰ markRaw() é™æ€æ•°æ®ï¼Œä¸è¢«new Proxyä»£ç† defineProps() setupå½¢å¼çš„ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶ä¼ é€’çš„å€¼ï¼Œå­ç»„ä»¶éœ€è¦ä½¿ç”¨definePropsæ¥æ”¶ defineEmits() setupå½¢å¼çš„ç»„ä»¶ï¼Œè‡ªå®šä¹‰äº‹ä»¶éœ€è¦ä½¿ç”¨defineEmits slot åˆ†ä¸ºåŒ¿åã€å…·åã€ä½œç”¨åŸŸ åå°ç®¡ç†é¡¹ç›®ï¼Œä¸»å†…å®¹éƒ¨åˆ†æ ¹æ®èœå•çš„é€‰æ‹©è¿›è¡Œåˆ‡æ¢ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨slotæ’æ§½ ä»‹ç»ä¸€ä¸‹vue3å¸¸è§çš„å“åº”å¼æ•°æ®ç±»å‹ ref å®šä¹‰åŸºæœ¬ç±»å‹ const abc = ref(10)console.log(abc.value) reactive å®šä¹‰å¼•ç”¨ç±»å‹ const data = reactive( name:123, age:23)console.log(data.name) toRef å¯¹reactiveå¯¹è±¡è¿›è¡Œå•ä¸ªå€¼è§£æ„å¤„ç† const name = toRef(data,name) toRefs å¯¹reactiveå¯¹è±¡è¿›è¡Œå…¨éƒ¨è§£æ„å¤„ç† const name, age = toRefs(data) ä»‹ç»ä¸€ä¸‹teleportç»„ä»¶åŠå…¶ä½¿ç”¨åœºæ™¯ä½¿ç”¨åœºæ™¯ï¼šå¸Œæœ›æŒ‡å®šç»„ä»¶æ¸²æŸ“åˆ°æ ¹ç»„ä»¶ä¸‹ï¼Œå’Œappå…ƒç´ åŒçº§çš„ä½ç½®ï¼ˆå¦‚å¼¹çª—ï¼‰ teleport to=body divHello/div/teleport ä»‹ç»watchå’ŒwatchEffectçš„åŒºåˆ« watch é™¤éé…ç½®immediateï¼Œå¦åˆ™åªæœ‰ç›‘å¬å€¼å‘ç”Ÿå˜åŒ–æ‰ä¼šæ‰§è¡Œ éœ€è¦ä¼ é€’ç›‘å¬å¯¹è±¡ èƒ½è·å–åˆ°æ›´æ”¹å‰åçš„å€¼ ç›‘å¬æ˜ç¡®æ•°æ® watchEffect ä¼šç«‹å³æ‰§è¡Œ åªéœ€è¦ä¼ é€’å›è°ƒå‡½æ•° æ— æ³•è·å–æ›´æ”¹å‰çš„å€¼ ç›‘å¬èƒ½è®¿é—®åˆ°çš„æ‰€æœ‰å“åº”å¼å±æ€§ ä»‹ç»vue2å’Œvue3ä¸­watchçš„åŒºåˆ« vue3 watchç®€åŒ–äº†è¯­æ³•ï¼Œä¸setupå‡½æ•°ç»“åˆæ›´åŠ ç´§å¯† watchä½œä¸ºå‡½æ•°è°ƒç”¨ èƒ½å¤Ÿç›‘å¬å¯¹è±¡çš„å­å±æ€§ï¼Œèƒ½é€šè¿‡æ•°ç»„ç»„åˆç›‘å¬ vue2 watchä½œä¸ºä¸€ä¸ªæ¨¡å—ï¼Œåœ¨å…¶ä¸­å®šä¹‰ç›¸åº”çš„ç›‘å¬äº‹ä»¶ vue3ç”Ÿå‘½å‘¨æœŸ setup ç›¸å½“äºvue2ä¸­çš„beforeCreateã€created onBeforeMount onMounted onBeforeUpdate onUpdated onBeforeUnmount onUnmounted onActivated onDeactivated onErrorCaptured é¡¹ç›®å¼€å‘ç›¸å…³ä»€ä¹ˆæ˜¯æ¸è¿›å¼æ¡†æ¶vuejsåªæ˜¯ä¸€ä¸ªæ ¸å¿ƒåº“ï¼Œå¯ä»¥é€šè¿‡è¡¥å……æ’ä»¶çš„æ–¹å¼å°†åº”ç”¨è§„æ¨¡åŒ–ï¼Œæ¯”å¦‚é€šè¿‡è¡¥å……vue-routerå®ç°è·¯ç”±è·³è½¬ï¼Œè¡¥å……vuexå®ç°çŠ¶æ€é›†ä¸­ç®¡ç†ç­‰ã€‚ vueå¦‚ä½•è®¾ç½®ä»£ç†ç­”ï¼švue.config.jsï¼Œä»…åœ¨å¼€å‘ç¯å¢ƒä¸‹æœ‰æ•ˆ module.exports = devServer: proxy:http://localhost:4000 æ‰“åŒ…è·¯å¾„å’Œè·¯ç”±æ¨¡å¼ï¼ˆvueé¡¹ç›®æ‰“åŒ…å®Œä¹‹åå‡ºç°ç©ºç™½é¡µï¼Œå¦‚ä½•è§£å†³ï¼‰ç­”ï¼š å…³äºè·¯å¾„ï¼šæ‰“åŒ…ä¹‹åï¼Œèµ„æºé»˜è®¤æ ¹è·¯å¾„ä¸ºç»å¯¹è·¯å¾„ï¼Œéœ€è¦ä¿®æ”¹ä¸ºç›¸å¯¹è·¯å¾„ï¼š module.exports = publicPath:./ å…³äºè·¯ç”±æ¨¡å¼ éœ€è¦ä¿®æ”¹ä¸ºhashæ¨¡å¼ï¼Œç”±å‰ç«¯æ§åˆ¶è·¯ç”±è·³è½¬ å…³äºæ¨¡å¼å’Œç¯å¢ƒå˜é‡ å¼€å‘ç¯å¢ƒ .env.development ç”Ÿäº§ç¯å¢ƒ .env.production ä»€ä¹ˆæ˜¯MVVM Model æ•°æ® View ç•Œé¢ä¸­å±•ç¤ºçš„å†…å®¹ View-Model è§†å›¾å’Œæ•°æ®çš„äº¤äº’ï¼Œä¹Ÿå°±æ˜¯vueæºç å®ç°çš„åŠŸèƒ½ vueæºç æ¨¡æ¿è§£ædiv id=app h1str/h1 str/divscript type=text/javascript new Vue( el:#app, data: str:hello )/script class Vue constructor(options) this.$data = options.data this.$el = document.querySelector(options.el) this.compile(this.$el) compile(node) node.childNodes.forEach((item,index)= // å…ƒç´ èŠ‚ç‚¹ if(item.nodeType == 1) this.compile(item) // æ–‡æœ¬èŠ‚ç‚¹ if(item.nodeType == 3) let reg = /\\\\(.*?)\\]|/g let text = item.textContent item.textContent = text.replace(reg,(match, vmKey)= vmKey = vmKey.trim() // è¿”å›dataä¸Šçš„æ•°æ® return this.$data[vmKey] ) ) ç”Ÿå‘½å‘¨æœŸdiv id=app h1str/h1 str/divscript type=text/javascript new Vue( el:#app, data: str:hello , beforeCreate(), created(), beforeMount(), mounted(), )/script class Vue constructor(options) if(typeof options.beforeCreate == function) options.beforeCreate.bind(this)() this.$data = options.data if(typeof options.created == function) options.created.bind(this)() if(typeof options.beforeMount == function) options.beforeMount.bind(this)() this.$el = document.querySelector(options.el) this.compile(this.$el) if(typeof options.mounted == function) options.mounted.bind(this)() æ·»åŠ äº‹ä»¶div id=app button @click=handleClickbtn/button/divscript type=text/javascript new Vue( el:#app, data:, methods: handleClick() )/script class Vue constructor(options) this.options = options this.$data = options.data this.$el = document.querySelector(options.el) this.compile(this.$el) compile(node) if(item.nodeType == 1) if(item.hasAttribute(@click)) const event = item.getAttribute(@click).trim() item.addEventListener(click,()= this.options.method[event]() ) dataåŠ«æŒ vueå¤§å¯¹è±¡å±æ€§æ¥è‡ªäºdataä¸­ dataä¸­å±æ€§ä¸vueå¤§å¯¹è±¡å±æ€§ä¿æŒåŒå‘ï¼ˆåŠ«æŒï¼‰ div id=app button @click=handleClickstr/button/divscript type=text/javascript new Vue( el:#app, data: str:hello , methods: handleClick() console.log(this.str) )/script class Vue constructor(options) this.options = options this.$data = options.data this.proxyData() this.$el = document.querySelector(options.el) this.compile(this.$el) proxyData() for(let key in this.$data) Object.defineProperties(this,key, get() return this.$data[key] , set(value) this.$data[key] = value ) æ›´æ–°è§†å›¾ é€šè¿‡ä¸€ä¸ªç›‘å¬è¡¨æ¥å­˜å‚¨å¯¹æ•°æ®è¿›è¡Œè®¢é˜…çš„è§†å›¾å…ƒç´  // ç›‘å¬å¯¹è±¡ç±»å‹class Watch constructor(vm, key, node, attr) // å¯¹è±¡ this.vm = vm // å±æ€§åç§° this.key = key // èŠ‚ç‚¹ this.node = node // å­—ç¬¦ä¸² this.attr = attr update() this.node[this.attr] = this.vm[this.key] class Vue observer() for(let key in this.$data) let value = this.$data[key] let thiat = this Object.defineProperty(this.$data,key, get() return value , set(value) value = val // æ›´æ–°æ¯ä¸ªè®¢é˜…å™¨ if(that.$watchEvent[key]) that.$watchEvent[key].forEach(item= item.update() ) ) v-modelåŒå‘ç»‘å®šåŸç† é€šè¿‡Object.definePropertyåŠ«æŒæ•°æ®å‘ç”Ÿçš„æ”¹å˜ setä¸­æ•°æ®è¢«æ”¹å˜ï¼Œè§¦å‘å¯¹æ•°æ®è¿›è¡Œç›‘å¬çš„èŠ‚ç‚¹çš„updateæ–¹æ³•æ›´æ–°èŠ‚ç‚¹å†…å®¹ åœ¨ä¸Šé¢å¯¹vueæ¨¡ç‰ˆè¿›è¡Œè§£æçš„æ–¹æ³•é‡Œï¼Œç»§ç»­åˆ¤æ–­æ˜¯å¦å­˜åœ¨v-modelå±æ€§ï¼š class Vue compile() if(item.hasAttribute(v-model)) let vmKey = item.getAttribute(v-model) if(this.hasOwnProperty(vmKey)) item.value = this[vmKey] item.addEventListener(input,(event)= this[vmKey] = item.value ) diffç®—æ³• åŠŸèƒ½ï¼šæå‡æ€§èƒ½ è™šæ‹Ÿdomï¼šæŠŠdomæ•°æ®åŒ– é€šè¿‡hå‡½æ•°ä¼ å…¥åˆ°vnodeç”Ÿæˆçš„æ•°æ®ç»“æ„ snabbdom è™šæ‹ŸèŠ‚ç‚¹æ“ä½œåº“ é€šè¿‡æ•°æ®ï¼ˆè™šæ‹Ÿdomï¼‰æ¥æ“ä½œdom /** åˆ›å»ºä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ children: undefined, data:, elm:h1, key: undefined, sel:h1, text:ä½ å¥½h1 å¯¹åº”çš„çœŸå®èŠ‚ç‚¹ï¼š h1ä½ å¥½h1/h1**/const vnode = h(h1,,ä½ å¥½h1) èŠ‚ç‚¹æ›¿æ¢è§„åˆ™ï¼š æ²¡æœ‰ç”¨keyè¿›è¡Œæ ‡è¯†çš„èŠ‚ç‚¹ï¼Œæ¯æ¬¡éƒ½è¦åˆ é™¤åé‡æ–°åˆ›å»º å³ä¾¿æ˜¯ç”¨keyè¿›è¡Œè¿‡æ ‡è¯†ï¼ŒèŠ‚ç‚¹ç±»å‹ä¹Ÿéœ€è¦ç›¸åŒ ä¸èƒ½è¶Šçº§æ¯”è¾ƒ æ‰‹å†™ç”Ÿæˆè™šæ‹Ÿdomçš„hå‡½æ•°hå‡½æ•°ï¼ˆç”Ÿæˆvnodeå¯¹è±¡ï¼‰ï¼š /** * h(h1,,ä½ å¥½h1) * @param sel æ ‡ç­¾ç±»å‹ * @param data æ•°æ® * @param params */export default function(sel, data, params) if( typeof params == string ) return vnode(sel, data, undefined,params,undefined) else if(Array.isArray(params)) // å­˜åœ¨å­å…ƒç´  let children = [] for(let item of params) children.push(item) return vnode(sle,data,children,undefined,undefined) æ‰‹å†™patchè°ƒç”¨å½¢å¼ï¼š patch(oldVNode, newVNode) patchæ‰§è¡Œä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿2ä¸ªèŠ‚ç‚¹éƒ½æ˜¯è™šæ‹ŸèŠ‚ç‚¹ å¦‚æœæ—§èŠ‚ç‚¹ä¸æ˜¯è™šæ‹ŸèŠ‚ç‚¹ï¼Œéœ€è¦é‡æ–°åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ åˆ¤æ–­æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ å¦‚æœä¸æ˜¯ï¼Œåˆ™æš´åŠ›æ›¿æ¢ åˆ¤æ–­æ–°èŠ‚ç‚¹å†…å®¹æ˜¯æ–‡æœ¬è¿˜æ˜¯å­èŠ‚ç‚¹ï¼ˆä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼‰ æ˜¯æ–‡æœ¬ï¼Œç›´æ¥æ›¿æ¢ä¸ºæ–‡æœ¬å†…å®¹ åˆ¤æ–­æ—§èŠ‚ç‚¹å†…å®¹æ˜¯æ–‡æœ¬è¿˜æ˜¯å­èŠ‚ç‚¹ï¼ˆæ–°èŠ‚ç‚¹å†…å®¹æ˜¯å­èŠ‚ç‚¹ï¼‰ æ˜¯æ–‡æœ¬ï¼Œç›´æ¥æ›¿æ¢ä¸ºæ–°èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ éæ–‡æœ¬ï¼Œéœ€è¦ä½¿ç”¨diffæ ¸å¿ƒç®—æ³• export default function(oldVnode, newVnode) if(oldVnode.sel == undefined) // oldVnodeä¸æ˜¯è™šæ‹ŸèŠ‚ç‚¹æ—¶ oldVnode = vnode( oldVode.tagName.toLowerCase(), ,[],undefined,oldVnode ) if(oldVnode.sel === newVnode.sel) // æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ if(newVnode.children === undefined) // æ–°èŠ‚ç‚¹æ²¡æœ‰children if(newVnode.text !== oldVnode.text) // æ–‡æœ¬ä¸åŒæ—¶ï¼Œä»…æ›¿æ¢æ–‡æœ¬ oldVnode.elm.innerText = newVnode.text else // æ–°èŠ‚ç‚¹æœ‰children if(oldVnode.children !== undefined) // æ—§èŠ‚ç‚¹æœ‰children else // æ—§èŠ‚ç‚¹æ²¡æœ‰children oldVnode.elm.innerHTML = for(let child of newVnode.children) let childDom = createElement(child) oldVnode.elm.appendChild(childDom) else // ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæš´åŠ›æ›¿æ¢ï¼Œåˆ é™¤æ—§èŠ‚ç‚¹ï¼Œåˆ›å»ºæ’å…¥æ–°èŠ‚ç‚¹ // åˆ›å»ºæ–°èŠ‚ç‚¹ let newVnodeElm = createElement(newVnode) // æ’å…¥æ–°èŠ‚ç‚¹ oldVnode.elm.parentNode.insert(newVnode) // åˆ é™¤æ—§èŠ‚ç‚¹ oldVnode.elm.parentNode.removeChild() diffç®—æ³• diffç®—æ³•æ˜¯ä¸ªæ·±åº¦ä¼˜å…ˆç®—æ³• å½“patchä¸­ï¼Œéœ€è¦å¯¹æ–°æ—§å…ƒç´ çš„å­èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒæ›¿æ¢æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°æ ¸å¿ƒdiffç®—æ³•ï¼Œdiffç®—æ³•é¦–å…ˆåœ¨æ–°æ—§èŠ‚ç‚¹æ•°ç»„å¤´å°¾å¤„åˆ†åˆ«è®¾ç½®æŒ‡é’ˆï¼Œç„¶åæŒ‰ç…§ä¸‹é¢é¡ºåºè¿›è¡Œæ¯”è¾ƒï¼š æ—§èŠ‚ç‚¹å¤´æŒ‡é’ˆå’Œæ–°èŠ‚ç‚¹å¤´æŒ‡é’ˆå…ƒç´ æ¯”è¾ƒ å¦‚æœåŒ¹é…ï¼Œæ–°æ—§å¤´æŒ‡é’ˆåç§» æ–°æ—§å°¾æŒ‡é’ˆæ¯”è¾ƒ å¦‚æœåŒ¹é…ï¼Œæ–°æ—§å°¾æŒ‡é’ˆå‰ç§» æ—§å¤´æŒ‡é’ˆå’Œæ–°å°¾æŒ‡é’ˆæ¯”è¾ƒ å¦‚æœåŒ¹é…ï¼Œæ—§å¤´æŒ‡é’ˆåç§»ï¼Œæ–°å°¾æŒ‡é’ˆå‰ç§» æ—§å°¾æŒ‡é’ˆå’Œæ–°å¤´æŒ‡é’ˆæ¯”è¾ƒ å¦‚æœåŒ¹é…ï¼Œæ—§å°¾æŒ‡é’ˆå‰ç§»ï¼Œæ–°å¤´æŒ‡é’ˆåç§» ä»¥ä¸Šéƒ½ä¸æ»¡è¶³ï¼Œè¿›è¡ŒæŸ¥æ‰¾ åˆ›å»ºæˆ–åˆ é™¤ æ˜é‡‘å›ç­” åŸè´´é¦–å…ˆï¼Œæˆ‘ä»¬æ‹¿åˆ°æ–°æ—§èŠ‚ç‚¹çš„æ•°ç»„ï¼Œç„¶ååˆå§‹åŒ–å››ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘æ–°æ—§èŠ‚ç‚¹çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œ è¿›è¡Œä¸¤ä¸¤å¯¹æ¯”ï¼Œè‹¥æ˜¯ æ–°çš„å¼€å§‹èŠ‚ç‚¹å’Œæ—§å¼€å§‹èŠ‚ç‚¹ç›¸åŒï¼Œåˆ™éƒ½å‘åé¢ç§»åŠ¨ï¼Œè‹¥æ˜¯ç»“å°¾èŠ‚ç‚¹ç›¸åŒ¹é…ï¼Œåˆ™éƒ½å‰ç§»æŒ‡é’ˆã€‚è‹¥æ˜¯æ–°å¼€å§‹èŠ‚ç‚¹å’Œæ—§ç»“å°¾èŠ‚ç‚¹åŒ¹é…ä¸Šäº†ï¼Œåˆ™ä¼šå°†æ—§çš„ç»“æŸèŠ‚ç‚¹ç§»åŠ¨åˆ°æ—§çš„å¼€å§‹èŠ‚ç‚¹å‰ã€‚è‹¥æ˜¯æ—§å¼€å§‹èŠ‚ç‚¹å’Œæ–°çš„ç»“æŸèŠ‚ç‚¹ç›¸åŒ¹é…ï¼Œåˆ™ä¼šå°†æ—§å¼€å§‹èŠ‚ç‚¹ç§»åŠ¨åˆ°æ—§ç»“æŸèŠ‚ç‚¹çš„åé¢ã€‚è‹¥æ˜¯ä¸Šè¿°èŠ‚ç‚¹éƒ½æ²¡é…æœ‰åŒ¹é…ä¸Šï¼Œåˆ™ä¼šè¿›è¡Œä¸€ä¸ªå…œåº•é€»è¾‘çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å¼€å§‹èŠ‚ç‚¹æ˜¯å¦åœ¨æ—§èŠ‚ç‚¹ä¸­ï¼Œè‹¥æ˜¯å­˜åœ¨åˆ™å¤ç”¨ï¼Œè‹¥æ˜¯ä¸å­˜åœ¨åˆ™åˆ›å»ºã€‚æœ€ç»ˆè·³å‡ºå¾ªç¯ï¼Œè¿›è¡Œè£å‰ªæˆ–è€…æ–°å¢ï¼Œè‹¥æ˜¯æ—§çš„å¼€å§‹èŠ‚ç‚¹å°äºæ—§çš„ç»“æŸèŠ‚ç‚¹ï¼Œåˆ™ä¼šåˆ é™¤ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œåä¹‹åˆ™æ˜¯æ–°å¢æ–°çš„å¼€å§‹èŠ‚ç‚¹åˆ°æ–°çš„ç»“æŸèŠ‚ç‚¹ã€‚"},{"title":"uniapp","path":"/wiki/Job/front_03_uniapp.html","content":"uniappè°ˆè°ˆuni-appçš„ç†è§£ä¸€ä¸ªä½¿ç”¨vuejså¼€å‘çš„å‰ç«¯åº”ç”¨æ¡†æ¶ï¼Œå¼€å‘è€…åªè¦ç¼–å†™ä¸€å¥—ä»£ç ï¼Œå°±å¯ä»¥å‘å¸ƒåˆ°IOSã€Androidã€Webã€å°ç¨‹åºç­‰å¹³å° uniappå¦‚ä½•ä¸ºä¸åŒå¹³å°è®¾ç½®ä¸åŒä»£ç ä½¿ç”¨æ¡ä»¶æ³¨é‡Šï¼š###ifdef ###ifndef uniappä¸­å°è£…æ¥å£è¯·æ±‚ç›¸è¾ƒäºå¾®ä¿¡å°ç¨‹åºæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„uniappå’Œå¾®ä¿¡å°ç¨‹åºéƒ½æä¾›äº†ç½‘ç»œè¯·æ±‚apiuniappä¸ºäº†å®ç°å¤¸ç«¯å…¼å®¹ï¼Œéœ€è¦æ³¨æ„ç½‘ç»œè¯·æ±‚è·¨åŸŸé—®é¢˜å¾®ä¿¡å°ç¨‹åºä¸ä¼šå‡ºç°è·¨åŸŸé—®é¢˜uniappçš„è·¨åŸŸé—®é¢˜å¯ä»¥é€šè¿‡åœ¨vue.config.jsä¸­é…ç½®proxyä»£ç†è§£å†³ uniappä¸­çš„ç”Ÿå‘½å‘¨æœŸåº”ç”¨ç”Ÿå‘½å‘¨æœŸonLaunch åˆå§‹åŒ–å®Œæˆæ—¶è§¦å‘ï¼Œåªè§¦å‘ä¸€æ¬¡onShow uniappä»åå°è¿›å…¥å‰å°æ—¶æ˜¾ç¤ºonHide uniappä»å‰å°è¿›å…¥åå°æ˜¾ç¤ºonError æŠ¥é”™onExit ç›‘å¬åº”ç”¨é€€å‡ºonUNiNViewMessage å¯¹nvueé¡µé¢å‘é€çš„æ•°æ®è¿›è¡Œç›‘å¬onUnhandleRejection å¯¹æœªå¤„ç†çš„Promiseæ‹’ç»äº‹ä»¶ç›‘å¬å‡½æ•°onPageNotFound é¡µé¢æœªæ‰¾åˆ°onThemeChange ç›‘å¬ç³»ç»Ÿä¸»é¢˜é¡µé¢ç”Ÿå‘½å‘¨æœŸonInit ç›‘å¬é¡µé¢åˆå§‹åŒ–onLoad ç›‘å¬é¡µé¢åŠ è½½ï¼Œå‚æ•°ä¸ºä¸Šä¸ªé¡µé¢ä¼ é€’çš„æ•°æ®onShow ç›‘å¬é¡µé¢æ˜¾ç¤ºonReady ç›‘å¬é¡µé¢åˆæ¬¡æ¸²æŸ“onHide ç›‘å¬é¡µé¢éšè—onUnload ç›‘å¬é¡µé¢éšè—onResize ç›‘å¬çª—å£å°ºå¯¸å˜åŒ–onPullDownRefresh ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åŠ¨ä½œonReachBottom ç›‘å¬é¡µé¢æ»šåŠ¨åˆ°åº•éƒ¨onPageScroll ç›‘å¬é¡µé¢æ»šåŠ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸbeforeCreatecreatedbeforeMountmountedbeforeUpdateupdatedbeforeDestroydestroyed uniappçš„é…ç½®æ–‡ä»¶éƒ¨åˆ† uniCloud äº‘ç©ºé—´ç›®å½• componnets ç»„ä»¶ç›®å½• hybrid Appç«¯å­˜æ”¾æœ¬åœ°htmlæ–‡ä»¶çš„ç›®å½• platforms å­˜æ”¾å„å¹³å°ä¸“ç”¨é¡µé¢çš„ç›®å½• pages ä¸šåŠ¡é¡µé¢å­˜æ”¾ç›®å½• static æœ¬åœ°é™æ€èµ„æº uni_modules å­˜æ”¾uni_modulesçš„è§„èŒƒæ’ä»¶ wxcompnents å­˜æ”¾å°ç¨‹åºç»„ä»¶çš„ç›®å½• main.js vueåˆå§‹åŒ–å…¥å£æ–‡ä»¶ App.vue é…ç½®å…¨å±€æ ·å¼åŠç›‘å¬ manifest.json é…ç½®åº”ç”¨åç§°ï¼Œappidã€logoã€ç‰ˆæœ¬ç­‰æ‰“åŒ…ä¿¡æ¯ page.json é…ç½®é¡µé¢è·¯ç”±ï¼Œå¯¼èˆªæ¡ï¼Œé€‰é¡¹å¡ç­‰é¡µé¢ç±»ä¿¡æ¯ uni.scss uni-appå†…ç½®çš„å¸¸ç”¨æ ·å¼å˜é‡ uniappä¸­çš„æœ¬åœ°ç¼“å­˜ åŒæ­¥å­˜å‚¨ uni.setStorageSync uni.getStorageSync å¼‚æ­¥å­˜å‚¨ uni.setStorage uni.getStorage uni-appè·¯ç”±ä¸è·³è½¬ uni.navigateTo è·³è½¬é¡µé¢ uni.redirect é”€æ¯å½“å‰é¡µé¢è·³è½¬åˆ°æŒ‡å®šé¡µé¢ uni.switchTab è·³è½¬è‡³tabé¡µé¢ uni.reLaunch é”€æ¯æ‰€æœ‰é¡µé¢è·³è½¬è‡³æŒ‡å®šé¡µé¢ uni.navigateBack è¿”å›ä¸Šä¸€é¡µ exit æ¨å‡ºå°ç¨‹åºï¼Œtargetâ€miniProgramâ€æ—¶ç”Ÿæ•ˆ uniappä¸­ï¼Œå¦‚ä½•ä½¿ç”¨åŸç”ŸSDKä»¥åŠæ’ä»¶ å¯ä»¥é€šè¿‡uni-app plusçš„æ–¹å¼æ¥é›†æˆåŸç”ŸSDKå’Œæ’ä»¶ å®ç°çš„å…·ä½“æ–¹æ³•æ˜¯ï¼šåœ¨manifest.jsonæ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„æ’ä»¶è®¾ç½® å¹¶åœ¨ä»£ç ä¸­è°ƒç”¨ç›¸å…³APIä½¿ç”¨å†…ç½®çš„SDKå’Œæ’ å¾®ä¿¡å°ç¨‹åºå°ç¨‹åºå¦‚ä½•å®ç°æ”¯ä»˜ä»¥å…¬å¸èº«ä»½æ³¨å†Œä¸€ä¸ªå°ç¨‹åºç»‘å®šå•†æˆ·å·å°ç¨‹åºå¡«å†™åˆæ³•åŸŸwx.login()codeè°ƒç”¨wx.requestPayment å°ç¨‹åºè°ƒç”¨å¾®ä¿¡æ¥å£æœåŠ¡ wx.loginè·å–codewx.requestå‘é€codeé€šè¿‡appidã€appsecretã€codeæ ¡éªŒæ¥å£è·å–åˆ°è¿”å›çš„session_keyå’ŒopenIdç­‰è‡ªå®šä¹‰ç™»å½•æ€ï¼Œä¸openidã€session_keyå…³è”è¿”å›è‡ªå®šä¹‰ç™»å½•æ€è‡ªå®šä¹‰ç™»å½•æ€å­˜å…¥storagewx.requestå‘èµ·ä¸šåŠ¡è¯·æ±‚ï¼Œæºå¸¦è‡ªå®šä¹‰ç™»å½•æ€é€šè¿‡è‡ªå®šä¹‰ç™»å½•æ€æŸ¥è¯¢openidå’Œsession_keyè¿”å›ä¸šåŠ¡æ•°æ®"},{"title":"react","path":"/wiki/Job/front_04_react.html","content":"Reactç‰¹æ€§reactæœ‰ä»€ä¹ˆç‰¹ç‚¹ ä½¿ç”¨è™šæ‹Ÿdom å¯ä»¥è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ éµå¾ªå•å‘æ•°æ®æµæˆ–æ•°æ®ç»‘å®š å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå—æ§ç»„ä»¶ï¼šåªèƒ½é€šè¿‡Reactä¿®æ”¹æ•°æ®æˆ–çŠ¶æ€çš„ç»„ä»¶éå—æ§ç»„ä»¶ï¼šå¦‚inputã€textareaã€selectç­‰è¡¨å•ç»„ä»¶æ§ä»¶è‡ªèº«å°±èƒ½æ§åˆ¶æ•°æ®å’ŒçŠ¶æ€ React ç»„ä»¶ä¸­ç»‘å®šä¸€ä¸ªäº‹ä»¶è·Ÿç›´æ¥æ“ä½œ DOM ç»‘å®šä¸€ä¸ªäº‹ä»¶æœ‰ä»€ä¹ˆå·®åˆ«å‚è€ƒåšå®¢ ç»‘å®šæ–¹å¼ä¸åŒReactä½¿ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶ï¼Œå°†æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨æŒ‚è½½åœ¨æ ¹èŠ‚ç‚¹æˆ–é¡¶å±‚çš„å®¹å™¨ä¸Šï¼Œé€šè¿‡äº‹ä»¶å†’æ³¡æ•è·äº‹ä»¶åªæœ‰ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨è´Ÿè´£ç›‘å¬ç”±Reactè‡ªè¡Œåˆ†å‘äº‹ä»¶å¹¶è°ƒç”¨ç›¸å¯¹åº”çš„äº‹ä»¶å¤„ç†é€»è¾‘Domçš„äº‹ä»¶ç›‘å¬å™¨ç›´æ¥ç»‘å®šåˆ°ç‰¹å®šçš„domå…ƒç´ ä¸Šå¯¹å¤šä¸ªå…ƒç´ ç»‘å®šäº‹ä»¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„ç›‘å¬å™¨æ€§èƒ½ä¸åŒReactï¼šå‡å°‘äº‹ä»¶ç›‘å¬å™¨ï¼Œæ›´èŠ‚çœå†…å­˜åŸç”Ÿdomï¼šå†…å­˜æ¶ˆè€—è¾ƒé«˜äº‹ä»¶å¯¹è±¡Reactï¼šåˆæˆäº‹ä»¶å¯¹è±¡domï¼šåŸç”Ÿäº‹ä»¶å¯¹è±¡è·¨å¹³å°ä¸å…¼å®¹æ€§Reactï¼šè·¨å¹³å°ç»Ÿä¸€æ¥å£domï¼šä»…é™webæµè§ˆå™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†reactï¼šè‡ªåŠ¨æ¸…ç†äº‹ä»¶domï¼šéœ€è¦æ‰‹åŠ¨æ¸…ç†äº‹ä»¶ä¼˜å…ˆçº§reactï¼šé«˜ä¼˜å…ˆçº§äº‹ä»¶å¯ä»¥ä¼˜å…ˆå¤„ç†domï¼šæŒ‰äº‹ä»¶è§¦å‘é¡ºåºé€ä¸€å¤„ç† ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æœ‰å“ªäº›ï¼Ÿconstructor åˆå§‹åŒ–çŠ¶æ€å’Œç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¯ä»¥å°†useStateé’©å­ç”¨äºç±»ä¼¼çš„ç›®çš„renderè´Ÿè´£æ¸²æŸ“jsxæ ‡è®°å¹¶è¿”å›è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹componentDidMountç»„ä»¶åœ¨Domä¸­æ¸²æŸ“åç«‹å³æ‰§è¡Œæ­¤æ–¹æ³•å¸¸ç”¨äºåˆå§‹åŒ–ä»»åŠ¡componentDidUpdateå½“ç»„ä»¶çš„propsæˆ–stateæ”¹å˜æ—¶è°ƒç”¨æ­¤æ–¹æ³•å…è®¸æ‰§è¡Œå‰¯ä½œç”¨componentWillUnmountç»„ä»¶ä»domä¸­åˆ é™¤ä¹‹å‰ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ç”¨äºæ¸…é™¤äº‹ä»¶ä¾¦å¬å™¨æˆ–è€…å–æ¶ˆè®¡æ—¶å™¨ç­‰æ“ä½œ Reactæ€§èƒ½ä¼˜åŒ–Reactæºç React Hookå¸¸ç”¨çš„React Hookæœ‰å“ªäº›ï¼Ÿ useState ç®¡ç†ç»„ä»¶çŠ¶æ€ useEffect æ‰§è¡Œç»„ä»¶å‰¯ä½œç”¨ï¼Œæ¯”å¦‚è·å–æ•°æ®æˆ–è€…è®¢é˜…äº‹ä»¶ useContext è·å–ç»„ä»¶ä¸Šä¸‹æ–‡å€¼ useRef è·å–ç»„ä»¶domå®ä½“ useCallback å¯¹å‡½æ•°ç¼“å­˜ï¼Œé˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ useMemo å¯¹å€¼ç¼“å­˜ï¼Œé˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ useReducer é€šè¿‡reducerå‡½æ•°ç®¡ç†çŠ¶æ€ï¼Œç±»ä¼¼äºReduxå·¥ä½œåŸç† useLayoutEffect å¯¹useCallbackã€useMemoè¿™2ä¸ªhookçš„ç«‹å³ï¼Œæœ‰ä»€ä¹ˆæ ·çš„åŒºåˆ«ï¼Œé€‚åˆåœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹ä½¿ç”¨å‚è€ƒåšå®¢ æ˜¯ä¸æ˜¯æ‰€æœ‰å˜é‡æˆ–å‡½æ•°éƒ½éœ€è¦ç”¨åˆ°è¿™ä¸¤ä¸ªhookè¿›è¡ŒåŒ…è£¹ ä¸æ˜¯æ‰€æœ‰å˜é‡æˆ–å‡½æ•°éƒ½éœ€è¦ä½¿ç”¨è¿™ä¸¤ä¸ªhookè¿›è¡ŒåŒ…è£¹ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸»è¦æ˜¯ä¼˜åŒ–æ€§èƒ½ï¼Œä¸»è¦é’ˆå¯¹é‚£äº›æ€§èƒ½æŸè€—çš„è®¡ç®—æˆ–å‡½æ•°ï¼Œæ²¡æœ‰æŸè€—çš„å˜é‡æˆ–è€…å‡½æ•°æ˜¯ä¸éœ€è¦åŒ…è£¹ åŒ…è£¹åæ€§èƒ½ä¸€å®šä¼šå¥½å—ï¼Ÿ ä¸ä¸€å®šï¼Œå–å†³äºå…·ä½“æƒ…å†µuseCallbackç”¨äºç¼“å­˜å‡½æ•°ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°çš„å‡½æ•°å®ä¾‹å½“å‡½æ•°è¢«çˆ¶ç»„ä»¶ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å­ç»„ä»¶æ—¶ï¼Œå‡½æ•°å®ä¾‹çš„é‡æ–°åˆ›å»ºä¼šè§¦å‘å­ç»„ä»¶é‡æ–°æ¸²æŸ“useCallbackå¯ä»¥ç¡®ä¿ç›¸åŒçš„å‡½æ•°å®ä¾‹åœ¨ç›¸åŒçš„ä¾èµ–é¡¹ä¸‹ä¿æŒä¸å˜useMemoç”¨äºç¼“å­˜å€¼ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—åœ¨ä¾èµ–é¡¹ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿”å›å€¼çš„ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œæé«˜äº†æ€§èƒ½æ— éœ€ä½¿ç”¨useMemoå’ŒuseCallbackçš„æƒ…å†µï¼šä¾èµ–é¢‘ç¹å˜åŒ–å€¼æˆ–å‡½æ•°è½»é‡ä¸”ä¸é¢‘ç¹å˜åŒ–ç»„ä»¶ä¸ä¼šé¢‘ç¹é‡æ¸²æŸ“è®¡ç®—é‡æœ¬èº«è¾ƒå° æœ‰æ²¡æœ‰æ›´åº•å±‚ä¸€ç‚¹çš„ç†è§£ï¼Ÿ æ›´åº•å±‚çš„ç†è§£æ˜¯ï¼ŒuseCallback å’Œ useMemo çš„åŸç†éƒ½æ˜¯åŸºäº memoizationï¼ˆè®°å¿†åŒ–ï¼‰æŠ€æœ¯ã€‚å®ƒä»¬åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¼šæ ¹æ®ä¾èµ–é¡¹çš„å˜åŒ–ï¼Œåˆ¤æ–­æ˜¯å¦é‡æ–°è®¡ç®—å‡½æ•°æˆ–å€¼ã€‚å½“ä¾èµ–é¡¹ä¸å˜æ—¶ï¼Œä¼šç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œæé«˜äº†æ€§èƒ½ã€‚ ReduxReact-Router"},{"title":"é¢è¯•æŠ€å·§","path":"/wiki/Job/front_05_trick.html","content":"é¢è¯•å‡†å¤‡å¦‚ä½•å‡†å¤‡å¥½å‰ç«¯é¢è¯•ï¼Œå¦‚ä½•è®°å¿†åºå¤§çš„å‰ç«¯é¢è¯•é¢˜åº“ï¼Ÿ ç†è§£åŸç† å»ºç«‹çŸ¥è¯†ä½“ç³» ç¬”è®°æ•´ç† å®æˆ˜æ¼”ç»ƒ æ¨¡æ‹Ÿç»ƒå¸‚ æŒç»­è¿­ä»£ å½’çº³æ€»ç»“ å¿ƒç†å»ºè®¾ï¼Œæ›´çœ‹é‡æ€è·¯æŠ€å·§ è‡ªæˆ‘ä»‹ç»ï¼ˆä¸šåŠ¡æŠ€æœ¯é¢ï¼‰é¢è¯•å®˜ä½ å¥½ï¼Œæˆ‘å«XXXï¼ŒXXå¹´æ¯•ä¸šäºXXXè®¡ç®—æœºä¸“ä¸šï¼Œæœ‰3å¹´å‰ç«¯å¼€å‘ç»éªŒï¼Œç†Ÿç»ƒæŒæ¡vueã€reactç­‰ä¸»æµæ¡†æ¶ï¼Œå¹¶ä¸”åœ¨PCç«¯ã€ç§»åŠ¨ç«¯å’Œæ¡Œé¢åº”ç”¨å¼€å‘ä¸­ç§¯ç´¯äº†ä¸å°‘é¡¹ç›®ç»éªŒï¼Œæ¶‰åŠå¯è§†åŒ–ã€2d3däº¤äº’ã€æ•°æ®åˆ†æã€åå°ç®¡ç†ç­‰é¢†åŸŸã€‚åœ¨è¿‡å»çš„å·¥ä½œä¸­ï¼Œæˆ‘å‚ä¸äº†å¤šä¸ªä»0åˆ°1çš„é¡¹ç›®å¼€å‘ã€‚å…¶ä¸­ï¼Œæœ‰åƒã€é«˜è½¨å«æ˜Ÿè½¨é“ç›‘æ§ç³»ç»Ÿã€‘è¿™ç±»å¤æ‚äº¤äº’å¯è§†åŒ–è½¯ä»¶ï¼Œä¹Ÿæœ‰ã€å¾çŸ¿é›†å›¢äººæ‰ä¸­å¿ƒä¸€ä½“åŒ–ã€‘è¿™ç±»æ¯”è¾ƒå¤§å‹çš„é¡¹ç›®ï¼Œæœ€è¿‘åšçš„é¡¹ç›®æ˜¯ä¸€æ¬¾ç¤¾äº¤åª’ä½“ç±»Appçš„å¼€å‘ï¼Œæˆ‘ä¸»è¦è´Ÿè´£åå°ç³»ç»Ÿå’Œh5å°æ¸¸æˆä¸ªäººä¼˜åŠ¿æ˜¯èƒ½å¤Ÿå°†æ•°æ®åˆ†æå’Œå¯è§†åŒ–ç›¸ç»“åˆï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„äº¤äº’ä½“éªŒæˆ‘å¹³æ—¶ä¼šæœ‰ç»´æŠ¤æŠ€æœ¯åšå®¢çš„ä¹ æƒ¯ï¼Œæ˜¯æˆ‘è‡ªæˆ‘å­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼Œèƒ½è®©æˆ‘ä¸æ–­åœ°æ€»ç»“å’Œåˆ†äº«ç»éªŒï¼Œéå¸¸æœŸå¾…èƒ½å¤ŸåŠ å…¥è´µå…¬å¸ï¼Œåœ¨ä¼˜ç§€çš„å›¢é˜Ÿä¸­ç»§ç»­æå‡è‡ªå·±ï¼Œè°¢è°¢ HRé—®é¢˜è‡ªæˆ‘ä»‹ç»è‡ªæˆ‘ä»‹ç»å…¬å¼ å‚è€ƒæ–‡ç« è‡ªèº«èƒŒæ™¯é¡¹ç›®ä¸å²—ä½çš„åŒ¹é…åº¦é€‰æ‹©å…¬å¸çš„åŸå›  é¢è¯•å®˜ä½ å¥½ï¼Œæˆ‘å«XXï¼ŒXXå¹´æ¯•ä¸šäºXXXå¤§å­¦è®¡ç®—æœºä¸“ä¸šï¼Œæœ‰3å¹´å‰ç«¯å¼€å‘ç»éªŒï¼Œåœ¨è¿‡å»çš„å·¥ä½œä¸­ï¼Œæˆ‘ä¸»è¦è´Ÿè´£PCç«¯ã€ç§»åŠ¨ç«¯å’Œæ¡Œé¢åº”ç”¨çš„å‰ç«¯å¼€å‘ï¼Œå‚ä¸äº†å¤šä¸ªä»0åˆ°1çš„é¡¹ç›®ï¼Œç§¯ç´¯äº†ä¸°å¯Œçš„é¡¹ç›®å¼€å‘å’Œå›¢é˜Ÿåä½œç»éªŒã€‚å¹³æ—¶æœ‰ä¹¦å†™æŠ€æœ¯åšå®¢çš„ä¹ æƒ¯ï¼Œæ˜¯æˆ‘è‡ªæˆ‘å­¦ä¹ ã€å’Œå›¢é˜Ÿåˆ†äº«ç»éªŒçš„ä¸€ç§æ–¹å¼æˆ‘çš„ä¸Šä¸€ä»½å·¥ä½œæ˜¯å‚ä¸ä¸€æ¬¾ç¤¾äº¤åª’ä½“ç±»äº¤å‹Appçš„å¼€å‘ï¼Œä¸»è¦è´Ÿè´£åå°ç³»ç»Ÿï¼ŒAppç«¯3däº¤äº’ã€h5å°æ¸¸æˆçš„å¼€å‘å¯¹æˆ‘ä¸ªäººå½±å“æœ€æ·±çš„ï¼Œæ˜¯åœ¨åŒ—äº¬å›½é¥ä»»èŒwebgiså‰ç«¯å·¥ç¨‹å¸ˆçš„ç»å†ï¼Œåœ¨è¿™æ®µæœŸé—´ï¼Œæˆ‘è·Ÿç€å‰è¾ˆå­¦ä¹ äº†ä¸€äº›å›¾å½¢å­¦åŸºç¡€ä¸3dæŠ€æœ¯ï¼Œå‘ç°äº†è‡ªå·±å¯¹web3dä¸å¯è§†åŒ–æ–¹é¢çš„å…´è¶£ä¹‹ååœ¨å¹¿è”ç§‘æŠ€ä¸»è¦è´Ÿè´£å…¬å¸å†…å¯è§†åŒ–é¡¹ç›®çš„ç»„ç»‡å’Œå¼€å‘æˆ‘äº†è§£åˆ°å’±ä»¬å…¬å¸ä¸»è¦æ˜¯åšå®¶å…·è¡Œä¸šè½¯ä»¶çš„ï¼Œå¹¶ä¸”äº§å“çš„å£ç¢‘éƒ½ç›¸å½“ä¸é”™ï¼Œåœ¨web3dè½¯ä»¶å¼€å‘æ–¹é¢ä¹Ÿæ˜¯å›½å†…æ¯”è¾ƒæˆç†Ÿçš„ï¼Œæ‰€ä»¥éå¸¸å¸Œæœ›èƒ½å¤ŸåŠ å…¥è´µå…¬å¸ï¼Œåœ¨ä¼˜ç§€çš„å›¢é˜Ÿä¸­æå‡è‡ªå·±ï¼Œæˆ‘çš„è‡ªæˆ‘ä»‹ç»ç»“æŸï¼Œè°¢è°¢ ç¦»èŒåŸå›  å¹´è½»å¤–åœ°å…¬å¸ï¼š å‡ºäºä¸ªäººèŒä¸šè§„åˆ’è€ƒè™‘ï¼Œå› ä¸ºå½“æ—¶å…¬å¸èŠ‚å¥æ¯”è¾ƒæ…¢ï¼Œè§‰å¾—åº”è¯¥è¿½æ±‚æ›´å…·æŒ‘æˆ˜çš„é¡¹ç›® çœ‹åˆ°äº†æ–°çš„æœºä¼šï¼Œå¯ä»¥æ¥è§¦åˆ°æ›´å‰æ²¿çš„æŠ€æœ¯å’Œä¸šåŠ¡é¢†åŸŸ æœ¬åœ°ä¼ ç»Ÿå…¬å¸ï¼š å·¥ä½œåœ°ç‚¹æ¬è¿ï¼Œç”±è½¯ä»¶å›­æ¬åˆ°äº†xxå®‰å…¨è°· åŸæœ¬åœ¨å¤–åœ°å·¥ä½œï¼Œå› ä¸ºå®¶åº­åŸå› éœ€è¦å›åˆ°XXæœ¬åœ°å·¥ä½œ é€šç”¨ï¼š å…¬å¸å›¢é˜Ÿè§£æ•£ éœ€è¦å®‰æ’é•¿æœŸå¼‚åœ°å‡ºå·®ï¼Œä¸ªäººä¸å¤ªèƒ½æ¥æ”¶å¤§å¹…åº¦é•¿æœŸçš„å·¥ä½œåœ°ç‚¹è°ƒåŠ¨ é¡¹ç›®ç›¸å…³å¯ä»¥ä»‹ç»ä¸€ä¸‹ã€é«˜è½¨å«æ˜Ÿæ€åŠ¿ã€‘è¿™ä¸ªé¡¹ç›®å—ç­”ï¼šè¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯é¢å‘èˆªå¤©æŒ‡æŒ¥éƒ¨é—¨å¼€å‘çš„ä¸€å¥—å†›å·¥è½¯ä»¶æˆ‘åœ¨å…¶ä¸­ä¸»è¦è´Ÿè´£çš„æ˜¯2dé«˜è½¨å«æ˜Ÿåœ°å›¾ç³»ç»Ÿçš„å¼€å‘éœ€è¦å°†åå°å®æ—¶æ¨é€çš„å«æ˜Ÿè½¨è¿¹ï¼Œè¿”æ˜¾åˆ°2dåœ°å›¾ä¸Šï¼Œç³»ç»Ÿä¼šæ ¹æ®è¿™äº›è½¨è¿¹ï¼Œæ¨ç®—å‡ºå¯èƒ½å‘ç”Ÿçš„æ„å¤–æƒ…å†µï¼šæ¯”å¦‚ä¼šé¢å«æ˜Ÿç¢°æ’ã€å«æ˜Ÿå˜è½¨ï¼Œå¹¶ä¸”è¿›è¡Œé¢„è­¦ï¼ŒæŒ‡æŒ¥å‘˜éœ€è¦æ ¹æ®é¢„è­¦è¿›è¡Œ3dä»¿çœŸï¼Œä¸ŠæŠ¥ç­‰ä¸€ç³»åˆ—åº”æ€¥æ“ä½œè¿™ä¸ªé¡¹ç›®ä½¿ç”¨Vueæ¡†æ¶è¿›è¡Œæ­å»ºã€å¯è§†åŒ–åœ°å›¾ä½¿ç”¨ECartsæ¸²æŸ“ï¼Œ3Däº¤äº’ä½¿ç”¨Cesiumå®ç°ï¼Œä¸åç«¯å’Œæ¡Œé¢ç«¯çš„è”åŠ¨ä½¿ç”¨Websocketå®ç°å¼€å‘å‘¨æœŸåŠå¹´å·¦å³ å¯ä»¥ä»‹ç»ä¸€ä¸‹ã€å¾çŸ¿é›†å›¢äººæ‰ä¸­å¿ƒä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‘è¿™ä¸ªé¡¹ç›®å—è¿™ä¸ªé¡¹ç›®ä¸»è¦æ˜¯ä¸ºå¾çŸ¿é›†å›¢åŸ¹è®­å®‰å…¨ç”Ÿäº§äººå‘˜æœåŠ¡çš„åŸ¹è®­ç±»å‹å¤šç§å¤šæ ·ï¼Œæ¯”å¦‚æœ‰é‡å·¥ä¸šæœºå™¨æ“ä½œã€ç”µæ°”æ“ä½œã€ç…¤çŸ¿æŒ–æ˜ä¸»è¦åˆ†ä¸ºå¤šä¸ªç³»ç»Ÿé¦–å…ˆæœ‰ä¸€ä¸ªé¢å‘å­¦å‘˜çš„é—¨æˆ·ç½‘ç«™ï¼ˆreactï¼‰ï¼Œç”¨äºä»‹ç»è¯¾ç¨‹ç›¸å…³ä¿¡æ¯ï¼Œä»¥åŠé›†å›¢æ–°é—»ç„¶åAppç«¯ä¸»è¦æ˜¯é¢å‘å­¦å‘˜çš„ï¼Œæ”¯æŒçº¿ä¸Šæ•™å­¦ã€æ¨¡æ‹Ÿç­”é¢˜ã€æ•™å¸ˆè”ç³»ã€è€ƒè¯•æŠ¥åç¼´è´¹ç­‰åŠŸèƒ½è€ƒè¯•ç³»ç»Ÿï¼Œåˆ™æ˜¯è€ƒè¯•æ—¶ä½¿ç”¨çš„æœºå™¨ï¼Œæœ‰ä¸€å¥—è€ƒè¯•ç•Œé¢ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œè§†é¢‘ç›‘æ§é€šè¿‡äººè„¸æ¯”å¯¹ï¼Œç¡®ä¿ç”¨æˆ·ä¸ä¼šä½œå¼Šåå°ç³»ç»Ÿï¼Œé¢å‘å‡ ä¸ªä¸»è¦è§’è‰²ï¼šç®¡ç†å‘˜ã€æ•™å¸ˆç®¡ç†å‘˜è´Ÿè´£ç³»ç»Ÿæ•°æ®ç›‘æ§ã€æ–°é—»å‘å¸ƒã€æ•°æ®æ¸…ç†ç­‰åŸºæœ¬å·¥ä½œæ•™å¸ˆè´Ÿè´£è¯¾ç¨‹ç®¡ç†ã€ç­çº§ç®¡ç†è¢«èµ‹äºˆçº¿ä¸Šè€ƒå®˜èº«ä»½çš„æ•™å¸ˆï¼Œè¿˜å¯ä»¥é€šè¿‡ç³»ç»Ÿç›‘æ§è€ƒè¯•æƒ…å†µï¼Œé˜²æ­¢è€ƒç”Ÿä½œå¼Šæœ€åè¿˜æœ‰å±•ç¤ºç”¨çš„å¯è§†åŒ–å¤§å±ï¼Œå¯¹æ•™å­¦æ•°æ®è¿›è¡Œç»Ÿè®¡å±•ç¤ºã€‚ å®é™…å¼€å‘ä¸­é‡åˆ°äº†å“ªäº›æŠ€æœ¯æŒ‘æˆ˜æˆ–è€…å›°éš¾å‘€ï¼Ÿåœ¨å¾å·å¹¿è”ç§‘æŠ€å…¬å¸æ—¶ï¼Œæˆ‘æ˜¯å¯è§†åŒ–å¼€å‘ç»„çš„è´Ÿè´£äººï¼Œå½“æ—¶å…¬å¸é‡Œæœ‰ä¸€ä¸ªç›‘æ§å¤§å±é¡¹ç›®ï¼Œåœ¨å³å°†ä¸Šçº¿æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„bugç”±äºå¤§å±é¡µé¢éœ€è¦åŒæ—¶å±•ç¤º8ä¸ªå®æ—¶ç›‘æ§ä½†æ˜¯å®é™…æ•ˆæœæ˜¯8ä¸ªç›‘æ§åªèƒ½æ˜¾ç¤º6ä¸ªæˆ‘å’Œå›¢é˜Ÿäº¤æµåï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æµè§ˆå™¨æ€§èƒ½çš„åŸå› åé¢æ§åˆ¶å°è°ƒè¯•è¿‡ä¹‹åï¼Œé€šè¿‡ç›‘æ§networké¢æ¿ï¼Œå‘ç°å½“å‰8ä¸ªç½‘ç»œè¯·æ±‚å‘å‡ºä¹‹åï¼Œåé¢2ä¸ªè¯·æ±‚æ€»æ˜¯è¢«ç½®ç©ºé€šè¿‡å®é™…è°ƒè¯•å’Œèµ„æ–™æ”¶é›†ä¹‹åï¼Œæœ€ç»ˆè¿™æ˜¯ç”±äºæµè§ˆå™¨åªå…è®¸6ä¸ªå¼‚æ­¥è¯·æ±‚å¹¶è¡Œå‘å‡ºï¼Œæ˜¯ç½‘ç»œåè®®çš„ä¸€ç§è§„åˆ™ç›‘æ§è§†é¢‘æ˜¯æŒç»­çš„æ•°æ®æµï¼Œä¼šé•¿æ—¶é—´çš„å ç”¨ä¸€ä¸ªè¯·æ±‚é€šé“é‚£ä¹ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦å°†httpå‡çº§åˆ°http2.0ï¼Œè¿™æ ·å°±æ²¡æœ‰å¹¶è¡Œé€šé“æ•°çš„é™åˆ¶äº†æ‰¾åˆ°è¿™ä¸ªè§£å†³æ–¹æ¡ˆåæˆ‘ä»¬å°±ç«‹åˆ»æ‰§è¡Œäº†ï¼Œèµ¶åœ¨æœåŠ¡ä¸Šçº¿ä¹‹å‰è§£å†³äº†è¿™ä¸ªé—®é¢˜ä¹‹å‰å› ä¸ºå…¬å¸ä¹Ÿé‡åˆ°è¿‡6è·¯ä»¥ä¸Šçš„ç›‘æ§å‡ºç°bugï¼Œä½†å½“æ—¶æ²¡æœ‰ä»æŠ€æœ¯å±‚é¢è§£å†³è¿™ä¸ªé—®é¢˜ä»è¿™ä¹‹åï¼Œç»è¿‡å’ŒæŠ€æœ¯å›¢é˜Ÿçš„è®¨è®ºï¼Œæˆ‘ä»¬è®¤ä¸ºä»¥åçš„é¡¹ç›®å°½é‡ä½¿ç”¨http2.0ï¼Œæé«˜ç½‘ç»œæ€§èƒ½ å¦‚ä½•å¯¹å­¦å‘˜çš„ä¿¡æ¯å®‰å…¨å’Œæ•°æ®è¿›è¡Œä¿æŠ¤è‡ªåŠ¨æ’è¯¾ç³»ç»Ÿï¼Œæ˜¯åŸºäºä»€ä¹ˆç®—æ³•æˆ–è€…è§„åˆ™æ¥è¿ä½œçš„å‘¢ï¼Ÿå¼€æ”¾æ€§é—®é¢˜ä»·å€¼è§‚ï¼šè´´è¿‘å…¬å¸æ–‡åŒ–ã€æ­£ç›´ç¨³å®šæ€§æŠ€æœ¯æ·±è€•èŒä¸šè§„åˆ’æ½œåŠ›å­¦ä¹ èƒ½åŠ›å‘å±•æ½œåŠ›ä¸“ä¸šæ€§æ€§ä»·æ¯”å·¥ä½œçƒ­æƒ…å’Œèƒ½åŠ›ä¸ªäººä»·å€¼å›ç­”è¦æœ‰æ¡ç†ï¼Œæœ‰é€»è¾‘ï¼Œå¿Œè¯´ç½—åœˆè¯ç”¨1ã€2ã€3ç‚¹é¦–å…ˆã€å…¶æ¬¡ã€æœ€å ä½ çš„èŒä¸šè§„åˆ’æ˜¯ä»€ä¹ˆæˆ‘çš„èŒä¸šè§„åˆ’æ˜¯æˆä¸ºèµ„æ·±çš„web3då·¥ç¨‹å¸ˆçŸ­æœŸå†…ï¼šé¦–å…ˆæˆ‘ä»¬çš„é¡¹ç›®æ˜¯åŸºäºvueå±‚æ„å»ºçš„ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ¨¡å¼é‚£ä¹ˆæˆ‘å°±éœ€è¦èŠ±åŠä¸ªæœˆå·¦å³çš„æ—¶é—´å»ç ”ç©¶vueåº•å±‚å®ç°åŸç†å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹æ¨¡å¼ç„¶åæˆ‘ä»¬web3dä½¿ç”¨çš„æŠ€æœ¯æ ˆä¸»è¦æ˜¯babylonjsé‚£ä¹ˆæˆ‘æ¯”è¾ƒç†Ÿæ‚‰çš„3dåº“æ˜¯threejsï¼Œè¿™ä¸¤ä¸ªæŠ€æœ¯æ ˆæ¯”è¾ƒç›¸ä¼¼æˆ‘éœ€è¦èŠ±1ä¸ªæœˆå·¦å³çš„æ—¶é—´å»å­¦ä¹ babylonjså…¶æ¬¡web3då¼€å‘å¯¹å›¾å½¢å­¦ç®—æ³•æ–¹é¢çš„è¦æ±‚å¾ˆé«˜è¿™æ–¹é¢çš„å­¦ä¹ ä¹Ÿæ˜¯æœ€å›°éš¾çš„ï¼Œéœ€è¦æˆ‘èŠ±ä¸ŠåŠå¹´çš„æ—¶é—´å»ä¸Šç½‘è‡ªå­¦ã€é˜…è¯»è¿™æ–¹é¢çš„ç›¸å…³ä¹¦ç±å’Œæºç é•¿æœŸå†…ï¼šèƒ½å¤Ÿåœ¨3å¹´å†…å…¨é¢çš„æŒæ¡web3då¼€å‘ç›¸å…³çš„æŠ€æœ¯èƒ½å¤Ÿåœ¨5å¹´å†…ï¼Œæˆä¸ºwebè½¯ä»¶æ€§èƒ½ã€ä¼˜åŒ–ã€3däº¤äº’æ–¹é¢çš„æŠ€æœ¯ä¸“å®¶å¹¶ä¸”åœ¨æœªæ¥èƒ½å®æ—¶å…³æ³¨3dæŠ€æœ¯çš„å‘å±•æ–¹å‘ï¼Œä¸æ–­åœ°å­¦ä¹  å¦‚ä½•å›ç­” ä½¿ç”¨å…·ä½“çš„æ—¶é—´ç‚¹ï¼Œæ¯”å¦‚å‡ å¹´å†…çš„èŒä¸šè§„åˆ’æŠ€æœ¯å±‚é¢æ·±è€•xxxæ—¶é—´ç‚¹å¯ä»¥æŒæ¡xxæŠ€æœ¯åˆ°xxxå±‚é¢xxæ—¶é—´ç‚¹å¯ä»¥è¾¾åˆ°xxæŠ€æœ¯æ°´å¹³ä¸ºå…¬å¸ä½œå‡ºæ›´å¤§è´¡çŒ®æˆ‘çš„èŒä¸šè®¡åˆ’æ˜¯æˆä¸ºèµ„æ·±çš„é«˜çº§å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼ŒçŸ­æœŸå†…ï¼šé¦–å…ˆæˆ‘æœ€å¤§çš„å…´è¶£ç‚¹åœ¨äºå‰ç«¯å¯è§†åŒ–é¢†åŸŸï¼ˆ1å¹´ï¼‰ä¸ºæ­¤éœ€è¦ç»§ç»­å­¦ä¹ webglã€canvasã€svgç­‰å‰ç«¯å›¾å½¢æŠ€æœ¯ã€ä»¥åŠä¸€äº›å›¾å½¢å­¦çš„åŸºæœ¬ç®—æ³•ç„¶åå‘¢ä¸ºäº†æé«˜ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒä¾æ—§éœ€è¦èŠ±2ä¸ªæœˆçš„æ—¶é—´ï¼Œå­¦ä¹ jsè¿™é—¨è¯­è¨€çš„æ·±å…¥åŸç†èŠ±åŠå¹´æ—¶é—´æ·±å…¥äº†è§£è®¡ç®—æœºç½‘ç»œçš„ç›¸å…³åŸç†ï¼Œå¸Œæœ›èƒ½æ›´æ¸…æ™°åœ°è®¤è¯†httpåè®®éœ€è¦åŠå¹´çš„æ—¶é—´å»äº†è§£äººå·¥æ™ºèƒ½ç›¸å…³çŸ¥è¯†pythonè¯­è¨€çš„åŸºç¡€æˆ‘æ˜¯æœ‰çš„äººå·¥æ™ºèƒ½æ˜¯ç›®å‰è®¡ç®—æœºé¢†åŸŸçš„ä¸€ä¸ªè¶‹åŠ¿ï¼Œæˆ‘è®¤ä¸ºèŠ±æ—¶é—´å»äº†è§£è¿™é—¨æŠ€æœ¯æ˜¯æ¯”è¾ƒæœ‰å¿…è¦çš„é•¿æœŸå†…ï¼šï¼ˆ3å¹´å†…ï¼‰èƒ½å¤Ÿç‹¬ç«‹è´Ÿè´£ä¸€æ¬¾å¤æ‚è½¯ä»¶çš„å‰ç«¯å¼€å‘ï¼ˆ5å¹´å†…ï¼‰æˆä¸ºwebè½¯ä»¶æ€§èƒ½ã€ä¼˜åŒ–ã€äº¤äº’æ–¹é¢çš„æŠ€æœ¯ä¸“å®¶ ä½ è¿˜æœ‰ä»€ä¹ˆæƒ³è¦äº†è§£çš„å—ï¼Ÿ å¯ä»¥è®²è®²è¿™ä¸ªå²—ä½çš„æœºä¼šè·ŸæŒ‘æˆ˜æœ‰å“ªäº›å—ï¼Ÿ è¿™ä¸ªå²—ä½å¯¹å‘˜å·¥çš„æœŸå¾…æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæœŸå¾…æ‹›ä¸€ä¸ªä»€ä¹ˆæ ·å­çš„äººå‘¢ï¼Ÿ å¯ä»¥å†è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸ªå²—ä½çš„å…·ä½“èŒè´£å—ï¼Ÿ å¯ä»¥ä»‹ç»ä¸€ä¸‹å…¬å¸çš„å›¢é˜Ÿç»„æˆå— å°±å‰ç«¯è€Œè¨€ç”¨åˆ°çš„æŠ€æœ¯æ ˆæ˜¯å“ªäº›å‘¢ è¯•ç”¨æœŸå¤šé•¿ å²—ä½ç¨³å®šæ€§å¦‚ä½• å·¥ä½œåˆ°ç°åœ¨ï¼Œé¡¹ç›®ä¸­é‡åˆ°çš„æœ€éš¾çš„é—®é¢˜ï¼ˆæŒ‘æˆ˜ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿåœ¨å‚ä¸ã€é¡¹ç›®ç®¡ç†ååŒè¡¨æ ¼ç¼–è¾‘ç³»ç»Ÿã€‘æ¡Œé¢è½¯ä»¶å¼€å‘çš„æ—¶å€™ï¼Œéœ€è¦å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼š éœ€è¦æ”¯æŒexcelè¡¨æ ¼å¯¼å…¥è½¯ä»¶ï¼Œè§£ææˆç»Ÿä¸€çš„å†…éƒ¨æ¨¡ç‰ˆ ä½†æ˜¯ç”¨æˆ·å¯¼å…¥çš„è¡¨æ ¼æ— æ³•ç»Ÿä¸€æ ¼å¼ å› ä¸ºè¿™ä»½ä¸šåŠ¡è¡¨æ ¼ï¼Œä¸åŒçœä»½æœ‰ä¸åŒçš„æ ‡å‡† è¿˜æœ‰å¯èƒ½å­˜åœ¨è¡¨æ ¼è¡Œåˆ—åˆå¹¶çš„æ ¼å¼ä¸åŒã€è¡¨å¤´æ ‡è®°ä¸åŒç­‰æƒ…å†µ æ‰€ä»¥éœ€è¦å¯¹å‡ ç§ä¸åŒçš„æ•°æ®æ ‡å‡†è¿›è¡Œè§£æï¼Œä»ä¸­æå–æœ‰æ•ˆçš„æ•°æ®ï¼Œè¾“å‡ºä¸ºç»Ÿä¸€æ ¼å¼çš„æ•°æ® å½“æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š å…ˆä½¿ç”¨sheetjsåº“å°†excelä¸­çš„æ•°æ®ç»Ÿä¸€è¯»å…¥ åˆ†æå„ä¸ªçœä»½ä¸åŒçš„æ ‡å‡†ï¼Œå†™å‡ºä¸€ä»½è§£æçš„ç®—æ³•ï¼Œèƒ½å¤Ÿå¯¹æ•°æ®è¿›è¡Œè§£æï¼ŒèŠ±äº†ä¸€å‘¨çš„æ—¶é—´ï¼Œæ‰å°†å„ç§æƒ…å†µè¿›è¡Œå…¼å®¹ å½“ç„¶ï¼Œè€ƒè™‘åˆ°å¤æ‚æ€§å’Œæ”¿ç­–çš„å˜åŒ–æ€§ï¼Œç°åœ¨å¦‚æœå†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè®­ç»ƒaiè¿›è¡Œè§£æçš„å¯å®ç°æ€§åº”è¯¥æ›´é«˜ä¸€äº› ä½ æ”¶è·åˆ°æœ€å¤šçš„ä¸€æ¬¡ç»å†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨åŒ—äº¬å›½é¥å·¥ä½œçš„æ—¶å€™ï¼Œåšçš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªçŸ¥è¯†å›¾è°±åŠŸèƒ½æ¨¡å—ï¼Œæ˜¯é¡¹ç›®ä¸­æœ€å¤æ‚çš„äº®ç‚¹æ¨¡å—ï¼Œåœ¨åˆ†å·¥ä¼šè®®æ—¶ï¼Œæˆ‘è‡ªå‘Šå¥‹å‹‡è¦åšè¿™ä¸ªæ¨¡å—ï¼Œæ‹¿åˆ°æ¨¡å—ä¹‹åï¼Œéå¸¸å…´å¥‹ï¼Œå½“æ—¶éå¸¸è®¤çœŸçš„åœ¨åšè¿™å—å†…å®¹ï¼Œä¹Ÿå‘å‰è¾ˆè¯·æ•™äº†å¾ˆå¤šçŸ¥è¯†ï¼Œæœ€ç»ˆæŠŠè¿™ä¸ªæ¨¡å—å¼€å‘å®Œæˆï¼Œå®¢æˆ·å¯¹æ­¤çš„åé¦ˆå¾ˆå¥½ï¼Œä¸ªäººéå¸¸æœ‰æˆå°±æ„Ÿï¼Œå¯¹å¯è§†åŒ–æŠ€æœ¯çš„å…´è¶£åŠ æ·±äº†å¾ˆå¤š ä½ åœ¨è¿‡å»çš„å·¥ä½œä¸­ï¼Œæœ€å–œæ¬¢åšä»€ä¹ˆï¼Œæœ€ä¸å–œæ¬¢åšä»€ä¹ˆï¼Ÿä½ è®¤ä¸ºè‡ªå·±æœ€æ“…é•¿çš„æŠ€èƒ½æ˜¯ä»€ä¹ˆï¼Ÿä¸¾ä¾‹è¯´æ˜ä½ æ˜¯å¦‚ä½•å¤„ç†ä¸åŒäº‹ä¹‹é—´çš„å†²çªçš„ï¼Œé’åˆ†äº«ä¸€æ¬¡å…·ä½“çš„ç»å†ä½ æœ€è¿‘ä¸å›¢é˜Ÿåˆä½œå®Œæˆçš„ä¸€ä¸ªé‡è¦é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿä½ åœ¨å…¶ä¸­æ‰®æ¼”äº†ä»€ä¹ˆæ ·çš„è§’è‰²ä½ æœ€å¤§çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿä¼˜ç‚¹æ˜¯ä»€ä¹ˆä½ æœ€è¿‘å¤±è´¥çš„ä¸€ä»¶äº‹æ˜¯ä»€ä¹ˆï¼Ÿä½ æœ‰æ²¡æœ‰åˆ†æè¿‡å¤±è´¥çš„åŸå› ï¼Ÿæœ‰å¤ç›˜è¿‡å—ï¼Ÿè¡Œä¸ºäº‹ä»¶ç±»é¡¹ç›®ç±»é—®é¢˜ä»‹ç»ä¸€ä¸ªä½ è§‰å¾—å¾ˆæˆåŠŸå¾ˆå¤±è´¥æ„Ÿå—å¾ˆæ·±åˆ»è€—æ—¶æœ€ä¹…çš„é¡¹ç›®ç»å†STARæ³•åˆ™ situation æƒ…å¢ƒtask ä»»åŠ¡action è¡ŒåŠ¨result ç»“æœä¾‹å­ï¼šèƒŒæ™¯å’Œä»»åŠ¡ï¼šæˆ‘åœ¨XXXæœŸé—´ï¼Œæ‰€è´Ÿè´£XXé¡¹ç›®é‡åˆ°äº†ä¸€ä¸ªXXé—®é¢˜ä¿¡æ¯æ”¶é›†ï¼šåœ¨å¤„ç†é—®é¢˜ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£æ˜¯ä»€ä¹ˆåŸå› é€ æˆè¿™ç§æƒ…å†µçš„å‘ç”Ÿè¡ŒåŠ¨1ï¼šäºæ˜¯æˆ‘åšäº†XXXæªæ–½ï¼Œä¸å›¢é˜Ÿå†…äººå‘˜è¿›è¡Œäº¤æµï¼Œæˆ‘è´Ÿè´£çš„æ˜¯XXXéƒ¨åˆ†ç»“æœ1ï¼šè°ƒæŸ¥åˆ°å¯¼è‡´é—®é¢˜çš„åŸå› æ˜¯XXXè¡ŒåŠ¨2ï¼šäºæ˜¯æˆ‘ä»¬å›¢é˜Ÿé‡‡å–äº†XXæªæ–½ï¼Œä»XXéƒ¨åˆ†åšäº†å·¥ä½œç»“æœ2ï¼šæœ€ç»ˆåœ¨XXæœŸé—´å®ç°äº†XXXç›®æ ‡ï¼Œè§£å†³äº†XXé—®é¢˜ JDä¸šåŠ¡é—®é¢˜SaaSSaaSç³»ç»Ÿï¼šè½¯ä»¶å³æœåŠ¡ï¼ˆSoftware as a Serviceï¼‰é€šè¿‡äº’è”ç½‘æä¾›è½¯ä»¶åº”ç”¨çš„æœåŠ¡å¹³å°ï¼Œé€šè¿‡è®¢é˜…çš„æ–¹å¼è·å¾—å¯¹äº‘ç«¯è½¯ä»¶çš„è®¿é—®æƒé™ï¼ŒSaaSå¹³å°æä¾›å•†è´Ÿè´£è½¯ä»¶çš„éƒ¨ç½²ã€ç»´æŠ¤å’Œå®‰å…¨æ€§ç­‰æ–¹é¢çš„å·¥ä½œ CRMå®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿä¸»è¦åŠŸèƒ½å®¢æˆ·ç®¡ç†é”€å”®è¿‡ç¨‹æ¨è¿›å”®åç®¡ç† BIMBuilding Information Modelingå»ºç­‘ä¿¡æ¯æ¨¡å‹é€šè¿‡3dæ•°å­—åŒ–æŠ€æœ¯ï¼ŒæŠŠå»ºç­‘å·¥ç¨‹ä¸­å„ä¸“ä¸šã€å„é˜¶æ®µä¸å·¥ç¨‹ç›¸å…³çš„ä¿¡æ¯çº³å…¥æ•°æ®æ¨¡å‹ä¹‹ä¸­é€šè¿‡BIMè½¯ä»¶è¿›è¡Œå»ºæ¨¡ã€åˆ†æã€æ¨¡æ‹Ÿã€æ¼”ç¤ºã€æ£€æµ‹ç­‰å¯¹å·¥ç¨‹çš„è¿›åº¦ã€æˆæœ¬ã€è´¨é‡è¿›è¡Œç®¡æ§ é¢è¯•ç»“æŸè¿½é—®é¢è¯•ç»“æœå¾ˆé«˜å…´åœ¨ä¸Šå‘¨äºŒèƒ½å‚åŠ è´µå…¬å¸çš„é¢è¯•ï¼Œä¸é¢è¯•å®˜æ²Ÿé€šè¿‡åæˆ‘å¯¹å²—ä½æœ‰äº†æ›´æ·±çš„è®¤è¯†ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯éå¸¸æ„Ÿå…´è¶£çš„ï¼Œæ–¹ä¾¿é—®ä¸€ä¸‹å²—ä½æ‹›è˜è¿™å‡ å¤©é™†ç»­æ”¶åˆ°äº†2å®¶å…¬å¸ç»™æˆ‘çš„offerï¼Œè¦æˆ‘åœ¨è¿™å‘¨è¿›è¡Œç­”å¤ï¼Œä½†æˆ‘å¯¹å’±ä»¬å…¬å¸è¿˜æ˜¯éå¸¸æ„Ÿå…´è¶£çš„ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨ç­‰æ‚¨è¿™è¾¹çš„å›å¤"},{"title":"git","path":"/wiki/Job/front_06_git.html","content":"gitå¸¸ç”¨å‘½ä»¤æœ‰å“ªäº›å‚è€ƒåšå®¢"},{"title":"2025/02/07 é¹§é¸ªäº‘","path":"/wiki/Job/log_01_20250207_ZheGuYun.html","content":"é¢è¯•å…¬å¸ï¼šå¾å·é¹§é¸ªäº‘ é¢è¯•å²—ä½ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025020711:00 é¢è¯•æ—¶é•¿ï¼š20åˆ†é’Ÿå·¦å³ é¢è¯•ä½“éªŒï¼šä¸€èˆ¬ å¦‚ä½•çœ‹å¾…åŠ ç­ï¼Œä¸Šå®¶å…¬å¸å¿™å—ï¼Ÿä¸Šä¸ªé¡¹ç›®çš„å›¢é˜Ÿè§„æ¨¡å¤šå¤§ï¼Ÿç­”ï¼š åˆç†åŠ ç­æ²¡æœ‰é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥æ¥æ”¶ï¼Œ ä¸Šå®¶å…¬å¸å·¥ä½œèŠ‚å¥ä¸æ˜¯å¾ˆå¿«ï¼Œèµ¶ç‰ˆæœ¬èŠ‚ç‚¹çš„æ—¶å€™æ¯”è¾ƒå¿™ï¼Œå¹³æ—¶ä¸å¿™ å›¢é˜Ÿè§„æ¨¡ä¸å¤§ï¼Œ2ä¸ªç§»åŠ¨ç«¯ï¼Œ3ä¸ªåç«¯ï¼Œ2ä¸ªæµ‹è¯•ï¼Œ1ä¸ªwebå‰ç«¯ï¼Œ1ä¸ªui ä»‹ç»ä¸€ä¸‹ä½ åœ¨ä¸Šä¸€ä¸ªå…¬å¸åšçš„é¡¹ç›®ç­”ï¼š ä¸€æ¬¾è‡ªç ”ç¤¾äº¤åª’ä½“ç±»äº¤å‹APP é—®ï¼šè¿™ä¸ªé¡¹ç›®ä¸­ä½ ç”¨åˆ°äº†å“ªäº›æŠ€æœ¯æ ˆç­”ï¼š æˆ‘åšçš„ä¸»è¦æ˜¯åå°ç®¡ç†éƒ¨åˆ†ï¼Œä½¿ç”¨çš„æ˜¯è‹¥ä¾æ¡†æ¶ï¼ŒæŠ€æœ¯æ ˆæ˜¯ts+vue3 ä½¿ç”¨åˆ°cocosåˆ¶ä½œAppç«¯çš„h5å°æ¸¸æˆ ä½¿ç”¨Echartsã€threejsåˆ¶ä½œAppç«¯çš„å¯è§†åŒ–å›¾è¡¨h5é™æ€é¡µé¢é—®ï¼šä½ æ˜¯å¦‚ä½•å®ç°ç›´æ’­åŠŸèƒ½çš„ç­”ï¼š ç›´æ’­åŠŸèƒ½ä¸»è¦æ˜¯Appç«¯å®ç°çš„ï¼Œå¯¹æ¥çš„æ˜¯èäº‘çš„SDKé—®ï¼šæ‰€ä»¥ä½ æ˜¯æ²¡æœ‰å‚ä¸ç›´æ’­åŠŸèƒ½çš„å¼€å‘äº†ï¼Ÿ æˆ‘ä¸»è¦è´Ÿè´£å¼€å‘å®¡æ ¸å‘˜åœ¨åå°å¯¹ç›´æ’­è¿›è¡Œå®¡æ ¸çš„éƒ¨åˆ† æœ‰å¼€å‘è¿‡å¾®ä¿¡å°ç¨‹åºå—ï¼Ÿç­”ï¼š åœ¨å…¬å¸ä¸­æœ‰ç»´æŠ¤å¾®ä¿¡å°ç¨‹åºé¡¹ç›®çš„ç»éªŒï¼Œä½†ä»0-1å¼€å‘å¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ˜¯æ²¡æœ‰çš„ å½“æ—¶ä½¿ç”¨çš„æ˜¯uniappæ¡†æ¶è¿›è¡Œå¼€å‘çš„ é—®ï¼šé‚£ç§»åŠ¨ç«¯é¡¹ç›®ä¸­ï¼Œå¦‚ä½•è·å–åˆ°ç”¨æˆ·çš„æ‰‹æœºå·ç ç­”ï¼šä¸å¤ªæ¸…æ¥šå‘¢ è¡¥å……å›ç­”ï¼š è·å–ç”¨æˆ·æ‰‹æœºå·éœ€è¦æäº¤å•†å®¶ä¿¡æ¯ å¿…é¡»æ˜¯ä¼ä¸šè´¦å·æ‰èƒ½æœ‰æƒé™è·å–ç”¨æˆ·æ‰‹æœºå·ç ï¼Œéœ€è¦appidå’Œå°ç¨‹åºå¯†é’¥ é€šè¿‡uni.login()è·å–åˆ°ç”¨æˆ·çš„codeå€¼ è·å–åˆ°codeå€¼åè°ƒç”¨uni.request()è¯·æ±‚å¾®ä¿¡æœåŠ¡å™¨ï¼Œæ‹¿åˆ°ç”¨æˆ·çš„session_keyå€¼ é€šè¿‡å¾®ä¿¡æä¾›çš„æ–¹æ³•ï¼šgetPhoneNumberæ‹¿åˆ°encryptedDataã€iv æ‰€æœ‰å€¼éƒ½æ‹¿åˆ°ä¹‹åï¼Œé€šè¿‡å¾®ä¿¡æä¾›çš„è§£å¯†æ–¹æ¡ˆWXBizDataCryptï¼Œæ‹¿åˆ°æœ€ç»ˆæ‰‹æœºå· ç”¨è¿‡websocketå—ï¼Œä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆç­”ï¼š å«æ˜Ÿ2dè½¨è¿¹é¡¹ç›®ä¸­ä½¿ç”¨è¿‡å‘¢ï¼Œå› ä¸ºéœ€è¦åå°å®æ—¶æ¨é€å«æ˜Ÿè½¨è¿¹æ•°æ®åˆ°é¡µé¢ä¸Š å«æ˜Ÿ2dè½¨è¿¹é¡µé¢å’Œ3dæ¡Œé¢qtè½¯ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œä¹Ÿæ˜¯ä½¿ç”¨websocketè¿›è¡Œä¼ é€’çš„é—®ï¼šä»”ç»†ä»‹ç»ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ç­”ï¼š ä¸€ä¸ªèƒ½å¤Ÿå®æ—¶ç›‘å¬å«æ˜Ÿè½¨è¿¹çš„2då¯è§†åŒ–åœ°å›¾ï¼Œä¸3dæ¡Œé¢è½¯ä»¶è¿›è¡Œè”åˆä»¿çœŸ èƒ½å¤Ÿé€šè¿‡ç›‘å¬å«æ˜Ÿçš„ä½ç½®ï¼Œä»¿çœŸæ¨¡æ‹Ÿå«æ˜Ÿç¢°æ’ã€å˜è½¨ç­‰äº‹ä»¶é—®ï¼šé‚£è¿™ä¸ª3déƒ¨åˆ†æ˜¯ç”¨ä»€ä¹ˆæŠ€æœ¯å®ç°çš„å‘¢ï¼Ÿç­”ï¼šc++çš„Qtå†™çš„æ¡Œé¢è½¯ä»¶é—®ï¼šæ‰€ä»¥ä¸æ˜¯ä½ åšçš„æ˜¯å—ï¼Ÿç­”ï¼šæ˜¯çš„ï¼Œä¸æ˜¯é—®ï¼šæœ‰ç”¨è¿‡wsså—ï¼Œå°±æ˜¯ä¸€ä¸ªå’Œwebsocketå’Œsslç›¸å…³çš„åè®®ç­”ï¼šä¸æ˜¯å¾ˆæ¸…æ¥šå‘¢ è¡¥ç­”ï¼šwså’Œwssåè®®éƒ½æ˜¯webSocketåè®®ï¼Œä½†æ˜¯wsæ˜¯éå®‰å…¨åè®®ï¼Œwssæ˜¯å®‰å…¨åè®®ï¼Œç›¸å½“äºhttpå’Œhttpsçš„å·®åˆ«ï¼Œwsä¸éœ€è¦è¯ä¹¦ï¼Œwsséœ€è¦sslæ•´æ•°wsï¼šTCP + WSwssï¼š TCP + TLS + WS 3dç›¸å…³çš„æŠ€æœ¯åªç”¨è¿‡threejså—ç­”ï¼š åŸºæœ¬ä¸Šthreejsç”¨çš„æ¯”è¾ƒå¤š åœ°å›¾ç›¸å…³çš„é¡¹ç›®æœ‰ç”¨è¿‡Cesiumåº“ å¯¹WebGLçš„3Dæ¸²æŸ“ä¹Ÿæœ‰äº†è§£ æ€»ç»“ é¢è¯•å®˜æ²¡æ€ä¹ˆé—®æŠ€æœ¯é—®é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯å’Œé¡¹ç›®ç›¸å…³çš„é—®é¢˜"},{"title":"js","path":"/wiki/Job/front_02_js.html","content":"2024å‰æ®µé«˜é¢‘é¢è¯•é¢˜æ•°æ®ç±»å‹1.jsåŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠå®ƒä»¬çš„åŒºåˆ«javascriptå…±æœ‰8ç§æ•°æ®ç±»å‹åŸå§‹æ•°æ®ç±»å‹undefinednullbooleannumberstringsymbolbigintå¼•ç”¨æ•°æ®ç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ï¼‰objectsymbolå’Œbigintsymbolå’Œbigintéƒ½æ˜¯es6æ–°å¢çš„æ•°æ®ç±»å‹symbolä»£è¡¨åˆ›å»ºåç‹¬ä¸€æ— äºŒä¸”ä¸å¯å˜çš„æ•°æ®ç±»å‹ä¸»è¦ä¸ºäº†è§£å†³å¯èƒ½å‡ºç°çš„å…¨å±€å˜é‡å†²çªé—®é¢˜bigintå¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»æ„ç²¾åº¦æ ¼å¼çš„æ•´æ•°å¯ä»¥å®‰å…¨çš„å­˜å‚¨å’Œæ“ä½œå¤§æ•´æ•°åŸå§‹æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«æ˜¯ï¼šå­˜æ”¾çš„ä½ç½®ä¸åŒåŸå§‹æ•°æ®ç±»å‹ç›´æ¥å­˜æ”¾åœ¨æ ˆï¼ˆstackï¼‰ä¸­å æ®ç©ºé—´å°ï¼Œå¤§å°ç¨³å®šï¼Œéœ€è¦é¢‘ç¹ä½¿ç”¨å¼•ç”¨æ•°æ®ç±»å‹å­˜æ”¾åœ¨å †ï¼ˆheapï¼‰ä¸­å æ®ç©ºé—´å¤§ï¼Œå¤§å°ä¸ç¨³å®šåœ¨æ ˆä¸­å­˜å‚¨æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å †ä¸­è¯¥å®ä½“çš„èµ·å§‹åœ°å€è§£é‡Šå™¨é¦–å…ˆå¯»æ‰¾æ ˆä¸­å­˜æ”¾çš„åœ°å€ï¼Œå†ä»å †ä¸­è·å¾—å®ä½“æ ˆå’Œå †çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿæ“ä½œç³»ç»Ÿä¸­ï¼Œå†…å­˜è¢«åˆ†ä¸ºå †åŒºå’Œæ ˆåŒºæ ˆä¸­æ•°æ®ä¸ºå…ˆè¿›åå‡ºå†…å­˜ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾å †æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œä¼˜å…ˆçº§å¯ä»¥æŒ‰ç…§å¤§å°æ¥è§„å®šä¸€èˆ¬ç”±å¼€å‘è€…åˆ†é…é‡Šæ”¾ 2.æ•°æ®ç±»å‹æ£€æµ‹çš„æ–¹å¼æœ‰å“ªäº›typeofåˆ¤æ–­nullæ•°ç»„å¯¹è±¡ç±»å‹æ—¶ï¼Œç»“æœéƒ½ä¼šæ˜¯objectinstanceofæœºåˆ¶ï¼šåˆ¤æ–­åœ¨åŸå‹é“¾ä¸­æ˜¯å¦èƒ½æ‰¾åˆ°è¯¥ç±»å‹çš„åŸå‹å¯ä»¥ç”¨æ¥æµ‹è¯•å¯¹è±¡åŸå‹é“¾ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„prototypeå±æ€§ä»…å¯¹å¼•ç”¨ç±»å‹æœ‰æ•ˆï¼Œæ— æ³•åˆ¤æ–­åŸå§‹æ•°æ®ç±»å‹constructorå¯ä»¥ä½¿ç”¨constructoræ¥åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å¦‚æœä¿®æ”¹å¯¹è±¡çš„åŸå‹å°±è¡Œä¸é€šäº†Object.prototype.toString.call()å¯ä»¥è·å–å±æ€§ç±»å‹åç§°å­—ç¬¦ä¸²é—®ï¼šä¸ºä»€ä¹ˆobj.toString()å’ŒObject.prototype.toString()çš„è¿”å›å€¼ä¸ä¸€æ ·ç­”ï¼šå› ä¸ºåè€…è°ƒç”¨çš„æ—¶Objectçš„åŸå‹æ–¹æ³•ï¼Œè€Œä½¿ç”¨å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼ŒtoStringæ–¹æ³•éƒ½è¢«é‡å†™äº† æ•°ç»„3.åˆ¤æ–­æ•°ç»„çš„æ–¹å¼æœ‰å“ªäº›Array.isArray(obj)obj.proto Array.prototypeObject.prototype.toString().call(obj).slice(8,-1) â€˜Arrayâ€™obj instanceof ArrayArray.prototype.isPrototypeOf(obj) 9.æ•°ç»„æœ‰å“ªäº›åŸç”Ÿæ–¹æ³•toStringjoinï¼Œå°†æ•°ç»„å…ƒç´ è¿æ¥æˆå­—ç¬¦ä¸²pushpopshiftunshiftreversesort å›è°ƒå‡½æ•°è¿”å›å€¼ä¸ºæ•´æ•°æ—¶ï¼Œäº¤æ¢ä¸¤ä¸ªå‚æ•°çš„ä½ç½®concatï¼Œä¸å½±å“åŸæ•°ç»„sliceï¼Œä¸å½±å“åŸæ•°ç»„spliceï¼Œå½±å“åŸæ•°ç»„indexOfã€lastIndexOfeverysomefilterforEachreducereduceRight 11.æ•°ç»„çš„éå†æ–¹æ³•æœ‰å“ªäº›forEachmapfilterforâ€¦ofè¿”å›æ•°ç»„å…ƒç´ å¯¹è±¡çš„å±æ€§å€¼everysomefindfindIndexreducereduceRight 12.forEachå’Œmapçš„åŒºåˆ«éƒ½æ˜¯ç”¨æ¥éå†æ•°ç»„çš„forEachä¸»è¦æ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œæä¾›çš„å‡½æ•°ï¼Œè¿”å›å€¼æ²¡æœ‰æ„ä¹‰mapä¼šæ ¹æ®å›è°ƒå‡½æ•°çš„è¿”å›å€¼å¾—åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ è¯­æ³•ç‰¹æ€§4.è¯·ç®€è¿°JavaScriptä¸­çš„thisthisæŒ‡å‘å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å¯¹è±¡è°ƒç”¨æ¨¡å¼å‡½æ•°è°ƒç”¨æ¨¡å¼ï¼šå…¨å±€å®šä¹‰å‡½æ•°ç›´æ¥è¢«è°ƒç”¨ï¼ŒthisæŒ‡å‘å…¨å±€å¯¹è±¡æ–¹æ³•è°ƒç”¨æ¨¡å¼ï¼šå‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨ï¼ŒthisæŒ‡å‘å¯¹è±¡æ„é€ å™¨è°ƒç”¨æ¨¡å¼ï¼šå‡½æ•°ä½œä¸ºæ„é€ å™¨è¢«newè°ƒç”¨ï¼Œæ‰§è¡Œå‰ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡ï¼ŒthisæŒ‡å‘å¯¹è±¡applyã€callã€bindï¼šå¯ä»¥æŒ‡å®šthisçš„æŒ‡å‘applyï¼šä¼ å…¥2ä¸ªå‚æ•°å‚æ•°1ï¼šthisç»‘å®šå¯¹è±¡å‚æ•°2ï¼šå…¶å®ƒå‚æ•°ï¼ˆæ•°ç»„æ ¼å¼ï¼‰callï¼šå‚æ•°1ï¼šthisç»‘å®šå¯¹è±¡å…¶å®ƒå‚æ•°ï¼ˆå¿…é¡»é€ä¸ªä¾‹å¥å‡ºæ¥ï¼‰bindå‚æ•°1ï¼šthisæŒ‡å‘è¿”å›å€¼ï¼šæ–°å‡½æ•°è°ƒç”¨æ¨¡å¼ä¼˜å…ˆçº§ï¼šæ„é€ å™¨ applybindcall æ–¹æ³• å‡½æ•° ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ« ç®­å¤´å‡½æ•°çš„å†™æ³•æ›´åŠ ç®€æ´ ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘å‡½æ•°å®šä¹‰çš„ä¸Šä¸‹æ–‡ ç®­å¤´å‡½æ•°ç»§æ‰¿çš„thisæŒ‡å‘ä¸ä¼šæ”¹å˜ ç®­å¤´å‡½æ•°ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨ ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±argumentså¯¹è±¡ ç®­å¤´å‡½æ•°æ²¡æœ‰prototype ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œgeneratorå‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨yieldå…³é”®å­— 5.AMDå’ŒCommonJsçš„åŒºåˆ«éƒ½æ˜¯å®ç°æ¨¡å—åŒ–çš„æ–¹å¼CommonjsåŒæ­¥åŠ è½½ï¼Œç”±äºè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œä»æœ¬åœ°ç£ç›˜è¯»å–æ•°æ®ï¼Œé€Ÿåº¦å¾ˆå¿«æ›´é€‚åˆæœåŠ¡å™¨ï¼Œnodejsä½¿ç”¨commonjsmoduleexportsrequireglobalmodule.exportsè¾“å‡ºï¼ŒrequireåŠ è½½AMDrequire.jså¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œæ¨¡å—åŠ è½½ä¸å½±å“åé¢è¯­å¥è¿è¡Œæ›´é€‚åˆæµè§ˆå™¨ä½¿ç”¨require.config()æŒ‡å®šå¼•ç”¨è·¯å¾„define()å®šä¹‰æ¨¡å—ï¼Œrequire()åŠ è½½æ¨¡å— 6.ES6æ¨¡å—ä¸CommonJsæ¨¡å—æœ‰ä»€ä¹ˆå¼‚åŒä¸¤è€…éƒ½èƒ½å¯¹å¼•å…¥çš„å¯¹è±¡çš„å†…éƒ¨å±æ€§å€¼è¿›è¡Œæ”¹å˜ES6æ¨¡å—è¯­æ³•ç®€å•ï¼Œé€‚ç”¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨exportå¯¼å‡ºï¼Œimportå¯¼å…¥æ˜¯å¯¹æ¨¡å—çš„å¼•ç”¨ï¼Œæ¨¡å—æœ¬èº«æŒ‡å‘ä¸èƒ½æ”¹å˜commonjsæ˜¯å¯¹æ¨¡å—çš„æµ…æ‹·è´æ¨¡å—æœ¬èº«å¯ä»¥è¢«é‡æ–°èµ‹å€¼ 7.letã€constã€varçš„åŒºåˆ«å—çº§ä½œç”¨åŸŸletã€constå…·æœ‰å—çº§ä½œç”¨åŸŸï¼Œvaræ²¡æœ‰å—çº§ä½œç”¨åŸŸä½¿ç”¨èŠ±æ‹¬å·åŒ…è£¹ï¼Œç”¨äºè§£å†³2ä¸ªé—®é¢˜ï¼šå†…å±‚å˜é‡å¯èƒ½è¦†ç›–å¤–å±‚å˜é‡ç”¨æ¥è®¡æ•°çš„å¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡å˜é‡æå‡å˜é‡åªèƒ½åœ¨å£°æ˜åä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™varå­˜åœ¨å˜é‡æå‡letconstä¸å­˜åœ¨å˜é‡æå‡å…¨å±€æ·»åŠ å±æ€§æµè§ˆå™¨å…¨å±€å˜é‡ï¼šwindowï¼ŒNodeå…¨å±€å˜é‡globalvarå£°æ˜å˜é‡ä¼šæˆä¸ºå…¨å±€å¯¹è±¡çš„å±æ€§letå’Œconstä¸ä¼šé‡å¤å£°æ˜varå¯ä»¥é‡å¤å£°æ˜ï¼Œåå£°æ˜çš„å˜é‡ä¼šè¦†ç›–å‰å£°æ˜çš„constã€letä¸å…è®¸é‡å¤å£°æ˜æš‚æ—¶æ€§æ­»åŒºletconstå£°æ˜ä¹‹å‰æ— æ³•ä½¿ç”¨åˆå§‹å€¼è®¾ç½®varletå¯ä»¥ä¸è®¾ç½®åˆå§‹å€¼constå¿…é¡»è®¾ç½®åˆå§‹å€¼æŒ‡é’ˆæŒ‡å‘letvaråˆ›å»ºçš„å˜é‡éƒ½å¯ä»¥æ›´æ”¹æŒ‡é’ˆæŒ‡å‘constä¸èƒ½ 10.for in å’Œ for ofçš„åŒºåˆ«for_oféå†å¯¹è±¡çš„é”®å€¼ï¼Œéå†æ•°ç»„å…ƒç´ å€¼åªéå†å½“å‰å¯¹è±¡ä¸Šçš„å±æ€§for_inéå†å¯¹è±¡çš„é”®åï¼Œéå†æ•°ç»„ç´¢å¼•ä¼šéå†å¯¹è±¡çš„æ•´ä¸ªåŸå‹é“¾ï¼Œæ€§èƒ½æ¯”è¾ƒå·® 23ã€ES6æœ‰å“ªäº›æ–°ç‰¹æ€§ç®­å¤´å‡½æ•°è§£æ„èµ‹å€¼æ¨¡ç‰ˆå­—ç¬¦ä¸²promisesymbolï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œä¸èƒ½ä¸å…¶ä»–æ•°æ®ç±»å‹è¿›è¡Œè¿ç®—letconstæ¨¡å—åŒ–ï¼ˆimportexportï¼‰for..ofå¾ªç¯åˆ»ç¢Ÿå¸¦å¯¹è±¡æ‰©å±•è¿ç®—ç¬¦â€¦MapSetProxyï¼Œå…è®¸åœ¨å¯¹è±¡å’Œå‡½æ•°è°ƒç”¨ç­‰æ“ä½œå‰åæ·»åŠ è‡ªå®šä¹‰çš„è¡Œä¸ºClassç±»å‡½æ•°é»˜è®¤å‚æ•° 24ã€åŒ¿åå‡½æ•°çš„å…¸å‹åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿéœ€è¦ç«‹å³è°ƒç”¨æ‰§è¡Œçš„å‡½æ•°ï¼Œå°è£…å±€éƒ¨ä½œç”¨åŸŸçš„ä»£ç ï¼Œé¿å…å£°æ˜çš„å˜é‡æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ(function())()ç”¨äºä¸€äº›å‡½æ•°ä½œä¸ºå‚æ•°çš„æƒ…å†µï¼Œæ¯”å¦‚setTimeoutæˆ–è€…forEach å¼•ç”¨ç±»å‹8.newæ“ä½œç¬¦çš„å®ç°åŸç†é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡å°†å¯¹è±¡çš„åŸå‹è®¾ç½®ä¸ºå‡½æ•°çš„prototypeå¯¹è±¡è®©å‡½æ•°çš„thisæŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°çš„ä»£ç åˆ¤æ–­å‡½æ•°è¿”å›ç±»å‹ï¼Œå¦‚æœæ˜¯å€¼ç±»å‹ï¼Œè¿”å›åˆ›å»ºçš„å¯¹è±¡ï¼Œå¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œè¿”å›å¼•ç”¨ç±»å‹çš„å¯¹è±¡ 13.åŸå‹å’ŒåŸå‹é“¾jsä¸­çš„æ„é€ å‡½æ•°å†…éƒ¨å­˜åœ¨ä¸€ä¸ªprototypeå±æ€§æ–°å»ºçš„å¯¹è±¡å†…éƒ¨å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„prototypeå±æ€§çš„å¯¹åº”å€¼ï¼Œå³åŸå‹æµè§ˆå™¨ä¸­èƒ½å¤Ÿé€šè¿‡protoå±æ€§è®¿é—®è¿™ä¸ªå€¼å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¯¹è±¡å†…éƒ¨ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šæ²¿ç€åŸå‹é“¾å‘ä¸Šå¯»æ‰¾è¯¥å±æ€§æ–¹æ³•åŸå‹é“¾çš„ç»ˆç‚¹ï¼šObject.prototype.protoï¼Œä¹Ÿå°±æ˜¯nullå¯ä»¥é€šè¿‡hasOwnPropertyæ–¹æ³•åˆ¤æ–­å±æ€§åˆ°åº•æ˜¯åŸå‹é“¾ä¸Šçš„è¿˜æ˜¯æœ¬èº«å®šä¹‰çš„ å…¨å±€å˜é‡ä½œç”¨åŸŸ14.å¯¹æ‰§è¡Œä¸Šä¸‹æ–‡ã€ä½œç”¨åŸŸé“¾ã€é—­åŒ…çš„ç†è§£é—­åŒ…æŒ‡çš„æ˜¯æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°æœ€å¸¸è§çš„æ–¹å¼ï¼šåœ¨ä¸€ä¸ªå‡½æ•°å†…åˆ›å»ºå¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ›å»ºçš„å‡½æ•°å¯ä»¥è®¿é—®åˆ°å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡æ¯”å¦‚Aå‡½æ•°å†…æœ‰Bå‡½æ•°ï¼ŒBå‡½æ•°èƒ½è®¿é—®Aå‡½æ•°ä¸­çš„å˜é‡ï¼ŒBå‡½æ•°å°±æ˜¯é—­åŒ…ç”¨é€”ï¼šåœ¨å‡½æ•°å¤–éƒ¨è®¿é—®å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼ˆé—´æ¥è®¿é—®å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼‰ä½¿è¿è¡Œå·²ç»ç»“æŸçš„å‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡ç»§ç»­ç•™åœ¨å†…å­˜ä¸­ï¼Œå› ä¸ºé—­åŒ…å‡½æ•°ä¿ç•™äº†è¿™ä¸ªå˜é‡å¯¹è±¡çš„å¼•ç”¨ä½œç”¨åŸŸå…¨å±€ä½œç”¨åŸŸwindowå¯¹è±¡çš„å±æ€§æ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸæœ€å¤–å±‚å‡½æ•°å’Œå˜é‡éƒ½æ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸå‡½æ•°ä½œç”¨åŸŸå‡½æ•°å†…éƒ¨çš„å˜é‡å—çº§ä½œç”¨åŸŸes6çš„æ–°ç‰¹æ€§letconstæœ‰æ•ˆå¾ªç¯æ¯”è¾ƒé€‚åˆå—çº§ä½œç”¨åŸŸä½œç”¨åŸŸé“¾åœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾ä¸åˆ°å˜é‡æ—¶ï¼Œå°±å»çˆ¶çº§ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç›´åˆ°å…¨å±€ä½œç”¨åŸŸä¸ºæ­¢ä¿è¯å¯¹ç¯å¢ƒä¸­çš„å˜é‡å’Œå‡½æ•°è¿›è¡Œæœ‰åºè®¿é—® 15.å®ç°callã€applyåŠbindå‡½æ•° 16.callã€applyå‡½æ•°çš„åŒºåˆ«åŒºåˆ«åœ¨äºä¼ å‚ä¸åŒï¼šapplyï¼šç¬¬äºŒä¸ªå‚æ•°ä¸ºæ•°ç»„æˆ–ç±»æ•°ç»„ï¼Œä½œä¸ºå‡½æ•°çš„å‚æ•°callï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¾€åå…¨æ˜¯å‡½æ•°çš„å‚æ•° é—­åŒ…ä»€ä¹ˆæ˜¯é—­åŒ…ï¼ˆå†…å±‚å‡½æ•°ä¸­è®¿é—®åˆ°å¤–å±‚å‡½æ•°çš„ä½œç”¨åŸŸï¼‰ä¸€ä¸ªå‡½æ•°ä¸å…¶å†…éƒ¨åˆ›å»ºçš„å‡½æ•°çš„ä½œç”¨åŸŸçš„è¿æ¥é˜»æ­¢äº†å‡½æ•°è°ƒç”¨ç»“æŸæ—¶å¯¹å‡½æ•°å†…éƒ¨å˜é‡çš„é”€æ¯ï¼Œå› ä¸ºå˜é‡è¢«é—­åŒ…å‡½æ•°å¼•ç”¨è§£å†³çš„é—®é¢˜å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨å‡½æ•°çš„å†…å®¹ä½¿ç”¨åœºæ™¯é˜²æŠ–èŠ‚æµåˆ›å»ºç§æœ‰å˜é‡æ–¹æ³•å»¶é•¿å˜é‡çš„ç”Ÿå‘½å‘¨æœŸé—­åŒ…çš„ç¼ºç‚¹ï¼šå˜é‡é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œé€ æˆå†…å­˜æŸè€—é—®é¢˜è§£å†³æ–¹æ³•ï¼šæ‰‹åŠ¨æ¸…ç©ºé—­åŒ…å‡½æ•° å¼‚æ­¥æ¨¡å¼17.å¼‚æ­¥ç¼–ç¨‹çš„å®ç°æ–¹å¼å›è°ƒå‡½æ•°Promiseæ–¹å¼generatorï¼ˆä¸ç†Ÿï¼‰asyncï¼Œpromiseçš„è¯­æ³•ç³– 18ã€setTimeoutã€Promiseã€AsyncAwaitçš„åŒºåˆ« 19ã€Promise.allå’ŒPromise.raceçš„åŒºåˆ«ä»¥åŠä½¿ç”¨åœºæ™¯Promise.all å°†å¤šä¸ªpromiseå®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„promiseå®ä¾‹æˆåŠŸï¼šè¿”å›ç»“æœæ•°ç»„å¤±è´¥ï¼šè¿”å›æœ€å…ˆè¢«rejectå¤±è´¥çŠ¶æ€çš„å€¼ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦å¤šä¸ªajaxè¯·æ±‚å…¨éƒ¨å›æ¥ä¹‹åæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä¸”è¿”å›æ•°ç»„é¡ºåºå’Œä¼ å…¥æ—¶çš„é¡ºåºä¸€æ ·Promise.raceä¼ å…¥çš„è¯·æ±‚ä¸­ï¼Œè¿”å›è¯·æ±‚å“åº”æœ€å¿«çš„ç»“æœ 20ã€å¯¹asyncawaitçš„ç†è§£æ˜¯promiseçš„ä¸€ç§è¯­æ³•ç³–ï¼Œèƒ½å¤Ÿè§£å†³å›è°ƒåœ°ç‹±asyncä¿®é¥°çš„å‡½æ•°ï¼Œè¿”å›å€¼æ˜¯promiseå¯¹è±¡awaitç”¨äºä¿®é¥°ä¸€æ­¥æ“ä½œasyncå‡½æ•°ä¸­ï¼Œä¼šç­‰å¾…awaitä»£ç æ‰§è¡Œç»“æŸåï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ jsæ˜¯å•çº¿ç¨‹è¯­è¨€ jsä»£ç ä¼šå…ˆæ‰§è¡Œå®ŒåŒæ­¥ä»»åŠ¡ï¼Œå†è¿›å…¥äº‹ä»¶å¾ªç¯ äº‹ä»¶å¾ªç¯ï¼šè¯·æ±‚ã€å®šæ—¶å™¨ã€äº‹ä»¶ æ£€æµ‹æ˜¯å¦æœ‰å¯æ‰§è¡Œçš„å¾®ä»»åŠ¡ æœ‰å¯æ‰§è¡Œçš„å¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå¾®ä»»åŠ¡ å¾®ä»»åŠ¡æ¸…ç©ºåæ‰§è¡Œå®ä»»åŠ¡ ä»»åŠ¡ç±»å‹ å®ä»»åŠ¡ setTimoutã€setInterval æ‰§è¡Œå‰æï¼šæ¸…ç©ºäº†æ‰€æœ‰çš„å¾®ä»»åŠ¡ å¾®ä»»åŠ¡ promise æ€§èƒ½ä¼˜åŒ–21ã€æµè§ˆå™¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ 22ã€å“ªäº›æƒ…å†µä¼šå¯¼è‡´å†…å­˜æ³„æ¼ åŸç†ç›¸å…³25ã€ä½ èƒ½ä¸¾å‡ºä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°çš„ä¾‹å­å—ï¼Ÿå®ƒæœ‰å“ªäº›å¥½å¤„ 26ã€ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Ÿè°ƒç”¨å †æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªå•çº¿ç¨‹å¾ªç¯ç”¨äºç›‘è§†è°ƒç”¨å †æ ˆå¹¶æ£€æŸ¥æ˜¯å¦æœ‰å·¥ä½œå³å°†åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­å®Œæˆå¦‚æœè°ƒç”¨å †æ ˆä¸ºç©ºå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰å›è°ƒå‡½æ•°ï¼Œåˆ™å°†å›è°ƒå‡½æ•°å‡ºé˜Ÿå¹¶æ¨é€åˆ°è°ƒç”¨å †æ ˆä¸­æ‰§è¡Œ jsè®¾è®¡æ¨¡å¼æœ‰å“ªäº› å‡ ä¸ªæ¯”è¾ƒè¦å‘½çš„é—®é¢˜ï¼š å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ httpæ¡æ‰‹ å¦‚ä½•åŒºåˆ†nullå’Œç©ºæ•°ç»„ Mapçš„å®šä¹‰æ–¹å¼ Objectå“ªäº›æ–¹æ³•ç”¨çš„æ¯”è¾ƒå¤š é˜²æŠ–èŠ‚æµ åŒæºç­–ç•¥"},{"title":"2025/02/11 å¹¿ç››æˆ¿åœ°äº§","path":"/wiki/Job/log_03_20250211_GuangSheng.html","content":"é¢è¯•å…¬å¸ï¼šå¾å·å¹¿ç››æˆ¿åœ°äº§ é¢è¯•å²—ä½ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021111:00 é¢è¯•æ—¶é•¿ï¼š20åˆ†é’Ÿ é¢è¯•ä½“éªŒï¼šæ¯”è¾ƒé¡ºåˆ© æŠ€æœ¯æ ˆï¼švueuniappant design of vueå¾®ä¿¡å°ç¨‹åº å…¬å¸ä»‹ç» å›½ä¼ï¼Œè´Ÿè´£å»ºè®¾åŠç®¡ç†è¿è¡Œç»´æŠ¤ä¿¡æ¯åŒ–ç³»ç»Ÿä¸šåŠ¡æ–¹å‘ï¼šç§»åŠ¨äº’è”ç½‘ä¼ ç»Ÿäº’è”ç½‘å¤§æ•°æ®æœåŠ¡ä¿¡æ¯åŒ–ç³»ç»Ÿå»ºè®¾åé—®ç¯èŠ‚æ–¹ä¾¿é—®ä¸€ä¸‹å…¬å¸å‰ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆå—å¯ä»¥é—®ä¸€ä¸‹å…¬å¸å¼€å‘å›¢é˜Ÿè§„æ¨¡å—å²—ä½çš„ä¸»è¦èŒè´£å’ŒæœŸå¾…äººé€‰å—å²—ä½æ˜¯å¦ç¨³å®š ä¸€é¢ï¼ˆæŠ€æœ¯ï¼‰csså¦‚ä½•å®ç°å±…ä¸­å—å¸ƒå±€ã€è¡Œå¸ƒå±€ã€è¡Œå†…å—å…ƒç´ åŒºåˆ«æ˜¯ä»€ä¹ˆå¦‚ä½•è§£å†³æµ®åŠ¨å¸ƒå±€å•è¡Œå¦‚ä½•å®ç°æ¢è¡Œæ—¶æ˜¾ç¤ºçœç•¥å·ä»‹ç»ä¸€ä¸‹box-sizingå±æ€§vue2computedå’Œwatchçš„åŒºåˆ«vue3è°ˆè°ˆä½ å¯¹ç»„åˆå¼apiçš„ç†è§£refå’Œreactiveæœ‰ä»€ä¹ˆåŒºåˆ«watchå’ŒwatchEffectçš„åŒºåˆ«æ˜¯ä»€ä¹ˆè·¯ç”±é’©å­æœ‰å“ªäº›vue3çš„ç”Ÿå‘½å‘¨æœŸTypeScripttypescriptå¦‚ä½•åŒºåˆ†nullå’Œundefinedå®šä¹‰å’Œæ¥æºnullè¡¨ç¤ºç©ºå€¼ï¼Œæ˜¯ä¸€ä¸ªå­—é¢é‡ï¼Œå¯ä»¥ç›´æ¥å°†å…¶èµ‹å€¼ç»™å˜é‡undefinedè¡¨ç¤ºå˜é‡å·²å£°æ˜ä½†æœªè¢«èµ‹å€¼ï¼Œæˆ–æ ¹æœ¬ä¸å­˜åœ¨å½“å£°æ˜ä¸€ä¸ªå˜é‡æœªèµ‹å€¼æ—¶ï¼Œå…¶é»˜è®¤å€¼å°±æ˜¯undefinedç±»å‹nullå’Œundefinedå„è‡ªæœ‰è‡ªå·±çš„ç±»å‹ç”¨é€”nullå¸¸ç”¨äºè¡¨ç¤ºä¸€ä¸ªé¢„æœŸå¯¹è±¡ä¸å­˜åœ¨æˆ–ä¸ºç©ºundefinedä¸å˜é‡çš„çŠ¶æ€æœ‰å…³æ¯”è¾ƒnullå’Œundefinedä½¿ç”¨æ˜¯ç›¸ç­‰çš„ï¼Œä¸‰ç­‰å·åˆ™ä¸ç›¸ç­‰ typeå’Œinterfaceçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå…³é”®åŒºåˆ«ï¼šæ‰©å±•æ€§typeåˆ«åæœ¬èº«æ— æ³•æ·»åŠ æ–°çš„å±æ€§interfaceæ˜¯å¯ä»¥æ‰©å±•çš„ç»§æ‰¿ä¸åŒinterfaceç»§æ‰¿æ—¶ï¼Œå¦‚æœé‡å†™ç±»å‹ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯typeäº¤å‰ç±»å‹ä¸ä¼šå®šä¹‰ä¸åŒæ¥å£ä½¿ç”¨interfaceå®šä¹‰ç±»å‹ä½¿ç”¨typeå®šä¹‰å®šä¹‰æ–¹å¼ä¸åŒinterfaceå¯ä»¥é€šè¿‡æ‰©å±•å…¶ä»–æ¥å£æ¥å®šä¹‰æ–°çš„æ¥å£ç±»å‹ä¹Ÿå¯ä»¥é€šè¿‡å£°æ˜åˆå¹¶æ¥æ‰©å±•å·²æœ‰çš„æ¥å£typeé€šå¸¸ç”¨äºå®šä¹‰å…·ä½“çš„ç±»å‹åˆ«åï¼Œå¯ä»¥åŸºäºå…¶å®ƒç±»å‹åˆ›å»ºæ–°çš„ç±»å‹å…¼å®¹æ€§æ£€æµ‹interfaceä¼šè¿›è¡Œå±æ€§çš„å…¼å®¹æ€§æ£€æŸ¥ï¼Œæ£€æŸ¥è¯¥ç±»å‹æ˜¯å¦å…·æœ‰æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•typeå¹¶ä¸ä¼šè¿›è¡Œä¸¥æ ¼çš„å…¼å®¹æ€§æ£€æŸ¥ï¼Œåªæ˜¯ç®€å•çš„å°†ç±»å‹è¿›è¡Œæ›¿æ¢æ‰©å±•èƒ½åŠ›ä¸åŒinterfaceå¯ä»¥ä½¿ç”¨å…³é”®å­—extendsæ‰©å±•typeå¯ä»¥ç”¨äºå®šä¹‰å„ç§ç±»å‹åˆ«å uniappuniappä¸­å¦‚ä½•è®¾ç½®å…¨å±€å˜é‡å®šä¹‰ä¸€ä¸ªä¸“ç”¨æ¨¡å—ï¼Œç”¨æ¥ç®¡ç†å…¨å±€å˜é‡å°†é¡¹ç›®ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„å˜é‡ï¼ŒæŒ‚è½½åˆ°Vue.prototypeä¸Šæ¯ä¸ªvueå¯¹è±¡éƒ½ä¼šå»ç»§æ‰¿è¿™äº›æ–¹æ³•å˜é‡ä½¿ç”¨globalDatavuex è¿›è¡ŒçŠ¶æ€ç®¡ç† uniappä¸­å¦‚ä½•è·å–domuniappå¦‚ä½•å®ç°è·¯ç”±ä¼ å‚ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›uniappå‡ ç§é¡µé¢è·³è½¬çš„æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒuniappé€šè¿‡setStorageå’ŒsetStotageSyncçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"},{"title":"2025/02/09 ä¸Šæµ·äº‘ç®€ä¸šè´¢","path":"/wiki/Job/log_02_20250209_YunJian.html","content":"é¢è¯•å…¬å¸ï¼šä¸Šæµ·äº‘ç®€ä¸šè´¢ é¢è¯•å²—ä½ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025020913:30 é¢è¯•æ—¶é•¿ï¼šï¼ˆç¬”è¯• 1é“é¢˜ï¼‰ +ï¼ˆä¸€é¢æŠ€æœ¯ 40minï¼‰+ï¼ˆäºŒé¢hr 40minï¼‰ é¢è¯•ä½“éªŒï¼šä¸€èˆ¬ çº¿ä¸Šç¬”è¯•ä¸€é¢ï¼šæŠ€æœ¯ï¼ˆ40minï¼‰ è‡ªæˆ‘ä»‹ç» é¡¹ç›®ç›¸å…³æé—® æŠ€æœ¯é—®é¢˜ é¡¹ç›®æé—®æˆ‘çœ‹åˆ°ä½ ç®€å†ä¸Šä»‹ç»äº†ä¸€äº›å¯è§†åŒ–å†…å®¹ï¼Œèƒ½è¯´ä¸€è¯´å…·ä½“æ˜¯å“ªäº›é¡¹ç›®ç”¨åˆ°äº†å¯è§†åŒ–å‘¢ç­”ï¼šé«˜è½¨å«æ˜Ÿæ€åŠ¿é¡¹ç›®ä¸­ï¼Œéœ€è¦å®ç°ä¸€ä¸ªèƒ½å¤Ÿå®æ—¶è¿½è¸ªå«æ˜Ÿè½¨è¿¹çš„å¯è§†åŒ–åœ°å›¾æ˜¯ç”¨åˆ°EChartsè¿›è¡Œæ¸²æŸ“åœ¨å¹¿è”ç§‘æŠ€å…¬å¸é‡Œä¸»è¦è´Ÿè´£å¯è§†åŒ–é¡¹ç›®çš„ç»„ç»‡å’Œå¼€å‘å…¶ä¸­æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æœ‰ï¼šå¾çŸ¿æ™ºæ…§æ ¡å›­é©¾é©¶èˆ±ç³»ç»Ÿã€ä¼ä¸šå·¥æ—¶ç›‘æ§å¤§å±é€‰æ‹©çš„æŠ€æœ¯æ ˆå¤§å¤šä¸ºEChartsã€Threejsï¼Œå¯¹ä¸€äº›è¦æ±‚æ¯”è¾ƒç‰¹æ®Šçš„å›¾è¡¨ï¼Œä¼šç”¨åˆ°D3è¿›è¡Œå®ç°åœ¨æœ€è¿‘çš„ä¸€ä¸ªAppé¡¹ç›®ä¸­å°½ç®¡æ˜¯Androidå’ŒIOSåŸç”Ÿå¼€å‘çš„Appï¼Œå¯è§†åŒ–å’Œæ¸¸æˆéƒ¨åˆ†ä¾æ—§ç”±æˆ‘è´Ÿè´£å¼€å‘ï¼Œé€šè¿‡webviewçš„æ–¹å¼åµŒå…¥åˆ°appä¸­ åœ¨ä»¥å¾€çš„é¡¹ç›®ä¸­ï¼Œå“ªä¸€ä¸ªè®©ä½ è§‰å¾—æ”¶è·æœ€å¤§å‘¢é‚£å°±è¿™ä¸ªé¡¹ç›®å¯ä»¥å±•å¼€è¯´è¯´å—ï¼Œè¯´è¯´å…·ä½“çš„åŠŸèƒ½ç‚¹é‚£åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ˜¯å¦‚ä½•è¿›è¡Œæƒé™ç®¡ç†çš„å‘¢é‚£ä¹ˆèƒ½è°ˆè°ˆè¿™ä¸ªç³»ç»Ÿçš„ç™»å½•æ˜¯å¦‚ä½•å®ç°çš„å—ï¼ŸæŠ€æœ¯é—®é¢˜å¦‚ä½•åŠ å¿«é¦–å±åŠ è½½çš„é€Ÿåº¦å‘¢ï¼Ÿå¦‚ä½•è·å–é¦–å±åŠ è½½æ—¶é—´å‘¢ï¼Ÿ DOMContentLoadperformancechromeæ§åˆ¶å°çš„performanceæ€§èƒ½ç›‘å¬ åŠ è½½æ…¢çš„åŸå›  ç½‘ç»œå»¶æ—¶èµ„æºæ–‡ä»¶ä½“ç§¯è¿‡å¤§é‡å¤è¯·æ±‚åŠ è½½èµ„æºæ–‡ä»¶åŠ è½½è„šæœ¬æ—¶ï¼Œæ¸²æŸ“å†…å®¹å µå¡ è§£å†³æ–¹æ³• å‡å°å…¥å£æ–‡ä»¶ä½“ç§¯ç½‘ç»œè¯·æ±‚æ¬¡æ•°è·¯ç”±æ‡’åŠ è½½å›¾ç‰‡æ‡’åŠ è½½ï¼ŒåªåŠ è½½ç”¨æˆ·è§†å£å¯è§çš„æ•°æ®scriptæ ‡ç­¾èµ„æºå¼‚æ­¥åŠ è½½ï¼Œä½¿ç”¨asyncå’ŒdeferåŠ è½½é™æ€èµ„æºæœ¬åœ°ç¼“å­˜é‡‡ç”¨httpç¼“å­˜ï¼Œè®¾ç½®cache-controlã€last-modifiedã€etagç­‰å“åº”å¤´UIæ¡†æ¶æŒ‰éœ€åŠ è½½æŒ‰éœ€å¼•å…¥UIåº“å›¾ç‰‡èµ„æºçš„å‹ç¼©è¿›è¡Œé€‚å½“å‹ç¼©iconå¯ä½¿ç”¨å­—ä½“å›¾æ ‡å°å›¾æ ‡å¯ä»¥ä½¿ç”¨é›ªç¢§å›¾çš„æ–¹å¼åˆå¹¶åˆ°åŒä¸€å¼ å›¾ä¸Šç»„ä»¶é‡å¤æ‰“åŒ…A.jsæ–‡ä»¶è¢«å¤šä¸ªè·¯ç”±å¼•ç”¨æ—¶ï¼Œé€ æˆäº†é‡å¤ä¸‹è½½webpackçš„configæ–‡ä»¶ä¸­ï¼Œè®¾ç½®CommonsChunkPluginçš„minChunksï¼Œæ‰“åŒ…æ•°é‡å¤§äºç­‰äºminChunksçš„åŒ…ä¼šè¢«æŠ½ç¦»åˆ°å…¬å…±ä¾èµ–æ–‡ä»¶ä¸­å¼€å¯GZipå‹ç¼©å®‰è£…compression-webpack-pluginæ’ä»¶ï¼Œè¿›è¡ŒåŒ…ä½“ç§¯å‹ç¼©æœåŠ¡å™¨ç«¯ä¹Ÿè¦åšç›¸åº”é…ç½®cssjshtmlimageç­‰æ–‡ä»¶éƒ½æ˜¯å¯ä»¥å‹ç¼©çš„ä½¿ç”¨CDNè¿›è¡ŒåŠ é€Ÿåˆ©ç”¨webpackçš„splitChunksè¿›è¡Œä»£ç åˆ†å‰²ï¼Œå¯¹jsè¿›è¡Œåˆ†ç‰‡SSRï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ç›¸å½“äºåå°å°†é¡µé¢ç»“æ„å’Œæ•°æ®å‡†å¤‡å¥½ï¼Œæµè§ˆå™¨ç«¯åªéœ€è¦è¿›è¡Œæ¸²æŸ“å³å¯ä½“éªŒæ–¹é¢å¢åŠ éª¨æ¶æ¡†å¢åŠ loadingåŠ¨ç”»æ•ˆæœ scriptçš„asyncæ ‡è®°çš„ä½¿ç”¨æ¡ä»¶æ˜¯ä»€ä¹ˆä½¿ç”¨æ¡ä»¶é€‚ç”¨äºç‹¬ç«‹è„šæœ¬ã€ç¬¬ä¸‰æ–¹è„šæœ¬è„šæœ¬ä¹‹é—´æ— ä¾èµ–å…³ç³»è„šæœ¬ä¸æ“ä½œdomæˆ–ä¸ä¾èµ–å…¶ä»–è„šæœ¬å› ä¸ºè„šæœ¬å¯èƒ½åœ¨domå®Œå…¨åŠ è½½ä¹‹å‰æ‰§è¡Œå¦‚æœæ˜¯å¯¹äºéœ€è¦æ“ä½œdomçš„è„šæœ¬ï¼Œå¯ä½¿ç”¨deferdeferå’Œasyncçš„åŒºåˆ«asyncæ‰§è¡Œé¡ºåºä¸ç¡®å®šdeferæ‰§è¡Œé¡ºåºç¡®å®š display:inline å’Œ display:inline-blockçš„åŒºåˆ«ç­”ï¼šä¸æ¸…æ¥šblockå…ƒç´ ç‹¬å ä¸€è¡Œå®½åº¦è‡ªåŠ¨å¡«æ»¡çˆ¶å…ƒç´ å®½åº¦å¯ä»¥è®¾ç½®widthã€heightå¯ä»¥è®¾ç½®marginã€paddingå±æ€§inlineä¸ä¼šç‹¬å ä¸€è¡Œè®¾ç½®widthheightæ— æ•ˆæ°´å¹³æ–¹å‘çš„marginpaddingæœ‰æ•ˆï¼Œå‚ç›´æ–¹å‘æ— æ•ˆinline-blockå°†å¯¹è±¡å‘ˆç°ä¸ºinlineå¯¹è±¡å¯¹è±¡çš„å†…å®¹ä½œä¸ºblockå¯¹è±¡å‘ˆç°å¯ä»¥ä½¿ä¸€ä¸ªå…ƒç´ æ—¢å…·å¤‡inlineçš„åŒè¡Œç‰¹æ€§ï¼Œåˆæœ‰blockçš„å®½é«˜ç‰¹æ€§é—®ï¼šæ‰€ä»¥ä½ ç”¨çš„éƒ½æ˜¯flexã€gridä¹‹ç±»çš„å¸ƒå±€æ–¹å¼å—ç­”ï¼šä¹Ÿæœ‰floatæ–¹å¼çš„å¸ƒå±€ absoluteå’Œtranslateçš„åŒºåˆ«æ˜¯ä»€ä¹ˆtranslateåŠ¨ç”»æ€§èƒ½æ›´ä¼˜ä¿ç•™æ–‡æ¡£æµï¼Œä¸ä¼šå½±å“å…ƒç´ å¸ƒå±€ï¼Œå¯¹éœ€è¦ä¿æŒå…ƒç´ ä¹‹é—´ç›¸å¯¹ä½ç½®çš„åœºæ™¯æœ‰ç”¨æ ¹æ®è‡ªèº«å®šä½æ”¯æŒ3då˜æ¢absoluteç›¸å¯¹äºç¥–å…ˆå…ƒç´ ï¼ˆéé™æ€å®šä½ï¼‰è¿›è¡Œå®šä½ä½¿ç”¨topleftç­‰å±æ€§è¿›è¡Œå®šä½éœ€è¦é€šè¿‡z-indexè®¾ç½®å †å é¡ºåºå®Œå…¨ä»æ–‡æ¡£æµä¸­ç§»é™¤ htmlä¸­ï¼Œå¦‚ä½•ä½¿ç”¨labelå’Œcheckboxï¼Œå®ç°æ–‡å­—å’Œå¤šé€‰æ¡†åŒæ—¶ç»‘å®šå‘¢labelæ ‡ç­¾æ·»åŠ forå±æ€§èƒ½ç»‘å®šforå±æ€§å€¼ä¸ºcheckboxçš„iddiv input type=checkbox id=check1 label for=check1 id=lab1123/label/div propertyå’Œattributeçš„åŒºåˆ«æ˜¯ä»€ä¹ˆä¸€ä¸ªhtmlæ ‡ç­¾åœ¨æµè§ˆå™¨ä¸­è§£æä¸ºdomå…ƒç´ æ—¶ï¼Œç”Ÿæˆçš„domå…ƒç´ ä¸Šå®šä¹‰çš„å±æ€§åŠpropertyï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªattributeså±æ€§ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„ç‰¹æ€§attributeç‰¹æ€§å€¼æ°¸è¿œæ˜¯å­—ç¬¦ä¸²nullå¤§å°å†™ä¸æ•æ„Ÿä¸å­˜åœ¨æ—¶è¿”å›nullæ“ä½œç‰¹æ€§çš„apihasAttributegetAttributesetAttributeremoveAttributepropertyå±æ€§å€¼å¯ä»¥æ˜¯ä»»æ„åˆæ³•jsç±»å‹å¤§å°å†™æ•æ„Ÿä¸å­˜åœ¨æ—¶è¿”å›undefinedå½“æ ‡å‡†ç‰¹æ€§attributeæ›´æ–°æ—¶ï¼Œå±æ€§propertyä¹Ÿä¼šæ›´æ–°input.valueåªèƒ½ç”±attributeä¿®æ”¹propertyattributeçš„valueæ›´åƒæ˜¯defaultValueè¿™ä¸ªpropertyä½¿ç”¨data-å¼€å¤´çš„attributeä¼šæ˜ å°„åˆ°DOMçš„datasetä¸­ï¼Œåˆ’çº¿æ ¼å¼ä¼šå˜æˆé©¼å³°æ ¼å¼ checkboxå‹¾é€‰å’Œæœªå‹¾é€‰çš„æ ‡è®°æ˜¯ä»€ä¹ˆç­”ï¼šå‹¾é€‰ä¸Švalueä¸ºtrueé—®ï¼šé‚£valueæ˜¯propertyè¿˜æ˜¯attributeå‘¢ç­”ï¼š å¯èƒ½æ˜¯propertyå§è¡¥å……å›ç­”ï¼šå›ç­”é”™äº†checkedå±æ€§ï¼šåæ˜ checkboxæ˜¯å¦è¢«é€‰ä¸­checkedå±äºpropertyvalueæ˜¯checkboxå¯¹åº”çš„å€¼ï¼Œç”¨äºè¡¨å•æ•°æ®çš„æäº¤valueå±æ€§attribute csså¦‚ä½•è§£å†³ä¸åŒæµè§ˆå™¨æ ·å¼å…¼å®¹çš„é—®é¢˜ä½¿ç”¨normalize.cssæ ‡å‡†åŒ–æ ·å¼åº“ä½¿ç”¨æµè§ˆå™¨ç§æœ‰å±æ€§ä½¿ç”¨csså…¼å®¹å·¥å…·ï¼Œæ¯”å¦‚Autoprefixerä½¿ç”¨postcsså¯ä»¥è¿›è¡Œcssåå¤„ç†ï¼Œè‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€postcss-px2remèƒ½å¤Ÿå®ç° å¯ä»¥å°†ä»£ç é‡Œçš„pxå•ä½è½¬æ¢ä¸ºremå•ä½ï¼Œåœ¨vue.config.jsä¸­ä½œä¸ºæ’ä»¶å¼•å…¥ æœ‰ä¸€ä¸ªå¼‚æ­¥æ•°ç»„ï¼Œå¦‚ä½•è®©è¿™ä¸ªå¼‚æ­¥æ•°ç»„ä¸­çš„è¯·æ±‚èƒ½å¤Ÿé¡ºåºæ‰§è¡Œconst list = []// è£…è½½å¼‚æ­¥è¯·æ±‚let num = 0async function fetchAll() while(num list.length) await(list[num]().then(res= num+=1 )) fetchAll() é‚£ä¹ˆå¦‚æœæƒ³ä½¿ç”¨4ä¸ªçº¿ç¨‹æ± åŒæ—¶æ‰§è¡Œè¿™ä¸ªå¼‚æ­¥æ•°ç»„çš„è¯ï¼Œå¦‚ä½•å®ç°ï¼Ÿconst list = []// è£…è½½å¼‚æ­¥è¯·æ±‚let num = 0async function fetchAll() while(num list.length) await(list[num]().then(res= num+=1 )) for(let i = 0; i 4;i++) fetchAll() é—®ï¼šå¦‚æœæˆ‘æƒ³ç”¨8ä¸ªå‘¢ï¼Ÿ ç­”ï¼šå¾ªç¯æ•°æ¢æˆ8 é—®ï¼šæµè§ˆå™¨å¯ä»¥åŒæ­¥æ‰§è¡Œ8ä¸ªè¯·æ±‚å—ï¼Ÿ ç­”ï¼šæœ€å¤š6ä¸ª é—®ï¼šuniappå®ç°çš„Appä¸­æœ‰è°ƒç”¨è¿‡åŸç”ŸSDKå— å¯ä»¥è¯´ä¸€ä¸‹ä¸‹é¢2ç§å®šä¹‰å‡½æ•°çš„åŒºåˆ«å—foo()// ç¬¬ä¸€ç§ è‡ªå®šä¹‰å‡½æ•°function foo()foo() //Error// ç¬¬äºŒç§ è¡¨è¾¾å¼ï¼Œç»™fooèµ‹å€¼ä¸€ä¸ªåŒ¿åå‡½æ•°var foo = ()=console.log(123) ç¬¬ä¸€ç§å†™æ³•ä¼šè¢«è§£æå™¨è‡ªåŠ¨æå‡åˆ°ä»£ç çš„å¤´éƒ¨ï¼ˆå‡½æ•°å£°æ˜æå‡ï¼‰ç¬¬äºŒç§ï¼Œè™½ç„¶varå®šä¹‰å¯ä»¥è¿›è¡Œå˜é‡æå‡ï¼Œä½†èµ‹å€¼ä¸ä¼šè¢«æå‡ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ ä½ å¹³å¸¸å¸¸ç”¨çš„éƒ¨ç½²å·¥å…·æœ‰å“ªäº›ä½¿ç”¨nginxæ—¶éƒ¨ç½²å¸¸ç”¨çš„é…ç½®é¡¹æœ‰å“ªäº›ä½¿ç”¨nginxéƒ¨ç½²å•é¡µé¢åº”ç”¨æ—¶ï¼Œä¼šåšå“ªäº›ç‰¹æ®Šé…ç½®SPAåº”ç”¨åªæœ‰ä¸€ä¸ªhtmlæ–‡ä»¶index.htmléœ€è¦å°†æ‰€æœ‰è·¯ç”±è¯·æ±‚é‡å®šå‘åˆ°index.htmltry_files $uri $uri index.htmlå³å½“è¯·æ±‚æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›index.htmlMPAåº”ç”¨è·¯ç”±ç”±æœåŠ¡å™¨ç«¯å¤„ç†æ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªhtmlæ–‡ä»¶è¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œè¿”å›404æ–‡ä»¶try_files $uri $uri -404 ä½¿ç”¨gitæ¯”è¾ƒå¤šè¿˜æ˜¯svnï¼Œæ˜¯ä¹ æƒ¯ç”¨å‘½ä»¤è¡Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹å·¥å…·ï¼Ÿå¸¸ç”¨gitæŒ‡ä»¤æœ‰å“ªäº›ï¼Ÿå¸¸ç”¨gitæŒ‡ä»¤ git clone åˆå§‹ä»“åº“git checkout teståˆ‡æ¢åˆ†æ”¯git checkoutæ”¾å¼ƒåˆ†æ”¯ä¿®æ”¹git statusæŸ¥çœ‹å½“å‰gitçŠ¶æ€git add .å°†ä¿®æ”¹åŠ å…¥ç¼“å­˜åŒºgit commit -m â€œå¤‡æ³¨ä¿®æ”¹â€æäº¤å†…å®¹åˆ°æœ¬åœ°ä»“åº“git reset HEADæ’¤é”€åŠ å…¥ç¼“å­˜åŒºçš„æ–‡ä»¶git reset HEAD~æ’¤é”€æäº¤åˆ°æœ¬åœ°ä»“åº“çš„æ–‡ä»¶git pullæ‹‰å–è¿œç¨‹ä»“åº“ä»£ç git logæŸ¥çœ‹æäº¤æ—¥å¿—git reset å›æ»šæ“ä½œ å¦‚æœæˆ‘å·²ç»git pushä¸Šå»äº†ï¼Œæƒ³è¦ä¿®æ”¹pushçš„ä¿¡æ¯åº”è¯¥å¦‚ä½•åšæ–¹æ³•1ï¼šå†æ¬¡æäº¤ï¼Œä¿®æ”¹æäº¤ä¿¡æ¯ä½¿ç”¨git commit â€“amendï¼Œä¿®æ”¹æäº¤ä¿¡æ¯æ–¹æ³•2ï¼šå›é€€commitgit reset â€“softhardsoftï¼šä¿ç•™å·¥ä½œç›®å½•hardï¼šå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å†…å®¹éƒ½è¢«æŠ¹æ‰git reset HEAD || git reset â€“mixed HEADæ”¹å˜çš„å·®å¼‚åœ¨å·¥ä½œåŒº äºŒé¢ï¼šhrï¼ˆ40minï¼‰å¯ä»¥ç®€å•çš„ä»‹ç»ä¸€ä¸‹è¿‡å»çš„å·¥ä½œç»å†å—åœ¨åŒ—äº¬çš„å·¥ä½œç»éªŒä¸­æœ‰å¸å–åˆ°ä»€ä¹ˆç»éªŒå—ï¼Ÿé‚£ä½ ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°ä¸Šæµ·æ¥å·¥ä½œå‘¢ï¼Ÿèƒ½å…·ä½“è¯´è¯´æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´ä½ æœ‰äº†â€œä¸šåŠ¡æ¯”æŠ€æœ¯æ›´åŠ é‡è¦â€çš„æ„Ÿæ‚Ÿå—ï¼Ÿé—®ï¼šæˆ‘æ²¡å¬æ‡‚ï¼Œå¯ä»¥å†è¯¦ç»†çš„è¯´è¯´å— é‚£ä½ æœªæ¥çš„èŒä¸šè§„åˆ’æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥è°ˆä¸€è°ˆä½ ä¸Šä¸€ä¸ªé¡¹ç›®ï¼Œä»¥åŠåœ¨ä¸Šä¸€ä¸ªé¡¹ç›®ä¸­çš„è§’è‰²å—è¯´ä¸€è¯´ä½ ä¸Šä¸€ä¸ªé¡¹ç›®ä¸­é‡åˆ°çš„æœ€éš¾å¾—é—®é¢˜ï¼Œä»¥åŠä½ æ˜¯æ€ä¹ˆè§£å†³å®ƒçš„ä½ ä¸Šä¸€ä»½å·¥ä½œçš„å·¥ä½œèŠ‚å¥å¦‚ä½•ç­”ï¼šéå¸¸å¿« é—®ï¼šæœ‰å¤šå¿«å‘¢ï¼Ÿæ¯”å¦‚è¯´å…·ä½“æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ ç­”ï¼šæ™šä¸ŠåŸºæœ¬éƒ½7ã€8ç‚¹ä¸‹ç­ï¼Œèµ¶ç‰ˆæœ¬çš„æ—¶å€™9ã€10ç‚¹å¸¸æ€ é‚£ä½ å¯¹è¿™ç§èŠ‚å¥ä½“éªŒå¦‚ä½•å‘¢ï¼Ÿ ç­”ï¼šæˆ‘ä¸ªäººæ˜¯æ¯”è¾ƒèƒ½é€‚åº”è¿™ç§å¿«èŠ‚å¥çš„å·¥ä½œçš„ ä½ å¯¹æœªæ¥å·¥ä½œçš„æœŸå¾…æ˜¯ä»€ä¹ˆå‘¢ï¼Œè¯·è¯´å…·ä½“ä¸€äº›"},{"title":"2025/02/11 å°è¥¿ç§‘æŠ€","path":"/wiki/Job/log_04_20250211_XiaoXi.html","content":"é¢è¯•å…¬å¸ï¼šå°è¥¿ç§‘æŠ€é›†å›¢ é¢è¯•å²—ä½ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021114:00 é¢è¯•æ—¶é•¿ï¼šçº¿ä¸Šç¬”è¯•ï¼ˆ80é“é€»è¾‘é¢˜ï¼‰ + 1é¢ï¼ˆ30minï¼‰ é¢è¯•ä½“éªŒï¼šä¸€èˆ¬ æŠ€æœ¯æ ˆï¼šhtmlcsses6vue å…¬å¸ä»‹ç» æŠ€æœ¯åˆ›æ–°ç±»æ——ä¸‹ä¸šåŠ¡æ¿å—çµç‹æ•°æ®ï¼šç§»åŠ¨åº”ç”¨æ•°æ®åˆ†æå¹³å°è«é‚ªäº’å¨±ï¼šå¡ç‰Œå’Œä¼‘é—²æ¸¸æˆç ”å‘ä¸å‘è¡Œç¥é¾™äº‘ï¼šäº‘è®¡ç®—è§£å†³æ–¹æ¡ˆåé—®ç¯èŠ‚æ–¹ä¾¿é—®ä¸€ä¸‹å…¬å¸å‰ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆå—å¯ä»¥é—®ä¸€ä¸‹å…¬å¸å¼€å‘å›¢é˜Ÿè§„æ¨¡å—å²—ä½çš„ä¸»è¦èŒè´£å’ŒæœŸå¾…äººé€‰å—å²—ä½æ˜¯å¦ç¨³å®š é¡¹ç›®ä»‹ç»ä½ åšè¿‡çš„æœ€å®Œæ•´çš„ä¸€ä¸ªé¡¹ç›®cssè¯´ä¸€ä¸‹vmvhremempxä¹‹é—´çš„åŒºåˆ«å¯ä»¥è¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯é‡ç»˜å’Œå›æµï¼ˆä¸ä¼šï¼‰æ˜¯ä»€ä¹ˆå›æµï¼šå¸ƒå±€å¼•æ“ä¼šæ ¹æ®å„ç§æ ·å¼è®¡ç®—æ¯ä¸ªç›’å­åœ¨é¡µé¢ä¸Šçš„å¤§å°ä¸ä½ç½®é‡ç»˜ï¼šå½“è®¡ç®—å¥½ç›’æ¨¡å‹çš„ä½ç½®ã€å¤§å°å’Œå…¶ä»–å±æ€§åï¼Œæµè§ˆå™¨æ ¹æ®æ¯ä¸ªç›’å­ç‰¹æ€§è¿›è¡Œç»˜åˆ¶æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶ï¼šè§£æhtmlï¼Œç”Ÿæˆdomæ ‘ï¼Œè§£æcssï¼Œç”Ÿæˆcssomæ ‘å°†domæ ‘å’Œcssomæ ‘ç»“åˆï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ï¼ˆrender treeï¼‰layoutå›æµï¼šæ ¹æ®æ¸²æŸ“æ ‘ï¼Œè¿›è¡Œå›æµï¼Œå¾—åˆ°èŠ‚ç‚¹çš„å‡ ä½•ä¿¡æ¯ï¼ˆä½ç½®ã€å¤§å°ï¼‰paintingé‡ç»˜ï¼šæ ¹æ®æ¸²æŸ“æ ‘è®°å¿†å›æµçš„å‡ ä½•ä¿¡æ¯ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„ç»å¯¹åƒç´ displayï¼šå°†åƒç´ å‘é€ç»™gpuï¼Œå±•ç¤ºåœ¨é¡µé¢ä¸Šå¦‚ä½•è§¦å‘å›æµè§¦å‘æ—¶æœºæ·»åŠ æˆ–åˆ é™¤å¯è§çš„domå…ƒç´ å…ƒç´ ä½ç½®å‘ç”Ÿå˜åŒ–å…ƒç´ å°ºå¯¸å‘ç”Ÿå˜åŒ–ï¼ˆå¤–è¾¹æ¡†ã€å†…è¾¹æ¡†ã€è¾¹æ¡†å¤§å°ã€é«˜åº¦ã€å®½åº¦ï¼‰å…ƒç´ å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œæ–‡æœ¬å˜åŒ–ã€å›¾ç‰‡è¢«å¦ä¸€ä¸ªä¸åŒå°ºå¯¸çš„å›¾ç‰‡æ‰€æ›¿æ¢é¡µé¢ä¸€å¼€å§‹æ¸²æŸ“æµè§ˆå™¨çª—å£å°ºå¯¸å˜åŒ–è¿™äº›å±æ€§éƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼šéœ€è¦é€šè¿‡å³æ—¶è®¡ç®—å¾—åˆ°getComputedStyleé‡ç»˜è§¦å‘æ—¶æœºé¢œè‰²ä¿®æ”¹æ–‡æœ¬æ–¹å‘ä¿®æ”¹é˜´å½±ä¿®æ”¹è§¦å‘å›æµä¸€å®šä¼šè§¦å‘é‡ç»˜æµè§ˆå™¨ä¼˜åŒ–æœºåˆ¶æµè§ˆå™¨ä¼šå°†æ“ä½œæ”¾å…¥å¯¹åˆ—è¡¨ä¸­ï¼Œæ‰¹é‡æ‰§è¡Œä¼˜åŒ–é‡æ’è¿‡ç¨‹å½“éœ€è¦è·å–æ­£ç¡®çš„å¸ƒå±€ä¿¡æ¯æ—¶ï¼Œä¼šå¼ºåˆ¶é˜Ÿåˆ—åˆ·æ–°ï¼Œè¿™æ ·offsetTopç­‰æ–¹æ³•éƒ½ä¼šè¿”å›æœ€æ–°çš„æ•°æ®å¦‚ä½•å‡å°‘æƒ³è¦è®¾ç½®å…ƒç´ æ ·å¼ï¼Œé€šè¿‡æ”¹å˜å…ƒç´ çš„classç±»å‹é¿å…è®¾ç½®å¤šé¡¹å†…è”æ ·å¼å¯¹äºå¤æ‚çš„åŠ¨ç”»ï¼Œè®¾ç½®position:fixedabsoluteï¼Œä½¿å…¶è„±ç¦»æ–‡æ¡£æµé¿å…ä½¿ç”¨tableå¸ƒå±€ï¼Œtableä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°ä»¥åŠå†…å®¹æ”¹åŠ¨ï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªtableçš„é‡æ–°è®¡ç®—css3ç¡¬ä»¶åŠ é€Ÿï¼Œè®©transformã€opacityã€filtersè¿™äº›åŠ¨ç”»ä¸ä¼šå¼•èµ·å›æµé‡ç»˜ cssé€‰æ‹©å™¨çš„ä¼˜å…ˆçº§cssä¸­çš„å¸¸ç”¨é€‰æ‹©å™¨ idé€‰æ‹©å™¨ #boxç±»é€‰æ‹©å™¨ .oneæ ‡ç­¾é€‰æ‹©å™¨ divåä»£é€‰æ‹©å™¨ #box divå­é€‰æ‹©å™¨ .oneone_1ç›¸é‚»åŒèƒé€‰æ‹©å™¨ .one+.twoç¾¤ç»„é€‰æ‹©å™¨ div,pä¼ªé€‰æ‹©å™¨ :hoverä¼ªå…ƒç´ é€‰æ‹©å™¨ :first-letter :beforeå±æ€§é€‰æ‹©å™¨ [attributevalue]ä¼ªç±»é€‰æ‹©å™¨ :nth-child ä¼˜å…ˆçº§ å†…è”æ ·å¼idé€‰æ‹©å™¨ç±»ã€ä¼ªç±»ã€å±æ€§é€‰æ‹©å™¨æ ‡ç­¾ã€ä¼ªå…ƒç´ é€‰æ‹©å™¨é€šé…ç¬¦ã€å­ç±»é€‰æ‹©å™¨ã€å…„å¼Ÿé€‰æ‹©å™¨ flexå¸ƒå±€å¦‚ä½•å±…ä¸­ä¸€ä¸ªå…ƒç´ ä»€ä¹ˆæƒ…å†µä¸‹è¦ç”¨çš„gridå¸ƒå±€å†™åŸç”Ÿcssè¿˜æ˜¯é¢„å¤„ç†å™¨cssä¼šé˜»å¡ç•Œé¢çš„æ¸²æŸ“å—å¯ä»¥è¯´ä¸€ä¸‹absoluteå’Œrelativeçš„åŒºåˆ«å—ï¼Œabsoluteæ˜¯ç›¸å¯¹äºè°å®šä½çš„htmlè¯´å‡ ä¸ªè¡Œå†…å…ƒç´ ã€å—çº§å…ƒç´ å—çº§å…ƒç´ divã€pã€h1ã€ulã€liè¡Œå†…å…ƒç´ spanã€aã€imgã€input ä»€ä¹ˆæ˜¯è¯­ä¹‰åŒ–æ ‡ç­¾æ ¹æ®å†…å®¹çš„è§£æ„ï¼Œé€‰æ‹©åˆé€‚çš„æ ‡ç­¾ï¼Œè®©æµè§ˆå™¨çš„çˆ¬è™«å’Œæœºå™¨èƒ½å¤Ÿæ›´å¥½åœ°è§£æè¿™æ˜¯ä¸ºäº†ä½¿é¡µé¢åœ¨æ²¡æœ‰cssçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¾ˆå¥½çš„å±•ç¤ºå‡ºé¡µé¢ç»“æ„æœ‰åˆ©äºseoæé«˜ä»£ç å¯è¯»æ€§ jså½“åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ªurlé“¾æ¥ä¹‹åï¼Œæ‰§è¡Œçš„æ“ä½œæ˜¯æ€ä¹ˆæ ·çš„å‘¢urlè§£æï¼Œåˆ†æåè®®ã€åŸŸåã€ç«¯å£ã€è·¯ç”±ã€ä¼ å‚dnsæŸ¥è¯¢ï¼Œè·å–ç›®æ ‡æœåŠ¡å™¨çš„ipåœ°å€tcpè¿æ¥ï¼Œç»å†3æ¬¡æ¡æ‰‹å»ºç«‹tcpè¿æ¥å‘é€httpè¯·æ±‚å“åº”è¯·æ±‚é¡µé¢æ¸²æŸ“è§£æhtmlï¼Œæ„å»ºdomæ ‘è§£æcssï¼Œæ„å»ºcssè§„åˆ™æ ‘åˆå¹¶domæ ‘å’Œcssè§„åˆ™ï¼Œç”Ÿæˆrenderæ ‘å¸ƒå±€renderæ ‘ï¼Œè´Ÿè´£ä¸ªå…ƒç´ å°ºå¯¸ã€ä½ç½®è®¡ç®—ç»˜åˆ¶renderæ ‘æµè§ˆå™¨å°†å„å±‚ä¿¡æ¯å‘ç»™GPUï¼ŒGPUå°†å„å±‚åˆæˆï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š sessionã€cookieã€localstorageåŒºåˆ«æ˜¯ä»€ä¹ˆcookieå¤§å°é™åˆ¶4kbå·¦å³ä¸€èˆ¬ç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå¯ä»¥è®¾ç½®å¤±æ•ˆæ—¶é—´æµè§ˆå™¨ç”ŸæˆCookieï¼Œé»˜è®¤å…³é—­æµè§ˆå™¨åå¤±æ•ˆæ¯æ¬¡éƒ½ä¼šæºå¸¦åœ¨httpå¤´ä¸­å¸¸ç”¨ï¼šéªŒè¯ç”¨æˆ·ç™»å½•æ˜¯å¦è¿‡æœŸlocalStorageæŒä¹…åŒ–æœ¬åœ°å­˜å‚¨ä¸€èˆ¬ä¸º5mbä»…åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¿å­˜å­˜æ”¾tokensessionStorageæ•°æ®åªæœ‰åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­çš„é¡µé¢æ‰èƒ½è®¿é—®ç»˜ç”»ï¼šæµè§ˆå™¨çª—å£æ²¡æœ‰å…³é—­ä¸€èˆ¬ä¸º5mb æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«è¯´ä¸€ä¸‹jsæœ‰å“ªå‡ ç§æ•°æ®æ ¼å¼å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®ç±»å‹æ˜¯å‡½æ•°ç±»å‹queryå’ŒparamsåŒºåˆ«æ˜¯ä»€ä¹ˆæœ‰ç”¨è¿‡é˜²æŠ–å’ŒèŠ‚æµå—Arrayå¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›vueè¯´ä¸€ä¸‹vueçš„ç”Ÿå‘½å‘¨æœŸcomputedå’Œwatchçš„åŒºåˆ«watchå’ŒwatchEffectçš„åŒºåˆ«å¦‚ä½•é˜²æ­¢ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œå°±è¿›è¡Œè·¯ç”±è·³è½¬å¦‚ä½•åŠ¨æ€æ·»åŠ è·¯ç”±ï¼ˆä¸ä¼šï¼‰ä½¿ç”¨router.addRoutesæ–¹æ³•åŠ¨æ€æ·»åŠ è·¯ç”±router.addRouteè¿˜å¯ä»¥åŠ¨æ€æ·»åŠ åµŒå¥—è·¯ç”± routerå’Œrouteçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå¦‚ä½•å®ç°è·¯ç”±ä¼ å‚è¯´ä¸€ä¸‹slotæ˜¯åšä»€ä¹ˆç”¨çš„å¦‚ä½•è¿›è¡Œæƒé™æ§åˆ¶ï¼ˆé‡ç‚¹ï¼‰è·¯ç”±æƒé™ç”¨æˆ·ç™»å½•ååªèƒ½çœ‹åˆ°è‡ªå·±æœ‰æƒè®¿é—®çš„å¯¼èˆªèœå•ï¼Œåªèƒ½è®¿é—®è‡ªå·±æœ‰æƒè®¿é—®çš„è·¯ç”±åœ°å€ï¼Œå¦åˆ™è·³è½¬404æç¤ºé¡µé¢æ–¹å¼ä¸€ï¼šåˆå§‹åŒ–æŒ‚è½½å…¨éƒ¨è·¯ç”±ï¼Œåœ¨è·¯ç”±ä¸Šæ ‡è®°æƒé™ä¿¡æ¯ï¼Œæ¯æ¬¡è·¯ç”±è·³è½¬åœ¨è·¯ç”±é’©å­é‡Œåšæ ¡éªŒæ²¡å¿…è¦åŠ è½½æ‰€æœ‰è·¯ç”±ï¼Œæ¶ˆè€—æ€§èƒ½å¤§å…¨å±€è·¯ç”±å®ˆå«é‡Œï¼Œæ¯æ¬¡è·¯ç”±è·³è½¬éƒ½è¦åšæƒé™åˆ¤æ–­èœå•ä¿¡æ¯å†™æ­»åœ¨å‰ç«¯è·¯ç”±è·Ÿèœå•è€¦åˆåœ¨ä¸€èµ·æ–¹å¼äºŒï¼šåˆå§‹åŒ–æ—¶å…ˆæŒ‚è½½ä¸éœ€è¦æƒé™æ§åˆ¶çš„è·¯ç”±ï¼ˆç™»å½•ã€404ç­‰é¡µé¢ï¼‰ï¼Œå¦‚æœç”¨æˆ·é€šè¿‡urlå¼ºåˆ¶è®¿é—®ï¼Œç›´æ¥è¿›å…¥404ç™»å½•åï¼Œè·å–ç”¨æˆ·æƒé™ï¼Œç­›é€‰æœ‰æƒé™è®¿é—®çš„è·¯ç”±ï¼Œåœ¨å…¨å±€è·¯ç”±å®ˆå«é‡Œè°ƒç”¨addRoutesæ·»åŠ è·¯ç”±æŒ‰éœ€æŒ‚è½½ï¼Œè·¯ç”±å°±éœ€è¦çŸ¥é“ç”¨æˆ·çš„è·¯æœ‰æƒé™å…¨å±€è·¯ç”±å®ˆå«é‡Œæ¯æ¬¡è·¯ç”±è·³è½¬éƒ½è¦åšåˆ¤æ–­è§†å›¾æ–¹é¢ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±æœ‰æƒæµè§ˆçš„å†…å®¹å’Œæœ‰æƒæ“ä½œçš„æ§ä»¶æŒ‰é’®æƒé™æ–¹å¼ä¸€ï¼šv-ifåˆ¤æ–­ç”¨æˆ·æƒé™roleæ–¹å¼äºŒï¼šè‡ªå®šä¹‰æŒ‡ä»¤è¿›è¡ŒæŒ‰é’®æƒé™åˆ¤æ–­èœå•æƒé™è·¯ç”±å’Œèœå•éƒ½ç”±åç«¯è¿”å›æ¥å£æƒé™è¶Šæƒè¯·æ±‚å°†åœ¨å‰ç«¯è¿›è¡Œæ‹¦æˆªé‡‡ç”¨jwtè¿›è¡ŒéªŒè¯ï¼Œæ²¡é€šè¿‡è¿”å›401ï¼Œè·³è½¬ç™»å½•é¡µé¢é‡æ–°ç™»é™†ç™»å½•å®Œæ‹¿åˆ°tokenï¼Œæ”¾åˆ°localstorageå­˜èµ·æ¥ï¼Œaxiosè¯·æ±‚æºå¸¦token piniaæœ‰å“ªäº›å±æ€§å‘¢state æ•°æ®å­˜æ”¾åœ°å¯ä»¥ç›´æ¥ä¿®æ”¹stateé‡Œé¢çš„å€¼vuxéœ€è¦é€šè¿‡mutationè¿›è¡Œä¿®æ”¹actions å¼‚æ­¥getters è®¡ç®—å±æ€§ vuexé¡µé¢åˆ·æ–°ä¹‹åæ•°æ®èƒ½ä¿ç•™å—è¯´è¯´ä½ å¯¹nextTickçš„ç†è§£åœ¨ä¸‹æ¬¡domæ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒåœ¨ä¿®æ”¹æ•°æ®ä¹‹åï¼Œç«‹å³è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è·å–æ›´æ–°åçš„dom reacté—¨æˆ·ç½‘ç«™æ˜¯ç”¨ssrå—é—¨æˆ·ç½‘ç«™æ˜¯å¦‚ä½•ä¼˜åŒ–çš„å‘¢"},{"title":"2025/02/12 é¢†é›","path":"/wiki/Job/log_06_20250212_LingYan.html","content":"é¢è¯•å…¬å¸ï¼šé¢†é›-å¤–åŒ…å®æ³¢é“¶è¡Œ é¢è¯•å²—ä½ï¼šå®æ³¢-å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021214:00 é¢è¯•æ—¶é•¿ï¼š12åˆ†é’Ÿå·¦å³ é¢è¯•ä½“éªŒï¼šä¸€èˆ¬ï¼Œæ²¡æœ‰åé—®ç¯èŠ‚ æŠ€æœ¯æ ˆï¼švue23ã€elementUIã€vantã€webpackã€es6 å…¬å¸ä»‹ç» æµ™æ±Ÿå®æ³¢é“¶è¡Œä¸€å‘¨ä»¥å†…å¯ä»¥åˆ°å²—æœŸå¾…è–ªèµ„8kåé—®æ–¹ä¾¿é—®ä¸€ä¸‹å…¬å¸å‰ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆå—å¯ä»¥é—®ä¸€ä¸‹å…¬å¸å¼€å‘å›¢é˜Ÿè§„æ¨¡å—å¯ä»¥é—®ä¸€ä¸‹å²—ä½çš„ä¸»è¦èŒè´£å’ŒæœŸå¾…äººé€‰å—å²—ä½æ˜¯å¦ç¨³å®š vuevueä¼ å€¼çš„æ–¹å¼vue2å’Œvue3çš„åŒºåˆ«è®²ä¸€ä¸‹è‡ªå·±åšè¿‡çš„æœ€å¤æ‚çš„ç»„ä»¶å°è£…echartså¸¸ç”¨çš„apiæœ‰å“ªäº›echartsçš„restoreç”¨è¿‡å—restoreæ˜¯echartsä¸­çš„ä¸€ä¸ªäº‹ä»¶ç±»å‹ç”¨äºé‡ç½®optionäº‹ä»¶ echartsçš„è‡ªå®šä¹‰äº‹ä»¶æœ‰ç”¨è¿‡å—echartsä¸­ä¸»è¦æ˜¯é€šè¿‡onæ–¹æ³•æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°clické¼ æ ‡äº‹ä»¶highlight é«˜äº®äº‹ä»¶downplay å–æ¶ˆé«˜äº®äº‹ä»¶selectchanged é€‰ä¸­çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘çš„äº‹ä»¶finished æ¸²æŸ“å®Œæˆäº‹ä»¶rendered æ¸²æŸ“ç»“æŸäº‹ä»¶ webpackä¸€ä¸ªé¡¹ç›®æ‰“åŒ…éƒ¨ç½²ä¹‹åï¼Œç”¨æˆ·å‘ç°æœåŠ¡ç•Œé¢ç™½å±ï¼Œä½ å¦‚ä½•è¿›è¡Œè°ƒè¯•å‘¢è·¯ç”±é…ç½®é—®é¢˜åˆ·æ–°ä¹‹åæ‰¾ä¸åˆ°èµ„æºï¼ŒæœåŠ¡å™¨é™æ€èµ„æºæ–‡ä»¶åŠ è½½å¤±è´¥vue-routeré…ç½®ä¸­è®¾ç½®modeä¸ºhistoryèµ„æºç¼“å­˜é—®é¢˜éœ€è¦æ¸…é™¤ç¼“å­˜æ•°æ®nginxé…ç½®èµ„æºè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´"},{"title":"2025/02/12 æ–°æ ¼å°”","path":"/wiki/Job/log_05_20250212_XinGeEr.html","content":"é¢è¯•å…¬å¸ï¼šæ–°æ ¼å°” é¢è¯•å²—ä½ï¼šå—äº¬-web3då¼€å‘å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021209:30 é¢è¯•æ—¶é•¿ï¼šæŠ€é¢ï¼ˆ30minï¼‰+ hré¢ï¼ˆ30minï¼‰ é¢è¯•ä½“éªŒï¼šè‰¯å¥½ï¼Œè™½ç„¶å›ç­”çš„ä¸å’‹æ ·ï¼Œä½†æ˜¯é¢è¯•å®˜æ¯”è¾ƒæœ‰è€å¿ƒï¼Œä¼šçº æ­£å’Œæç¤ºä½ ï¼Œ2åœºé¢è¯•é¢è¯•å®˜éƒ½ä¼šè®¤çœŸå›ç­”é—®é¢˜ æŠ€æœ¯æ ˆï¼š å‡ ä½•ç®—æ³•3DæŠ€æœ¯æ•°ç†é€»è¾‘ç®—æ³•ä¼˜åŒ–åç«¯æŠ€æœ¯ canvaswebglelectrontsthreejsbabylonjs å¾®ä¿¡å°ç¨‹åºuniappvue3 å…¬å¸ä»‹ç» æœŸå¾…è–ªèµ„ï¼š8kå®šåˆ¶å®¶å…·äº§ä¸šäº’è”ç½‘ä¼ä¸šBIMè½¯ä»¶è½¯ä»¶ï¼šæŸœæŸœAppç”»é—¨çª—è€æ¿è‰¯å››åˆé™¢é—¨çª—CCæµ‹é‡å¤§å¸ˆæŠ€æœ¯é¢åé—®æ–¹ä¾¿é—®ä¸€ä¸‹å…¬å¸å‰ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆå—å¯ä»¥é—®ä¸€ä¸‹å²—ä½çš„ä¸»è¦èŒè´£å’ŒæœŸå¾…äººé€‰å—æ€»é‡è¦çš„æ˜¯æ€åº¦å§ï¼Œéœ€è¦ç«¯æ­£æ€åº¦ï¼Œæ„¿æ„å­¦ä¹ web3dæŠ€æœ¯å¯ä»¥ä»‹ç»ä¸€ä¸‹æˆä¸ºä¸€ååœ¨web3dé¢†åŸŸæ¯”è¾ƒä¸“ä¸šçš„ç¨‹åºå‘˜å¤§æ¦‚éœ€è¦å¤šé•¿æ—¶é—´å—ï¼Ÿéœ€è¦æŒæ¡å“ªäº›æŠ€èƒ½å‘¢ï¼Ÿè¿™ä¸ªä¸»è¦çœ‹ä¸ªäººçš„å…´è¶£å’Œè¡ŒåŠ¨å§ï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„é©±åŠ¨åŠ›çš„è¯ï¼Œå¤§æ¦‚1å¹´å¤šå°±èƒ½æŒæ¡çš„æ¯”è¾ƒç†Ÿç»ƒäº†æŒæ¡æŠ€èƒ½é¦–å…ˆï¼Œæˆ‘ä»¬æ˜¯è¦å’Œvueå±‚è¿›è¡Œäº¤äº’ï¼Œéœ€è¦å¯¹vueçš„å®ç°åŸç†éå¸¸ç†Ÿæ‚‰å…¶æ¬¡ï¼Œä½¿ç”¨çš„å›¾å½¢åº“ä¸­çš„apiéœ€è¦è¶³å¤Ÿç†Ÿæ‚‰ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆè¦æœ‰è‡ªå·±çš„åˆ¤æ–­æœ€åï¼Œæˆ‘ä»¬æ˜¯é—¨çª—è¡Œä¸šçš„ï¼Œä½ è‡³å°‘éœ€è¦çŸ¥é“è¿™ä¸ªè¡Œä¸šå¯¹æŠ€æœ¯å±‚é¢çš„å®ç°æœ‰ä»€ä¹ˆè¦æ±‚å§hré¢åé—®å¯ä»¥äº†è§£ä¸€ä¸‹å²—ä½æ˜¯å¦æœ‰è€ƒæ ¸æ ‡å‡†å’Œä¸Šå‡ç©ºé—´å—ï¼Ÿå¯ä»¥ä»‹ç»ä¸€ä¸‹æˆ‘æ‰€åº”è˜çš„å²—ä½ï¼Œéƒ¨é—¨äººå‘˜æ€æ ·ç»„æˆçš„å‘¢æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼šå’±ä»¬è¿™ä¸ªå²—ä½å¯¹è½¯ä»¶å¼€å‘ã€å›¾å½¢å­¦ã€æ•°ç†é€»è¾‘ä»¥åŠä¸šåŠ¡ç†è§£èƒ½åŠ›è¦æ±‚éƒ½æ¯”è¾ƒé«˜æˆ‘ä¸ªäººæ˜¯éå¸¸æ„Ÿå…´è¶£çš„ï¼Œä¹Ÿæ„¿æ„ç§¯æçš„äº†è§£å’Œå­¦ä¹ æ–¹ä¾¿é—®ä¸€ä¸‹ï¼Œæ‚¨è®¤ä¸ºè¦åœ¨è¿™ä¸ªå²—ä½ä¸Šåšçš„éå¸¸å‡ºè‰²ï¼Œéœ€è¦å…·å¤‡å“ªäº›ç‰¹è´¨å‘¢ï¼Ÿ æŠ€æœ¯é—®é¢˜jssessionã€localstorageã€cookieåŒºåˆ«æ˜¯ä»€ä¹ˆè¯´ä¸€ä¸‹å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡å“ªä¸ªå…ˆæ‰§è¡Œè¯´ä¸€ä¸‹å †å’Œæ ˆçš„åŒºåˆ«å †å’Œæ ˆæ˜¯2ç§ä¸åŒçš„å†…å­˜ç®¡ç†æ–¹å¼ï¼Œç”¨äºå­˜å‚¨ä¸åŒç±»å‹çš„æ•°æ®å †ï¼ˆHeapï¼‰ç”¨äºåŠ¨æ€åˆ†é…å†…å­˜çš„æ•°æ®å­˜å‚¨å¼•ç”¨ç±»å‹æ•°æ®ï¼Œå¦‚å¯¹è±¡å’Œæ•°ç»„æ ˆï¼ˆStackï¼‰ç”¨äºå­˜å‚¨åŸºæœ¬ç±»å‹æ•°æ®ï¼Œä»¥åŠå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†é…å›ºå®šå¤§å°çš„å†…å­˜å†…å­˜ç®¡ç†ç”±ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ï¼Œé€šè¿‡æ ˆæŒ‡é’ˆçš„ç§»åŠ¨æ¥åˆ†é…å’Œé‡Šæ”¾å†…å­˜åœ¨å †ä¸­åˆ†é…çš„å†…å­˜ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œéœ€è¦åƒåœ¾å›æ”¶æœºåˆ¶ è¯´ä¸€ä¸‹æµ…æ‹·è´å’Œæ·±æ‹·è´åŒºåˆ« æµ…æ‹·è´åˆ›å»ºæ–°çš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æœ‰ç€åŸå§‹æ•°æ®å±æ€§å€¼çš„ä¸€ä»½ç²¾ç¡®æ‹·è´å¦‚æœå±æ€§æ˜¯åŸºæœ¬å€¼ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼å¦‚æœå±æ€§æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€æ·±å±‚æ¬¡çš„å¼•ç”¨ç±»å‹åˆ™å…±äº«å†…å­˜åœ°å€æµ…æ‹·è´å®ç°æ–¹æ³•Object.assignä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦å®ç°çš„å¤åˆ¶sliceconcatæ·±æ‹·è´å¼€è¾Ÿä¸€ä¸ªæ–°çš„æ ˆï¼Œä¸¤ä¸ªå¯¹è±¡å±æ€§å®Œå…¨ç›¸åŒï¼Œå¯¹åº”çš„åœ°å€ä¸åŒä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä¸ä¼šæ”¹å˜å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ·±æ‹·è´æ–¹å¼_.cloneDeep()jQuery.extend()JSON.stringify()ç¼ºç‚¹ï¼šä¼šå¿½ç•¥undefinedã€symbolã€å‡½æ•°æ‰‹å†™å¾ªç¯é€’å½’ ä½¿ç”¨JSON.parseæœ‰ä»€ä¹ˆé—®é¢˜JSON.stringifyä¼šå¿½ç•¥undefinedã€symbolå’Œå‡½æ•° è¯´ä¸€ä¸‹es6å¸¸ç”¨çš„ç‰¹æ€§æœ‰å“ªäº›mapå’Œsetçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›es6ä¸­promiseå¸¸ç”¨çš„åœºæ™¯æœ‰å“ªäº›Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆä½¿ç”¨Promise.thenå®ç°é“¾å¼æ“ä½œpromiseæœ‰ä¸‰ç§çŠ¶æ€pending è¿›è¡Œä¸­fulfilled å·²æˆåŠŸrejected å·²å¤±è´¥ä¸€æ—¦çŠ¶æ€æ”¹å˜æ— æ³•é‡æ–°ä¿®æ”¹ç”¨æ³•all è¿”å›æ‰€æœ‰å¼‚æ­¥è¯·æ±‚çš„ç»“æœï¼Œéœ€è¦æ‰€æœ‰å¼‚æ­¥å“åº”çŠ¶æ€éƒ½æˆåŠŸrace è¿”å›æœ€å…ˆæœ‰å“åº”çš„å¼‚æ­¥è¯·æ±‚ç»“æœallSettled è¿”å›æ‰€æœ‰å¼‚æ­¥è¯·æ±‚ç»“æœï¼Œä¸ç®¡è¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥resolve è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå®ä¾‹çš„çŠ¶æ€æ˜¯fulfilledreject è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå®ä¾‹çš„çŠ¶æ€æ˜¯rejectedä½¿ç”¨åœºæ™¯å½“éœ€è¦åŒæ—¶è·å–åˆ°å‡ ä¸ªæ¥å£çš„å“åº”ï¼Œå†æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œæ—¶ï¼Œä½¿ç”¨Promise.allé€šè¿‡Promiseå¼‚æ­¥è¯·æ±‚è·å–åˆ°æ¥å£æ•°æ®ä¹‹åï¼Œæ‰§è¡Œthenæ“ä½œï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ•°æ®å¤„ç† è¯´ä¸€ä¸‹nullå’Œundefinedçš„åŒºåˆ«csså¯ä»¥è®²ä¸€ä¸‹ä»€ä¹ˆæ˜¯bfcå—BFCï¼ˆBlock Formatting Contextï¼‰å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆå½¢æˆä¸€ä¸ªç›¸å¯¹äºå¤–ç•Œå®Œå…¨ç‹¬ç«‹çš„ç©ºé—´ï¼Œè®©å†…éƒ¨çš„å­å…ƒç´ ä¸ä¼šå½±å“å¤–éƒ¨çš„å…ƒç´ ï¼‰æ˜¯é¡µé¢çš„ä¸€å—æ¸²æŸ“åŒºåŸŸï¼Œæœ‰ä¸€å¥—è‡ªå·±çš„æ¸²æŸ“è§„åˆ™å†…éƒ¨çš„ç›’å­ä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®å¯¹äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»ç›’å­çš„marginä¼šå‘ç”Ÿé‡å ï¼Œä¸æ–¹å‘æ— å…³æ¯ä¸ªå…ƒç´ çš„å·¦è¾¹è·ä¸åŒ…å«å—çš„å·¦è¾¹ç•Œç›¸æ¥è§¦ï¼ˆä»å·¦åˆ°å³ï¼‰ï¼Œå³ä½¿æµ®åŠ¨å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤BFCçš„åŒºåŸŸä¸ä¼šä¸floatçš„å…ƒç´ åŒºåŸŸé‡å è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨çš„å­å…ƒç´ ä¸ä¼šå½±å“å¤–é¢çš„å…ƒç´ å¦‚ä½•è§¦å‘BFCoverflow:hiddendisplay:inline-blockposition:absolute|fixeddisplay:table-cell|flexbfcåº”ç”¨åœºæ™¯é˜²æ­¢marginé‡å è§£å†³æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªç›’å­å¤–é¢åŒ…è£¹ä¸€ä¸ªdivç›’å­æ¸…é™¤å†…éƒ¨æµ®åŠ¨è§£å†³æ–¹å¼ï¼šçˆ¶ç»„ä»¶overflow:hiddenè‡ªé€‚åº”å¤šæ å¸ƒå±€ï¼šå·¦è¾¹ä½¿ç”¨æµ®åŠ¨ï¼Œå³è¾¹æ å·¦ä¾§ä¸çˆ¶ç›’å­çš„å·¦è¾¹æ ç›¸è§¦ï¼Œè§£å†³æ–¹æ³•ï¼šç»™å³è¾¹æ æ·»åŠ overflow:hidden å¯ä»¥è®²ä¸€ä¸‹iframeçš„ç¼ºç‚¹å—ä¼˜ç‚¹ iframeèƒ½å¤Ÿæ˜¾ç¤ºåµŒå…¥çš„ç½‘é¡µå¯ä»¥å®ç°å¤´éƒ¨ã€èœå•ã€å°¾éƒ¨ç»„ä»¶ä¸å˜ï¼Œä»…ä»…å¯¹iframeåµŒå¥—éƒ¨åˆ†ä¿®æ”¹é¡µé¢å†…å®¹ï¼Œå®ç°ä»£ç å¤ç”¨ ç¼ºç‚¹ iframeä¼šé˜»å¡ä¸»é¡µé¢çš„onloadäº‹ä»¶iframeå’Œä¸»é¡µé¢å…±äº«è¿æ¥æ± ï¼Œæµè§ˆå™¨å¯¹ç›¸åŒåŸŸè¿æ¥æ•°é‡æœ‰é™åˆ¶ï¼Œå½±å“é¡µé¢çš„å¹¶è¡ŒåŠ è½½ä½¿ç”¨iframeä¸åˆ©äºseoä¼˜åŒ–å¯¹å¾ˆå¤šç§»åŠ¨è®¾å¤‡è€Œè¨€ï¼Œiframeå…¼å®¹æ€§å·®ä½¿ç”¨iframeä¼šå¢åŠ æœåŠ¡å™¨çš„httpè¯·æ±‚ å¦‚ä½•å®ç°ä¸€ä¸ªå®½åº¦ä¸º0.5pxçš„çº¿å®½è¾¹æ¡†å‘¢ä½¿ç”¨box-shadowå®ç°ä½¿ç”¨border+transform-scaleYç¼©æ”¾ä½¿ç”¨ä¼ªå…ƒç´ é€‰æ‹©å™¨:after:before + transform-scaleYç¼©æ”¾ å¤§å±çš„å“åº”å¼å¤§å°æ˜¯æ€ä¹ˆåšçš„htmlhrefå’Œsrcçš„åŒºåˆ«æ˜¯ä»€ä¹ˆè¯·æ±‚èµ„æºç±»å‹ä¸åŒhrefï¼šç”¨æ¥ç®€å†å½“å‰å…ƒç´ å’Œæ–‡æ¡£ä¹‹é—´çš„é“¾æ¥ï¼Œå¸¸ç”¨æœ‰linkasrcï¼šä¼šå°†å…¶æŒ‡å‘èµ„æºä¸‹è½½å¹¶åº”ç”¨åˆ°æ–‡æ¡£ä¸­ï¼Œå¸¸ç”¨æœ‰scriptimgiframeä½œç”¨ç»“æœä¸åŒhrefç”¨äºæ–‡æ¡£å’Œèµ„æºä¹‹é—´å»ºç«‹å…³ç³»srcç”¨äºæ›¿æ¢å½“å‰å†…å®¹æµè§ˆå™¨è§£ææ–¹å¼ä¸åŒhrefï¼šæµè§ˆå™¨ä¼šè¯†åˆ«æ–‡æ¡£ä¸ºcssï¼Œå¹¶è¡Œä¸‹è½½èµ„æºå¹¶ä¸”ä¸ä¼šåœæ­¢å¯¹å½“å‰æ–‡æ¡£çš„å¤„ç†srcï¼šä¼šæš‚åœå…¶ä»–èµ„æºçš„ä¸‹è½½å’Œå¤„ç†ï¼Œç›´åˆ°è¯¥èµ„æºåŠ è½½ã€ç¼–è¯‘ã€æ‰§è¡Œå®Œæ¯•ï¼Œå°†æ‰€æŒ‡å‘èµ„æºåº”ç”¨åˆ°å½“å‰å†…å®¹ï¼Œå› æ­¤å»ºè®®å°†jsè„šæœ¬æ”¾åœ¨å°¾éƒ¨æ‰§è¡Œ vueäº†è§£vueçš„mixinå—mixinæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¯­è¨€ä¸­çš„ç±»ï¼Œå…¶ä»–ç±»å¯ä»¥è®¿é—®mixinç±»çš„æ–¹æ³•è€Œä¸å¿…æˆä¸ºå…¶å­ç±»mixinç±»å¸¸ç”¨ä½œåŠŸèƒ½æ¨¡å—ä½¿ç”¨ï¼Œåœ¨éœ€è¦è¯¥åŠŸèƒ½æ—¶è¿›è¡Œæ··å…¥ï¼Œåˆ©äºä»£ç å¤ç”¨é¿å…å¤šç»§æ‰¿çš„å¤æ‚Vueçš„mixinç”¨æ¥åˆ†å‘vueç»„ä»¶ä¸­çš„å¯å¤ç”¨å†…å®¹æœ¬è´¨æ˜¯ä¸€ä¸ªjså¯¹è±¡å½“ç»„ä»¶ä½¿ç”¨mixinså¯¹è±¡æ—¶ï¼Œæ‰€æœ‰mixinså¯¹è±¡çš„é€‰é¡¹éƒ½è¢«æ··å…¥è¯¥ç»„ä»¶æœ¬èº«çš„é€‰é¡¹ä¸­vueæ”¯æŒå±€éƒ¨æ··å…¥å’Œå…¨å±€æ··å…¥å±€éƒ¨æ··å…¥å®šä¹‰ä¸€ä¸ªmixinå¯¹è±¡ï¼Œæœ‰optionsçš„dataã€methodså±æ€§ï¼Œç»„ä»¶é€šè¿‡mixinså±æ€§è°ƒç”¨mixinå¯¹è±¡å…¨å±€æ··å…¥Vue.mixin({created:(){}})å¸¸ç”¨äºæ’ä»¶çš„ç¼–å†™ç»„ä»¶çš„é€‰é¡¹ä¼šè¦†ç›–mixinçš„é€‰é¡¹å¦‚æœç›¸åŒçš„é€‰é¡¹æ˜¯ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¼šåˆå¹¶æˆæ•°ç»„ï¼Œå…ˆæ‰§è¡Œmixinçš„é’©å­ï¼Œåœ¨æ‰§è¡Œç»„ä»¶çš„é’©å­ä½¿ç”¨åœºæ™¯å®šä¹‰ä¸€ä¸ªmodalå¼¹çª—ç»„ä»¶ è¯´ä¸€ä¸‹hashå’Œhistoryçš„åŒºåˆ«èƒ½è¯´ä¸€ä¸‹v-modelçš„å®ç°åŸç†å—å¦‚æœä¸æ˜¯ç»‘å®šçš„valueï¼Œv-modelæ˜¯å¦‚ä½•å®ç°ç»‘å®šçš„å‘¢åŸç”Ÿv-modelï¼šå¯ä»¥çœ‹æˆæ˜¯valueå’Œinputçš„è¯­æ³•ç³–è‡ªå®šä¹‰ï¼špropä¼ å…¥å€¼ï¼Œåœ¨å­ç»„ä»¶ä¸­é€šè¿‡emitäº‹ä»¶å¯¹propè¿›è¡Œæ›´æ–° è¯´ä¸€ä¸‹çˆ¶å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨é¡ºåºé¡¹ç›®é—®é¢˜æœ‰ç”¨è¿‡canvasç”»å›¾çš„ä¸€äº›åº“å—çœ‹åˆ°ä½ ç”¨åˆ°äº†è‹¥ä¾æ¡†æ¶ï¼Œå½“èœå•è¿‡å¤šæ—¶æœ‰é‡åˆ°è¿‡æ ˆæº¢å‡ºçš„æƒ…å†µå—ä»€ä¹ˆåœºæ™¯ç”¨åˆ°websocketäº†å‘¢uniappå®ç°çš„å°ç¨‹åºå¦‚ä½•å®ç°ç™»å½•åŠŸèƒ½wx.loginè·å–ç”¨æˆ·çš„codeï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æˆæƒè¯»å–ç”¨æˆ·ä¿¡æ¯è°ƒç”¨wx.getUserInfoè¯»å–ç”¨æˆ·æ•°æ®é€šè¿‡wx.requestè¯·æ±‚ä¸šåŠ¡æ–¹æœåŠ¡å™¨ï¼Œåç«¯æŠŠappidã€å°ç¨‹åºå¯†é’¥ã€codeä¸€èµ·å‘é€åˆ°å¾®ä¿¡æœåŠ¡å™¨æœåŠ¡å™¨è¿”å›äº†openidåŠä¼šè¯å¯†é’¥session_keyåç«¯ä»æ•°æ®åº“æŸ¥æ‰¾openidæ²¡æ‰¾åˆ°ï¼Œç”¨æˆ·æ²¡æ³¨å†Œsession_keyæ˜¯å¯¹ç”¨æˆ·æ•°æ®è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥ç”Ÿæˆsessionè¿”å›ç»™å°ç¨‹åºï¼Œå­˜å…¥storageä¸‹æ¬¡è¯·æ±‚æ—¶ï¼Œä»storageé‡Œè¯»å–ï¼Œå‘é€ç»™æœåŠ¡ç«¯æœåŠ¡ç«¯æ¯”å¯¹sessionè®°å½•ï¼Œæ ¡éªŒæœ‰æ•ˆæœŸ å…¶å®ƒé—®é¢˜ä¹‹å‰åšçš„Appçš„ç›´æ’­æ˜¯æ€ä¹ˆå®ç°çš„ï¼ŒAppé‡Œçš„3däº¤äº’å®ç°çš„å…·ä½“å†…å®¹æ˜¯ä»€ä¹ˆelectronåšçš„é¡¹ç›®æ˜¯åŒ…å£³è¿˜æ˜¯ä»€ä¹ˆï¼Œé‡Œé¢åŒ…çš„æ˜¯é“¾æ¥å—æœ‰æ²¡æœ‰å¼€å‘è¿‡éœ€è¦å’Œæ¡Œé¢ç¡¬ä»¶è¿›è¡Œè”åŠ¨çš„é¡¹ç›®èƒ½æ¥å—ä»threejsè½¬Babylonjså— HRé¢è¯•å¯ä»¥ç®€è¿°ä¸€ä¸‹è¿‡å¾€å…¬å¸æ˜¯åšä»€ä¹ˆçš„ï¼Œå…¬å¸è§„æ¨¡ä»¥åŠç ”å‘å›¢é˜Ÿè§„æ¨¡å—ï¼Ÿå¯ä»¥ä»‹ç»ä¸€ä¸‹ä½ åœ¨æ¯å®¶å…¬å¸çš„ç¦»èŒåŸå› å—ï¼Ÿå¯ä»¥ç®€è¿°ä¸€ä¸‹ä½ åœ¨ä¸Šä»½å·¥ä½œä¸­è´Ÿè´£çš„æ¨¡å—å—ï¼Ÿé™¤äº†å·¥ä½œä¹‹å¤–ï¼Œä½ è¿˜æœ‰å…¶å®ƒçˆ±å¥½å—ï¼Ÿä½ çš„æœ‹å‹å¯¹ä½ çš„è¯„ä»·æ˜¯ä»€ä¹ˆï¼Ÿä½ æ˜¯å¦‚ä½•çœ‹å¾…åŠ ç­çš„ï¼Ÿä½ çš„èŒä¸šè§„åˆ’æ˜¯ä»€ä¹ˆï¼Ÿæœ‰æ²¡æœ‰æœç®¡ç†æ–¹å‘å‘å±•çš„æ„å‘ï¼Ÿç›®å‰æœ‰æ²¡æœ‰æ”¶åˆ°å…¶å®ƒå…¬å¸çš„offerä¸Šå­¦æœŸé—´æˆç»©æ€ä¹ˆæ ·"},{"title":"2025/02/12 æ¶¦å’Œç§‘æŠ€","path":"/wiki/Job/log_07_20250212_RunHe.html","content":"é¢è¯•å…¬å¸ï¼šæ¶¦å’Œè½¯ä»¶-åä¸ºæµ·æ€èŠ¯ç‰‡ç ”å‘ é¢è¯•å²—ä½ï¼šä¸Šæµ·-ä¸­çº§å‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021215:00 é¢è¯•æ—¶é•¿ï¼š30min é¢è¯•ä½“éªŒï¼šä¸€èˆ¬ï¼Œé¢è¯•å®˜æ„Ÿè§‰ä¸€å‘¨éƒ½æ²¡ä¼‘æ¯ï¼Œéå¸¸ç–²æƒ« æŠ€æœ¯æ ˆï¼šåŸºç¡€å‰ç«¯æŠ€æœ¯ã€å‰ç«¯æ¡†æ¶ã€å¸¸ç”¨æ•°æ®åº“mysql å…¬å¸ä»‹ç» åä¸ºæµ·æ€èŠ¯ç‰‡ç ”å‘å¤–åŒ…é¡¹ç›®ä¸Šæµ·é’æµ¦ä¸Šç­ï¼Œé¡¹ç›®å‘¨æœŸ8-10å¹´ï¼ŒåŒä¼‘æœŸæœ›è–ªèµ„12kåé—®æ–¹ä¾¿é—®ä¸€ä¸‹å…¬å¸å‰ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆå—å¯ä»¥é—®ä¸€ä¸‹å…¬å¸å¼€å‘å›¢é˜Ÿè§„æ¨¡å—å¯ä»¥é—®ä¸€ä¸‹å²—ä½çš„ä¸»è¦èŒè´£å’ŒæœŸå¾…äººé€‰å—å²—ä½æ˜¯å¦ç¨³å®š æŠ€æœ¯é—®é¢˜åœºæ™¯é—®é¢˜ï¼šExcelè¡¨æ ¼æœ‰è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼Œä¸€å¼ excelè¡¨æ ¼ï¼Œä¼šæœ‰ä¸åŒè§’è‰²çš„ç”¨æˆ·å»è®¿é—®ï¼Œè¿™å¼ excelè¡¨ä½ è¦å¦‚ä½•å¯¼å…¥åˆ°æ•°æ®åº“ä¸­å‘¢ï¼ˆä»å‰ç«¯è§’åº¦ï¼‰ï¼Ÿè¡¨æ ¼ä¸Šæ˜¾ç¤ºçš„ä¸œè¥¿ä¼šæ ¹æ®ç”¨æˆ·çš„è§’è‰²åšåŒºåˆ†å¹¶ä¸”è¿™å¼ è¡¨éœ€è¦ç»è¿‡å„ä¸ªå±‚è¿›è¡Œç¡®è®¤ç­¾å­—èµ°æµç¨‹è¿™ä¸ªåŠŸèƒ½ä½ èƒ½å®ç°å—ï¼ŸåŒ…æ‹¬æ„å»ºã€å¼€å‘ã€éƒ¨ç½² èƒ½è¯´ä¸€ä¸‹å‰ç«¯æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªé¡µé¢çš„å—å¦‚æœä½ çš„npmå®‰è£…æ—¶ç”±äºæŸäº›åŸå› é•œåƒæ‹‰å–ä¸åˆ°èµ„æºï¼Œå¦‚ä½•è§£å†³å¦‚ä½•è§£å†³è·¨åŸŸèƒ½è¯´ä¸€ä¸‹axiosçš„å®ç°åŸç†å—HTTPè¯·æ±‚å‘é€æµè§ˆå™¨ï¼šä½¿ç”¨XMLHttpRequestæ¥å‘é€HTTPè¯·æ±‚Nodeç¯å¢ƒï¼šä½¿ç”¨node.jsçš„httpæ¨¡å—Promiseå¼‚æ­¥è¯·æ±‚axiosè¿”å›promiseå¯¹è±¡ä½¿ç”¨.thenå’Œ.catchè¿›è¡Œå¤„ç†æ‹¦æˆªå™¨åœ¨è¯·æ±‚æˆ–å“åº”å‘é€åˆ°æœåŠ¡å™¨æˆ–æµè§ˆå™¨ä¹‹å‰å¯ä»¥è¿›è¡Œå¹²é¢„è¯·æ±‚å“åº”å¤„ç†ï¼šç›‘å¬httpå“åº”äº‹ä»¶ï¼Œæ¥æ”¶åˆ°å“åº”åè¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨å“åº”æ‹¦æˆªè¿›è¡Œå¹²é¢„ å…¶å®ƒé—®é¢˜ç”¨è¿‡Linuxå—ï¼Œè¯´è¯´ä½ å¸¸ç”¨çš„linuxå‘½ä»¤å—å‰ç«¯æ„å»ºå·¥å…·æœ‰å“ªäº›ï¼Ÿæœ‰å†™è¿‡åŸç”Ÿè½®æ’­å›¾å—c#ã€javaä½ éƒ½ä¼šå†™å—ï¼Ÿä½ ä»¬çš„Appä¹Ÿæ˜¯åŸç”Ÿå†™çš„å—ï¼Ÿé‚£h5é¡µé¢ä¹Ÿæ˜¯å¯ä»¥è¿™æ ·åµŒå…¥è¿›å»å—ï¼Ÿç†Ÿæ‚‰javascriptå—ï¼Ÿå¬æˆç†Ÿæ‚‰java springå—ï¼Ÿæˆ‘è¿˜ä¸€æ„£ï¼Œè¯´ä¸çŸ¥é“ï¼Œé¢è¯•å®˜æ€¥äº†è¯´ï¼šä½ å†™å‰ç«¯çš„æ€ä¹ˆä¼šä¸çŸ¥é“javascriptï¼ˆæ‚è„¸ï¼‰å¯¹canvasäº†è§£å—httpç«¯å£æ˜¯å¤šå°‘80httpsç«¯å£æ˜¯å¤šå°‘443æœ‰ç”¨è¿‡é‚£ç§å¼€ç®±å³ç”¨çš„æ¡†æ¶å—vue3+uniappé¡¹ç›®ä¼šè‡ªå·±æ­å»ºå—èƒ½è¯´è¯´ä½ è¦å¦‚ä½•å®ç°æƒé™æ§åˆ¶å—"},{"title":"2025/02/13 å¾å·ç‘Ÿé©°","path":"/wiki/Job/log_09_20250213_SeChi.html","content":"é¢è¯•å…¬å¸ï¼šå¾å·ç‘Ÿé©° é¢è¯•å²—ä½ï¼šå¾å·-vuereactå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021311:00 é¢è¯•æ—¶é•¿ï¼š é¢è¯•ä½“éªŒï¼š æŠ€æœ¯æ ˆï¼švuejsreact å…¬å¸ä»‹ç» å¾…é‡åº•è–ª+ææˆå•åŒä¼‘æˆéƒ½å¤é“ç§‘æŠ€æœ‰é™å…¬å¸çš„è‹åŒ—è¿è¡Œä¸­å¿ƒå¤–è´¸å“ç‰Œè¥é”€æ¨å¹¿å¤–è´¸æœç´¢å¼•æ“ä¼˜åŒ–ç½‘ç«™å»ºè®¾ã€å•†åŸå»ºç«™ã€å›½å¤–ç¤¾äº¤ç½‘ç»œæ¨å¹¿äº§å“ï¼šå¤–è´¸å…¨çƒæœæœç´¢å¼•æ“ä¼˜åŒ–æŠ€æœ¯æ™ºèƒ½å“åº”å»ºç«™æŠ€æœ¯104ç§è¯­è¨€æœŸå¾…è–ªèµ„ï¼š7k"},{"title":"2025/02/12 ä¸çŸ¥åå…¬å¸","path":"/wiki/Job/log_08_20250212_UnKnown.html","content":"é¢è¯•å…¬å¸ï¼šä¸çŸ¥åå…¬å¸ é¢è¯•å²—ä½ï¼šå‰ç«¯å·¥ç¨‹å¸ˆ é¢è¯•æ—¶é—´ï¼š2025021216:30 é¢è¯•æ—¶é•¿ï¼š20min é¢è¯•ä½“éªŒï¼šéå¸¸ä¸€èˆ¬ çªå¦‚å…¶æ¥ç”µè¯é¢è¯• ä¸çŸ¥é“æ˜¯å“ªå®¶å…¬å¸ ç”µè¯å¯¹é¢éå¸¸å˜ˆæ‚ é¢åˆ°æœ€ååé—®æ—¶ï¼Œé—®åˆ°å…¬å¸å¼€å‘å›¢é˜Ÿæœ‰å¤šå¤§ï¼Œé¢è¯•å®˜åé—®hræ²¡å‘ŠçŸ¥æˆ‘å—ï¼Œå¯¹æ–¹æ˜¯åˆåˆ›å…¬å¸ï¼Œå¼€å‘å›¢é˜Ÿåªæœ‰3ä¸ªäººï¼ˆæœäº†ï¼‰ æŠ€æœ¯æ ˆï¼švuejsreact æŠ€æœ¯é—®é¢˜vue2ã€vue3åŒºåˆ«vueç”Ÿå‘½å‘¨æœŸvueè‡ªå®šä¹‰æŒ‡ä»¤ç”¨è¿‡å—ï¼ŒvueæŒ‡ä»¤ä¸€èˆ¬å†™åœ¨å“ªé‡Œå…¨å±€æ³¨å†ŒVue.directive(â€˜æŒ‡ä»¤åâ€™,{})å‚æ•°1ï¼šæŒ‡ä»¤åç§°å‚æ•°2ï¼šå¯ä»¥æ˜¯å¯¹è±¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡ä»¤å‡½æ•°å±€éƒ¨æ³¨å†Œåœ¨optionsé€‰é¡¹ä¸­è®¾ç½®directiveå±æ€§è‡ªå®šä¹‰æŒ‡ä»¤é’©å­bind åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ï¼Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®inserted è¢«ç»‘å®šçš„å…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨updateï¼Œæ‰€åœ¨ç»„ä»¶çš„vnodeæ›´æ–°æ—¶è°ƒç”¨componentUpdated ç»„ä»¶çš„VNodeä»¥åŠå…¶å­VNodeå…¨éƒ¨æ›´æ–°ä¹‹åè°ƒç”¨unbind æŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶ï¼Œä»…è°ƒç”¨ä¸€æ¬¡é’©å­å‡½æ•°å‚æ•°el ç»‘å®šçš„å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥æ“ä½œdombinding ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸€äº›propertyvnodeoldnodeåº”ç”¨åœºæ™¯è¡¨å•é˜²æ­¢é‡å¤æäº¤é€šè¿‡æŒ‡ä»¤å®ç°æŒ‰é’®èŠ‚æµå›¾ç‰‡æ‡’åŠ è½½é€šè¿‡æŒ‡ä»¤ç›‘å¬å›¾ç‰‡æ˜¯å¦å‡ºç°åœ¨è§†å£ä¸­ï¼Œå®ç°æ‡’åŠ è½½å…ƒç´ å®ç°æ‹–æ‹½vueæŒ‡ä»¤å†™åœ¨å“ªé‡Œå…¨å±€æŒ‡ä»¤directivesindex.jsï¼Œåœ¨main.jsä¸­è°ƒå…¥ä½¿ç”¨å±€éƒ¨æŒ‡ä»¤ç›´æ¥å†™åœ¨optionsçš„directivesä¸­ ä»‹ç»ä¸€ä¸‹vueçš„diffç®—æ³•typeof null ç»“æœæ˜¯ä»€ä¹ˆes6å¸¸ç”¨ç‰¹æ€§æœ‰å“ªäº›èƒ½è¯´è¯´httpè¯·æ±‚å—httpä¼ è¾“æœ‰æ–‡ä»¶å¤§å°é™åˆ¶å—ï¼Ÿèƒ½ä¼ è¾“æ–‡ä»¶å—æœ¬èº«å¯¹ä¼ è¾“æ–‡ä»¶å¤§å°æ²¡æœ‰é™åˆ¶å‰ç«¯å’Œåç«¯å¯ä»¥å¯¹æ–‡ä»¶çš„å¤§å°è¿›è¡Œé™åˆ¶å¤§æ–‡ä»¶å¯¹ç½‘ç»œç¯å¢ƒè¦æ±‚æ¯”è¾ƒé«˜èƒ½ä¼ è¾“äºŒè¿›åˆ¶æ–‡ä»¶ç±»å‹ä¼˜åŒ–å¤§æ–‡ä»¶ä¼ è¾“åˆ†å—ä¼ è¾“è¯»å…¥äºŒè¿›åˆ¶æ•°æ®ä¹‹åï¼Œé€šè¿‡æ§åˆ¶æ­¥é•¿å’Œä½ç§»å®ç°ä¼ è¾“ä½¿ç”¨http2.0å¤šè·¯å¤ç”¨å’ŒäºŒè¿›åˆ¶ä¼ è¾“ï¼Œæå‡å¤§æ–‡ä»¶ä¼ è¾“æ•ˆç‡cdnå†…å®¹åˆ†å‘ç½‘ç»œåˆ†å‘å¤§æ–‡ä»¶ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ› websocketå¿ƒè·³ä¸€èˆ¬æ¯éš”å‡ ç§’å‘é€ä¸€æ¬¡ç­”ï¼š30-60sæ¯”è¾ƒåˆé€‚å¿ƒè·³æœºåˆ¶å°±æ˜¯å®šæ—¶å‘é€pingæ¶ˆæ¯æ¥ç¡®ä¿è¿æ¥å®¢æˆ·ç«¯å®šæ—¶å‘é€å¿ƒè·³åŒ…æœåŠ¡å™¨ç«¯å®šæ—¶å“åº”å¿ƒè·³åŒ…å¦‚æœå®¢æˆ·ç«¯åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”ï¼Œåˆ™è®¤ä¸ºè¿æ¥å·²ç»æ–­å¼€ ä½ ä»¬httpè¯·æ±‚æ˜¯å¤šé•¿æ—¶é—´ç®—ä½œè¶…æ—¶å‘¢ï¼Ÿç­”ï¼š3-5ç§’ï¼Œå…·ä½“è¦çœ‹ä¸šåŠ¡ ä½ ä»¬çš„é—¨æˆ·ç½‘ç«™æœ‰åšå•ç‚¹ç™»å½•å—å•ç‚¹ç™»å½•SSOè®©ç”¨æˆ·åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¹‹é—´åªè¦ç™»é™†ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰æˆæƒç³»ç»Ÿçš„æœºåˆ¶ èƒ½è¯´ä¸€ä¸‹vueé¡¹ç›®çš„éƒ¨ç½²è¿‡ç¨‹å—ç®€å†é‡Œé¢æåˆ°çš„ç½‘ç«™æ€§èƒ½ä¼˜åŒ–æ˜¯æŒ‡å“ªäº›ä¸œè¥¿ï¼Ÿç”¨çš„æ˜¯å“ªäº›æ¥å£è°ƒè¯•å·¥å…·æ˜¯å¦‚ä½•åŒºåˆ†åå°å’ŒAppç«¯ç”¨æˆ·çš„"},{"title":"å‰ç«¯é¢è¯•å®æˆ˜-å çº¸","path":"/wiki/Job/summary_01_DieZhi.html","content":"åŸè´´ï¼šå°çº¢ä¹¦-è¿™å¾ˆæ´¾å¤§æ˜Ÿ æè¿°ä¸€ç§æ–¹æ³•ï¼Œç”¨ä»¥å®ç°ä¸€ä¸ªåŠ¨æ€åŠ è½½å†…å®¹çš„æ— é™æ»šåŠ¨åˆ—è¡¨ç­”æ¡ˆ ä½¿ç”¨InterSection Observer APIç›‘å¬ä¸€ä¸ªè§¦å‘å…ƒç´ ï¼Œå¦‚åˆ—è¡¨åº•éƒ¨æ ‡è®°ï¼Œå½“è¯¥å…ƒç´ å‡ºç°åœ¨è§†å£ä¸­æ—¶ï¼Œé€šè¿‡AJAXæˆ–Fetch APIå¼‚æ­¥åŠ è½½æ›´å¤šå†…å®¹ï¼Œå¹¶æ·»åŠ åˆ°åˆ—è¡¨åº•éƒ¨const observer = new IntersectionObserver(entries = if(entries[0].isIntersecting) loadMoreItems() )observer.observe(document.querySelector(.scroll-anchor)) å¦‚ä½•ä½¿ç”¨Csså®ç°ä¸€ä¸ªæ•ˆæœï¼Œç”¨æˆ·é¼ æ ‡æ‚¬åœæ—¶ï¼ŒæŒ‰é’®é€æ¸å˜å¤§ä½¿ç”¨cssçš„hoveré€‰æ‹©å™¨å’Œtransitionå±æ€§ï¼Œæ¥å¹³æ»‘å˜æ¢æŒ‰é’®çš„å°ºå¯¸ Reactä¸­ï¼Œå¦‚ä½•ä¼˜åŒ–ç»„ä»¶ä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ä½¿ç”¨React.memoå¯¹å‡½æ•°ç»„ä»¶è¿›è¡ŒåŒ…è£…ä½¿ç”¨shouldComponentUpdateç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä½¿ç”¨React.memoçš„ç¬¬äºŒä¸ªå‚æ•°æ¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“const MyComponent = React.memo(function MyComponent(props) // ç»„ä»¶å†…å®¹,(prevProps, nextProps)= return prevProps.data === nextProps.data) å¦‚æœæœ‰ä¸€ä¸ªå«æœ‰æ•°ç™¾ä¸ªé¡¹ç›®çš„æ•°ç»„ï¼Œå¦‚ä½•æœ‰æ•ˆæœç´¢ç‰¹å®šé¡¹ç›®ä½¿ç”¨JavaScriptçš„Mapæˆ–è€…Setæ•°æ®ç»“æ„å› ä¸ºå®ƒä»¬æä¾›å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„æŸ¥æ‰¾æ€§èƒ½const itemMap = new Map()largerArray.forEach((item,index)=itemMap.set(item.key,item)); è§£é‡Šä¸€ä¸‹Web Accessibilityï¼ˆWebæ— éšœç¢æ€§ï¼‰å¹¶ä¸¾ä¾‹è¯´æ˜å¦‚ä½•åœ¨ç½‘é¡µè®¾è®¡ä¸­å®ç°å®ƒWeb Accessibilityï¼Œèƒ½å¤Ÿç¡®ä¿æ®‹éšœäººå£«ï¼ˆå¦‚å¬è§‰ã€è§†è§‰å­˜åœ¨éšœç¢çš„äººï¼‰ï¼Œä¹Ÿèƒ½å¤Ÿæ— éšœç¢çš„è®¿é—®å’Œä½¿ç”¨æœåŠ¡ä½¿ç”¨è¯­ä¹‰åŒ–Htmlæ ‡ç­¾ï¼Œå¦‚headerã€navã€mainã€footerrï¼Œå¸®åŠ©å±å¹•é˜…è¯»å™¨æ›´å¥½ç†è§£é¡µé¢ç»“æ„ä½¿ç”¨altå±æ€§ä¸ºå›¾ç‰‡æä¾›æ›¿ä»£æ–‡æœ¬ï¼Œå¸®åŠ©è§†è§‰éšœç¢ç”¨æˆ·ç†è§£å›¾ç‰‡å†…å®¹ç¡®ä¿æ‰€æœ‰åŠŸèƒ½å…ƒç´ éƒ½å¯ä»¥é€šè¿‡é”®ç›˜è®¿é—®æ¯”å¦‚ä½¿ç”¨buttonæ ‡ç­¾è€Œä¸æ˜¯divåˆ›å»ºæŒ‰é’®ä¸ºè‡ªå®šä¹‰æ§ä»¶æ·»åŠ tabIndexå±æ€§ï¼Œä½¿å…¶å¯ä»¥é€šè¿‡é”®ç›˜èšç„¦è®¾ç½®åˆé€‚çš„ariaè§’è‰²å’Œå±æ€§button aria-label=Close tabindex=0Close/button ä½¿ç”¨JavaScriptï¼Œå¦‚ä½•åˆ›å»ºä¸€ä¸ªå€’è®¡æ—¶è®¡æ—¶å™¨ï¼Œæ˜¾ç¤ºå¤©ã€å°æ—¶ã€åˆ†é’Ÿå’Œç§’ä½¿ç”¨setIntervalå‡½æ•°æ›´æ–°å€’è®¡æ—¶æ—¶é—´function startCountdown(duration) const endTime = Date.now() + duration const interval = setInterval(()= const remaining = endTime - Date.now() if(remaining = 0) clearInterval(interval) else const days = Math.floor(remaining / (1000 * 50 * 60 * 24)) const hours = Math.floor(remaining % (1000 * 50 * 60 * 24)/ (1000*60*60)) const minutes = Math.floor(remaining % (1000 * 50 * 60 * 24) / (1000 * 60)) const seconds = Math.floor(remaining % (1000 * 50 * 60 * 24) / 1000) ,1000) æˆ‘çš„æ¸¸æˆç•Œé¢éœ€è¦å®æ—¶æ›´æ–°ç©å®¶çš„å¾—åˆ†ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡å‰ç«¯æ¶æ„æ¥å®ç°è¿™ä¸€åŠŸèƒ½ä½¿ç”¨WebSocketæˆ–è€…Server-Sent Events(SSE)å®ç°ä¸æœåŠ¡å™¨ç«¯çš„å®æ—¶é€šä¿¡å½“æœåŠ¡å™¨ç«¯å¾—åˆ†æ›´æ–°æ—¶ï¼Œé€šè¿‡WebSocketæ¨é€åˆ°å‰ç«¯ï¼Œæ›´æ–°ç”¨æˆ·ç•Œé¢const scoket = new WebSocket(ws://example.com/score)socket.onmessage = function(event) updateScore(event.data) è§£é‡Šä»€ä¹ˆæ˜¯æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼ˆService Workerï¼‰ï¼Œä»¥åŠå®ƒå¯ä»¥å¦‚ä½•å¸®åŠ©æé«˜ä¸€ä¸ªæ¸¸æˆç½‘ç«™çš„æ€§èƒ½ï¼ŸService Workerså¯ä»¥æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç¼“å­˜æˆ–æ£€ç´¢èµ„æºæé«˜åŠ è½½é€Ÿåº¦å¹¶æ”¯æŒç¦»çº¿åŠŸèƒ½å¯¹äºåŠ è½½é‡èµ„æºçš„æ¸¸æˆå°¤å…¶é€‚ç”¨ï¼Œå¯ä»¥åœ¨ç©å®¶ç¬¬äºŒæ¬¡è®¿é—®æ—¶æä¾›åŠæ—¶åŠ è½½ä½“éªŒif(serviceWorker in navigator) navigator.serviceWorker.register(/sw.js).then(registration= console.log(Service Worker registerd with scope, registration.scope) ).catch(error= console.error(failed,error) ) è¯·æè¿°ä¸€ä¸ªä½ å¦‚ä½•ä½¿ç”¨SVGæ¥å¢å¼ºç½‘ç«™è§†è§‰ä½“éªŒçš„æƒ…å†µsvgæ˜¯ä¸€çŸ¢é‡å¯ç¼©æ”¾å›¾ç‰‡æ ¼å¼ï¼Œé€‚ç”¨äºå“åº”å¼è®¾è®¡ï¼Œsvgæ ¼å¼çš„å›¾ç‰‡åœ¨ç¼©æ”¾åä¸ä¼šå¤±çœŸï¼Œä¾‹å¦‚echartsã€d3ç­‰å›¾ç‰‡åº“ä¹Ÿéƒ½éå¸¸æ”¯æŒsvgçš„æ¸²æŸ“æ ¼å¼ï¼Œå¹¶ä¸”svgè¿˜å¯ä»¥å®ç°åŠ¨æ€å’Œäº¤äº’å›¾å½¢ï¼Œåœ¨ä¸€äº›å¯è§†åŒ–åŠ¨æ€ç½‘ç«™å’Œæ¸¸æˆä¸­ä½¿ç”¨çš„éå¸¸å¤š å¦‚ä½•åœ¨å‰ç«¯é¡¹ç›®ä¸­å®ç°å›½é™…åŒ–å’Œæœ¬åœ°åŒ–ä½¿ç”¨i18nextæˆ–è€…similarå›½é™…åŒ–åº“ï¼Œæ”¯æŒå¤šè¯­è¨€å†…å®¹å’Œæ ¼å¼åœ¨å‰ç«¯å®ç°æ—¶ï¼Œå®šä¹‰è¯­è¨€æ–‡ä»¶ï¼Œå¹¶åœ¨UIç»„ä»¶ä¸­å¼•ç”¨ç¿»è¯‘ è§£é‡ŠCSSä¸­çš„BEMå‘½åæ–¹æ³•ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒæ¥ç»„ç»‡ä½ çš„æ ·å¼è¡¨BEMï¼ˆBlock Element Modifierï¼‰æ˜¯ä¸€ç§cssç±»å‘½åçº¦å®šï¼Œæœ‰åŠ©äºä¿æŒæ ·å¼æ ‡çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§é€šè¿‡ç‹¬ç«‹çš„å—ã€å…ƒç´ ã€ä¿®é¥°ç¬¦æ¥ç»„ç»‡ä»£ç  ä½ å°†å¦‚ä½•å¤„ç†è·¨æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä¸åŒè®¾å¤‡å’Œæ“ä½œç³»ç»Ÿä¸Šåœ¨ä¸€ä¸ªå¤æ‚çš„é¡µé¢ä¸Šï¼Œç”¨æˆ·æ“ä½œå¯¼è‡´å¤šæ¬¡ä¸å¿…è¦çš„DOMæ“ä½œï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–å®ƒæè¿°ä¸€ä¸ªåœºæ™¯ï¼Œä½ ä½¿ç”¨FlexBoxè§£å†³äº†ä¸€ä¸ªå¸ƒå±€é—®é¢˜å½“ä¸€ä¸ªAjaxè¯·æ±‚å¤±è´¥æ—¶ï¼Œä½ é€šå¸¸å¦‚ä½•å¤„ç†é”™è¯¯ï¼Œå¹¶ç»™ç”¨æˆ·æä¾›åé¦ˆï¼Ÿ"},{"title":"10.1 å‡½æ•°è¯­æ³•","path":"/wiki/JavaScript/chapter_10_1.html","content":"å‡½æ•°å¯¹è±¡ å‡½æ•°å®é™…ä¸Šæ˜¯å¯¹è±¡å‡½æ•°éƒ½æ˜¯Functionç±»å‹çš„å®ä¾‹Functionä¹Ÿæœ‰å±æ€§å’Œæ–¹æ³•å‡½æ•°åæ˜¯æŒ‡å‘å‡½æ•°å¯¹è±¡çš„æŒ‡é’ˆ å®šä¹‰å‡½æ•°çš„å‡ ç§æ–¹å¼ â‘  å‡½æ•°å£°æ˜function fun(param1,param2) return param1 + param2;â‘¡ å‡½æ•°è¡¨è¾¾å¼let fun = function(num1, num2) return num1 + num2;â‘¢ ç®­å¤´å‡½æ•°let fun = (param1, param2) = return param1 * param2;â‘£ Functionæ„é€ å‡½æ•°let fun = new Function(param1,param2,return param1 % param2);Functionæ„é€ å‡½æ•°çš„å‚æ•° æœ€åä¸€ä¸ªå‚æ•° å§‹ç»ˆè¢«å½“åšå‡½æ•°ä½“ éæœ€åä¸€ä¸ªå‚æ•° ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•° ä¸æ¨èä½¿ç”¨åŸå› ï¼šä¸¤æ¬¡è§£é‡Šä»£ç ï¼Œä¼šå½±å“æ€§èƒ½ å°†å®ƒå½“åšå¸¸è§„ECMAScriptä»£ç  è§£é‡Šä¼ ç»™æ„é€ å‡½æ•°çš„å­—ç¬¦ä¸² é‡è¦çš„æ˜¯ï¼šæŠŠå‡½æ•°æƒ³è±¡ä¸ºå¯¹è±¡ï¼ŒæŠŠå‡½æ•°åæƒ³è±¡ä¸ºæŒ‡é’ˆ 10.1.1 ç®­å¤´å‡½æ•°ç®­å¤´å‡½æ•°é€‚åˆåµŒå…¥å‡½æ•°çš„åœºæ™¯ let ints = [1, 2, 3];console.log(ints.map(function (i) return i + 1 ));console.log(ints.map(i = i + 1)); åªæœ‰ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹å¯ä»¥ä¸åŠ æ‹¬å· // ä¸€ä¸ªå‚æ•°å¯ä»¥çœç•¥æ‹¬å·let triple = x = return 3 * x; // æ²¡æœ‰å‚æ•°éœ€è¦æ‹¬å·let getRandom = () = return Math.random(); // å¤šä¸ªå‚æ•°éœ€è¦æ‹¬å·let sum = (a, b) = return a + b; å‡½æ•°ä½“å•æ¡è¯­å¥éšè—å¤§æ‹¬å·è¡¨ç¤ºè¿”å›è¿™è¡Œä»£ç çš„å€¼ let triple = x = 3 * x;// ç›´æ¥èµ‹å€¼let value = ;let setName = x = x.name = Matt;setName(value);console.log(value.name); //Matt ç®­å¤´å‡½æ•°å±€é™ ä¸èƒ½ä½¿ç”¨ argumentsã€superã€new.targetä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°æ²¡æœ‰ protortpe å±æ€§ 10.1.2 å‡½æ•°åå‡½æ•°åä½œä¸ºæŒ‡é’ˆå°±æ„å‘³ç€ï¼šä¸€ä¸ªå‡½æ•°å¯ä»¥æœ‰å¤šä¸ªåç§° function sum(num1, num2) return num1 + num2;console.log(sum(10, 20)); //30let anotherSum = sum;console.log(anotherSum(10, 10)); //20sum = null;console.log(anotherSum(10, 10)); //20 å‡½æ•°çš„nameå±æ€§ nameå±æ€§ä¸€èˆ¬ä¿å­˜çš„æ˜¯å‡½æ•°æ ‡è¯†ç¬¦nameå±æ€§åªè¯»æ²¡æœ‰åç§°çš„å‡½æ•°ï¼Œnameä¸ºç©ºå­—ç¬¦ä¸²Functionæ„é€ çš„å‡½æ•°ï¼Œnameä¸ºâ€™anonymousâ€™function foo() let bar = function () ;let baz = () = ;console.log(foo.name); //fooconsole.log(bar.name); //barconsole.log(baz.name); //bazconsole.log((() = ).name); //console.log((new Function()).name); //anonymousç‰¹æ®Šå‡½æ•°çš„æ ‡è¯†å‰ç¼€å¯¹äºè·å–å‡½æ•°getã€è®¾ç½®å‡½æ•°setã€ä½¿ç”¨bind()å®ä¾‹åŒ–çš„å‡½æ•°ï¼Œæ ‡è¯†ç¬¦å‰ä¼šåŠ ä¸Šä¸€ä¸ªå‰ç¼€å‡½æ•°å‰ç¼€getgetsetsetbindboundfunction foo() console.log(foo.bind(null).name); //bound foolet dog = years: 1, get age() return this.years; , set age(newAge) this.years = newAge; let propertyDescriptor = Object.getOwnPropertyDescriptor(dog, age);console.log(propertyDescriptor.get.name); //get ageconsole.log(propertyDescriptor.set.name); //set age"},{"title":"å‰ç«¯é¢è¯•å®æˆ˜-å°è¥¿ç§‘æŠ€å®ä¹ ä¸€é¢","path":"/wiki/Job/summary_02_XiaoXi.html","content":"åŸæ–‡åœ°å€ cssä»€ä¹ˆæ˜¯ç›’æ¨¡å‹htmlå…ƒç´ ç”±ä¸€ä¸ªçŸ©å½¢æ¡†ç»„æˆï¼Œå³ç›’æ¨¡å‹ï¼Œç›’æ¨¡å‹ç”±è¿™äº›éƒ¨åˆ†ç»„æˆï¼šcontent boxæ˜¾ç¤ºå†…å®¹çš„åŒºåŸŸé€šè¿‡widthheightè®¾ç½®å¤§å°padding boxå†…è¾¹æ¡†ï¼Œpaddingborder boxè¾¹æ¡†ï¼Œbordermargin boxå¤–è¾¹æ¡†ï¼Œmarginä»‹ç»ä¸€ä¸‹cssçš„2ç§ç›’æ¨¡å‹box-sizing:content-boxæ ‡å‡†ç›’æ¨¡å‹å…ƒç´ çš„å®½åº¦ã€é«˜åº¦åªåŒ…æ‹¬å†…å®¹box-sizing:border-boxIEç›’æ¨¡å‹å…ƒç´ å†…å®¹åŒ…æ‹¬å†…è¾¹è·å’Œè¾¹æ¡† linkå’Œ@importçš„åŒºåˆ«å¯¼å…¥æ–¹å¼ä¸åŒlinkä½¿ç”¨æ ‡ç­¾çš„æ–¹å¼@importæ˜¯cssçš„ä¸€ç§è¯­æ³•ä½¿ç”¨èŒƒå›´ä¸åŒlinké™¤äº†åŠ è½½cssæ ·å¼ï¼Œè¿˜èƒ½ç”¨äºæŒ‡å®šrelå±æ€§relå±æ€§æŒ‡å®šå½“å‰æ–‡æ¡£å’Œè¢«é“¾æ¥æ–‡æ¡£èµ„æºä¹‹é—´çš„å…³ç³»åŠ è½½æ–¹å¼ä¸åŒlinkæ–¹å¼ï¼šæµè§ˆå™¨ä¼šä¸€åŒåŠ è½½htmlå’Œcss@importï¼šæµè§ˆå™¨ä¼šå…ˆåŠ è½½htmlï¼Œå†åŠ è½½csså¯ä»¥é€šè¿‡jsæ“ä½œdomï¼Œæ’å…¥link@importæ”¯æŒie5ä»¥ä¸Šï¼Œlinkæ ‡ç­¾ä¸å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ å¸¸ç”¨çš„å¸ƒå±€æ–¹å¼flexå¸ƒå±€gridç½‘æ ¼å¸ƒå±€ç»å¯¹å®šä½å¸ƒå±€æµ®åŠ¨å¸ƒå±€ä¸¤æ å¸ƒå±€å·¦ä¾§å®½åº¦å›ºå®šï¼Œå³ä¾§è‡ªé€‚åº” ä¸­é—´æœ‰é—´è·ï¼Œä¸¤è¾¹æ²¡æœ‰é—´è·ï¼Œæ€ä¹ˆè®¾ç½®ä½¿ç”¨flexæ¨ªå‘å¸ƒå±€ï¼Œjustify-contentä½¿ç”¨space-betweenä½¿ç”¨flexæ¨ªå‘å¸ƒå±€ï¼Œè®¾ç½®flex:1è‡ªé€‚åº”å®½åº¦ï¼Œè®¾ç½®gapå·¦ä¾§å…ƒç´ è®¾ç½®margin-rightï¼Œå³ä¾§å…ƒç´ è®¾ç½®margin-left positionå®šä½æœ‰å“ªäº›statictoprightbottomleftz-indexæ— æ•ˆrelativeç›¸å¯¹äºæ­£å¸¸æ–‡æ¡£æµçš„ä½ç½®absoluteç›¸å¯¹äºæœ€è¿‘çš„éstaticå®šä½ç¥–å…ˆå…ƒç´ fixedç›¸å¯¹äºè§†å£sticky jsä»€ä¹ˆæ˜¯å˜é‡æå‡å°†æ‰€æœ‰varå£°æ˜çš„å˜é‡å’Œå‡½æ•°æå‡åˆ°ä»£ç çš„å¤´éƒ¨å‡½æ•°å£°æ˜çš„ä¼˜å…ˆçº§é«˜äºå˜é‡å£°æ˜ åŸå‹å’ŒåŸå‹é“¾ä»€ä¹ˆæ˜¯åŸå‹åœ¨jsä¸­ï¼Œæ¯å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­éƒ½ä¼šåŒ…å«ä¸€äº›é¢„å®šä¹‰çš„å±æ€§æ¯ä¸ªå‡½æ•°å¯¹è±¡ä¸Šéƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘å‡½æ•°çš„åŸå‹å¯¹è±¡ä½¿ç”¨åŸå‹å¯¹è±¡çš„å¥½å¤„æ˜¯æ‰€æœ‰å¯¹è±¡å®ä¾‹å…±äº«å®ƒåŒ…å«çš„å±æ€§å’Œæ–¹æ³•ä»€ä¹ˆæ˜¯åŸå‹é“¾æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œé€šè¿‡protoæŒ‡é’ˆæŒ‡å‘åŸå‹å¯¹è±¡ï¼Œå¹¶ä»ä¸­ç»§æ‰¿æ–¹æ³•å’Œå±æ€§åŸå‹å¯¹è±¡ä¹Ÿå¯èƒ½æ‹¥æœ‰åŸå‹è¿™æ ·ä¸€å±‚ä¸€å±‚ï¼Œæœ€ç»ˆæŒ‡å‘nullï¼Œè¿™ç§å…³ç³»å°±æ˜¯åŸå‹é“¾é€šè¿‡åŸå‹é“¾ä¸€ä¸ªå¯¹è±¡å¯ä»¥æ‹¥æœ‰å®šä¹‰åœ¨å…¶ä»–å¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³• é˜²æŠ–å’ŒèŠ‚æµä»€ä¹ˆæ˜¯èŠ‚æµé˜²æŠ– å½“å¤šæ¬¡æ‰§è¡ŒæŸä¸€åŠ¨ä½œï¼Œè¿›è¡Œå‡½æ•°è°ƒç”¨æ¬¡æ•°çš„é™åˆ¶ï¼ŒèŠ‚çœèµ„æºé˜²æŠ–åœ¨äº‹ä»¶è§¦å‘nç§’åæ‰§è¡Œå‡½æ•°ï¼Œè‹¥åœ¨nç§’å†…å†æ¬¡è§¦å‘ï¼Œé‡æ–°è®¡æ—¶åªæœ‰åœ¨æœ€åä¸€æ¬¡äº‹ä»¶ä¹‹åæ‰è§¦å‘ä¸€æ¬¡å‡½æ•°èŠ‚æµå½“å¤šæ¬¡æ‰§è¡ŒæŸä¸€åŠ¨ä½œï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œåªæ‰§è¡Œä¸€æ¬¡å‡½æ•°ä¸ç®¡äº‹ä»¶è§¦å‘æœ‰å¤šé¢‘ç¹ï¼Œéƒ½èƒ½ä¿è¯åœ¨è§„å®šæ—¶é—´å†…ä¸€å®šä¼šæ‰§è¡Œä¸€æ¬¡æ—¶é—´å¤„ç†å‡½æ•°éœ€è¦åœ¨ç”¨æˆ·è§¦å‘é¡µé¢æ»šåŠ¨æ—¶ï¼Œè¯·æ±‚åå°æ•°æ®åº”ç”¨åœºæ™¯é˜²æŠ–ç™»å½•ã€å‘çŸ­ä¿¡ç­‰æŒ‰é’®ï¼Œé˜²æ­¢ç”¨æˆ·æŒ‰å¾—å¤ªå¿«çª—å£å¤§å°resizeäº‹ä»¶ï¼Œå¸Œæœ›çª—å£è°ƒæ•´ç»“æŸåè§¦å‘é¼ æ ‡çš„mousemoveã€mouseoveräº‹ä»¶èŠ‚æµåˆ—è¡¨æ»šåŠ¨æœç´¢è”æƒ³åŠŸèƒ½è¡¨å•é‡å¤æäº¤ å¦‚ä½•å®ç° é˜²æŠ–var timer;function debounce(fn, delay) if(timer) // ä¿è¯åªå¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ clearTimeout(timer) timer = setTimeout(function() // å»¶è¿Ÿdelayæ‰§è¡Œå‡½æ•° fn() ,delay)window.onscroll = function() debounce(test, 1000)function test() console.log(æ»šåŠ¨åœæ­¢)èŠ‚æµfunction debounce(fn,delay) let timer; return function() let _this = this let _args = arguments; if(timer) clearTimeout(timer) timer = setTimeout(function() fn.apply(_this,_args) ,delay) let testDebounceFn = debounce(test, 1000)function test(a) console.log(æ»šåŠ¨åœæ­¢+a)window.onscroll = function() testDebounceFn(aaaa) ä»€ä¹ˆæ˜¯é—­åŒ…å†…å±‚å‡½æ•°è®¿é—®å¤–å±‚å‡½æ•°ä½œç”¨åŸŸ ç»“åˆé—­åŒ…ï¼Œè¯´ä¸€ä¸‹é˜²æŠ–æ˜¯æ€ä¹ˆå®ç°çš„debounceå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°éœ€è¦é˜²æŠ–çš„å‡½æ•°å»¶è¿Ÿæ—¶é—´ä½¿ç”¨é—­åŒ…ä¿å­˜timerå˜é‡ï¼Œç¡®ä¿æ¯æ¬¡è°ƒç”¨è¿”å›çš„å‡½æ•°éƒ½èƒ½è®¿é—®åˆ°åŒä¸€ä¸ªtimeræ¯æ¬¡äº‹ä»¶è§¦å‘ï¼Œå¦‚æœtimerå­˜åœ¨ï¼Œåˆ™æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨ï¼Œè®¾ç½®ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨å»¶è¿Ÿæ—¶é—´åˆ°è¾¾åï¼Œæ‰§è¡Œfuncå‡½æ•° thisçš„æŒ‡å‘é¢è¯•å®˜è¯´ï¼Œè°è°ƒç”¨å°±æŒ‡å‘è°æŒ‡å‘å½“å‰æ‰§è¡Œçš„ä¸Šä¸‹æ–‡è°ƒç”¨æ¨¡å¼å‡½æ•°è°ƒç”¨æ–¹æ³•è°ƒç”¨æ„é€ å™¨è°ƒç”¨applybindcall æ€ä¹ˆæ‰‹åŠ¨æ”¹å˜thisapplyã€bindã€call callã€bindã€applyçš„åŒºåˆ«applyä¼ å‚æ˜¯æ•°ç»„ï¼Œcallæ˜¯å‚æ•°åˆ—è¡¨bindè¿”å›ç»‘å®šthisä¹‹åçš„å‡½æ•°ï¼Œapplyå’Œcallæ˜¯ç«‹å³æ‰§è¡Œ æ‰‹å†™callæ‰‹å†™callFunction.prototype.myCall = function(context, ...arg) const fn = Symbol(ä¸´æ—¶å±æ€§) context[fn] = this context[fn](...arg) delete context[fn]æ‰‹å†™applyFunction.prototype.apply = function(context,arg) const fn = Symbol(å ä½å…ƒç´ ) context[fn] = context context[fn](...arg) delete context[fn]æ‰‹å†™bindFunction.prototype.myBind = function(context, ...firstarg) const that = this const bindFn = function (...secoundarg) return that.myCall(context, ...firstarg, ...secoundarg) bindFn.prototype = Object.create(that.prototype) return bindFn ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°åŒºåˆ«å†™æ³•ä¸åŒç®­å¤´å‡½æ•°éƒ½æ˜¯åŒ¿åå‡½æ•°ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨äºæ„é€ å‡½æ•°æ™®é€šå‡½æ•°thisæŒ‡å‘è°ƒç”¨å¯¹è±¡ï¼Œå¦‚æœä½œä¸ºæ„é€ å‡½æ•°ï¼ŒthisæŒ‡å‘åˆ›å»ºçš„å®ä¾‹ç®­å¤´å‡½æ•°çš„thisæ°¸è¿œæŒ‡å‘ä¸Šä¸‹æ–‡çš„thisï¼Œå¹¶ä¸”æ— æ³•æ”¹å˜ç®­å¤´å‡½æ•°æ²¡æœ‰arguments reactreactä¸­æ€§èƒ½ä¼˜åŒ–æœ‰å“ªäº›æ–¹æ³•å‚è€ƒåšå®¢ React.memoreactåœ¨ç»„ä»¶åˆ·æ–°çš„æ—¶å€™ä¼šæ·±åº¦éå†æ‰€æœ‰å­ç»„ä»¶ï¼ŒæŸ¥æ‰¾æ‰€æœ‰æ›´æ–°èŠ‚ç‚¹ï¼Œå³çˆ¶ç»„ä»¶æ›´æ–°ï¼Œå­ç»„ä»¶å¿…ä¼šæ›´æ–°memoå¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½æœ‰2ç§ç”¨æ³•ç›´æ¥ä½¿ç”¨memoåŒ…è£¹ç»„ä»¶éœ€è¦æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ç»™memoæ¥è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå‡½æ•°æ¥æ”¶2ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯å‰ä¸€æ¬¡çš„propså’Œå½“å‰çš„propsï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ç»„ä»¶å¦‚æœæ˜¯classç»„ä»¶ä¸€èˆ¬ä½¿ç”¨shouldComponentUpdateå‡½æ•°æˆ–åˆ™PureComponentå®ç°åˆ—è¡¨ä½¿ç”¨keyä¸ºäº†æé«˜diffç®—æ³•åœ¨æ¸²æŸ“åˆ—è¡¨æ—¶å€™çš„æ€§èƒ½æœ‰äº†å®ƒï¼Œreactå°±èƒ½çŸ¥é“ç›¸æ¯”è¾ƒä¸Šä¸€ä¸ªæ¸²æŸ“å‘¨æœŸï¼Œå½“å‰çš„æ¸²æŸ“å‘¨æœŸéœ€è¦æ’å…¥ã€ç§»åŠ¨æˆ–è€…åˆ é™¤å“ªäº›èŠ‚ç‚¹å¤ç”¨ä¹‹å‰çš„domï¼Œå‡å°‘ä¸å¿…è¦çš„domæ“ä½œæ‰€äº§ç”Ÿçš„å¼€é”€ï¼Œä»è€Œæé«˜ç•Œé¢æ›´æ–°çš„æ€§èƒ½åˆç†è¿ç”¨useCallbackå’ŒuseMemouseMemoå’ŒuseCallbackåªé’ˆå¯¹é‡æ–°æ¸²æŸ“æœ‰å¸®åŠ©éœ€è¦ç»“åˆçˆ¶ç»„ä»¶å…·ä½“æƒ…å†µæ¥çœ‹ä½¿ç”¨æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²ä½¿ç”¨React.lazyå’ŒSuspenseï¼ŒæŒ‰éœ€åŠ è½½ç»„ä»¶ï¼Œå¯ä»¥å‡å°‘åˆå§‹åŒ–åŠ è½½æ—¶é—´ï¼Œæé«˜æ€§èƒ½ä½¿ç”¨è™šæ‹ŸåŒ–å¯¹é•¿åˆ—è¡¨æˆ–å¤§å‹æ•°æ®é›†ï¼Œä½¿ç”¨è™šæ‹ŸåŒ–åº“ï¼Œä»…æ¸²æŸ“å¯è§éƒ¨åˆ†react-virtualizedä½¿ç”¨Profileræµ‹é‡æ€§èƒ½ useMemoå’ŒuseEffectçš„åŒºåˆ«æ‰§è¡Œæ—¶æœºä¸åŒuseMemoä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œmemoåœ¨domæ›´æ–°å‰è§¦å‘useEffectåªèƒ½åœ¨domæ›´æ–°åï¼Œæµè§ˆå™¨æ¸²æŸ“å®Œæˆåå†è§¦å‘ useMemoçš„åŸç†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨React.memoåŒ…è£¹èµ·æ¥reactçš„æ¸²æŸ“è¿‡ç¨‹è§¦å‘æ¸²æŸ“ï¼špropsæˆ–è€…stateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œreactä¼šé‡æ–°æ¸²æŸ“renderæ–¹æ³•ï¼šreactè°ƒç”¨ç»„ä»¶çš„renderæ–¹æ³•ï¼Œç”Ÿæˆè™šæ‹Ÿdomæ¯”è¾ƒè™šæ‹Ÿdomæ›´æ–°domuseMemoä½œç”¨ï¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ç¼“å­˜è®¡ç®—ç»“æœï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½é‡æ–°è®¡ç®—å®ç°åŸç†useMemoæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šcallbackå’Œdependenciesä¾èµ–æ•°ç»„å­˜å‚¨è®¡ç®—ç»“æœï¼Œå’Œä¸Šä¸€æ¬¡çš„ä¾èµ–æ•°ç»„å¦‚æœæ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°è®¡ç®—å¹¶æ›´æ–°è®¡ç®—ç»“æœå’Œä¾èµ–æ•°ç»„å¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡è®¡ç®—çš„ç»“æœ Reactä¸­å‡½æ•°ç»„ä»¶å¦‚ä½•æ¨¡ä»¿ç”Ÿå‘½å‘¨æœŸï¼ˆç”¨useEffectï¼‰componentDidMountuseEffectä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„componentDidUpdateuseEffectä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºç›‘å¬ä¾èµ–é¡¹çš„å˜åŒ–componentWillUnmountuseEffectè¿”å›çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡ŒshouldComponentUpdateå¯ä»¥ä½¿ç”¨React.memoå¯¹propsè¿›è¡Œæ¯”è¾ƒ jsxå’Œjsçš„åŒºåˆ«æ ‡ç­¾åµŒå¥—jsxå…è®¸åœ¨jsä¸­åµŒå¥—htmlæ ‡ç­¾æ’å€¼è¡¨è¾¾å¼jsxæ”¯æŒé€šè¿‡èŠ±æ‹¬å·å°†jsè¡¨è¾¾å¼æ’å…¥åˆ°jsxä¸­ç±»åå’Œå±æ€§å‘½åä¸åŒï¼Œé¿å…ä¸jså…³é”®å­—å†²çªä½¿ç”¨classNameä»£æ›¿classä½¿ç”¨htmlForä»£æ›¿forï¼Œ babelå¤„ç†jsxçš„åŸç†è§£æå°†jsxä»£ç åˆ†è§£ä¸ºæ ‡è®°ï¼Œæ„å»ºå‡ºä¸€ä¸ªå¯¹åº”çš„astastèƒ½å¤Ÿè¡¨ç¤ºæºä»£ç çš„ç»“æ„å’Œè¯­æ³•è½¬æ¢å°†jsxè¯­æ³•è½¬æ¢ä¸ºæ™®é€šçš„jsä»£ç å°†astè½¬æ¢ä¸ºjsä»£ç "},{"title":"10.2 å‡½æ•°å‚æ•°","path":"/wiki/JavaScript/chapter_10_2.html","content":"10.2.1 ç†è§£å‚æ•°ECMAScriptçš„å‚æ•°å†…éƒ¨è¡¨ç°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä½†å‡½æ•°å¹¶ä¸å…³å¿ƒæ•°ç»„ä¸­åŒ…å«ä»€ä¹ˆ arguments argumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨è®¿é—®argumentså¯¹è±¡ï¼Œ å£°æ˜å‚æ•°å†™æ³•function sayHi(name,message) console.log(Hello + name + , + message);ä½¿ç”¨argumentsé‡å†™function sayHi() console.log(Hello + arguments[0] + , + arguments[1]);ä½¿ç”¨arguments.lengthæ£€æŸ¥ä¼ å…¥çš„å‚æ•°ä¸ªæ•°function doAdd() if (arguments.length === 1) console.log(arguments[0] + 10); else if (arguments.length === 2) console.log(arguments[0] + arguments[1]); doAdd(10); //20doAdd(30, 20); //50argumentså¯¹è±¡ä¹Ÿå¯ä»¥å’Œå‘½åå‚æ•°ä¸€èµ·ä½¿ç”¨function doAdd(num1, num2) if (arguments.length === 1) console.log(num1 + 10); else if (arguments.length === 2) console.log(num1 + num2); doAdd(0); //10doAdd(5, 10); //15argumentså§‹ç»ˆä¸å¯¹åº”çš„å‘½åå‚æ•°åŒæ­¥ä½†å®ƒä»¬å¹¶ä¸è®¿é—®åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåªæ˜¯ä¿æŒåŒæ­¥è€Œå·²ã€‚ function doAdd(num1, num2) num2 = 1000; arguments[0] = -1000; console.log(num1 + arguments[1]);doAdd(10, 20); //0ä½†å¦‚æœè®¿é—®argumentsçš„ç´¢å¼•è¶…è¿‡äº†å®é™…ä¼ å‚çš„æ•°é‡ï¼Œåˆ™æ— æ³•åŒæ­¥ã€‚å¹¶ä¸”è®¿é—®æœªä¼ çš„å‚æ•°é»˜è®¤å€¼ä¸ºundefinedã€‚strict modeargumentså’Œå‘½åå‚æ•°æ— æ³•å†åŒæ­¥å‡½æ•°ä¸­é‡å†™argumentså¯¹è±¡ä¼šæŠ¥é”™ ç®­å¤´å‡½æ•°ä¸­çš„å‚æ•° ç®­å¤´å‡½æ•°å‚æ•°ä¸èƒ½ä½¿ç”¨argumentså…³é”®å­—è®¿é—®function foo() console.log(arguments[0]);foo(5); //5let bar = () = console.log(arguments[0]);bar(5); //ReferenceError: arguments is not definedå¯ä»¥åœ¨åŒ…è£…å‡½æ•°ä¸­æŠŠargumentsæä¾›ç»™ç®­å¤´å‡½æ•°function foo() let bar = () = console.log(arguments[0]); ; bar();foo(5); //5 10.2.2 æ²¡æœ‰é‡è½½ECMAScriptå‡½æ•°å‚æ•°å†…éƒ¨æ˜¯ç”±æ•°ç»„è¡¨ç¤ºçš„ï¼Œæ²¡æœ‰å‡½æ•°ç­¾åï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•é‡è½½ å­˜åœ¨åŒåå‡½æ•°ï¼Œåå®šä¹‰çš„è¦†ç›–å…ˆå®šä¹‰çš„ function addSomeNumber(num) return num + 100;function addSomeNumber(num) return num + 200;console.log(addSomeNumber(0)); //200å¯ä»¥é€šè¿‡æ£€æŸ¥å‚æ•°çš„ç±»å‹å’Œæ•°é‡ï¼Œåˆ†åˆ«æ‰§è¡Œä¸åŒé€»è¾‘æ¥æ¨¡æ‹Ÿå‡½æ•°é‡è½½ã€‚ 10.2.3 é»˜è®¤å‚æ•°å€¼ECMAScript5.1ä»¥å‰è®¾ç½®é»˜è®¤å‚æ•°å€¼ ç®€å•ç²—æš´ æ£€æµ‹å‚æ•°æ˜¯å¦ç­‰äºundefinedï¼Œæ˜¯çš„è¯å°±ç»™å®ƒèµ‹ä¸€ä¸ªå€¼function makeKing(name) name = (typeof name !== undefined) ? name : Henry; return `King $name VIII`;console.log(makeKing()); // King Henry VIIIconsole.log(makeKing(Louis)); // King Louis VIII ECMAScript6ï¼šæ”¯æŒå®ç°è®¾ç½®å‚æ•°é»˜è®¤å€¼ function makeKing(name = Henry) return `King $name VIII`;console.log(makeKing()); //King Henry VIIIconsole.log(makeKing(Louis)); // King Louis VIII é€šè¿‡ä¼ å€¼ä¸ºundefinedçš„å‚æ•°å ä½ function makeKing(name = Henry, numerals = VIII) return `King $name $numerals`console.log(makeKing()); //King Henry VIIIconsole.log(makeKing(Louis)); //King Louis VIIIconsole.log(makeKing(undefined, VI)); //King Henry VI argumentsä¸åæ˜ å‚æ•°çš„é»˜è®¤å€¼ argumentså§‹ç»ˆä»¥è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„å€¼ä¸ºå‡†ï¼Œæ‰€ä»¥ä¿®æ”¹å‘½åå‚æ•°ä¹Ÿä¸ä¼šå½±å“argumentså¯¹è±¡function makeKing(name = Henry) name = Louis; return `King $arguments[0]`;console.log(makeKing()); //King undefinedconsole.log(makeKing(Louis)); //King Louis é»˜è®¤å‚æ•°å¯ä»¥æ˜¯åŸå§‹ç±»å‹æˆ–è€…å¼•ç”¨ç±»å‹ è®¡ç®—é»˜è®¤å€¼çš„å‡½æ•°åªæœ‰åœ¨è°ƒç”¨å‡½æ•°å¹¶ä¸”æœªä¼ ç›¸åº”å‚æ•°æ—¶æ‰ä¼šè¢«è°ƒç”¨let romanNumerals = [I, II, III, IV, V, VI];let ordinalty = 0;function getNumerals() return romanNumerals[ordinalty++];function makeKing(name = Henry, numerals = getNumerals()) return `King $name $numerals`;console.log(makeKing()); //King Henry Iconsole.log(makeKing(Louis, XVI)); //King Louis XVIconsole.log(makeKing()); //King Henry II console.log(makeKing()); //King Henry III ç®­å¤´å‡½æ•°å¾—åˆ°é»˜è®¤å‚æ•° åœ¨åªæœ‰ä¸€ä¸ªå‚æ•°ä¸”è®¾ç½®äº†é»˜è®¤å€¼çš„æ—¶å€™ï¼Œç®­å¤´å‡½æ•°å‚æ•°çš„æ‹¬å·å°±ä¸èƒ½çœç•¥äº†let makeKing = (name = Henry) = `King $name`;console.log(makeKing()); //King Henry é»˜è®¤å‚æ•°ä½œç”¨åŸŸä¸æš‚æ—¶æ€§æ­»åŒº ç»™å‚æ•°èµ‹é»˜è®¤å€¼å®é™…ä¸Šç­‰åŒäºä½¿ç”¨leté¡ºåºå£°æ˜function makeKing(name = Henry, numerals = VIII) return `King $name $numerals`;console.log(makeKing()); //King Henry VIIIä¸Šé¢è¿™æ®µä»£ç å°±ç­‰åŒäºï¼šfunction makeKing() let name = Henry; let numerals = VIII; return `King $name $numerals`;console.log(makeKing()); //King Henry VIIIé»˜è®¤å‚æ•°èµ‹å€¼ä¹Ÿæ˜¯é¡ºåºçš„ï¼šfunction makeKing(name = Henry, numerals = name) return `King $name $numerals`;console.log(makeKing()); //King Henry Henryæš‚æ—¶æ€§æ­»åŒºæš‚æ—¶æ€§æ­»åŒº æŒ‡çš„æ˜¯ å‰é¢å®šä¹‰çš„å‚æ•°ä¸èƒ½å¼•ç”¨åé¢å®šä¹‰çš„ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ï¼šfunction makeKing(name = numerals, numerals = VIII) return `King $name $numerals`;// ReferenceError: Cannot access numerals before initializationconsole.log(makeKing());å‚æ•°ä¹Ÿå­˜åœ¨ä¸è‡ªå·±çš„ä½œç”¨åŸŸä¸­function makeKing(name = Henry, numerals = defaultNumers) let defaultNumbers = VIII; return `King $name $numerals`;console.log(makeKing()); //ReferenceError: defaultNumbers is not defined 10.2.4 å‚æ•°æ‰©å±•ä¸æ”¶é›†ES6æ–°å¢çš„æ‰©å±•æ“ä½œç¬¦æœ€æœ‰ç”¨çš„åœºæ™¯å°±æ˜¯å‡½æ•°å®šä¹‰ä¸­çš„å‚æ•°åˆ—è¡¨ æ‰©å±•å‚æ•°æ”¶é›†å‚æ•°ä½¿ç”¨åœºæ™¯ï¼šä¸éœ€è¦ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œå¼ºè°ƒåˆ†åˆ«ä¼ å…¥æ•°ç»„å…ƒç´ let values = [1, 2, 3, 4];function getSum() let sum = 0; for (let i = 0; i arguments.length; i++) sum += arguments[i]; return sum;å¯ä»¥ä½¿ç”¨æ‰©å±•æ“ä½œç¬¦æ‹†åˆ†å¯è¿­ä»£å¯¹è±¡å‚æ•°console.log(getSum(...values)); //10console.log(getSum(...values, 5)); //15console.log(getSum(-1, ...values, 5)); //14console.log(getSum(...values, ...[5, 6, 7])); //28æ‰©å±•æ“ä½œç¬¦ä¹Ÿå¯ä»¥ç”¨äºå‘½åå‚æ•°ä¸­function getProduct(a, b, c = 1) return a * b * c;let getSum = (a, b, c = 0) = return a + b + c;console.log(getProduct(...[1,2])); //2console.log(getProduct(...[1,2,3])); //6console.log(getProduct(...[1, 2, 3, 4])); //6console.log(getSum(...[0, 1])); //1console.log(getSum(...[0, 1, 2])); //3console.log(getSum(...[0, 1, 2, 3])); //3æ‰©å±•æ“ä½œç¬¦å¯ä»¥æŠŠä¸åŒé•¿åº¦çš„ç‹¬ç«‹å‚æ•°ç»„åˆä¸ºä¸€ä¸ªæ•°ç»„function getSum(...values) return values.reduce((x, y) = x + y, 0);console.log(getSum(1, 2, 3)); //6æ”¶é›†å‚æ•°å‰å¦‚æœè¿˜æœ‰å‘½åå‚æ•°ï¼Œå°±åªä¼šæ”¶é›†å‰©ä½™çš„å‚æ•°æ²¡æœ‰å‰©ä½™çš„è¯å°±åªå¾—åˆ°ç©ºæ•°ç»„function ignoreFirst(firstValue, ...values) console.log(values);ignoreFirst(); //[]ignoreFirst(1); //[]ignoreFirst(1, 2); //[2]ignoreFirst(1, 2, 3); //[2,3]function getProduct(...values, lastValue) //SyntaxError: Rest parameter must be last formal parameterç®­å¤´å‡½æ•°æ”¯æŒæ”¶é›†å‚æ•°let getSum = (...values) = return values.reduce((x, y) = x + y, 0);console.log(getSum(1, 2, 3)); //6æ”¶é›†å‚æ•°ä¸å½±å“argumentsfunction getSum(...values) console.log(arguments.length); //3 console.log(arguments); //[1,2,3] console.log(values); //[1,2,3]getSum(1, 2, 3);"},{"title":"10.3 å‡½æ•°ç‰¹æ€§","path":"/wiki/JavaScript/chapter_10_3.html","content":"10.3.1 å‡½æ•°å£°æ˜ä¸å‡½æ•°è¡¨è¾¾å¼å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼çš„ä¸»è¦åŒºåˆ«å°±åœ¨äºæ˜¯å¦ä¼šè¿›è¡Œå‡½æ•°å£°æ˜æå‡ï¼ˆfunctiondeclaration hoistingï¼‰ å‡½æ•°å£°æ˜ä¼šè¿›è¡Œå‡½æ•°å£°æ˜æå‡ å‡½æ•°å£°æ˜æå‡ å³ å‡½æ•°å£°æ˜ä¼šåœ¨ä»»ä½•ä»£ç æ‰§è¡Œä¹‹å‰å…ˆè¢«è¯»å–å¹¶æ·»åŠ åˆ°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚console.log(sum(1, 2)); //3function sum(num1, num2) return num1 + num2; å‡½æ•°è¡¨è¾¾å¼ å¿…é¡»è¦ç­‰åˆ°ä»£ç æ‰§è¡Œåˆ°é‚£ä¸€è¡Œæ‰ä¼šæ‰§è¡Œå‡½æ•°å®šä¹‰ è¿™å’Œletè¿˜æ˜¯varå£°æ˜æ— å…³ã€‚//ReferenceError: Cannot access num before initialization console.log(sum(10, 20)); let sum = function (num1, num2) return num1 + num2; 10.3.2 å‡½æ•°ä½œä¸ºå€¼å› ä¸ºå‡½æ•°åæœ¬èº«å°±æ˜¯å˜é‡ï¼Œå› æ­¤å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°å’Œè¿”å›å€¼ã€‚ function callSomeFunction(someFunction, someArgument) return someFunction(someArgument);function add10(num) return num + 10;console.log(callSomeFunction(add10, 10)); //20function getGreeting(name) return Hello, + name;console.log(callSomeFunction(getGreeting, Nicholas)); //Hello, Nicholas ä»ä¸€ä¸ªå‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°å¯ä»¥éå¸¸æœ‰ç”¨ ä¸‹é¢çš„ç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥æŒ‰ç…§å¯¹è±¡æ•°ç»„ä¸­ä»»æ„å¯¹è±¡å±æ€§å¯¹æ•°ç»„è¿›è¡Œæ’åºçš„å‡½æ•°function createComparisonFunction(propertyName) return function (object1, object2) let value2 = object2[propertyName]; let value1 = object1[propertyName]; if (value1 value2) return -1; else if (value1 value2) return 1; else return 0; ;let data = [ name: Zachary, age: 28 , name: Nicholas, age: 29 ];data.sort(createComparisonFunction(name));console.log(data[0].name); //Nicholas 10.3.3 å‡½æ•°å†…éƒ¨å‡½æ•°å†…éƒ¨å­˜åœ¨ä¸‰ä¸ªç‰¹æ®Šå¯¹è±¡ argumentsthisnew.target arguments arguments.callee æ˜¯ä¸€ä¸ªæŒ‡å‘argumentså¯¹è±¡æ‰€åœ¨å‡½æ•°çš„æŒ‡é’ˆã€‚ ç»å…¸é˜¶ä¹˜å‡½æ•°function factorial(num) if (num = 1) return 1; else return num * factorial(num - 1); console.log(factorial(10)); //3628800ä½¿ç”¨arguments.calleeé‡å†™è¿­ä»£è¿™æ ·çš„è¯å°±å¯ä»¥è®©å‡½æ•°é€»è¾‘ä¸å‡½æ•°åè§£è€¦ï¼Œè§£å†³äº†ç¡¬ç¼–ç å¸¦æ¥çš„é—®é¢˜ã€‚ function factorial(num) if (num = 1) return 1; else return num * arguments.callee(num - 1); console.log(factorial(5)); //120let trueFactorial = factorial;factorial = function () return 0;console.log(trueFactorial(5)); //120console.log(factorial(10)) //0 this æ ‡å‡†å‡½æ•°ä¸­çš„thiså¼•ç”¨çš„æ˜¯æŠŠå‡½æ•°å½“æˆæ–¹æ³•è°ƒç”¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå…¨å±€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨å‡½æ•°ï¼ŒthisæŒ‡å‘ windowsã€‚ window.color = red;let o = color: blue;function sayColor() console.log(this.color);sayColor(); //redo.sayColor = sayColor;o.sayColor(); //blueç®­å¤´å‡½æ•°ä¸­çš„thiså¼•ç”¨çš„æ˜¯å®šä¹‰ç®­å¤´å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚ window.color = red;let o = color: bluelet sayColor = () = console.log(this.color);sayColor(); //redo.sayColor = sayColor;o.sayColor(); //redå› æ­¤åœ¨ä½¿ç”¨äº‹ä»¶å›è°ƒæˆ–å®šæ—¶å›è°ƒæ—¶ï¼Œä¸ºäº†ä¿è¯å›è°ƒå‡½æ•°å†…thiså€¼æŒ‡å‘å®šä¹‰å‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼Œå¸¸ä½¿ç”¨ç®­å¤´å‡½æ•°å®šä¹‰å›è°ƒå‡½æ•°ã€‚function King() this.royaltyName = Henry; setTimeout(() = console.log(this.royaltyName), 1000);function Queen() this.royaltyName = Elizabeth; setTimeout(function () console.log(this.royaltyName); , 1000);new King(); //Henrynew Queen(); //undefined caller caller å¼•ç”¨çš„æ˜¯è°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°ã€‚ function outer() inner();function inner() console.log(inner.caller);outer(); //output:outer source codeä¸ºäº†é™ä½è€¦åˆåº¦ï¼Œå¯ä»¥å¼•ç”¨arguments.callee.callerã€‚function outer() inner();function inner() console.log(arguments.callee.caller);outer(); //outer source codeä¸¥æ ¼æ¨¡å¼ä¸‹è®¿é—®arguments.calleeä¼šæŠ¥é”™ä¸èƒ½ç»™callerå±æ€§èµ‹å€¼ new.targetï¼ˆES6ï¼‰ ç”¨äºæ£€æµ‹å‡½æ•°æ˜¯å¦æ˜¯ä½¿ç”¨newå…³é”®å­—è°ƒç”¨çš„ã€‚ æ­£å¸¸è°ƒç”¨ new.target undefinednewå…³é”®å­—è°ƒç”¨ new.target è¢«è°ƒç”¨çš„æ„é€ å‡½æ•°function King() if (!new.target) throw King must be instantiated using new console.log(King instantiated using new);new King(); //King instantiated using newKing(); //Error:King must be instantiated using new 10.3.4 å‡½æ•°å±æ€§ä¸æ–¹æ³•å‡½æ•°å›ºæœ‰å±æ€§ï¼ˆ2ä¸ªï¼‰ lengthlengthä¿å­˜å‡½æ•°å®šä¹‰çš„å‘½åå‚æ•°ä¸ªæ•°ã€‚ function sayName(name) console.log(name)function sum(num1, num2) return num1 + num2;function sayHi() console.log(hi)console.log(sayName.length) //1console.log(sum.length) //2console.log(sayHi.length) //0prototypeprototypeç”¨äºä¿å­˜å¼•ç”¨ç±»å‹æ‰€æœ‰å®ä¾‹æ–¹æ³•ï¼Œåœ¨è‡ªå®šä¹‰ç±»å‹æ—¶ç‰¹åˆ«é‡è¦ã€‚æ³¨æ„prototypeä¸å¯æšä¸¾ã€‚ å‡½æ•°æ–¹æ³•ï¼ˆapplyï¼Œcallï¼Œbindï¼‰ è¿™3ç§æ–¹æ³•éƒ½æ˜¯ç”¨äº è®¾ç½®è°ƒç”¨å‡½æ•°æ—¶å‡½æ•°ä½“å†…thiså¯¹è±¡çš„å€¼ã€‚strictæ¨¡å¼ä¸‹ï¼Œæ²¡æœ‰æŒ‡å®šä¸Šä¸‹æ–‡çš„è°ƒç”¨å‡½æ•°ï¼Œå‡½æ•°çš„thisä¸ä¼šæŒ‡å‘windowï¼Œè€Œä¼šå˜æˆundefinedapply()æ¥æ”¶2ä¸ªå‚æ•°ï¼š param1 æŒ‡å®šthis param2 å‚æ•°æ•°ç»„ function sum(num1, num2) return num1 + num2;function callSum1(num1, num2) return sum.apply(this, arguments);function callSum2(num1, num2) return sum.apply(this, [num1, num2]);console.log(callSum1(10, 20)); //30console.log(callSum2(20, 30)); //50 call()callæ–¹æ³•å’Œapplyçš„ä¸åŒä¹‹å¤„åœ¨äºï¼šéœ€è¦ä¼ é€’çš„å‚æ•°æ˜¯é€ä¸ªä¼ é€’çš„ function sum(num1, num2) return num1 + num2;function callSum(num1, num2) return sum.call(this, ...arguments);console.log(callSum(10, 20)); //30applyå’Œcallæœ€å¼ºå¤§å°±æ˜¯æ§åˆ¶å‡½æ•°è°ƒç”¨ä¸Šä¸‹æ–‡thisçš„èƒ½åŠ›ã€‚ window.color = redlet o = color:bluefunction sayColor() console.log(this.color)sayColor();sayColor.call(this); //redsayColor.call(window); //redsayColor.call(o); //bluebindï¼ˆES5ï¼‰bindå’Œcallã€applyçš„åŒºåˆ«åœ¨äºbindä¼šåˆ›å»ºä¸€ä¸ªç»‘å®šäº†æŒ‡å®šthisçš„å‡½æ•°å®ä¾‹ã€‚window.color = red;var o = color:bluefunction sayColor() console.log(this.color);let objectSayColor = sayColor.bind(o);objectSayColor(); //blueæç¤ºtoLocaleString() å’Œ toString() å§‹ç»ˆè¿”å›å‡½æ•°ä»£ç ï¼Œä½†æ˜¯è¿”å›ä»£ç çš„å…·ä½“æ ¼å¼ä¼šå› æµè§ˆå™¨è€Œå¼‚ï¼Œå› æ­¤åº”è¯¥åœ¨é‡è¦åŠŸèƒ½æ˜¯é¿å…ä¾èµ–è¿™äº›æ–¹æ³•çš„è¿”å›å€¼ã€‚ 10.3.5 å‡½æ•°è¡¨è¾¾å¼let functionName = function (arg1, arg2, arg3) ; åƒè¿™æ ·åˆ›å»ºçš„å‡½æ•°å«åš åŒ¿åå‡½æ•°ï¼ˆanonymous functionï¼‰ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºå…°å§†è¾¾ï¼ˆÎ»ï¼‰å‡½æ•° å‡½æ•°å£°æ˜æå‡æ¡ˆä¾‹ ä½¿ç”¨å‡½æ•°å£°æ˜ä¼šè¿›è¡Œå£°æ˜æå‡ï¼Œå¦‚ä¸‹é¢è¿™æ®µå±é™©çš„ä»£ç ï¼šlet condition = true;if (condition) function sayHi() console.log(Hi!) else function sayHi() console.log(Yo!) sayHi() // Hiä¹Ÿè®¸æµè§ˆå™¨ä¼šå¸®ä½ çº æ­£è¿™æ®µå£°æ˜ï¼Œå…³é”®åœ¨äºä¸åŒæµè§ˆå™¨çº æ­£é—®é¢˜çš„æ–¹å¼ä¸ä¸€è‡´ï¼Œæ‰€ä»¥å°½é‡ä¸è¦è¿™ä¹ˆå†™ã€‚"},{"title":"10.4 å‡½æ•°è°ƒç”¨æŠ€å·§","path":"/wiki/JavaScript/chapter_10_4.html","content":"10.4.1 é€’å½’é€’å½’å‡½æ•°é€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°é€šè¿‡åç§°è°ƒç”¨è‡ªå·± ä½†å¦‚æœä¸å°†å‡½æ•°é€»è¾‘å’Œå‡½æ•°åç§°è§£è€¦åˆï¼Œå°±å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼š function factorial(num) if (num = 1) return 1; else return num * factorial(num - 1); let anotherFactorial = factorial;factorial = null;//TypeError: factorial is not a functionconsole.log(anotherFactorial(10)); ä½¿ç”¨arguments.calleeå¯ä»¥è§£å†³ç¡¬ç¼–ç é—®é¢˜ function factorial(num) if (num = 1) return num; else return num * arguments.callee(num - 1); ä¸¥æ ¼æ¨¡å¼ä¸‹è§£è€¦é€’å½’å‡½æ•° ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸èƒ½è®¿é—®arguments.callee,å¯ä»¥ä½¿ç”¨å‘½åå‡½æ•°è¡¨è¾¾å¼ï¼ˆnamed function expressionï¼‰ã€‚const factorial = (function f(num) if (num = 1) return 1; else return num * f(num - 1); ) 10.4.2 å°¾è°ƒç”¨ä¼˜åŒ–å°¾è°ƒç”¨ å³å¤–éƒ¨å‡½æ•°è¿”å›å€¼æ˜¯ä¸€ä¸ªå†…éƒ¨å‡½æ•°çš„è¿”å›å€¼function outerFunction() return innerFunction();ES6æ–°å¢çš„ä¸€é¡¹å†…å­˜ç®¡ç†ä¼˜åŒ–æœºåˆ¶ï¼šJSå¼•æ“åœ¨æ»¡è¶³æ¡ä»¶æ—¶å¯ä»¥é‡ç”¨æ ˆå¸§ï¼Œä½¿å°¾è°ƒç”¨æ›´å…·ä¼˜åŠ¿ã€‚ æ¯”è¾ƒES6ä¼˜åŒ–å‰åå°¾è°ƒç”¨çš„æ‰§è¡Œæ­¥éª¤ ä¼˜åŒ–å‰ä¼˜åŒ–åouterFunctionæ‰§è¡Œï¼Œæ¨ä¸Šâ‘ å·æ ˆå¸§æ‰§è¡Œåˆ°returnï¼Œå¼€å§‹è¿›å…¥innerFunctioninnerFunctionæ‰§è¡Œï¼Œæ¨ä¸Šâ‘¡å·æ ˆå¸§æ‰§è¡Œåˆ°returnï¼Œè®¡ç®—è¿”å›å€¼resultresultä¼ å›outerFunctionouterFunctionè¿”å›resultå¼¹å‡ºâ‘ â‘¡å·æ ˆå¸§ç»“è®ºï¼šæ¯å¤šè°ƒç”¨ä¸€æ¬¡åµŒå¥—å‡½æ•°ï¼Œå°±ä¼šå¤šå¢åŠ ä¸€ä¸ªæ ˆå¸§ã€‚outerFunctionæ‰§è¡Œï¼Œæ¨ä¸Šâ‘ å·æ ˆå¸§æ‰§è¡Œåˆ°returnï¼Œå¼€å§‹è¿›å…¥innerFunctionJSå¼•æ“æ£€æµ‹innerFunctionå’ŒouterFunctionçš„è¿”å›å€¼æ˜¯å¦ä¸€è‡´ï¼ˆç»“æœä¸€è‡´ï¼‰å¼¹å‡ºâ‘ å·æ ˆå¸§æ‰§è¡Œåˆ°innerFunctionï¼Œæ¨ä¸Šâ‘¡å·æ ˆå¸§æ‰§è¡Œåˆ°returnï¼Œè®¡ç®—è¿”å›å€¼resultå¼¹å‡ºâ‘¡å·æ ˆå¸§ç»“è®ºï¼šæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡åµŒå¥—å‡½æ•°ï¼Œéƒ½åªæœ‰ä¸€ä¸ªæ ˆå¸§ å°¾è°ƒç”¨ä¼˜åŒ–çš„æ¡ä»¶ï¼šç¡®è®¤å¤–éƒ¨æ ˆå¸§çœŸçš„æ²¡æœ‰å­˜åœ¨å¿…è¦äº† æ¶‰åŠæ¡ä»¶å¦‚ä¸‹ï¼šâ€œuse strictâ€åŸå› ï¼šéä¸¥æ ¼æ¨¡å¼ä¸‹å‡½æ•°å­˜åœ¨argumentså±æ€§å’Œcalleræ–¹æ³•ï¼Œéƒ½ä¼šå¼•ç”¨å¤–éƒ¨å‡½æ•°çš„æ ˆå¸§ã€‚å¤–éƒ¨å‡½æ•°è¿”å›å€¼æ˜¯å¯¹å°¾è°ƒç”¨å‡½æ•°çš„è°ƒç”¨ è¿åä¼˜åŒ–æ¡ä»¶use strict;// å°¾è°ƒç”¨æ²¡æœ‰è¿”å›function outerFunction() innerFunction(); ç¬¦åˆä¼˜åŒ–æ¡ä»¶use strict;function outerFunction(a,b) return innerFunction(a+b); å°¾è°ƒç”¨å‡½æ•°è¿”å›åä¸éœ€è¦æ‰§è¡Œé¢å¤–çš„é€»è¾‘ è¿åä¼˜åŒ–æ¡ä»¶use strict;// å°¾è°ƒç”¨æ²¡æœ‰ç›´æ¥è¿”å›function outerFunction() let innerFunctionRsult = innerFunction(); return innerFunctionResult;// å°¾è°ƒç”¨è¿”å›åå¿…é¡»è½¬å‹ä¸ºå­—ç¬¦ä¸²function outerFunction() return innerFunction().toString(); ç¬¦åˆä¼˜åŒ–æ¡ä»¶use strict;function outerFunction(a,b) if(ab) return a; return innerFunction(a+b); å°¾è°ƒç”¨å‡½æ•°ä¸æ˜¯å¼•ç”¨å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸä¸­è‡ªç”±å˜é‡çš„é—­åŒ… è¿åä¼˜åŒ–æ¡ä»¶use strict;// å°¾è°ƒç”¨æ˜¯ä¸€ä¸ªé—­åŒ…function outerFunction() let foo = bar; function innerFunction()return foo; return innerFunction(); ç¬¦åˆä¼˜åŒ–æ¡ä»¶function outerFunction(condition) return condition?innerFunctionA():innerFunctionB(); Tipsï¼šå°¾è°ƒç”¨ä¼˜åŒ–åœ¨é€’å½’åœºæ™¯ä¸‹æ•ˆæœæœ€å¥½ã€‚ å°¾è°ƒç”¨ä¼˜åŒ–çš„ä»£ç  ä¸‹é¢æ˜¯ä¸€æ®µå¾…ä¼˜åŒ–çš„ä»£ç ï¼šfunction fib(num) if (num 2) return num; // å­˜åœ¨ç›¸åŠ é€»è¾‘æ“ä½œï¼Œä¸ç¬¦åˆä¼˜åŒ–æ¡ä»¶ return fib(num - 1) + fib(num - 2);console.log(fib(1)); //1console.log(fib(5)); //5let startTime = new Date();console.log(fib(20)); //6765console.log(new Date() - startTime); //1å¯ä»¥æ”¹å†™æˆè¿­ä»£å¾ªç¯å½¢å¼function fib(n) return fibImpl(0, 1, n);function fibImpl(a, b, n) if (n === 0) return a; return fibImpl(b, a + b, n - 1);console.log(fib(1)); //1console.log(fib(5)); //5let startTime = new Date();console.log(fib(100)); //354224848179262000000console.log(new Date() - startTime); //0 10.4.3 é—­åŒ…ï¼ˆclosureï¼‰é—­åŒ…æŒ‡çš„æ˜¯å¼•ç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚ ä½œç”¨åŸŸé“¾ åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šè¿›è¡Œè¿™2æ­¥æ“ä½œï¼šåˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸé“¾function outerFunction() function innerFunction()innerFunctionä½œç”¨åŸŸé“¾ï¼šinnerFunction - outerFunction - [ more ] outerFunctionçš„æ´»åŠ¨å¯¹è±¡æ˜¯innerFunctionä½œç”¨åŸŸé“¾ä¸Šçš„ç¬¬äºŒä¸ªå¯¹è±¡ä½œç”¨åŸŸé“¾ä¸€ç›´å‘å¤–ä¸²èµ·æ‰€æœ‰åŒ…å«å‡½æ•°çš„æ´»åŠ¨å¯¹è±¡ä½œç”¨åŸŸé“¾ç»ˆæ­¢äºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ å˜é‡å¯¹è±¡å’Œæ´»åŠ¨å¯¹è±¡ æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªåŒ…å«å…¶ä¸­å˜é‡çš„å¯¹è±¡ã€‚ åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­å°±å«åšå˜é‡å¯¹è±¡åœ¨å‡½æ•°å±€éƒ¨ä¸Šä¸‹æ–‡ä¸­å°±å«åšæ´»åŠ¨å¯¹è±¡ï¼Œåªåœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´å­˜åœ¨ æ™®é€šå‡½æ•°çš„ä½œç”¨åŸŸé“¾ function compare(value1, value2) if(value1value2) return -1; else if(value1value2) return 1; else return 0; let result = compare(5,10); å®šä¹‰compareå‡½æ•°ç»å†æ­¥éª¤åˆ›å»ºä½œç”¨åŸŸé“¾é¢„è£…è½½å…¨å±€å˜é‡å¯¹è±¡å…¨å±€å˜é‡å¯¹è±¡ä¿å­˜åœ¨å†…éƒ¨çš„[[Scope]]ä¸­ è°ƒç”¨compareå‡½æ•°ç»å†æ­¥éª¤åˆ›å»ºç›¸åº”æ‰§è¡Œä¸Šä¸‹æ–‡å¤åˆ¶å‡½æ•°çš„[[Scope]]åˆ›å»ºä½œç”¨åŸŸé“¾åˆ›å»ºå‡½æ•°çš„æ´»åŠ¨å¯¹è±¡å°†å‡½æ•°æ´»åŠ¨å¯¹è±¡æ¨å…¥ä½œç”¨åŸŸé“¾é¦–å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œé”€æ¯å±€éƒ¨æ´»åŠ¨å¯¹è±¡ æ™®é€šå‡½æ•°ä½œç”¨åŸŸé“¾æŒ‡é’ˆç¤ºæ„å›¾ åŒ¿åå‡½æ•°çš„ä½œç”¨åŸŸé“¾ function createComparisionFunction(propertyName) return function(object1,object2) let value1 = object1[propertyName]; let value2 = object2[propertyName]; if(value1value2) return -1; else if(value1value2) return 1; else return 0; let compare = createComparisionFunction(name);let result = compare(name:Nicolas,name:Matt);åŒ¿åå‡½æ•°ä¸æ™®é€šå‡½æ•°çš„ä¸åŒåœ¨äºï¼šå¤–éƒ¨å‡½æ•°ï¼ˆcreateComparisonFunctionï¼‰æ‰§è¡Œå®Œæ¯•åï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ä¼šé”€æ¯ï¼Œä½†æ˜¯æ´»åŠ¨å¯¹è±¡ä»ç„¶ä¼šä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°åŒ¿åå‡½æ•°è¢«é”€æ¯åæ‰èƒ½å®Œå…¨è¢«é”€æ¯ã€‚è¿™æ˜¯å› ä¸ºåŒ¿åå‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ä»ç„¶æœ‰å¯¹å®ƒçš„å¼•ç”¨ã€‚ä½œä¸ºè¿”å›å€¼çš„åŒ¿åé—­åŒ…å‡½æ•°ä½œç”¨åŸŸé“¾æŒ‡é’ˆç¤ºæ„å›¾è§£é™¤å¯¹å‡½æ•°å¼•ç”¨å¯¹ç­–ï¼šæ‰‹åŠ¨é‡Šæ”¾å†…å­˜let compareNames = createComparisonFunction(name);let result = compareNames(name:Nicholas,name:Rachel);// è§£é™¤å ç”¨compareNames = null;å› ä¸ºé—­åŒ…å‡½æ•°ä¼šä¿ç•™å…¶å¤–éƒ¨å‡½æ•°çš„æ´»åŠ¨å¯¹è±¡ï¼Œå› æ­¤æ¯”å…¶ä»–å‡½æ•°æ›´å ç”¨å†…å­˜ï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚ é—­åŒ…ä¸­çš„this é—­åŒ…ä¸­ä½¿ç”¨thisä¼šè®©ä»£ç å˜å¾—å¤æ‚ã€‚window.identity = The Window;let object = identity: My Object, getIdentityFunc() return function () return this.identity; console.log(object.getIdentityFunc()()); //The Windowconsole.log(object.getIdentityFunc().apply(object)); //My Objectä¿ç•™thiså¯ä»¥ä¿è¯é—­åŒ…å‡½æ•°çš„thisä¸å…¶å¤–éƒ¨å‡½æ•°çš„thisä¸€è‡´window.identity = The Window;let object = identity: My Object, getIdentityFunc() let that = this; return function () return that.identity; console.log(object.getIdentityFunc()()); //My Objectç‰¹æ®Šæƒ…å†µåˆ†æwindow.identity = The Window;let object = identity: My Object, getIdentity() console.log(this.identity); object.getIdentity(); //My Object(object.getIdentity)(); //My Object(object.getIdentity = object.getIdentity)(); //The Windowç¬¬ä¸€è¡Œï¼šobejct.getIdentity()æ™®é€šå‡½æ•°ä¸­thisæŒ‡å‘è°ƒç”¨å‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºè¿™é‡Œè°ƒç”¨å‡½æ•°çš„ä¸Šä¸‹æ–‡æ˜¯objectï¼Œå› æ­¤è¿™é‡Œçš„thiså°±æ˜¯objectç¬¬äºŒè¡Œï¼š(object.getIdentity)()æŒ‰ç…§è§„èŒƒï¼Œobject.getIdenitty (object.getIdentity)ï¼Œå› æ­¤thisè¿˜æ˜¯objectç¬¬ä¸‰è¡Œï¼š(object.getIdentity object.getIdentity)()å› ä¸ºèµ‹å€¼è¡¨è¾¾å¼å³ä¾§çš„å€¼æ˜¯å‡½æ•°æœ¬èº«ï¼Œå¹¶éå‡½æ•°å¼•ç”¨ï¼Œå› æ­¤è¿™é‡Œthisçš„å€¼ä¸å†ä¸ä»»ä½•å¯¹è±¡ç»‘å®šï¼Œæ‰€ä»¥thisæŒ‡å‘çš„æ˜¯window å†…å­˜æ³„æ¼ function assignHandler() let element = document.getElementById(someElement); element.onclick = () = console.log(element.id);ä¸Šé¢çš„ä»£ç ä¸­åŒ¿åå‡½æ•°çš„å­˜åœ¨å¯¼è‡´elementå§‹ç»ˆè¢«å¼•ç”¨ï¼Œå…¶å†…å­˜ä¸ä¼šè¢«å›æ”¶ã€‚å› æ­¤å¯ä»¥è¿›è¡Œæ‰‹åŠ¨å›æ”¶ã€‚ function assignHandler() let element = document.getElementById(someElement); let id = element.id; element.onclick = () = console.log(id); element = null; 10.4.4 ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼ŒImmediately Invoked Function Expressionï¼‰ (function() // å—çº§ä½œç”¨åŸŸ)(); IIFEä¸»è¦ç”¨äºæ¨¡æ‹Ÿå—çº§ä½œç”¨åŸŸ ä¸»è¦é’ˆå¯¹äºECMAScript5.1ä¹‹å‰ä¸æ”¯æŒå—çº§ä½œç”¨åŸŸçš„æƒ…å†µã€‚let count = 5;(function () for (let i = 0; i count; i++) console.log(i); )(); // 0 1 2 3 4å› ä¸ºä¸å­˜åœ¨å¯¹è¿™ä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œå› æ­¤åªè¦å‡½æ•°æ‰§è¡Œå®Œæ¯•å…¶ä½œç”¨åŸŸé“¾å°±ä¼šè¢«é”€æ¯ã€‚ ECMAScript6ä»¥åå‡ºç°äº†å—çº§ä½œç”¨åŸŸï¼š let i; for (i = 0; i couhnt; i++) console.log(i); console.log(i); //Error IIFEè¿˜å¯ä»¥ç”¨æ¥é”å®šå‚æ•°å€¼ let divs = document.querySelectorAll(div);for (var i = 0; i divs.length; ++i) divs[i].addEventListener(click, function () console.log(i); )ä»¥ä¸Šè¿™æ®µä»£ç ä¼šå¯¼è‡´æ¯æ¬¡è§¦å‘clickéƒ½æ‰“å°åŒæ ·çš„å€¼ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼é”å®šç´¢å¼•å€¼ï¼šlet divs = document.querySelectorAll(div);for (var i = 0; i divs.length; ++i) divs[i].addEventListener(click, (function (frozenCounter) return function () console.log(frozenCounter); )(i));ä½¿ç”¨ ECMAScript6 å—çº§ä½œç”¨åŸŸå°±ç®€å•é‚£å¤šäº†ï¼šlet divs = document.querySelectorAll(div);for (let i = 0; i divs.length; ++i) divs[i].addEventListener(click, function () console.log(i); )å½“ç„¶è¦ä¿è¯forå¾ªç¯ä½¿ç”¨å—çº§ä½œç”¨åŸŸå˜é‡å…³é”®å­—ï¼šlet divs = document.querySelectorAll(div);let i;for (i = 0; i divs.length; ++i) divs[i].addEventListener(click, function () console.log(i); //same output ) 10.4.5 ç§æœ‰å˜é‡JavaScriptä»»ä½•å®šä¹‰åœ¨å‡½æ•°æˆ–å—ä¸­çš„å˜é‡ï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯ç§æœ‰çš„ã€‚ é—­åŒ…ä¸ç§æœ‰å˜é‡ å¦‚æœåœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªèƒ½é€šè¿‡ä½œç”¨åŸŸé“¾è®¿é—®å¤–éƒ¨å‡½æ•°å˜é‡çš„é—­åŒ…ï¼Œå°±èƒ½å¤Ÿåˆ›å»ºå‡ºè®¿é—®ç§æœ‰å˜é‡çš„å…¬æœ‰æ–¹æ³•ã€‚ ç‰¹æƒæ–¹æ³•ï¼ˆprivileged methodï¼‰ ç‰¹æƒæ–¹æ³•æŒ‡çš„æ˜¯èƒ½å¤Ÿè®¿é—®å‡½æ•°ç§æœ‰å˜é‡æ–¹æ³•çš„å…¬æœ‰æ–¹æ³•ã€‚æ–¹æ³•ä¸€ï¼šåœ¨æ„é€ å‡½æ•°ä¸­å®ç°å³åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ç§æœ‰å˜é‡å’Œç§æœ‰æ–¹æ³•ï¼Œå†åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿè®¿é—®è¿™äº›ç§æœ‰æˆå‘˜çš„ç‰¹æƒæ–¹æ³•ï¼šfunction Person(name) this.getName = function () return name; ; this.setName = function (value) name = value; let person = new Person(Nicholas);console.log(person.getName()); //Nicholasperson.setName(Greg);console.log(person.getName()); //Gregæ–¹æ³•äºŒï¼šä½¿ç”¨ç§æœ‰ä½œç”¨åŸŸå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•°(function () let privateVariable = 10; function privateFunction() return false; MyObject = function () ; MyObject.prototype.publicMethod = function () privateVariable++; return privateFunction(); )();è¿™ç§æ–¹å¼å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå®ä¾‹å…±äº«ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•°ï¼š(function () let name = ; Person = function (value) name = value; ; Person.prototype.getName = function () return name; Person.prototype.setName = function (value) name = value; )();let person1 = new Person(Nicholas);console.log(person1.getName()); //Nicholasperson1.setName(Matt);console.log(person1.getName()); //Mattlet person2 = new Person(Michael);console.log(person2.getName()); //Michaelconsole.log(person1.getName()); //Michael æ¨¡å—æ¨¡å¼ æ¨¡å—æ¨¡å¼æ˜¯åœ¨å•ä¾‹å¯¹è±¡åŸºç¡€ä¸Šçš„æ‰©å±•ã€‚let singleton = function () let proivateVariable = 10; function privateFunction() return false; return publicProperty: true, publicMethod() privateVariable++; return privateFunction(); ();å¦‚æœå•ä¾‹å¯¹è±¡éœ€è¦è¿›è¡ŒæŸç§åˆå§‹åŒ–ï¼Œ å¹¶ä¸”éœ€è¦è®¿é—®ç§æœ‰å˜é‡æ—¶ï¼Œ å¯ä»¥é‡‡ç”¨è¿™ä¸ªæ¨¡å¼ï¼š let application = function () let components = new Array(); components.push(new BaseComponent()); return getComponentCount() return components.length; , registerComponent(component) if (typeof component == object) components.push(component); ();å•ä¾‹æ¨¡å¼ä¸ç»„ä»¶ç®¡ç†Webå¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å•ä¾‹å¯¹è±¡ç®¡ç†åº”ç”¨ç¨‹åºçº§çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åœ¨é¡µé¢ç»„ä»¶çš„ç®¡ç†ä¸Šã€‚ æ¨¡å—å¢å¼ºæ¨¡å¼ å¢å¼ºæ¨¡å¼å³åœ¨è¿”å›å¯¹è±¡ä¹‹å‰å¯¹å…¶è¿›è¡Œå¢å¼ºï¼Œè¿™é€‚åˆå•ä¾‹å¯¹è±¡éœ€è¦æ—¶æŸä¸ªç‰¹å®šç±»å‹çš„å®ä¾‹ï¼Œä½†åˆå¿…é¡»ç»™å®ƒæ·»åŠ é¢å¤–å±æ€§æˆ–æ–¹æ³•çš„åœºæ™¯ã€‚ let singleton = function () let privateVariable = 10; function privateFunction() return false; let object = new CustomType(); object.publicProperty = true; object.publicMethod = function () privateVariable++; return privateFunction(); ; return object;é‡å†™å•ä¾‹æ¨¡å¼ä¸­çš„applicationå¯¹è±¡ï¼šlet application = function () let components = new Array(); components.push(new BaseComponent()); let app = new BaseComponent(); app.getComponentCount = function () return components.length; ; app.getComponentCount = function (component) if (typeof component == object) components.push(component); ; return app;"},{"title":"11.1 å¼‚æ­¥ç¼–ç¨‹","path":"/wiki/JavaScript/chapter_11_1.html","content":"åŒæ­¥ä¸å¼‚æ­¥ åœ¨JavaScriptè¿™ç§å•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸­ï¼ŒåŒæ­¥æ“ä½œä¸å¼‚æ­¥æ“ä½œæ˜¯ä»£ç è¦ä¾èµ–çš„æ ¸å¿ƒæœºåˆ¶ã€‚å¼‚æ­¥è¡Œä¸ºæ˜¯ä¸ºäº†ä¼˜åŒ–å› è®¡ç®—é‡å¤§è€ŒèŠ±è´¹æ—¶é—´é•¿çš„æ“ä½œã€‚ 11.1.1 åŒæ­¥ä¸å¼‚æ­¥ åŒæ­¥è¡Œä¸ºå¯¹åº”å†…å­˜ä¸­é¡ºåºæ‰§è¡Œçš„å¤„ç†å™¨æŒ‡ä»¤ã€‚æ¯æ¡æŒ‡ä»¤ä¸¥æ ¼æŒ‰ç…§å‡ºç°é¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œåç«‹å³è·å¾—å­˜å‚¨åœ¨ç³»ç»Ÿæœ¬åœ°çš„ä¿¡æ¯ã€‚let x = 3;x = x + 4; å¼‚æ­¥è¡Œä¸ºå¼‚æ­¥è¡Œä¸ºç±»ä¼¼äºç³»ç»Ÿä¸­æ–­ã€‚å³å½“å‰è¿›ç¨‹å¤–éƒ¨çš„å®ä½“å¯ä»¥è§¦å‘ä»£ç æ‰§è¡Œï¼Œå¸¸ç”¨äºè®¿é—®ä¸€äº›é«˜å»¶è¿Ÿçš„èµ„æºã€‚ let x = 3;setTimeout(() = x = x + 4, 1000); é¢„çŸ¥å¼‚æ­¥æ‰§è¡Œçš„å˜åŒ– å¼‚æ­¥æ‰§è¡Œç”±ç³»ç»Ÿè®¡æ—¶å™¨è§¦å‘ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå…¥é˜Ÿæ‰§è¡Œçš„ä¸­æ–­ï¼Œä¸­æ–­ä½•æ—¶è§¦å‘åˆ™æ˜¯æ— æ³•é¢„çŸ¥çš„ï¼Œä½†å¯ä»¥ä¿è¯ä¸­æ–­å‘ç”Ÿåœ¨å½“å‰çº¿ç¨‹çš„åŒæ­¥ä»£ç æ‰§è¡Œä»¥åã€‚ 11.1.2 ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼å›è°ƒåœ°ç‹± æ—©æœŸJSä¸­åªæ”¯æŒå›è°ƒå‡½æ•°æ¥è¡¨æ˜å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå› æ­¤å¸¸å¸¸ä¼šä¸²è”å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œä¿—ç§°å›è°ƒåœ°ç‹±ï¼ˆæ·±åº¦åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼‰ã€‚function double(value) setTimeout(() = setTimeout(console.log, 0, value * 2), 1000);double(3); //6ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œdoubleå‡½æ•°åœ¨setTimeoutæˆåŠŸè°ƒåº¦å¼‚æ­¥æ“ä½œä¹‹åå°±ä¼šç«‹å³é€€å‡ºã€‚ 1.å¼‚æ­¥è¿”å›å€¼ å¸¸ç”¨çš„ç­–ç•¥æ˜¯ï¼šç»™å¼‚æ­¥æ“ä½œæä¾›ä¸€ä¸ªåŒ…å«è¦ä½¿ç”¨å¼‚æ­¥è¿”å›å€¼ä»£ç çš„å›è°ƒå‡½æ•°ã€‚ function double(value, callback) setTimeout(() = callback(value * 2), 1000);// I was given 6double(3, (x) = console.log(`I was given: $x`)); 2.å¤±è´¥å¤„ç† è€ƒè™‘åˆ°å¼‚æ­¥æ“ä½œä¹Ÿå¯èƒ½å­˜åœ¨å¤±è´¥å¤„ç†ï¼Œå› æ­¤å°±åˆ†åŒ–å‡ºäº†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒã€‚è¿™ç§æ¨¡å¼å¿…é¡»åœ¨åˆå§‹åŒ–å¼‚æ­¥æ“ä½œæ—¶å®šä¹‰å›è°ƒã€‚ function double(value, success, failure) setTimeout(() = try if (typeof value !== number) throw Must provide number as first argument; success(2 * value); catch (e) failure(e); , 1000);const successCallback = (x) = console.log(`Success: $x`);const failureCallback = (e) = console.log(`Failure: $e`);// Success: 6double(3, successCallback, failureCallback);// Failure: Must provide number as first argumentdouble(b, successCallback, failureCallback); 3.åµŒå¥—å¼‚æ­¥å›è°ƒ åœ¨å¼‚æ­¥è¿”å›å€¼éœ€è¦ä¾èµ–å¦ä¸€ä¸ªå¼‚æ­¥è¿”å›å€¼æ—¶ï¼Œå›è°ƒæƒ…å†µè¿˜ä¼šè¿›ä¸€æ­¥å˜å¤æ‚ï¼š function double(value, success, failure) setTimeout(() = try if (typeof value !== number) throw Give me a number. success(value * 2); catch (e) failure(e); , 1000);const successCallback = (x) = double(x, (y) = console.log(`Success:$y`));const failureCallback = (e) = console.log(`Failure: $e`);double(3, successCallback, failureCallback); //Syccess:12 å›è°ƒç­–ç•¥ä¸å…·æœ‰æ‰©å±•æ€§ï¼Œâ€œå›è°ƒåœ°ç‹±â€å®è‡³åå½’ã€‚"},{"title":"11.2 æœŸçº¦","path":"/wiki/JavaScript/chapter_11_2.html","content":"æœŸçº¦æ˜¯å¯¹å°šä¸å­˜åœ¨çš„ç»“æœçš„ä¸€ä¸ªæ›¿èº«ã€‚ æœŸçº¦ï¼ˆPromiseï¼‰è¿˜æœ‰ä»¥ä¸‹åˆ«ç§° ç»ˆå±€ ï¼ˆeventualï¼‰æœŸè®¸ ï¼ˆfutureï¼‰å»¶è¿Ÿ ï¼ˆdelayï¼‰è¿Ÿä»˜ ï¼ˆdeferredï¼‰ 11.2.1 PromisesA+è§„èŒƒPromiseèµ·æº æ—©æœŸ æœŸçº¦æœºåˆ¶åœ¨jQueryå’ŒDojoä¸­ä»¥ Deferred API çš„å½¢å¼å‡ºç° 2010 CommonJSé¡¹ç›®å®ç°äº† PromisesA2012 PromieseA+ ç»„ç»‡forkäº†CommonJSçš„ PromisesA å»ºè®®æœ€ç»ˆ ECMAScript6å¢åŠ äº† Promise ç±»å‹ 11.2.2 æœŸçº¦åŸºç¡€new Promise() Promiseä½œä¸ºå¼•ç”¨ç±»å‹æ—¶å¯ä»¥é€šè¿‡newæ“ä½œç¬¦å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–æ—¶éœ€è¦ä¼ å…¥ æ‰§è¡Œå™¨ï¼ˆexecutorï¼‰ å‡½æ•°ä½œä¸ºå‚æ•°ã€‚ å¦‚æœä¸æä¾›executorå‚æ•°ä¼šæŠ¥é”™ã€‚let p = new Promise(() = );setTimeout(console.log, 0, p); //Promisepending 1.æœŸçº¦çŠ¶æ€æœº æœŸçº¦å¯èƒ½å¤„åœ¨ä¸‹é¢3ç§çŠ¶æ€ä¹‹ä¸€ï¼šå¾…å®š ï¼ˆpendingï¼‰ è¡¨ç¤ºå°šæœªå¼€å§‹æˆ–æ­£åœ¨æ‰§è¡Œå…‘ç°è§£å†³ ï¼ˆfulfilledresolvedï¼‰ è¡¨ç¤ºå·²ç»æˆåŠŸå®Œæˆæ‹’ç» ï¼ˆrejectedï¼‰ è¡¨ç¤ºæ²¡æœ‰æˆåŠŸå®Œæˆåˆå§‹çŠ¶æ€æœŸçº¦å¤„äº å¾…å®šï¼ˆpendingï¼‰ çŠ¶æ€ä¸­ã€‚å¾…å®šçŠ¶æ€æœŸçº¦å¯ä»¥ è½å®šï¼ˆsettledï¼‰ ä¸º2ç§çŠ¶æ€ï¼š å…‘ç°ï¼ˆfulfilledï¼‰ çŠ¶æ€ä»£è¡¨æˆåŠŸæ‹’ç»ï¼ˆrejectedï¼‰ çŠ¶æ€ä»£è¡¨å¤±è´¥æœŸçº¦çŠ¶æ€æ˜¯ç§æœ‰çš„è¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ ¹æ®è¯»å–åˆ°çš„æœŸçº¦çŠ¶æ€ï¼Œä»¥åŒæ­¥æ–¹å¼å¤„ç†æœŸçº¦å¯¹è±¡ã€‚æœŸçº¦æ•…æ„å°†å¼‚æ­¥è¡Œä¸ºå°è£…èµ·æ¥ï¼Œä»è€Œéš”ç¦»å¤–éƒ¨çš„åŒæ­¥ä»£ç ã€‚2.è§£å†³å€¼ã€æ‹’ç»ç†ç”±åŠæœŸçº¦ç”¨ä¾‹ æœŸçº¦çš„ä¸¤ä¸ªä¸»è¦ç”¨é€”æŠ½è±¡è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œæ˜¯å¦å®ŒæˆæœŸçº¦å°è£…å¼‚æ­¥æ“ä½œä¼šå®é™…ç”ŸæˆæŸä¸ªçŠ¶æ€æ”¹å˜åéœ€è¦è®¿é—®çš„å€¼ä¸ºäº†æ”¯æŒè¿™ä¸¤ä¸ªç”¨é€”ï¼ŒæœŸçº¦æä¾›äº†ä¸¤ä¸ªç§æœ‰çš„å†…éƒ¨å±æ€§ï¼ˆå¯é€‰ï¼Œé»˜è®¤å€¼ä¸ºundefinedï¼‰ï¼švalueï¼ˆå€¼ï¼‰ï¼š æœŸçº¦çŠ¶æ€åˆ‡æ¢ä¸ºå…‘ç°æ—¶æä¾›reasonï¼ˆç†ç”±ï¼‰ï¼š æœŸçº¦çŠ¶æ€åˆ‡æ¢ä¸ºæ‹’ç»æ—¶æä¾›3.é€šè¿‡æ‰§è¡Œå‡½æ•°æ§åˆ¶æœŸçº¦çŠ¶æ€ executorçš„ä¸¤é¡¹èŒè´£åˆå§‹åŒ–æœŸçº¦çš„å¼‚æ­¥è¡Œä¸ºæ§åˆ¶çŠ¶æ€çš„æœ€ç»ˆè½¬æ¢æ§åˆ¶æœŸçº¦è½¬æ¢çš„2ä¸ªå‡½æ•°å‚æ•°é€šå¸¸è¿™æ ·å‘½åï¼šresolve() å°†çŠ¶æ€åˆ‡æ¢ä¸ºfulfilledreject() å°†çŠ¶æ€åˆ‡æ¢ä¸ºrejectedexecutorå‡½æ•°æ˜¯Promiseçš„åˆå§‹åŒ–ç¨‹åºã€‚ä¸‹é¢è¿™æ®µç¨‹åºå¹¶éå¼‚æ­¥æ“ä½œï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–Promiseæ—¶ï¼Œexecutorå·²ç»æ”¹å˜äº†Promiseçš„çŠ¶æ€ã€‚let p1 = new Promise((resolve, reject) = resolve());// Promisefulfilled: undefinedsetTimeout(console.log, 0, p1);let p2 = new Promise((resolve, reject) = reject());// Promiserejected: undefinedsetTimeout(console.log, 0, p2); // Uncaught (in promise)ä½¿ç”¨setTimeoutæ¨è¿Ÿåˆ‡æ¢çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°Promiseä»å¤„åœ¨pendingçŠ¶æ€ä¸­ï¼šlet p = new Promise((resolve, reject) = setTimeout(resolve, 1000));setTimeout(console.log, 0, p); //PromisependingPromiseçŠ¶æ€çš„è½¬æ¢ä¸å¯æ’¤é”€ï¼Œä¿®æ”¹çŠ¶æ€æ“ä½œé™é»˜å¤±è´¥ï¼šlet p = new Promise((resolve, reject) = resolve(); reject(););// Promise fulfilled: undefinedsetTimeout(console.log, 0, p); ä¸ºäº†é˜²æ­¢é•¿æ—¶é—´å¡åœ¨pendingçŠ¶æ€ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå®šæ—¶é€€å‡ºçš„åŠŸèƒ½ï¼šlet p = new Promise((resolve, reject) = setTimeout(reject, 5000);)// Promise pendingsetTimeout(console.log, 0, p); //Uncaught: (in promise)// Promise rejectedsetTimeout(console.log, 6000, p);4.Promise.resolve() åŠŸèƒ½è°ƒç”¨ Promise.resolve() é™æ€æ–¹æ³•å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ª resolved Promise ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥ æŠŠä»»ä½•å€¼éƒ½è½¬æ¢ä¸ºä¸€ä¸ªPromiseå¯¹è±¡ ã€‚å‚æ•°Promise.resolve() çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè§£å†³çš„æœŸçº¦çš„è¿”å›å€¼ value ã€‚å¤šä½™çš„å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚// Promiseresolved: undefinedsetTimeout(console.log, 0, Promise.resolve());// Promiseresolved: 3setTimeout(console.log, 0, Promise.resolve(3));// Promiseresolved: 4setTimeout(console.log, 0, Promise.resolve(4, 5, 6));å¹‚ç­‰æ€§ä¼ å…¥å‚æ•°å¦‚æœæœ¬èº«å°±æ˜¯Promiseå¯¹è±¡ï¼Œå°±ç›¸å½“äºç©ºåŒ…è£…ã€‚let p = Promise.resolve(7);setTimeout(console.log, 0, p === Promise.resolve(p)); //truesetTimeout(console.log, 0, p === Promise.resolve(Promise.resolve(p))); //trueè¿™ç§å¹‚ç­‰æ€§è¿˜ä¼šä¿ç•™ä¼ å…¥æœŸçº¦çš„çŠ¶æ€ã€‚ let p = new Promise(() = );// Promise pendingsetTimeout(console.log, 0, p);// Promise pendingsetTimeout(console.log, 0, Promise.resolve(p));// truesetTimeout(console.log, 0, p === Promise.resolve(p));5.Promise.reject() åŠŸèƒ½å®ä¾‹åŒ–ä¸€ä¸ª rejective Promise å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚æ­¥é”™è¯¯ï¼Œå¼‚æ­¥é”™è¯¯ ä¸èƒ½é€šè¿‡trycatchæ•æ‰ï¼Œåªèƒ½é€šè¿‡ æ‹’ç»ç¨‹åº æ•è·ã€‚ å‚æ•°Promise.reject() çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸º æ‹’ç»æœŸçº¦çš„ç†ç”±ï¼Œè¯¥ç†ç”±ä¼šé¡ºæ¬¡ä¼ ç»™åç»­çš„æ‹’ç»ç¨‹åºã€‚ let p = Promise.reject(3);// Promise rejected: 3setTimeout(console.log, 0, p);p.then(null, (e) = setTimeout(console.log, 0, e)); //3éå¹‚ç­‰æ€§ä¼ ç»™ Promise.reject ä¸€ä¸ªPromiseå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¯¥å¯¹è±¡ä¼šä½œä¸ºæ‹’ç»æœŸçº¦çš„ç†ç”±ã€‚//Promise rejected: PromisesetTimeout(console.log, 0, Promise.reject(Promise.resolve(3)));6.åŒæ­¥å¼‚æ­¥æ‰§è¡Œçš„äºŒå…ƒæ€§ å¯¹æ¯”åŒæ­¥å¼‚æ­¥æ¨¡å¼ä¸‹æ•æ‰é”™è¯¯çš„åŒºåˆ« try throw new Error(foo); catch (e) console.log(e); //Error: foo try Promise.reject(new Error(bar)); catch (e) console.log(e);//Uncaught (in promise) Error: bar PromiseçœŸæ­£çš„å¼‚æ­¥æ€§åœ¨äºï¼šPromiseæ˜¯ åŒæ­¥å¯¹è±¡ ï¼Œä¹Ÿæ˜¯ å¼‚æ­¥æ‰§è¡Œæ¨¡å¼ çš„åª’ä»‹ã€‚åŒæ­¥æ¨¡å¼ï¼š é”™è¯¯ç›´æ¥æŠ›åˆ°æ‰§è¡ŒåŒæ­¥ä»£ç çš„çº¿ç¨‹ä¸­å¼‚æ­¥æ¨¡å¼ï¼š é”™è¯¯é€šè¿‡æµè§ˆå™¨å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç† 11.2.3 æœŸçº¦çš„å®ä¾‹æ–¹æ³•1.å®ç°Thenableæ¥å£ å¦‚ä½•å®ç°ï¼Ÿç­”ï¼šåœ¨å¯¹è±¡ä¸Šå®ç° then æ–¹æ³•ã€‚ class MyThenable then()ECMAScriptæš´éœ²çš„ å¼‚æ­¥ç»“æ„ä¸­çš„ä»»ä½•å¯¹è±¡ éƒ½æœ‰ä¸€ä¸ªthenæ–¹æ³•ã€‚ 2.Promise.prototype.then() thenæ–¹æ³•çš„å‚æ•°ä¸è¿”å›å€¼thenæ–¹æ³•æ¥æ”¶2ä¸ªå¯é€‰çš„å‚æ•°ï¼šparam1 onResolvedå¤„ç†ç¨‹åºï¼ˆå¦‚æœé€‰æ‹©ä¸ä¼ ï¼Œéœ€è¦ä½¿ç”¨nullundefinedå ä½ï¼‰param2 onRejectedå¤„ç†ç¨‹åºfunction onResolved(id) setTimeout(console.log, 0, id, resolved);;function onRejected(id) setTimeout(console.log, 0, id, rejected);let p1 = new Promise((resolve, reject) = setTimeout(resolve, 1000));let p2 = new Promise((resolve, reject) = setTimeout(reject, 1000));// p1 resolvedp1.then(()=onResolved(p1), ()=onRejected(p1)); // p2 rejectedp2.then(()=onResolved(p2), ()=onRejected(p2)); å¦‚æœå‚æ•°éå‡½æ•°ç±»å‹ï¼Œä¼šè¢« é™é»˜å¿½ç•¥ã€‚å¦‚æœåªæƒ³æä¾›onRejectedå‚æ•°ï¼Œéœ€è¦å¯¹onResolvedå‚æ•°è¿›è¡Œ å ä½ã€‚function onResolved(id) setTimeout(console.log, 0, id, resolved);function onRejected(id) setTimeout(console.log, 0, id, rejected);let p1 = new Promise((resolve, reject) = setTimeout(resolve, 1000));let p2 = new Promise((resolve, reject) = setTimeout(reject, 1000));// éå‡½æ•°å¤„ç†ç¨‹åºï¼šé™é»˜p1.then(notFunction);// onResolvedå ä½p2.then(undefined, () = onResolved(p2)); //p2 rejectedPromise.prototype.thenè¿”å›å€¼ï¼šä¸€ä¸ªæ–°çš„æœŸçº¦å®ä¾‹ã€‚let p1 = new Promise(() = );let p2 = p1.then();setTimeout(console.log, 0, p1); //Promise pendingsetTimeout(console.log, 0, p2); //Promise pendingsetTimeout(console.log, 0, p1 === p2); false;å¯¹äºä¸åŒè¿”å›å€¼çš„å‡ ç§æƒ…å†µï¼šonResolvedå‡½æ•°æä¾›äº†è¿”å›å€¼ä¼šå°†è¿”å›å€¼é€šè¿‡Promise.resolve()åŒ…è£…æˆæ–°çš„æœŸçº¦ã€‚ let p6 = p1.then(() = bar);let p7 = p1.then(() = Promise.resolve(bar));setTimeout(console.log, 0, p6); // Promisefulfilled: barsetTimeout(console.log, 0, p7); // Promisefulfilled: barlet p8 = p1.then(() = new Promise(() = ));let p9 = p1.then(() = Promise.reject());//Uncaught (in promise) undefinedsetTimeout(console.log, 0, p8); //Promise pendingsetTimeout(console.log, 0, p9); //Promise rejected: undefinedæ²¡æœ‰æä¾›onResolvedå‡½æ•°ä¼šåŒ…è£…ä¸Šä¸€ä¸ªæœŸçº¦è§£å†³ä¹‹åçš„å€¼ã€‚ let p1 = Promise.resolve(foo);let p2 = p1.then();setTimeout(console.log, 0, p2); //Promisefulfilled: foolet p8 = p1.then(() = new Promise(() = ));let p9 = p1.then(() = Promise.reject());//Uncaught (in promise) undefinedsetTimeout(console.log, 0, p8); //Promise pendingsetTimeout(console.log, 0, p9); //Promise rejected: undefinedonResolvedå‡½æ•°æ²¡æœ‰æ˜¾å¼è¿”å›è¯­å¥ä¼šåŒ…è£…é»˜è®¤è¿”å›å€¼ undefinedã€‚ let p3 = p1.then(() = undefined); let p4 = p1.then(() = );let p5 = p1.then(() = Promise.resolve());setTimeout(console.log, 0, p3); // Promisefulfiled: undefinedsetTimeout(console.log, 0, p4); // Promisefulfiled: undefinedsetTimeout(console.log, 0, p5); // Promisefulfiled: undefinedæŠ›å‡ºå¼‚å¸¸ä¼šè¿”å› rejective Promiseã€‚ // Uncaught (in promise) bazlet p10 = p1.then(() = throw baz; );setTimeout(console.log, 0, p10); //Promise rejected bazè¿”å›é”™è¯¯å€¼ä¸ä¼šè§¦å‘rejectï¼Œä¼šå°†é”™è¯¯å¯¹è±¡åŒ…è£…åœ¨ä¸€ä¸ª resolved Promise ä¸­ã€‚ let p11 = p1.then(() = Error(qux));setTimeout(console.log, 0, p11); //Promise fulfilled: Error:quxonRejectedå¤„ç†ç¨‹åºè¿”å›å€¼ä¹Ÿä¼šè¢« Promise.resolve() åŒ…è£…ï¼Œè™½ç„¶æœ‰ç‚¹è¯¡å¼‚ï¼Œä½†æ˜¯ onRejected æœ¬èº«çš„ä»»åŠ¡å°±æ˜¯ æ•è·å¼‚æ­¥é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯ æ•è·é”™è¯¯åä¸æŠ›å‡ºå¼‚å¸¸ ã€‚ onRejectedè¿”å›å€¼æ¡ˆä¾‹let p1 = Promise.reject(foo);let p2 = p1.then();// Promise rejected: foo// Uncaught (in promise) foosetTimeout(console.log, 0, p2);let p3 = p1.then(null, () = undefined);let p4 = p1.then(null, () = );let p5 = p1.then(null, () = Promise.resolve());setTimeout(console.log, 0, p3); // Promise rejected: undefinedsetTimeout(console.log, 0, p4); // Promise rejected: undefinedsetTimeout(console.log, 0, p5); // Promise rejected: undefinedlet p6 = p1.then(null, () = bar);let p7 = p1.then(null, () = Promise.resolve(bar));setTimeout(console.log, 0, p6); // Promise rejected: barsetTimeout(console.log, 0, p7); // Promise rejected: barlet p8 = p1.then(null, () = new Promise(() = ));let p9 = p1.then(null, () = Promise.reject());setTimeout(console.log, 0, p8); // Promise pending// Promise rejected: undefined// Uncaught (in promise) undefinedsetTimeout(console.log, 0, p9); let p10 = p1.then(null, () = throw baz );// Promise rejected:baz// Uncaught (in promise) bazsetTimeout(console.log, 0, p10); let p11 = p1.then(null, () = Error(qux));// Promise rejected:Error:quxsetTimeout(console.log, 0, p11);3.Promise.prototype.catch() catchçš„åŠŸèƒ½ä¸å‚æ•°catchç”¨äº ç»™æœŸçº¦æ·»åŠ æ‹’ç»å¤„ç†ç¨‹åºã€‚å”¯ä¸€å‚æ•°æ˜¯ onRejectedå¤„ç†ç¨‹åºã€‚ç›¸å½“äº Promise.prototype.then(null, onRejected) çš„è¯­æ³•ç³–ã€‚let p1 = new Promise(() = );let p2 = p1.catch();setTimeout(console.log, 0, p1); // Promise pendingsetTimeout(console.log, 0, p2); // Promise pendingsetTimeout(console.log, 0, p1 === p2); //false4.Promise.prototype.finally() finallyçš„åŠŸèƒ½ä¸å‚æ•°finally()æ–¹æ³•ç”¨äº ç»™æœŸçº¦æ·»åŠ onFinallyå¤„ç†ç¨‹åºã€‚onFinallyæ— è®ºPromiseè½¬åŒ–ä¸º fulfilled è¿˜æ˜¯ rejected ï¼ŒonFinallyéƒ½ä¼šæ‰§è¡Œï¼Œç”¨è¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿé¿å… onResolved å’Œ onRejected ç¨‹åºä¸­å‡ºç°å†—ä½™ä»£ç ã€‚onFinallyæ— æ³•è·çŸ¥Promiseçš„çŠ¶æ€ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºæ·»åŠ æ¸…ç†ä»£ç ã€‚let p1 = Promise.resolve();let p2 = Promise.reject();let onFinally = function () setTimeout(console.log, 0, Finally!);p1.finally(onFinally); // Finally!p2.finally(onFinally); // Finally!finally()ä¸catch()ã€then()çš„åŒºåˆ«ä¸»è¦å°±æ˜¯onFinallyè¢«è®¾è®¡ä¸ºä¸€ä¸ª çŠ¶æ€æ— å…³çš„æ–¹æ³•ï¼Œé‡ç‚¹åœ¨äº çˆ¶æœŸçº¦çš„ä¼ é€’ ä¸Šã€‚ let p1 = Promise.resolve(foo);let p2 = p1.finally();let p3 = p1.finally(() = undefined);let p4 = p1.finally(() = );let p5 = p1.finally(() = Promise.resolve());let p6 = p1.finally(() = bar);let p7 = p1.finally(() = Promise.resolve(bar));let p8 = p1.finally(() = Error(qux));setTimeout(console.log, 0, p2); //Promise fulfilled:foosetTimeout(console.log, 0, p3); //Promise fulfilled:foosetTimeout(console.log, 0, p4); //Promise fulfilled:foosetTimeout(console.log, 0, p5); //Promise fulfilled:foosetTimeout(console.log, 0, p6); //Promise fulfilled:foosetTimeout(console.log, 0, p7); //Promise fulfilled:foosetTimeout(console.log, 0, p8); //Promise fulfilled:fooç‰¹æ®Šæƒ…å†µä¸‹çš„finallyè¿”å›å€¼å½“å‡ºç°ä¸‹åˆ—æƒ…å†µæ—¶ï¼Œä¼šè¿”å›ç›¸åº”çš„æœŸçº¦ï¼š æœŸçº¦å¾…å®šï¼šPromise {pending} onFinallyç¨‹åºæŠ›å‡ºäº†é”™è¯¯ onFinallyç¨‹åºæ˜¾å¼æŠ›å‡ºæˆ–è¿”å›äº†ä¸€ä¸ª rejective Promise let p1 = Promise.resolve(foo);// è¿”å›å¾…å®šæœŸçº¦let p2 = p1.finally( () = new Promise( (resolve, reject) = setTimeout(() = resolve(bar), 100) ));setTimeout(console.log, 0, p2); // Promise pendingsetTimeout(() = setTimeout(console.log, 0, p2), 200); //Promise fulfilled: foolet p9 = p1.finally(() = new Promise(() = ));let p10 = p1.finally(() = Promise.reject());// Uncaught (in promise) undefinedsetTimeout(console.log, 0, p9); // Promise pendingsetTimeout(console.log, 0, p10); // Promise rejected: undefined5.éé‡å…¥æœŸçº¦çš„æ–¹æ³• éé‡å…¥ï¼ˆnon-reentrancyï¼‰ç‰¹æ€§å½“æœŸçº¦è¿›å…¥ fulfilled çŠ¶æ€æ—¶ï¼Œç›¸å…³å¼‚æ­¥å¤„ç†ç¨‹åºä¸ä¼šç«‹å³æ‰§è¡Œï¼Œä»…ä»…ä¼šè¢« æ’æœŸ ï¼Œå…¶åçš„åŒæ­¥ä»£ç ä¸€å®šä¼šåœ¨å®ƒä¹‹å‰æ‰§è¡Œã€‚ // åˆ›å»ºè§£å†³çš„æœŸçº¦let p = Promise.resolve();// æ·»åŠ è§£å†³å¤„ç†ç¨‹åºp.then(() = console.log(`onResolved handler`));// åŒæ­¥æ“ä½œconsole.log(then() returns);// then() returns// onResolved handlerå…ˆæ·»åŠ å¤„ç†ç¨‹åºåè§£å†³æœŸçº¦ã€‚let synchronousResolve;// åˆ›å»ºä¸€ä¸ªæœŸçº¦å¹¶å°†è§£å†³å‡½æ•°ä¿å­˜åœ¨ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸­let p = new Promise((resolve) = synchronousResolve = function () console.log(1); resolve(); console.log(2); ;);p.then(() = console.log(4));synchronousResolve();console.log(3); //1 2 3 4éé‡å…¥é€‚ç”¨èŒƒå›´ã€‚ onResolvedonRejected catch finally let p1 = Promise.resolve();p1.then(() = console.log(p1.then() onResolved));console.log(p1.then() returns);let p2 = Promise.reject();p2.then(null, () = console.log(p2.then() onRejected));console.log(p2.then() returns)let p3 = Promise.reject();p3.catch(() = console.log(p3.catch() onRejected));console.log(p3.catch() returns)let p4 = Promise.resolve();p4.finally(() = console.log(p4.finally() onFinally));console.log(p4.finally() returns)// p1.then() returns// p2.then() returns// p3.catch() returns// p4.finally() returns// p1.then() onResolved// p2.then() onRejected// p3.catch() onRejected// p4.finally() onFinally6.é‚»è¿‘å¤„ç†ç¨‹åºçš„æ‰§è¡Œé¡ºåº åŒä¸€æœŸçº¦å¤šä¸ªå¤„ç†ç¨‹åºæŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œlet p1 = Promise.resolve();let p2 = Promise.reject();p1.then(() = setTimeout(console.log, 0, 1));p1.then(() = setTimeout(console.log, 0, 2));//1 2p2.then(null,() = setTimeout(console.log, 0, 3));p2.then(null, () = setTimeout(console.log, 0, 4));// 3 4p2.catch(() = setTimeout(console.log, 0, 5));p2.catch(() = setTimeout(console.log, 0, 6));// 5 6p1.finally(() = setTimeout(console.log, 0, 7));p1.finally(() = setTimeout(console.log, 0, 8));// 7 87.ä¼ é€’è§£å†³å€¼å’Œæ‹’ç»ç†ç”± åœ¨è¿›å…¥fulfilledçŠ¶æ€åï¼ŒæœŸçº¦ä¼šæä¾›valuereasonç»™ç›¸å…³çŠ¶æ€çš„å¤„ç†ç¨‹åºã€‚ let p1 = new Promise((resolve, reject) = resolve(foo));p1.then((value) = console.log(value)); //foolet p2 = new Promise((resolve, reject) = reject(bar));p2.catch((reason) = console.log(reason)); //barlet p3 = Promise.resolve(foo);p3.then((value) = console.log(value)); //foolet p4 = Promise.reject(bar);p4.catch((reason) = console.log(reason)); //bar8.æ‹’ç»æœŸçº¦ä¸æ‹’ç»é”™è¯¯å¤„ç† åœ¨æœŸçº¦æ‰§è¡Œå¤„ç†æ—¶æŠ›å‡ºé”™è¯¯ä¼šå¯¼è‡´æ‹’ç»let p1 = new Promise((resolve, reject) = reject(Error(foo)));let p2 = new Promise((resolve, reject) = throw Error(foo) );let p3 = Promise.resolve().then(() = throw Error(foo) );let p4 = Promise.reject(Error(foo));setTimeout(console.log, 0, p1); //Promise rejected: Error:foosetTimeout(console.log, 0, p2); //Promise rejected: Error:foosetTimeout(console.log, 0, p3); //Promise rejected: Error:foosetTimeout(console.log, 0, p4); //Promise rejected: Error:fooå¼‚æ­¥é”™è¯¯çš„å‰¯ä½œç”¨æ­£å¸¸æƒ…å†µä¸‹æŠ›å‡ºçš„é”™è¯¯ä¼šé˜»å¡åç»­æŒ‡ä»¤çš„æ‰§è¡Œï¼š // Uncaught Error: foothrow Error(foo);console.log(bar); // æ— æ•ˆä»£ç  æœŸçº¦ä¸­æŠ›å‡ºçš„é”™è¯¯ä¸ä¼šé˜»å¡åç»­åŒæ­¥æŒ‡ä»¤çš„æ‰§è¡Œï¼š // Error: foo// barPromise.reject(Error(foo));console.log(bar); å¯¹æ¯”åŒæ­¥é”™è¯¯ä¸å¼‚æ­¥é”™è¯¯å¤„ç† åŒæ­¥é”™è¯¯å¤„ç†// 1// 3 Error:2// 4console.log(1);try throw Error(2); catch (e) console.log(3,e);console.log(4); å¼‚æ­¥é”™è¯¯å¤„ç†// 1// 3 Error:2// 4new Promise((resolve, reject) = console.log(1); reject(Error(2));).catch((e) = console.log(3, e);).then(() = console.log(4);) 11.2.4 æœŸçº¦è¿é”ä¸æœŸçº¦åˆæˆ æœŸçº¦è¿é”ä¸€ä¸ªæœŸçº¦æ¥ä¸€ä¸ªæœŸçº¦çš„æ‹¼æ¥ã€‚ æœŸçº¦åˆæˆå°†å¤šä¸ªæœŸçº¦ç»„åˆä¸ºä¸€ä¸ªæœŸçº¦ã€‚ 1.æœŸçº¦è¿é” é€šè¿‡è¿ç¼€æ–¹æ³•è°ƒç”¨å°±å¯ä»¥æ„æˆæ‰€è°“çš„ æœŸçº¦è¿é”ï¼šlet p = new Promise((resolve, reject) = console.log(first); resolve(););// first second third fourthp.then(() = console.log(second)) .then(() = console.log(third)) .then(() = console.log(fourth));ä¸²è¡ŒåŒ–å¼‚æ­¥ä»»åŠ¡æ¯ä¸ªæ‰§è¡Œå™¨éƒ½è¿”å›ä¸€ä¸ªæœŸçº¦å®ä¾‹ï¼Œæ¯ä¸ªåç»­æœŸçº¦éƒ½ç­‰å¾…ä¹‹å‰çš„æœŸçº¦ã€‚ let p1 = new Promise((resolve, reject) = console.log(p1 executor); setTimeout(resolve, 1000);)p1.then(() = new Promise((resolve, reject) = console.log(p2 executor); setTimeout(resolve, 1000);)).then(() = new Promise((resolve, reject) = console.log(p3 executor); setTimeout(resolve, 1000);)).then(() = new Promise((resolve, reject) = console.log(p4 executor); setTimeout(resolve, 1000);));// p1 executor// p2 executor// p3 executor// p4 executorå°†ç”ŸæˆæœŸçº¦ä»£ç æå–æˆå·¥å‚å‡½æ•°function delayedResolve(str) return new Promise((resolve, reject) = console.log(str); setTimeout(resolve, 1000); )delayedResolve(p1 executor) .then(() = delayedResolve(p2 executor)) .then(() = delayedResolve(p3 executor)) .then(() = delayedResolve(p4 executor));// p1 executor// p2 executor// p3 executor// p4 executorä½¿ç”¨å›è°ƒå‡½æ•°é‡å†™è¿é”æœŸçº¦ï¼ˆå›è°ƒåœ°ç‹±ï¼‰function delayedExecute(str, callback = null) setTimeout(() = console.log(str); callback callback(); , 1000);delayedExecute(p1 callback, () = delayedExecute(p2 callback, () = delayedExecute(p3 callback, () = delayedExecute(p4 callback); ) ));// p1 callback// p2 callback// p3 callback// p4 callbackä¸²è”æœŸçº¦çš„ç›¸å…³æ–¹æ³•let p = new Promise((resolve, reject) = console.log(initial promise rejects); reject(););p.catch(() = console.log(reject handler)) .then(() = console.log(resolve handler)) .finally(() = console.log(finally handler));// initial promise rejects// reject handler// resolve handler// finally handler2.æœŸçº¦å›¾ æœŸçº¦è¿é”çš„ç»“æ„ç±»ä¼¼äº æœ‰å‘éå¾ªç¯å›¾ï¼šä¸€å¯¹å¤šå…³ç³»ï¼š ä¸€ä¸ªæœŸçº¦å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå¤„ç†ç¨‹åºèŠ‚ç‚¹ï¼š ç»„æˆè¿é”æœŸçº¦çš„æ¯ä¸€ä¸ªæœŸçº¦æœ‰å‘é¡¶ç‚¹ï¼š ä½¿ç”¨å®ä¾‹æ·»åŠ çš„å¤„ç†ç¨‹åºå±‚åºéå†ï¼š æœŸçº¦å¤„ç†ç¨‹åºæ˜¯æŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œçš„// A// / \\// B C// / \\ / \\// D E F Glet A = new Promise((resolve, reject) = console.log(A); resolve(););let B = A.then(() = console.log(B));let C = A.then(() = console.log(C));B.then(() = console.log(D));B.then(() = console.log(E));C.then(() = console.log(F));C.then(() = console.log(G));// A B C D E F G3.Promise.all()å’ŒPromise.race() åˆæˆæœŸçº¦æ–¹æ³•Promise.all()Promise.race()åŠŸèƒ½ï¼š åˆ›å»ºä¸€ä¸ªæœŸçº¦ï¼Œè¯¥æœŸçº¦ä¼šåœ¨ä¸€ç»„æœŸçº¦å…¨éƒ¨è§£å†³åå†è§£å†³å­˜åœ¨ä¸€ä¸ªå¾…å®šæœŸçº¦ï¼ŒåˆæˆæœŸçº¦ä¹Ÿå¾…å®šå­˜åœ¨ä¸€ä¸ªæ‹’ç»æœŸçº¦ï¼ŒåˆæˆæœŸçº¦ä¹Ÿæ‹’ç»å‚æ•°ï¼š å¯è¿­ä»£å¯¹è±¡è¿”å›å€¼ï¼š ä¸€ä¸ªæ–°æœŸçº¦åˆæˆæœŸçº¦è§£å†³å€¼ï¼š æ‰€æœ‰åŒ…å«æœŸçº¦è§£å†³å€¼çš„æ•°ç»„ï¼ŒæŒ‰ç…§è¿­ä»£å™¨é¡ºåºåˆæˆæœŸçº¦æ‹’ç»ç†ç”±ï¼š å³ç¬¬ä¸€ä¸ªæ‹’ç»çš„æœŸçº¦çš„ç†ç”±Promise.all()å‚æ•°let p1 = Promise.all([ Promise.resolve(), Promise.resolve()]);// å¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ ä¼šé€šè¿‡Promise.resolve()è½¬æ¢ä¸ºæœŸçº¦let p2 = Promise.all([3, 4]);// ç©ºçš„å¯è¿­ä»£å¯¹è±¡ç­‰ä»·äºPromise.resolve()let p3 = Promise.all([]);// æ— æ•ˆè¯­æ³•// TypeError: undefined is not iterable let p4 = Promise.all();åˆæˆæœŸçº¦åœ¨æ¯ä¸ªæœŸçº¦éƒ½è§£å†³åæ‰è§£å†³let p = Promise.all([ Promise.resolve(), new Promise((resolve, reject) = setTimeout(resolve, 1000))]);setTimeout(console.log, 0, p); //Promise pending// after 1s: all() resolved! p.then(() = setTimeout(console.log, 0, all() resolved!));åˆæˆæœŸçº¦çš„pendinngå’Œrejectedæ¡ä»¶let p1 = Promise.all([new Promise(() = )]);setTimeout(console.log, 0, p1); // Promise pendinglet p2 = Promise.all([ Promise.resolve(), Promise.reject(), Promise.resolve()]);setTimeout(console.log, 0, p2); // Promise rejectedåˆæˆæœŸçº¦çš„è§£å†³å€¼let p = Promise.all([ Promise.resolve(3), Promise.resolve(), Promise.resolve(4)]);p.then((value) = setTimeout(console.log,0,value)); // [3,undefined,4]åˆæˆæœŸçº¦ä¼šé™é»˜å¤„ç†æ‰€æœ‰åŒ…å«æœŸçº¦çš„æ‹’ç»æ“ä½œlet p = Promise.all([ Promise.reject(3), new Promise((resolve, reject) = setTimeout(reject, 1000))])p.catch((reason) = setTimeout(console.log, 0, reason)); //3åŠŸèƒ½ï¼š è¿”å›ä¸€ä¸ªåŒ…è£…æœŸçº¦ï¼Œè¯¥æœŸçº¦æ˜¯ä¸€ç»„é›†åˆä¸­æœ€å…ˆè§£å†³æ‹’ç»çš„æœŸçº¦çš„é•œåƒä¸ä¼šå¯¹è§£å†³æˆ–æ‹’ç»çš„æœŸçº¦åŒºåˆ«å¯¹å¾…ä¼šé™é»˜å¤„ç†æ‰€æœ‰åŒ…å«æœŸçº¦çš„æ‹’ç»æ“ä½œå‚æ•°ï¼š å¯è¿­ä»£å¯¹è±¡è¿”å›å€¼ï¼š ä¸€ä¸ªæ–°æœŸçº¦Promise.race()å‚æ•°let p1 = Promise.race([ Promise.resolve(), Promise.resolve()]);// å¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ ä¼šé€šè¿‡Promise.resolveè½¬æ¢ä¸ºæœŸçº¦let p2 = Promise.race([3, 4]);// ç©ºçš„è¿­ä»£å¯¹è±¡ç­‰ä»·äºnew Promise(()=)let p3 = Promise.race([]);// æ— æ•ˆè¯­æ³•// TypeError: undefined is not iterablelet p4 = Promise.race();Promise.race()è¿”å›å€¼// å…ˆè§£å†³let p1 = Promise.race([ Promise.resolve(3), new Promise((resolve, reject) = setTimeout(reject, 1000))]);setTimeout(console.log, 0, p1); //Promise fulfilled:3// å…ˆæ‹’ç»let p2 = Promise.race([ Promise.reject(4), new Promise((resolve, reject) = setTimeout(resolve, 1000))]);setTimeout(console.log, 0, p2); //Promise rejected:4// è¿­ä»£é¡ºåºå†³å®šè½å®šé¡ºåºlet p3 = Promise.race([ Promise.resolve(5), Promise.resolve(6), Promise.reject(7),]);setTimeout(console.log, 0, p3); //Promise fulfilled:5Promise.race()å¯¹æ‹’ç»æ“ä½œçš„é™é»˜å¤„ç†let p = Promise.race([ Promise.reject(3), new Promise((resolve, reejct) = setTimeout(reject, 1000))]);p.catch((reason) = setTimeout(console.log, 0, reason)); //34.ä¸²è¡ŒæœŸçº¦åˆæˆ åŸºäºæœŸçº¦çš„ä¸€ä¸ªä¸»è¦ç‰¹æ€§ï¼šå¼‚æ­¥äº§ç”Ÿå€¼å¹¶å°†å…¶ä¼ ç»™å¤„ç†ç¨‹åºã€‚å‡½æ•°åˆæˆfunction addTwo(x) return x + 2; function addThree(x) return x + 3; function addFive(x) return x + 5; function addTen(x) return addFive(addThree(addTwo(x)));console.log(addTen(10)); //20ä½¿ç”¨æœŸçº¦é‡ç°å‡½æ•°åˆæˆfunction addTwo(x) return x + 2; function addThree(x) return x + 3; function addFive(x) return x + 5; function addTen(x) return Promise.resolve(x) .then(addTwo) .then(addThree) .then(addFive);addTen(8).then(console.log); //18ä½¿ç”¨Array.prototype.reduce()å†ç®€åŒ–function addTwo(x) return x + 2; function addThree(x) return x + 3; function addFive(x) return x + 5; function addTen(x) return [addTwo, addThree, addFive] .reduce( (promise, fn) = promise.then(fn), Promise.resolve(x) );addTen(5).then(console.log); //15æç‚¼é€šç”¨åˆæˆå‡½æ•°function addTwo(x) return x + 2; function addThree(x) return x + 3; function addFive(x) return x + 5; function compose(...fns) return (x) = fns.reduce( (promise, fn) = promise.then(fn), Promise.resolve(x) )compose( addTwo, addFive, addThree)(11).then(console.log); //21 11.2.5 æœŸçº¦æ‰©å±•ä¸ºä»€ä¹ˆES6ä¸æ”¯æŒå–æ¶ˆæœŸçº¦å’Œè¿›åº¦é€šçŸ¥ï¼Ÿ ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯è¿™æ ·ä¼šå¯¼è‡´ æœŸçº¦è¿é” å’Œ æœŸçº¦åˆæˆ è¿‡åº¦å¤æ‚åŒ–ã€‚ ä¸‹é¢æ¶‰åŠåˆ°ä¸¤ä¸ªç¬¬ä¸‰æ–¹æœŸçº¦åº“ä¸­å…·å¤‡ä½†æ˜¯ECMAScriptæœªæ¶‰åŠçš„ç‰¹æ€§ã€‚ æœŸçº¦å–æ¶ˆè¿›åº¦è¿½è¸ªä¸€èˆ¬é’ˆå¯¹äºæœŸçº¦æ­£åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¸å†éœ€è¦ç»“æœçš„æƒ…å½¢ã€‚ES6è¢«è®¤ä¸ºæ˜¯â€œæ¿€è¿›çš„â€å› ä¸ºæœŸçº¦çš„é€»è¾‘åªè¦å¼€å§‹æ‰§è¡Œï¼Œå°±æ— æ³•é˜»æ­¢å…¶æ‰§è¡Œåˆ°å®Œæˆã€‚å–æ¶ˆä»¤ç‰Œï¼ˆcancel tokenï¼‰æä¾›ä¸€ç§ä¸´æ—¶æ€§çš„å°è£…ã€‚ç”Ÿæˆçš„ä»¤ç‰Œå®ä¾‹æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥ç”¨äºå–æ¶ˆæœŸçº¦ã€‚åŒæ—¶ä¹Ÿæä¾›ä¸€ä¸ªæœŸçº¦å®ä¾‹ï¼Œç”¨æ¥è§¦å‘å–æ¶ˆåæ“ä½œå¹¶æ±‚å€¼å–æ¶ˆçŠ¶æ€ã€‚class CancelToken constructor(cancelFn) this.promise = new Promise((resolve, reject) = cancelFn(resolve); ) å–æ¶ˆä»¤ç‰Œæ¡ˆä¾‹å­˜åœ¨é—®é¢˜ï¼š å°½ç®¡æœ¬æ¡ˆä¾‹çš„æ€è·¯æ˜¯åœ¨è§¦å‘å¼€å§‹æŒ‰é’®çš„æ—¶å€™ï¼Œå¯¹å–æ¶ˆæŒ‰é’®è¿›è¡Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰æ‰‹åŠ¨è¿›è¡Œäº‹ä»¶è§£ç»‘ï¼Œå› æ­¤å¯¼è‡´å–æ¶ˆæŒ‰é’®äº‹ä»¶ä¼šä¸æ–­å †å ã€‚è§£å†³æ–¹æ³•ï¼šåœ¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ—¶å°†option.onceé…ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä»…è§¦å‘ä¸€æ¬¡äº‹ä»¶ã€‚ cancelButton.addEventListener(click,cancelCallback,once:true); button id=startStart/buttonbutton id=cancelCancel/button class CancelToken constructor(cancelFn) this.promise = new Promise((resolve, reject) = cancelFn(() = setTimeout(console.log, 0, delay cancelled); resolve(); ) ) const startButton = document.querySelector(#start);const cancelButton = document.querySelector(#cancel);function cancellableDelayedResolve(delay) setTimeout(console.log, 0, set delay); return new Promise((resolve, reject) = const id = setTimeout(() = setTimeout(console.log, 0, delayed resolve); resolve(); , delay); const cancelToken = new CancelToken( cancelCallback = cancelButton.addEventListener(click, cancelCallback) ); cancelToken.promise.then(() = clearTimeout(id)); )startButton.addEventListener(click, () = cancellableDelayedResolve(1000));ç®€åŒ–ç‰ˆå–æ¶ˆæœŸçº¦å®ç°æ€è·¯ ç›¸æ¯”å–æ¶ˆä»¤ç‰Œæ–¹æ³•æ›´åŠ ç®€å•ç²—æš´ï¼Œå³æ˜¯å°†å¼€å§‹æŒ‰é’®è§¦å‘äº‹ä»¶åŒ…è£…æˆå¼‚æ­¥æ“ä½œï¼Œç»™å–æ¶ˆæŒ‰é’®æ·»åŠ æå‰resolveäº‹ä»¶ï¼Œåœ¨æœŸçº¦è¿›å…¥resolveçŠ¶æ€æ—¶å¯¹å–æ¶ˆæŒ‰é’®è¿›è¡Œè§£ç»‘ã€‚ç›¸è¾ƒå®˜æ–¹æ¡ˆä¾‹æ‰©å±•åº¦æ›´ä½ï¼Œä½†ç®€å•ç²—æš´ã€‚ function cancellableDelayedResolve(delay) setTimeout(console.log, 0, start); let cancelCallback; new Promise((resolve, reject) = let id = setTimeout(() = console.log(finished); resolve(); , 1500); cancelCallback = () = console.log(cancel); clearTimeout(id); resolve(); cancelButton.addEventListener(click,cancelCallback); ).finally(() = cancelButton.removeEventListener(click, cancelCallback); )startButton.addEventListener(click, cancellableDelayedResolve); asyncawaitå®ç°å–æ¶ˆæœŸçº¦let startButton = document.querySelector(#start);let cancelButton = document.querySelector(#cancel);async function cancellableDelayedResolve(delay) setTimeout(console.log, 0, start); let id = setTimeout(console.log, delay, await finished); cancelButton.addEventListener(click, () = clearTimeout(id); console.log(cancel) , once: true );startButton.addEventListener(click, () = cancellableDelayedResolve(1000));æœ‰ç§å®ç°æœŸçº¦è¿›åº¦è¿½è¸ªçš„æ–¹æ³•ï¼šæ‰©å±•Promiseç±»ï¼Œæ·»åŠ  notify() æ–¹æ³•ï¼šclass TrackablePromise extends Promise constructor(executor) const notifyHandlers = []; super((resolve, reject) = return executor(resolve, reject, (status) = notifyHandlers.map((handler) = handler(status)); ); ); this.notifyHandlers = notifyHandlers; notify(notifyHandler) this.notifyHandlers.push(notifyHandler); return this; let p = new TrackablePromise((resolve, reject, notify) = function countdown(x) if (x 0) notify(`$20 * x% remaining`); setTimeout(() = countdown(x - 1), 1000); else resolve(); countdown(5););p.notify((x) = setTimeout(console.log, 0, a:, x)) .notify((x) = setTimeout(console.log, 0, b:, x));p.then(() = setTimeout(console.log, 0, completed));// a: 80% remaining// b: 80% remaining// a: 60% remaining// b: 60% remaining// a: 40% remaining// b: 40% remaining// a: 20% remaining// b: 20% remaining// completed"},{"title":"11.3 å¼‚æ­¥å‡½æ•°","path":"/wiki/JavaScript/chapter_11_3.html","content":"ES8ä¹‹å‰çš„å¼‚æ­¥è°ƒç”¨ ä»»ä½•è¦è®¿é—®æœŸçº¦äº§ç”Ÿå€¼çš„ä»£ç ï¼Œéƒ½éœ€è¦ä»¥å¤„ç†ç¨‹åºçš„å½¢å¼æ¥æ¥å—æ­¤å€¼ï¼šfunction handler(x) console.log(x); let p = new Promise((resolve, reject) = setTimeout(resolve, 1000, 3));p.then(handler); //3è¿™ç§ä¹¦å†™æ–¹å¼ç›¸å½“ç¬¨é‡ï¼ŒES8æ–°å¢äº† asyncawait å…³é”®å­—ï¼Œè®©ä»¥åŒæ­¥æ–¹å¼å†™çš„ä»£ç èƒ½å¤Ÿå¼‚æ­¥æ‰§è¡Œã€‚ 11.3.1 å¼‚æ­¥å‡½æ•°asyncawaitasyncç”¨äºå£°æ˜å¼‚æ­¥å‡½æ•°asyncè¯­æ³•é€‚ç”¨èŒƒå›´ï¼š å‡½æ•°å£°æ˜ å‡½æ•°è¡¨è¾¾å¼ ç®­å¤´å‡½æ•° æ–¹æ³• async function foo() //å‡½æ•°å£°æ˜let bar = async function () ; //å‡½æ•°è¡¨è¾¾å¼let baz = async () = ; //ç®­å¤´å‡½æ•°class Qux async qux() //æ–¹æ³• asyncåŠŸèƒ½è®©å‡½æ•°å…·æœ‰å¼‚æ­¥ç‰¹å¾ï¼Œä½†æ€»ä½“ä¸Šä»£ç ä»ç„¶æ˜¯åŒæ­¥æ±‚å€¼ã€‚ async function foo() console.log(1);foo();console.log(2); //1 2asyncè¿”å›å€¼å§‹ç»ˆè¿”å› æœŸçº¦å¯¹è±¡ã€‚è¿”å›å€¼ä¼šè¢« Promise.resolve() åŒ…è£…ä¸ºä¸€ä¸ªæœŸçº¦å¯¹è±¡ã€‚ async function foo() console.log(1); return 3; // ç›¸å½“äº return Promise.resolve(3)foo().then(console.log);console.log(2); // 1 2 3 asyncè¿”å›å€¼çš„é™é»˜å¤„ç†asyncå‡½æ•°çš„è¿”å›å€¼å®é™…æœŸå¾…çš„æ˜¯ï¼šä¸€ä¸ªå®ç°thenableæ¥å£çš„å¯¹è±¡å¯¹äºæ˜¯å¦å®ç°äº†è¿™ä¸€æ¡ä»¶ï¼Œasyncä¼šå¯¹è¿”å›å€¼é‡‡å–ä¸åŒçš„é™é»˜å¤„ç†æ–¹å¼ï¼š å®ç°thenableæ¥å£ åœ¨è°ƒç”¨è¿”å›å€¼çš„thenæ–¹æ³•æ—¶ï¼Œå¯ä»¥æä¾›onResolveonRejectedå¤„ç†ç¨‹åºä»¥ä¾›è§£åŒ… æœªå®ç°thenableæ¥å£ è¿”å›å€¼è¢«å½“åšå·²ç»å·²è§£å†³çš„æœŸçº¦ è¿”å›ä¸€ä¸ªåŸå§‹å€¼async function foo() return foo;foo().then(console.log); // foo è¿”å›ä¸€ä¸ªæ²¡æœ‰å®ç°thenableæ¥å£çš„å¯¹è±¡async function bar() return [bar];bar().then(console.log); //[bar] è¿”å›ä¸€ä¸ªå®ç°äº†thenableæ¥å£çš„å¯¹è±¡async function baz() const thenable = then(callback) callback(baz); ; return thenable;baz().then(console.log); //baz è¿”å›ä¸€ä¸ªæœŸçº¦async function qux() return Promise.resolve(qux);qux().then(console.log); //qux å¼‚æ­¥å‡½æ•°ä¸­æŠ›å‡ºé”™è¯¯ä¼šè¿”å›æ‹’ç»æœŸçº¦ async function foo() console.log(1); throw 3;foo().catch(console.log);console.log(2); //1 2 3æ‹’ç»æœŸçº¦çš„é”™è¯¯ä¸ä¼šè¢«å¼‚æ­¥å‡½æ•°æ•è· async function foo() console.log(1); Promise.reject(3);foo().catch(console.log);console.log(2);//1 2 //Uncaught (in promise) 3awaitå¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°ä»£ç çš„æ‰§è¡Œï¼Œç­‰å¾…æœŸçº¦è§£å†³awaitåŠŸèƒ½awaitå…³é”®å­—ä¼š æš‚åœæ‰§è¡Œå¼‚æ­¥å‡½æ•°åé¢çš„ä»£ç  ã€‚ ç¬¬ä¸€æ­¥å°è¯•è§£åŒ…å¯¹è±¡çš„å€¼ã€‚ç¬¬äºŒæ­¥å°†å€¼ä¼ ç»™è¡¨è¾¾å¼ã€‚ç¬¬ä¸‰æ­¥å¼‚æ­¥æ¢å¤å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œã€‚ async function foo() let p = new Promise((resolve, reject) = setTimeout(resolve, 1000, 3)); console.log(await p);foo(); //3 awaitç”¨æ³•ç”¨æ³•ç›¸å½“äº ä¸€å…ƒæ“ä½œç¬¦ï¼š å¼‚æ­¥æ‰“å°â€fooâ€œasync function foo() console.log(await Promise.resolve(foo));foo(); //foo å¼‚æ­¥æ‰“å°â€barâ€œasync function bar() return await Promise.resolve(bar);bar().then(console.log); //bar 1000msåå¼‚æ­¥æ‰“å°â€bazâ€œasync function baz() await new Promise((resolve, reject) = setTimeout(resolve, 1000)); console.log(baz);baz(); //bazawaitçš„é™é»˜å¤„ç†awaitå…³é”®å­—å®é™…æœŸå¾…çš„æ˜¯ï¼šä¸€ä¸ªå®ç°äº†thenableæ¥å£çš„å¯¹è±¡å¯¹äºæ˜¯å¦å®ç°thenableæ¥å£ï¼Œawaitå¯¹å…¶ä¹Ÿæœ‰ä¸åŒçš„é™é»˜å¤„ç†æ–¹å¼ï¼š å®ç°äº†thenableæ¥å£ï¼š awaitä¼šå¯¹å…¶è¿›è¡Œè§£åŒ… æœªå®ç°thenableæ¥å£ï¼š é»˜è®¤åŒ…è£…ä¸ºå·²è§£å†³çš„æœŸçº¦ awaitä¸€ä¸ªåŸå§‹å€¼async function foo() console.log(await foo);foo(); //foo awaitä¸€ä¸ªæ²¡æœ‰å®ç°thenableæ¥å£çš„å¯¹è±¡async function bar() console.log(await [bar]);bar(); //[bar] awaitä¸€ä¸ªå®ç°äº†thenableæ¥å£çš„å¯¹è±¡async function baz() const thenable = then(callback) callback(baz); ; console.log(await thenable);baz(); //baz awaitä¸€ä¸ªæœŸçº¦async function qux() console.log(await Promise.resolve(qux));qux(); //quxawaitæŠ›å‡ºé”™è¯¯çš„åŒæ­¥æ“ä½œä¼šè¿”å›æ‹’ç»çš„æœŸçº¦ã€‚ async function foo() console.log(1); await (() = throw 3; ) ();foo().catch(console.log);console.log(2); // 1 2 3awaitæ‹’ç»çš„æœŸçº¦ä¼š é‡Šæ”¾ï¼ˆunwrapï¼‰é”™è¯¯å€¼ã€‚å³ç›´æ¥å°†æ‹’ç»æœŸçº¦ä½œä¸ºè¿”å›å€¼returnã€‚ async function foo() console.log(1); await Promise.reject(3); console.log(4); // æœ¬è¡Œä¸ä¼šæ‰§è¡Œfoo().catch(console.log);console.log(2); //1 2 3awaitçš„é™åˆ¶awaitå…³é”®å­—åªèƒ½ ç›´æ¥å‡ºç°åœ¨å¼‚æ­¥å‡½æ•°çš„å®šä¹‰ä¸­ ï¼Œå®ƒçš„å¼‚æ­¥ç‰¹è´¨ä¸ä¼šæ‰©å±•åˆ°åµŒå¥—å‡½æ•°ä¸­ã€‚ä¸èƒ½åœ¨é¡¶çº§ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥å®šä¹‰å¹¶ç«‹å³è°ƒç”¨ï¼š å®šä¹‰å¹¶ç«‹å³è°ƒç”¨çš„å¼‚æ­¥å‡½æ•°(async function () console.log(await Promise.resolve(3));)(); //3 ä¸å…è®¸ï¼šawaitå‡ºç°åœ¨ç®­å¤´å‡½æ•°ä¸­function foo() const syncFn = () = return await Promise.resolve(foo); ; console.log(syncFn()); ä¸å…è®¸ï¼šawaitå‡ºç°åœ¨åŒæ­¥å‡½æ•°å£°æ˜ä¸­function bar() function syncFn() return await Promise.resolve(bar); console.log(syncFn()); ä¸å…è®¸ï¼šawaitå‡ºç°åœ¨åŒæ­¥å‡½æ•°è¡¨è¾¾å¼ä¸­function baz() const syncFn = function () return await Promise.resolve(baz); console.log(syncFn()); ä¸å…è®¸ï¼šIIFEä½¿ç”¨åŒæ­¥å‡½æ•°è¡¨è¾¾å¼æˆ–ç®­å¤´å‡½æ•°function qux() (function () console.log(await Promise.resolve(qux)); )(); (() = console.log(await Promise.resolve(qux)))(); 11.3.2 åœæ­¢å’Œæ¢å¤æ‰§è¡Œawaitå…³é”®å®é™…ä½œç”¨ å¼‚æ­¥å‡½æ•°ä¸­çœŸæ­£èµ·ä½œç”¨çš„å®é™…æ˜¯ awaitï¼Œasyncæ›´åƒæ˜¯ä¸€ä¸ª æ ‡è¯†ç¬¦ï¼Œå¼‚æ­¥å‡½æ•°å¦‚æœä¸åŒ…å«awaitå…³é”®å­—ï¼Œæ‰§è¡Œèµ·æ¥å®é™…å’Œæ™®é€šå‡½æ•°æ²¡æœ‰åŒºåˆ«ï¼šasync function foo() console.log(await Promise.resolve(foo));async function bar() console.log(await bar);async function baz() console.log(baz);foo(); bar();baz();// baz bar foo awaitå…³é”®å­—ä½œç”¨åŸç† JavaScriptè¿è¡Œæ—¶é‡åˆ°awaitä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œç¬¬ä¸€æ­¥è®°å½•æš‚åœæ‰§è¡Œçš„ä½ç½®ã€‚ç¬¬äºŒæ­¥ç­‰åˆ°å¯¹è±¡å€¼å¯ç”¨æ—¶ï¼Œä¼šå‘æ¶ˆæ¯é˜Ÿåˆ—æ¨é€ä¸€ä¸ªä»»åŠ¡ã€‚ç¬¬ä¸‰æ­¥è¯¥ä»»åŠ¡æ¢å¤å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œï¼ˆå›åˆ°ä¹‹å‰è®°å½•çš„æš‚åœä½ç½®ï¼‰awaitå¯¹è±¡æ˜¯ä¸€ä¸ªç«‹å³å¯ç”¨çš„å€¼awaitå¯¹è±¡æ˜¯ä¸€ä¸ªPromiseçš„å¯¹è±¡ async function foo() console.log(2); await null; console.log(3)console.log(1);foo();console.log(4); // 1 2 3 4 step 1 æ‰“å°1step 2 è¿›å…¥foo()ï¼Œæ‰“å°2step 3 é‡åˆ°awaitå…³é”®å­—ï¼Œè®°å½•æš‚åœä½ç½®ï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªä»»åŠ¡step 4 æš‚æ—¶é€€å‡ºfoo()ï¼Œæ‰“å°3step 5 åŒæ­¥çº¿ç¨‹ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œè¿”å›ä¹‹å‰è®°å½•ä½ç½®æ¢å¤å¼‚æ­¥å‡½æ•°æ‰§è¡Œstup 6 æ‰“å°4ï¼Œé€€å‡ºfoo() async function foo() console.log(2); console.log(await Promise.resolve(8)); console.log(9);async function bar() console.log(4) console.log(await 6); console.log(7);// 1 2 3 4 5 8 9 6 7console.log(1);foo();console.log(3);bar();console.log(5); step 1 æ‰“å°1step 2 è¿›å…¥fooï¼Œæ‰“å°2step 3 é‡åˆ°awaitå…³é”®å­—æš‚åœæ‰§è¡Œï¼Œè®°å½•æš‚å®šä½ç½®ï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªæœŸçº¦åœ¨è½å®šä¹‹åæ‰§è¡Œçš„ä»»åŠ¡step 4 æœŸçº¦ç«‹å³è½å®šï¼ŒæŠŠç»™awaitæä¾›å€¼çš„ä»»åŠ¡æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæš‚æ—¶ä»fooä¸­é€€å‡ºstep 5 æ‰“å°3step 6 è¿›å…¥barï¼Œæ‰“å°4step 7 é‡åˆ°awaitå…³é”®å­—æš‚åœæ‰§è¡Œï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œæš‚æ—¶é€€å‡ºbarstep 8 æ‰“å°5ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•step 9 é€€å›åˆ°fooæš‚åœä½ç½®ï¼Œæ‰“å°8ï¼Œæ‰“å°9ï¼Œé€€å‡ºfoo()step 10 é€€å›åˆ°baræš‚åœä½ç½®ï¼Œæ‰“å°6ï¼Œæ‰“å°7ï¼Œé€€å‡ºbar() 11.3.3 å¼‚æ­¥å‡½æ•°ç­–ç•¥1.å®ç°sleep() å¯ä»¥å®ç°ç±»ä¼¼Javaä¸­çš„ Tread.sleep() å‡½æ•°ï¼Œåœ¨ç¨‹åºä¸­åŠ å…¥éé˜»å¡çš„æš‚åœï¼šasync function sleep(delay) return new Promise((resolve) = setTimeout(resolve, delay));async function foo() const t0 = Date.now(); await sleep(1500); console.log(Date.now() - t0);foo(); //15072.åˆ©ç”¨å¹³è¡Œæ‰§è¡Œ é¡ºåºç­‰å¾…å¤šä¸ªå¼‚æ­¥æ“ä½œå¹³è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œasync function randomDelay(id) const delay = Math.random() * 1000; return new Promise((resolve) = setTimeout(() = console.log(id); resolve(); ,delay))async function foo() const t0 = Date.now(); await randomDelay(0); await randomDelay(1); await randomDelay(2); await randomDelay(3); await randomDelay(4); console.log(Date.now() - t0);foo(); //0 1 2 3 4 1994async function randomDelay(id) const delay = Math.random() * 1000; return new Promise((resolve) = setTimeout(() = console.log(id); resolve(); ,delay))async function foo() const t0 = Date.now(); // ä¸€æ¬¡æ€§åˆå§‹åŒ–æ‰€æœ‰æœŸçº¦ï¼Œå†åˆ†åˆ«ç­‰å¾…ç»“æœ const p0 = randomDelay(0); const p1 = randomDelay(1); const p2 = randomDelay(2); const p3 = randomDelay(3); const p4 = randomDelay(4); await p0; await p1; await p2; await p3; await p4; console.log(Date.now() - t0); foo(); // 3 1 4 2 0 9773.ä¸²è¡Œæ‰§è¡ŒæœŸçº¦ async function addTwo(x) return x + 2; async function addThree(x) return x + 3; async function addFive(x) return x + 5; async function addTen(x) for (const fn of [addTwo, addThree, addFive]) x = await fn(x); return x;addTen(9).then(console.log); //194.æ ˆè¿½è¸ªä¸å†…å­˜ç®¡ç† æ¯”è¾ƒ æœŸçº¦ ä¸ å†…å­˜ç®¡ç† åœ¨æ‹’ç»æœŸçº¦æ—¶çš„æ ˆè¿½è¸ªä¿¡æ¯ï¼š æœŸçº¦function fooPromiseExecutor(resolve, reject) setTimeout(reject, 1000, bar);function foo() new Promise(fooPromiseExecutor);foo();æ ˆè¿½è¸ªä¿¡æ¯Uncaught (in promise) barsetTimeout (async)fooPromiseExecutorfooJavaScriptå¼•æ“ä¼šåœ¨åˆ›å»ºæœŸçº¦æ—¶ å°½å¯èƒ½ä¿ç•™å®Œæ•´çš„è°ƒç”¨æ ˆ ï¼Œè¿™æ„å‘³ç€æ ˆè¿½è¸ªä¿¡æ¯ä¼šå ç”¨å†…å­˜ï¼Œå¸¦æ¥ä¸€äº›è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚ å¼‚æ­¥å‡½æ•°function fooPromiseExecutor(resolve, reject) setTimeout(reject, 1000, bar);async function foo() await new Promise(fooPromiseExecutor);foo();æ ˆè¿½è¸ªä¿¡æ¯Uncaught (in promise) barfooawait in foo (async)æ ˆè¿½è¸ªä¿¡æ¯å¯ä»¥å‡†ç¡®åœ°ååº”å½“å‰çš„è°ƒç”¨æ ˆã€‚JavaScriptåœ¨åµŒå¥—å‡½æ•°ä¸­å­˜å‚¨æŒ‡å‘åŒ…å«å‡½æ•°çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥ç”¨äºåœ¨å‡ºé”™æ—¶ç”Ÿæˆè¿½è¸ªä¿¡æ¯ã€‚å› æ­¤èƒ½å¤Ÿé™ä½å†…å­˜çš„é¢å¤–æ¶ˆè€—ã€‚ æ ˆè¿½è¸ªä¿¡æ¯åº”è¯¥ç›¸å½“ç›´æ¥åœ°è¡¨ç°JavaScriptå¼•æ“å½“å‰æ ˆå†…å­˜ä¸­å‡½æ•°è°ƒç”¨ä¹‹é—´çš„åµŒå¥—å…³ç³»ã€‚"},{"title":"9.1 ä»£ç†åŸºç¡€","path":"/wiki/JavaScript/chapter_9_1.html","content":"ä»£ç†ç®€å•æ¥è¯´ å°±æ˜¯æŒ‡ç»™ç›®æ ‡å¯¹è±¡å®šä¹‰ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œç„¶åæŠŠå®ƒå½“åšæŠ½è±¡çš„ç›®æ ‡å¯¹è±¡ä½¿ç”¨å› æ­¤å®ƒèƒ½å¤Ÿç”¨ä½œç›®æ ‡å¯¹è±¡çš„æ›¿èº«ï¼Œåˆå®Œå…¨ç‹¬ç«‹äºç›®æ ‡å¯¹è±¡ã€‚ ä»£ç†éœ€è¦å¹³å°æ”¯æŒ ä»£ç†æ˜¯ä¸€ç§æ–°çš„åŸºç¡€æ€§è¯­è¨€èƒ½åŠ›ï¼Œè½¬ä¹‰ç¨‹åºä¸èƒ½ç›´æ¥å°†å…¶è½¬æ¢ä¸ºES6ä¹‹å‰çš„ä»£ç ï¼Œå› æ­¤ä»£ç†å’Œåå°„éœ€è¦åœ¨ç™¾åˆ†ç™¾æ”¯æŒå®ƒä»¬çš„å¹³å°ä¸Šä½¿ç”¨ã€‚ 9.1.1 åˆ›å»ºç©ºä»£ç†Proxyå‡½æ•° åŠŸèƒ½ï¼š åˆ›å»ºä»£ç†å‚æ•°ï¼šparam 1ï¼š ç›®æ ‡å¯¹è±¡param 2ï¼š å¤„ç†ç¨‹åºå¯¹è±¡åŒºåˆ†ä»£ç†å’Œç›®æ ‡ï¼šå¯ä»¥ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰ï¼ˆï¼‰æ¥åŒºåˆ†ä¸èƒ½ä½¿ç”¨instanceof Proxyï¼Œå› ä¸ºProxy.prototypeæ˜¯undefined const target = id: target;const handler = ;const proxy = new Proxy(target, handler);console.log(target.id); //targetconsole.log(proxy.id); //targettarget.id = `foo`;console.log(target.id); //fooconsole.log(proxy.id); //fooproxy.id = `bar`;console.log(target.id); //barconsole.log(proxy.id); //barconsole.log(target.hasOwnProperty(id)); //trueconsole.log(proxy.hasOwnProperty(id)); //trueconsole.log(proxy === target); //false// TypeError: Function has non-object // prototype undefined in instanceof checkconsole.log(target instanceof Proxy);console.log(proxy instanceof Proxy) 9.1.2 å®šä¹‰æ•è·å™¨ä½¿ç”¨ä»£ç†çš„ä¸»è¦ç›®çš„å°±æ˜¯å¯ä»¥å®šä¹‰æ•è·å™¨ï¼ˆtrapï¼‰ã€‚ä»£ç†èƒ½åœ¨æ“ä½œä¼ æ’­åˆ°ç›®æ ‡å¯¹è±¡ä¹‹å‰å…ˆè°ƒç”¨æ•è·å™¨å‡½æ•°ï¼Œä»è€Œæ‹¦æˆªå¹¶ä¿®æ”¹ç›¸åº”çš„è¡Œä¸ºã€‚ æ³¨æ„ åªæœ‰åœ¨ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œæ‰ä¼šè§¦å‘æ•è·å™¨ã€‚ const target = foo: barconst handler = get() return handler override; const proxy = new Proxy(target, handler);console.log(target.foo); //barconsole.log(proxy.foo); //handler overrideconsole.log(target[foo]) //barconsole.log(proxy[foo]) //handler overrideconsole.log(Object.create(target)[foo]); //barconsole.log(Object.create(proxy)[foo]); //handler override 9.1.3 æ•è·å™¨å‚æ•°å’Œåå°„APIget()å‚æ•° trapTarget: ç›®æ ‡å¯¹è±¡property: è¦æŸ¥è¯¢çš„å±æ€§receiver: ä»£ç†å¯¹è±¡ const target = foo:barconst handler = get(trapTarget, property, receiver) console.log(trapTarget === target); console.log(property); console.log(receiver === proxy); const proxy = new Proxy(target, handler);// true// foo// trueproxy.foo; é€šè¿‡è¿™äº›å‚æ•°å°±å¯ä»¥é‡å»ºç›®æ ‡å¯¹è±¡çš„åŸå§‹è¡Œä¸ºäº†ï¼š const target = foo:barconst handler = get(trapTarget, property, receiver) return trapTarget[property]; const proxy = new Proxy(target, handler);console.log(proxy.foo); //barconsole.log(target.foo); //bar å…¨å±€å¯¹è±¡Reflect é€šè¿‡å…¨å±€å¯¹è±¡Reflectçš„åŒåæ–¹æ³•ä¹Ÿå¯ä»¥è½»æ¾å®ç°é‡å»ºã€‚ç®€æ´ä¸€ç‚¹â€¦const handler = get() return Reflect.get(...arguments); å†ç®€æ´ä¸€ç‚¹â€¦const handler = get:Reflect.getæ›´ç®€æ´ç‚¹â€¦ï¼ˆç›´æ¥æ•è·æ‰€æœ‰æ–¹æ³•ï¼‰const proxy = new Proxy(target, Reflect);ä½¿ç”¨åå°„APIçš„æ ·æ¿ä»£ç const target = foo: bar, baz: qux;const handler = get(trapTarget, property, receiver) let decoration = ; if (property === foo) decoration = !!!; return Reflect.get(...arguments) + decoration; const proxy = new Proxy(target, handler);console.log(proxy.foo); //foo!!!console.log(target.foo); //fooconsole.log(proxy.baz); //quxconsole.log(target.baz); //qux 9.1.4 æ•è·å™¨ä¸å˜å¼å½“æ•è·å™¨å®šä¹‰å‡ºç°è¿‡äºåå¸¸çš„è¡Œä¸ºæ—¶ï¼ˆå¦‚getå’Œwritableçš„å®šä¹‰å‡ºç°å†²çªæ—¶ï¼‰æ•è·å™¨ä¸å˜å¼ä¼šè¿›è¡ŒæŠ¥é”™ã€‚ const target = ;Object.defineProperty(target, foo, configurable: false, writable: false, value: bar);const handler = get() return qux; ;const proxy = new Proxy(target, handler);// get on proxy: property foo is a read-only // and non - configurable data property on the proxy // target but the proxy did not return its // actual value(expected bar but got qux)console.log(proxy.foo); 9.1.5 å¯æ’¤é”€ä»£ç†Proxy.revocable è¿™ä¸ªæ–¹æ³•æ”¯æŒæ’¤é”€ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡çš„å…³è”ã€‚const target = foo:barconst handler = get() return interecpted const proxy, revoke = Proxy.revocable(target, handler);console.log(proxy.foo); //barconsole.log(target.foo); //barrevoke();// TypeError:// Cannot perform get on a proxy that has been revokedconsole.log(proxy.foo); 9.1.6 å®ç”¨åå°„API åå°„APIä¸å¯¹è±¡API åå°„APIå¹¶ä¸é™äºæ•è·å¤„ç†ç¨‹åº å¤§å¤šæ•°åå°„APIæ–¹æ³•åœ¨Objectç±»å‹ä¸Šæœ‰å¯¹åº”çš„æ–¹æ³• Objectä¸Šçš„æ–¹æ³•é€‚ç”¨äºé€šç”¨ç¨‹åº åå°„æ–¹æ³•é€‚ç”¨äºç»†ç²’åº¦çš„å¯¹è±¡æ§åˆ¶ä¸æ“ä½œ çŠ¶æ€æ ‡è®° æ•°æ®ç±»å‹ï¼š å¸ƒå°”å€¼ è¡¨ç¤ºï¼š æ„å›¾æ‰§è¡Œçš„æ“ä½œæ˜¯å¦æˆåŠŸ é‡æ„å‰ const o = try Object.defineProperty(o, foo, bar); console.log(success); catch (e) console.log(failure); é‡æ„åï¼ˆæ“ä½œå¤±è´¥æ—¶ä¸ä¼šæŠ¥é”™ï¼‰ const o = ;if (Reflect.defineProperty(o, foo, value: bar )) console.log(success); //success else console.log(failure); æä¾›çŠ¶æ€æ ‡è®°çš„åå°„æ–¹æ³• Reflect.defineProperty()Reflect.preventExtensions()Reflect.setPrototypeof()Reflect.set()Reflect.deleteProperty() ç”¨ä¸€ç­‰å‡½æ•°æ›¿ä»£æ“ä½œç¬¦ Reflect.get(): ä»£æ›¿å¯¹è±¡å±æ€§è®¿é—®æ“ä½œç¬¦ Reflect.set(): ä»£æ›¿èµ‹å€¼æ“ä½œç¬¦ Reflect.has(): ä»£æ›¿inæ“ä½œç¬¦æˆ–with() Reflect.deleteProperty(): ä»£æ›¿deleteæ“ä½œç¬¦ Reflect.construct(): ä»£æ›¿newæ“ä½œç¬¦ å®‰å…¨åœ°åº”ç”¨å‡½æ•° ä¸»è¦é’ˆå¯¹applyæ–¹æ³•çš„è°ƒç”¨: applyè°ƒç”¨åé¢æ•™æ Function.prototye.apply.call(myFunc, thisVal, argumentList); ä½¿ç”¨Reflectæ¥é¿å… Reflect.apply(myFunc, thisVal, argumentsList); 9.1.7 ä»£ç†å¦ä¸€ä¸ªä»£ç†å¤šå±‚æ‹¦æˆªç½‘ ä»£ç†å®Œå…¨å¯ä»¥ä»£ç†å¦ä¸€ä¸ªä»£ç†ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¹‹ä¸Šæ„å»ºå¤šå±‚æ‹¦æˆªç½‘ã€‚const target = foo:barconst firstProxy = new Proxy(target, get() console.log(first proxy); return Reflect.get(...arguments); );const secondProxy = new Proxy(firstProxy, get() console.log(second Proxy); return Reflect.get(...arguments); );// second Proxy// first Proxy// barconsole.log(secondProxy.foo); 9.1.8 ä»£ç†çš„é—®é¢˜ä¸ä¸è¶³ ä»£ç†ä¸­çš„this ç›´è§‰ä¸Šè®²ï¼Œthisé€šå¸¸æŒ‡å‘è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ã€‚å³è°ƒç”¨ä»£ç†ä¸Šçš„ä»»ä½•æ–¹æ³•ï¼Œå¦‚proxy.outerMethod(),proxy.outerMethod()è°ƒç”¨this.innerMethod(),å®é™…ä¸Šä¼šè°ƒç”¨proxy.innerMethod()å½“ç›®æ ‡å¯¹è±¡ä¾èµ–äºå¯¹è±¡æ ‡è¯†æ—¶ä¼šå­˜åœ¨é—®é¢˜const wm = new WeakMap();class User constructor(userId) wm.set(this, userId); set id(userId) wm.set(this, userId); get id() return wm.get(this); const user = new User(123);console.log(user.id); //123const userInstanceProxy = new Proxy(user, );console.log(userInstanceProxy.id); //undefinedè¿™æ˜¯å› ä¸ºUserå®ä¾‹ä¸€å¼€å§‹ä½¿ç”¨ç›®æ ‡å¯¹è±¡ä½œä¸ºWeakMaoçš„é”®ï¼Œä»£ç†å¯¹è±¡å´å°è¯•ä»è‡ªèº«å–å¾—è¿™ä¸ªå®ä¾‹ã€‚ è§£å†³æ–¹æ¡ˆæŠŠä»£ç†Userå®ä¾‹æ”¹ä¸ºä»£ç†Userç±»æœ¬èº«ï¼Œå†åˆ›å»ºä»£ç†çš„å®ä¾‹ã€‚const UserClassProxy = new Proxy(User, );const proxyUser = new UserClassProxy(456);console.log(proxyUser.id); //456 ä»£ç†ä¸å†…éƒ¨æ§½ä½ æœ‰äº›ECMAScriptå†…ç½®ç±»å‹å¯èƒ½ä¼šä¾èµ–ä»£ç†æ— æ³•æ§åˆ¶çš„æœºåˆ¶ï¼ŒåŸå› æ˜¯è¿™äº›å†…ç½®ç±»å‹æ–¹æ³•çš„æ‰§è¡Œä¾èµ–thiså€¼ä¸Šçš„å†…éƒ¨æ§½ä½ï¼Œä½†æ˜¯ä»£ç†å¯¹è±¡ä¸Šä¸å­˜åœ¨è¿™ä¸ªå†…éƒ¨æ§½ä½ã€‚ const target = new Date();const proxy = new Proxy(target, );console.log(proxy instanceof Date); //trueproxy.getDate(); //TypeError: this is not a Date object"},{"title":"9.2 ä»£ç†æ•è·å™¨ä¸åå°„æ–¹æ³•","path":"/wiki/JavaScript/chapter_9_2.html","content":"ä»£ç†å¯ä»¥æ•è·13ç§ä¸åŒçš„åŸºæœ¬æ“ä½œã€‚è¿™äº›æ“ä½œå„è‡ªæœ‰ä¸åŒçš„åå°„APIæ–¹æ³•ã€å‚æ•°ã€å…³è”ECMAScriptæ“ä½œå’Œä¸å˜å¼ã€‚ 9.2.1 get()const myTarget = ;const proxy = new Proxy(myTarget, get(target, property, receiver) console.log(get); return Reflect.get(...arguments); )proxy.foo; //getS è°ƒç”¨åœºæ™¯ï¼š è·å–å±æ€§å€¼çš„æ“ä½œ åå°„APIï¼š Reflect.get() è¿”å›å€¼ï¼š æ— è¿”å›å€¼ æ‹¦æˆªçš„æ“ä½œï¼š proxy.property proxy[property] Object.create(proxy)[property] Reflect.get(proxy, property, receiver) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target: ç›®æ ‡å¯¹è±¡ property: å­—ç¬¦ä¸²é”®å±æ€§ receiver: ä»£ç†å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š target.propertyä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œgetè¿”å›å€¼å¿…é¡»åŒ¹é…target.property target.propertyä¸å¯é…ç½®ä¸”[[Get]]undefinedï¼Œgetè¿”å›å€¼ä¹Ÿå¿…é¡»æ˜¯undefined 9.2.2 set()const myTarget = ;const proxy = new Proxy(myTarget, set(target, property, value, reciever) console.log(set); return Reflect.set(...arguments); )proxy.foo = bar; //set è°ƒç”¨åœºæ™¯ï¼š åœ¨è®¾ç½®å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ åå°„APIï¼š Reflect.set() è¿”å›å€¼ï¼š true è®¾ç½®æˆåŠŸ false è®¾ç½®å¤±è´¥ï¼Œstrictæ¨¡å¼ä¸‹ä¼šæŠ›å‡ºTypeError æ‹¦æˆªçš„æ“ä½œï¼š proxy.property value proxy[property] value Object.create(proxy)[property] value Reflect.set(proxy, property, value, receiver) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ property é”®å±æ€§ value å±æ€§å€¼ receiver æ¥æ”¶èµ‹å€¼çš„å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š target.propertyä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œä¸èƒ½ä¿®æ”¹ç›®æ ‡å±æ€§å€¼ target.propertyä¸å¯é…ç½®ä¸”[[Set]] undefinedï¼Œä¸èƒ½ä¿®æ”¹ç›®æ ‡å±æ€§å€¼ strictæ¨¡å¼ä¸‹ï¼Œreturn falseä¼šæŠ›å‡ºTypeError 9.2.3 has()const myTarget = ;const proxy = new Proxy(myTarget, has(target, property) console.log(has); return Reflect.has(...arguments); )foo in proxy; //has è°ƒç”¨åœºæ™¯ï¼š åœ¨inæ“ä½œç¬¦ä¸­è¢«è°ƒç”¨ åå°„APIï¼š Reflect.has() è¿”å›å€¼ï¼š å¿…é¡»ä¸ºBooleanï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦å­˜åœ¨ æ‹¦æˆªçš„æ“ä½œï¼š property in proxy property in Obejct.create(proxy) with(proxy) {(property);} Reflect.has(proxy, property) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ property é”®å±æ€§ æ•è·å™¨ä¸å˜å¼ï¼š target.propertyå­˜åœ¨ä¸”ä¸å¯é…ç½®ï¼Œreturn true target.propertyå­˜åœ¨ä¸”ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œreturn true 9.2.4 defineProperty()const myTarget = ;const proxy = new Proxy(myTarget, defineProperty(target, property, descriptor) console.log(defineProperty); return Reflect.defineProperty(...arguments); )// definePropertyObject.defineProperty(proxy, foo, value: bar ); è°ƒç”¨åœºæ™¯ï¼š åœ¨ Obejct.defineProperty ä¸­è¢«è°ƒç”¨ åå°„APIï¼š Reflect.defineProperty() è¿”å›å€¼ï¼š Booleanï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦æˆåŠŸå®šä¹‰ æ‹¦æˆªçš„æ“ä½œï¼š Object.defineProperty(proxy, property, descriptor) Reflect.defineProperty(proxy, property, descriptor) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ property é”®å±æ€§ descriptor ä¸€ä¸ªåŒ…å«å¯é€‰çš„ enumerableã€configurableã€writableã€valueã€getã€set çš„å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š target.property[[Configurable]] falseï¼Œæ— æ³•å®šä¹‰å±æ€§ target.property[[Configurable]] trueï¼Œä¸èƒ½æ·»åŠ ä¸å¯é…ç½®çš„åŒåå±æ€§ target.property[[Configurable]] falseï¼Œä¸èƒ½æ·»åŠ å¯é…ç½®åŒåå±æ€§ 9.2.5 getOwnPropertyDescriptor()const myTarget = ;const proxy = new Proxy(myTarget, getOwnPropertyDescriptor(target, property) console.log(getOwnPropertyDescriptor); return Reflect.getOwnPropertyDescriptor(...arguments); )// getOwnPropertyDescriptorObject.getOwnPropertyDescriptor(proxy, foo); è°ƒç”¨åœºæ™¯ï¼š åœ¨ Object.getOwnPropertyDescriptor() ä¸­è¢«è°ƒç”¨ åå°„APIï¼š Reflect.getOwnPropertyDescriptor() è¿”å›å€¼ï¼š å¿…é¡»è¿”å›Objectï¼Œå±æ€§ä¸å­˜åœ¨æ—¶è¿”å›undefined æ‹¦æˆªçš„æ“ä½œï¼š Object.getOwnPropertyDescriptor(proxy, property) Reflect.getOwnPropertyDescriptor(proxy, property) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ property é”®å±æ€§ æ•è·å™¨ä¸å˜å¼ï¼š target.propertyå­˜åœ¨ target.propertyå¯é…ç½®ï¼Œè¿”å›è¡¨ç¤ºè¯¥å±æ€§å¯é…ç½®çš„å¯¹è±¡ target.propertyä¸å¯é…ç½®ï¼Œè¿”å›è¡¨ç¤ºè¯¥å±æ€§å­˜åœ¨çš„å¯¹è±¡ targetå¯æ‰©å±•ï¼Œè¿”å›ä¸€ä¸ªè¯¥å±æ€§å­˜åœ¨çš„å¯¹è±¡ targetä¸å¯æ‰©å±•ï¼Œè¿”å›undefinedè¡¨ç¤ºè¯¥å±æ€§ä¸å­˜åœ¨ target.propertyä¸å­˜åœ¨ï¼Œä¸èƒ½è¿”å›è¡¨ç¤ºè¯¥å±æ€§å¯é…ç½®çš„å¯¹è±¡ 9.2.6 deleteProperty()const myTarget = ;const proxy = new Proxy(myTarget, deleteProperty(target,property) console.log(delete); return Reflect.deleteProperty(...arguments); )delete proxy.foo; //delete è°ƒç”¨åœºæ™¯ï¼š åœ¨deleteæ“ä½œç¬¦ä¸­è°ƒç”¨ åå°„APIï¼š Reflect.deleteProperty() è¿”å›å€¼ï¼š Boolean è¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸ æ‹¦æˆªçš„æ“ä½œï¼š delete proxy.property delete proxy[property] Reflect.deleteProperty(proxy, property) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ property é”®å±æ€§ æ•è·å™¨ä¸å˜å¼ï¼š target.propertyå­˜åœ¨ä¸”ä¸å¯é…ç½®åˆ™ä¸èƒ½åˆ é™¤ 9.2.7 ownKeys()const myTarget = ;const proxy = new Proxy(myTarget, ownKeys(target) console.log(ownKeys); return Reflect.ownKeys(...arguments); )Object.keys(proxy); //ownKeys è°ƒç”¨åœºæ™¯ï¼š åœ¨Object.keysåŠç±»ä¼¼æ–¹æ³•ä¸­è°ƒç”¨ åå°„APIï¼š Reflect.ownKeys() è¿”å›å€¼ï¼š StringSymbol å¯æšä¸¾å¯¹è±¡ æ‹¦æˆªçš„æ“ä½œï¼š Object.getOwnPropertyNames(proxy) Object.getOwnPropertySymbols(proxy) Object.keys(proxy) Reflect.ownKeys(proxy) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š è¿”å›çš„å¯æšä¸¾å¯¹è±¡å¿…é¡»åŒ…å«targetæ‰€æœ‰ä¸å¯é…ç½®çš„è‡ªæœ‰property å¦‚æœtargetä¸å¯æ‰©å±•ï¼Œè¿”å›çš„å¯æšä¸¾å¯¹è±¡å¿…é¡»å‡†ç¡®åŒ…å«è‡ªæœ‰å±æ€§é”® 9.2.8 getPrototypeOf()const myTarget = ;const proxy = new Proxy(myTarget, getPrototypeOf(target) console.log(getPrototypeOf); return Reflect.getPrototypeOf(...arguments); )// getPrototypeOfObject.getPrototypeOf(proxy); è°ƒç”¨åœºæ™¯ï¼š åœ¨Object.getPropertyOfä¸­è°ƒç”¨ åå°„APIï¼š Reflect.getPropertyOf() è¿”å›å€¼ï¼š Objectnull æ‹¦æˆªçš„æ“ä½œï¼š Object.getPrototypeOf(proxy) Reflect.getPrototypeOf(proxy) proxy.__proto__ Object.prototype.isPrototypeOf(proxy) proxy instanceof Object æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š è‹¥targetä¸å¯æ‰©å±•ï¼Œproxyå’Œtargetçš„getPrototypeOfå€¼ç›¸ç­‰ 9.2.9 setPrototypeOf()const myTarget = ;const proxy = new Proxy(myTarget, setPrototypeOf(target, prototype) console.log(setPrototypeOf); return Reflect.setPrototypeOf(...arguments); )// setPrototypeOfObject.setPrototypeOf(proxy, Object); è°ƒç”¨åœºæ™¯ï¼š åœ¨Object.setPrototypeOfä¸­è°ƒç”¨ åå°„APIï¼š Reflect.setPropertyOf() è¿”å›å€¼ï¼š Boolean è¡¨ç¤ºåŸå‹èµ‹å€¼æ˜¯å¦æˆåŠŸ æ‹¦æˆªçš„æ“ä½œï¼š Object.setPrototypeOf(proxy) Reflect.setPrototypeOf(proxy) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ prototype ä»£æ›¿åŸå‹ï¼Œé¡¶çº§åŸå‹åˆ™ä¸ºnull æ•è·å™¨ä¸å˜å¼ï¼š è‹¥targetä¸å¯æ‰©å±•ï¼Œå”¯ä¸€æœ‰æ•ˆçš„prototypeå‚æ•°å°±æ˜¯Object.getPrototypeOf(target)è¿”å›å€¼ 9.2.10 isExtensible()const myTarget = ;const proxy = new Proxy(myTarget, isExtensible(target) console.log(isExtensible); return Reflect.isExtensible(...arguments); )Object.isExtensible(proxy); //isExtensible è°ƒç”¨åœºæ™¯ï¼š åœ¨Object.isExtensibleä¸­è°ƒç”¨ åå°„APIï¼š Reflect.isExtensible() è¿”å›å€¼ï¼š Boolean è¡¨ç¤ºtargetæ˜¯å¦å¯æ‰©å±• æ‹¦æˆªçš„æ“ä½œï¼š Object.isExtensible(proxy) Reflect.isExtensible(proxy) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š targetå¯æ‰©å±•ï¼Œreturn true targetä¸å¯æ‰©å±•ï¼Œreturn false 9.2.11 preventExtensions()const myTarget = ;const proxy = new Proxy(myTarget, preventExtensions(target) console.log(preventExtensions); return Reflect.preventExtensions(...arguments); )//preventExtensionsObject.preventExtensions(proxy); è°ƒç”¨åœºæ™¯ï¼š åœ¨Object.preventExtensionsä¸­è°ƒç”¨ åå°„APIï¼š Reflect.preventExtensions() è¿”å›å€¼ï¼š Boolean è¡¨ç¤ºtargetæ˜¯å¦ä¸å¯æ‰©å±• æ‹¦æˆªçš„æ“ä½œï¼š Object.preventExtensions(proxy) Reflect.preventExtensions(proxy) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ æ•è·å™¨ä¸å˜å¼ï¼š å¿…é¡»è¿”å› !Object.isExtensible(proxy) 9.2.12 apply()const myTarget = () = ;const proxy = new Proxy(myTarget, apply(target, thisArg, ...argumentsList) console.log(apply); return Reflect.apply(...arguments); );proxy(); //apply è°ƒç”¨åœºæ™¯ï¼š åœ¨è°ƒç”¨å‡½æ•°æ—¶è¢«è°ƒç”¨ åå°„APIï¼š Reflect.apply() è¿”å›å€¼ï¼š æ— é™åˆ¶ æ‹¦æˆªçš„æ“ä½œï¼š proxy(â€¦argumentsList) Function.prototype.apply(thisArg, argumentsList) Function.prototype.call(thisArg, â€¦argumentsList) Reflect.apply(target, thisArgument, argumentsList) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ thisArg è°ƒç”¨å‡½æ•°æ—¶thiså‚æ•° argumentsList è°ƒç”¨å‡½æ•°æ—¶å‚æ•°åˆ—è¡¨ æ•è·å™¨ä¸å˜å¼ï¼š targetå¿…é¡»æ˜¯å‡½æ•°å¯¹è±¡ 9.2.13 construct()const myTarget = function () ;const proxy = new Proxy(myTarget, construct(target, argumentsList, newTarget) console.log(construct); return Reflect.construct(...arguments); )new proxy; //construct è°ƒç”¨åœºæ™¯ï¼š åœ¨newæ“ä½œç¬¦ä¸­è°ƒç”¨ åå°„APIï¼š Reflect.construct() è¿”å›å€¼ï¼š Object æ‹¦æˆªçš„æ“ä½œï¼š new proxy(â€¦argumentsList) Reflect.construct(target, argumentsList, newTarget) æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š target ç›®æ ‡å¯¹è±¡ argumentsList ä¼ ç»™ç›®æ ‡æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ newTarget æœ€åˆè¢«è°ƒç”¨çš„æ„é€ å‡½æ•° æ•è·å™¨ä¸å˜å¼ï¼š targetå¿…é¡»å¯ä»¥ç”¨åšæ„é€ å‡½æ•°"},{"title":"9.3 ä»£ç†æ¨¡å¼","path":"/wiki/JavaScript/chapter_9_3.html","content":"ä»£ç†å¯ä»¥ç”¨æ¥å®ç°ä¸€äº›æœ‰ç”¨çš„ç¼–ç¨‹æ¨¡å¼ 9.3.1 è·Ÿè¸ªå±æ€§è®¿é—®æŠŠå®ç°ç›¸åº”æ•è·å™¨çš„æŸä¸ªå¯¹è±¡ä»£ç†æ”¾åˆ°åº”ç”¨ä¸­ï¼Œå¯ä»¥ç›‘æ§è¿™ä¸ªå¯¹è±¡ä½•æ—¶åœ¨ä½•å¤„è¢«è®¿é—®è¿‡const user = name:Jakeconst proxy = new Proxy(user, get(target, property, receiver) console.log(`Getting $property`); return Reflect.get(...arguments); , set(target, property, value, receiver) console.log(`Setting $property = $value`); return Reflect.set(...arguments); );proxy.name; // Getting nameproxy.age = 27; // Setting age = 27 9.3.2 éšè—å±æ€§ä»£ç†å†…éƒ¨å®ç°å¯¹å¤–éƒ¨ä»£ç ä¸å¯è§ï¼Œå¯ä»¥å€Ÿæ­¤éšè—ç›®æ ‡å¯¹è±¡ä¸Šçš„å±æ€§const hiddenProperties = [foo, bar];const targetObject = foo: 1, bar: 2, baz: 3;const proxy = new Proxy(targetObject, get(target, property) if (hiddenProperties.includes(property)) return undefined; else return Reflect.get(...arguments); , has(target, property) if (hiddenProperties.includes(property)) return false; else return Reflect.has(...arguments); );console.log(proxy.foo); //undefinedconsole.log(proxy.bar); //undefinedconsole.log(proxy.baz); //3console.log(foo in proxy); // falseconsole.log(bar in proxy); // falseconsole.log(baz in proxy); // true 9.3.3 å±æ€§éªŒè¯åœ¨èµ‹å€¼æ“ä½œè§¦å‘setæ•è·å™¨æ—¶ï¼Œå¯ä»¥æ ¹æ®æ‰€èµ‹çš„å€¼å†³å®šæ˜¯å¦å…è®¸èµ‹å€¼ã€‚ const target = onlyNumbersGoHere: 0 const proxy = new Proxy(target, set(target, property, value) if (typeof value !== number) return false; else return Reflect.set(...arguments); )proxy.onlyNumbersGoHere = 1;console.log(proxy.onlyNumbersGoHere); //1proxy.onlyNumbersGoHere = 2;console.log(proxy.onlyNumbersGoHere); //1 9.3.4 å‡½æ•°ä¸æ„é€ å‡½æ•°å‚æ•°éªŒè¯å¯ä»¥å¯¹å‡½æ•°å’Œæ„é€ å‡½æ•°çš„å‚æ•°è¿›è¡Œå®¡æŸ¥ï¼Œå¦‚è®©å‡½æ•°æ¥æ”¶æŒ‡å®šç±»å‹çš„å€¼ã€‚ function median(...nums) return nums.sort()[Math.floor(nums.length / 2)];const proxy = new Proxy(median, apply(target, thisArg, argumentsList) for (const arg of argumentsList) if (typeof arg !== number) throw Error: Non-number argument provided; return Reflect.apply(...arguments); )console.log(proxy(4, 7, 1)); //4console.log(proxy(4, 7, 1)); //Error: Non-number argument providedåˆæˆ–è€…æ˜¯åœ¨å®ä¾‹åŒ–æ—¶å¿…é¡»ç»™æ„é€ å‡½æ•°ä¼ å‚class User constructor(id) this.id_ = id; const proxy = new Proxy(User, construct(target, argumentsList, newTarget) if (argumentsList[0] === undefined) throw User cannot be instantiated without id; else return Reflect.construct(...arguments); )new proxy(1);new proxy(); //Error: ... 9.3.5 æ•°æ®ç»‘å®šä¸å¯è§‚å¯Ÿå¯¹è±¡ä»£ç†å¯ä»¥æŠŠè¿è¡Œæ—¶ä¸ç›¸å…³çš„éƒ¨åˆ†è”ç³»åˆ°ä¸€èµ·ï¼Œè®©ä¸åŒçš„ä»£ç äº’æ“ä½œã€‚ å¯ä»¥å°†è¢«ä»£ç†çš„ç±»ç»‘å®šåˆ°ä¸€ä¸ªå…¨å±€å®ä¾‹é›†åˆä¸­const userList = [];class User constructor(name) this.name_ = name; const proxy = new Proxy(User, construct() const newUser = Reflect.construct(...arguments); userList.push(newUser); return newUser; );new proxy(John);new proxy(Jacob);new proxy(Jingleheimerschmidt);console.log(userList); //[User,User,User]å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¯æ¬¡æ’å…¥æ–°å®ä¾‹éƒ½ä¼šå‘é€æ¶ˆæ¯çš„äº‹ä»¶åˆ†æ´¾ç¨‹åºconst userList = [];function emit(newValue) console.log(newValue);const proxy = new Proxy(userList, set(target, property, value, receiver) const result = Reflect.set(...arguments); if (result) emit(Reflect.get(target, property, receiver)); return result; )proxy.push(John); //John 1proxy.push(Jacob); //Jacob 2"},{"title":"Webåº”ç”¨å®‰å…¨/æ ¸å¿ƒé˜²å¾¡æœºåˆ¶","path":"/wiki/Network/wahh_01_web.html","content":"é—®é¢˜é—®é¢˜ æ—¨åœ¨é˜»æ­¢è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»çš„è¾“å…¥ç¡®è®¤æœºåˆ¶æŒ‰ä»¥ä¸‹é¡ºåºå¤„ç†ä¸€ä¸ªè¾“å…¥ï¼šï¼ˆ1ï¼‰åˆ é™¤ä»»ä½•å‡ºç°çš„scriptè¡¨è¾¾å¼ï¼›ï¼ˆ2ï¼‰å°†è¾“å…¥æˆªçŸ­ä¸º50ä¸ªå­—ç¬¦ï¼›ï¼ˆ3ï¼‰åˆ é™¤è¾“å…¥ä¸­çš„å¼•å·ï¼›ï¼ˆ4ï¼‰å¯¹è¾“å…¥è¿›è¡ŒURLè§£ç ï¼›ï¼ˆ5ï¼‰å¦‚æœä»»ä½•è¾“å…¥é¡¹è¢«åˆ é™¤ï¼Œè¿”å›æ­¥éª¤ï¼ˆ1ï¼‰ã€‚æ˜¯å¦èƒ½å¤Ÿé¿å¼€ä¸Šè¿°ç¡®è®¤æœºåˆ¶ï¼Œè®©ä»¥ä¸‹æ•°æ®é€šè¿‡ç¡®è®¤ï¼Ÿâ€œscriptalert(â€œfooâ€)/scriptå®˜æ–¹ç­”æ¡ˆæ˜¯ã€‚å¦‚æœæ²¡æœ‰ç¬¬4æ­¥ï¼Œæ­¤æœºåˆ¶å°†æ˜¯å¯é çš„ï¼Œèƒ½å¤Ÿè¿‡æ»¤å…¶æ—¨åœ¨é˜»æ­¢çš„ç‰¹å®šé¡¹ç›®ã€‚ä½†æ˜¯ï¼Œç”±äºè¾“å…¥åœ¨æ‰§è¡Œè¿‡æ»¤æ­¥éª¤åè¢«è§£ç ï¼Œæ”»å‡»è€…åªéœ€è¦å¯¹æœ‰æ•ˆè½½è·ä¸­çš„é€‰å®šå­—ç¬¦è¿›è¡ŒURLç¼–ç ï¼Œå°±å¯ä»¥é¿å¼€è¿™ç§è¿‡æ»¤ï¼šâ€œå¦‚æœé¦–å…ˆæ‰§è¡Œç¬¬4æ­¥ï¼Œæˆ–æ ¹æœ¬ä¸æ‰§è¡Œè¯¥æ­¥éª¤ï¼Œæ”»å‡»è€…å°†ä¸å¯èƒ½é¿å¼€ä¸Šè¿°è¿‡æ»¤ã€‚ä»£ç å®ç°function inputFilter(src) let hasInvalid = false // 1. åˆ é™¤ä»»ä½•å‡ºç°çš„scriptè¡¨è¾¾å¼ const reg = /(\\/)?script/g if(reg.test(src)) src = src.replaceAll(reg, ) hasInvalid = true // 2. å°†è¾“å…¥æˆªæ–­ä¸º50ä¸ªå­—ç¬¦ if(src.length50) src = src.slice(0,50) hasInvalid = true // 3. åˆ é™¤2è¾“å…¥ä¸­çš„å¼•å· let signReg = /[]/g if(signReg.test(src)) src = src.replaceAll(signReg, ) hasInvalid = true // 4. å¯¹è¾“å…¥è¿›è¡ŒURLè§£ç  src = urlencode.decode(src) if(hasInvalid) return inputFilter(urlencode.encode(src)) return srcè¿™æ—¶å¦‚æœè¾“å…¥çš„æ•°æ®ç»è¿‡æ”»å‡»è€…ç¼–ç ï¼š// %22= %27= %3C= %3E=const src = %22%3Cscriptalert(%22foo%22)%3C/scriptè¾“å‡ºç»“æœæ˜¾ç¤ºå­—ç¬¦ä¸²è¢«è§£æä¸ºè·¨ç«™è„šæœ¬æ”»å‡»å­—ç¬¦ä¸²ï¼š--------------------------------------ç›®æ ‡è¾“å‡ºï¼šscriptalert(foo)/scriptè¾“å…¥ï¼š%22%3Cscriptalert(%22foo%22)%3C/scriptè¾“å‡ºï¼šscriptalert(foo)/script--------------------------------------"},{"title":"Hello NodeJs","path":"/wiki/Node/beginner_01_hello_nodejs.html","content":"å‘½ä»¤è¡Œçª—å£å¸¸ç”¨çš„æŒ‡ä»¤æœ‰ï¼š dir åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ cd md æ–‡ä»¶å¤¹å åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ rd æ–‡ä»¶å¤¹å åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¤¹ ç¯å¢ƒå˜é‡ï¼šæ“ä½œç³»ç»Ÿä¸­çš„å˜é‡ä½ç½®ï¼šé«˜çº§ç³»ç»Ÿå˜é‡-ç¯å¢ƒå˜é‡ ç”¨æˆ·å˜é‡ï¼šåªæœ‰å½“å‰ç”¨æˆ·èƒ½ç”¨ ç³»ç»Ÿå˜é‡ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ç”¨ path D:\\Ruby\\Ruby31-x64\\bin;D:\\python3\\Scripts;D:\\python3;D:\\python\\Scripts;D:\\python;%USERPROFILE%\\AppData\\Local\\Microsoft\\WindowsApps;â€¦åœ¨D:\\CS_Demo\\V_Demo\\NodeJs_Demo\\assets\\helloç›®å½•ä¸‹æ–°å»ºhello.txtï¼Œè¯•ç€åœ¨pathä¸­åŠ å…¥è¿™æ ·ä¸€è¡Œå˜é‡D:\\CS_Demo\\V_Demo\\NodeJs_Demo\\assets\\helloé‡å¯cmdï¼Œæ— è®ºåœ¨ä»€ä¹ˆç›®å½•ä¸‹è¾“å…¥hello.txtå‘½ä»¤ï¼Œéƒ½èƒ½å¤Ÿè®¿é—®åˆ°hello.txt æ“ä½œç³»ç»Ÿè®¿é—®æ–‡ä»¶çš„é¡ºåº åœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ï¼Œæ‰¾åˆ°äº†ç›´æ¥æ‰“å¼€å¦‚æœæ²¡åœ¨ç›®å½•ä¸‹æ‰¾åˆ°ï¼Œä¼šä¾æ¬¡æŒ‰ç…§ç¯å¢ƒå˜é‡pathçš„è·¯å¾„å¯»æ‰¾å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ä¼šæŠ¥é”™æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ç»å¸¸éœ€è¦è®¿é—®çš„ç¨‹åºå’Œæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°pathä¸­è¿™æ ·å°±èƒ½åœ¨ä»»æ„ä½ç½®è®¿é—®è¿™äº›æ–‡ä»¶å’Œç¨‹åºäº† è¿›ç¨‹å’Œçº¿ç¨‹ è¿›ç¨‹ è´Ÿè´£ä¸ºç¨‹åºçš„è¿è¡Œæä¾›å¿…å¤‡çš„ç¯å¢ƒ å°±åƒå·¥å‚ä¸­çš„è½¦é—´ çº¿ç¨‹ è®¡ç®—æœºä¸­çš„æœ€å°è®¡ç®—èŒƒå›´ï¼Œè´Ÿè´£æ‰§è¡Œè¿›ç¨‹ä¸­çš„ç¨‹åº ç›¸å½“äºå·¥å‚ä¸­çš„å·¥äºº å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ å•çº¿ç¨‹ç›¸å½“äºä¸€ä¸ªçº¿ç¨‹åšå®Œæ•´ä¸ªä¸€ä¸ªæµç¨‹ï¼Œåƒjsè¿™ç§éœ€è¦å¯¹é¡µé¢domå…ƒç´ è¿›è¡Œæ“ä½œçš„ç¨‹åºå°±æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ å¤šçº¿ç¨‹æ˜¯ä¸»æµçš„çº¿ç¨‹å¤„ç†æ–¹å¼ï¼Œç›¸å½“äºå¤šä¸ªçº¿ç¨‹å®Œæˆä¸€ä¸ªæµç¨‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ€§èƒ½æ¯”è¾ƒé«˜ NodeJsç®€ä»‹NodeJsæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¿è¡Œçš„jsç¯å¢ƒ ä¹‹å‰çš„jséƒ½æ˜¯åœ¨æµè§ˆå™¨ç«¯è¿è¡Œï¼ŒnodeJsè®©jsç›´æ¥åœ¨æœåŠ¡å™¨è¿è¡Œï¼Œ Ryan Dahlåœ¨2009å¹´2æœˆå¼€å§‹ç€æ‰‹ç¼–å†™Node.jsï¼Œæœ€åˆæ˜¯æ‰“ç®—å†™ä¸€ä¸ªåä¸ºWeb.jsçš„æœåŠ¡å™¨ï¼Œåæ¥è¶Šå†™è¶Šå¤§ï¼Œå½¢æˆä¸€ä¸ªå¯ä»¥æ‰©å……çš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ”¹åä¸ºNode.jsï¼Œæ„æŒ‡åƒnodeä¸€æ ·å¯ä»¥ä¸æ–­æ‰©å……ã€‚ å•çº¿ç¨‹æ˜¯NodeJsçš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œå› ä¸ºå®ƒå³å¸¦æ¥äº†ä½“é‡å°ã€é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ï¼Œä¹Ÿå­˜åœ¨å¹¶å‘é‡å°çš„ç¼ºç‚¹ nodeæ‰§è¡Œjsæ–‡ä»¶Hello Node.Js!"},{"title":"æ¨¡å—åŒ–","path":"/wiki/Node/beginner_02_model.html","content":"æ¨¡å—åŒ–ç®€ä»‹Nodeä¸­ï¼Œä¸€ä¸ªjsæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚ require nodeä½¿ç”¨requireå¼•å…¥å¤–éƒ¨æ¨¡å—ï¼Œæ³¨æ„ï¼šå¦‚æœè¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¿…é¡»ä»¥.æˆ–..å¼€å¤´requireå¼•å…¥æ¨¡å—ä¹‹åä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºçš„æ˜¯å¼•å…¥çš„æ¨¡å—ã€‚ requireå¼•å…¥ è¿è¡Œå‘½ä»¤node helloNode.jsè¿è¡Œç»“æœmodule Ahello nodehelloNode.jsrequire(./module);console.log(hello node);module.jsconsole.log(module A); exportsæš´éœ²å˜é‡ Nodeä¸­ï¼Œæ¯ä¸ªjsæ–‡ä»¶ä¸­çš„jsä»£ç å®é™…ä¸Šéƒ½ç›¸å½“äºè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¹‹ä¸­ã€‚(function() // å‡½æ•°ä½“)()å¯ä»¥é€šè¿‡exportsæ¥å‘å¤–æš´éœ²å˜é‡ã€‚exports.variableName exportsæ¡ˆä¾‹ helloNode.jslet module_prop = require(./module);console.log(module_prop.a,module_prop.b);module_prop.fun(10,5);module.jsexports.a = 123;exports.b= abc;exports.fun = function(num1,num2) console.log(num1+num2);node helloNode.jsè¿è¡Œç»“æœï¼š123 abc15 æ¨¡å—åŒ–è¯¦è§£æ¨¡å—æ ‡è¯† ä½¿ç”¨requireå¼•å…¥æ¨¡å—çš„æ—¶å€™ï¼Œä½¿ç”¨çš„å°±æ˜¯æ¨¡å—æ ‡è¯†ï¼Œæ¨¡å—æ ‡è¯†èƒ½ç”¨æ¥æ‰¾åˆ°æŒ‡å®šæ¨¡å—ã€‚æ¨¡å—æ ‡è¯†åˆ†ä¸ºä¸¤å¤§ç±»ï¼š æ ¸å¿ƒæ¨¡å—ç”±nodeå¼•æ“æä¾›çš„æ¨¡å—æ ¸å¿ƒæ¨¡å—çš„è¡¨ç¤ºå°±æ˜¯æ¨¡å—ålet fs = require(fs)æ–‡ä»¶æ¨¡å—ç”±ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ¨¡å—æ–‡ä»¶æ¨¡å—çš„æ ‡è¯†å°±æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ã€ç›¸å¯¹è·¯å¾„ï¼‰let math = require(./math) å…¨å±€å¯¹è±¡global nodeä¸­æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡globalï¼Œä½œç”¨å’Œwindowç±»ä¼¼ï¼Œå…¨å±€ä¸­åˆ›å»ºçš„å˜é‡å’Œå‡½æ•°éƒ½ä¼šä½œä¸ºglobalçš„æ–¹æ³•å’Œå±æ€§ä¿å­˜ã€‚ä¸ä½¿ç”¨letvarå®šä¹‰çš„å˜é‡å³å…¨å±€å˜é‡ï¼šlet a = 10;global_a = 100;console.log(global.a); //undefinedconsole.log(global.global_a); //100 nodeå¯¹æ¨¡å—çš„å‡½æ•°åŒ–åŒ…è£… å¦‚ä½•ç¡®å®šæˆ‘ä»¬è°ƒç”¨çš„jsæ–‡ä»¶å®é™…ä¸Šæ˜¯å‡½æ•°å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨jsä¸­å‡½æ•°ç‹¬æœ‰çš„arguments.calleeå±æ€§ï¼Œè¿™ä¸ªå±æ€§æè¿°çš„æ˜¯æ­£åœ¨è°ƒç”¨çš„å‡½æ•°ä½“æ‰§è¡Œä»£ç let a = 10;console.log(arguments.callee + );è¾“å‡ºç»“æœfunction(exports, require, module, __filename, __dirname) let a = 10; console.log(arguments.callee + );nodeæ¨¡å—åŒ–æ­£æ˜¯å¯¹æ¯ä¸ªjsæ¨¡å—æ–‡ä»¶ä¸­çš„æ‰§è¡Œä»£ç è¿›è¡Œå‡½æ•°åŒ…è£…æ“ä½œï¼šfunction(exports, require, module, __filename, __dirname) // æˆ‘ä»¬è‡ªå·±çš„jsä»£ç åƒå¥¥åˆ©å¥¥å¤¹å¿ƒä¸€æ ·è¢«å¤¹åœ¨è¿™é‡Œè¿™åŒæ˜¯ä¹Ÿè§£é‡Šäº†æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„exportså’Œrequireçš„æ¥æºï¼Œå®ƒä»¬éƒ½æ˜¯è¢«åŒ…è£…çš„å‡½æ•°ä¼ è¿›æ¥çš„å‚æ•°ã€‚exportsç”¨äºå°†å˜é‡æˆ–å‡½æ•°æš´éœ²åˆ°å¤–éƒ¨requireå‡½æ•°ï¼Œç”¨äºå¼•å…¥å¤–éƒ¨æ¨¡å—requireå‡½æ•°ä»£ç [Function: require] resolve: [Function: resolve] paths: [Function: paths] , main: Module id: ., path: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module, exports: , filename: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\\\main.js, loaded: false, children: [], paths: [ D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\ ode_modules, D:\\\\CS_Demo\\ ode_modules, D:\\ ode_modules ] , extensions: [Object: null prototype] .js: [Function (anonymous)], .json: [Function (anonymous)], .node: [Function (anonymous)] , cache: [Object: null prototype] D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\\\main.js: Module id: ., path: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module, exports: , filename: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\\\main.js, loaded: false, children: [], paths: [Array] moduleä»£è¡¨å½“å‰æ¨¡å—è‡ªèº«exportså°±æ˜¯moduleçš„å±æ€§ï¼Œç”¨exportså’Œmodule.exportsæœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«console.log(Object.is(module.exports,exports)); //truemoduleå¯¹è±¡æºç Module id: ., path: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module, exports: , filename: D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\\\main.js, loaded: false, children: [], paths: [ D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\day2_module\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\ ode_modules, D:\\\\CS_Demo\\ ode_modules, D:\\ ode_modules ] __filenameå½“å‰æ¨¡å—çš„å®Œæ•´è·¯å¾„__dirnameå½“å‰æ¨¡å—æ‰€åœ¨æ–‡ä»¶å¤¹çš„å®Œæ•´è·¯å¾„ module.exportså’Œexportsçš„åŒºåˆ« å¯¹äºæš´éœ²å•ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½¿ç”¨module.exportså’Œexportséƒ½æ˜¯ä¸€æ ·çš„ï¼šmath.jsexports.pi = 3.14;module.exports.sin90 = 1;exports.add = function(num1,num2) return num1+num2;module.exports.multiply = function(num1,num2) return num1*num2;main.jslet math = require(./math);console.log(math.pi); //3.14console.log(math.sin90); //1console.log(math.add(10,5)); //15console.log(math.multiply(2,4)); //8ä½†æ˜¯å¦‚æœå°†éœ€è¦å°†å¯¹è±¡å’Œæ–¹æ³•åŒ…è£…æˆç±»æš´éœ²çš„è¯ï¼Œé€šè¿‡module.exportså¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œè€Œç›´æ¥ä¿®æ”¹exportsç›¸å½“äºä¿®æ”¹exportsçš„æŒ‡å‘ï¼Œåˆ‡æ–­äº†å®ƒå’Œmoduleä¹‹é—´çš„æŒ‡å‘å…³ç³»ã€‚module.exports = pi:3.14, sin90:1, add:function(num1,num2) return num1+num2; , multiply:function(num1,num2) return num1*num2;"},{"title":"NPM","path":"/wiki/Node/beginner_04_npm.html","content":"npmç®€ä»‹NPMï¼ŒCommonJSï¼ŒNodeJS CommonJSåŒ…è§„èŒƒæ˜¯ ç†è®ºNPMæ˜¯å…¶ä¸­ä¸€ç§ å®è·µå°±åƒ ç²¾ç¥åˆ†æ å’Œ å‚¬çœ  çš„å…³ç³»ä¸€æ ·N NodeP PackageM MangaerNodeä¸npmä¹‹é—´çš„å…³ç³»npmå¸®åŠ©Nodeå®Œæˆäº†ç¬¬ä¸‰æ–¹æ¨¡å—çš„å‘å¸ƒã€å®‰è£…ã€ä¾èµ–ç­‰Nodeä¸ç¬¬ä¸‰æ–¹æ¨¡å—ä¹‹é—´å½¢æˆäº†ä¸€ä¸ªå¾ˆå¥½çš„ç”Ÿæ€ç³»ç»Ÿ npmå‘½ä»¤ npm -væŸ¥çœ‹ç‰ˆæœ¬npmå¸®åŠ©è¯´æ˜npm search åŒ…åæœç´¢æ¨¡å—åŒ…npm install åŒ…ånpm i åŒ…ååœ¨å½“å‰ç›®å½•å®‰è£…åŒ…npm installä¸‹è½½å½“å‰é¡¹ç›®ä¾èµ–çš„åŒ…npm install åŒ…å -gå…¨å±€æ¨¡å¼å®‰è£…åŒ…ä¸€èˆ¬ç”¨æ¥å®‰è£…ä¸€äº›è®¡ç®—æœºå·¥å…·npm install åŒ…å â€“saveå®‰è£…åŒ…å¹¶æ·»åŠ åˆ°ä¾èµ–ä¸­npm initåˆ›å»ºä¸€ä¸ªpackage.jsonnpm remove åŒ…ånpm r åŒ…ååˆ é™¤ä¸€ä¸ªæ¨¡å—npm install æ–‡ä»¶è·¯å¾„ä»æœ¬åœ°å®‰è£…npm install åŒ…å -registryåœ°å€ä»é•œåƒæºå®‰è£…npm config set registry åœ°å€è®¾ç½®é•œåƒæº é…ç½®cnpmcnpmé•œåƒç½‘ç«™https://npmmirror.com/ npm install -g cnpm â€“registryhttps://registry.npmmirror.com æ³¨æ„ï¼š cnpmä¸‹è½½ä¸‹æ¥çš„ç‰ˆæœ¬å’Œå®˜æ–¹ç‰ˆæœ¬å¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œä¼šåœ¨åŸæœ¬åŒ…åä¹‹å‰åŠ ä¸‹åˆ’çº¿å‰ç¼€ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è¦†ç›–åŸç‰ˆæœ¬ nodeæœç´¢åŒ…æµç¨‹ é¦–å…ˆåœ¨å½“å‰ç›®å½•çš„node_modulesä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°åˆ™ç›´æ¥ä½¿ç”¨ å¦‚æœæ ¹ç›®å½•æ²¡æ‰¾åˆ°ï¼Œåˆ™å»ä¸Šä¸€çº§ç›®å½•çš„node_modulesä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°åˆ™ç›´æ¥ä½¿ç”¨ å¦‚æœä¸Šä¸€çº§è¿˜æ²¡æ‰¾åˆ°ï¼Œå†ä¸Šä¸€çº§ç›®å½•å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ ç›´åˆ°æ‰¾åˆ°ç£ç›˜çš„æ ¹ç›®å½•ï¼Œè¿™æ—¶å¦‚æœä¾ç„¶æ²¡æœ‰ï¼Œåˆ™æŠ¥é”™"},{"title":"Bufferç¼“å†²åŒº","path":"/wiki/Node/beginner_05_buffer.html","content":"Bufferç®€ä»‹å®˜ç½‘æ–‡æ¡£å¯¹äºBufferçš„ä»‹ç»http://nodejs.p2hp.com/api/v19/buffer/ ä¸­æ–‡æ–‡æ¡£https://nodejs.cn/api/buffer.html Bufferå’Œæ•°ç»„çš„åŒºåˆ« Bufferç»“æ„å’Œ æ•°ç»„ å¾ˆåƒï¼Œæ“ä½œæ–¹æ³•ä¹Ÿå’Œæ•°ç»„ç±»ä¼¼æ•°ç»„ä¸­ä¸èƒ½å­˜å‚¨ äºŒè¿›åˆ¶æ–‡ä»¶ ï¼Œbufferå°±æ˜¯ä¸“é—¨ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®çš„lengthå±æ€§æ„ä¹‰ä¸åŒArrayInstance.lengthè¡¨ç¤ºæ•°ç»„é•¿åº¦BufferInstance.lengthè¡¨ç¤ºbufferå ç”¨å†…å­˜çš„é•¿åº¦ Bufferçš„å…ƒç´  ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥é€šè¿‡Bufferæ¥ åˆ›å»ºå†…å­˜ä¸­çš„ç©ºé—´ ï¼ŸBufferçš„å…ƒç´ æ˜¯ 16è¿›åˆ¶çš„ä¸¤ä½æ•°ï¼ˆåå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºçš„äºŒè¿›åˆ¶æ•°ï¼‰Bufferå…ƒç´ èŒƒå›´åœ¨ 00-ffä¹‹é—´å®é™…ä¸Šä¸€ä¸ªå…ƒç´ å°±è¡¨ç¤º å†…å­˜ä¸­çš„ä¸€ä¸ªå­—èŠ‚å®é™…ä¸ŠBufferä¸­çš„å†…å­˜ä¸æ˜¯é€šè¿‡JavaScriptåˆ†é…çš„ï¼Œè€Œæ˜¯åœ¨åº•å±‚ é€šè¿‡C++ç”³è¯·çš„ Bufferå…ƒç´ æ‰“å°Buffer let str = Hello World;let buf = Buffer.from(str);console.log(Buffer source data: )console.log(buf) // Uniform Codeconsole.log(Buffer content: + buf)console.log(Buffer length: + buf.length);è¿è¡Œç»“æœBuffer source data: Buffer 48 65 6c 6c 6f 20 57 6f 72 6c 64 Buffer content: Hello WorldBuffer length: 11 å…³äºlength ArrayInstance.lengthè¡¨ç¤ºæ•°ç»„é•¿åº¦BufferInstance.lengthè¡¨ç¤ºbufferå ç”¨å†…å­˜çš„é•¿åº¦let str = Hello ä¸–ç•Œ;let buf = Buffer.from(str);console.log(Buffer source data: )console.log(buf) // Uniform Codeconsole.log(Buffer content: + buf)console.log(Buffer length: + buf.length);console.log(str length: + str.length);è¿è¡Œç»“æœBuffer source data: Buffer 48 65 6c 6c 6f 20 e4 b8 96 e7 95 8c Buffer content: Hello ä¸–ç•ŒBuffer length: 12str length: 8 Bufferæ“ä½œåˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„buffer let buf = new Buffer(10);console.log(buf.length)è¿è¡Œç»“æœ10(node:13100) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.(Use `node --trace-deprecation ...` to show where the warning was created)å¦‚ä¸Šæ‰€ç¤ºï¼ŒBufferçš„æ„é€ å‡½æ•°éƒ½æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œå¯ä»¥ä½¿ç”¨ Buffer.alloc() æ¥åˆ›å»ºbufferå¯¹è±¡ï¼šlet buf = Buffer.alloc(10);console.log(buf.length)console.log(buf);è¿è¡Œç»“æœBuffer 00 00 00 00 00 00 00 00 00 00 Bufferå…ƒç´ å†™å…¥ Bufferå…ƒç´ é€šè¿‡ ç´¢å¼•æ“ä½œ Bufferçš„é•¿åº¦ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºBufferå®é™…ä¸Šæ˜¯å¯¹å†…å­˜ç©ºé—´çš„ç›´æ¥æ“ä½œå†™å…¥äºŒè¿›åˆ¶æ•°å€¼çš„ä½æ•°è¶…è¿‡8ä½ï¼Œè¶…å‡ºä½æ•°è¢«å¿½ç•¥æŒ‰ç´¢å¼•è¯»å–bufferå…ƒç´ æ—¶ï¼Œä¼šé»˜è®¤å°†äºŒè¿›åˆ¶æ•°è½¬åŒ–ä¸º10è¿›åˆ¶æ•°ã€‚let buf = Buffer.alloc(10);buf[0] = 88;buf[1] = 255;buf[2] = 0xaa;buf[3] = 0xabc;buf[4] = -1;buf[10] = 10;console.log(buf)console.log(buf[2]);è¿è¡Œç»“æœBuffer 58 ff aa bc ff 00 00 00 00 00 Buffer.allocUnsafe Buffer.allocUnsafe(size)åˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„bufferï¼Œbufferä¸­å¯èƒ½å«æœ‰æ•æ„Ÿæ•°æ®ï¼ˆä¸Šä¸€æ¬¡è¯¥å†…å­˜ç©ºé—´ä½¿ç”¨ç•™ä¸‹çš„æ•°æ®ï¼‰ï¼Œè€ŒBuffer.allocä¼šå¯¹æŒ‡å®šçš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç©ºæ“ä½œï¼Œä»æ€§èƒ½ä¸Šæ¥çœ‹ï¼ŒallocUnsafeå› ä¸ºæ— éœ€è¿›è¡Œæ¸…ç©ºï¼Œå› æ­¤æ€§èƒ½æ›´å¥½ã€‚ Buffer.from(str) ç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºBufferlet buf = Buffer.from(Hello World);console.log(buf)console.log(buf+)è¿è¡Œç»“æœBuffer 48 65 6c 6c 6f 20 57 6f 72 6c 64Hello World"},{"title":"åŒ…ç®¡ç†","path":"/wiki/Node/beginner_03_package.html","content":"åŒ…è§„èŒƒCommonJSçš„åŒ…è§„èŒƒç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ åŒ…ç»“æ„ ç”¨äºç»„ç»‡åŒ…ä¸­çš„å„ç§æ–‡ä»¶ åŒ…å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œè§£å‹ä¹‹åè§„èŒƒçš„ç›®å½•åº”è¯¥åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š package.json æè¿°æ–‡ä»¶ bin å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ ä¸€èˆ¬ç”¨äºç¼–è¯‘å·¥å…·çš„é…ç½® lib jsä»£ç  doc æ–‡æ¡£ test å•å…ƒæµ‹è¯• åŒ…æè¿°æ–‡ä»¶ æè¿°åŒ…çš„ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾›å¤–éƒ¨è¯»å–åˆ†æ package.jsonåŒ…æè¿°æ–‡ä»¶ package.json ç”¨äºè¡¨è¾¾éä»£ç ç›¸å…³çš„ä¿¡æ¯ï¼Œ ä½äºåŒ…çš„ æ ¹ç›®å½•ä¸‹ã€‚jsonæ–‡ä»¶é‡Œä¸èƒ½å†™æ³¨é‡Špackage.jsonä¸­çš„å­—æ®µ key description name åå­— description æè¿° version ç‰ˆæœ¬ keywords å…³é”®å­— maintainers ä¸»è¦è´¡çŒ®è€… contributors è´¡çŒ®è€… bugs åœ°å€ licenses åè®® repositories ä»“åº“ dependencies ä¾èµ– homepage ä¸»é¡µ os ç³»ç»Ÿ cpu cpu engine å¼•æ“ builtin æ„å»ºå·¥å…· directories implements scripts author bin main devDependencies"},{"title":"æ–‡ä»¶è¯»å–","path":"/wiki/Node/beginner_07_read.html","content":"ç®€å•æ–‡ä»¶è¯»å– readFile(path[, options], callback) callbackå‚æ•° err é”™è¯¯ data Bufferç±»å‹ readFileSync(path[, options]) å®Œæ•´æµç¨‹ const fs = require(fs);fs.readFile(hello.txt, function (err, data) if (!err) console.log(data.toString()); fs.writeFile(hello_copy.txt, data, function (err) if (!err) console.log(copy success) ) ) æµå¼æ–‡ä»¶è¯»å– å¦‚æœè¦è¯»å–ä¸€ä¸ªå¯è¯»æµä¸­çš„æ•°æ®ï¼Œå¿…é¡»è¦ä¸ºå¯è¯»æµç»‘å®šä¸€ä¸ªdataäº‹ä»¶ï¼Œdataäº‹ä»¶ç»‘å®šå®Œæ¯•ï¼Œå°±ä¼šè‡ªåŠ¨å¼€å§‹è¯»å–æ•°æ® rs.on(data, function (data) console.log(data + );) ä½¿ç”¨pipeå¿«é€Ÿcopyæµå¼æ–‡ä»¶ let fs = require(fs);let rs = fs.createReadStream(hello.txt);let ws = fs.createWriteStream(hello_copy_stream.txt);rs.once(open, function () console.log(rs open);)rs.once(close, function () console.log(rs close);)ws.once(open, function () console.log(ws open);)ws.once(close, function () console.log(ws close);)rs.pipe(ws);"},{"title":"æ–‡ä»¶å†™å…¥","path":"/wiki/Node/beginner_06_write.html","content":"fsæ–‡ä»¶ç³»ç»ŸNodeä¸­æ–‡å®˜ç½‘å¯¹fsçš„ä»‹ç»https://nodejs.cn/api/fs.html æ–‡ä»¶ç³»ç»Ÿæ ‡å¿—https://nodejs.cn/api/fs.html#file-system-flags File System Nodeä¸­ï¼Œä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’éå¸¸é‡è¦ï¼Œ æœåŠ¡ç«¯çš„æœ¬è´¨å°±æ˜¯å°†æœ¬åœ°æ–‡ä»¶å‘ç»™è¿œç¨‹å®¢æˆ·ç«¯ã€‚æ–‡ä»¶ç³»ç»Ÿç®€å•è¯´å°±æ˜¯ä½¿ç”¨nodeå¯¹ç³»ç»Ÿä¸­æ–‡ä»¶è¿›è¡Œæ“ä½œNodeé€šè¿‡fsæ¨¡å—å’Œæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’fsæ¨¡å—æä¾›äº†ä¸€äº›æ ‡å‡†æ–‡ä»¶è®¿é—®APIæ¥æ‰“å¼€ã€è¯»å–ã€å†™å…¥æ–‡ä»¶ï¼Œä»¥åŠä¸å…¶äº¤äº’è¦ä½¿ç”¨fsæ¨¡å—ï¼Œéœ€è¦å…ˆå¯¹å…¶è¿›è¡ŒåŠ è½½ï¼šconst fs require(â€œfsâ€); åŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨ fsæ¨¡å—æ‰€æœ‰æ“ä½œéƒ½æœ‰ä¸¤ç§å½¢å¼å¯ä¾›é€‰æ‹©ï¼šåŒæ­¥fs ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œå¼‚æ­¥fsä¸ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œé€šè¿‡callbackå›è°ƒå‡½æ•°è¿”å›ç»“æœ åŒæ­¥æ–‡ä»¶å†™å…¥ å®Œæ•´æ­¥éª¤ const fs = require(fs);// 1. æ‰“å¼€æ–‡ä»¶let result = fs.openSync(hello.txt, w);console.log(result); //3// 2. å†™å…¥æ–‡ä»¶fs.writeSync(result, Hello world!)// 3. å…³é—­æ–‡ä»¶fs.closeSync(result); openSync æ­¥éª¤1 æ‰“å¼€æ–‡ä»¶fs.openSync(path, flags[, mode])path è¦æ‰“å¼€æ–‡ä»¶çš„è·¯å¾„flags æ‰“å¼€æ–‡ä»¶è¦åšçš„æ“ä½œç±»å‹r åªè¯»w å¯å†™mode è®¾ç½®æ–‡ä»¶çš„æ“ä½œæƒé™ï¼Œä¸€èˆ¬ä¸ä¼ è¿”å›å€¼è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦ä½œä¸ºç»“æœï¼Œå¯ä»¥é€šè¿‡è¯¥æè¿°ç¬¦å¯¹æ–‡ä»¶è¿›è¡Œå„ç§æ“ä½œæ­¥éª¤2 å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹ fs.wraiteSync(fd, string[, position[, encoding]])fd æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œéœ€è¦ä¼ é€’è¦å†™å…¥çš„æ–‡ä»¶çš„æè¿°ç¬¦string è¦å†™å…¥çš„å†…å®¹position å†™å…¥çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤æ˜¯0ï¼Œä¸€èˆ¬ä¸ä¼ encoding ç¼–ç æ ¼å¼ï¼Œé»˜è®¤æ˜¯UTF-8ï¼Œä¸€èˆ¬ä¸ä¼ æ­¥éª¤3 ä¿å­˜å¹¶å…³é—­æ–‡ä»¶fs.closeSync(fd)fd è¦å…³é—­æ–‡ä»¶çš„æè¿°ç¬¦ writeSyncçš„positionå‚æ•° ä¸ä¼ positionï¼Œé»˜è®¤ä¸º0fs.syncWrite( file, Hello World!);è¿è¡Œç»“æœæŒ‡å®špositionï¼Œç›¸å½“äºåœ¨æŒ‡å®šåç§»ä½ç½®è¿›è¡Œå†™å…¥æ“ä½œfs.syncWrite( file, Hello World! ,20);è¿è¡Œç»“æœ å¼‚æ­¥æ–‡ä»¶å†™å…¥write open(path, flags[, mode], callback)å¼‚æ­¥è°ƒç”¨çš„æ–¹æ³•ç»“æœéƒ½æ˜¯é€šè¿‡å›è°ƒå‡½æ•°callbackçš„å‚æ•°è¿”å›çš„ï¼Œfs.open(hello.txt, w, function () console.log(arguments);)[Arguments] { â€˜0â€™: null, â€˜1â€™: 3 }è¿™é‡Œcallbackçš„ä¸¤ä¸ªå‚æ•°ï¼šerr é”™è¯¯å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯åˆ™ä¸ºnullfd æ–‡ä»¶çš„æè¿°ç¬¦å®Œæ•´æµç¨‹const fs = require(fs);// 1 æ‰“å¼€æ–‡ä»¶fs.open(hello.txt, w, function (err, fd) if (!err) console.log(fd); // 2 å†™å…¥æ–‡ä»¶ fs.write(fd, Hello World!, function (err) if (!err) // 3 å…³é—­æ–‡ä»¶ fs.close(fd, function (err) if (!err) console.log(file closed) ); ); else console.log(err); ) ç®€å•æ–‡ä»¶å†™å…¥åŒæ­¥-ç®€å•æ–‡ä»¶å†™å…¥ fs.writeFile(file, data[, options], callback)file è¦æ“ä½œæ–‡ä»¶è·¯å¾„data è¦å†™å…¥çš„æ•°æ®options é€‰é¡¹ï¼ŒObjectStringï¼Œå¯ä»¥å¯¹å†™å…¥è¿›è¡Œä¸€äº›è®¾ç½®encodingmodeflag é»˜è®¤wcallback å½“å†™å…¥å®Œæˆä»¥åæ‰§è¡Œçš„å‡½æ•°å®Œæ•´æµç¨‹const fs = require(fs);fs.writeFile( hello.txt, wraiteFile_Hello!, function (err) if (!err) console.log(write success); ); å¼‚æ­¥-ç®€å•æ–‡ä»¶å†™å…¥ fs.writeFileSync(file, data[, options]) æµå¼æ–‡ä»¶å†™å…¥åŒæ­¥ã€å¼‚æ­¥ã€ç®€å•æ–‡ä»¶å†™å…¥éƒ½ä¸é€‚åˆ å¤§æ–‡ä»¶ å†™å…¥ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡º. fs.createWriteStream(path[, options]) è¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯å†™æµpath æ–‡ä»¶è·¯å¾„options é…ç½®å‚æ•° ç›‘å¬æµ å¯ä»¥é€šè¿‡openå’Œcloseäº‹ä»¶æ¥ç›‘å¬æµçš„æ‰“å¼€å’Œå…³é—­ï¼Œå› ä¸ºwsçš„æ‰“å¼€å’Œå…³é—­æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œå› æ­¤ç”¨onceç»‘å®šæ›´å¥½æ›´å¤šæœ‰å…³äº‹ä»¶ç»‘å®šçš„æ–‡æ¡£ä»‹ç»https://nodejs.cn/api/events.html#class-eventemitterws.once(open, function () console.log(Stream Open);)ws.once(close, function () console.log(Stream close)) å®Œæ•´æµç¨‹ const fs = require(fs);//åˆ›å»ºä¸€ä¸ªå¯å†™æµlet ws = fs.createWriteStream(hello.txt);// é€šè¿‡å¯å†™æµå‘æ–‡ä»¶è¾“å‡ºå†…å®¹ws.write(stream_write );ws.write(1 Hello!!! );ws.write(2 Hello!!! );ws.write(3 Hello!!! );ws.once(open, function () console.log(Stream Open);)ws.once(close, function () console.log(Stream close))ws.end();"},{"title":"fså…¶ä»–æ–¹æ³•","path":"/wiki/Node/beginner_08_fs.html","content":"å•ä¸ªæ–‡ä»¶æ“çºµéªŒè¯è·¯å¾„æ˜¯å¦å­˜åœ¨ let isExits = fs.existsSync(hello.txt);console.log(isExits) //truefs.exists(path, callback)å·²ç»åˆ é™¤çš„æ–¹æ³•ï¼Œå› ä¸ºéªŒè¯åŠŸèƒ½ä¸€èˆ¬éœ€è¦ç«‹å³è·å–åˆ°ç»“æœï¼Œæ— éœ€å¼•å…¥å¼‚æ­¥fs.existesSync(path) è·å–æ–‡ä»¶ä¿¡æ¯ fs.stat(hello.txt, function (err,stats) console.log(stats);)è¿è¡Œç»“æœStats dev: 3932212942, mode: 33206, nlink: 1, uid: 0, gid: 0, rdev: 0, blksize: 4096, ino: 5910974511137847, size: 46, blocks: 0, atimeMs: 1679821361534.1057, mtimeMs: 1679821361534.1057, ctimeMs: 1679821361534.1057, birthtimeMs: 1679818224344.4, atime: 2023-03-26T09:02:41.534Z, mtime: 2023-03-26T09:02:41.534Z, ctime: 2023-03-26T09:02:41.534Z, birthtime: 2023-03-26T08:10:24.344Zfs.stat(path, callback)è·å–æ–‡ä»¶çš„çŠ¶æ€è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¿å­˜äº†å½“å‰å¯¹è±¡çŠ¶æ€çš„ç›¸å…³ä¿¡æ¯fs.statSync(path) åˆ é™¤æ–‡ä»¶ fs.unlinkSync(./hello_copy_stream.txt);fs.unlink(path, callback)fs.unlinkSync(path) æˆªæ–­æ–‡ä»¶ å°†æ–‡ä»¶æˆªæ–­ä¸ºæŒ‡å®šå¤§å°fs.truncateSync(hello_copy.txt, 4);fs.truncate(path, len,callback)fs.truncateSync(path, len) ç›‘è§†æ–‡ä»¶æ›´æ”¹å†™å…¥ fs.watchFile(hello.txt, function () console.log(hello.txt change))fs.watchFile(filename[, options], listener)optionsinterval é—´éš”ï¼Œé»˜è®¤5000mslistenerå‚æ•°curr statå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ–‡ä»¶çš„çŠ¶æ€prev statå¯¹è±¡ï¼Œè¡¨ç¤ºä¿®æ”¹å‰æ–‡ä»¶çš„çŠ¶æ€ ç›®å½•æ“ä½œåˆ—å‡ºç›®å½• fs.readdir(., function (err, data) console.log(data);)è¿è¡Œç»“æœ[ asynch_write.js, hello.txt, hello_copy.txt, main.js, other_func.js, read.js, simple_write.js, stream_read.js, stream_write.js ]fs.readdir(path[, options], callback)callbackerrfiles æ•°ç»„ å…ƒç´ ä¸ºç›®å½•ä¸­æ–‡ä»¶åfs.readdirSync(path[, options]) å»ºç«‹ç›®å½• fs.mkdirSync(hello);fs.mkdir(path[, mode], callback)fs.mkdirSync(path[, mode]) åˆ é™¤ç›®å½• fs.rmdirSync(hello);fs.rmdir(path, callback)fs.rmdirSync(path) é‡å‘½åæ–‡ä»¶å’Œç›®å½• fs.renameSync(hello_copy.txt,hello2.txt)renameè¿˜èƒ½é€šè¿‡ç»å¯¹è·¯å¾„å®ç°æ–‡ä»¶çš„å‰ªåˆ‡åŠŸèƒ½fs.renameSync(hello_copy.txt,D:\\\\hello2.txt)fs.rename(oldPath, newPath, callback)fs.renameSync(oldPath, newPath)"},{"title":"2-åˆ›å»ºæ•°æ®åº“","path":"/wiki/Node/clwy_02_db.html","content":"CURD CreateUpdateReadDelete åˆ›å»ºæ•°æ®åº“åˆ›å»ºæ•°æ®åº“ å¸¸ç”¨æ•°æ®åº“æ•°æ®ç±»å‹ï¼š å¸¸è§SQLè¯­å¥SQL Mysqlæ•™ç¨‹-- æ’å…¥è¯­å¥ï¼šINSERT INTO è¡¨å (åˆ—1, ...) VALUES (å€¼1, ...);-- å¤šè¡Œæ’å…¥ï¼šINSERT INTO è¡¨å (åˆ—1, ...) VALUES (å€¼1, ...),(å€¼1, ...)...;-- ä¿®æ”¹è¯­å¥ï¼šUPDATE è¡¨å SET åˆ—1=å€¼1, åˆ—2=å€¼2, ... WHERE æ¡ä»¶;-- åˆ é™¤è¯­å¥ï¼šDELETE FROM è¡¨å WHERE æ¡ä»¶;-- æŸ¥è¯¢è¯­å¥ï¼šSELECT * FROM è¡¨å;-- æ¡ä»¶æŸ¥è¯¢ï¼šSELECT * FROM è¡¨å WHERE æ¡ä»¶;-- æ’åºæŸ¥è¯¢ï¼šSELECT * FROM `Articles` WHERE `id`2 ORDER BY `id` DESC;"},{"title":"3-Sequelize","path":"/wiki/Node/clwy_03_Sequelize.html","content":"Sequelize ORMSequelize ORM å®‰è£…sequelizeå‘½ä»¤è¡Œå·¥å…·ï¼šnpm i -g sequelize-cliå®‰è£…å½“å‰é¡¹ç›®çš„sequelizeã€mysql2åŒ…ï¼šnpm i sequelize mysql2åˆå§‹åŒ–é¡¹ç›®ï¼šsequelize initå¯ä»¥çœ‹åˆ°é¡¹ç›®ç›®å½•ä¸‹å¤šå‡ºäº†ä¸€äº›æ–‡ä»¶å¤¹ï¼šconfigmigrationsmodelsseeders é…ç½®config.jsconfig.js æ³¨æ„ä¿®æ”¹timezoneæ—¶åŒº development: username: root, password: your-password, database: your-db-development, host: 127.0.0.1, dialect: mysql, timezone: +08:00 , test: username: root, password: null, database: your-dbe-duck-home-test, host: 127.0.0.1, dialect: mysql, timezone: +08:00 , production: username: root, password: null, database: your-db-production, host: 127.0.0.1, dialect: mysql, timezone: +08:00 åˆ›å»ºæ¨¡å‹å‘½åè§„åˆ™ æ¨¡å‹åä¸ºå•æ•°ï¼šArticleè¡¨åä¸ºå¤æ•°ï¼šArticles sequelizeåˆ›å»ºæ¨¡å‹ ä½¿ç”¨å‘½ä»¤ï¼šsequelize model:generate --name Article --attributes title:string,view:integerå‘ç°åœ¨modelså’Œmigrationsä¸­éƒ½åˆ›å»ºäº†å¯¹åº”çš„æ–‡ä»¶ï¼šmodelsweb.js æ¨¡å‹æ‰€åœ¨æ–‡ä»¶migrations20250201024243-create-web.js å»ºè¡¨è¿ç§»æ–‡ä»¶åœ¨migrationè¿ç§»æ–‡ä»¶ä¸­ï¼Œå¯¹ä¸€äº›å±æ€§æ‰‹åŠ¨è¿›è¡Œä¿®æ”¹ï¼šuse strict;/** @type import(sequelize-cli).Migration */module.exports = async up(queryInterface, Sequelize) await queryInterface.createTable(Articles, id: allowNull: false, autoIncrement: true, primaryKey: true, type: Sequelize.INTEGER.UNSIGNED , title: type: Sequelize.STRING, allowNull: false, , view: type: Sequelize.INTEGER.UNSIGNED, defaultValue: 0, // æ·»åŠ é»˜è®¤å€¼ allowNull: false, , createdAt: allowNull: false, type: Sequelize.DATE , updatedAt: allowNull: false, type: Sequelize.DATE ); , async down(queryInterface, Sequelize) // åå‘è¿ç§»æ“ä½œ await queryInterface.dropTable(Articles); ;è¿è¡Œè¿ç§»ï¼šsequelize db:migrate ç§å­æ–‡ä»¶seed å‘½ä»¤è¡Œåˆ›å»ºç§å­æ–‡ä»¶ï¼šsequelize seed:generate --name articleç¼–å†™ç§å­æ–‡ä»¶è„šæœ¬ï¼šuse strict;/** @type import(sequelize-cli).Migration */module.exports = async up (queryInterface, Sequelize) const webs = [] const counts = 50 for(let i = 1; i=counts; i++) const web = href:https://ant.design, name:`This is website $i`, webIcon:`https://api.dicebear.com/7.x/miniavs/svg?seed=$i`, webCover:https://gw.alipayobjects.com/zos/rmsportal/mqaQswcyDLcXyDKnZfES.png, content:ä¸€ä¸ªä½¿ç”¨reactã€antdæ­å»ºçš„ç½‘ç«™ï¼Œåå°ä½¿ç”¨nodejsæ­å»ºï¼Œç”¨æ¥ä½œä¸ºä¸€ä¸ªå¯¼èˆªç«™ç‚¹ï¼Œåç»­è¿˜ä¼šç»§ç»­å®Œå–„, categoryId: 0, view:0, github:https://github.com/PUYIXIU/CoffeeShop, blogHref: https://puyixiu.github.io/, createdAt:new Date(), updatedAt:new Date(), webs.push(web) // ç§å­æ•°æ®å†™å…¥ await queryInterface.bulkInsert(Webs, webs, ); , async down (queryInterface, Sequelize) await queryInterface.bulkDelete(Webs,null, ) ;è¿è¡Œç§å­æ–‡ä»¶ï¼šsequelize db:seed --seed xxx-article æ¨¡å‹éªŒè¯è¡¨å•æ•°æ®è¡¨å•éªŒè¯ éªŒè¯å­—æ®µè¯´æ˜é€šè¿‡ä¿®æ”¹modelæ¨¡å‹ä¸­çš„å­—æ®µè§„åˆ™ï¼Œæ¥å®ç°è¡¨å•éªŒè¯ï¼šè¡¨å•ä¸­è®¿é—®å…¶å®ƒè¡¨ä½¿ç”¨ sequelize.models.XXXWeb.init( href: type:DataTypes.STRING, allowNull:false, validate: notNull:msg:ç«™ç‚¹URLå¿…é¡»å­˜åœ¨, notEmpty:msg:ç«™ç‚¹URLä¸èƒ½ä¸ºç©º, isUrl:msg:è¯·å¡«å†™æ­£ç¡®çš„URL, async isUnique(value) const web = await Web.findOne(where:name:value) if(web) throw new Error(`åç§°ä¸ºï¼š$value çš„webå·²å­˜åœ¨`) , name: type:DataTypes.STRING, allowNull:false, validate: notNull:msg:ç«™ç‚¹åç§°å¿…é¡»å­˜åœ¨, notEmpty:msg:ç«™ç‚¹åç§°ä¸èƒ½ä¸ºç©º, len: args:[2,50], msg:ç«™ç‚¹åç§°éœ€è¦åœ¨2-50ä¸ªå­—ç¬¦ä¹‹é—´ , categoryId: type:DataTypes.INTEGER, allowNull:false, validate: notNull:msg:åˆ†ç±»IDå¿…é¡»å­˜åœ¨, notEmpty:msg:åˆ†ç±»IDä¸èƒ½ä¸ºç©º, async isPresent(value) const category = await sequelize.models.Category.findByPk(value) if(!category) throw new Error(`IDä¸ºï¼š$value çš„åˆ†ç±»ä¸å­˜åœ¨`) if(category.typeId != this.typeId) throw new Error(`æ­¤åº”ç”¨ç±»å‹æ— æ³•é€‰æ‹©IDä¸ºï¼š$valueçš„åˆ†ç±»`) ,, sequelize, modelName: Web,);åŒæ—¶ï¼Œtrycatchæ•è·çš„é”™è¯¯å¤„ç†ä¹Ÿè¦è¿›è¡Œä¿®æ”¹ï¼štry //...catch(error) if (error.name === SequelizeValidationError) const errors = error.errors.map(e = e.message); res.status(400).json( status: false, message: è¯·æ±‚å‚æ•°é”™è¯¯ã€‚, errors ); else res.status(500).json( status: false, message: åˆ›å»ºç«™ç‚¹å¤±è´¥ã€‚, errors: [error.message] ); è¿ç§»ç›¸å…³migration å›æ»šä¸Šä¸€æ¬¡è¿ç§»ï¼šsequelize db:migrate:undoè¿è¡Œè¿ç§»ï¼šsequelize db:migrateæ–°å»ºè¿ç§»ï¼šsequelize migration:create --name add-avatar-to-userè¿ç§»æ–‡ä»¶ä¸­å‘æ•°æ®åº“è¡¥å……æ•°æ®ï¼šuse strict;/** @type import(sequelize-cli).Migration */module.exports = async up (queryInterface, Sequelize) await queryInterface.addColumn(Users,avatar, type:Sequelize.STRING ) , async down (queryInterface, Sequelize) await queryInterface.removeColumn(Users,avatar ) ;"},{"title":"1-å¼€å‘ç¯å¢ƒæ­å»º","path":"/wiki/Node/clwy_01_env.html","content":"æ•™ç¨‹ä»‹ç» è¯¾ç¨‹åœ°å€é•¿ä¹æœªå¤®-ç¤¾åŒº ä½¿ç”¨nvmè¿›è¡Œnodeç‰ˆæœ¬æ§åˆ¶ nvmå®‰è£…ä»‹ç» åˆ›å»ºExpressé¡¹ç›® expresså®˜ç½‘ expressè„šæ‰‹æ¶ ä½¿ç”¨è„šæ‰‹æ¶å¿«é€Ÿç”Ÿæˆexpressé¡¹ç›®ï¼šå…¨å±€å®‰è£…express-generatornpm i -g express-generator@4è„šæ‰‹æ¶åˆ›å»ºexpressé¡¹ç›®â€“no-viewè¡¨ç¤ºä¸éœ€è¦è§†å›¾æ¨¡æ¿express --no-view proj-name cd proj-nameå®‰è£…é¡¹ç›®ä¾èµ–ï¼Œå¯åŠ¨é¡¹ç›®npm i npm run startåˆ é™¤è·Ÿè·¯ç”±æ¸²æŸ“çš„htmlæ–‡ä»¶åˆ é™¤publicindex.htmlæ–‡ä»¶å¼•å…¥çƒ­æ›´æ–°å®‰è£…nodemonnpm i nodemonä¿®æ”¹package.jsonä¸­é¡¹ç›®å¯åŠ¨å‘½ä»¤ï¼š scripts: start: nodemon ./bin/www å¤„ç†è·¨åŸŸå®‰è£…corsåº“npm i corsapp.jsä¸­è¿›è¡Œé…ç½®ï¼šconst cors = require(cors)app.use(cors( origin:http://å‰ç«¯æœåŠ¡åœ°å€)) ä½¿ç”¨Dockerå®‰è£…MysqlDockeræ•™ç¨‹ docker-compose é…ç½®dockeré•œåƒï¼ˆSettingsDocker Engineï¼‰ï¼šregistry-mirrors: [ https://docker.hpcloud.cloud, https://docker.m.daocloud.io, https://docker.unsee.tech, https://docker.1panel.live, http://mirrors.ustc.edu.cn, https://docker.chenby.cn, http://mirror.azure.cn, https://dockerpull.org, https://dockerhub.icu, https://hub.rat.dev]åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºdocker-compose.ymlæ–‡ä»¶ï¼šservices: mysql: image: mysql:8.3.0 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci environment: - MYSQL_ROOT_PASSWORD=your_password - MYSQL_LOWER_CASE_TABLE_NAMES=0 ports: - 3306:3306 volumes: - ./data/mysql:/var/lib/mysqlåœ¨æ ¹ç›®å½•ç»ˆç«¯è¿è¡Œå‘½ä»¤ï¼šdocker-compose up -dåœ¨navicatä¸­ä½¿ç”¨docker-compose.ymlä¸­çš„ä¿¡æ¯æ–°å»ºè¿æ¥"},{"title":"4-å¢åˆ æ”¹æŸ¥","path":"/wiki/Node/clwy_04_rest.html","content":"æ³¨æ„ä¸‰ç§æŸ¥è¯¢å‚æ•°çš„åŒºåˆ« è·¯ç”±æ˜ å°„å‚æ•°ä»req.paramsä¸­è·å–getæ–¹æ³•ï¼Œè·¯ç”±æ‹¼æ¥å‚æ•°ä»req.queryä¸­è·å–postputæ–¹æ³•ï¼Œbodyä¸­ä¼ é€’ä»req.bodyä¸­è·å– æŸ¥è¯¢æ¥å£æŸ¥è¯¢åˆ—è¡¨ åˆ›å»ºroutesadminwebs.jsè·¯ç”±æ˜ å°„æ–‡ä»¶ï¼Œæ³¨æ„ï¼šawaitasyncå¼‚æ­¥å¤„ç†conditionæ¡ä»¶æŸ¥è¯¢order æ§åˆ¶æ’åºwhere æ¡ä»¶æŸ¥è¯¢trycatchå¼‚å¸¸æ•è·è¿”å›å€¼æ ¼å¼const express = require(express);const router = express.Router();const Op = require(sequelize);const Web = require(../../models)router.get(/,async (req,res)= try const condition = // æ·»åŠ æŸ¥è¯¢æ’åºæ¡ä»¶ï¼šæ ¹æ®idä»å¤§åˆ°å°æ’åº order:[ [id,desc] ], where: name: [Op.like]:`%$name%` const webs = await Web.findAll(condition) res.json( status:true, message:ç«™ç‚¹åˆ—è¡¨æŸ¥è¯¢æˆåŠŸ, data: webs ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:æŸ¥è¯¢ç«™ç‚¹åˆ—è¡¨å¤±è´¥ã€‚, errors:[error.message] ) )module.exports = router;åœ¨app.jsä¸­å¼•å…¥ï¼Œå¹¶è¿›è¡Œè·¯å¾„æ˜ å°„ï¼šconst adminWebsRouter = require(./routes/admin/webs)app.use(/admin/webs, adminWebsRouter);æŸ¥è¯¢http://localhost:3000/admin/webså³å¯æŸ¥è¯¢å‡ºæ•°æ® æŸ¥è¯¢è¯¦æƒ… æŸ¥è¯¢è¯¦æƒ…æ¥å£éœ€è¦æ³¨æ„ï¼šä»request.paramsä¸­è·å–idæ³¨æ„å¤„ç†idæœªæ‰¾åˆ°çš„æƒ…å†µ/** * æŸ¥è¯¢ç«™ç‚¹è¯¦æƒ… */router.get(/:id,async (req,res)= try const id = req.params; const web = await Web.findByPk(id) if(web) res.json( status:true, message:ç«™ç‚¹è¯¦æƒ…æŸ¥è¯¢æˆåŠŸ, data:web ) else res.status(404).json( status:false, message:ç«™ç‚¹ä¿¡æ¯æœªæ‰¾åˆ° ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:æŸ¥è¯¢ç«™ç‚¹è¯¦æƒ…å¤±è´¥ã€‚, errors:[error.message] ) ) æ–°å¢æ¥å£æ–°å¢ æ–°å¢æ¥å£æ³¨æ„äº‹é¡¹ï¼šåˆ›å»ºäº†æ–°çš„èµ„æºï¼Œè¿”å›çŠ¶æ€ç 201ä½¿ç”¨createåˆ›å»ºæ–°çš„æ•°æ®å¯¹req.paramsä¸­çš„æ•°æ®è¿›è¡Œç™½åå•ç­›é€‰/** * æ–°å»ºç«™ç‚¹ */router.post(/,async (req,res)= try const body = getFilterBody(req) const web = await Web.create(body) res.status(201).json( status:true, message:åˆ›å»ºç«™ç‚¹æˆåŠŸ, data:web ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:åˆ›å»ºç«™ç‚¹å¤±è´¥, errors:[error.message] ) )/** * è·å–åˆ°è¿‡æ»¤åçš„bodyå‚æ•° * @param request */function getFilterBody(req) const href, name, webIcon, webCover, content, categoryId, view, github, blogHref = req.body return href, name, webIcon, webCover, content, categoryId:Number(categoryId), view:view?Number(view):0, github, blogHref åˆ é™¤æ¥å£åˆ é™¤æ³¨æ„äº‹é¡¹ ä½¿ç”¨destroyæ–¹æ³•åˆ é™¤ä¹‹å‰å…ˆå¯»æ‰¾å¯¹åº”idæ•°æ®æ˜¯å¦å­˜åœ¨/** * åˆ é™¤ç«™ç‚¹ */router.delete(/:id,async (req,res)= try const id = req.params; const web = await Web.findByPk(id) if(web) await web.destroy() res.json( status:true, message:åˆ é™¤ç«™ç‚¹æˆåŠŸ ) else res.status(404).json( status:false, message:æœªæ‰¾åˆ°æŒ‡å®šç«™ç‚¹ ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:åˆ é™¤ç«™ç‚¹å¤±è´¥, errors:[error.message] ) ) æ›´æ–°æ¥å£æ›´æ–°æ¥å£æ³¨æ„ ä½¿ç”¨updateæ–¹æ³•è¿›è¡Œæ›´æ–°å…ˆæ ¹æ®idæŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå†è¿›è¡Œæ›´æ–°/** * æ›´æ–°ç«™ç‚¹ */router.put(/:id,async (req,res)= try const id = req.params; const web = await Web.findByPk(id) if(web) const body = getFilterBody(req) await web.update(body) res.json( status:true, message:ç«™ç‚¹æ›´æ–°æˆåŠŸ, data:web ) else res.status(404).json( status:false, message:ç«™ç‚¹æœªæ‰¾åˆ° ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:ç«™ç‚¹æ›´æ–°å¤±è´¥ã€‚, errors:[error.message] ) ) æ¨¡ç³Šæœç´¢æ¨¡ç³Šæœç´¢ æ¨¡ç³Šæœç´¢ä½¿ç”¨çš„sqlè¯­å¥ï¼šselect * from Articles where title like %æ ‡é¢˜ 10%`sequelizeä¸­ï¼Œæƒ³è¦ä½¿ç”¨æ¨¡ç³Šæœç´¢ï¼Œéœ€è¦ç”¨åˆ°Opï¼šconst Op = require(sequelize);åœ¨conditionä¸­æ·»åŠ whereå±æ€§ï¼š/** * æŸ¥è¯¢ç«™ç‚¹åˆ—è¡¨ */router.get(/,async (req,res)= try const name = req.query const condition = // æ·»åŠ æŸ¥è¯¢æ’åºæ¡ä»¶ï¼šæ ¹æ®idä»å¤§åˆ°å°æ’åº order:[ [id,desc] ] if(name) condition.where = name: [Op.like]:`%$name%` const webs = await Web.findAll(condition) // ..... catch(error) // ..... ) åˆ†é¡µæŸ¥è¯¢åˆ†é¡µæŸ¥è¯¢ åˆ†é¡µæŸ¥è¯¢çš„sqlè¯­å¥ï¼šSELECT * FROM `Articles` LIMIT offset, limit;åˆ†é¡µæŸ¥è¯¢æ³¨æ„äº‹é¡¹ï¼šæ ¹æ®currentPageå’ŒpageSizeï¼Œæ‰‹åŠ¨è®¡ç®—offsetä½¿ç”¨findAndCountæ–¹æ³•conditionæ¡ä»¶ä¸­åŠ å…¥offsetå’Œlimitå±æ€§ä»è¿”å›å€¼ä¸­æ‰‹åŠ¨æå–rowså’Œcountå€¼router.get(/,async (req,res)= try const name = req.query const currentPage = Math.abs(Number(req.query.currentPage || 1)) const pageSize = Math.abs(Number(req.query.pageSize || 10)) const offset = (currentPage - 1) * pageSize const condition = // æ·»åŠ æŸ¥è¯¢æ’åºæ¡ä»¶ï¼šæ ¹æ®idä»å¤§åˆ°å°æ’åº order:[ [id,desc] ], limit:pageSize, offset if(name) condition.where = name: [Op.like]:`%$name%` // const webs = await Web.findAll(condition) const rows, count = await Web.findAndCountAll(condition) res.json( status:true, message:ç«™ç‚¹åˆ—è¡¨æŸ¥è¯¢æˆåŠŸ, data: webs:rows, pagination: total:count, currentPage, pageSize ) catch(error) // å¼‚å¸¸å¤„ç† res.status(500).json( status:false, message:æŸ¥è¯¢ç«™ç‚¹åˆ—è¡¨å¤±è´¥ã€‚, errors:[error.message] ) )"},{"title":"5-å“åº”æ ¼å¼å°è£…","path":"/wiki/Node/clwy_05_modelize.html","content":"è‡ªå®šä¹‰é”™è¯¯ç±»error åœ¨utilserrors.jsä¸­è‡ªå®šä¹‰é”™è¯¯ç±»ï¼ˆéƒ¨åˆ†ï¼‰ï¼š/** * è‡ªå®šä¹‰ 404 é”™è¯¯ç±» * æœªæ‰¾åˆ°æŒ‡å®šèµ„æº */class NotFountError extends Error constructor(message) super(message); this.name = NotFountError; /** * è‡ªå®šä¹‰ 401é”™è¯¯ç±» * æœªç»è®¤è¯é”™è¯¯ */class UnauthorizedError extends Error constructor(message) super(message); this.name = UnauthorizedError /** * è‡ªå®šä¹‰400é”™è¯¯ * ä¼ å‚é”™è¯¯ç±» */class BadRequestError extends Error constructor(message) super(message); this.name = BadRequestError module.exports = BadRequestError, UnauthorizedError, NotFoundError æˆåŠŸå¤±è´¥å“åº”å°è£…response åœ¨utilsresponse.jsä¸­å°è£…å“åº”å‡½æ•°ï¼š/** * å“åº”æˆåŠŸ * @param res å“åº”ä½“ * @param message å“åº”ä¿¡æ¯ * @param data æ•°æ® * @param code çŠ¶æ€ç  */function success(res, message, data=, code = 200) res.status(code).json( status:true, message, data, )/** * å“åº”é”™è¯¯ * @param res å“åº”ä½“ * @param error é”™è¯¯ç±» * @returns * */function failure(res,error) if(error.name === SequelizeValidationError) const errors = error.errors.map(e=e.message) return res.status(400).json( status: false, message: è¯·æ±‚å‚æ•°é”™è¯¯, errors:errors ) if(error.name === NotFoundError) return res.status(404).json( status:false, message:èµ„æºä¸å­˜åœ¨, errors:[error.message] ) if(error.name === BadRequestError) return res.status(400).json( status:false, message:è¯·æ±‚å‚æ•°é”™è¯¯, errors:[error.message] ) if(error.name === UnauthorizedError) return res.status(401).json( status:false, message:è®¤è¯å¤±è´¥, errors:[error.message] ) if(error.name === JsonWebTokenError) return res.status(401).json( status:false, message:è®¤è¯å¤±è´¥, errors:[æ‚¨æäº¤çš„tokené”™è¯¯] ) if(error.name === TokenExpiredError) return res.status(401).json( status:false, message:è®¤è¯å¤±è´¥, errors:[æ‚¨çš„tokenå·²è¿‡æœŸ] ) res.status(500).json( status: false, message:æœåŠ¡å™¨é”™è¯¯, errors:[error.message] )module.exports = success, failure å®é™…ä½¿ç”¨å®Œæ•´çš„å¢åˆ æ”¹æŸ¥ const express = require(express);const router = express.Router();const Web = require(../../models)const Op = require(sequelize);const NotFoundError = require(../../utils/errors);const success, failure = require(../../utils/response);/** æŸ¥è¯¢ç«™ç‚¹åˆ—è¡¨ */router.get(/,async (req,res)= try const name = req.query const currentPage = Math.abs(Number(req.query.currentPage || 1)) const pageSize = Math.abs(Number(req.query.pageSize || 10)) const offset = (currentPage - 1) * pageSize const condition = order:[[id,desc]], limit:pageSize, offset if(name) condition.where = name:[Op.like]:`%$name%` const rows, count = await Web.findAndCountAll(condition) success(res,ç«™ç‚¹åˆ—è¡¨æŸ¥è¯¢æˆåŠŸ, webs:rows, pagination: total:count, currentPage, pageSize ) catch(error) failure(res,error) )/** æŸ¥è¯¢ç«™ç‚¹è¯¦æƒ… */router.get(/:id,async (req,res)= try const web = await getDataById(req) success(res,ç«™ç‚¹è¯¦æƒ…æŸ¥è¯¢æˆåŠŸ,web) catch(error) failure(res,error) )/** æ–°å»ºç«™ç‚¹ */router.post(/,async (req,res)= try const body = ...getFilterBody(req), view:0 const web = await Web.create(body) success(res,åˆ›å»ºç«™ç‚¹æˆåŠŸ,web,201) catch(error) failure(res,error) )/** åˆ é™¤ç«™ç‚¹ */router.delete(/:id,async (req,res)= try const web = await getDataById(req) await web.destroy() success(res,åˆ é™¤ç«™ç‚¹æˆåŠŸ) catch(error) failure(res,error) )/** æ›´æ–°ç«™ç‚¹ */router.put(/:id,async (req,res)= try const web = await getDataById(req) const body = getFilterBody(req) await web.update(body) success(res,ç«™ç‚¹æ›´æ–°æˆåŠŸ,web) catch(error) failure(res,error) )/** * æ ¹æ®idè·å–æŒ‡å®šæ•°æ® * @param req * @returns Promisevoid */async function getDataById(req) const id = req.params const data = await Web.findByPk(id) if(!data) throw new NotFoundError(`æœªæ‰¾åˆ°IDä¸ºï¼š$id çš„ç«™ç‚¹`) return data/** * è·å–åˆ°è¿‡æ»¤åçš„bodyå‚æ•° * @param request */function getFilterBody(req) const href, name, webIcon, webCover, content, categoryId, github, blogHref = req.body return href, name, webIcon, webCover, content, categoryId:Number(categoryId), github, blogHref module.exports = router;"},{"title":"6-æ•°æ®åº“è®¾è®¡","path":"/wiki/Node/clwy_06_dbTable.html","content":"ç”¨æˆ·è¡¨Userç”¨æˆ·è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢emailï¼ˆç”µå­é‚®ç®±ï¼‰ï¼švarcharï¼Œä¸ä¸ºnullï¼Œuniqueç´¢å¼•usernameï¼ˆç”¨æˆ·åï¼‰ï¼švarcharï¼Œä¸ä¸ºnullï¼Œuniqueç´¢å¼•passwordï¼ˆå¯†ç ï¼‰ï¼švarcharï¼Œä¸ä¸ºnullroleï¼ˆç”¨æˆ·ç»„ï¼‰ï¼štinyintï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œindexç´¢å¼•ï¼Œé»˜è®¤ä¸º00ä¸ºæ™®é€šç”¨æˆ·100ä¸ºç®¡ç†å‘˜modelmigrationseed åº”ç”¨ç±»å‹è¡¨Typeåº”ç”¨ç±»å‹è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢nameï¼ˆåç§°ï¼‰ï¼švarcharï¼Œä¸ä¸ºnullrankï¼ˆé¡ºåºï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œé»˜è®¤ä¸º1modelmigrationseed åˆ†ç±»ç±»å‹è¡¨Categoryåˆ†ç±»ç±»å‹è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢nameï¼ˆåç§°ï¼‰ï¼švarcharï¼Œä¸ä¸ºnullrankï¼ˆé¡ºåºï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œé»˜è®¤ä¸º1typeIdï¼ˆç±»å‹idï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œé»˜è®¤ä¸º1modelmigrationseed å¼€å‘åº”ç”¨è¡¨appåº”ç”¨è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢nameï¼ˆåº”ç”¨åç§°ï¼‰ï¼švarcharï¼Œä¸ä¸ºnullï¼Œiconï¼ˆå›¾æ ‡ï¼‰: varcharcoverï¼ˆå°é¢ï¼‰ï¼švarcharvideoï¼ˆè§†é¢‘ï¼‰ï¼švarcharcontentï¼ˆä»‹ç»ï¼‰ï¼štextgithubï¼ˆæºç åœ°å€ï¼‰ï¼švarcharblogHrefï¼ˆåšå®¢åœ°å€ï¼‰ï¼švarcharviewCountï¼ˆè§‚çœ‹æ•°é‡ï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œé»˜è®¤0categoryIdï¼ˆç±»å‹åˆ†ç±»ï¼‰ï¼šinterï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œindexç´¢å¼•typeIdï¼ˆåº”ç”¨ç±»å‹ï¼‰ï¼šinterï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œindexç´¢å¼•modelmigrationseed è®¿å®¢è®°å½•è¡¨Viewè®¿é—®è®°å½•è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢userIdï¼ˆè®¿å®¢idï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œindexç´¢å¼•applicationIdï¼ˆè®¿é—®çš„åº”ç”¨idï¼‰ï¼šintegerï¼Œæ— ç¬¦å·ï¼Œä¸ä¸ºnullï¼Œindexç´¢å¼•modelmigration è®¾ç½®è¡¨Settingè®¾ç½®è¡¨ è¡¨æ ¼å±æ€§idï¼ˆç¼–å·ï¼‰ï¼šintegerï¼Œä¸»é”®ï¼Œä¸ä¸ºnullï¼Œæ— ç¬¦å·ï¼Œè‡ªå¢nameï¼ˆé¡¹ç›®åç§°ï¼‰ï¼švarcharicpï¼ˆå¤‡æ¡ˆå·ï¼‰ï¼švarcharcopyrightï¼ˆç‰ˆæƒä¿¡æ¯ï¼‰ï¼švarcharmodelmigrationseed"},{"title":"7-èº«ä»½è®¤è¯","path":"/wiki/Node/clwy_07_auth.html","content":"å¯†ç åŠ å¯†bcryptjs ä½¿ç”¨bcryptjså¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œå®‰è£…bcryptjsåº“ï¼šnpm i bcryptjsbcryptjsä½¿ç”¨æ–¹æ³•ï¼šconst bcrypt = require(bcryptjs)// ç”Ÿæˆ10ä½æ•°çš„ç›const salt = bcrypt.genSaltSync(10)// å¯¹å­—ç¬¦è¿›è¡ŒåŠ å¯†const hash = bcrypt.hashSync(æ˜å­—ç¬¦ä¸², salt)ç®€å†™ï¼šconst hash = bcrypt.hashSync(æ˜æ–‡å­—ç¬¦ä¸², 10)å½“è¡¨å•è·å–åˆ°ç”¨æˆ·è®¾ç½®çš„passwordåï¼Œéœ€è¦åœ¨ä¼ å…¥æ•°æ®åº“çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œè¿™ä¸€æ­¥éœ€è¦åœ¨modelå­—æ®µå¯¹åº”çš„setå‡½æ•°ä¸­å¤„ç†ï¼špassword: type:DataTypes.STRING, allowNull:false, // validate: // notNull:msg:å¯†ç å¿…é¡»å­˜åœ¨, // notEmpty:msg:å¯†ç ä¸èƒ½ä¸ºç©º, // len: // args:[8,30], // msg:å¯†ç é•¿åº¦åº”å½“åœ¨8-30ä¸ªå­—ç¬¦ä¹‹é—´ // // , set(value) if(!value) throw new Error(å¯†ç å¿…é¡»å¡«å†™) if(value.length 6 || value.length 45) throw new Error(å¯†ç é•¿åº¦å¿…é¡»åœ¨6~45ä¹‹é—´) // è¿›è¡ŒåŠ å¯† this.setDataValue( password, bcrypt.hashSync(value, 10) ) å°†æ¥çš„ç™»å½•æ—¶ï¼Œéœ€è¦ä½¿ç”¨bcrypt.compareSyncå¯¹åŠ å¯†åçš„å­—ç¬¦ä¸²å’Œæ˜æ–‡å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼šconst isPasswordValid = bcrypt.compareSync(12345,åŠ å¯†åçš„å­—ç¬¦ä¸²)"},{"title":"ç¬¬ä¸€ç«  Nodeç®€ä»‹","path":"/wiki/Node/pl_01_intro.html","content":"å†³å®šWebæœåŠ¡å™¨æ€§èƒ½çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå¤§å¤šæ•°äººä¸èƒ½è®¾è®¡ä¸€ç§æ›´ç®€å•å’Œæ›´æœ‰æ•ˆç‡çš„ç¨‹åºçš„ä¸»è¦åŸå› æ˜¯ä»–ä»¬ç”¨åˆ°äº†é˜»å¡I/Oçš„åº“ Nodeçš„å‘æ˜è€… Ryan Dahl è®¤ä¸ºé«˜æ€§èƒ½WebæœåŠ¡å™¨éœ€è¦è€ƒè™‘åˆ°ä¸¤ä¸ªè¦ç‚¹ï¼š äº‹ä»¶é©±åŠ¨ éé˜»å¡IO è¿™ä¹Ÿæ˜¯ Ryan Dahl é€‰æ‹© JavaScript ç¼–å†™ Node çš„åŸå› ï¼Œå› ä¸º JavaScript å…·æœ‰çš„ä¼˜ç‚¹å’Œä»–å¯¹é«˜æ€§èƒ½WebæœåŠ¡å™¨çš„è¦æ±‚éƒ½å¯¹ä¸Šäº†ï¼ŒJavaScript åœ¨ä»–çœ¼ä¸­ï¼š ä¸€æ˜¯ é«˜æ€§èƒ½ï¼ˆV8å¼•æ“ï¼‰ äºŒæ˜¯ ç¬¦åˆäº‹ä»¶é©±åŠ¨ï¼ˆæµè§ˆå™¨ä¸­åº”ç”¨ï¼‰ ä¸‰æ˜¯ å†å²çŸ­ Nodeä¸å¼€æºç²¾ç¥å¼ºåˆ¶ä¸å…±äº«ä»»ä½•èµ„æº Nodeç°åœ¨å·²ç»å‘å±•ä¸ºä¸€ä¸ª å¼ºåˆ¶ä¸å…±äº«ä»»ä½•èµ„æº çš„å•çº¿ç¨‹ã€å•è¿›ç¨‹ç³»ç»Ÿã€‚å¹¶ä¸”å®ƒè‡ªèº«ä¹Ÿéå¸¸ç®€å•ï¼Œé€šè¿‡é€šä¿¡åè®®æ¥ç»„ç»‡è®¸å¤šNodeï¼Œéå¸¸å®¹æ˜“é€šè¿‡æ‰©å±•æ¥è¾¾æˆæ„å»ºå¤§å‹ç½‘ç»œåº”ç”¨çš„ç›®çš„ã€‚ å¯¹æ¯”Nodeä¸æµè§ˆå™¨æµè§ˆå™¨çš„ä¸¤ä¸ªä¸»è¦å¼•æ“ JavaScriptå¼•æ“ï¼š V8å¸ƒå±€å¼•æ“ï¼š WebKité•¿ä¹…ä»¥æ¥æµè§ˆå™¨éƒ½æ˜¯JavaScriptè¿è¡Œçš„æ²™ç®±ï¼Œå®ƒçš„èƒ½åŠ›å–å†³äºæµè§ˆå™¨ä¸­é—´å±‚æä¾›çš„æ”¯æŒæœ‰å¤šå°‘ã€‚ å¯¹æ¯”æµè§ˆå™¨ä¸Node é™¤äº†æµè§ˆå™¨å…·æœ‰HTMLã€WebKitå’Œæ˜¾å¡è¿™äº› UIç›¸å…³æŠ€æœ¯ çš„æ”¯æŒå¤–ï¼ŒNodeä¸æµè§ˆå™¨ç»“æ„ååˆ†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ åŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ¶æ„æ€»ä¹‹ï¼ŒNodeä¸å¤„ç†UIï¼Œä½†ç”¨ä¸æµè§ˆå™¨ç›¸åŒçš„æœºåˆ¶å’ŒåŸç†è¿è¡Œã€‚ æµè§ˆå™¨é€šè¿‡äº‹ä»¶é©±åŠ¨æ¥æœåŠ¡ ç•Œé¢ä¸Šçš„äº¤äº’ Nodeé€šè¿‡äº‹ä»¶é©±åŠ¨æ¥æœåŠ¡ IO Nodeçš„ç‰¹ç‚¹å¼‚æ­¥IO ç»å…¸å¼‚æ­¥è°ƒç”¨â€”â€”ajaxè¯·æ±‚ Nodeä¸­çš„å¼‚æ­¥è¯»å–æ–‡ä»¶æ“ä½œ Ryan Dahl åœ¨åº•å±‚æ„å»ºäº†å¾ˆå¤šå¼‚æ­¥IOçš„APIï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»è¯­è¨€å±‚é¢å¾ˆè‡ªç„¶çš„è¿›è¡Œ å¹¶è¡ŒIO æ“ä½œ äº‹ä»¶ä¸å›è°ƒå‡½æ•° Nodeèƒ½å¤Ÿå°†äº‹ä»¶ç‚¹æš´éœ²ç»™ä¸šåŠ¡é€»è¾‘ äº‹ä»¶ç¼–ç¨‹ å°†å‰ç«¯æµè§ˆå™¨ä¸­åº”ç”¨å¹¿æ³›ä¸”æˆç†Ÿçš„äº‹ä»¶å¼•å…¥åç«¯ï¼Œé…åˆå¼‚æ­¥IOï¼Œå°†äº‹ä»¶ç‚¹æš´éœ²ç»™ä¸šåŠ¡é€»è¾‘è¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„äº‹ä»¶ç¼–ç¨‹ï¼Œä¼˜ç‚¹æ˜¯ï¼šè½»é‡çº§æ¾è€¦åˆåªå…³æ³¨äº‹åŠ¡ç‚¹å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„åœºæ™¯ä¸‹ï¼Œäº‹ä»¶ä¸äº‹ä»¶ä¹‹é—´å„è‡ªç‹¬ç«‹ï¼Œå¦‚ä½•åä½œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ å›è°ƒå‡½æ•° å›è°ƒå‡½æ•°æ˜¯æœ€å¥½çš„æ¥å—å¼‚æ­¥è°ƒç”¨è¿”å›æ•°æ®çš„æ–¹å¼å¼‚æ­¥ç¼–ç¨‹æ€ç»´è¦æ±‚ç†Ÿæ‚‰ï¼šå¯¹ä¸šåŠ¡çš„åˆ’åˆ†å¯¹äº‹ä»¶çš„æç‚¼ å•çº¿ç¨‹ JavaScriptä¸å…¶ä½™çº¿ç¨‹æ— æ³•å…±äº«ä»»ä½•çŠ¶æ€ å•çº¿ç¨‹çš„å¼±ç‚¹ä¸»è¦æœ‰ï¼š æ— æ³•åˆ©ç”¨ å¤šæ ¸CPU é”™è¯¯ä¼š å¼•èµ·æ•´ä¸ªåº”ç”¨é€€å‡ºï¼Œ åº”ç”¨ å¥å£®æ€§ ä½ å¤§é‡è®¡ç®—å ç”¨CPU å¯¼è‡´æ— æ³•ç»§ç»­è°ƒç”¨å¼‚æ­¥IO child_process Nodeä½¿ç”¨child_processæ¥è§£å†³å•çº¿ç¨‹ä¸­å¤§è®¡ç®—é‡çš„é—®é¢˜ã€‚é€šè¿‡å°†è®¡ç®—åˆ†å‘åˆ°å„ä¸ªå­è¿›ç¨‹ï¼Œå†é€šè¿‡è¿›ç¨‹ä¹‹é—´çš„äº‹ä»¶æ¶ˆæ¯æ¥ä¼ é€’ç»“æœ è·¨å¹³å° å€ŸåŠ©libuvç»„ä»¶ï¼ŒNodeå®ç°äº†è·¨å¹³å°çš„å…¼å®¹ Nodeåº”ç”¨åœºæ™¯IOå¯†é›†å‹ Nodeé¢å‘ç½‘ç»œä¸”æ“…é•¿å¹¶è¡ŒIOï¼Œèƒ½å¤Ÿæœ‰æ•ˆç»„ç»‡èµ·æ›´å¤šçš„ç¡¬ä»¶èµ„æº äº‹ä»¶å¾ªç¯å¤„ç† Nodeåˆ©ç”¨äº‹ä»¶å¾ªç¯å¤„ç†å¯†é›†IOï¼Œè€Œä¸æ˜¯å¯åŠ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æœåŠ¡ï¼Œèµ„æºå ç”¨æå°‘ CPUå¯†é›†å‹Nodeçš„è¿è¡Œæ•ˆç‡ç®—å¾—ä¸Šé«˜æ•ˆå—ï¼Ÿ ç­”ï¼š Nodeå½“ç„¶è¶³å¤Ÿé«˜æ•ˆï¼Œä¸»è¦å½’åŠŸäºV8çš„æ·±åº¦æ€§èƒ½ä¼˜åŒ–ã€‚ CPUå¯†é›†å‹ç»™Nodeå¸¦æ¥çš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹äºé•¿æ—¶é—´çš„è¿ç®—ï¼ˆå¦‚å¤§å¾ªç¯ï¼‰ä¼šå¯¼è‡´CPUæ—¶é—´ç‰‡é•¿æ—¶é—´æ— æ³•é‡Šæ”¾ï¼Œç”±äºNodeå•çº¿ç¨‹çš„ç‰¹ç‚¹ï¼Œåç»­IOæ— æ³•å‘èµ·ã€‚ Nodeçš„å¯¹åº”ç­–ç•¥ æ–¹æ³•1ï¼šåˆ†è§£é€‚å½“è°ƒæ•´å’Œåˆ†è§£å¤§å‹è¿ç®—ä»»åŠ¡ä¸ºå¤šä¸ªå°ä»»åŠ¡ã€‚æ–¹æ³•2ï¼šå¼‚æ­¥IONodeçš„å¼‚æ­¥IOå·²ç»è§£å†³äº†å•çº¿ç¨‹ä¸ŠCPUä¸IOä¹‹é—´é˜»å¡æ— æ³•é‡å åˆ©ç”¨çš„é—®é¢˜"},{"title":"ç¬¬ä¸‰ç«  å¼‚æ­¥I/O","path":"/wiki/Node/pl_03_IO.html","content":"å¼‚æ­¥ä¸å‰ç«¯çš„ä¸è§£ä¹‹ç¼˜ å‰ç«¯ç¼–ç¨‹ç®—æ˜¯ GUIç¼–ç¨‹ çš„ä¸€ç§, å› æ­¤é©±åŠ¨ç¨‹åºçš„å¾ˆå¤§éƒ¨åˆ†éƒ½æ˜¯å¼‚æ­¥äº‹ä»¶ï¼Œä½†ç³Ÿç³•çš„æ˜¯ï¼š äººç±»å¤©ç”Ÿå°±ä¸æ“…é•¿å¼‚æ­¥æ€ç»´ PHPï¼šçŸ¥é“è¿™ä¸€ç‚¹æˆ‘å°±æ”¾å¿ƒäº† PHPç®—æ˜¯å½»å¤´å½»å°¾çš„å•çº¿ç¨‹åŒæ­¥è¯­è¨€ åœ¨å°è§„æ¨¡ç«™ç‚¹ä¸­å‡ ä¹æ²¡æœ‰ç¼ºç‚¹ï¼Œ ä½†æ˜¯åœ¨å¤æ‚ç½‘ç»œåº”ç”¨ä¸­ä¼šå› ä¸ºé˜»å¡å¯¼è‡´æ— æ³•å¾ˆå¥½çš„å¹¶å‘ã€‚ äº‹å®ä¸Šå°±ç®—æ˜¯æä¾›äº†å¼‚æ­¥APIï¼Œå¾ˆå¤šäººä¹Ÿç”¨ä¸ä¹ æƒ¯ å¼‚æ­¥IOè¿˜æœ‰ä¸¤ä¸ªå¥½å…„å¼Ÿï¼š äº‹ä»¶é©±åŠ¨ å•çº¿ç¨‹ åŒæ ·åœ¨è¿™ä¸¤ä¸ªæ–¹å‘æœ‰å‡ºè‰²è®¾è®¡ç†å¿µçš„äº§å“è¿˜æœ‰ä¸‹é¢è¿™ä½ï¼š Nginx Nginxå…·å¤‡é¢å‘å®¢æˆ·ç«¯ç®¡ç†è¿ç»“çš„å¼ºå¤§èƒ½åŠ›ï¼Œ ä½†æ˜¯å®ƒä¾ç„¶å—é™äºèƒŒåå„ç§åŒæ­¥æ–¹å¼çš„ç¼–ç¨‹è¯­è¨€ã€‚ ä¸ºä»€ä¹ˆè¦å¼‚æ­¥IOç”¨æˆ·ä½“éªŒ ã€Šé«˜æ€§èƒ½JavaScriptã€‹- Nicholas C.Zakas å‰ç«¯è·å–ä¸¤ä¸ªåŒæ ·çš„èµ„æºï¼š åŒæ­¥æ–¹å¼ getData(from_db); // æ¶ˆè´¹æ—¶é—´ä¸ºMgetData(from_remote_api); //æ¶ˆè´¹æ—¶é—´ä¸ºB æ€»è€—æ—¶ï¼šM+N å¼‚æ­¥æ–¹å¼ getData(from_db,function(result) // æ¶ˆè´¹æ—¶é—´ä¸ºM)getData(from_remote_api,function(result) // æ¶ˆè´¹æ—¶é—´ä¸ºN) æ€»è€—æ—¶ï¼šmax(M, N) ä¸åŒçš„I/Oç±»å‹å¯¹åº”çš„å¼€é”€ I/Oç±»å‹ æ¶ˆè€—CPUæ—¶é’Ÿå‘¨æœŸ CPUä¸€çº§ç¼“å­˜ 3 CPUäºŒçº§ç¼“å­˜ 14 å†…å­˜ 250 ç¡¬ç›˜ 41000000 ç½‘ç»œ 240000000 åˆ†å¸ƒå¼åº”ç”¨ä¼šä½¿Må’ŒNå€¼å‘ˆçº¿æ€§å¢é•¿ï¼Œ è¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼åº”ç”¨ä¼šæ”¾å¤§åŒæ­¥å’Œå¼‚æ­¥å·®å¼‚çš„åŸå› ã€‚ èµ„æºåˆ†é…èµ„æºåˆ†é…ä¸»è¦æ¶‰åŠåˆ°ä¸¤éƒ¨åˆ†è®¡ç®—æœºç»„ä»¶ï¼š IOè®¾å¤‡ è®¡ç®—è®¾å¤‡ ä¸»æµçš„èµ„æºåˆ†é…çš„æ–¹æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š å•çº¿ç¨‹ä¸²è¡Œä¾æ¬¡æ‰§è¡Œ IOè®¾å¤‡ ä¸ºä¸» æ˜“äºè¡¨è¾¾ é˜»å¡IOå¯¼è‡´ç¡¬ä»¶èµ„æºå¾—ä¸åˆ°æ›´ä¼˜ä½¿ç”¨ å¤šçº¿ç¨‹å¹¶è¡Œå®Œæˆ è®¡ç®—è®¾å¤‡ä¸ºä¸» èƒ½å¤Ÿæé«˜å¤šæ ¸CPUè®¾å¤‡çš„CPUåˆ©ç”¨ç‡ åˆ›å»ºçº¿ç¨‹å’Œæ‰§è¡ŒæœŸçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ ç»å¸¸é¢ä¸´é”ã€çŠ¶æ€åŒæ­¥ç­‰é—®é¢˜ Nodeç»™å‡ºçš„æ–¹æ¡ˆ - å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ - **å•çº¿ç¨‹** - åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ - **å¼‚æ­¥** å¦‚ä½•å¼¥è¡¥å•è¿›ç¨‹ç¼ºç‚¹ï¼Ÿ Nodeæ— æ³•æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸CPUè®¾å¤‡èµ„æºï¼Œ ä½†æ˜¯æä¾›äº†**å­è¿›ç¨‹æœºåˆ¶**ï¼ˆç±»ä¼¼å‰ç«¯æµè§ˆå™¨ä¸­çš„ *Web Workers*ï¼‰ å¼‚æ­¥IOå®ç°ç°çŠ¶åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡ã€å›è°ƒã€äº‹ä»¶â€¦è¿™äº›æ¦‚å¿µçš„å¼•å…¥å®é™…ä¸Šéƒ½æ˜¯ä¸ºäº†è¾¾æˆä¸€ä¸ªç›®çš„ï¼šå¹¶è¡ŒIOã€‚ä½†å®é™…è€ƒè™‘åˆ°æ“ä½œç³»ç»Ÿæ—¶ï¼Œåªæ¶‰åŠåˆ°ä¸¤ç§IOæ–¹å¼ï¼š é˜»å¡IO éé˜»å¡IO é˜»å¡å’Œéé˜»å¡ é˜»å¡I/O åº”ç”¨ç¨‹åºéœ€è¦ç­‰å¾…I/Oå®Œæˆæ‰è¿”å›ç»“æœã€‚ è°ƒç”¨ä¹‹åä¸€å®šè¦ç­‰åˆ°ç³»ç»Ÿå†…æ ¸å®Œæˆæ‰€æœ‰æ“ä½œä¹‹åæ‰ç®—åšè°ƒç”¨ç»“æŸã€‚ éé˜»å¡I/O åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨åç«‹åˆ»èƒ½è·å–åˆ°è¿”å›å€¼ã€‚ éœ€è¦é€šè¿‡æ–‡ä»¶æè¿°ç¬¦å†æ¬¡è¯»å–ã€‚ é˜»å¡IO éé˜»å¡IO æ“ä½œç³»ç»Ÿå¦‚ä½•å®ç°éé˜»å¡IOï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰é¦–å…ˆè¦çŸ¥é“æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•è¿›è¡ŒIOæ“ä½œçš„ï¼šIOè®¾å¤‡åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œå®é™…ä¸Šéƒ½æ˜¯è¢«æŠ½è±¡æˆäº†æ–‡ä»¶ï¼ŒIOè®¾å¤‡æŠ½è±¡æˆçš„æ–‡ä»¶æœ‰ä¸€ä¸ªå…³é”®å±æ€§ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºå¦‚æœéœ€è¦å®ç°IOè°ƒç”¨ï¼š é¦–å…ˆæ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ æ ¹æ®æ–‡ä»¶æè¿°ç¬¦å®ç°æ–‡ä»¶è¯»å†™ å› æ­¤æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯åº”ç”¨ç¨‹åºä¸ç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„äº¤äº’å‡­è¯ï¼Œä¹Ÿæ˜¯éé˜»å¡IOæ–¹å¼è·å–æ•°æ®çš„å…³é”®æ‰€åœ¨ã€‚ è½®è¯¢éé˜»å¡IOè°ƒç”¨åèƒ½ç«‹å³è¿”å›å†…å®¹ï¼Œä½†è¿”å›çš„å¹¶ä¸æ˜¯å®é™…æ•°æ®ï¼Œè€Œåªæ˜¯å½“å‰è°ƒç”¨çš„çŠ¶æ€ã€‚å®é™…éœ€è¦åå¤å‘èµ·IOè°ƒç”¨æ¥ç¡®è®¤æ˜¯å¦å®Œæˆï¼ˆå¤è¯»æœºï¼‰ã€‚ç›®å‰æœ‰å‡ ç±»è½®è¯¢æŠ€æœ¯ï¼š æœºåˆ¶ ç¤ºæ„å›¾ è¡¥å…… read å•çº¯çš„é‡å¤è°ƒç”¨æ£€æŸ¥IOçŠ¶æ€æ–¹å¼ select ç›¸æ¯”readï¼Œselectæ£€æŸ¥çš„ä¸æ˜¯IOçš„çŠ¶æ€è€Œæ˜¯æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ é‡‡ç”¨ä¸€ä¸ª1024é•¿çš„æ•°ç»„å­˜å‚¨çŠ¶æ€ poll ç›¸æ¯”selectçš„æ•°ç»„ç»“æ„ï¼Œé‡‡ç”¨äº†é“¾è¡¨æ–¹å¼é¿å…é•¿åº¦é™åˆ¶ï¼Œè¿‡æ»¤æ‰ä¸å¿…è¦çš„æ£€æŸ¥ epoll é‡‡ç”¨äº†è½®è¯¢-ä¼‘çœ -å”¤é†’çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼ŒLinuxä¸‹æ•ˆç‡æœ€é«˜çš„è½®è¯¢æœºåˆ¶ equeue ç±»ä¼¼epollæœºåˆ¶ï¼Œä»…åœ¨FreeBSDç³»ç»Ÿä¸‹å­˜åœ¨ æ€»ç»“è¿™å‡ ç§æ–¹æ³•ä¹‹åï¼Œå‘ç°åœ¨åº”ç”¨ç¨‹åºå‘å‡ºè¯·æ±‚ä¹‹åï¼ŒCPUä¸æ˜¯åœ¨éå†IOçŠ¶æ€ï¼Œå°±æ˜¯åœ¨éå†æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€ï¼Œæˆ–è€…åœ¨ä¼‘çœ ï¼Œå› æ­¤å®é™…ä¸Šä»æ—§æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ã€‚ ç†æƒ³çš„éé˜»å¡å¼‚æ­¥IOæ—¢ç„¶å„ç§è½®è¯¢çš„æ–¹å¼éƒ½ä¸èƒ½å¾ˆå¥½çš„å®ç°å¼‚æ­¥IOï¼Œé‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ‰æ˜¯ç†æƒ³çš„éé˜»å¡å¼‚æ­¥IOæœºåˆ¶å‘¢ï¼Ÿ å¤§è‡´å¦‚ä¸‹ï¼š åº”ç”¨ç¨‹åºå‘å‡ºIOè¯·æ±‚ ç›´æ¥å¼€å§‹å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ IOå¤„ç†å®Œæˆåé€šè¿‡ä¿¡å·æˆ–å›è°ƒå°†æ•°æ®ä¼ é€’ç»™åº”ç”¨ç¨‹åº ä¹‹æ‰€ä»¥å¼‚æ­¥IOçš„å®ç°å¦‚æ­¤å›°éš¾çš„åŸå› ï¼Œå°±åœ¨äº é€šè¿‡ä¿¡å·å’Œå›è°ƒä¼ é€’æ•°æ® è¿™ä¸€æ­¥ Linuxå†…æ ¸IOä¸­çš„O_DIRECTæ–¹å¼è¯»å–æ•°æ®æ—¶ä½¿ç”¨çš„AIOæ–¹å¼å®é™…å®ç°äº†è¿™ç§æœºåˆ¶ ç°å®çš„å¼‚æ­¥IOåœ¨Windowså’Œ*nixå¹³å°ä¸‹ï¼ŒNodeé‡‡ç”¨äº†ä¸åŒçš„å¼‚æ­¥IOæ–¹æ¡ˆï¼š *nixï¼šlibeio é‡‡ç”¨çº¿ç¨‹æ± å’Œé˜»å¡IOæ¨¡æ‹Ÿå¼‚æ­¥IO Windowsï¼šIOCP åŒæ ·æ˜¯çº¿ç¨‹æ± åŸç†ï¼Œä¸åŒä¹‹å¤„åœ¨äºçº¿ç¨‹æ± ç”±ç³»ç»Ÿå†…æ ¸æ¥æ‰‹ç®¡ç† Nodeä¸­ï¼Œç”¨äºå¤„ç†å¹³å°å·®å¼‚çš„å±‚å³libuvï¼š libuvä½œä¸ºæŠ½è±¡å°è£…å±‚ï¼Œç”¨äºå¹³å°å…¼å®¹æ€§åˆ¤æ–­ ä¿è¯ä¸Šå±‚Nodeä¸ä¸‹å±‚è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼ˆlibeioï¼‰å’ŒIOCPå„è‡ªç‹¬ç«‹ IOçš„ä¸¤ä¸ªè¯¯åŒºï¼š IOä¸ä»…ä»…é™äºç£ç›˜æ–‡ä»¶è¯»å†™ï¼Œå®é™…èŒƒå›´åŒ…æ‹¬å‡ ä¹æ‰€æœ‰è®¡ç®—æœºèµ„æºï¼ŒåŒ…æ‹¬ï¼š ç£ç›˜æ–‡ä»¶ ç¡¬ä»¶ å¥—æ¥å­— Nodeä»…ä»…åªæ˜¯JavaScriptæ‰§è¡Œåœ¨å•çº¿ç¨‹ä¸­ Nodeå†…éƒ¨å®ŒæˆIOä»»åŠ¡å®é™…éœ€è¦ä¾èµ–çº¿ç¨‹æ± æœºåˆ¶ Nodeçš„å¼‚æ­¥IONodeå¼‚æ­¥IOçš„ä¸‰ä¸ªä¸»è¦æœºåˆ¶ï¼š äº‹ä»¶å¾ªç¯ è§‚å¯Ÿè€… è¯·æ±‚å¯¹è±¡ äº‹ä»¶å¾ªç¯è¿›ç¨‹å¯åŠ¨æ—¶Nodeä¼šå‘èµ·äº‹ä»¶å¾ªç¯ï¼Œå¾ªç¯ä½“å•ä½åˆç§°Tickæ¯ä¸ªTickå®é™…å°±æ˜¯æŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å¾…å¤„ç† è§‚å¯Ÿè€…å¯¹äºæ¯ç§äº‹ä»¶éƒ½æœ‰ç›¸åº”çš„è§‚å¯Ÿè€…ï¼Œå½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œç”±å¯¹åº”è§‚å¯Ÿè€…æ”¶é›†åˆ°äº‹ä»¶å¾ªç¯ä¸­å¤„ç†ã€‚è§‚å¯Ÿè€…å°†äº‹ä»¶è¿›è¡Œäº†åˆ†ç±»ï¼ŒNodeä¸­çš„äº‹ä»¶ä¸»è¦æ¥æºäºï¼š ç½‘ç»œè¯·æ±‚ æ–‡ä»¶IO è¯·æ±‚å¯¹è±¡ä»JavaScriptå‘èµ·å¼‚æ­¥è°ƒç”¨ï¼Œåˆ°å†…æ ¸æ‰§è¡Œå®ŒIOæ“ä½œçš„è¿‡æ¸¡è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ç§ä¸­é—´äº§ç‰©ï¼Œå³è¯·æ±‚å¯¹è±¡ fs.open()è°ƒç”¨è¿‡ç¨‹ JavaScriptè°ƒç”¨Nodeæ ¸å¿ƒæ¨¡å— æ ¸å¿ƒæ¨¡å—è°ƒç”¨C++å†…å»ºæ¨¡å— å†…å»ºæ¨¡å—é€šè¿‡libuvè¿›è¡Œç³»ç»Ÿè°ƒç”¨ å›è°ƒå‡½æ•°çš„å®ç°åœ¨ç¬¬ä¸‰æ­¥ï¼š è°ƒç”¨uv_fs_open()æ–¹æ³• å…¶ä¸­åˆ›å»ºè¯·æ±‚å¯¹è±¡FSReqWrap å›è°ƒå‡½æ•°æ”¾åœ¨FSReqWrap.oncomplete_symä¸­req_wrap-object_-Set(oncomplete_sym, callback) FSReqWrapåŒ…è£…å®Œæ¯• å°†è¯·æ±‚å¯¹è±¡æ¨å…¥çº¿ç¨‹æ± ä¸­ç­‰å¾…æ‰§è¡Œè°ƒç”¨QueueUserWorkItem() è¯·æ±‚å¯¹è±¡æ‰§è¡Œ å›è°ƒé€šçŸ¥ è¯·æ±‚å¯¹è±¡æ¨å…¥çº¿ç¨‹æ± æ–¹æ³•QueueUserWorkItem(uv_fs_thread_proc, req, WT_EXECUTEDEFAULT) å‚æ•°1ï¼šuv_fs_thread_procå°†è¦æ‰§è¡Œçš„æ–¹æ³•çš„å¼•ç”¨æ ¹æ®ä¼ å…¥reqç±»å‹è°ƒç”¨ç›¸åº”åº•å±‚å‡½æ•°å¦‚uv_fs_open()å®é™…è°ƒç”¨çš„æ˜¯fs__open() å‚æ•°2ï¼šreqå‚æ•°1æ–¹æ³•è¿è¡Œæ—¶æ‰€éœ€è¦çš„å‚æ•° å‚æ•°3ï¼šWT_EXECUTEDEFAULTæ‰§è¡Œçš„æ ‡å¿— æ‰§è¡Œå›è°ƒå›è°ƒé€šçŸ¥çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š äº‹ä»¶å¤„ç†å®Œæ¯•ï¼Œå­˜å‚¨ç»“æœ ç»“æœåœ¨req-resultå±æ€§ä¸Š çŠ¶æ€æ”¹å˜ è°ƒç”¨PostQueuedCompletionStatusé€šçŸ¥IOCP æäº¤çŠ¶æ€ï¼Œè¿”è¿˜çº¿ç¨‹ ç­‰å¾…æ£€æµ‹ è°ƒç”¨GetQueuedCompletionStatusæ£€æµ‹å®ŒæˆçŠ¶æ€è¯·æ±‚ äº‹ä»¶åŒ…è£… è¢«æ£€æµ‹å‡ºå®Œæˆçš„è¯·æ±‚è¢«åŠ å…¥è§‚å¯Ÿè€…é˜Ÿåˆ—ï¼ŒåŒ…è£…æˆäº‹ä»¶å¤„ç†req_wrap-object_-Set(oncomplete_sym, callback) äº‹ä»¶å›è°ƒå–å‡ºresult-oncomplete_symå±æ€§ä½œä¸ºå›è°ƒæ–¹æ³•æ‰§è¡Œ å›è°ƒé€šçŸ¥æ–¹æ³•ï¼šPostQueuedCompletionStatus((loop)-iocp, 0, 0, ((req)-overlapped)) æ–¹æ³•ä½œç”¨æ˜¯ï¼š å‘IOCPæäº¤æ‰§è¡ŒçŠ¶æ€ å°†çº¿ç¨‹å½’è¿˜çº¿ç¨‹æ±  æ£€æŸ¥çº¿ç¨‹æ± ä»»åŠ¡çŠ¶æ€æ–¹æ³•ï¼šGetQueuedCompletionStatus() ç”¨äºæ£€æŸ¥çº¿ç¨‹æ± ä¸­æ˜¯å¦æœ‰æ‰§è¡Œå®Œçš„è¯·æ±‚ï¼š å¦‚æœæœ‰ï¼Œå°†è¯·æ±‚å¯¹è±¡åŠ å…¥IOè§‚å¯Ÿè€…é˜Ÿåˆ—ï¼Œå½“åšäº‹ä»¶å¤„ç†ï¼ˆonDataï¼‰ éIOçš„å¼‚æ­¥API setTimeout() setInterval() setImmediate() process.nextTick() å®šæ—¶å™¨ setTimeout å•æ¬¡å®šæ—¶æ‰§è¡Œä»»åŠ¡ setInterval å¤šæ¬¡å®šæ—¶æ‰§è¡Œä»»åŠ¡ å®šæ—¶å™¨ç®—æ˜¯ä¸éœ€è¦IOçº¿ç¨‹æ± å‚ä¸çš„äº‹ä»¶æ’å…¥ï¼Œç”±å®šæ—¶å™¨è§‚å¯Ÿè€…è§‚å¯Ÿã€‚ å®šæ—¶å™¨å­˜åœ¨çš„é—®é¢˜åœ¨äºå¹¶éç²¾ç¡®ï¼Œä¸¥æ ¼æ¥è¯´å®ƒä¸æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚æœä¸€æ¬¡å¾ªç¯å ç”¨æ—¶é—´è¾ƒå¤šä¼šå¯¼è‡´è¶…æ—¶ setTimeout(function() // ä»»åŠ¡1ï¼šèŠ±è´¹9ms // ä»»åŠ¡2: èŠ±è´¹5ms,10)// è¶…æ—¶ï¼š 9+5-10=4ms process.nextTick()let process = require(node:process)process.nextTick(callback) åŒæ ·æ˜¯ä¸ºäº†è¿›è¡Œå¼‚æ­¥æ“ä½œï¼šprocess.nextTickå’Œå®šæ—¶å™¨çš„åŒºåˆ«ï¼š å®šæ—¶å™¨ éœ€è¦åŠ¨ç”¨çº¢é»‘æ ‘ï¼Œåˆ›é€ å®šæ—¶å™¨å¯¹è±¡å’Œè¿­ä»£ç­‰æ“ä½œ æ—¶é—´å¤æ‚åº¦ï¼šO(lg(n)) process.nextTick åªä¼šå°†å›è°ƒå‡½æ•°æ”¾å…¥äº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸‹ä¸€è½®Tickæ—¶å–å‡ºæ‰§è¡Œ æ—¶é—´å¤æ‚åº¦ï¼šO(1) setImmediatesetImmediateä¸process.nextTickåŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œä¸åŒç‚¹æœ‰ä¸‹é¢è¿™äº›ï¼š æ‰§è¡Œä¼˜å…ˆçº§ä¸åŒ nextTick setTimeout setImmediate setTimeout(() = console.log(setTimeout) ,0) setImmediate(() = console.log(setImmediate) ) process.nextTick(() = console.log(nextTick) ) console.log(normal) // normal // nextTick // setTimeout // setImmediate è§‚å¯Ÿè€…ä¸åŒ setImmediateå±äºcheckè§‚å¯Ÿè€… process.nextTickå±äºidleè§‚å¯Ÿè€… idleè§‚å¯Ÿè€… checkè§‚å¯Ÿè€… IOè§‚å¯Ÿè€… å›è°ƒå‡½æ•°å­˜å‚¨ç»“æ„ä¸åŒ process.nextTickå­˜åœ¨æ•°ç»„é‡Œ setImmediateå­˜åœ¨é“¾è¡¨é‡Œ æ‰§è¡Œæ–¹å¼ä¸åŒ process.nextTickå°†æ•°ç»„ä¸­çš„å›è°ƒå‡½æ•°å…¨éƒ¨æ‰§è¡Œå®Œ setImmediateæ‰§è¡Œé“¾è¡¨ä¸­çš„ä¸€ä¸ªå›è°ƒå‡½æ•° äº‹ä»¶é©±åŠ¨ä¸é«˜æ€§èƒ½æœåŠ¡å™¨å¼‚æ­¥å®ç°çš„ä¸¤ä¸ªåŸºæœ¬è¦ç‚¹ï¼š ä¸»å¾ªç¯ äº‹ä»¶è§¦å‘ ç½‘ç»œå¥—æ¥å­—çš„å¤„ç†ï¼ˆNodeæ„å»ºWebæœåŠ¡å™¨ï¼‰ ä»ç½‘ç»œå¥—æ¥å­—ä¸Šä¾¦å¬åˆ°è¯·æ±‚ å°†è¯·æ±‚å½¢æˆç½‘ç»œIOäº‹ä»¶äº¤ç»™IOè§‚å¯Ÿè€… è§¦å‘å¯¹åº”IOäº‹ä»¶çš„å›è°ƒå‡½æ•° ç»å…¸æœåŠ¡å™¨æ¨¡å‹ åŒæ­¥å¼ ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ æ˜“é˜»å¡ æ¯è¿›ç¨‹æ¯è¯·æ±‚ ä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ æ‰©å±•æ€§å·® æ¯çº¿ç¨‹æ¯è¯·æ±‚ï¼ˆApacheï¼‰ ä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ æ‰©å±•æ€§ç¨å¼º å¤§å¹¶å‘æƒ…å†µä¸‹æœåŠ¡å™¨ç¼“æ…¢ äº‹ä»¶é©±åŠ¨æœåŠ¡å™¨æ¨¡å‹ï¼ˆNodeï¼ŒNginxï¼‰ äº‹ä»¶é©±åŠ¨çº¿ç¨‹å°‘ï¼Œæ“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ä»£ä»·ä½ï¼Œä½†éœ€è¦æ³¨æ„ï¼š ä¸€æ—¦äº‹ä»¶å¾ªç¯ä¸­å­˜åœ¨é˜»å¡IOï¼Œå®é™…æ•ˆæœå’ŒåŒæ­¥å¼æœåŠ¡æ²¡æœ‰åŒºåˆ«ï¼Œæ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™"},{"title":"ç¬¬äºŒç«  æ¨¡å—æœºåˆ¶","path":"/wiki/Node/pl_02_module.html","content":"JavaScriptçš„é¸¡æ±¤æ—¶é—´ JSé…±ã®ä¸å—é‡è§†çš„ç«¥å¹´JavaScriptå½“åˆè¢«ä»“ä¿ƒçš„åˆ›é€ å‡ºæ¥ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†å®ç°2ä¸ªåŠŸèƒ½ï¼šè¡¨å•æ ¡éªŒç½‘é¡µç‰¹æ•ˆJSé…±ã®è¿›åŒ–ä½†éšç€BSåº”ç”¨çš„å…´èµ·ï¼ŒJavaScriptä¹Ÿè¶Šæ¥è¶Šæ”¶åˆ°é‡è§†ï¼Œæ¸æ¸åœ°å°±ç»å†äº†ä¸€ç³»åˆ—è¿›åŒ–ï¼šå·¥å…·ï¼ˆæµè§ˆå™¨å…¼å®¹ï¼‰ç»„ä»¶ï¼ˆåŠŸèƒ½æ¨¡å—ï¼‰æ¡†æ¶ï¼ˆåŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼‰åº”ç”¨ï¼ˆä¸šåŠ¡æ¨¡å—ç»„ç»‡ï¼‰åç«¯ã®æ–°æ˜ŸJSé…±ä½†æ˜¯JavaScriptå…ˆå¤©å°±ç¼ºä¹æ¨¡å—åŠŸèƒ½ï¼Œscriptæ ‡ç­¾å¼•å…¥ä»£ç çš„æ–¹å¼æ¯«æ— ç« æ³•ï¼Œéå¸¸è›‹ç–¼ï¼Œäºæ˜¯å°±å‡ºç°äº† å‘½åç©ºé—´ çš„äººä¸ºè§„èŒƒæ¥çº¦æŸä»£ç ã€‚å¼€å‘è€…ï¼šè¿˜èƒ½ä¸å¼€å‘äº†å’‹åœ°ï¼ŒåŠ å…¥å‘½åç©ºé—´å‡‘åˆç€å†™å§æœ€ç»ˆç»å†äº†åå¤šå¹´çš„å‘å±•ï¼ŒCommonJSè§„èŒƒ ç»ˆäºè¢«æå‡ºï¼ŒJavaScriptçš„æ¨¡å—åŒ–åŠŸèƒ½ä¹Ÿå¾—ä»¥å®Œå–„ï¼Œæœ€ç»ˆæˆåŠŸç ´å£ï¼Œè¿›å…¥åç«¯å¼€å‘é¢†åŸŸã€‚ CommonJSè§„èŒƒCommonJSå‡ºå‘ç‚¹åœ¨CommonJSæ²¡æœ‰è¢«æå‡ºä¹‹å‰ï¼ŒJavaScriptä¸€ç›´ä½¿ç”¨çš„æ˜¯å®˜æ–¹è§„èŒƒ ECMAScriptï¼Œä½†æ˜¯JavaScriptåœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¡¨ç°èƒ½åŠ›å§‹ç»ˆéƒ½å–å†³äºå®¿ä¸»ç¯å¢ƒå¯¹APIçš„æ”¯æŒç¨‹åº¦åœ¨ç¼“æ…¢ã®è¿›åŒ–è¿‡ç¨‹ä¸­çš„JSé…±ï¼Œå¸¸å¸¸å› ä¸ºè¿™äº›åŸå› è¢«åç«¯å¼€å‘æ‹’ä¹‹é—¨å¤–ï¼šæ²¡æœ‰æ¨¡å—ç³»ç»Ÿæ ‡å‡†åº“è¾ƒå°‘æ²¡æœ‰æ ‡å‡†æ¥å£ç¼ºä¹åŒ…ç®¡ç†ç³»ç»Ÿä½†æ˜¯åœ¨å¼•å…¥CommonJSä¹‹åï¼ŒJSé…±ç»ˆäºå…·å¤‡äº†è·¨å®¿ä¸»ç¯å¢ƒæ‰§è¡Œçš„èƒ½åŠ›ã€‚äºæ˜¯é™¤äº†å®¢æˆ·ç«¯åº”ç”¨ï¼ŒJavaScriptæ­¤åè¿˜èƒ½å¼€å‘ä»¥ä¸‹åº”ç”¨ï¼šæœåŠ¡å™¨ç«¯JavaScriptåº”ç”¨ç¨‹åºå‘½ä»¤è¡Œå·¥å…·æ¡Œé¢å›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åºæ··åˆåº”ç”¨ Nodeã€æµè§ˆå™¨ã€W3Cã€CommonJSã€ECMAScriptä¹‹é—´çš„å…³ç³» æµè§ˆå™¨ï¼š HTMLã€ CSS ã€ JavaScript çš„è¿è¡Œç¯å¢ƒW3Cï¼š å¯¹ BOM å’Œ DOM è¿›è¡Œè§„èŒƒåŒ–ECMAScriptï¼š å¯¹ JavaScript è¿›è¡Œè§„èŒƒåŒ–CommonJSï¼š å¯¹ JavaScript è¿›è¡Œè„±ç¦»å®¿ä¸»ç¯å¢ƒè§„èŒƒåŒ–Nodeï¼š åŒæ—¶å…¼å®¹ ECMAScript å’Œ CommonJS è§„èŒƒçš„jsæœåŠ¡å™¨ç«¯è¯­è¨€ CommonJSæ¨¡å—è§„èŒƒ æ¨¡å—çš„æ„ä¹‰åœ¨äºå°†ç±»èšçš„æ–¹æ³•å’Œå˜é‡ç­‰é™å®šåœ¨ç§æœ‰çš„ä½œç”¨åŸŸä¸­ æ¨¡å—å®šä¹‰çš„3ä¸ªéƒ¨åˆ† æ¨¡å—å¼•ç”¨ä½¿ç”¨ require() æ–¹æ³• let myModule = require(myModule);æ¨¡å—å®šä¹‰ä½¿ç”¨ module.exports å¯¹è±¡ // math.jsexports.add = function() let sum = 0, i = 0, args = arguments, l = args.length; while(il) sum+=args[i++]; return sum;; // program.jslet math = require(math);exports.increment = function(val) return math.add(val,1);æ¨¡å—æ ‡è¯†let myModule = require(æ¨¡å—æ ‡è¯†) æ¨¡å—æ ‡è¯†å°±æ˜¯ require() æ–¹æ³•æ¥æ”¶çš„å‚æ•°ï¼Œå®ƒå¯ä»¥éµä»ä»¥ä¸‹å‡ ç§æ ¼å¼ï¼š ç¬¦åˆå°é©¼å³°å‘½åçš„å­—ç¬¦ä¸² ä»¥...å¼€å¤´çš„ç›¸å¯¹è·¯å¾„ ç»å¯¹è·¯å¾„ Nodeçš„æ¨¡å—å®ç°Nodeä¸­å¼•å…¥æ¨¡å—ä¸»è¦æœ‰3ä¸ªæ­¥éª¤ï¼š ä¸‹é¢è¿™è¡Œä»£ç å°±å¥½åƒå«ä½ çš„ä¸‹å± Nodeé…± ç»™ä½ æ‰¾ä¸€ä»½å«åš myModule çš„ä¸œè¥¿å‡ºä»½ææ–™ï¼šlet myModule = require(myModule)å’Œå¤§å¤šæ•°è¢«Bossæè’™åœˆçš„ç¤¾ç•œä¸€æ ·ï¼ŒNodeé…±ä¸€ä¸Šæ¥å°±æ˜¯ä¸‰ä¸ªé—®é¢˜ï¼šè·¯å¾„åˆ†æNodeï¼šæˆ‘ä¸Šå“ªå»å–è¿™ä¸ªä¸œè¥¿å‘¢ï¼Ÿæ–‡ä»¶å®šä½Nodeï¼šä½ è¯´çš„è¿™ä¸ªmyModuleï¼Œå®ƒæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿç¼–è¯‘æ‰§è¡Œ Nodeï¼šæˆ‘æ€ä¹ˆç”¨è¿™ä¸ªä¸œè¥¿å‡ºææ–™å‘¢ï¼Ÿ Nodeçš„ä¸¤ç±»æ¨¡å— æ ¸å¿ƒæ¨¡å—Nodeæä¾›é™æ€å†…å­˜åŠ è½½é€Ÿåº¦å¿«æ–‡ä»¶æ¨¡å—ç”¨æˆ·ç¼–å†™åŠ¨æ€åŠ è½½é€Ÿåº¦æ…¢ æ–‡ä»¶åŠ è½½ä¼˜å…ˆçº§Nodeçš„ç¼“å­˜ç­–ç•¥ Nodeä¼šå¯¹å¼•å…¥è¿‡çš„æ¨¡å—è¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘äºŒæ¬¡å¼•å…¥æ—¶çš„å¼€é”€æµè§ˆå™¨ç¼“å­˜ç­–ç•¥ä¹Ÿå·®ä¸å¤šï¼šæµè§ˆå™¨ï¼šç¼“å­˜æ–‡ä»¶Nodeï¼šç¼“å­˜ç¼–è¯‘å’Œæ‰§è¡Œä¹‹åçš„å¯¹è±¡ åŠ è½½ä¼˜å…ˆçº§ ä¼˜å…ˆçº§éµå¾ªä¸¤ä¸ªé¡ºåºï¼šç¼“å­˜ä¼˜å…ˆæ•™ç§‘ä¹¦å¼åºŸè¯ï¼Œè¦ä¸ç„¶å¹²å˜›å¼•å…¥ç¼“å­˜ç­–ç•¥æ ¸å¿ƒæ¨¡å—ä¼˜å…ˆäºæ–‡ä»¶æ¨¡å—æŠŠè¿™ä¸¤ä¸ªåŸåˆ™ç¼åˆä¸€ä¸‹å°±å¾—å‡ºäº†å®Œæ•´çš„ç¼“å­˜ä¼˜å…ˆçº§æ’åºï¼šç¼“å­˜æ ¸å¿ƒæ¨¡å— ç¼“å­˜æ–‡ä»¶æ¨¡å— æ ¸å¿ƒæ¨¡å— æ–‡ä»¶æ¨¡å— è·¯å¾„åˆ†æå’Œæ–‡ä»¶å®šä½è·¯å¾„åˆ†æ Node:æˆ‘ä¸Šå“ªå»å–å‘¢ï¼ˆæŒ å¤´ï¼‰ï¼Ÿæ ¸å¿ƒæ¨¡å—è·¯å¾„å½¢å¼æ–‡ä»¶æ¨¡å—éè·¯å¾„éæ ¸å¿ƒæ–‡ä»¶æ¨¡å—å¦‚ httpã€fsã€pathç­‰ç‰¹æ®Šæƒ…å†µï¼šè‡ªå®šä¹‰æ¨¡å—æ ‡è¯†ç¬¦æ ¸å¿ƒæ¨¡å—æ ‡è¯†ç¬¦å¦‚æœæ˜¯è·¯å¾„æ–‡ä»¶æ¨¡å—çš„è¯æ’åè¿˜å¥½è¯´ï¼Œä½†è‡ªå®šä¹‰æ¨¡å—æ²¡æœ‰è·¯å¾„æ ‡è¯†ï¼Œä»€ä¹ˆéƒ½ä¸å¤„ç†ç™¾åˆ†ç™¾ä¼šè¢«æ ¸å¿ƒæ¨¡å—è¦†ç›–ï¼Œæ‰€ä»¥è¿˜æ˜¯è€ƒè™‘æ¢ä¸ªæ¨¡å—åå§æˆ–è€…æ¢ä¸ªè·¯å¾„å§ã€‚åˆåˆ’åˆ†ä¸ºç›¸å¯¹è·¯å¾„å½¢å¼ï¼šä»¥ ... å¼€å¤´ç»å¯¹è·¯å¾„å½¢å¼ï¼šä»¥ å¼€å¤´è·¯å¾„é¦–å…ˆä¼šè¢«è½¬ä¸º çœŸå®è·¯å¾„ï¼Œä¹‹åå¦‚æœäºŒæ¬¡åŠ è½½è¯¥æ¨¡å—ï¼Œå°±ç›´æ¥ç”¨è¿™ä¸ª çœŸå®äº†è·¯å¾„ ä½œä¸ºç´¢å¼•åˆ°æŒ‡å®šä½ç½®å–å°±å¥½äº†ã€‚ç¼–è¯‘æˆåŠŸçš„æ¨¡å—çš„æ–‡ä»¶è·¯å¾„ä½œä¸ºç´¢å¼•ç¼“å­˜åœ¨ Module._cacheå¯¹è±¡ä¸Šæ¯”å¦‚ï¼šlet myModule = require(./myModule)Nodeé¦–å…ˆä¼š .myModule è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„ pathï¼šD:\\CS_Demo\\V_Demo\\NodeJs_Demo\\æ·±å…¥æµ…å‡ºNodeJS\\day1_module\\myModule.jsç„¶åå°†pathä½œä¸ºç´¢å¼•ï¼Œä¸‹ä¸€æ¬¡æˆ‘å†ç”¨åˆ°myModuleæ¨¡å—ï¼Œå°±ç›´æ¥ä¼šæ‰¾åˆ°pathå¯¹åº”çš„æ–‡ä»¶ä¹Ÿå°±æ˜¯ è‡ªå®šä¹‰æ¨¡å—ï¼Œè¿™ç±»æ–‡ä»¶æ¨¡å—ç”±äº æ–‡ä»¶è·¯å¾„ä¸€èˆ¬æ¯”è¾ƒæ·±ï¼Œå› æ­¤æŸ¥æ‰¾èµ·æ¥æ¯”è¾ƒè´¹æ—¶ã€‚ æ¨¡å—è·¯å¾„ Nodeå°†æ–‡ä»¶å®šä½ç­–ç•¥æ¶‰åŠåˆ°çš„æŸ¥æ‰¾è·¯å¾„æ”¾åœ¨äº†ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå³ module.paths console.log(module.path) //è¾“å‡ºè·¯å¾„æ•°ç»„ // è¾“å‡ºç»“æœ[ D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\æ·±å…¥æµ…å‡ºNodeJS\\\\day1_module\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\\\æ·±å…¥æµ…å‡ºNodeJS\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\\\NodeJs_Demo\\ ode_modules, D:\\\\CS_Demo\\\\V_Demo\\ ode_modules, D:\\\\CS_Demo\\ ode_modules, D:\\ ode_modules] å³ä»å½“å‰è·¯å¾„èµ·ï¼Œç›´åˆ°æ ¹ç›®å½• ode_modulesï¼Œä¾æ¬¡å‘çˆ¶çº§é€’å½’ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚ æ–‡ä»¶å®šä½ ä¸¤ä¸ªç»†èŠ‚æ–‡ä»¶æ‰©å±•ååˆ†æNodeï¼šä½ è®©æˆ‘æ‰¾çš„æ¨¡å—æ˜¯ä¸ªä»€ä¹ˆæ–‡ä»¶ï¼Ÿåˆ«ä¸€ä¼šå„¿ç»™ä½ æ‰¾æ¥äº†åˆè¯´ä¸æ˜¯ä½ è¦çš„ç›®å½•å’ŒåŒ…çš„å¤„ç†Nodeï¼šä½ è¯´çš„çš„é‚£ä¸ªæ¨¡å—æˆ‘æ²¡æ‰¾åˆ°ï¼Œä½†æˆ‘æ‰¾åˆ°ä¸ªåŒåç›®å½•ï¼Œå‡‘åˆç€ç”¨å§æ–‡ä»¶æ‰©å±•ååˆ†æç›®å½•åˆ†æå’ŒåŒ…ä½ å’ŒNodeè¯´ï¼š// å¸®æˆ‘ä»é£Ÿå ‚å¸¦ä»½ç•ªèŒ„ç‚’é¸¡è›‹let dinner = require(./ç•ªèŒ„ç‚’é¸¡è›‹)Nodeä¸€å…±å°±çŸ¥é“é£Ÿå ‚æœ‰ä¸‰ä¸ªçª—å£å–ç•ªèŒ„ç‚’é¸¡è›‹ï¼šjsçª—å£jsonçª—å£nodeçª—å£ç„¶åNodeå°±å¼€å§‹ä¸€ä¸ªçª—å£ä¸€ä¸ªçª—å£çš„æ‰¾ï¼Œçœ‹è¿˜æœ‰æ²¡æœ‰å–ç•ªèŒ„ç‚’é¸¡è›‹çš„ã€‚è¿™å°±æ˜¯Nodeä¸­æ–‡ä»¶æ‰©å±•ååˆ†æçš„ç­–ç•¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±æŒ‡å®šå¥½ä½ è¦çš„æ–‡ä»¶çš„ç±»å‹ï¼Œæ³¨æ„è¿™é‡ŒNodeè·‘çª—å£æ˜¯è¦èŠ±æ—¶é—´çš„ï¼Œéœ€è¦ è°ƒç”¨fsæ¨¡å—åŒæ­¥é˜»å¡å¼åˆ¤æ–­ æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥æŒ‡å®šjsonå’Œnodeç±»å‹æ¨¡å—æ—¶ï¼Œå’ŒNodeä¸€å¼€å§‹è¯´æ¸…æ¥šä½ è¦çš„æ¨¡å—ä¼šçœå»æ‰©å±•ååˆ†æèŠ±è´¹çš„æ—¶é—´ã€‚ä½ å«Nodeå¸®ä½ å»ä¸€å®¶å«åšæ‘©å¡çš„å’–å•¡åº—ä¹°æ¯æ‘©å¡ï¼šlet dinner = require(./Mocha)ç»“æœNodeä¸€å»å‘ç°åº—é‡Œæ²¡æœ‰å–æ‘©å¡çš„ï¼Œç»“æœæŠŠæ•´å®¶åº—éƒ½ç»™ä¹°ä¸‹æ¥äº†ï¼ˆä¸æ„§æ˜¯ä½ ï¼‰è¿™é‡Œéœ€è¦äº†è§£Nodeåˆ†æç›®å½•çš„ä¸€äº›è§„åˆ™ï¼šé¦–å…ˆï¼Œåœ¨ç›®å½•ä¸‹å¯»æ‰¾ package.json æ–‡ä»¶Nodeæ‰¾åˆ°å’–å•¡å…çš„é¤å…æ‰‹å†Œâ€”â€”package.jsonNodeå¼€å§‹ç¿»çœ‹èµ·æ¥â€”â€”JSON.parse()Nodeåœ¨æ‰‹å†Œçš„mainèœå•æŸ¥çœ‹æ˜¯å¦æœ‰å–æ‘©å¡çš„package.jsonï¼šCommonJSåŒ…è§„èŒƒå®šä¹‰çš„åŒ…æè¿°æ–‡ä»¶package.jsonè¢«è§£æåï¼Œå…¶ä¸­çš„ mainå±æ€§ ä¼šè¢«æå–å‡ºæ¥ä½œä¸ºæ–‡ä»¶åè¿›è¡Œå®šä½ï¼Œå½“mainå±æ€§çš„è·¯å¾„é”™è¯¯æˆ–æ ¹æœ¬æ²¡æŒ‡å®šæ—¶â€¦ï¼ˆNodeï¼šä½ ä¸«ç©æˆ‘æ˜¯å§ï¼Ÿç™½è§£æäº†ï¼‰Nodeå‘ç°mainèœå•é‡Œæ²¡å†™å–æ‘©å¡Nodeå¿ƒæƒ³é‚£å°±ä¹°æ¯indexç¾å¼å‡‘åˆä¸€ä¸‹å§Nodeä¼šæŠŠ index ä½œä¸ºé»˜è®¤æ–‡ä»¶åï¼ŒæŒ¨ä¸ªæŸ¥æ‰¾ï¼šindex.jsindex.nodeindex.jsonå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°çš„è¯â€¦ç»“æœNodeä¸€é—®åº—å‘˜ï¼Œä»€ä¹ˆï¼Ÿè¿indexç¾å¼éƒ½æ²¡æœ‰ï¼ŸNodeéœ‡æƒŠäº†ï¼Œä½†æ˜¯åº—å‘˜åˆå’ŒNodeæ¨èäº†ä¸€å®¶æ›´å¤§çš„çˆ¶çº§å’–å•¡å…ï¼Œè®©å®ƒå»é‚£ä¹°è¿˜è®°å¾— module.path å—ï¼Ÿæ²¡é”™ï¼Œé¡ºç€è·¯å¾„æ‰¾åˆ°çˆ¶çº§ç›®å½•å†é‡å¤ä¸€éä¸Šé¢çš„æ“ä½œã€‚ æ¨¡å—ç¼–è¯‘æ¨¡å—å¯¹è±¡ ä¸‡ç‰©å¯å¯¹è±¡ï¼Œæ¯ä¸ªæ–‡ä»¶æ¨¡å—ä¹Ÿæ˜¯ä½œä¸ºå¯¹è±¡åŒ…è£…çš„ï¼šfunction Module(id, parent) this.id = id this.exports = this.parent = parent if (parent parent.children) // parentå–œå½“çˆ¹ parent.children.push(this) this.filename = null this.loaded = false this.children = [] æ¨¡å—ç¼–è¯‘ ä¸‡ç‰©å¯å¯¹è±¡(è¿™è¯å¥½åƒåˆšæ‰è¯´è¿‡)ï¼Œè¿ç¼–è¯‘è½½å…¥çš„æ–¹æ³•ä¹Ÿè¢«ä½œä¸ºå¯¹è±¡åŒ…è£…åœ¨requireä¸­ï¼šä¸åŒæ–‡ä»¶çš„åŠ è½½æ–¹å¼æ”¾åœ¨äº† require.extensions ä¸­console.log(require.extensions);è¾“å‡ºç»“æœï¼š .js: [Function (anonymous)], .json: [Function (anonymous)], .node: [Function (anonymous)]ä¹Ÿå¯ä»¥é€šè¿‡å¯¹ require.extensions çš„æ‰©å±•æ¥å®ç°è‡ªå®šä¹‰æ‰©å±•åæ–‡ä»¶çš„åŠ è½½ï¼šrequire.extensions[.duck] = function(module, filename) // åŠ è½½.duckæ–‡ä»¶ .jsæ–‡ä»¶.nodeæ–‡ä»¶.JSONæ–‡ä»¶é€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡ŒStep1 å¯¹jsæºä»£ç è¿›è¡Œå¤´å°¾åŒ…è£…(function (exports, require, module, __filename, __dirname) //åŒ…è£…å¤´ let math = require(math); exports.area = function (radius) return Math.PI * radius * radius; ); // åŒ…è£…å°¾è¿™æ ·å°±å®ç°äº† ä½œç”¨åŸŸéš”ç¦»Step2 ä½¿ç”¨åŒ…è£…åçš„ä»£ç åˆ›å»ºä¸€ä¸ªå…·ä½“çš„functionå¯¹è±¡ä½¿ç”¨çš„æ˜¯vmåŸç”Ÿæ¨¡å—çš„ runInThisContext()è¿”å›ä¸€ä¸ªå…·ä½“functionå¯¹è±¡Step3 ä¼ å‚æ‰§è¡ŒStep1ä¸­åŒ…è£…æˆçš„å‡½æ•°å‚æ•°ä¸»è¦å¦‚ä¸‹ï¼šexports å½“å‰æ¨¡å—å¯¹è±¡çš„exportsrequire å¼•å…¥æ–¹æ³•module å½“å‰æ¨¡å—å¯¹è±¡è‡ªèº«__filename æ–‡ä»¶å®šä½çš„å®Œæ•´è·¯å¾„__dirname æ–‡ä»¶ç›®å½•.nodeæ˜¯ç”¨ CC++ ç¼–è¯‘åç”Ÿæˆçš„æ¨¡å—æ–‡ä»¶ï¼ŒåŠ è½½å’Œæ‰§è¡Œæ–¹æ³•ï¼šprocess.dlopen()æ€»ä¹‹å°±æ˜¯åœ¨ dlopen() ä¸­è®©exportså’Œ.nodeäº§ç”Ÿè”ç³»ï¼ˆåˆ«é—®æ€ä¹ˆäº§ç”Ÿçš„è”ç³»ï¼Œé—®å°±æ˜¯é‡å­çº ç¼ ï¼‰é€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡Œè§£ææ–¹æ³•ï¼šJSON.parse()è§£æåç›´æ¥èµ‹ç»™æ¨¡å—å¯¹è±¡çš„exports æ ¸å¿ƒæ¨¡å—æ ¸å¿ƒæ¨¡å—çš„ä¸¤ä¸ªéƒ¨åˆ† CC++æ–‡ä»¶æ”¾åœ¨srcç›®å½•ä¸‹JavaScriptæ–‡ä»¶æ”¾åœ¨libç›®å½•ä¸‹ï¼ˆlib*.jsï¼‰srcç›®å½•ä¸‹çš„node.jsï¼ˆsrcnode.jsï¼‰ JavaScriptæ ¸å¿ƒæ¨¡å—çš„ç¼–è¯‘è¿‡ç¨‹Step1ï¼šè½¬å­˜ä¸ºC/C++ä»£ç Step2ï¼šå¼€å§‹ç¼–è¯‘æ€ä¹ˆæŠŠæ ¸å¿ƒä»£ç ä¸­çš„jséƒ¨åˆ†åŠ è½½åˆ°å†…å­˜ä¸­å‘¢ï¼Ÿ0åˆ†ç­”æ¡ˆï¼š ç¬¬ä¸€æ­¥ï¼Œå–å‡ºjsä»£ç ï¼Œç¬¬äºŒæ­¥ï¼šæ”¾å…¥å†…å­˜ä½ æè¿™æè¿™å‘¢ å®é™…ä¸Šæ˜¯éœ€è¦å°†jsè½¬å­˜ä¸ºCC++ï¼Œç„¶åå†åŠ è½½åˆ°å†…å­˜ä¹‹ä¸­ã€‚é—®é¢˜åˆæ¥äº†ï¼šå¦‚ä½•å°†jsè½¬åŒ–ä¸ºCC++å‘¢ï¼Ÿç­”ï¼š Nodeé‡‡ç”¨çš„æ˜¯V8çš„ js2c.pyã€‚ Step1 è½¬æ¢æˆC++æ•°ç»„è¿™é‡Œéœ€è¦æŠŠjsä»£ç ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨åœ¨nodeå‘½åç©ºé—´ä¸­Step2 ç”Ÿæˆnode_natives.hå¤´æ–‡ä»¶å­˜å‚¨åœ¨nodeå‘½åç©ºé—´ä¸­ï¼Œæ— æ³•ç›´æ¥æ‰§è¡ŒStep3 åŠ è½½è¿›å†…å­˜ä¸­åœ¨å¯åŠ¨Nodeä¹‹åï¼Œjsä»£ç ä¼šè¢«åŠ è½½è¿›å†…å­˜ä¸­æ ¸å¿ƒæ¨¡å—å’Œæ–‡ä»¶æ¨¡å—çš„ç¼“å­˜ä½ç½®ä¸åŒï¼šæ ¸å¿ƒæ¨¡å— NativeModule._cacheæ–‡ä»¶æ¨¡å— Module._cachefunction NativeModule(id) this.filenmae = id + .js this.id = id this.exports = this.loaded = false// å–å‡ºæºä»£ç NativeModule._source = process.binding(native)// ç¼“å­˜NativeModule._cache = CC++æ ¸å¿ƒæ¨¡å—çš„ç¼–è¯‘è¿‡ç¨‹Nodeæ ¸å¿ƒä»£ç çš„ä¸¤ç§å½¢å¼ å•ä¸€æ¨¡å¼å…¨éƒ¨ç”±CC++ç¼–å†™å¤åˆæ¨¡å¼C++å®ç°æ ¸å¿ƒéƒ¨åˆ†JavaScriptå®ç°å°è£…Nodeæé«˜æ€§èƒ½çš„å¸¸ç”¨æ¨¡å¼ å†…å»ºæ¨¡å— ç”± çº¯CC++ ç¼–å†™çš„éƒ¨åˆ†åˆç§°ä¸º å†…å»ºæ¨¡å—ï¼Œå†…å»ºæ¨¡å—ç»„ç»‡å½¢å¼1-å†…éƒ¨ç»“æ„struct node_module_struct int version; void *dso_handle; const char *filename; // æ¨¡å—çš„å…·ä½“åˆå§‹åŒ–æ–¹æ³• void (*register_func) (v8::Handlev8::Object target); const char *modname;2-å®šä¹‰æ¨¡å—è¢«åˆ›å»ºåå°±è‡ªç„¶è¦è¢«å®šä¹‰åˆ° nodeå‘½åç©ºé—´ ä¸­ï¼Œéœ€è¦é€šè¿‡ NODE_MODULEå® #define NODE_MODULE(modename, regfunc) extern C NODE_MODULE_EXPORT node::node_module_struct modname ## _module = NODE_STANDARD_MODULE_STUFF, regfunc, NODE_STRINGIFY(modename) 3-å–å‡ºNodeæä¾›äº† get_builtin_module() ä» node_module_list æ•°ç»„å–å‡ºè¿™äº›æ¨¡å— å†…å»ºæ¨¡å—å¯¼å‡ºNodeä½¿ç”¨ Binding() æ–¹æ³•å®ç°å†…å»ºæ¨¡å—çš„åŠ è½½,å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼šstep1-åˆ›å»ºä¸€ä¸ªexportsç©ºå¯¹è±¡exports = Object::New();step2-å–å‡ºå†…å»ºæ¨¡å—å¯¹è±¡modp = get_builtin_module(*module_v);step3-å¡«å……exportså¯¹è±¡modp-register_func(exports);step4-æŒ‰æ¨¡å—åç¼“å­˜exportså¯¹è±¡binding_cache-Set(module, exports);step5-æ ¸å¿ƒæ¨¡å—ç¼–è¯‘å†…å®¹çš„å–å‡ºä½¿ç”¨åˆ°Nodeæä¾›çš„å…¨å±€å˜é‡processNativeModule._source = process.binding(natives); æ ¸å¿ƒæ¨¡å—çš„å¼•å…¥æµç¨‹ä»¥osæ¨¡å—çš„å¼•å…¥ä¸ºä¾‹ Step1-ç”¨æˆ·è¯·æ±‚æ¨¡å—require(os)Step2-åˆ†æç¡®å®šæ˜¯æ ¸å¿ƒæ¨¡å—çš„è¯·æ±‚NativeModule.require(os)Step3-éœ€è¦å–å‡ºæ¨¡å—ä¸ºå­—ç¬¦ä¸²æ•°ç»„å¹¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²process.binding(os)Step4-éœ€è¦å–å‡ºæ¨¡å—å¯¹è±¡get_builtin_module(node_os)Step5-éœ€è¦å®šä¹‰æ¨¡å—å¯¹è±¡NODE_MODULE(node_os, reg_func) ç¼–å†™æ ¸å¿ƒæ¨¡å—å†…å»ºæ¨¡å—helloçš„å®ç° 1-ç¼–å†™å¤´æ–‡ä»¶2-ç¼–å†™C/C++æ–‡ä»¶3-æ·»åŠ è¿›æ‰©å±•æ•°ç»„ä¸­4-ç¼–è¯‘è¿›æ‰§è¡Œæ–‡ä»¶5-è¿è¡Œæ ¸å¿ƒæ¨¡å—å¤´æ–‡ä»¶node_hello.hå­˜æ”¾åˆ°srcç›®å½•ä¸‹#ifndef NODE_HELLO_H_#define NODE_HELLO_H_#include v8.hnamespace node // é¢„å®šä¹‰æ–¹æ³• v8::Handlev8::Value SayHello(const v8::Arguments args);å°†ç”¨äºå®ç°é¢„å®šä¹‰æ–¹æ³•çš„ node_hello.cc å­˜å‚¨åˆ° src ç›®å½•ä¸‹#include node.h#include node_hello.h#include v8.hnamespace node using namespace v8; // å®ç°é¢„å®šä¹‰æ–¹æ³• HandleValue SayHello(const Arguments args) HandleScope scope; return scope.Close(String::New(Hello world!)); // ç»™ä¼ å…¥çš„ç›®æ ‡å¯¹è±¡æ·»åŠ sayHelloæ–¹æ³• void Init_Hello(HandleObject target) target-Set( String::NewSymbol(sayHello), FunctionTemplate::New(SayHello) ) // æ³¨å†Œæ–¹æ³•åˆ°å†…å­˜ä¸­NODE_MODULE(node_hello, node::Init_Hello)éœ€è¦ä¿®æ”¹ srcnode_extensions.h ï¼Œå°†node_helloæ¨¡å—æ·»åŠ è¿›node_module_listæ•°ç»„ä¸­ä¿®æ”¹Nodeé¡¹ç›®ç”Ÿæˆæ–‡ä»¶ node.gypï¼Œç„¶åç¼–è¯‘æ•´ä¸ªNodeé¡¹ç›®let hello = process.binding(hello)hello.sayHello() // Hello World! CC++æ‰©å±•æ¨¡å—CC++æ¨¡å—å¼•å…¥çš„æœ€ä½³åœºåˆæ˜¯ä»€ä¹ˆ ç­”ï¼š é¢‘ç¹å‡ºç° ä½è¿ç®— çš„åœºåˆ,å¦‚ è½¬ç ã€ ç¼–ç  ç­‰è¿‡ç¨‹ã€‚è¿™æ˜¯å› ä¸ºJSé…±çš„ä½è¿ç®—å¾ˆå¼±å•¦ï¼ˆå‚²å¨‡ï¼‰C++ï¼šå“ï¼Œæ‹œæ‰˜ï¼Œå¼±å“ï¼Œä½ å¾ˆå¼±å“â€”â€”JavaScriptåªæœ‰ doubleç±»å‹ çš„æ•°æ®ç±»å‹ï¼Œä½è¿ç®—æ—¶éœ€è¦è½¬æ¢ä¸º intç±»å‹ï¼Œå› æ­¤æ•ˆç‡ä¸é«˜ã€‚ CC++æ‰©å±•æ¨¡å—çš„è·¨å¹³å°é—®é¢˜ ä¹‹å‰æåˆ°CC++æ‰©å±•æ¨¡å—ä¼šé¢„å…ˆç¼–è¯‘ä¸º .node æ–‡ä»¶ï¼Œè¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ª .node åç¼€åªæ˜¯ä¸ªåŒ…è£…ï¼ŒåŒ…è£…ä¹‹ä¸‹çš„å†…å®¹å®é™…å¦‚ä¸‹ï¼šwindowsç³»ç»Ÿä¸‹æ˜¯ .dll*nixç³»ç»Ÿä¸‹æ˜¯ .sodlopenæ–¹æ³•å®é™…ä¸Šå¯¹ä¸¤ç§æ–‡ä»¶åˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚ å‰ææ¡ä»¶GYPå·¥å…·V8å¼•æ“libuvåº“Nodeå†…éƒ¨åº“å…¶ä»–åº“å…¨ç§° Generate Your Projectsï¼Œç”¨äºç”Ÿæˆå„ä¸ªå¹³å°ä¸‹çš„é¡¹ç›®æ–‡ä»¶ï¼Œnode-gypæ˜¯ä¸ºNodeæä¾›çš„ä¸“æœ‰æ‰©å±•æ„å»ºå·¥å…·npm install -g node-gypV8å¼•æ“æœ¬èº«å°±æ˜¯ç”¨ C++ å†™æˆçš„ï¼Œå› æ­¤èƒ½å¤Ÿå®ç° JavaScript å’Œ C++ çš„ç›¸äº’è°ƒç”¨Nodeèƒ½å¤Ÿå®ç°è·¨å¹³å°çš„è¯€çªï¼Œå®ƒæ”¯æŒNodeè°ƒç”¨åº•å±‚æ“ä½œï¼ˆäº‹ä»¶å¾ªç¯ã€æ–‡ä»¶æ“ä½œç­‰ï¼‰Nodeè‡ªèº«æä¾›çš„ä¸€äº›C++ä»£ç ã€‚å­˜åœ¨ depsç›®å½• ä¸‹ã€‚ CC++æ‰©å±•æ¨¡å—çš„ç¼–å†™CC++æ‰©å±•æ¨¡å—çš„ç¼–è¯‘CC++æ‰©å±•æ¨¡å—çš„åŠ è½½æ¨¡å—è°ƒç”¨æ ˆæ¨¡å—ä¹‹é—´çš„è°ƒç”¨å…³ç³» æ ¸å¿ƒæ¨¡å—CC++å†…å»ºæ¨¡å—ï¼šæœ€åº•å±‚çš„æ¨¡å—JavaScriptæ¨¡å—ï¼šä½œä¸ºå†…å»ºæ¨¡å—çš„ å°è£…å±‚å’Œæ¡¥é˜¶å±‚ä¾›æ–‡ä»¶æ¨¡å—è°ƒç”¨æ–‡ä»¶æ¨¡å—CC++æ‰©å±•æ¨¡å—JavaScriptæ¨¡å—ï¼šçº¯ç²¹åŠŸèƒ½æ¨¡å— åŒ…ä¸NPMnpmå®˜ç½‘https://www.npmjs.org/ ä¸€ä¸ªå¯¹npmåŒ…ä¸‹è½½æ•°é‡è¿›è¡Œæ’åçš„ç½‘ç«™http://npmrank.net/ anvakaç»Ÿè®¡çš„19å¹´ä¹‹å‰å®‰è£…æ¬¡æ•°å‰1000ånpmåŒ…https://gist.github.com/anvaka/8e8fa57c7ee1350e3491 CommonJSçš„åŒ…è§„èŒƒ åŒ…å’ŒNPMå°±æ˜¯å°†æ¨¡å—è”ç³»èµ·æ¥çš„ä¸€ç§æœºåˆ¶ï¼Œå°±åƒæ˜¯å°†ä¸åŒç”Ÿç‰©è”ç³»åˆ°ä¸€èµ·çš„é£Ÿç‰©é“¾CommonJSåŒ…è§„èŒƒè§„å®šåŒ…ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šåŒ…æè¿°æ–‡ä»¶åŒ…ç»“æ„æ–‡ä»¶ åŒ…ç»“æ„åŒ…è¿™ä¸ªæ¦‚å¿µå¯èƒ½è¿‡äºæŠ½è±¡ï¼Œå…·ä½“äº›è¯´ï¼ŒåŒ…å®é™…å°±æ˜¯ä¸€ä¸ªå­˜æ¡£æ–‡ä»¶ï¼ˆ.ziptar.gzï¼‰ å®Œå…¨ç¬¦åˆCommonJSè§„èŒƒçš„åŒ…ç›®å½• package.json åŒ…æè¿°æ–‡ä»¶lib å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ç›®å½•bin JavaScriptæ–‡ä»¶ç›®å½•doc æ–‡æ¡£ç›®å½•test å•å…ƒæµ‹è¯•ç”¨ä¾‹ç›®å½• åŒ…æè¿°æ–‡ä»¶ä¸NPMpackage.json package.jsonä½äºåŒ…çš„æ ¹ç›®å½•ä¸‹ï¼ŒCommonJSä¸ºå…¶å®šä¹‰äº†ä¸€äº›æè¿°å­—æ®µï¼šå¿…éœ€å­—æ®µ name åŒ…å åŒ…åä¸èƒ½å‡ºç°ç©ºæ ¼ï¼Œå¯ä»¥åŒ…å«å¦‚ä¸‹å­—ç¬¦ï¼š å°å†™å­—æ¯ æ•°å­— . _ â€œnameâ€: â€œgoodbye-worldâ€ description åŒ…ç®€ä»‹ â€œdescriptionâ€: â€œworld:why everybody has to say hello to me?â€ version ç‰ˆæœ¬å· è¯­ä¹‰åŒ–ç‰ˆæœ¬å·çš„è¯¦ç»†å®šä¹‰https://semver.org/ â€œversionâ€: â€œ1.0.0â€ keywords å…³é”®è¯æ•°ç»„ ç”¨äºåšåˆ†ç±»æœç´¢ â€œkeywordsâ€: [â€œjeusttestâ€, â€œdontdownloadâ€, â€œgoawayâ€] maintainers åŒ…ç»´æŠ¤è€…åˆ—è¡¨ æ¯ä¸ªç»´æŠ¤è€…åŒ…å« name email web maintainers: [{name:God, email:highestgod@heaven.com,web:www.notwelcomemotals.com}] ç”¨äºæƒé™è®¤è¯çš„å­—æ®µ contributors è´¡çŒ®è€…åˆ—è¡¨ bugs ä¸€ä¸ªå¯ä»¥åé¦ˆbugçš„åœ°å€ licenses è®¸å¯è¯åˆ—è¡¨ repositories æ‰˜ç®¡æºä»£ç ä½ç½® dependencies ä¾èµ–åŒ…åˆ—è¡¨ å¯é€‰å­—æ®µ hoempage åŒ…çš„ç½‘ç«™åœ°å€ os æ“ä½œç³»ç»Ÿæ”¯æŒåˆ—è¡¨ åŒ…æ‹¬ aixã€freebsdã€linuxã€macosã€solarisã€vxworksã€windows ç­‰ cpu CPUæ¶æ„æ”¯æŒåˆ—è¡¨ åŒ…æ‹¬ armã€mipsã€ppcã€sparcã€x86ã€x86_64 ç­‰ engine æ”¯æŒçš„JavaScriptå¼•æ“åˆ—è¡¨ åŒ…æ‹¬ v8ã€ejsã€flusspferdã€gpseeã€jscã€spidermonkeyã€narwhal ç­‰ builtin åº•å±‚å†…å»ºæ¨¡å—çš„æ ‡å¿— directories åŒ…ç›®å½•è¯´æ˜ implements å®ç°è§„èŒƒåˆ—è¡¨ scripts è„šæœ¬è¯´æ˜å¯¹è±¡ NPMå®é™…éœ€è¦çš„å­—æ®µ author åŒ…ä½œè€… bin ç”¨äºæ·»åŠ åˆ°æ‰§è¡Œè·¯å¾„åœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è°ƒç”¨çš„è„šæœ¬ main æŒ‡å®šæ¨¡å—å…¥å£ DevDependencies åªåœ¨å¼€å‘æ—¶éœ€è¦çš„ä¾èµ– NPMæœ€åˆæ˜¯ç”± Isaac Z. Schlueter å•ç‹¬åˆ›å»ºçš„ï¼Œä½†åœ¨v0.6.3ç‰ˆæœ¬æ—¶è¢«é›†æˆè¿›Nodeä½œä¸º é»˜è®¤åŒ…ç®¡ç†å™¨ å±€åŸŸNPMè€ƒè™‘åˆ°æ¨¡å—ä¿å¯†æ€§ï¼Œä¼ä¸šä¸€èˆ¬æ­å»ºè‡ªå·±çš„NPMä»“åº“ã€‚ å¦‚ä½•æ­å»ºå±€åŸŸNPMä»“åº“ï¼Ÿ ä¸æ­å»ºé•œåƒç«™æ–¹å¼å‡ ä¹ä¸€æ ·ï¼Œé™„å½•Då¾…è¡¥å…… åŸæ–‡ä½œè€…æåˆ°å±€åŸŸNPMä»“åº“æ­å»ºçš„ä¸€ä¸ªç”¨å¤„ï¼Œå¾ˆæœ‰è¶£ï¼š â€ä¸è‡³äºè®©å„ä¸ªå°é¡¹ç›®å„è‡ªç»´æŠ¤ç›¸åŒåŠŸèƒ½çš„æ¨¡å—ï¼Œï¼ˆé‡å¤åŠ³åŠ¨ï¼‰æœç»é€šè¿‡å¤åˆ¶ç²˜è´´å®ç°ä»£ç å…±äº«çš„è¡Œä¸ºã€‚ï¼ˆæ— è„‘é‡å¤ï¼‰â€œ æ€æ ·è¯„ä»·ä¸€ä¸ªåŒ…çš„è´¨é‡NPMå¹³å°ä¸Šæœ‰æˆåƒä¸Šä¸‡ä¸ªåŒ…ï¼Œå¯¹æ¨¡å—å“è´¨è¿›è¡Œåˆ¤æ–­å¹¶ä¸å®¹æ˜“ï¼Œ ç‰¹åˆ«æ˜¯ï¼š åŒ…è´¨é‡ å®‰å…¨é—®é¢˜ å› æ­¤å¼€å‘é‡‡çº³åŒ…å¾ˆå¤šæ—¶å€™ä¹Ÿæ˜¯æ ¹æ® å£ç¢‘æ•ˆåº”ã€‚ æ¨¡å—å£ç¢‘å‚è€ƒæ–¹å¼ NPMæ¨¡å—é¦–é¡µä¾èµ–æ¦œ https://www.npmjs.com/ GitHub è§‚å¯Ÿè€…æ•°é‡ æµè¡Œåº¦ åŒ…ç»“æ„ æµ‹è¯•ç”¨ä¾‹ æ–‡æ¡£çŠ¶å†µ åŒ…å®‰å…¨æ£€æŸ¥ å®‰å…¨æ£€æŸ¥çš„éš¾ç‚¹ä¸»è¦åœ¨äº CC++æ‰©å±•æ¨¡å—ï¼Œå¯¹äºæ¨¡å—å®‰å…¨çš„æ£€æŸ¥ï¼ŒIsaac Z. Schlueter æå‡ºäº†ä¸€ä¸ªæœ‰è¶£çš„è¯ï¼šKwaliteeâ€œKwaliteeâ€ is something that looks like quality, sounds like quality,but is not quite quality.æ„æ€å°±æ˜¯å¾ˆå¤šæ¨¡å—è¡¨é¢çœ‹ä¸Šå»å¾ˆä¼˜è´¨ï¼Œä½†ä¹Ÿä¸ä¸€å®šçœŸæ­£æ˜¯é«˜è´¨é‡æ¨¡å—ã€‚æ¯”è¾ƒå¸¸ç”¨çš„è€ƒæŸ¥ç‚¹å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›ï¼šè¦†ç›–ç‡è¾ƒé«˜çš„æµ‹è¯•æ¨¡å—æ–‡æ¡£ç¼–ç è§„èŒƒ"},{"title":"ç¬¬å››ç«  å¼‚æ­¥ç¼–ç¨‹","path":"/wiki/Node/pl_04_async.html","content":"å‡½æ•°å¼ç¼–ç¨‹é«˜é˜¶å‡½æ•° å³å°†å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è¿”å›å€¼çš„å‡½æ•°function foo(x) return function() return x; é«˜é˜¶å‡½æ•°æ˜¯å›è°ƒå‡½æ•°å’Œæ·±å±‚åµŒå¥—çš„åŸºç¡€ åå‡½æ•° åå‡½æ•°ç”¨äºåˆ›å»ºä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç‰¹å¾çš„å‡½æ•°ï¼Œå³æ‰€è°“çš„å·¥å‚å‡½æ•°ã€‚åå‡½æ•°æ¡ˆä¾‹1é‡å¤å®ç°ç±»å‹åˆ¤æ–­å‡½æ•°ï¼šlet isString = function(obj) return toString.call(obj) == [object Stirng]let isFunction = function(obj) return toString.call(obj) == [object Function]å¼•å…¥ç±»å‹åˆ¤æ–­å·¥å‚å‡½æ•°ï¼šlet isType = function(type) return function(obj) return toString.call(obj) == `[object $type]`; åå‡½æ•°æ¡ˆä¾‹2æºè‡ªè‘—åç±»åº“Underscoreçš„ after() æ–¹æ³•çš„å®ç°ï¼š// ç”Ÿæˆä¸€ä¸ªéœ€è¦è°ƒç”¨å¤šæ¬¡æ‰èƒ½æ‰§è¡Œçš„å‡½æ•°let _after = function(time,func) if(time=0) return func() return function() if(--time = 0) return func.apply(this,arguments) let after_hello = _after(3,function()console.log(hello))after_hello() // -after_hello() // -after_hello() // hello å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜åŠ¿ä¸éš¾ç‚¹å®ç°å¼‚æ­¥çš„ä¸€èˆ¬æ–¹å¼å³äº‹ä»¶å¾ªç¯å’Œçº¿ç¨‹æ± æœºåˆ¶ï¼Œä½†è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼š é€šè¿‡CC++è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚æ¥å£ï¼Œæ‰‹åŠ¨å®ç°å¼‚æ­¥IO ä¼˜åŠ¿Nodeä¸äº‘è®¡ç®— éé˜»å¡IOå¯ä»¥ä½¿CPUä¸IOä¸ç”¨ç›¸äº’ç­‰å¾…ï¼Œè¿™ç§ç»„ç»‡èµ„æºçš„æ–¹å¼ç¬¦åˆåˆ†å¸ƒå¼å’Œäº‘çš„éœ€è¦ å¼‚æ­¥I/Oè°ƒç”¨ç¤ºæ„å›¾ åŒæ­¥I/Oè°ƒç”¨ç¤ºæ„å›¾ IOå¯†é›†ä¸CPUå¯†é›† äº‹ä»¶å¾ªç¯ä¸­ï¼ŒJavaScriptå’ŒIOçº¿ç¨‹æ± åˆ†é¥°ä¸¤è§’ï¼šJavaScriptï¼ˆæ”¿å®¢ï¼‰ï¼šåˆ†é…ä»»åŠ¡+å¤„ç†ç»“æœIOçº¿ç¨‹æ± ï¼ˆå…¬åŠ¡å‘˜ï¼‰ï¼šæ‰§è¡Œä»»åŠ¡æœ€å…¸å‹çš„åº”ç”¨å³UIç¼–ç¨‹ï¼Œå› æ­¤Nodeæ›´é€‚åˆIOå¯†é›†å‹åœºæ™¯Nodeåœ¨CPUå¯†é›†å‹åº”ç”¨çš„ä¼˜åŒ–V8çš„ä¼˜åŒ–ä½¿å¾—JavaScriptæœ¬èº«çš„æ€§èƒ½å°±å¾ˆå‡ºè‰²ï¼Œä½†Nodeåœ¨CPUå¯†é›†å‹ä¸Šçš„æ€§èƒ½è¿˜éœ€è¦è€ƒè™‘JavaScriptä»£ç ç»„ç»‡çš„æ–¹å¼ï¼Œç®€å•æ¥è¯´ï¼šåªè¦CPUè®¡ç®—ä¸å½±å“IOçš„è°ƒåº¦ï¼Œå°±æ²¡æœ‰é—®é¢˜ã€‚å»ºè®®CPUè€—ç”¨ä¸è¶…è¿‡10msï¼Œå¯ä»¥å°†å¤§é‡çš„è®¡ç®—åˆ†è§£ä¸ºå°é‡è®¡ç®—ï¼Œç„¶åé€šè¿‡setImmediateè°ƒåº¦ éš¾ç‚¹å¼‚å¸¸å¤„ç†å‡½æ•°åµŒå¥—è¿‡æ·±é˜»å¡ä»£ç å¤šçº¿ç¨‹ç¼–ç¨‹å¼‚æ­¥è½¬åŒæ­¥æ— æ³•é€šè¿‡trycatchæ“ä½œæŠ“ä½å¼‚æ­¥IOå›è°ƒå‡½æ•°çš„é”™è¯¯ const async = function (callback) process.nextTick(callback)const err = function () throw new Error(Catch me if you can)try async(err) catch (e) console.log(catch you!) // catchæ— æ•ˆ ä¸ºäº†æ•æ‰å›è°ƒå‡½æ•°çš„å¼‚å¸¸ï¼Œå‡ºç°ä¸€ç§çº¦å®šï¼š å°†å¼‚å¸¸ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚ function async(callback) process.nextTick(function () let results = hello try // å¤„ç†è¿‡ç¨‹å­˜åœ¨é”™è¯¯ throw new Error(catch me if you can) catch (e) callback(e) // è¿”å›é”™è¯¯ return callback(null,results) )function callback(err, results) if (err) console.log(catch you!) else console.log(results) async(callback)å½“å¤šä¸ªæ“ä½œä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸‹é¢è¿™ç§ç»“æ„ï¼š // å…ˆè·å–æ¨¡æ¿fs.readFile(template_path, utf_8, function(err, template) db.query(sql, function(err, data) // å†è·å–æ•°æ® 110n.get(function(err,resources) // æœ€ç»ˆè·å–èµ„æº ) ))JavaScriptæ— æ³•å®ç°çº¿ç¨‹æ²‰ç¡åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯ä¸€ç§ç›¸å½“ç³Ÿç³•çš„æ¨¡æ‹Ÿsleepçš„æ–¹å¼ï¼š let start = new Date()// CPUï¼šè¿™ä»€ä¹ˆå¤±çœ æ“ä½œï¼Ÿwhile(new Date() - start1000)å½“æåˆ°JavaScriptçš„å•çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œ æµè§ˆå™¨å±‚é¢æŒ‡çš„æ˜¯ UIæ¸²æŸ“å’ŒJavaScriptæ‰§è¡Œç”¨çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ Nodeå±‚é¢åˆ™æŒ‡ Nodeè¿›ç¨‹æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUæ‰§è¡Œ Web Workers æµè§ˆå™¨ç«¯æå‡ºçš„Web Workerså…·æœ‰ä»¥ä¸‹å‡ ç§ä½œç”¨ï¼šå°†JavaScriptæ‰§è¡Œä¸UIæ¸²æŸ“åˆ†ç¦»ä½¿ç”¨CPUå‡å°‘é˜»å¡UIæ¸²æŸ“é—®é¢˜ä½†å¹¶æ²¡æœ‰ä¼˜åŒ–UIæ¸²æŸ“æ•ˆç‡å¯åˆ©ç”¨å¤šæ ¸CPUè¿›è¡Œå¤§é‡è®¡ç®—åˆ©ç”¨æ¶ˆæ¯æœºåˆ¶çš„ç†æƒ³æ¨¡å‹Web Workersçš„æ¶ˆæ¯æœºåˆ¶ Web Workersç”±äºæµè§ˆå™¨æ ‡å‡†åŸå› å¹¶æ²¡æœ‰å¹¿æ³›æ¨å¹¿å¼€æ¥ï¼Œä½†Nodeä¸­å€Ÿé‰´äº†Web Workersçš„æ¨¡å¼ï¼šchild_processä½œä¸ºåŸºç¡€åº”ç”¨clusteræ¨¡å—ä¸ºæ›´æ·±å±‚æ¬¡åº”ç”¨å¼‚æ­¥ç¼–ç¨‹é£æ ¼å¯¹å¼€å‘è€…çš„å‰¯ä½œç”¨ä¸å°‘ï¼Œå¦‚ï¼š åµŒå¥—å›è°ƒ ä¸šåŠ¡åˆ†æ•£ ä½†é€šè¿‡è‰¯å¥½çš„æµç¨‹æ§åˆ¶ï¼Œè¿˜æ˜¯èƒ½å¤Ÿå°†é€»è¾‘æ¢³ç†æˆé¡ºåºå½¢å¼ å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆäº‹ä»¶å‘å¸ƒè®¢é˜…æ¨¡å¼events Node documentation - Eventshttps://nodejs.org/docs/latest/api/events.htmlconst EventEmitter = require(node:events)class MyEmitter extends EventEmitterconst myEmitter = new MyEmitter()myEmitter.on(event,()= //æ·»åŠ ç›‘å¬å™¨ console.log(event occured!))myEmitter.emit(event) // event occured!emitè°ƒç”¨çš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥è§¦å‘çš„const emit = new EventEmitter() //äº‹ä»¶å‘å¸ƒè€…const eventName = event // äº‹ä»¶åç§°emit.on(eventName, ä¾¦å¬å™¨1)emit.on(eventName, ä¾¦å¬å™¨2)emit.on(eventName, ä¾¦å¬å™¨3) äº‹ä»¶å‘å¸ƒè®¢é˜…æ¨¡å¼çš„å‡ ä¸ªä¸»è¦ä½œç”¨ è§£è€¦ä¸šåŠ¡é€»è¾‘é’©å­æœºåˆ¶ä¸€ä¸ªäº‹ä»¶èƒ½å¤Ÿç»‘å®šå¤šä¸ªä¾¦å¬å™¨ï¼Œäº‹ä»¶å‘å¸ƒè€…æ— éœ€å…³æ³¨è®¢é˜…ä¾¦å¬å™¨å¦‚ä½•å®ç°ä¸šåŠ¡é€»è¾‘ã€‚äº‹ä»¶çš„è®¾è®¡å…³ä¹å¤–éƒ¨è°ƒç”¨ç»„ä»¶æ—¶æ˜¯å¦ä¼˜é›…é’©å­ï¼ˆhookï¼‰æœºåˆ¶å³å¯¼å‡ºå†…éƒ¨æ•°æ®æˆ–çŠ¶æ€ç»™å¤–éƒ¨è°ƒç”¨è€…ï¼Œ const http = require(http)const options = host: 127.0.0.1, port: 8080, path: /anypath, method: POSTconst req = http.require(options, function (res) console.log(`STATUS: $res.statusCode`) console.log(`HEADERS: $JSON.stringify(res.headers)`) res.setEncoding(utf8) // è·å–æ•°æ®é’©å­ res.on(data, function (chunk) console.log(`BODY: $chunk`) ) // ç»“æŸè¿æ¥é’©å­ res.on(end,function()) // æŠ¥é”™é’©å­ res.on(error, function (e) console.log(`problem with request: $e.message`) ) req.write(data ) req.write(data ) req.end()) äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶çš„å¥å£®æ€§ ä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡10æ¡ä¾¦å¬å™¨ä¼šå¾—åˆ°ä¸€æ¡è­¦å‘Šï¼š/** * MaxListenersExceededWarning: * Possible EventEmitter memory leak detected. * 11 triggers listeners added to [EventEmitter]. * Use emitter.setMaxListeners() to increase limit */const EventEmitter = require(node:events)const emitter = new EventEmitter()for (let i = 0; i 11; i++) emitter.on(event,function())emitter.emit(event)è¿™æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼è€Œè®¾ç½®çš„è­¦å‘Šï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨setMaxListenerså»æ‰é™åˆ¶ï¼šconst emitter = new EventEmitter()emitter.setMaxListeners(0) //for (let i = 0; i 11; i++) emitter.on(event,function())erroräº‹ä»¶å¦‚æœé”™è¯¯è§¦å‘äº†erroräº‹ä»¶ï¼ŒEventEmitterä¼šå¯¹erroräº‹ä»¶è¿›è¡Œæ£€æµ‹ï¼šæ³¨å†Œè¿‡erroräº‹ä»¶ï¼Œå°†äº¤ç”±ä¾¦å¬å™¨å¤„ç†æœªæ³¨å†Œè¿‡ï¼Œä½œä¸ºå¼‚å¸¸æŠ›å‡º è¡¥å……ç‚¹ ç»§æ‰¿eventsæ¨¡å—Nodeçš„utilæ¨¡å—ä¸­å°è£…äº†ç»§æ‰¿çš„æ–¹æ³•inherits const events = require(events)const util = require(util)function Stream() events.EventEmitter.call(this)// Streamç»§æ‰¿äº†EventEmitterutil.inherits(Stream, events.EventEmitter)const emitter = new Stream()emitter.on(event, function () console.log(hello world))emitter.emit(event) // hello worldåˆ©ç”¨äº‹ä»¶é˜Ÿåˆ—è§£å†³é›ªå´©é—®é¢˜ é›ªå´©çš„ä¸€ç§å…¸å‹åœºæ™¯ï¼šç”¨æˆ·é‡è¯•å¯¼è‡´ç³»ç»Ÿè´Ÿè½½å‡é«˜ï¼Œé›†ä¸­åˆ°æœåŠ¡å™¨ç«¯å³é‡å¤äº‹ä»¶å“åº” æ‰€è°“é›ªå´©ï¼Œå°±æ˜¯åœ¨é«˜è®¿é—®é‡ã€å¤§å¹¶å‘é‡çš„æƒ…å†µä¸‹ç¼“å­˜å¤±æ•ˆçš„æƒ…æ™¯ï¼Œå¦‚ä¸‹æ˜¯ä¸€æ¬¡sqlæŸ¥è¯¢çš„è°ƒç”¨ let select = function (callback) db.select(SQL, function (results) callback(results) ) è¿™æ—¶å¦‚æœåŒæ—¶å‡ºç°ä¸‹é¢ä¸¤ç§æƒ…å†µå°±ä¼šå‡ºç°é›ªå´©ï¼š ç«™ç‚¹åˆšå¯åŠ¨ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨æ•°æ® è®¿é—®é‡å·¨å¤§ï¼ŒåŒä¸€æ¡SQLå‘é€åˆ°æ•°æ®åº“ä¸­é‡å¤æŸ¥è¯¢ å› æ­¤å¯ä»¥å¼•å…¥çŠ¶æ€é”ï¼š let _status = ready // çŠ¶æ€é”const select = function (callback) if (_status === ready) _status = pending //æš‚æ—¶æ‹’ç»å—ç†å…¶ä»–è¯·æ±‚ db.select(SQL, function (results) _status = ready //å—ç†ç»“æŸåå°†çŠ¶æ€é‡æ–°ä¿®æ”¹ä¸ºready callback(results) ) ä½†åªæœ‰ç¬¬ä¸€ä¸ªå‘é€çš„è¯·æ±‚èƒ½è·å–åˆ°æ•°æ®ï¼Œå…¶ä»–çš„è¯·æ±‚éƒ½è¢«pendingæ‹’ä¹‹é—¨å¤–äº† è§£å†³æ–¹æ³•ï¼šonce é€šè¿‡onceæ·»åŠ çš„ä¾¦å¬å™¨åªä¼šæ‰§è¡Œä¸€æ¬¡ const events = require(events)const proxy = new events.EventEmitter()let status = readyfunction selected(callback) proxy.once(select, callback) if (status === ready) status = pending db.select(SQL, function (results) proxy.emit(selected, results) status = ready ) Gearmanå¼‚æ­¥åº”ç”¨æ¡†æ¶ä¹Ÿèƒ½å®ç°è¿™ç§æ•ˆæœå¤šå¼‚æ­¥ä¹‹é—´çš„åä½œæ–¹æ¡ˆå½“ä¸€ä¸ªä¸šåŠ¡é€»è¾‘éœ€è¦ä¾èµ–å¤šä¸ªé€šè¿‡å›è°ƒæˆ–äº‹ä»¶ä¼ é€’çš„ç»“æœæ—¶ï¼Œå°±å¯èƒ½å‡ºç°åµŒå¥—è¿‡æ·±çš„é—®é¢˜ï¼š function handle() // æœ‰äº›å›è°ƒå‡½æ•°çœ‹èµ·æ¥æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œå®é™…å®Œå…¨æ˜¯ä¸²è¡Œ onehandler(()= twohandler(()= threehandler(()= // åˆ«é—®ï¼Œé—®å°±æ˜¯å›è°ƒè‰ºæœ¯ ) ) ) æ¡ˆä¾‹ï¼šå›è°ƒåµŒå¥—è¿‡æ·±çš„é¿å… æ¸²æŸ“é¡µé¢éœ€è¦å¼‚æ­¥è¯·æ±‚ä¸‰ç±»èµ„æºï¼šæ¨¡æ¿æ•°æ®æœ¬åœ°åŒ–èµ„æºlet count = 0 // å“¨å…µå˜é‡let results = function done(key, value) count++ results[key] = value if (count = 3) render(results) // è¯»å–æ¨¡æ¿fs.readFile(template_path, utf8, (err, template) = done(template, template))// è¯»å–æ•°æ®db.query(sql, (err, data) = done(data, data))// è¯»å–æœ¬åœ°åŒ–èµ„æºl10n.get((err, resources) = done(resources, resources))å“¨å…µå˜é‡ï¼šå€ŸåŠ©ä¸€ä¸ªç¬¬ä¸‰æ–¹å‡½æ•°å˜é‡æ¥å¤„ç†å¼‚æ­¥åä½œçš„ç»“æœ åå‡½æ•°+å“¨å…µå˜é‡ function after(time, callback) let result = let count = 0 return function (key, value) result[key] = value count++ if (count = time) callback(result) const done = after(3, render) äº‹ä»¶ä¸ä¾¦å¬å™¨çš„å…³ç³» ä¸€å¯¹å¤š é€šè¿‡è®¢é˜…æ¨¡å¼å®ç°ä¾¦å¬å™¨å‘æ•£emitter.on(event,listener1)emitter.on(event,listener2)å¤šå¯¹ä¸€ é€šè¿‡åå‡½æ•°å®ç°äº‹ä»¶æ”¶æ•›const done = after(times, callback)emitter.on(event1, done)emitter.on(event2, done)EventProxyçš„åŸç†npm - eventproxyhttps://www.npmjs.com/package/eventproxy EventProxy.all EventProxy.all(e1,e2,â€¦,listener)listenerå‚æ•°é¡ºåºä¸è®¢é˜…ç»„åˆäº‹ä»¶åˆ—è¡¨çš„å‚æ•°æ˜¯ä¸€ä¸€å¯¹åº”çš„å½“æ¯ä¸ªäº‹ä»¶éƒ½è¢«è§¦å‘ä¹‹åï¼Œä¾¦å¬å™¨æ‰ä¼šæ‰§è¡Œconst EventProxy = require(./node_modules/eventproxy/index)const proxy = new EventProxy()proxy.all( template, data, resources, function (template, data, resources) console.log(...arguments) // template data resources )proxy.on(template, res = res)proxy.on(data, res = res)proxy.on(resources, res = res)proxy.emit(template,template)proxy.emit(data,data)proxy.emit(resources,resources) EventProxy.tail EventProxy.tailä¸allçš„åŒºåˆ«åœ¨äºï¼šç»„åˆäº‹ä»¶ä¸­æŸä¸ªäº‹ä»¶è¢«å†æ¬¡è§¦å‘ï¼Œä¾¦å¬å™¨ä¼šä½¿ç”¨æœ€æ–°çš„æ•°æ®ç»§ç»­æ‰§è¡Œconst EventProxy = require(./node_modules/eventproxy/index)const proxy = new EventProxy()proxy.on(eventA, res = res)proxy.on(eventB, res = res)proxy.all(eventA, eventB, (a, b) = console.log(`all: $a $b`))proxy.tail(eventA, eventB, (a, b) = console.log(`tall: $a $b`))proxy.emit(eventA, AAA)proxy.emit(eventB, BBB)proxy.emit(eventA, AAAAAAA)// output:// all: AAA BBB// tail: AAA BBB// tail: AAAAAAA BBB EventProxy.after EventProxy.after(event, time, listener)listenerä¼šåœ¨eventäº‹ä»¶è§¦å‘timeæ¬¡åæ‰§è¡Œconst EventProxy = require(./node_modules/eventproxy/index)const proxy = new EventProxy()proxy.after(event, 3, (data) = console.log(data) // [AAA, BBB, CCC])proxy.on(event, res = res)proxy.emit(event, AAA)proxy.emit(event, BBB)proxy.emit(event, CCC) EventProxyåŸºæœ¬åŸç† npm - backbonehttps://www.npmjs.com/package/backboneEventProxyæ¥è‡ªäºBackboneJsçš„äº‹ä»¶æ¨¡å—EventProxyçš„å¼‚å¸¸å¤„ç†æ‰‹åŠ¨æ•æ‰æ¯ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚çš„å¼‚å¸¸éå¸¸éº»çƒ¦ï¼š const EventProxy = require(./node_modules/eventproxy/index)const ep = new EventProxy()ep.all(tpl, data, function (tpl, data) callback(null, template: tpl, data: data ))// æ‰‹åŠ¨ç»‘å®šå¼‚å¸¸å¤„ç†ep.bind(error, function (err) ep.unbind() callback(err))fs.readFile(template.tpl, utf-8, function (err, content) if (err) return ep.emit(error,err) ep.emit(tpl, content))db.get(some sql, function (err, result) if (err) return ep.emit(error, err) ep.emit(data,result)) fail done EventProxy.fail ç»‘å®šé”™è¯¯å¤„ç†å‡½æ•°EventProxy.done è¿›è¡Œå¼‚å¸¸å¤„ç† function callback(err, res) if (err) console.log(err) return console.log(res)const EventProxy = require(./node_modules/eventproxy/index)const ep = new EventProxy()ep.all(eventA, eventB, function (returnA, returnB) callback(null, returnA, returnB ))ep.fail(callback)ep.on(eventA, res = res)ep.on(eventB, res = res)ep.done(eventA)(null, AAA)ep.done(eventB)(eventB-error, BBB) // eventB-errorfailep.fail(callback)ç­‰åŒäºep.fail(function(err) callback(err))ç­‰åŒäºep.bind(error, function(err) ep.unbind() callback(err))donedoneæ–¹æ³•å®é™…ä¸Šæ˜¯å¯¹äº‹ä»¶è§¦å‘çš„ä¸€ç§åŒ…è£…ep.done(eventName)ep.done(event)ç­‰åŒäºfunction (err, content) if(err) return ep.emit(error, err) ep.emit(event, content)ep.done(contentFun)doneä¸­ä¹Ÿåªä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä½†éœ€è¦åœ¨å‡½æ•°ä¸­æ‰‹åŠ¨emitep.done((content)= ep.emit(event,content))ç­‰åŒäºfunction(err,content) if(err) return ep.emit(error,err) (function(content) ep.emit(event,content) (content))ep.done(eventName, contentFun)ä¹Ÿå¯ä»¥å³ä¼ å…¥äº‹ä»¶åç§°ï¼Œåˆä¼ å…¥å›è°ƒå‡½æ•°ï¼Œè¿™é‡Œçš„å›è°ƒå‡½æ•°ä¸»è¦æ˜¯ç”¨äºå¤„ç†è¿”å›å€¼çš„ep.done(event,function(content) // å¯¹contentåšä¸€äº›å¤„ç† return content)ç­‰åŒäºfunction(err, content) if(err) return ep.emit(error, err) ep.emit(event,(function(content) // å¯¹contentåšä¸€äº›å¤„ç† return content )(content)) PromiseDeferredæ¨¡å¼åœ¨äº‹ä»¶è®¢é˜…æ¨¡å‹ä¸­ï¼Œäº‹ä»¶æ‰§è¡Œåçš„å›è°ƒå‡½æ•°éœ€è¦åœ¨æ³¨å†Œæ—¶å°±æ˜ç¡®æŒ‡å®š emitter.emit(event,callback) PromiseDeferredæ¨¡å¼å¯ä»¥è¯´æ˜¯ä¸€ç§å…ˆæ‰§è¡Œå¼‚æ­¥è°ƒç”¨å»¶è¿Ÿå¤„ç†çš„æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æœ€æ—©å‡ºç°åœ¨Dojoä¸­ï¼š Dojo Tookithttps://dojotoolkit.org/ å¼‚æ­¥PromiseDeferredæ¨¡å‹ PromisesAå¯¹å¼‚æ­¥æ“ä½œä¸‹äº†ä¸‰ä¸ªæŠ½è±¡å®šä¹‰ï¼šPromiseæ“ä½œä»…å­˜åœ¨3ç§çŠ¶æ€ï¼šæœªå®Œæˆæ€å®Œæˆæ€å¤±è´¥æ€PromiseçŠ¶æ€åªå­˜åœ¨ä¸¤ç§è½¬åŒ–è¿‡ç¨‹ï¼šæœªå®Œæˆæ€ â†’ å®Œæˆæ€æœªå®Œæˆæ€ â†’ å¤±è´¥æ€PromiseçŠ¶æ€ä¸€æ—¦è½¬å˜ï¼Œå°†ä¸èƒ½è¢«æ›´æ”¹thenæ–¹æ³•thenæ–¹æ³•å®é™…åšçš„äº‹å°±æ˜¯ï¼šå°†å›è°ƒå‡½æ•°å­˜æ”¾èµ·æ¥then(fulfilledHandler, errorHandler, progressHandler)fullfilledHandler å®Œæˆæ€å›è°ƒæ–¹æ³•errorHandler é”™è¯¯æ€å›è°ƒæ–¹æ³•progressHandler progressäº‹ä»¶å›è°ƒæ–¹æ³•ä½¿ç”¨eventså®Œæˆthençš„ç®€å•å®ç°const EventEmitter = require(events).EventEmitterconst Promise = function () EventEmitter.call(this)util.inherits(Promise, EventEmitter)Promise.prototype.then = function (fullfilledHandler, errorHandler, progressHandler) if (typeof fullfilledHandler === function) this.once(success, fullfilledHandler) if (typeof errorHandler === function) this.once(error, errorHandler) if (typeof progressHandler === function) this.once(progress, progressHandler) return thisäº‹ä»¶éƒ½æ³¨å†Œä¹‹åï¼Œå¦‚ä½•è§¦å‘è¿™äº›äº‹ä»¶ï¼ŸDeferred å»¶è¿Ÿå¯¹è±¡let Deferred = function () this.state = unfilfilled this.promise = new Promise()Deferred.prototype.resolve = function (obj) this.state = fulfilled this.promise.emit(success, obj)Deferred.prototype.reject = function (err) this.state = failed this.promise.emit(error, err)Deferred.prototype.progress = function (data) this.promise.emit(progress, data)å“åº”å¯¹è±¡çš„å°è£…å…¸å‹å“åº”å¯¹è±¡çš„å°è£…ï¼šres.setEncoding(utf8)res.on(data, function (chunk) console.log(BODY: + chunk))res.on(end, function () // Done)res.on(error, function (err) // Error)ä½¿ç”¨thenè¿›è¡Œå°è£…ï¼šres.then(function () // Done , function (err) // Error, function (chunk) console.log(BODY: + chunk))å¼•å…¥Deferredå¯¹è±¡çš„å°è£…const promisify = function (res) let deferred = new Deferred() let result = res.on(data, function (chunk) result += chunk deferred.progress(chunk) ) res.on(end, function () deferred.resolve(result) ) res.on(error, function (err) deferred.reject(err) ) return deferred.promisepromisify(res).then(function () // Done, function (err) // Error, function (chunk) // progress console.log(BODY: + chunk))Promise DeferredDeferred ç”¨äºå†…éƒ¨ç»´æŠ¤å¼‚æ­¥æ¨¡å‹çŠ¶æ€å°è£…ä¸šåŠ¡ä¸­çš„ä¸å˜éƒ¨åˆ†Promise ç”¨äºå¤–éƒ¨é€šè¿‡thenæ–¹æ³•ç»™å¤–éƒ¨æä¾›æ·»åŠ è‡ªå®šä¹‰é€»è¾‘å…¥å£æ§åˆ¶ä¸šåŠ¡çš„å¯å˜éƒ¨åˆ†Deferredä¸ä¸šåŠ¡çš„ç®€åŒ–å¹¶ä¸æ˜¯ä½¿ç”¨Deferredéƒ½å¯ä»¥ç®€åŒ–ä¸šåŠ¡ï¼Œå› ä¸ºå¯¹äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œéƒ½éœ€è¦å°è£…å’Œæ”¹é€ Deferredï¼Œå¯¹äºä¸å¸¸ä½¿ç”¨çš„åœºæ™¯ï¼Œè€ƒè™‘åˆ°å°è£…å’Œæ”¹é€ DeferredèŠ±è´¹çš„æ—¶é—´ï¼Œå¹¶ä¸ä¸€å®šçœŸæ­£ç®€æ´åˆ’ç®—ã€‚Promiseä¸eventPromiseé«˜çº§æ¥å£ä¸€æ—¦å®šä¹‰ï¼Œä¸å¤ªå®¹æ˜“å˜åŒ–ï¼Œç¼ºå°‘çµæ´»æ€§æ–¹ä¾¿è§£å†³å…¸å‹é—®é¢˜eventsä½çº§æ¥å£æ–¹ä¾¿æ„é€ æ›´åŠ å¤æ‚çš„åœºæ™¯Q modelnpm - Qhttps://www.npmjs.com/package/qconst Q = require(q)const fs = require(fs) const readFile = function (file, encoding) let deferred = Q.defer() fs.readFile(file, encoding, deferred.makeNodeResolver()) return deferred.promisereadFile(hello.txt, utf-8).then(function (data) // success case console.log(data), function (err) // failed case console.log(err))å¼‚æ­¥ç¼–ç¨‹ä¸­å¼‚å¸¸çš„åˆ¤æ–­å’Œå¤„ç†éå¸¸é‡è¦ï¼ŒPromiseèƒ½å¤Ÿå®ç°ï¼šæ­£å‘ç”¨ä¾‹ï¼ˆsuccessï¼‰å’Œåå‘ç”¨ä¾‹ï¼ˆerrorï¼‰çš„åˆ†ç¦»é€»è¾‘å¤„ç†å»¶è¿Ÿï¼ˆthenï¼‰ Promiseçš„å¤šå¼‚æ­¥åä½œ allçš„ç®€å•å®ç°Deferred.prototype.all = function (promises) let count = promises.length let that = this let results = [] promises.forEach(function (promise, i) promise.then(function (data) count-- results[i] = data if (count === 0) that.resolve(resolves) , function (err) that.reject(err) ) ) return this.promiseallçš„ä½¿ç”¨let promise1 = readFile(hello.txt, utf-8)let promise2 = readFile(world.txt, utf-8)let deferred = new Deferred()deferred.all([promise1, promise2]).then( res = , err = ) Promiseè¿›é˜¶çŸ¥è¯† Promiseéœ€è¦æ ¹æ®å…·ä½“ä½¿ç”¨åœºæ™¯è¿›è¡Œä¸åŒçš„å°è£…ï¼Œä¸åŸç”Ÿäº‹ä»¶ç›¸æ¯”çµæ´»æ€§ä½ä¸€äº›ï¼Œä½†æ˜¯æ›´åŠ é€‚ç”¨äºä¸€äº›ç»å…¸åœºæ™¯ã€‚å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•æ—¶ï¼Œå‰ç«¯ç¨‹åºå‘˜ä½¿ç”¨JavaScriptå¯ä»¥å‡è½»åˆ‡æ¢ç¯å¢ƒçš„éº»çƒ¦ï¼Œä½†æ˜¯ä½¿ç”¨Nodeä¸è¿œç¨‹æœåŠ¡å™¨è¿›è¡ŒæŒ‡ä»¤å‘é€æ—¶ï¼Œä½¿ç”¨åˆ°çš„ç½‘ç»œåº“æ˜¯å®Œå…¨å¼‚æ­¥çš„ï¼ˆè€Œå…¶å®ƒè¯­è¨€éƒ½æ˜¯åŒæ­¥è°ƒç”¨çš„ï¼‰ï¼Œå› æ­¤åœ¨å¤šä¸ªå¼‚æ­¥æ“ä½œä¹‹é—´å­˜åœ¨é€»è¾‘å…³ç³»æ—¶ï¼Œä¼šé‡‡ç”¨Deferredæ¨¡å¼ Pyramid of Doomä½œä¸ºä»‹ç»Promiseé˜Ÿåˆ—æ“ä½œçš„é“ºå«ï¼Œæœ‰å¿…è¦æä¸€ä¸‹å¤§åé¼é¼çš„Pyramid of Doomï¼Œå³æ¶é­”é‡‘å­—å¡”ã€‚å¯çˆ±nie~~~ä¸ºäº†å®Œæˆä¸€ç³»åˆ—å½¼æ­¤é—´å­˜åœ¨é€»è¾‘å…³ç³»çš„å¼‚æ­¥æ“ä½œï¼Œæœ‰å¦‚ä¸‹ä¸‰ç§åœ°ç‹±æ¨¡å¼å¯ä¾›é€‰æ‹©ï¼šå›è°ƒåœ°ç‹±å‡½æ•°è°ƒç”¨åœ°ç‹±äº‹ä»¶è§¦å‘åœ°ç‹±obj.api1(function (value1) obj.api2(value1, function (value2) obj.api3(value2, function (value3) obj.api4(value3, function (value4) callback(value4) // Pyramid of Doom!!! ) ) ))let handler1 = function (value1) obj.api2(value1, handler2)let handler2 = function (value2) obj.api3(value2, handler3)let handler3 = function (value3) obj.api4(value3, handler4)let handler4 = function (value4) callback(value4)obj.api1(handler1)// ä¿è¯ä½ åŒäº‹çœ‹åˆ°ä¼šå£åèŠ¬èŠ³çš„ä»£ç const events = require(events)const emitter = new events.EventEmitter()emitter.on(step1, function () obj.api1(function (value1) emitter.emit(step2, value1) ))emitter.on(step2, function (value1) obj.api2(value1, function (value2) emitter.emit(step3, value2) ))emitter.on(step3, function (value2) obj.api3(value2, function (value3) emitter.emit(step4, value3) ))emitter.on(step4, function (value3) obj.api4(value3, function (value4) callback(value4) ))// åŒäº‹ï¼šä½ åœ¨è¿™æ‰“åœ°é¼ å‘¢ï¼Ÿemitter.emit(step1)Promiseé“¾å¼è°ƒç”¨åŸç†promise() .then(obj.api1) .then(obj.api2) .then(obj.api3) .then(obj.api4) .then(function (value4) // success , function (err) // error ) .done()æ”¹é€ Promiseä»¥å®ç°é“¾å¼è°ƒç”¨ï¼ˆä¸¤æ­¥ï¼‰ï¼šå‡†å¤‡å¥½å›è°ƒé˜Ÿåˆ—é€ä¸ªæ‰§è¡Œå›è°ƒï¼Œå½“å›è°ƒè¿”å›æ–°çš„Promiseå¯¹è±¡æ—¶ï¼šæ–°Promiseå¯¹è±¡ç»§æ‰¿å›è°ƒé˜Ÿåˆ—Deferredå¯¹è±¡æ›´æ–°ä¸ºæ–°Promiseå¯¹è±¡constructorresolverejectcallbackthenlet Promise = function() this.queue = [] this.isPromise = truelet Deferred = function() this.promise = new Promise()Deferred.prototype.resolve = function(obj) let promise = this.promise let handler while((handler = promise.queue.shift())) if(handler (handler.fulfilled)) let ret = handler.fulfilled(obj) if(ret ret.isPromise) ret.queue = promise.queue this.promise = ret return Deferred.prototype.reject = function (err) let promise = this.promise let handler while ((handler = promise.queue.shift())) if (handler handler.error) let ret = handler.error(err) if (ret ret.isPromise) ret.queue = queue.queue this.promise = ret return Deferred.prototype.callback = function() const that = this return function(err, file) if(err) return that.reject(err) return that.resolve(file) Promise.prototype.then = function(fulfilledHandler, errorHandler) let hander = if(typeof fulfilledHandler === function) handler.fulfilled = fulfilledHandler if(typeof errorHandler === function) hander.error = errorHandler this.queue.push(handler) return thisä½¿ç”¨é“¾å¼è°ƒç”¨æ”¹é€ å›è°ƒåœ°ç‹±æ¡ˆä¾‹ï¼šobj.api1(value1) .then((value2)= return obj.api2(value2) ) .then((value3)= return obj.api3(value3) ) .then((value4)= callback(value4) ) æ‰¹é‡å°†æ–¹æ³•Promiseå¼‚æ­¥åŒ– è¿™æ ·å¦‚æœå¸Œæœ›èƒ½å®ç°ä¾æ¬¡è¯»å–æ–‡ä»¶çš„åŠŸèƒ½ï¼Œéœ€è¦å¯¹è¯»å–æ–‡ä»¶å‡½æ•°è¿›è¡Œå¼‚æ­¥åŒ…è£…ï¼šconst fs = require(fs)const Q = require(q)// å¼‚æ­¥åŒ…è£…å‡½æ•°function readFile(file, encoding) let defer = Q.defer() fs.readFile(file, encoding, defer.makeNodeResolver()) return defer.promisereadFile(file1.txt, utf-8) .then(res = console.log(res) return readFile(res,utf-8) ) .then(res = console.log(res) )ä¹Ÿå¯ä»¥æ„å»ºèƒ½å¤Ÿå¯¹ä»»ä½•æ–¹æ³•è¿›è¡Œå¼‚æ­¥åŒ…è£…çš„åå‡½æ•°ï¼šconst fs = require(fs)const Q = require(q)// æ‰¹é‡å¯¹æ–¹æ³•è¿›è¡ŒPromiseåŒ–function smooth(method) return function () let deferred = Q.defer() // new Deferred() let args = Array.prototype.slice.call(arguments, 0) args.push(deferred.makeNodeResolver()) //deferred.callback() method.apply(null, args) return deferred.promise const readFile = smooth(fs.readFile)readFile(file1.txt, utf-8) .then(res = console.log(res) return readFile(res,utf-8) ) .then(res = console.log(res) ) æµç¨‹æ§åˆ¶åº“é™¤äº†äº‹ä»¶è®¢é˜…å’ŒPromiseDeferæ¨¡å¼ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›å°è¯•ç”¨çš„æµç¨‹æ§åˆ¶åº“ï¼š Connect async Step wind å°¾è§¦å‘ä¸Next å°¾è§¦å‘ï¼š æŒ‡éœ€è¦æ‰‹å·¥è°ƒç”¨æ‰èƒ½æŒç»­æ‰§è¡Œåç»­è°ƒç”¨çš„æ–¹æ³•next: å°¾è§¦å‘çš„å¸¸è§å…³é”®è¯Connectä¸­é—´ä»¶ï¼š å°¾è§¦å‘ç›®å‰åº”ç”¨æœ€å¤šçš„åœ°æ–¹connect - npmhttps://www.npmjs.com/package/connectconst connect = require(connect)const fs = require(fs)let app = connect()app.use(function middleware1(req, res, next) next())app.use(function middleware2(req, res, next) next())è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡ã€å°¾è§¦å‘å‡½æ•°å¤„ç†æµMiddleWare ä¸­é—´ä»¶æœºåˆ¶ä¸­é—´ä»¶æœºåˆ¶åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯ä»¥åƒé¢å‘åˆ‡é¢ç¼–ç¨‹ä¸€æ ·è¿›è¡Œè¿‡æ»¤ã€éªŒè¯ã€æ—¥å¿—ç­‰åŠŸèƒ½ï¼Œä¸ä¸ä¸šåŠ¡é€»è¾‘äº§ç”Ÿè€¦åˆå…³è”é¢å‘åˆ‡é¢ç¼–ç¨‹ AOPAOP Aspect Oriented Programç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨è¿è¡Œä¸­åŠ¨æ€å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ï¼Œæ˜¯å¯¹OOPç¼–ç¨‹çš„ä¸€ç§è¡¥å……ã€‚ connectæ ¸å¿ƒå®ç°connectuselistenhandlenextapp.stackå­˜æ”¾æœåŠ¡å™¨å†…éƒ¨ç»´æŠ¤çš„ä¸­é—´ä»¶é˜Ÿåˆ—function createServer() function app(req, res) app.handle(req, res) utils.merge(app, proto) utils.merge(app, EventEmitter.prototype) app.route = / app.stack = [] // ä¸­é—´ä»¶é˜Ÿåˆ— for (let i = 0; i arguments.length; ++i) app.use(arguments[i]) return appapp.useç”¨äºå°†ä¸­é—´ä»¶æ”¾å…¥stacké˜Ÿåˆ—app.use = function(route, fn) this.stack.push( route: route, handle: fn ) return thisapp.listenç›‘å¬å‡½æ•°å€ŸåŠ©httpæ¨¡å—å®ç°const http = require(http)app.listen = function() const server = http.createServer(this) return server.listen.apply(server, arguments)app.handleï¼Œæ¯ä¸€ä¸ªç›‘å¬åˆ°çš„ç½‘ç»œè¯·æ±‚éƒ½ä»æ­¤å¤„å¼€å§‹å¤„ç†app.handle = function(req, res, out) next()å°†é˜Ÿåˆ—ä¸­çš„ä¸­é—´ä»¶å–å‡ºå¹¶æ‰§è¡Œï¼Œéšåé€’å½’è°ƒç”¨ã€æŒç»­è§¦å‘function next(err) // some code // next callback layer = stack[index++] layer.handle(req, res, next)Connectçš„æµå¼å¤„ç†Connectä¸­çš„å°¾è§¦å‘ä¸€èˆ¬ç”¨äºæ‹†åˆ†å¯¹ç½‘ç»œè¯·æ±‚çš„å¤„ç†ï¼Œèƒ½å¤Ÿå°†ä¸²è¡Œé€»è¾‘æ‰å¹³åŒ–const connect = require(connect)const app = connect()app.use(/, function (req, res, next) // step1 next())app.use(/, function (req, res, next) // step2 next())app.use(/, function (req, res, next) // step3 res.end() )http.createServer(app).listen(3000) async npm - asynchttps://www.npmjs.com/package/asyncæµç¨‹æ§åˆ¶æ¨¡å—asyncæä¾›ç”¨äºå¤„ç†å¼‚æ­¥çš„å„ç§åä½œæ¨¡å¼ï¼šå¼‚æ­¥ä¸²è¡Œæ‰§è¡Œå¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä¾èµ–å¤„ç†è‡ªåŠ¨ä¾èµ–å¤„ç†async.series æ— ä¾èµ–çš„å¼‚æ­¥ä¸²è¡Œæ‰§è¡Œconst async = require(async)const fs = require(fs)async.series([ function (callback) fs.readFile(file1.txt,utf-8,(err,data)=callback(null,data)) , function (callback) fs.readFile(file2.txt,utf-8,(err,data)=callback(null,data)) ], function (err, results) if (err) throw err console.log(results) //[file1 context,file2 context])async.seriesç¬¬ä¸€ä¸ªå‚æ•°äº‹ä»¶æ•°ç»„ä¸­å…ƒç´ æœ‰å¦‚ä¸‹ç»“æ„ï¼š(callback)= // do something callback(result)è¿™é‡Œçš„callbackå®é™…ä¸Šä¸connect.nextç±»ä¼¼ï¼Œç”¨äºç»“æŸæœ¬æ¬¡æ‰§è¡Œï¼Œå¼€å§‹ä¸‹æ¬¡æ‰§è¡Œï¼Œå¹¶ä¸”å…¶ä¼ å‚æ˜¯ç”¨äºå°†æœ¬æ¬¡æ‰§è¡Œçš„ç»“æœä¿å­˜èµ·æ¥çš„æ‰‹åŠ¨å®ç°å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œlet counter = 2let results = []let hasErr = falsefunction done(data) counter -= 1 results.push(data) if (counter == 0) callback(null, results) function fail(err) if (!hasErr) hasErr = true callback(err) function callback(err, result) if (err) throw err console.log(result)fs.readFile(file1.txt, utf-8, (err, data) = if (err) fail(err) return done(data))fs.readFile(file2.txt, utf-8, (err, data) = if (err) fail(err) return done(data))EventProxyå®ç°å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œconst EventProxy = require(eventproxy)const fs = require(fs)const proxy = new EventProxy()function callback(err, res) if (err) throw err console.log(result,res) proxy.all(content, data, function (content, data) callback(null, [content, data]))proxy.fail(callback)fs.readFile(file1.txt, utf-8, proxy.done(content))fs.readFile(file2.txt, utf-8, proxy.done(data))parallel å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œasync.parallel([ function (callback) fs.readFile(file1.txt,utf-8,callback) , function (callback) fs.readFile(file2.txt,utf-8,callback) ], function (err, res) if (err) throw err console.log(res) // [file1 content,file2 content] )waterfall ç»“æœå­˜åœ¨ä¾èµ–å…³ç³»çš„å¼‚æ­¥ä¸²è¡Œæ‰§è¡Œasync.waterfall([ function (callback) fs.readFile(file1.txt, utf-8, function (err, content) // erråé¢çš„å‚æ•°ä»£è¡¨ä¼ é€’ç»™ä¸‹ä¸€æ­¥çš„å‚æ•° callback(err,content) ) , function (arg1, callback) // arg1 = file2.txt fs.readFile(arg1, utf-8, function (err, content) callback(err,content) ) ], function (err, res) if (err) throw err console.log(res) // file content)auto è‡ªåŠ¨ä¾èµ–å¤„ç†å¯¹äºå­˜åœ¨å¤æ‚ä¾èµ–å…³ç³»çš„ä¸šåŠ¡ç¯å¢ƒï¼Œautoèƒ½å¤Ÿå®ç°ï¼šæ ¹æ®ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ†æï¼Œä»¥æœ€ä½³çš„é¡ºåºæ‰§è¡Œä¸šåŠ¡ï¼ˆå¼ºï¼ï¼ï¼ï¼‰let deps = fun1:callback=callback(), // fun2 ä¾èµ– fun3ã€fun4 fun2:[fun3,fun4,callback=callback()], // fun3 ä¾èµ– fun1 fun3:[fun1,callback=callback()], // fun4 ä¾èµ– fun1 fun4:[fun4,callback=callback()]async.auto(deps)æ¯”å¦‚æœ‰ä»¥ä¸‹ä¸€ç³»åˆ—ä¸šåŠ¡éœ€è¦å®ç°ï¼šä»ç£ç›˜è¯»å–é…ç½®æ–‡ä»¶ readConfigæ ¹æ®é…ç½®æ–‡ä»¶è¿æ¥MongoDB connectMongoDBä¾èµ–readConfigæ ¹æ®é…ç½®æ–‡ä»¶è¿æ¥Redis connectRedisä¾èµ–readConfigç¼–è¯‘é™æ€æ–‡ä»¶ complieAssertsä¸Šä¼ é™æ€æ–‡ä»¶åˆ°CDN uploadAssertsä¾èµ– compieAssertså¯åŠ¨æœåŠ¡å™¨ startupä¾èµ–ä»¥ä¸Šæ‰€æœ‰EventProxyå®ç°æ­¤åœºæ™¯ asap ç”¨äºæŒ‡å®šä¸€ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°å°½å¿«æ‰§è¡Œ assp æŒ‡å®šä¸€ç»„äº‹ä»¶çš„å›è°ƒå‡½æ•°æŒ‰ç…§ç‰¹å®šé¡ºåºæ‰§è¡Œ const EventProxy = require(eventproxy)const proxy = new EventProxy()proxy.asap(readtheconfig, function () // è¯»å–é…ç½®æ–‡ä»¶ proxy.emit(readConfig)).on(readConfig, function () // è¿æ¥æ•°æ®åº“ proxy.emit(connectMongoDB)).on(readConfig, function () // è¿æ¥Redis proxy.emit(connectRedis)).assp(complieasserts, function () // ç¼–è¯‘é™æ€æ–‡ä»¶ proxy.emit(complieAsserts)).on(complieAsserts, function () // ä¸Šä¼ é™æ€æ–‡ä»¶ proxy.emit(uploadAsserts)).all(connecctMongoDB, connectRedis, uploadAsserts, function () // å¯åŠ¨æœåŠ¡å™¨)ç”Ÿæˆä¾èµ–æ ‘å¦‚ä¸‹ï¼šasync.auto( readConfig: function (callback) // read config file callback() , connectMongoDB: [readConfig, function (callback) // connect to mongodb callback() ], connectRedis: [readConfig, function (callback) // connect to redis callback() ], complieAsserts: function (callback) // complie asserts callback() , uploadAsserts: [complieAsserts, function (callback) // upload to assert callback() ], startup: [ connectMongoDB, connectMongoDB, complieAsserts, uploadAsserts, function (callback) // start up callback() ]) Step æ›´åŠ è½»é‡çº§çš„æµç¨‹æ§åˆ¶åº“ï¼šTim Caswell çš„ Step// stepæä¾›çš„å”¯ä¸€æ¥å£ç”¨äºä¸²è¡Œä»»æ„æ•°é‡çš„ä»»åŠ¡step(task1,task2,task3)stepçš„thiså…³é”®å­—å®é™…ä¸Šå‘æŒ¥çš„æ˜¯nextæ–¹æ³•çš„ä½œç”¨const step = require(step)const fs = require(fs)step( function readFile1() fs.readFile(file1.txt,utf-8,(err,data)=this(data)) , function readFile2(param) // param = file2.txt fs.readFile(param,utf-8,this) , function done(err, content) console.log(content) //file content )å¹¶è¡Œä»»åŠ¡æ‰§è¡Œ parallelparallelï¼š å‘Šè¯‰Stepéœ€è¦ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶æ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡æ³¨æ„ï¼šstepåªèƒ½å–åˆ°å¼‚æ­¥æ–¹æ³•ä¼ å›æ¥çš„å‰2ä¸ªå‚æ•°,æ­¤æ–¹æ³•çš„åŸç†åœ¨äºè®¡æ•°å™¨let asyncCall = function (callback) process.nextTick(function () callback(null,result1,result2) )step( function readFile1() fs.readFile(file1.txt, utf-8, this.parallel()) fs.readFile(file2.txt, utf-8, this.parallel()) asyncCall(this.parallel()) , function done() /** * 0:undefined * 1:file2.txt * 2:file content * 3:result1 */ console.log(arguments) )ç»“æœåˆ†ç»„ groupgroup ä»æµç¨‹æ§åˆ¶ä¸Šè¯´å’Œparallelå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¼šå°†ç»“æœæ‰“åŒ…æˆæ•°ç»„ä¼ å›step( function readDir() fs.readdir(__dirname, this) , function readFiles(err, results) if (err) throw err let group = this.group() results.forEach(filename = if (/\\.txt$/.test(filename)) fs.readFile(__dirname+/+filename,utf-8,group()) ) , function showAll(err, files) if (err) throw err console.dir(files) //[ file2.txt, file content, file3 content ] )ä¸ºä»€ä¹ˆè¦è°ƒç”¨ä¸¤æ¬¡groupï¼Ÿç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šå‘ŠçŸ¥stepè¦å¹¶è¡Œæ‰§è¡Œlet group = this.group()ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šç”¨äºç”Ÿæˆå›è°ƒå‡½æ•°æ¥å—è¿”å›å€¼æŒ‰ç»„å­˜å‚¨fs.readFile(__dirname+/+filename,utf-8,group()) wind Monadic å•å­monadicï¼Œæ˜¯ä¸€ç§ç”¨äºå¤„ç†å…·æœ‰å‰¯ä½œç”¨çš„è®¡ç®—ï¼Œå¦‚IOæ“ä½œã€å¼‚å¸¸å¤„ç†å’ŒçŠ¶æ€ç®¡ç†ç­‰ã€‚ windç®—æ˜¯å¯¹JavaScriptå®ç°çš„ä¸€ç§Monadicæ‰©å±•ï¼Œä¸ºäº†è¯´æ˜windçš„å…·ä½“ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å…ˆæå‡ºä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼šå®ç°å†’æ³¡æ’åºçš„åŠ¨ç”»å†’æ³¡æ’åºä»£ç å¦‚ä¸‹ï¼šfunction swap(a, i, j) let t = a[i] a[i] = a[j] a[j] = tfunction compare(a, b) return (a-b) 0function bubbleSort(array) for (let i = 0; i array.length; i++) for (let j = 0; j array.length-i-1; j++) if (compare(array[j], array[j + 1])) swap(array,j,j+1) return arrayå¦‚æœéœ€è¦æ·»åŠ åŠ¨ç”»æ•ˆæœçš„è¯ï¼Œåªè¦åœ¨swapå‡½æ•°ä¸­æ·»åŠ å°±å¯ä»¥ï¼Œä½†æ˜¯åŠ¨ç”»æ•ˆæœå­˜åœ¨å»¶æ—¶ï¼Œåœ¨å»¶æ—¶æ—¶æ®µä¸­åŠ¨ç”»è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œæ•°ç»„ä¸­çš„æ•°æ®å°±åˆå¼€å§‹å˜åŒ–äº†ï¼Œå› æ­¤è¯¥å¦‚ä½•è®©åŠ¨ç”»æ‰§è¡Œå®Œä¹‹åå†è¿›è¡Œä¸‹ä¸€æ¬¡çš„æ•°æ®äº¤æ¢å‘¢ï¼Ÿéœ€è¦è¾¾æˆçš„æ•ˆæœåŒæ ·éœ€è¦é€šè¿‡å»¶æ—¶å®ç°çš„åŠ¨ç”»æ•ˆæœä½¿ç”¨yieldå®ç°sleepä¹Ÿå¯ä»¥ä½¿ç”¨ES6ä¸­çš„yieldå®ç°æµç¨‹æ§åˆ¶ï¼Œåœ¨æ¯æ¬¡å†’æ³¡äº¤æ¢ä¹‹åæ·»åŠ yieldé˜»å¡æµç¨‹ï¼Œè½¬è€ŒèŠ±è´¹nç§’æ§åˆ¶åŠ¨ç”»å»¶æ—¶ï¼ŒåŠ¨ç”»æ‰§è¡Œç»“æŸï¼Œå†æ‰‹åŠ¨è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°çš„nextæ–¹æ³•ã€‚ æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š function * bubbleSort(array) for(let i=0;iarray.length;i++) for(let j=0;jarray.length-i-1;j++) if(compare(array[j],array[j+1])) swap(array,j,j+1) yield stop //äº¤æ¢åé˜»å¡ function next(gen) // éœ€è¦è¿­ä»£è°ƒç”¨è¿›è¡Œæµç¨‹æ§åˆ¶ let n = gen.next() if(n.done) return paint().then(()=next(gen)) //å¼‚æ­¥ç»˜åˆ¶åå†æ¬¡è°ƒç”¨nexté€šè¿‡ä¸‹ä¸€æ¬¡yieldlet gen = bubbleSort(arr)next(gen) ä½¿ç”¨windå®ç°æ­¤åŠŸèƒ½ä»£ç å¦‚ä¸‹ï¼šconst Wind = require(wind)// swapè¿›è¡Œå¼‚æ­¥åŒ…è£…let swapAsync = eval(Wind.compile(async, function swap(a, i, j) $await(Wind.Async.sleep(500)) // æš‚åœ500s var t = a[i] a[i] = a[j] a[j] = t console.log(repaint) //é‡ç»˜))function compare(a, b) return (a - b) 0let bubbleSort = eval(Wind.compile(async, function (array) for(var i = 0;iarray.length;i++) for(var j = 0; j array.length - i -1;j++) if(compare(array[j],array[j+1])) $await(swapAsync(array,j,j+1)) ))bubbleSort([7,-3,10,-1,0,99]).start()è¾“å‡ºç»“æœwindçš„ç‰¹å¼‚ä¹‹å¤„å¼‚æ­¥ä»»åŠ¡å®šä¹‰$await()ä¸ä»»åŠ¡æ¨¡å‹å¼‚æ­¥æ–¹æ³•è½¬æ¢è¾…åŠ©å‡½æ•°Wind.compile()å¯¹æ™®é€šå‡½æ•°è¿›è¡Œç¼–è¯‘ï¼Œå†äº¤ç»™ eval() æ‰§è¡Œå®šä¹‰å¼‚æ­¥ä»»åŠ¡eval(Wind.compile(async,function()))å†…ç½®å¯¹setTimeout()çš„å°è£…Wind.Async.sleep()$await(asyncFun())$await å®é™…æ˜¯ä¸€ä¸ªç­‰å¾…çš„ å ä½ç¬¦ï¼Œè¡¨ç¤ºç­‰å¾…å®Œæˆå¼‚æ­¥æ–¹æ³•ä»»åŠ¡æ¨¡å‹æ¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œéƒ½å¯ä»¥è½¬æ¢ä¸ºä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¹Ÿå°±æ˜¯windåŸºäºçš„ä»»åŠ¡æ¨¡å‹ã€‚æ­£å¼çš„ä»»åŠ¡åˆ›å»ºæ–¹æ³•ï¼šTask.create()complete()const Wind = require(wind)const Task = Wind.Async.Taskconst fs = require(fs)// ä»»åŠ¡åŒ…è£…let readFileAsync = function (file, encoding) return Task.create(function (t) fs.readFile(file, encoding, function (err, file) if (err) t.complete(failure, err) else t.complete(success, file) ) )// å¼‚æ­¥æ‰§è¡Œlet serial = eval(Wind.compile(async, function () var file1 = $await(readFileAsync(file1.txt, utf-8)) console.log(file1) var file2 = $await(readFileAsync(file2.txt, utf-8)) console.log(file2) try var file3 = $await(readFileAsync(file4.txt,utf-8)) catch (err) console.log(err) ))// file1 content// file2 content// Errorserial().start()å¼‚æ­¥å¹¶è¡Œç›´æ¥ä½¿ç”¨ $await(asyncTask()) çš„æ–¹å¼èƒ½å®ç°å¼‚æ­¥ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå®ç°äº†ä¸é˜»å¡CPUé˜»å¡ä»£ç çš„ç›®çš„Windå®ç°å¼‚æ­¥ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼šTask.whenAlllet parallel = eval(Wind.compile(async, function () var results = $await(Task.whenAll( file1: readFileAsync(file1.txt, utf-8), file2: readFileAsync(file2.txt,utf-8) )) console.log(results)))// file1: file2.txt, file2: file content parallel().start()let series = eval(Wind.compile(async,function() // ... $await(asyncTask()) // to do))å¯ä»¥çœ‹åˆ°å¼•å…¥windä¹‹åï¼Œå¼‚æ­¥å‡½æ•°å®é™…ä¸Šå·²ç»å’ŒåŒæ­¥è°ƒç”¨ååˆ†è¿‘ä¼¼äº†å› æ­¤å¾ˆé€‚åˆç”¨äºä»å·²æœ‰çš„åŒæ­¥ä»£ç å‘Nodeç«¯è¿ç§»windæä¾›äº†ä¸¤ä¸ªè¾…åŠ©æ–¹æ³•ï¼šWind.Async.Binding.fromCallbackWind.Async.Binding.fromStandardfromCallback è½¬æ¢æ— å¼‚å¸¸çš„è°ƒç”¨ æ— å¼‚å¸¸çš„è°ƒç”¨é€šå¸¸åªæœ‰ä¸€ä¸ªå‚æ•°è¿”å›ï¼šfs.exists(/etc/passwd,function(exists) // existsè¡¨ç¤ºæŒ‡å®šè·¯å¾„æ–‡ä»¶æ˜¯å¦å­˜åœ¨)// å¼‚æ­¥åŒ…è£…let existsAsync = Wind.Async.Binding.fromStandard(fs.exists)fromStandard è½¬æ¢å¸¦å¼‚å¸¸çš„è°ƒç”¨å¸¦å¼‚å¸¸çš„è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå¼‚å¸¸æ ‡è¯†fs.readFile(file1.txt,function(err,data) // errè¡¨ç¤ºå¼‚å¸¸)let readFileAsync = Wind.Async.Binding.fromStandard(fs.readFile) å°ç»“æ–¹æ¡ˆå¯¹æ¯” äº‹ä»¶å‘å¸ƒè®¢é˜…æ¨¡å¼æ¯”è¾ƒåŸå§‹PromiseDeferredæ¨¡å¼å¯¹å¼‚æ­¥ä»»åŠ¡æ¨¡å‹è¿›è¡ŒæŠ½è±¡é‡ç‚¹åœ¨äºå°è£…å¼‚æ­¥çš„è°ƒç”¨æµç¨‹æ§åˆ¶åº“è‡ªç”±åº¦è¾ƒé«˜é‡ç‚¹åœ¨äºå›è°ƒå‡½æ•°çš„æ³¨å…¥æºç ç¼–è¯‘æ–¹æ¡ˆstreamline å¼‚æ­¥å¹¶å‘æ§åˆ¶æ‰€è°“å¼‚æ­¥å¹¶å‘æ€§èƒ½çš„å…³é”®å¯ä»¥æ€»ç»“ä¸ºè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š æ€æ ·å‘èµ·å¼‚æ­¥å¹¶å‘ï¼Œèƒ½å¤Ÿå®ç°æ—¢å……åˆ†å‹æ¦¨åº•å±‚ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒåŒæ—¶ç»™äºˆå…¶ä¸€å®šè¿‡è½½ä¿æŠ¤ï¼Œé˜²æ­¢è¿‡çŠ¹ä¸åŠï¼Ÿ æ³ªç›®ï¼Œèµ„æœ¬å®¶ç«Ÿæ˜¯æˆ‘è‡ªå·± å¦‚æœä¸å¯¹å¹¶å‘é‡ä½œé™åˆ¶çš„è¯ï¼Œè¿ç»­å¤§é‡çš„å¹¶å‘è¯·æ±‚ä¼šè¿…é€Ÿç”¨å…‰ä¸‹å±‚æœåŠ¡å™¨çš„èµ„æºï¼Œé’ˆå¯¹å¹¶å‘é‡çš„é™åˆ¶é—®é¢˜ï¼Œè¿™é‡Œç»™å‡ºäº†ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š bagpipe async.parallelLimit async.queue bagpipeè§£å†³æ–¹æ¡ˆbagpipeè§£å†³æ€è·¯ let allTaskList = [] // è°ƒç”¨ç¼“å­˜é˜Ÿåˆ—let activeTaskList = [] // æ´»è·ƒï¼ˆè°ƒç”¨å‘èµ·ä½†å¹¶æœªæ‰§è¡Œå›è°ƒï¼‰çš„å¼‚æ­¥è°ƒç”¨let limitNumber = 100 // å¹¶å‘é™å®šé‡function parallelControl() // å¦‚æœè¿˜æœ‰å¤šä½™çš„ä»»åŠ¡åé¢ï¼Œå–å‡ºæ‰§è¡Œ if(allTaskList.length activeTaskList.lengthlimitNumber) let task = allTaskList.shift() activeTaskList.push(task) task.then((res)= activeTaskList.del(task) //é”€æ¯ parallelControl() // ä¸‹ä¸€æ¬¡å–å‡º ) else parallelControl() å®é™…ä½¿ç”¨åˆ°ä¸¤ä¸ªbagpipeçš„APIï¼š pushæ–¹æ³• fulläº‹ä»¶ const Bagpipe = require(bagpipe)const fs = require(fs)let bagpipe = new Bagpipe(3)bagpipe.on(full,function(length) console.log(`query blockï¼š[$length]`))for(let i = 0; i5; i++) bagpipe.push(fs.readFile,file1.txt,utf-8,function(err,data)) bagpipeçš„é…ç½® disabled é™æµå¼€å…³refuseæ‹’ç»æ¨¡å¼é’ˆå¯¹å¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯é™æµåˆ†æ‰¹å‘èµ·è¯·æ±‚å¯èƒ½å¯¼è‡´ä¸€éƒ¨åˆ†è¯·æ±‚å¿…é¡»ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ— æ³•æ»¡è¶³ä¸¢æ—¶é—´è¦æ±‚è¾ƒé«˜çš„æ•°æ®è¯·æ±‚å¹¶è¡Œé˜Ÿåˆ—ä¸€æ—¦é˜»å¡å°±è¿”å›å¤±è´¥æŠ¥é”™timeoutç”¨äºé˜²æ­¢æ‰§è¡Œè¿‡æ…¢çš„è¯·æ±‚é•¿æ—¶é—´å ç”¨å¹¶å‘åé¢ asyncçš„è§£å†³æ–¹æ¡ˆasync.parallelLimit const async = require(async)const fs = require(fs)async.parallelLimit([ function (callback) fs.readFile(file1.txt,utf-8,callback) , function (callback) fs.readFile(file2.txt,utf-8,callback) ], 1, function (err, results) if (err) throw err //[ file2.txt, file content ] console.log(results))async.parallelLimit( [], //å¼‚æ­¥å¹¶å‘ä»»åŠ¡é˜Ÿåˆ— limit, //å¹¶å‘æ•° callback) async.queue async.parallelLimitæ— æ³•åŠ¨æ€å¢åŠ å¹¶è¡Œä»»åŠ¡ï¼Œä½†æ˜¯async.queueæ”¯æŒæ­¤éœ€æ±‚ï¼šlet q = async.queue(function (file, callback) fs.readFile(file,utf-8,callback), 2)q.drain = function () // done listfs.readdirSync(.).forEach(function (file) q.push(file, function (err, data) ))"},{"title":"PythonåŸºç¡€è¯­æ³•","path":"/wiki/Python/base_01_hello_01.html","content":"Pythonå˜é‡å˜é‡å®šä¹‰ä¸èµ‹å€¼ åŒæ—¶å¯¹å¤šä¸ªå˜é‡èµ‹å€¼# a = 1# b = 2a, b = 1, 2 å˜é‡åˆ é™¤ å¯ä»¥ä½¿ç”¨delåˆ é™¤å·²ç»å®šä¹‰çš„å˜é‡del value_name, value_name_2 Pythonæ•°æ®ç±»å‹ æ•°å­— Numbers æ•´å‹ int æµ®ç‚¹å‹ float å¸ƒå°”å‹ bool å¤æ•°å‹ complex å­—ç¬¦ä¸² String åˆ—è¡¨ List å…ƒç»„ Tuple é›†åˆ Sets å­—å…¸ Dictionaries åºåˆ—sequenceçš„å†…ç½®å‡½æ•° python3ä¸­æœ‰ä»¥ä¸‹å‡ ç§seqç±»å‹çš„å˜é‡listtuplesetdictseqæ•°æ®ç±»å‹æä¾›äº†ä»¥ä¸‹å†…ç½®å‡½æ•°ï¼šlenmaxminliststrsumsortedreversedenumerate å˜é‡æ£€æµ‹å‡½æ•° type ### Numbersprint(type(1)) # class intprint(type(1.1)) # class floatprint(type(True)) # class boolprint(type(3+4j)) # class complex### Stringprint(type(1213)) # class str### Listprint(type([1, 2, 3])) # class list### Tupleprint(type((1,2,3))) # class tuple### Setsprint(type(1, 2, 3)) # class set### Dictionariesprint(type(1: 2, 3: 4)) # class dict ç±»æ£€æµ‹ isinstance print(isinstance(1, int)) # Trueisinstance å’Œ type çš„åŒºåˆ«åœ¨åˆ¤å®šå­ç±»ä¸å…¶ç»§æ‰¿çš„çˆ¶ç±»çš„å…³ç³»æ—¶ä¼šä½“ç°å‡ºæ¥ï¼šclass Parent: passclass Children(Parent): pass typeprint(type(Children()) == Children) # Trueprint(type(Children()) == Parent) # False isinstanceprint(isinstance(Children(), Parent)) # True Numberpythonçš„é™¤æ³• pythonä¸­å­˜åœ¨ä¸¤ç§é™¤æ³•ï¼šprint(5/2) # 2.5print(5//2) # 2ab é™¤æ³•ï¼Œè¿”å›floatç±»å‹æ•°å€¼abæ•´é™¤ï¼Œè¿”å›intç±»å‹æ•°å€¼ æ•°å­—ç±»å‹è½¬æ¢ int(x)float(x)complex(x)complex(x, y)x: å®æ•°éƒ¨åˆ†y: è™šæ•°éƒ¨åˆ† Stringå‰ç¼€ åœ¨å­—ç¬¦ä¸²å‰åŠ rå‰ç¼€ï¼Œèƒ½å¤Ÿä½¿è½¬ä¹‰å­—ç¬¦æ— æ•ˆåŒ–print(abc\\tdef) # abc defprint(rabc def) # abc def ç»­è¡Œ ä½¿ç”¨ â€œâ€â€â€¦â€â€â€ æˆ– â€˜â€™â€™â€¦â€™â€™â€™ è¡¨ç¤ºç»­è¡Œprint( div pHello World/p /div)print( div pHello World/p /div) ç´¢å¼• æ­£å‘ç´¢å¼•ä»å·¦å‘å³ä»0å¼€å§‹é€’å¢è´Ÿå‘ç´¢å¼•ä»å³å‘å·¦ä»-1å¼€å§‹é€’å‡string = 123456789print(string[0]) # 1print(string[-1]) # 9 åˆ‡ç‰‡ string[[start_index] : [end_index]]string = 123456789print(string[1:5]) # 2345print(string[:]) # 123456789print(string[:5]) # 12345print(string[5:]) # 6789print(string[-5:-1]) # 5678 å­—ç¬¦ä¸²ä¸èƒ½é€šè¿‡ç´¢å¼•å€¼å¼•ç”¨çš„æ–¹å¼æ”¹å˜ å­ä¸² str = Hello Worldprint(ll in str) # Trueprint(m in str) # False æ ¼å¼åŒ– å­—ç¬¦ä¸²æ ¼å¼åŒ–å’ŒCC++çš„printfæ–¹æ³•ç±»ä¼¼# Its 18 oclock, lets go off workprint(Its %d oclock, lets %s % (18, go off work))f-stringä¸JavaScriptçš„æ¨¡æ¿å­—ç¬¦ä¸²ç±»ä¼¼time, event = 18, get off work# its 18 oclock, lets get off workprint(fits time oclock, lets event) Liståˆ—è¡¨è¿ç®— åˆ—è¡¨åŠ æ³•list_A = [1,2,3,4,5]list_B = [2,3,4,5,6]print(list_A+list_B) # [1, 2, 3, 4, 5, 2, 3, 4, 5, 6]åˆ—è¡¨ä¹˜æ³•list_A = [1,2,3]print(list_A*2) # [1, 2, 3, 1, 2, 3]ä¹˜æ³•ä¹Ÿèƒ½ç”¨äºåˆå§‹åŒ–æŒ‡å®šé•¿åº¦çš„åˆ—è¡¨ï¼šprint([None]*5) # [None, None, None, None, None] åˆ‡ç‰‡ Listå¯ä»¥é€šè¿‡åˆ‡ç‰‡è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œå¢åˆ æ”¹æŸ¥arr = list(123456789)arr[0:0] = [m, n]print(arr) # [m, n, 1, 2, 3, 4, 5, 6, 7, 8, 9]arr = list(123456789)arr[2:3] = []print(arr) # [1, 2, 4, 5, 6, 7, 8, 9]arr = list(123456789)arr[0:2] = [m, n]print(arr) # [m, n, 22, 3, 4, 5, 6, 7, 8, 9]arr = list(123456789)print(arr[2:3]) # [3] Listå†…å»ºå‡½æ•° æ·»åŠ åˆ é™¤æŸ¥è¯¢appendextendinsertlist_A = []list_A.append(1)print(list_A) # [1]list_A.insert(0, 2)print(list_A) # [2, 1]list_A.extend([3,4])print(list_A) # [2, 1, 3, 4]popremoveclearlist_A = [1,2,3,4,3,5]list_A.pop()print(list_A) # [1,2,3,4,3]list_A.remove(3)print(list_A) # [1,2,4,3]list_A.clear()print(list_A) #[]countindexlist_A = [1,2,3,4,3,5]print(list_A.count(3)) # 2print(list_A.index(3)) # 2 å †æ ˆé˜Ÿåˆ—append å…¥æ ˆpop å‡ºæ ˆfrom collections import dequequeue = deque([1, 2, 3])queue.append(4)queue.append(5)print(queue.popleft()) # 1print(queue.popleft()) # 2print(queue) # deque([3, 4, 5]) åˆ—è¡¨æ¨å¯¼å¼ [expression(x) for x in seq]vec = [2, 4, 6]str_arr = [key1:value1, key2:value2, key3:value3]print([3*x for x in vec]) # [6, 12, 18]print([[x,x**2,x**3] for x in vec]) # [[2, 4, 8], [4, 16, 64], [6, 36, 216]]print(dict(str.split(:) for str in str_arr)) # key1: value1, key2: value2, key3: value3åŠ å…¥ifè¿‡æ»¤[expression(x) for x in seq if expression(x)]vec = [2, 4, 6]str_arr = [key1:value1, key2:value2, key3:value3]print([3*x for x in vec if x != 4]) # [6, 18]print(dict(str.split(:) for str in str_arr if 1 not in str)) # key2: value2, key3: value3åµŒå¥—å¾ªç¯[expression(n_1, n_2, â€¦) for n_1 in arr_1 for n_2 in arr_2 â€¦]vec1 = [1,-1,2,-2,3,-3]vec2 = [3,-3,4,-4,5,-5]print([x*y for x in vec1 if x0 for y in vec2 if y 0]) åµŒå¥—åˆ—è¡¨è§£æ matrix_m_n = [ [1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]]matrix_n_m = [[row[i] for row in matrix_m_n] for i in range(len(matrix_m_n[0]))]print(matrix_n_m) # [[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]] åˆ‡ç‰‡åˆ é™¤ del list[start:end]arr = [1,2,3,4,5]del arr[1:2]print(arr) # [1, 3, 4, 5] zip æ ¹æ®ç´¢å¼•åŒæ—¶è®¿é—®å¤šä¸ªåºåˆ— Tupleåˆ›å»ºè§„åˆ™ å…ƒç»„å…ƒç´ æ— æ³•ä¿®æ”¹ï¼Œå½“å…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦åœ¨å”¯ä¸€å…ƒç´ ååŠ ä¸€ä¸ªé€—å·ï¼Œå¦åˆ™ä¼šè¢«å½“åšæ‹¬å·è¿ç®—ç¬¦tup1 = ()tup2 = (2,)tup3 = (2)print(tup1) # ()print(tup2) # (2,)print(tup3) # 2ç”šè‡³å¯ä»¥ä¸åŠ æ‹¬å·çš„åˆ›å»ºå…ƒç¥–ï¼št = 123, hello, True, (abc, False)print(t) # (123, hello, True, (abc, False))Tupleæ”¯æŒåŠ æ³•æ‹¼æ¥ï¼štup_1 = (1,)tup_2 = (2,)print(tup_1 + tup_2) # (1, 2) å…ƒç»„çš„æ¯”è¾ƒï¼šoperator operatoræ˜¯ä¸“é—¨ç”¨æ¥å®ç°æ•°æ®æ¯”è¾ƒåŠŸèƒ½çš„æ¨¡å—import operatortup_1 = (1, 2)tup_2 = (2, 1)tup_3 = (2, 1)print(operator.eq(tup_1, tup_2)) # Falseprint(operator.eq(tup_2, tup_3)) # True Setsç©ºå­—å…¸å’Œç©ºé›†åˆ åˆ›å»ºç©ºé›†åˆéœ€è¦ä½¿ç”¨setï¼Œæ–¹ä¾¿å’Œç©ºå­—å…¸åŒºåˆ†å¼€ï¼šblank_set = set()blank_dict = é›†åˆè¿ç®— set_A = 1, 2, 3, 4, 5, 4, 3, 2, 1set_B = 4, 5, 6, 7, 8, 6, 5, 4# å·®é›†print(set_A - set_B) # 1, 2, 3# å¹¶é›†print(set_A | set_B) # 1, 2, 3, 4, 5, 6, 7, 8# äº¤é›†print(set_A set_B) # 4, 5# å¼‚æˆ–print(set_A ^ set_B) # 1, 2, 3, 6, 7, 8 Setå†…ç½®æ–¹æ³• æ·»åŠ åˆ é™¤æŸ¥è¯¢add æ·»åŠ å•ä¸ªupdate ä¿ç•™å¹¶é›†æ·»åŠ å…ƒç´ discardå’Œremoveçš„åŒºåˆ«discard ç§»é™¤ä¸å­˜åœ¨çš„é›†åˆå…ƒç´ æ—¶ä¸ä¼šæŠ¥é”™remove ç§»é™¤ä¸å­˜åœ¨çš„é›†åˆå…ƒç´ æ—¶ä¼šæŠ¥é”™clear æ¸…é™¤æ‰€æœ‰difference_update ç§»é™¤å·®é›†intersection_update ä¿ç•™äº¤é›†symmetric_difference_update ä¿ç•™å¼‚æˆ–é›†pop éšæœºåˆ é™¤discard åˆ é™¤æŒ‡å®šremove åˆ é™¤æŒ‡å®šdifference å·®é›†intersection äº¤é›†symmetric_difference å¼‚æˆ–é›†union å¹¶é›†isdisjoint æ˜¯å¦å­˜åœ¨äº¤é›†issubset åˆ¤æ–­å­é›† Dictionariesæ„å»ºå­—å…¸ dictçš„keyåªèƒ½æ˜¯ä¸å¯æ”¹å˜ç±»å‹çš„æ•°æ®numberstringæ–¹å¼1 {}æ–¹å¼2 dictæ–¹å¼3 tupleæ–¹å¼4 listæ–¹å¼5 setæ–¹å¼6 æ¨å¯¼å¼dict_A = 1: 123, a: 321dict_A = dict(a=1, b=2, c=3)print(dict_A) # a: 1, b: 2, c: 3tup = ( (a, 1), (b, 2), (c, 3))print(dict(tup)) # a: 1, b: 2, c: 3dict_list = [ [a, 1], [b, 2], [c, 3]]print(dict(dict_list)) # a: 1, b: 2, c: 3set_dict = [ a, 1, b, 2, c, 3]print(dict(set_dict)) # a: 1, b: 2, 3: csetæ˜¯æ— åºé›†åˆï¼Œå› æ­¤åˆ›å»ºå‡ºæ¥çš„å­—å…¸é”®å€¼å…³ç³»éšæœºç»„åˆfor_dict = x: y**2 for x, y in [[a, 1], [b, 2], [c, 3]]print(for_dict) # a: 1, b: 4, c: 9æˆå‘˜æµ‹è¯•dict_list = [ [a, 1], [b, 2], [c, 3]]new_dict = dict(dict_list)print(a in new_dict) # Trueprint(1 in new_dict) # False Dict å†…ç½®æ–¹æ³• å¿«é€Ÿåˆ›å»ºæ–°å­—å…¸dict.fromkeys(seq[, value])new_dict = dict.fromkeys([a, b, c], 123)print(new_dict) # a: 123, b: 123, c: 123è·å–æŒ‡å®šé”®å€¼dict.get(key[, default=None])new_dict = a: 1, b: 2, c: 3print(new_dict.get(a, 123)) # 1print(new_dict.get(e, 123)) # 123å±æ€§è·å–+åˆ¤æ–­+èµ‹å€¼dict.setdefault(key[, default=None])new_dict = a: 1, b: 2, c: 3print(new_dict.setdefault(a, 123)) # 1print(new_dict.setdefault(e, 123)) # 123print(new_dict) # a: 1, b: 2, c: 3, e: 123å­—å…¸æ›´æ–°target_dict.update(source_dict)dict_A = a: 1, b: 2, c: 3dict_B = a:111, e:123dict_A.update(dict_B)print(dict_A) # a: 111, b: 2, c: 3, e: 123 è¿ç®—ç¬¦å¯¹äºä¸€äº›ç®€å•é€šç”¨è¿ç®—ç¬¦ï¼Œpythonå’Œå…¶ä»–è¯­è¨€çš„å·®åˆ«ä¸å¤§ï¼š ç®—æœ¯è¿ç®—ç¬¦ æ¯”è¾ƒè¿ç®—ç¬¦ èµ‹å€¼è¿ç®—ç¬¦ ä½è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦ and or not æˆå‘˜è¿ç®—ç¬¦ in not in èº«ä»½è¿ç®—ç¬¦ is is not æˆå‘˜è¿ç®—ç¬¦ new_list = [x for x in [1, 2, 3]]new_set = x for x in [1, 2, 3]new_tuple = (1, 2, 3)new_dict = x: x + 1 for x in [1, 2, 3]print(1 in new_list) # Trueprint(1 in new_set) # Trueprint(1 in new_tuple) # Trueprint(1 in new_dict) # True èº«ä»½è¿ç®—ç¬¦ (A is B) = (id(A) == id(B)) å¾ªç¯for-inrange()å‡½æ•° range(start, end, step)åˆ©ç”¨rangeæ§åˆ¶å¾ªç¯æ¬¡æ•°num_list = list(0123456789)for i in range(0, len(num_list), 3): print(i) # 0 3 6 9åˆ©ç”¨rangeåˆ›å»ºæ•°å­—åºåˆ—print(list(range(0, 10, 3))) # [0, 3, 6, 9]print(tuple(range(0, 10, 3))) # (0, 3, 6, 9)print(set(range(0, 10, 3))) # 0, 9, 3, 6 for-inwhile + elsefor-in-else è¿›å…¥elseçš„æ¡ä»¶ï¼šç©·å°½åˆ—è¡¨å¾ªç¯æ²¡æœ‰è¢«breakç»ˆæ­¢for n in range(2,10): for m in range(2,n): if n%m == 0: print(n, equals, m, *, n//m) break else: print(n, is a prime number) while-else è¿›å…¥elseçš„æ¡ä»¶ï¼šwhileæ¡ä»¶ä¸ºFalseå¾ªç¯æ²¡æœ‰è¢«breakç»ˆæ­¢n = 2while n10: m = 2 while mn: if n%m == 0: print(fn = m * n//m) break m+=1 else: print(fn is prime number) n+=1 è¿­ä»£å™¨ç”Ÿæˆå™¨è¿­ä»£å™¨ iter å¯ç”¨äºåˆ›å»ºè¿­ä»£å™¨çš„æ•°æ®ç±»å‹ï¼šStringListTupleSetDictè¿­ä»£å™¨çš„ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼šiter() åˆ›å»ºè¿­ä»£å™¨next(iter) è®¿é—®ä¸‹ä¸€ä¸ªå…ƒç´ it_list = iter(list(123))while True: try: print(next(it_list)) except: break ç”Ÿæˆå™¨ generator ä½¿ç”¨äº†yieldçš„å‡½æ•°è¢«ç§°ä¸ºgeneratorå‡½æ•°ï¼Œæ¯æ¬¡è¿è¡Œåˆ°yieldè¯­å¥æ—¶ï¼Œéƒ½å°†è¿”å›yieldåçš„å€¼ï¼Œåœ¨æ‰§è¡Œnext()æ—¶è§¦å‘ç”Ÿæˆå™¨çš„æ‰§è¡Œdef fibonacci(n): a, b, counter = 0, 1, 0 while counter = n: counter += 1 yield a a, b = b, a + b returnit = fibonacci(10)print(list(it)) # [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55] å‡½æ•°å…³é”®å­—å‚æ•° def printinfo(name, age=35): print(name, age) returnprintinfo(age=20, name=a) # a 20 ç¼ºçœå‚æ•° def printinfo(name, age=35): print(name, age) returnprintinfo(name=a) # a 35printinfo(name=b , age=20) # b 20 å¯å˜å‚æ•° def fun(*args) argsä»¥Tupleç±»å‹ä¼ å…¥def fun(**args)argsä»¥Dictç±»å‹ä¼ å…¥å¯å˜Tupleå‚æ•° *argæ¨èå†™æ³•ï¼š å¯å˜å‚æ•°æ”¾æœ€ådef printinfo(arg1, *args): print(arg1, args)printinfo(abc, 1, 2, 3) # abc (1, 2, 3)printinfo(abc) # abc ()å¯å˜å‚æ•°å†™åœ¨å‰ï¼Œ å›ºå®šå‚æ•°éœ€ä½¿ç”¨å…³é”®å­—å‚æ•°ä¼ å…¥def printinfo(*args, arg1=123): print(args, arg1)printinfo(1, 2, 3, arg1=1) # (1, 2, 3) 1printinfo(arg1=1) # () 1printinfo(1, 2, 3) # (1, 2, 3) 123å¯å˜Dictå‚æ•° **argsdef printinfo(**args): print(args)# a: 1, b: 2, c: 3printinfo(a = 1, b = 2, c = 3) åŒ¿åå‡½æ•° lambda lambda åªæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼lambda æ— æ³•è®¿é—®è‡ªæœ‰å‚æ•°ä»¥å¤–çš„ä»»ä½•å‚æ•°lambda [args, [args2,....argn]]: expressionarr_add1 = lambda arg: int(arg)+1arr = list(123)print(list(map(arr_add1, arr))) # [2, 3, 4]"},{"title":"æ¨¡å—ã€I/Oã€å¼‚å¸¸ã€é¢å‘å¯¹è±¡","path":"/wiki/Python/base_02_hello_02.html","content":"æ¨¡å—importè¯­å¥pythonçš„æœç´¢è·¯å¾„ importè¯­å¥æ‰§è¡Œä¹‹åï¼Œpythonè§£é‡Šå™¨ä¼šæŒ‰ç…§æœç´¢è·¯å¾„æ¥æœç´¢å¯¹åº”æ¨¡å—ï¼Œæœç´¢è·¯å¾„ç”±ä¸€ç³»åˆ—ç›®å½•åç»„æˆimport sysprint(sys.path)[â€˜D:\\CS_Demo\\åç«¯\\Python Demo\\2023_python_demoâ€™,â€˜D:\\CS_Demo\\åç«¯\\Python Demo\\2023_python_demoâ€™,â€˜D:\\PyCharm\\PyCharm 2020.3.3\\plugins\\python\\helpers\\pycharm_displayâ€™,â€˜D:\\python\\python39.zipâ€™,â€˜D:\\python\\DLLsâ€™,â€˜D:\\python\\libâ€™,â€˜D:\\pythonâ€™,â€˜D:\\python\\lib\\site-packagesâ€™,â€˜D:\\PyCharm\\PyCharm 2020.3.3\\plugins\\python\\helpers\\pycharm_matplotlib_backendâ€™]æœç´¢è·¯å¾„æ˜¯ä½•æ—¶è¢«ç¡®å®šçš„ï¼Ÿç­”ï¼š åœ¨Pythonç¼–è¯‘æˆ–å®‰è£…çš„æ—¶å€™è¢«ç¡®å®šçš„ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥ç¡®å®šæœç´¢è·¯å¾„ å› æ­¤ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ sys.pathä¿®æ”¹æœç´¢è·¯å¾„ name å½“Aæ¨¡å—å¼•ç”¨Bæ¨¡å—å†…å˜é‡æˆ–æ–¹æ³•æ—¶ï¼ŒBæ¨¡å—ä¸­ä¼šè¿è¡Œçš„ä»£ç ä¸ä»…ä»…åªæœ‰è¢«å¼•ç”¨çš„éƒ¨åˆ†ï¼Œäº‹å®ä¸Šï¼ŒBæ¨¡å—çš„æ•´ä¸ªä¸»ç¨‹åºéƒ½å°†è¿è¡Œå¦‚ä½•åˆ†è¾¨ç¨‹åºæ˜¯è‡ªèº«æ‰§è¡Œè¿˜æ˜¯å¼•ç”¨æ‰§è¡Œå‘¢ï¼Ÿç­”ï¼š nameif __name__ == __main__: print(è‡ªèº«è¿è¡Œ)else: print(å¼•ç”¨è¿è¡Œ) è°ƒç”¨æ¨¡å—å†…çš„æ‰€æœ‰å¯å¼•ç”¨æ–¹æ³• dir(model) è·å–æ¨¡å—å†…å®šä¹‰çš„æ‰€æœ‰åç§°çš„å­—ç¬¦ä¸²åˆ—è¡¨getattr(obj, str) æ ¹æ®å­—ç¬¦ä¸²åç§°strè·å–objä¸­çš„æŸä¸ªå±æ€§obj.strfor fun in [i for i in dir(model) if not i.startswith(__)]: getattr(model, fun)() åŒ…åŒ… ç›®å½•åªæœ‰åœ¨åŒ…å«**init.py**æ–‡ä»¶æ—¶æ‰ä¼šè¢«è®¤ä½œæ˜¯ä¸€ä¸ªåŒ…ï¼šroot_package init.py package_A init.py AAA.py BBB.py â€¦ package_B init.py CCC.py DDD.py â€¦ä½¿ç”¨ç‚¹æ¨¡å—åç§°è·å–æŸä¸ªåŒ…å†…çš„æ¨¡å—æ—¶ï¼Œå¦‚ï¼šA.B.Cï¼Œè®¿é—®åˆ°çš„æ¯ä¸€å±‚åŒ…ç»“æ„éƒ½ä¼šè°ƒç”¨å…¶ä¸­çš„**init.py** IOoutputå­—ç¬¦ä¸²è½¬æ¢ str è¿”å›ç”¨æˆ·æ˜“è¯»çš„è¡¨è¾¾å½¢å¼s = hello world hello worldprint(str(s))repr è¿”å›è§£é‡Šå™¨æ˜“è¯»çš„è¡¨è¾¾å½¢å¼s = hello worldprint(repr(s)) # hello world å­—ç¬¦ä¸²æ ¼å¼åŒ– å›ºå®šé•¿åº¦ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•å…¨æ˜¯ç”¨äºåˆ›å»ºæŒ‡å®šlené•¿åº¦å­—ç¬¦ä¸²çš„ï¼Œä½†æ˜¯åœ¨æºå­—ç¬¦ä¸²é•¿åº¦å°äºç›®æ ‡é•¿åº¦æ—¶ï¼Œå¡«å……çš„æ–¹æ³•ä¸åŒï¼šrjust(len) å‘å­—ç¬¦ä¸²å·¦ä¾§å¡«å……ç©ºæ ¼ljust(len)å‘å­—ç¬¦ä¸²å³ä¾§å¡«å……ç©ºæ ¼center(len)åƒå­—ç¬¦ä¸²ä¸¤ä¾§å¡«å……ç©ºæ ¼æ ¼å¼åŒ– formatä»…å ä½ {}index1: index2: index3:.format(index1,index2,index3)æŒ‡å®šç´¢å¼• {index}print(index2:1 index3:2 index1:0.format(1, 2, 3))æŒ‡å®šå…³é”®å­— {keyword}print(key2 key1 key3.format(key1=dog,key2=you,key3=!!!))æŒ‡å®šç´¢å¼•å’Œæ ¼å¼ {index:format}print(0:2d 1:3d 2:4d.format(10, 10**2, 10**3))print(Math.pi = 0:0.2f.format(math.pi))æ ¼å¼åŒ–ä¹‹å‰è¿›è¡Œé™„åŠ æ“ä½œ {!a|!s|!r}!a ascii()!s str()!r repr()print(!a !s !r.format(index1, index2, index3))ä¼ å…¥å­—å…¸team = John:Doctor, Nancy:Fighter print(John is our 0[John]:10, and Nancy is our 0[Nancy]:10.format(team))ä½¿ç”¨å‚æ•°è§£æ„çš„æ–¹å¼åŒæ ·ä¹Ÿèƒ½å®ç°ä¼ å…¥å­—å…¸çš„åŠŸèƒ½team = John:Doctor, Nancy:Fighterprint(John is our John:10, and Nancy is our Nancy:10.format(**team))zfill() å­—ç¬¦ä¸²å·¦ä¾§å¡«å……0print(0.1.zfill(5)) # 000.1 æ–‡ä»¶è¯»å†™æ–‡ä»¶ open(filename, mode)modeæœ‰å¦‚ä¸‹å‡ ç§é€‰é¡¹ï¼šr é»˜è®¤å€¼ï¼Œåªè¯»w å†™a è¿½åŠ r+ è¯»å†™ æ–‡ä»¶æ“ä½œæ–¹æ³• read(size) è¯»å–sizeé•¿åº¦çš„å­—ç¬¦ä¸²å­—èŠ‚å¯¹è±¡readline() è¯»å–ä¸€è¡Œreadlines() è¯»å–æ‰€æœ‰è¡Œnext() è¯»å–æ–‡ä»¶ä¸‹ä¸€è¡Œtruncate([size]) æˆªå–æ–‡ä»¶write(string) å†™å…¥æ–‡ä»¶ string éœ€è¦å†™çš„å†…å®¹return å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦writelines(sequence) å†™å…¥ä¸€ä¸ªåºåˆ—å­—ç¬¦ä¸²åˆ—è¡¨tell() æ–‡ä»¶å¯¹è±¡æ‰€å¤„ç´¢å¼•ä½ç½®seek(offset, from_what) ç§»åŠ¨æ–‡ä»¶å¯¹è±¡ç´¢å¼•ä½ç½®from_what 0 ä»é¦–è¡Œé¦–å­—å¼€å§‹ç§»åŠ¨from_what 1 ä»å½“å‰ä½ç½®å¾€åç§»åŠ¨from_what 2 ä»ç»“å°¾å¾€å‰ç§»åŠ¨-offsetä¸ªå­—ç¬¦close() å…³é—­é‡Šæ”¾æ–‡ä»¶èµ„æºflush() åˆ·æ–°æ–‡ä»¶å†…éƒ¨ç¼“å†²fileno() è¿”å›æ•´å‹æ–‡ä»¶æè¿°ç¬¦ç”¨äºåº•å±‚æ“ä½œisatty() æ–‡ä»¶æ˜¯å¦è¿æ¥åˆ°ä¸€ä¸ªç»ˆç«¯è®¾å¤‡ä¸€ä¸ªæ ¹æ®ç›®å½•æ–‡ä»¶å¼•å…¥æŒ‡å®šæ¨¡å—çš„åŠŸèƒ½ï¼šimport importlibrequire = open(static/require.txt, r)while True: try: model_name = require.readline() if not model_name: print(æ–‡ä»¶è¯»å–ç»“æŸ) break model_name = str(model_name).replace( , ) model_path = fstatic.model_name globals()[model_name] = importlib.import_module(model_path) except: print(æ–‡ä»¶è¯»å–é”™è¯¯)require.close() pickleæ¨¡å—pickleåŠŸèƒ½ åºåˆ—åŒ–ç¨‹åºå¯¹è±¡ â†’ æ–‡ä»¶ç¨‹åºå¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶pickle.dump(obj, file, [,protocol])ååºåˆ—åŒ–æ–‡ä»¶ â†’ ç¨‹åºå¯¹è±¡ä½¿ç”¨æ–‡ä»¶å†…å®¹åˆ›å»ºç¨‹åºå¯¹è±¡x = pickle.load(file) åºåˆ—åŒ–import pickledata1 = a:[1, 2.0, 3, 4+6j], b:string, uUnicode string, c:Noneselfref_list = [1, 2, 3]selfref_list.append(selfref_list)output = open(static/data.pk1, wb)pickle.dump(data1, output)pickle.dump(selfref_list, output, -1)output.close() ååºåˆ—åŒ–import pprint, picklepkl_file = open(static/data.pk1, rb)data1 = pickle.load(pkl_file)pprint.pprint(data1)data2 = pickle.load(pkl_file)pprint.pprint(data2)pkl_file.close() å¼‚å¸¸å¼‚å¸¸æ•è· try: ....except é”™è¯¯ç±»å‹: .....ä¸å†™å°±æ˜¯æ•è·å…¨éƒ¨é”™è¯¯ï¼šexcept:ä¸€æ¬¡æ•è·å¤šä¸ªé”™è¯¯ï¼šexcept (TypeError, NameError, ...):æ•è·åŒæ—¶ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼šexcept TypeError as error:åˆ†ç±»æ•è·ï¼šexcept TypeError: passexcept NameError: passexcept: passtry-except-else:try: ...except: ...else: # åªæœ‰å½“tryä¸‹çš„ä»£ç æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ—¶æ‰ä¼šè¿è¡Œ å¼‚å¸¸æŠ›å‡º raise ErrorTraceback (most recent call last): File XXXXXXXXXXXX, line 1, in module raise NameError(its not a error, i just like my console be red)NameError: its not a error, i just like my console be redraise NameError(its not a error, i just like my console be red) è‡ªå®šä¹‰å¼‚å¸¸ å¼‚å¸¸ç±»éœ€è¦ç»§æ‰¿è‡ªExceptionç±»class MyError(Exception): def __init__(self, value): self.value = value def __str__(self): return repr(self.value)try: raise MyError(must be a masochism who wrote this error for himself)except MyError as e: # must be a masochism who wrote this error for himself print(e.value) å½“æŸä¸ªæ¨¡å—å¯èƒ½æŠ›å‡ºå¤šç§å¼‚å¸¸é”™è¯¯æ—¶ï¼Œä¸€èˆ¬ä¸ºè¿™ä¸ªåŒ…å»ºç«‹ä¸€ä¸ªåŸºç¡€å¼‚å¸¸ç±»ï¼ŒåŸºäºæ­¤ç±»åˆ›å»ºä¸åŒçš„å­ç±»class Error(Exception): def __str__(self): return repr(self.message)class InputError(Error): def __init__(self, expression, message): self.expression = expression self.message = messageclass TransitionError(Error): def __init__(self, previous, next, message): self.previous = previous self.next = next self.message = message æ¸…ç†è¡Œä¸º try: print(æ‰§è¡Œå…¥å£) raise NameError(name error)except NameError: print(æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ)else: print(æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ)finally: print(æœ‰æ²¡æœ‰å¼‚å¸¸éƒ½æ‰§è¡Œ) é¢„å®šä¹‰çš„æ¸…ç†è¡Œä¸º f = open(xxx,wb)# å¼€å§‹è¿›è¡Œæ–‡ä»¶æ“ä½œf.close()å½“ä¸Šé¢æ–‡ä»¶æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œç¨‹åºä¼šç›´æ¥é€€å‡ºï¼Œæ— æ³•ä¿è¯closeæ–¹æ³•çš„æ‰§è¡Œ æ ‡å‡†æ¸…ç†è¡Œä¸ºpythonä¸­ä¸€äº›å¯¹è±¡å®šä¹‰äº†æ ‡å‡†çš„æ¸…ç†è¡Œä¸ºï¼Œä¸€æ—¦ç³»ç»Ÿä¸éœ€è¦å®ƒï¼Œæ ‡å‡†æ¸…ç†è¡Œä¸ºå°±ä¼šæ‰§è¡Œå¦‚ä½•ä¿è¯æ ‡å‡†æ¸…ç†è¡Œä¸ºè¢«æ­£ç¡®è°ƒç”¨ï¼Ÿç­”ï¼š ä½¿ç”¨å…³é”®è¯withè¯­å¥withè¯­å¥ä¿è¯å®šä¹‰äº†æ ‡å‡†æ¸…ç†æ–¹æ³•çš„å¯¹è±¡åœ¨ä½¿ç”¨å®ŒåæŒ‡å®šä¼šæ­£ç¡®æ‰§è¡Œæ¸…ç†æ–¹æ³•with open(XXX) as f: # å…¶ä»–æ“ä½œ é¢å‘å¯¹è±¡ç±»çš„æ–¹æ³• ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯selfselfå°±æ˜¯å®ä¾‹è‡ªèº«å®ä¾‹åŒ–æ–¹æ³•ç§æœ‰æ–¹æ³•ä¸“æœ‰æ–¹æ³•initç±»åœ¨å®ä¾‹åŒ–æ“ä½œæ—¶ä¼šè‡ªåŠ¨è°ƒ**init**æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ“ä½œdef __æ–¹æ³•å(params):åªèƒ½åœ¨ç±»å†…è°ƒç”¨çš„æ–¹æ³•é‡å†™ä¸“æœ‰æ–¹æ³•èƒ½å®ç°è¿ç®—ç¬¦é‡è½½class Dog: def __init__(self): self.count = 1 # åŠ æ³•è¿ç®—ç¬¦é‡è½½ def __add__(self, other): self.count+=other.count print(fdog number: self.count) return selfdog = Dog()dog += Dog() # dog number: 2dog += Dog() # dog number: 3dog += Dog() # dog number: 4 å¤šç»§æ‰¿ class DerivedClassName(Base1, Base2, ...): passå½“å¤šç»§æ‰¿çš„ç±»è°ƒç”¨ä¸€ä¸ªå±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹é¡ºåºå¯¹å±æ€§è¿›è¡ŒæŸ¥æ‰¾ï¼šå­ç±»è‡ªèº«ä¸­æŸ¥æ‰¾ç»§æ‰¿å‚æ•°ä»å·¦åˆ°å³è¿›è¡ŒæŸ¥æ‰¾"},{"title":"Flask Start","path":"/wiki/Python/flask_01_start.html","content":"Flaskä¸­æ–‡æ–‡æ¡£https://dormousehole.readthedocs.io/en/latest/#api æ­¤æ•™ç¨‹å†…å®¹æ¶‰åŠå†…å®¹å¾ˆæµ…ï¼Œä»…ä¸ºå¿«é€Ÿä¸Šæ‰‹Flaskæä¾›å…³é”®æ³¨æ„è¦ç‚¹ é¡¹ç›®é…ç½®ï¼ˆé’ˆå¯¹Pycharmï¼‰ å¼€å¯debug çƒ­æ›´æ–°æ¨¡å¼ edit configurations FLASK_DEBUG onä¿®æ”¹flaské¡¹ç›®è¿è¡Œçš„host edit configurations Additional options â€“host0.0.0.0ä¿®æ”¹flaské¡¹ç›®è¿è¡Œçš„port edit configurations Additional options â€“host0.0.0.0 â€“port8060å…³äºflaskï¼šdebugæ¨¡å¼çš„å¼€å¯æ–¹å¼ä¸€app.run(debug=True)æ–¹å¼äºŒ é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸ºflaskå¼€å‘æ¨¡å¼é…ç½®ç³»ç»Ÿæ¢ç¯å¢ƒå˜é‡ï¼Œæ‰“å¼€flaskè°ƒè¯•æ¨¡å¼import osos.environ[FLASK_ENV] = developmentos.environ[FLASK_DEBUG] = 1 URLä¸è§†å›¾çš„æ˜ å°„urlçš„ç»„æˆ http://127.0.0.1:5000/abc/urlä¸€èˆ¬ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šåè®® å¦‚http(80)https(443)è®¿é—®åŸŸåæ—¶ï¼Œä¸‹é¢ä¸¤ç§æ–¹å¼çš„å«ä¹‰ç›¸åŒï¼š127.0.0.1:80http://127.0.0.1ipåŸŸåè·¯ç”± åˆå§‹åŒ–æ–‡ä»¶ from flask import Flask, request, render_templatefrom datetime import datetime# __name__è¡¨ç¤ºå½“å‰æ¨¡å—å appä¸ºä¸­å¿ƒè°ƒç”¨å¯¹è±¡app = Flask(__name__)@app.route(/)def hello_world(): return hello # æ’é™¤å¼•ç”¨è§¦å‘è¿è¡Œçš„æƒ…å†µif __name__ == __main__: app.run() è·¯ç”±æ˜ å°„é…ç½® @app.route(/path) # è·¯ç”±é…ç½®def path_mapping(): # æ˜ å°„å‡½æ•° return render content # è¿”å›æ¸²æŸ“å†…å®¹åœ¨è®¿é—®è£…é¥°å™¨é…ç½®çš„è·¯ç”±æ—¶ï¼Œä¼šæ‰§è¡Œä¸‹æ–¹çš„å‡½æ•°ï¼Œå‡½æ•°è¿”å›å€¼å°±æ˜¯æ¸²æŸ“å†…å®¹ template flaskçš„templateå¼•å…¥æ˜¯é€šè¿‡Jinjiaæ¨¡æ¿å¼•æ“çš„Jinjiaå®˜æ–¹æ–‡æ¡£https://jinja.palletsprojects.com/en/3.1.x/ä»…éœ€è¦åœ¨flaské¡¹ç›®ä¸‹çš„ templates æ–‡ä»¶å¤¹ä¸­åŠ å…¥å¯¹åº”htmlæ¨¡æ¿ï¼Œç„¶ååœ¨è·¯ç”±æ˜ å°„å‡½æ•°çš„è¿”å›å€¼ä¸­ä½¿ç”¨flask.render_template(â€˜æŒ‡å®šæ¨¡æ¿.htmlâ€™) route+templateå®ä¾‹æ¼”ç¤ºè·¯ç”±ä¼ å‚ å¸¦å‚æ•°urlé™å®šå‚æ•°ç±»å‹é»˜è®¤å‚æ•°ç±»å‹å®šä¹‰æ—¶ä½¿ç”¨ åŒ…è£¹å˜é‡åç§°ï¼Œåœ¨æ˜ å°„å‡½æ•°çš„å‚æ•°ä¸­åŠ å…¥å¯¹åº”å˜é‡åç§°ï¼Œåœ¨æ˜ å°„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼ å…¥å˜é‡å€¼ï¼Œå‚æ•°ä¼šé€šè¿‡urlä¼ å…¥@app.route(/user/id)def user(id): return fWelcome, user idå‚æ•°ç±»å‹:å‚æ•°åç§°@app.route(/page/int:page_num)def page(page_num): return fpage page_numé€šè¿‡ path?key1value1?key2value2 çš„æ ¼å¼ä¼ é€’çš„å‚æ•°éƒ½å­˜å‚¨åœ¨ request.args ä¸­request éœ€è¦ä» flask å†…å¼•å…¥@app.route(/list/)def list(): page = request.args.get(page, 1) return flist pageï¼š page æ¨¡æ¿ æ¸²æŸ“æ¨¡æ¿æ¸²æŸ“+ä¼ å‚ä¼ å…¥å¯å˜ç±»å‹å‚æ•°éœ€è¦ä»flaskä¸­å¼•å…¥render_templateæ–¹æ³• !--template/index.html--h1Jinjia2 template/h1@app.route(/path)def get_path_template(): return render_template(index.html)render_template(url[,**args])index.htmlh1title/h1pcontent/pè·¯ç”±é…ç½®@app.route(/path/title/content)def path_render(title, content): return render_template(index.html, title=title, content=content)index.htmlbody user.name / user.email /bodyè·¯ç”±é…ç½®# ç±»å®šä¹‰class User: def __init__(self, **args): self.name = args[name] self.email = args[email]@app.route(/path)def path_render(): user = User( name=request.args.get(name, default name), email=request.args.get(email, 123456@default.com) ) # å¯å˜å‚æ•°ä¹Ÿé€šè¿‡å…³é”®å­—æŒ‡å®šæ–¹å¼ä¼ å‚ return render_template(index.html, user=user) jinjiaè¯­æ³• è‡ªå®šä¹‰è¿‡æ»¤å™¨æ§åˆ¶è¯­å¥æ¨¡æ¿ç»§æ‰¿åŠ è½½é™æ€èµ„æºè¿‡æ»¤å™¨è¯­æ³•h1 å˜é‡å|æŒ‡å®šè¿‡æ»¤å™¨ /h1jinjiaè¿‡æ»¤å™¨éƒ¨åˆ†æ–‡æ¡£https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filtersjinjiaæä¾›äº†å¦‚ä¸‹è¿™äº›è¿‡æ»¤å™¨ï¼šjinjiaæä¾›çš„è¿‡æ»¤å™¨è‡ªå®šä¹‰è¿‡æ»¤å™¨éœ€è¦ç”¨åˆ°add_template_filteræ–¹æ³•# filter_fun è¿‡æ»¤å™¨æ–¹æ³•ï¼Œå…¥å‚ä¸ºè¢«è¿‡æ»¤çš„å€¼ï¼Œè¿”å›è¿‡æ»¤åå€¼# filter_name è¿‡æ»¤å™¨åç§°app.add_template_filter(filter_fun, filter_name)ä¸‹é¢æä¾›çš„æ˜¯ä¸€ä¸ªå¯¹datetimeç±»å‹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼šindex.htmlbody mytime|dformat /bodyè·¯å¾„æ˜ å°„# 1 å®šä¹‰è¿‡æ»¤å™¨def data_format(time, format=%Y-%m-%d): return time.strftime(format)# 2 ç»‘å®šè¿‡æ»¤å™¨åˆ°appapp.add_template_filter(data_format, dformat)# 3 è·¯ç”±æ˜ å°„ä¸­ä½¿ç”¨@app.route(/path)def path_render(): mytime = datatime.now() return render_template(index.html, mytime=mytime)jinjiaæ¨¡æ¿ä¸­æä¾›ä¸¤ç§åŸºæœ¬çš„æµç¨‹æ§åˆ¶è¯­å¥ï¼šif-else% if exp_A % ...% elif exp_B % ...% else exp_C % ...% endif % for-in% for i in arr %...% endfor %ç”¨æ³•ç±»ä¼¼äºslotæ’æ§½çˆ¶æ¨¡å—é‡ŒåŠ å…¥å‘½åæ’æ§½ï¼šçˆ¶æ¨¡å—ä¸­å®šä¹‰æ’æ§½% block æ’æ§½å %% endblock %å­æ¨¡å—ä¸­ä½¿ç”¨æ’æ§½åå®šä½æ’æ§½æ’å…¥å­æ¨¡å—ä¸­æ¥å…¥æ’æ§½% extends çˆ¶æ¨¡å—.html %% block æ’æ§½å %...% endblock %éœ€è¦ç”¨åˆ°url_foræ–¹æ³•jinjiaæ¨¡æ¿é€šè¿‡url_forè·å–é™æ€æ–‡ä»¶çš„é»˜è®¤åœ°å€åœ¨templateåŒçº§ç›®å½•ä¸‹çš„staticæ–‡ä»¶å¤¹ä¸­æœ‰å¦‚ä¸‹ç›®å½•ç»“æ„ï¼šstaticcssindex.cssimgtoby_dog.jpgjsmain.jstemplatesstatic.htmlurl_foræ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šæ ¹æ®è§†å›¾å‡½æ•°çš„åç§°ç”Ÿæˆurl# staticè¡¨ç¤ºè·¯å¾„static# filenameè¡¨ç¤ºæ–‡ä»¶è·¯å¾„url_for(static, filename)html lang=enhead meta charset=UTF-8 titleTitle/title link rel=stylesheet href=url_for(static, filename=css/index.css) script src=url_for(static, filename=js/main.js)/script/headbodyimg src=url_for(static, filename=img/toby_dog.jpg) alt=/body/html"},{"title":"Flask Project","path":"/wiki/Python/flask_03_project.html","content":"é¡¹ç›®ç»“æ„ blueprintviews å­˜æ”¾å„ä¸ªè·¯ç”±æ˜ å°„æ¨¡å— static å­˜æ”¾é™æ€æ–‡ä»¶ templates å­˜æ”¾jinjiaæ¨¡æ¿ config å­˜æ”¾é…ç½®æ–‡ä»¶ä¿¡æ¯ config.py appé…ç½®ä¿¡æ¯ db_config.py æ•°æ®åº“é…ç½®ä¿¡æ¯ app.py å…¥å£æ–‡ä»¶ decorator.py è£…é¥°å™¨æ–‡ä»¶ exts.py æ‰©å±•æ–‡ä»¶ models.py ORMæ–‡ä»¶ åŠŸèƒ½ç®€è¿° ç”¨æˆ·æ³¨å†Œåç”Ÿæˆè´¦å· ç™»å½•è´¦å· å‚ä¸å¿ƒç†æµ‹è¯• å¿ƒç†æµ‹è¯•ç»“æœå‘é€åˆ°ç”¨æˆ·é‚®ç®± æ•°æ®åº“æ•°æ®åº“é…ç½®æ•°æ®åº“é…ç½® å°†configä¿¡æ¯å•ç‹¬æå–åˆ°configæ–‡ä»¶ä¸‹è¿›è¡Œé…ç½®ï¼šconfig/config.py appé…ç½®SECRET_KEY = oh its secrect key # flask.sessionéœ€è¦ç”¨åˆ°çš„å¯†é’¥config/db_config.py æ•°æ®åº“é…ç½®HOSTNAME = 127.0.0.1PORT = 3306USERNAME = rootPASSWORD = root123DATABASE = psychological_testSQLALCHEMY_DATABASE_URL = fmysql+pymysql://USERNAME@HOSTNAME:PORT/DATABASE?charset=utf8mb4app.py é…ç½®ä¿¡æ¯æ³¨å…¥from config import db_config, configapp.config.from_object(db_config) # æ•°æ®åº“é…ç½®app.config.from_object(config) # appé…ç½® exts.jså¦‚æœæˆ‘ä»¬æŠŠdbçš„åˆ›å»ºæ”¾åœ¨appæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ä»£ç ï¼š app.pydb = SQLAlchemy()db.init_app(app)migrate = Migrate(app, db) åŒæ—¶ï¼Œå¦‚æœæƒ³migrateåœ¨è¿›è¡Œæ•°æ®è¿ç§»æ—¶æ³¨æ„åˆ°ORMæ¨¡å‹çš„æ›´æ–°ï¼Œå°±å¿…é¡»è¦åœ¨app.pyä¸­å¼•ç”¨æ¨¡å‹ç±»ï¼š app.pyfrom models import UserModel, EmailModel, TestModel, OptionModel, ResultModel åœ¨models.pyä¸­ï¼Œä¸ºäº†ä½¿ORMæ¨¡å‹ç»§æ‰¿db.Modelç±»ï¼Œä¹Ÿå¿…é¡»å°†dbå¼•å…¥ï¼š app.pyfrom app import dbclass UserModel(db.Model): pass è¿™æ—¶ï¼Œå¼•ç”¨å¾ªç¯çš„é—®é¢˜å°±å‡ºç°äº†: ImportError: cannot import name XXX from partially initialized module XXX (most likely due to a circular import) dbçš„æ›´æ–°ä¸ä»modelsä¸­å¼•ç”¨æ¥çš„æ¨¡å‹ç›¸å…³ï¼Œè€Œmodelsä¸­çš„æ¨¡å‹åˆä¸dbçš„Modelç±»ç›¸å…³ï¼Œæ­¤å¤„éœ€è¦å¼•å…¥æ‰©å±•æ–‡ä»¶exts.pyï¼Œä¸“é—¨ç”¨äºåˆ›å»ºä¸€äº›appéœ€è¦ç”¨åˆ°çš„æ‰©å±•å¯¹è±¡exts.pyfrom flask_sqlalchemy import SQLAlchemydb = SQLAlchemy() ORMæ˜ å°„ORM UserModelTestModelResultModelEmailModelOptionModel Blueprintè§†å›¾æ‹†åˆ†Blueprintè“å›¾ color Blueprintå¯ä»¥ä¸ºè·¯ç”±ã€è§†å›¾ã€é™æ€æ–‡ä»¶ç­‰éœ€è¦urlæ˜ å°„çš„åŠŸèƒ½æä¾›ä¾¿æ·çš„æ¨¡å—æ‹†åˆ†æ–¹æ³•åœ¨blueprintæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºè§†å›¾æ¨¡å—æ–‡ä»¶ï¼šblueprint/index.pyfrom flask import Blueprintindex = Blueprint(index, __name__, url_prefix=)@index.route(/)def welcome(): return blueprintæ–‡ä»¶ä¸‹çš„è“å›¾å¯¹è±¡éœ€è¦åœ¨appä¸­æ³¨å†Œapp.pyfrom blueprint.index import indexapp.register_blueprint(index) wtforms è¡¨å•éªŒè¯wtformsä¸»è¦ç”¨äºéªŒè¯å‰ç«¯æäº¤çš„æ•°æ®æ˜¯å¦ç¬¦åˆè§„èŒƒflask-wtfæ˜¯flaskå¯¹wtformsçš„å°è£… wtformsçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼šå®šä¹‰è¡¨å•æ³¨æ„è¡¨å•é¡¹nameå­—æ®µè¦å’ŒéªŒè¯ç±»ä¸­çš„éªŒè¯å±æ€§åå¯¹åº”å®šä¹‰éªŒè¯ç±»ä¸€å®šè¦ç»§æ‰¿è‡ªwtforms.Formç±»éªŒè¯å±æ€§éªŒè¯æ–¹æ³•éœ€è¦ç”¨validate_éªŒè¯å±æ€§åçš„æ ¼å¼ä¸ºæ–¹æ³•å‘½åæ–¹æ³•å¿…é¡»åŒ…å«selfå’Œfieldä¸¤ä¸ªå‚æ•°ï¼Œç”¨fieldè®¿é—®è·å–éªŒè¯å±æ€§å€¼ï¼Œç”¨selfè®¿é—®å…¶ä»–å­—æ®µä½¿ç”¨éªŒè¯ç±»è¡¨å•å®šä¹‰form action= method=post div class=form-item pLIAME/p input type=text name=email /div div class=form-item pEMAN/p input type=text name=name /div div class=form-item pNOITATNACNI/p input type=password name=password /div input type=submit value=TCEJNI NOITATNACNI/formwtformsç±»å®šä¹‰import wtformsfrom wtforms.validators import Email, Lengthfrom models import UserModelclass RegisterForm(wtforms.Form): email = wtforms.StringField(validators=[Email(message=strange, something seems going wrong)]) name = wtforms.StringField(validators=[Length(min=1,max=20,message=strange, something seems going wrong)]) password = wtforms.StringField(validators=[Length(min=4,max=20,message=strange, something seems going wrong)]) def validate_emial(self, field): email = field.data user = UserModel.query.filter_by(email=email).first() if user: raise wtforms.ValidationError(message=strange, something seems going wrong)ä½¿ç”¨éªŒè¯ç±»from .forms import RegisterForm@index.route(/register, methods=[POST, GET])def register(): if request.method == POST: form = RegisterForm(request.form) if form.validate(): ... return ... else: print(form.errors) return ... werkzeugWSGL WSGL Web Server Gateway InterfaceWSGLæ˜¯Python Webåº”ç”¨ç¨‹åºå’ŒWebæœåŠ¡å™¨ä¹‹é—´çš„æ ‡å‡†æ¥å£Werkzeugæ˜¯pythonæä¾›çš„WSGLåº“ ä½¿ç”¨werkzeug.securityè¿›è¡Œæ•°æ®åŠ å¯† generate_password_hash åŠ å¯†check_password_hash æ¯”è¾ƒåŠ å¯†æ•°æ®å’ŒæœªåŠ å¯†æ•°æ®æ˜¯å¦åŒ…å«ç›¸åŒä¿¡æ¯åŠ å¯†from werkzeug.security import generate_password_hash, check_password_hashdef register(): .... password = generate_password_hash(form.password.data) user = UserMode( name=form.name.data, email=form.email.data, password=password ) æ¯”è¾ƒ@index.route(/login, methods=[POST, GET])def login(): ... user = UserModel.query.filter_by(email=form[email]).first() if user and check_password_hash(user.password, form[password]): session[user_id] = user.id return ... é’©å­å‡½æ•°Flaskä¸­çš„é’©å­å‡½æ•°ä½¿ç”¨è£…é¥°å™¨çš„å½¢å¼å®šä¹‰ ä¸€äº›å¸¸ç”¨çš„é’©å­å‡½æ•° before_request è¯·æ±‚ä¹‹å‰ã€è§†å›¾å‡½æ•°æ‰§è¡Œä¹‹å‰after_request è¯·æ±‚ä¹‹åã€å“åº”å‘é€ç»™ç”¨æˆ·ä¹‹å‰è°ƒç”¨teardown_request è¯·æ±‚ä¹‹åã€å“åº”å‘é€ç»™ç”¨æˆ·ä¹‹åè°ƒç”¨before_first_request åº”ç”¨å¯åŠ¨æ—¶å¤„ç†ç¬¬ä¸€ä¸ªè¯·æ±‚ä¹‹å‰è°ƒç”¨after_request åº”ç”¨å…³é—­æ—¶å¤„ç†æœ€åä¸€ä¸ªè¯·æ±‚ä¹‹åè°ƒç”¨ before_requestä½¿ç”¨ # è¯·æ±‚ä¹‹å‰å…¨å±€å­˜å…¥ç”¨æˆ·ä¿¡æ¯@app.before_requestdef before_request(): user_id = session.get(user_id) if user_id: user = UserModel.query.filter_by(id=user_id).first() setattr(g, user, user) else: setattr(g, user, None) Decoratorè£…é¥°å™¨è£…é¥°å™¨ è£…é¥°å™¨å®é™…ä¸Šæ˜¯å¯¹å‡½æ•°çš„åŒ…è£…æ“ä½œçš„è¯­æ³•ç³–ï¼Œè£…é¥°å™¨å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ä½œä¸ºè¾“å‡ºï¼Œæ¥æ”¶çš„å‚æ•°ç±»ä¼¼äºcallbackå›è°ƒå‡½æ•°flaskæä¾›äº†ä¸€äº›å¸¸ç”¨çš„è£…é¥°å™¨ï¼šå¦‚@app.errorhandler(error_code) å®šä¹‰é”™è¯¯å¤„ç†çš„è£…é¥°å™¨@app.errorhandler(404)def page_not_found(error): return Page Not Fount, 404@app.context_processor ä¸Šä¸‹æ–‡å¤„ç†å™¨å­˜æ”¾åœ¨ä¸Šä¸‹æ–‡å¤„ç†å™¨ä¸­çš„å˜é‡å€¼èƒ½åœ¨æ‰€æœ‰æ¨¡æ¿ä¸­è·å–åˆ°@app.context_processordef my_context_processor(): return user:g.user è‡ªå®šä¹‰è£…é¥°å™¨ è‡ªå®šä¹‰è£…é¥°å™¨æ–¹æ³•def my_decorator(func): # funcå³è¢«åŒ…è£…çš„å‡½æ•° @wraps(func) # ç”¨æ¥ä¿ç•™å‡½æ•°ä¿¡æ¯ def inner(): # å¯¹funcè¿›è¡ŒåŒ…è£… pass return inner # æœ€ç»ˆè°ƒç”¨å®é™…æ˜¯innerå‡½æ•° è¿›å…¥è·¯å¾„æ˜ å°„å‡½æ•°ä¹‹å‰å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ£€æµ‹çš„è£…é¥°å™¨ sessionsessionå¯¹è±¡ç”¨äºåœ¨Clientå’ŒServerä¹‹å‰å­˜å‚¨ç”¨æˆ·ä¼šè¯æ•°æ®é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlaskä½¿ç”¨ç­¾åçš„cookieæ¥å®ç°ä¼šè¯å­˜å‚¨ï¼ˆæµè§ˆå™¨ç«¯ï¼‰ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯æµè§ˆå™¨ç«¯ç­¾è¿‡åçš„cookieæ•°æ®ä¸ºäº†è¿›è¡ŒcookieåŠ å¯†ï¼Œéœ€è¦é…ç½®ä¼šè¯å¯†é’¥å¯†é’¥é…ç½®app.secret_key = your_secret_keysessionçš„å¸¸è§æ“ä½œæ–°å¢ä¿®æ”¹sessionå€¼session[key] = valueè·å–sessionæ•°æ®temp = session.get(key)åˆ é™¤sessionæ•°æ®session.pop(key, None) # åˆ é™¤é”®ä¸ºkeyçš„ä¼šè¯æ•°æ®session.clear() # æ¸…ç©ºæ‰€æœ‰ä¼šè¯æ•°æ® SMTPé‚®ä»¶æœåŠ¡å¦‚ä½•åœ¨flaské¡¹ç›®ä¸­å‘é€é‚®ä»¶ç»™æŒ‡å®šé‚®ç®± è·å–POP3SMTPIMAPæœåŠ¡æˆæƒç å¦‚ä½•è·å–æˆæƒç https://help.mail.163.com/faq.do?m=listæ–‡æ¡£ï¼‰å¼‚æ­¥å‘é€é‚®ä»¶exts.pyfrom flask_mail import Mailmail = Mail()mail_config.py# é‚®ä»¶æœåŠ¡çš„æœåŠ¡å™¨åœ°å€MAIL_SERVER = smtp.163.com# ä½¿ç”¨SSLåè®®åŠ å¯†MAIL_USE_SSL = True# SSLç«¯å£å·MAIL_PORT = 465# é‚®ç®±è´¦å·MAIL_USERNAME = piuyixiu@163.com# å¼€å¯SMTPæœåŠ¡æ—¶ç”Ÿæˆçš„æˆæƒç MAIL_PASSWORD = ...# é‚®ç®±è´¦å·MAIL_DEFAULT_SENDER = piuyixiu@163.comapp.pyfrom config import mail_configfrom exts import mailapp.config.from_object(mail_config)mail.init_app(app)å‘é€æ—¶ä¼šä½¿ç”¨åˆ°flask_mail.Messageç±»Messageé‚®ä»¶å¸¸ç”¨å±æ€§sender å‘é€è€…recipients æ¥æ”¶è€…subject ä¸»é¢˜body çº¯æ–‡æœ¬é‚®ä»¶å†…å®¹html HTMLé‚®ä»¶å†…å®¹attach æ·»åŠ é™„ä»¶æ·»åŠ é™„ä»¶æ—¶éœ€æ³¨æ„ï¼Œä»£ç ä¸­è¯»å–é™„ä»¶æ–‡ä»¶çš„è·¯å¾„æ˜¯ç›¸å¯¹äºæ‰§è¡Œè¯¥åº”ç”¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•çš„ï¼Œå³é¡¹ç›®ä¸»å…¥å£app.pyæ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„with open(static/img/makima.png,rb) as f: data = f.read() message.attach(Makima.png, image/png, data) mail.send(message)from exts import mailfrom flask_mail import Message@app.route(/send_to_email)def send_to_email(): email = request.args.get(email) message = Message( subject=é‚®ä»¶ä¸»é¢˜, recipients=[email], body=é‚®ä»¶å†…å®¹ ) mail.send(message) return jsonify(code=200, message=send success, data=None)"},{"title":"Flask DateBase","path":"/wiki/Python/flask_02_db.html","content":"æ•°æ®åº“é…ç½®# ä¸»æœºåHOSTNAME = 127.0.0.1# MySQLç«¯å£PORT = 3306# ç”¨æˆ·åUSERNAME = root# å¯†ç PASSWORD = root123# æ•°æ®åº“åç§°DATABASE = books# æ•°æ®åº“è·¯ç”±app.config[SQLALCHEMY_DATABASE_URI] = fmysql+pymysql://USERNAME:PASSWORD@HOSTNAME:PORT/DATABASE?charset=utf8mb4 å‡†å¤‡æ•°æ®åº“å¯¹è±¡SQLAlchemy Flaskæ¡†æ¶æ”¯æŒä½¿ç”¨SQLAlchemyè¿›è¡Œæ•°æ®åº“æ“ä½œFlask-SQLAlchemyhttps://flask-sqlalchemy.palletsprojects.com/en/3.1.x/SQLAlchemyhttps://www.sqlalchemy.org/ç›´æ¥æ ¹æ®app.configåˆ›å»ºå‡ºdbå¯¹è±¡db = SQLAlchemy(app) å…ˆåˆ›å»ºç©ºæ•°æ®åº“å¯¹è±¡ï¼Œå†æ³¨å…¥appè¿›è¡Œæ•°æ®åº“é…ç½®db = SQLAlchemy()db.init_app(app)è¿›è¡Œæ•°æ®åº“è¿æ¥æµ‹è¯•ï¼šwith app.app_context(): #æ‹‰å–appä¸Šä¸‹æ–‡ with db.engine.connect() as conn: # æ“ä½œæ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼šselect 1 rs = conn.execute(text(select 1)) migrate SQLAlchemyæµ…æ›´æ–°with app.app_context(): db.create_all()SQLAlchemyä¼šå°†æ‰€æœ‰ç»§æ‰¿äº† db.Model çš„ ORMæ¨¡å‹ æ˜ å°„æˆæ•°æ®åº“è¡¨ï¼Œä½†è¿™ç§è‡ªåŠ¨åŒ–çš„æ˜ å°„ä»…é™äºè¡¨çš„é¦–æ¬¡åˆ›å»ºï¼ˆæµ…æ›´æ–°ï¼‰å¦‚æœä¿®æ”¹å·²å­˜åœ¨è¡¨å†…éƒ¨çš„ç»“æ„ï¼ŒSQLAlchemyä¸ä¼šå¯¹å·²å­˜è¡¨çš„æ•°æ®åº“ç»“æ„è¿›è¡Œæ›´æ–°ï¼Œæ­¤å¤„æ ¹æ®ORMæ¨¡å‹è¿›è¡Œæ•°æ®åº“è¿ç§»æ›´æ–°çš„æ“ä½œå¯ä»¥ä½¿ç”¨ flask_migrate æ¥å®ç°migrateçš„é…ç½®from flask_migrate import Migratemigrate = Migrate(app, db) Migrate ORMæ˜ å°„æˆè¡¨çš„ä¸‰æ­¥1. åˆå§‹åŒ–æ•°æ®åº“ï¼Œä»…æ‰§è¡Œä¸€æ¬¡ flask db init 2. è¯†åˆ«ORMæ¨¡å‹çš„æ”¹å˜ï¼Œç”Ÿæˆè¿ç§»è„šæœ¬ï¼ˆmigrationn/versionsä¸‹çš„è¿ç§»è„šæœ¬ï¼‰ flask db migrate 3. è¿è¡Œè¿ç§»è„šæœ¬ flask db upgrade åœ¨æ‰§è¡Œå®Œç¬¬1æ­¥ï¼Œåˆå§‹åŒ–æ•°æ®åº“ä¹‹åï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°åˆ›å»ºä¸€ä¸ªmigrationsæ–‡ä»¶ï¼Œæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼šversions å­˜æ”¾æ¯æ¬¡æ›´æ–°çš„æ•°æ®åº“å¯¹åº”çš„æ›´æ–°å‘½ä»¤ï¼ˆä»¥ç‰ˆæœ¬å·å‘½åï¼‰ï¼Œæ”¯æŒæ ¹æ®æ•°æ®åº“ç‰ˆæœ¬å·è¿›è¡Œå›é€€æ“ä½œalembic.ini : A generic, single database configuration.env.py : Alembic Config objectREADMEscript.py.mako åˆ›å»ºORMæ¨¡å‹ORM O Object å¯¹è±¡R Relationship å…³ç³»M Map æ˜ å°„ORMæ¨¡å‹éœ€è¦ï¼šç»§æ‰¿è‡ªdb.Modelæ‹¥æœ‰è¡¨åå±æ€§ tablenameBookclass Book(db.Model): __tablename__ = book # æ•´å‹ ä¸»é”® è‡ªå¢ id = db.Column(db.Integer, primary_key=True, autoincrement=True) # 200é•¿åº¦å­—ç¬¦ä¸² éç©º name = db.Column(db.String(200), nullable=False) # æ•´å‹ è¢«å¼•ç”¨å¤–é”®author.id author_id = db.Column(db.Integer, db.ForeignKey(author.id)) # åœ¨Authorè¡¨ä¸­åå‘èšé›†bookåºåˆ— author = db.relationship(Author, backref=book)Authorclass Authro(db.Model): __tablename__ = author id = db.Column(db.Integer, primary_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False) country = db.Column(db.String(200), nullable=False) birthday = db.Column(db.Date)ForeignKey relationshipdb.ForeignKey(target_table.key_name)é€šè¿‡æä¾›æŒ‡å®šè¡¨çš„ä¸»é”®å€¼ï¼Œèƒ½å¤Ÿå°†å¯¹åº”çš„æ•´æ¡æ•°æ®æ‹‰å–è¿‡æ¥ï¼Œç›¸å½“äºæ‘‡äººæ—¶æ‰‹æœºé‡Œçš„ç”µè¯å·ç ï¼Œæ¯”å¦‚å¸Œæœ›Johnè¿‡æ¥ï¼Œåªéœ€è¦Johnçš„æ‰‹æœºå·ç ï¼Œä½†æ˜¯æŠŠJohnå«è¿‡æ¥ä¹‹åï¼Œéœ€è¦ç»™Johnæµå‡ºä¸€ä¸ªåº§ä½å®‰é¡¿ï¼Œå¯¹åº”çš„ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºè¢«æ‹‰å–çš„æ•°æ®æä¾›ä¸€ä¸ªå­˜æ”¾çš„ä½ç½®ï¼ˆç”šè‡³å¯ä»¥æ˜¯å…¶ä»–è¡¨ï¼ï¼‰target_value = db.relationship(target_table_Model, back_populates=back_target_table)ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨ç›®æ ‡è¡¨çš„ORMæ¨¡å‹åç§°ï¼ˆå­—ç¬¦ä¸²ï¼‰back_populates å®šä¹‰åå‘å¼•ç”¨ï¼Œç”¨äºå»ºç«‹åŒå‘å…³ç³»ç°åœ¨Bookå’ŒAuthoræ˜¯å¤šå¯¹ä¸€çš„å…³ç³»Bookä¸­æ‹‰å–å¯¹åº”authorçš„ä¿¡æ¯ï¼Œï¼ˆè¿™æœ¬ä¹¦çš„ä½œè€…æ˜¯Xå›ï¼‰åŒæ—¶ä¹Ÿéœ€è¦åœ¨authorä¸­æ”¶é›†Booksçš„ä¿¡æ¯ï¼Œï¼ˆXå›å†™äº†Aã€Bã€Cç­‰ä¹¦ï¼‰å› æ­¤ä¸ºäº†å»ºç«‹èµ·å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œéœ€è¦åŒæ—¶å¯¹ä¸¤å¼ è¡¨è¿›è¡Œé…ç½®ï¼š BookModelclass Book(db.Model):....author_id = db.Column(db.Integer, db.ForeignKey(author.id))author = db.relationship(Author, back_populates=book) AuthorModelclass Author(db.Model):...book = db.relationship(Book, back_populates=author) ä¸ºäº†ç®€åŒ–è¿™ç§åŒå‘é…ç½®çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨backrefè¿›è¡Œåå‘èšé›†é…ç½®ï¼šBookModelclass Book(db.Model): ... author_id = db.Column(db.Integer,db.ForeignKey(author.id)) author = db.relationship(Author, backref=books)å¸¸ç”¨çš„SQLAlchemyå…³ç³»å‡½æ•°å‚æ•° æ•°æ®åº“å…³ç³»é…ç½® ä¸€å¯¹å¤šå¤šå¯¹ä¸€ä¸€å¯¹ä¸€å¤šå¯¹å¤šWriterModelï¼šä¸€class Writer(db.Model): __tablename__ = writer id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False) books = db.relationship(Book, backref=writer)BookModelï¼šå¤šclass Book(db.Model): __tablename__ = book id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False) writer_id = db.Column(db.Integer, db.ForeignKey(writer.id))CitizenModelï¼šå¤šclass Citizen(db.Model): __tablename__ = citizen id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False) city_id = db.Column(db.Integer, db.ForeignKey(city.id)) city = db.relationship(City)Cityï¼šä¸€class City(db.Model): __tablename__ = city id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False, unique=True)Countryï¼šä¸€class Country(db.Model): __tablename__ = country id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False, unique=True) capital = db.relationship(Capital, uselist=False)Capitalï¼šä¸€class Capital(db.Model): __tablename__ = capital id = db.Column(db.Integer, primery_key=True, autoincrement=True) name = db.Column(db.String(200), nullable=False) country_id = db.Column(db.Integer,db.ForeignKey(country.id)) country = db.relationship(Country)}association_tbaleï¼šè¾…åŠ©è¡¨association_table = db.Table( association, db.Column(student_id,db.Integer,db.ForeignKey(student.id)), db.Column(teacher_id,db.Integer,db.ForeignKey(teacher.id)))StudentModelï¼šå¤šclass Student(db.Model): __tablename__ = student id = db.Column(db.Integer, primery_key=True, autoincrement=True) teachers = db.relationship( Teacher, secondary = association_table, back_populates = students )TeacherModelï¼šå¤šclass Teacher(db.Model): __tablename__ = teacher id = db.Column(db.Integer, primery_key=True, autoincrement=True) students = db.relationship( Student, secondary= association_table, back_populates=teachers ) åŸºæœ¬æ•°æ®åº“æ“ä½œéœ€è¦å†™å…¥æ•°æ®åº“çš„æ“ä½œéƒ½éœ€è¦åœ¨æœ€åè¿›è¡Œcommitæäº¤db.session.commit()å¢åˆ æ”¹æŸ¥db.session.addbook = Book(name=name, author_id=author)db.session.add(book)db.session.commit()db.session.deletebook = Book.query.get(id)db.session.delete(book)db.session.commit()book = Book.query.get(id)book.name = new_namedb.session.commit()Obj.queryæ˜¯ç»§æ‰¿è‡ªdb.Modelçš„å±æ€§ï¼ŒæŸ¥è¯¢éœ€è¦è°ƒç”¨ORMæ¨¡å‹çš„queryå±æ€§get(primary_key) é€šè¿‡ä¸»é”®æŸ¥è¯¢book = Book.query.get()filter_by(keyvalue,â€¦)æ³¨æ„ï¼š filter_by()[0]å’Œfilter_by().first()çš„åŒºåˆ«ï¼šfilter_by[0] ä¸ºç©ºæ—¶ä¼šæŠ¥é”™filter_by().first() ä¸ºç©ºæ—¶ä¸ä¼šæŠ¥é”™book = Book.query.filter_by(name=name)"},{"title":"textæ–‡æœ¬æ•ˆæœ","path":"/wiki/UI/IxD_02_text.html","content":"Typing Effect æ‰“å­—æ•ˆæœæœç´¢å…³é”®å­—ï¼š Typing Effectæ‰“å­—æ•ˆæœæœ‰å„ç§å„æ ·çš„ï¼šä»…å®ç°æ‰“å­—å®ç°æ‰“å­—ä¸å›é€€å®ç°å¤šè¡Œè¿ç»­æ‰“å­—å®ç°ä»»æ„å†…å®¹çš„æ‰“å­—å¦‚æœä»…ä»…è¦å®ç°é™æ€æ–‡æœ¬æ‰“å­—æ•ˆæœï¼Œåªç”¨åˆ°csså°±è¶³å¤Ÿäº†ï¼šhead style .wrapper height:100vh; display: grid; place-items:center; .typing-demo /* è¿™é‡Œå®½åº¦å’ŒåŠ¨ç”»æ­¥æ•°éƒ½è¢«å†™æ­»äº† */ width:10ch; animation: typing 2s steps(5), blink .5s step-end infinite alternate; white-space: nowrap; overflow: hidden; border-right: 3px solid; font-family: monospace; font-size: 2em; @keyframes typing from width:0; @keyframes blink 50%border-color:transparent; /style/head!-- https://codepen.io/denic/pen/GRoOxbM --body div class=wrapper div class=typing-demoæ‰“å‡ºè¿™è¡Œå­—/div /div/bodyæ¯”è¾ƒå…³é”®çš„æ˜¯ç”¨åˆ°çš„å­—ä½“å•ä½æ˜¯chï¼Œchä»¥å­—ä½“ä¸­0ä¸ºæ ‡å‡†ï¼Œè¿›è¡Œç›¸å¯¹å­—ä½“å¤§å°è®¾ç½®ï¼Œå› æ­¤æ€»æ˜¯èƒ½å°†åŠ¨ç”»å¡åœ¨æ¯ä¸€ä¸ªå­—ä¸Šï¼Œè€Œä¸ä¼šæœ‰ä¸€åŠå­—éœ²å‡ºæ¥çš„æƒ…å†µï¼Œçº¯cssçš„æ–¹æ³•ä¸€èˆ¬è¦å°†å­—ä½“æ•°é‡å†™æ­»åœ¨cssé‡Œï¼Œéå¸¸ä¸çµæ´»è‡ªå®šä¹‰å†…å®¹é€šè¿‡jsè·å–è¦æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œç„¶åé€šè¿‡setTimeoutæ§åˆ¶å­—æ•°ä¸€ç‚¹ä¸€ç‚¹å¢åŠ ï¼ˆåˆ é™¤æ•ˆæœåŒç†ï¼Œä¸€ç‚¹ä¸€ç‚¹å‡å°‘ï¼‰ï¼Œå¾ˆæ–¹ä¾¿èƒ½å®ç°æ–‡å­—è¾“å…¥æ•ˆæœï¼šconst typingSpeed = 50, erasingSpeed = 25let captionLength = 0const typingInput = document.querySelector(#test-caption)const typingBtn = document.querySelector(#test-typing)const erasingBtn = document.querySelector(#test-erasing)const caption = document.querySelector(#caption)const cursor = document.querySelector(#cursor)let captionText = window.onload = () = typingBtn.addEventListener(click, typing) erasingBtn.addEventListener(click, erasing)// æ‰“å­—/åˆ é™¤æ—¶ç¦ç”¨æŒ‰é’®function btnControl(enable) let fun = enable?removeAttribute:setAttribute typingBtn[fun](disabled,undefined) erasingBtn[fun](disabled,undefined)// æ‰“å­—function typing() captionText = typingInput.value if(captionText.length=0 ) return btnControl(false) caption.innerHTML = let curText = cursor.classList.remove(blink) Array.from(captionText).forEach((ch,index)= setTimeout(()= // ä¸€ä¸ªå­—ä¸€ä¸ªå­—åŠ ä¸Š curText += ch caption.innerHTML = curText if(index == captionText.length - 1) btnControl(true) cursor.classList.add(blink) , index*typingSpeed) )// å›é€€function erasing() if( captionText.length=0 ) return btnControl(false) cursor.classList.remove(blink) for(let i = captionText.length -1 ; i = 0; i--) // å¯¹å†…å®¹ä¸€ä¸ªå­—ä¸€ä¸ªå­—åˆ å‡ let curText = captionText.slice(0, i) setTimeout(()= caption.innerHTML = curText if(i == 0) btnControl(true) cursor.classList.add(blink) captionText = ,(captionText.length - i)*erasingSpeed) æ‰“å­—æ•ˆæœ"},{"title":"Easter egg","path":"/wiki/Python/flask_04_easter_egg.html","content":"Toby dog Tarot Card"},{"title":"gridå¸ƒå±€","path":"/wiki/UI/css_01_grid.html","content":"å‚è€ƒåšå®¢ï¼šé˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— åŸºæœ¬æ¦‚å¿µflexå’Œgridçš„åŒºåˆ« flexï¼šè½´çº¿å¸ƒå±€ä¸€ç»´å¸ƒå±€gridï¼šè¡Œåˆ—å¸ƒå±€äºŒç»´å¸ƒå±€ å®¹å™¨é¡¹ç›® å®¹å™¨ï¼šè¢«åˆ’åˆ†æˆç½‘æ ¼çš„æ ¹å…ƒç´ é¡¹ç›®ï¼šè¢«å¸ƒå±€çš„å­å…ƒç´  åŸºæœ¬å±æ€§ gridçš„å¼€å¯ï¼šdisplay: grid;display: inline-grid;è¡Œåˆ—å®½é«˜çš„æŒ‡å®šï¼š/*æŒ‡å®šåˆ—å®½ */grid-template-columns: 50px 50px 50px; /*æŒ‡å®šè¡Œé«˜ */grid-template-rows: 50px 50px 50px; repeatå‡½æ•°ä½¿ç”¨repeatï¼Œç±»ä¼¼äºforå¾ªç¯å¿«é€ŸæŒ‡å®šå®½åº¦æ¨¡å¼ã€‚repeatæœ‰2ä¸ªå‚æ•°ï¼šå‚æ•°1ï¼šé‡å¤æ¬¡æ•°å¯ä»¥æ˜¯auto-fillå‚æ•°2ï¼šé‡å¤å€¼å¯ä»¥æ˜¯å¤šä¸ªå€¼grid-template-columns: repeat(3, 33.33%);grid-template-rows: repeat(3, 33.33%);repeatçš„ç¬¬2ä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå€¼ï¼šgrid-template-columns: repeat(3, 100px 20px 80px);repeatç¬¬1ä¸ªå‚æ•°å¯ä»¥ä½¿ç”¨è‡ªé€‚åº”å…³é”®å­—auto-fillgrid-template-columns: repeat(auto-fill, 100px);frå•ä½frå…³é”®å­—ç±»ä¼¼äºflexæˆ–è€…spanï¼Œå°†å®½åº¦è¿›è¡Œç­‰åˆ†ä¹Ÿå¯ä»¥å’Œç»å¯¹å•ä½æ··åˆä½¿ç”¨grid-template-columns: 1fr 1fr 1fr; grid-template-columns: 150px 1fr 2fr; minmaxå‡½æ•°ç”Ÿæˆä¸€ä¸ªé•¿åº¦èŒƒå›´grid-template-columns: 1fr 1fr minmax(100px, 1fr); autoå…³é”®å­—autoå…³é”®å­—ï¼Œè¡¨ç¤ºè‡ªé€‚åº”å°ºå¯¸grid-template-columns: 100px auto 100px; ç½‘æ ¼çº¿åç§°ä½¿ç”¨æ–¹æ‹¬å·æŒ‡å®šç½‘æ ¼çº¿åç§°ï¼Œä¸€æ ¹çº¿å¯ä»¥æœ‰å¤šä¸ªåç§°ï¼šgrid-template-columns: [c1] 100px [c2] 100px [c3] auto [c4];grid-template-rows: [r1 row1] 100px [r2] 100px [r3] auto [r4]; å®¹å™¨å±æ€§ç½‘æ ¼å®¹å™¨ gap é—´è·/* row-gap è¡Œé—´è· column-gap åˆ—é—´è· gap: grid-row-gap grid-column-gap*/row-gap:10px;column-gap: 10px;gap:10px; areagrid-template-areaså±æ€§ç”¨äºåˆ’åˆ†åŒºåŸŸï¼ŒåŒºåŸŸçš„å‘½åä¼šå½±å“åˆ°ç½‘æ ¼çº¿çš„å‘½åï¼Œç½‘æ ¼çº¿è‡ªåŠ¨ä»¥ï¼ŒåŒºåŸŸå-startendå‘½å.grid-root /* ... */ display: grid; grid-template-areas: a b c d e f g h i; å­ç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨grid-areaå±æ€§æ ‡æ˜æ‰€å±åŒºåŸŸï¼š.grid-item-1 grid-area:a;grid-auto-flowåˆ’åˆ†å¥½ç½‘æ ¼ä¹‹åï¼Œéœ€è¦å°†ç½‘æ ¼å®¹å™¨ä¹‹ä¸‹çš„é¡¹ç›®ä¾æ¬¡å¡«å…¥ï¼Œå¡«å…¥çš„é¡ºåºç”±grid-auto-flowæ§åˆ¶ï¼š/* å…ˆè¡Œååˆ— */grid-auto-flow: row; /* å…ˆåˆ—åè¡Œ */grid-auto-flow: column; æ§åˆ¶é¡¹ç›®çš„å±æ€§ é¡¹ç›®å¸ƒå±€justifyalignplace-itemsç”¨äºæ§åˆ¶é¡¹ç›®åœ¨ç½‘æ ¼ä¸­çš„å¸ƒå±€/* justify-items ç½‘æ ¼å†…ç‰©ä½“çš„æ¨ªå‘å¸ƒå±€ align-items ç½‘æ ¼å†…ç‰©ä½“çš„çºµå‘å¸ƒå±€ place-items: align-items justify-items*/justify-items: stretch; place-items:center start; justifyalignplace-contentç”¨äºæ§åˆ¶ç½‘æ ¼çš„è¡Œåˆ—ç›¸å¯¹äºå®¹å™¨çš„å¸ƒå±€/* justify-content æ¨ªå‘åˆ†åˆ—çš„å¸ƒå±€ align-content çºµå‘åˆ†è¡Œçš„å¸ƒå±€ place-content:align-contents justify-contents*/justify-content: space-around;align-content: center;grid-auto-columnsrowså½“ç»™é¡¹ç›®æŒ‡å®šçš„è¡Œåˆ—è¶…å‡ºåœ¨å®¹å™¨ä¸­ï¼Œä½¿ç”¨grid-template-columnsrowsareasåˆ›å»ºçš„è¡Œåˆ—æ•°æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ›å»ºå¤šä½™çš„ç½‘æ ¼ï¼Œä½¿ç”¨grid-auto-columnsrowsæ§åˆ¶è‡ªåŠ¨åˆ›å»ºçš„è¡Œåˆ—çš„å°ºå¯¸grid-template-columns: 1fr 1fr;grid-template-rows: 100px 100px;grid-auto-rows: 50px; é¡¹ç›®å±æ€§é¡¹ç›®å±æ€§ æŒ‡å®šä½ç½®é€šè¿‡ä¸‹é¢çš„å±æ€§ï¼Œå¯ä»¥åœ¨å®¹å™¨ç½‘æ ¼ä¸­æŒ‡å®šé¡¹ç›®çš„ä½ç½®ï¼šgrid-column-startgrid-column-endgrid-row-startgrid-row-end.grid-item grid-column-start: 1; grid-column-end: 2; grid-row-start:1; grid-row-end:3;é™¤äº†é€šè¿‡ç´¢å¼•æŒ‡å®šå¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ …æ ¼çº¿çš„åç§°ï¼š.grid-box display: grid; grid-template-columns: [c1] 1fr [c2] 1fr [c3] 1fr [c4]; grid-template-rows: [r1] 1fr [r2] 1fr [r3] 1fr [r4];.grid-item-1 grid-column-start:c2; grid-column-end: c4;spanå…³é”®å­—å¯ä»¥ç”¨æ¥è¡¨ç¤ºè·¨è¶Šçš„ç½‘æ ¼æ•°ï¼Œä½¿ç”¨spanæ—¶ï¼Œgrid-column-startendæ‰€è¡¨ç¤ºçš„æ„æ€å®Œå…¨ä¸€è‡´.grid-item-2 grid-column-start: span 3;å¯ä»¥ç›´æ¥é€šè¿‡åˆå¹¶çš„æ–¹å¼ç®€å†™rowå’Œcolumnçš„èŒƒå›´ï¼š.grid-item-4 /* grid-column: start-line / end-line grid-row: start-line / end-line */ grid-column: 1 / 3; /* ä¹Ÿå¯ä»¥ç›´æ¥åŠ å…¥spanå…³é”®å­— */ grid-row: 4 / span 2; background:pinkè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨areaç®€å†™è¡Œåˆ—ï¼š.grid-item-3 /* grid-area: row-start / column-start / row-end / column-end */ grid-area: 6 / 2 / 7 / 3;justify-selfå’Œjustify-itemçš„åŒºåˆ«2è€…çš„ä½¿ç”¨æ•ˆæœéå¸¸ç›¸ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼šjustify-selfç”±é¡¹ç›®æ§åˆ¶è‡ªèº«çš„å¸ƒå±€justify-itemç”±å®¹å™¨æ§åˆ¶æ‰€æœ‰é¡¹ç›®çš„å¸ƒå±€"},{"title":"åŸºç¡€æ ·å¼","path":"/wiki/UI/IxD_01_style.html","content":"è·Ÿéšæ»šåŠ¨å˜è‰²çš„å›¾ç‰‡åŸç½‘å€ï¼šElementUIä¸­æ–‡å®˜ç½‘https://element.eleme.cn/#/zh-CN å®ç°å¯¹è§’çº¿çš„å‡ ç§æ–¹å¼children:tabs å¯¹è§’çº¿æ ·å¼æ–¹å¼1ï¼šborderæ–¹å¼2ï¼šbackgroundæ–¹å¼3ï¼šclip-path HTMLdiv class=border-wrapper div class=border-inner/div div class=border-mask/div/divCSS.border-wrapper width:100px; height:100px; border:1px solid #000000; position:relative; overflow: hidden;.border-inner position:absolute; top:0; left:0; border-left: 100px solid #000000; border-top:100px solid rgba(0, 0, 0, 0); background: #fff;.border-mask position:absolute; top:1px; left:0; border-left: 100px solid #ffffff; border-top:100px solid rgba(0, 0, 0, 0); background: #00000000;HTMLdiv class=background-wrapper/divCSS.background-wrapper width:100px; height: 100px; border:1px solid #000000; background: linear-gradient(45deg,#fff 49%,#000,#fff 50%); HTMLdiv class=clip-path-wrapper div class=clip-path-inner/div/divCSS.clip-path-wrapper width:100px; height:100px; border:1px solid #000000;.clip-path-inner width:100%; height:100%; background: #000; clip-path: path(M0.5 0 L100 99.5 L99.5 100 L0 0.5); spriteç²¾çµå›¾å®ç°gifæ•ˆæœç²¾çµå›¾æ•ˆæœå‚è€ƒåœ°å€ç²¾çµå›¾å®ç°åŠ¨æ€å›¾ç‰‡æ•ˆæœçš„åŸç†ç±»ä¼¼ä¸ç”µå½±èƒ¶å·ï¼Œé€šè¿‡å¿«é€Ÿåˆ†å¸ƒå¹³ç§»ï¼Œå®ç°åŠ¨æ€æ•ˆæœï¼šdiv class=sprite-bg/div.sprite-bg width:100%; height:100%; background-image: $spriteBgImg; background-position: top; background-size:100% auto; filter:brightness(1.3); animation: anime-effect 0.5s steps(30); animation-iteration-count: infinite; @keyframes anime-effect 0% background-position: 0px 0px; 100% background-position: 0px -15015px; æœ€ç»ˆå®ç°æ•ˆæœï¼š"},{"title":"Media Queries åª’ä½“æŸ¥è¯¢","path":"/wiki/UI/css_02_media_queries.html","content":"MDNæ–‡æ¡£ï¼šä½¿ç”¨åª’ä½“æŸ¥è¯¢å¯æŸ¥è¯¢å‚æ•° widthå¸¸è§å±å¹•å°ºå¯¸é€‚é…ï¼šæ‰‹æœºå°ºå¯¸ï¼š320px-480pxå¹³æ¿ç”µè„‘ï¼š 481px - 1024pxå¤§å±å¹•ç”µè„‘ï¼š 1025pxä»¥ä¸Š@media (max-width: 480px) .phone background-color: #023047; @media (min-width: 481px) and (max-width:1024px) .tablet background-color: #ffb703; @media (min-width: 1025px) .pc background-color: #fb8500;"},{"title":"24ä¸ªsvgç¤ºä¾‹","path":"/wiki/UI/svg_01_24demos.html","content":"24ä¸ªç¤ºä¾‹ Hunor MÃ¡rton BorbÃ©ly åŸè§†é¢‘åœ°å€ bç«™æ¬è¿åœ°å€ åœ¨html5ä¹‹åï¼Œhtmlä¸­å¯ä»¥ç›´æ¥ä¹¦å†™svgï¼Œæ— éœ€å†å°†svgæ ‡ç­¾å•ç‹¬æ‹‰å‡ºã€‚ svgå’Œhtmlä¸èƒ½æ··ç”¨æ ‡ç­¾ svgæ ‡ç­¾å±æ€§ widthheight å¤–éƒ¨å°ºå¯¸viewBox( sx, sy, w, h) å†…éƒ¨å°ºå¯¸sxsy å·¦ä¸Šè§’èµ·å§‹åæ ‡wh å®½åº¦é«˜åº¦åæ ‡ç³» å·¦ä¸Šè§’å¼€å§‹ï¼ˆ0, 0ï¼‰å³ä¸‹è§’ç»“æŸï¼ˆ100, 100ï¼‰å®½50pxï¼Œé«˜50pxï¼Œç»˜åˆ¶ï¼ˆ0,0ï¼‰-ï¼ˆ100,100ï¼‰çš„å›¾åƒ svg width=50 height=50 viewBox=0 0 100 100 circle cx=50 cy=50 r=25 fill=#00ff00/circle/svgå®½100pxï¼Œé«˜100pxï¼Œç»˜åˆ¶ï¼ˆ0,0ï¼‰-ï¼ˆ100,100ï¼‰çš„å›¾åƒ svg width=100 height=100 viewBox=0 0 100 100 circle cx=50 cy=50 r=25 fill=#00ff00/circle/svgå®½100pxï¼Œé«˜100pxï¼Œç»˜åˆ¶ï¼ˆ0,0ï¼‰-ï¼ˆ50,50ï¼‰çš„å›¾åƒ svg width=100 height=100 viewBox=0 0 50 50 circle cx=50 cy=50 r=25 fill=#00ff00/circle/svgå®½100pxï¼Œé«˜100pxï¼Œç»˜åˆ¶ï¼ˆ-50,-50ï¼‰-ï¼ˆ50,50ï¼‰çš„å›¾åƒ svg width=100 height=100 viewBox=-50 -50 100 100 circle cx=50 cy=50 r=25 fill=#00ff00/circle/svg åœ£è¯çƒ .ball{ animation: changeHue infinite 750ms; } @keyframes changeHue { 0%{ filter:hue-rotate(0deg) brightness(1.5); } 100%{ filter:hue-rotate(360deg) brightness(1.5); } } svgxmlns=http://www.w3.org/2000/svgwidth=200height=200viewBox=-100 -100 200 200 circle cx=0 cy=20 r=70 fill=#d1495b /circle circle cx=0 cy=-75 r=12 stroke=#f79257 stroke-width=5 fill=none /circle rect x=-17.5 y=-65 width=35 height=20 fill=#f79257 /rect/svg åœ£è¯æ ‘ svgwidth=200height=230viewBox=-100 -100 200 230 polygon points=0,-20 80,100 -80,100 fill=#234236/polygon polygon points=0,-60 60,40 -60,40 fill=#0C5C4C/polygon polygon points=0,-100 40,-20 -40,-20 fill=#38755b/polygon rect x=-20 y=100 width=40 height=30 fill=brown/rect/svg å§œé¥¼äºº"},{"title":"Three.js Tutorial for Absolute Beginners","path":"/wiki/ThreeJs/Wael_01_threejs_for_beginners.html","content":"æºé¡¹ç›®ä»“åº“ï¼š npmå®‰è£… parcel.js ç¨‹åºæ‰“åŒ…å·¥å…· three.js å›¾è¡¨åº“ threejså°½é‡å®‰è£…ç¨³å®šç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬å¯èƒ½å­˜åœ¨å„ç§é—®é¢˜ npm install three@0.133.0npm install parcel parcel.js parcelå°†å¤šä¸ªæºæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªdistï¼Œæ”¯æŒå¼€å‘æ—¶çƒ­æ›´æ–°ã€‚æ–‡ä»¶ç»“æ„å¦‚ä¸‹æ—¶ï¼šrootsrcjsmain.jsindex.html ä¸»é¡µé¢å…¥å£package.jsonåœ¨é¡¹ç›®æ ¹ç›®å½•è·¯å¾„root\\ä¸‹ä½¿ç”¨parcelå‘½ä»¤ï¼šparcel index.htmlparcelä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•root\\ä¸‹åˆ›å»ºä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼Œå³çœŸæ­£è¿è¡Œçš„æ–‡ä»¶ æ¸²æŸ“å™¨Rendereråœºæ™¯Sceneæ‘„åƒæœºCameraåœºæ™¯Scene const scene = new THREE.Scene() æ‘„åƒæœºCamera const camera = new THREE.PerspectiveCamera( 75, //fov window.innerWidth / window.innerHeight, //aspect 0.01, //near 10000 //far)scene.add(camera)camera.position.set(20, 20, 20)camera.lookAt(0,0,0) Rendereræ¸²æŸ“å™¨ const renderer = new THREE.WebGLRenderer()renderer.setSize(window.innerWidth, window.innerHeight)document.body.append(renderer.domElement)renderer.render(scene, camera) åæ ‡ç³»è¾…åŠ©çº¿AxesHelperç‰©ä½“ObjectåŠ¨ç”»Animateè½¨é“æ§åˆ¶å™¨OrbitControlsAxesHepler const axesHelper = new THREE.AxesHelper(15)scene.add(axesHelper) Object const boxGeometry = new THREE.BoxGeometry(3,3,3)const boxMetarial = new THREE.MeshBasicMaterial( color:0x00ff00)const box = new THREE.Mesh(boxGeometry, boxMetarial)scene.add(box) Animate è®°å¾—æ¯æ¬¡è°ƒç”¨animateæ—¶éƒ½è¦è°ƒç”¨renderè¿›è¡Œé‡ç»˜renderer.setAnimationLoop(animate)function animate(time) box.rotation.x = time / 1000 box.rotation.y = time / 1000 renderer.render(scene, camera) OrbitControls æ¯æ¬¡å¯¹ç›¸æœºè¿›è¡Œä¿®æ”¹åï¼Œéƒ½éœ€è¦è°ƒç”¨orbit.update()è¿›è¡Œæ›´æ–°import OrbitControls from three/examples/jsm/controls/OrbitControls// ...const orbit = new OrbitControls(camera, renderer.domElement)orbit.update() Geometryå‡ ä½•æ„é€ Materialæè´¨GridHelperç½‘æ ¼è¾…åŠ©å™¨GeometryMaterial // plane geometryconst planeGeometry = new THREE.PlaneGeometry(30, 30)const planeMaterial = new THREE.MeshBasicMaterial( color: 0xffffff, side:THREE.DoubleSide)const plane = new THREE.Mesh(planeGeometry, planeMaterial)scene.add(plane)plane.rotation.x = -Math.PI / 2// sphere geometryconst sphereGeometry = new THREE.SphereGeometry(4)const sphereMaterial = new THREE.MeshBasicMaterial( color:0xffff00)const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial)scene.add(sphere)sphere.position.set(-10,10,10) GridHelper GridHelperï¼šparam1: sizeparam2: divisionsconst gridHelper = new THREE.GridHelper(30, 30)scene.add(gridHelper) dat.guiäº¤äº’ç•Œé¢npmå®‰è£…dat.gui npm install dat.gui dat.gui import GUI from dat.guiconst options = sphereColor: 0xb16c4b, wireframe: false, speed: 0.05const gui = new GUI()gui.addColor(options, sphereColor).onChange((e) = sphere.material.color.set(e))gui.add(options, wireframe).onChange(e = sphere.material.wireframe = e)gui.add(options, speed, 0, 0.1)function animate(time) // ... sphere.position.y = 10*Math.abs(Math.sin(Math.PI*(time/100)*options.speed)) renderer.render(scene, camera) AmbientLightç¯å¢ƒå…‰DirectionalLightç›´å°„å…‰SpotLightèšå…‰ç¯Shadowé˜´å½±å°†ä¹‹å‰åˆ›å»ºçš„ç‰©ä½“æè´¨æ”¹æˆå—å…‰ç…§å½±å“çš„MeshStandardMaterial AmbientLight const ambientLight = new THREE.AmbientLight(0xffffff)scene.add(ambientLight) DirectionalLight const directionalLight = new THREE.DirectionalLight(0xffffff)scene.add(directionalLight)directionalLight.position.set(-30,30,30)const directionalLightHelper = new THREE.DirectionalLightHelper(directionalLight ,5, 0x0000ff)scene.add(directionalLightHelper)DirectionalLightçš„é˜´å½±åº•éƒ¨èŒƒå›´é»˜è®¤ä¸º5ï¼Œéœ€è¦é€šè¿‡æ”¹å˜light.shadow.camera.bottomæ¥æ§åˆ¶åº•éƒ¨èŒƒå›´directionalLight.shadow.camera.bottom = -10 Shadow è¦æŠ•å°„é˜´å½±ï¼Œé¦–å…ˆè¦å°†rendererçš„shadowMapå±æ€§æ‰“å¼€renderer.shadowMap.enabled = trueç„¶åéœ€è¦å°†å…‰æºçš„castShadowå±æ€§æ‰“å¼€ï¼Œéœ€è¦æŠ•å°„é˜´å½±ç‰©ä½“çš„castShadowè®¾ä¸ºtrueï¼Œè¢«æŠ•å°„é˜´å½±çš„é¢çš„receiveShadowè®¾ä¸ºtruedirectionalLight.castShadow = truesphere.castShadow = trueplane.receiveShadow = true SpotLight const spotLight = new THREE.SpotLight(0xffffff)scene.add(spotLight)spotLight.position.set(-30, 30, 30)spotLight.castShadow = trueconst spotLightHelper = new THREE.SpotLightHelper(spotLight)scene.add(spotLightHelper) Fogé›¾SceneBackgroundåœºæ™¯èƒŒæ™¯Textureçº¹ç†Fog æ–¹å¼1ï¼šæŒ‡å®šé›¾çš„èŒƒå›´scene.fog = new THREE.Fog(0xffffff,20, 200)æ–¹å¼2ï¼šæŒ‡å®šé›¾çš„å¯†åº¦scene.fog = new THREE.FogExp2(0xffffff,0.01) textureLoader å•ä¸ªtextureLoaderï¼šimport nebula from ../img/nebula.jpgconst textureLoader = new THREE.TextureLoader()scene.background = textureLoader.load(nebula)cubeTextureLoaderï¼šimport starts from ../img/stars.jpgimport nebula from ../img/nebula.jpgconst cubeTextureLoader = new THREE.CubeTextureLoader()scene.background = cubeTextureLoader.load([ nebula, starts, starts, nebula, nebula, starts]) Texture ç‰©ä½“æ·»åŠ çº¹ç†ï¼šimport nebula from ../img/nebula.jpgconst textureLoader = new THREE.TextureLoader()const boxGeometry2 = new THREE.BoxGeometry(3,3,3)const boxMetarial2 = new THREE.MeshBasicMaterial( map:textureLoader.load(nebula))const box2 = new THREE.Mesh(boxGeometry2, boxMetarial2)scene.add(box2)åŒä¸€ä¸ªç‰©ä½“æ·»åŠ å¤šä¸ªæè´¨ï¼šimport starts from ../img/stars.jpgimport nebula from ../img/nebula.jpgconst textureLoader = new THREE.TextureLoader()const boxGeometry2 = new THREE.BoxGeometry(3,3,3)const boxMetarial2 = [ new THREE.MeshBasicMaterial(map:textureLoader.load(nebula)), new THREE.MeshBasicMaterial(map:textureLoader.load(nebula)), new THREE.MeshBasicMaterial(map:textureLoader.load(starts)), new THREE.MeshBasicMaterial(map:textureLoader.load(nebula)), new THREE.MeshBasicMaterial(map:textureLoader.load(nebula)), new THREE.MeshBasicMaterial(map:textureLoader.load(starts)),]const box2 = new THREE.Mesh(boxGeometry2, boxMetarial2)scene.add(box2) Selecté€‰ä¸­selection é€‰ä¸­ä¸€ä¸ªç‰©ä½“ï¼Œé¦–å…ˆéœ€è¦åœ¨ç»˜åˆ¶åŒºåŸŸåˆ›å»ºä¸€ä¸ªäºŒç»´åæ ‡ç³»ï¼šlet mousePosition = new THREE.Vector2()window.onmousemove = function (e) mousePosition.x = (e.clientX / window.innerWidth * 2) - 1 mousePosition.y = 1 - (e.clientY / window.innerHeight * 2)è¿™é‡Œå®ç°é€‰ä¸­ç‰©ä½“çš„åŸç†æ˜¯ä»æ‘„åƒæœºCameraå’Œé¼ æ ‡Mouseä¹‹é—´å‘å°„å‡ºä¸€æ¡å°„çº¿ï¼Œæ‰€æœ‰è¢«å°„çº¿ç©¿é€çš„ç‰©ä½“å³è§†ä¸ºé€‰ä¸­çŠ¶æ€ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€æ¡å°„çº¿ï¼šlet rayCaster = new THREE.Raycaster()ç„¶ååœ¨loopå‡½æ•°ä¸­æŒç»­å¯¹é€‰ä¸­ç‰©ä½“è¿›è¡Œæ£€æµ‹function animate(time) // ... rayCaster.setFromCamera(mousePosition, camera) let intersects = rayCaster.intersectObjects(scene.children) for (let obj of intersects) if (obj.object.id === sphere.id) obj.object.material.color.set(0xffff00) else if (obj.object.name === box2.name) obj.object.rotation.x += 0.01 obj.object.rotation.z += 0.01 renderer.render(scene, camera) VertexPositioné¡¶ç‚¹åæ ‡ShaderMaterialæ¸²æŸ“å™¨æè´¨ModelImportæ¨¡å‹å¯¼å…¥Vertext.attribute.position é€šè¿‡ç›´æ¥ä¿®æ”¹obj.geometry.attributes.positionæ•°ç»„ä¸­æ•°å€¼è¿›è¡Œé¡¶ç‚¹ä¿®æ”¹ï¼Œæ³¨æ„ï¼šä¿®æ”¹åéœ€è¦å°†needsUpdateè®¾ç½®ä¸ºtruelet posArray = plane.geometry.attributes.position.array;for (let i = 0; i posArray.length; i++) if (i % 3 == 2) let extent = (Math.abs(i-posArray.length/2)/posArray.length)*5 posArray[i] = (2+extent)*Math.sin(Math.PI*time/1000/Math.max(extent,i/posArray.length*5)) plane.geometry.attributes.position.needsUpdate = true ShaderMaterial æ–¹å¼1ï¼šshaderç¨‹åºç”¨å­—ç¬¦ä¸²å˜é‡å¸¸é‡å®šä¹‰ï¼šconst vShader = ` void main() gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); `const fShader = ` void main() gl_FragColor = vec4( 0.7, 0.5, 1.0, 1.0); `const sphereMaterial = new THREE.ShaderMaterial( vertexShader: vShader, fragmentShader: fShader)æ–¹å¼2ï¼šshaderç¨‹åºä½¿ç”¨scriptæ ‡ç­¾å†™åœ¨htmlæ–‡ä»¶ä¸­:script id=vShader type=x-vertex void main() gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); /scriptscript id=fShader type=x-fragment void main() gl_FragColor = vec4( 0.7, 0.5, 1.0, 1.0); /scriptconst sphereMaterial = new THREE.ShaderMaterial( vertexShader: document.getElementById(vShader).textContent, fragmentShader: document.getElementById(fShader).textContent,) import model è¿™é‡Œä»¥å¯¼å…¥gltfæ ¼å¼æ¨¡å‹ä¸ºä¾‹ï¼Œå¯¹äºä¸åŒæ¨¡å‹ï¼Œthreejsæä¾›äº†ä¸åŒloaderï¼šimport GLTFLoader from three/examples/jsm/loaders/GLTFLoaderconst gltfLoader = new GLTFLoader()ç”±äºé¡¹ç›®å†…ä½¿ç”¨äº†parcelä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œå› æ­¤æ¨¡å‹æ–‡ä»¶çš„è·¯å¾„éœ€è¦åŠ¨æ€è·å–ï¼šconst monkeyUrl = new URL(../assets/monkey.glb, import.meta.url)é€šè¿‡loaderè¯»å–æ¨¡å‹æ•°æ®å¹¶ç»˜åˆ¶ï¼šgltfLoader.load(monkeyUrl.href, function (gltf) let model = gltf.scene scene.add(model) model.position.set(0, 10, 0) model.scale.set(2,2,2), undefined, function (err) console.err(err)) CanvasResponsiveå“åº”å¼ç”»å¸ƒonresize åœ¨å±å¹•å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦å¯¹ç›¸æœºcameraçš„æ¯”ä¾‹è¿›è¡Œæ›´æ–°ï¼Œrendereréœ€è¦é‡ç»˜ï¼šwindow.onresize = function () camera.aspect = window.innerWidth / window.innerHeight camera.updateProjectionMatrix() renderer.setSize(window.innerWidth,window.innerHeight)"},{"title":"Solar System æ¨¡æ‹Ÿå¤ªé˜³ç³»","path":"/wiki/ThreeJs/Wael_02_SolarSystem.html","content":"é¡¹ç›®åŠèµ„æºæ¥æº åŸé¡¹ç›®ä»“åº“ï¼šè¡Œæ˜Ÿtextureæ¥æº: JHTâ€™s PLANETARY PIXEL EMPORIUMåœŸæ˜Ÿç¯æ¥æºï¼šDEVIANT ARTå¤©ç‹æ˜Ÿç¯æ¥æºï¼šFAVPNG æ˜Ÿç©ºã€å¤ªé˜³ä¸ç‚¹å…‰æºæ˜Ÿç©ºèƒŒæ™¯ ä½¿ç”¨ä¸€å¼ æ˜Ÿç©ºèƒŒæ™¯å›¾ä¸ºå¤©ç©ºç›’çš„å…­é¢è´´å›¾const cubeTextureLoader = new THREE.CubeTextureLoader()scene.background = cubeTextureLoader.load([ stars, stars, stars, stars, stars, stars,]) å¤ªé˜³ å¤ªé˜³ä½äºæ˜Ÿç³»ä¸­å¿ƒç‚¹ä½ç½®let sunGeometry = new THREE.SphereGeometry(16, 30, 30)let sunMetarial = new THREE.MeshBasicMaterial( map:textureLoader.load(sunTexture))let sun = new THREE.Mesh(sunGeometry, sunMetarial)scene.add(sun) ç‚¹å…‰æº ä¸ºå¤ªé˜³æ·»åŠ pointLightç‚¹å…‰æºï¼Œå¯ä»¥å¯¹pointLightçš„ä¸€äº›å±æ€§è¿›è¡Œåˆå§‹åŒ–ï¼šcolor é¢œè‰²intensity å¼ºåº¦distance å»¶ä¼¸è·ç¦»const pointLight = new THREE.PointLight(0xffffff, 2, 300)sun.add(pointLight) è¡Œæ˜Ÿçš„è‡ªè½¬ä¸å…¬è½¬è¡Œæ˜Ÿ ä¸€å…±è¦åˆ›å»ºä¹ä¸ªè¡Œæ˜Ÿï¼ˆç®—ä¸Šå†¥ç‹æ˜Ÿï¼‰ï¼Œæ–¹ä¾¿èµ·è§æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªåˆ›å»ºå‡½æ•°ï¼šfunction createPlanet(radius,texture,position) const geometry = new THREE.SphereGeometry(radius,30,30) const metarial = new THREE.MeshStandardMaterial( map:textureLoader.load(texture) ) const mesh = new THREE.Mesh(geometry,metarial) mesh.position.set(position,0,0) scene.add(mesh) return meshå†ä¸ºæ¯ä¸ªè¡Œæ˜Ÿè°ƒç”¨const mercury = createPlanet(3.2, mercuryTexture,28)const venus = createPlanet(4.2, venusTexture,44)const earth = createPlanet(3, earthTexture,62)const mars = createPlanet(2.8, marsTexture,78)const jupiter = createPlanet(15, jupiterTexture,100)const saturn = createPlanet(10, saturnTexture,138)const uranus = createPlanet(7, uranusTexture,176)const neptune = createPlanet(8, neptuneTexture,200)const pluto = createPlanet(2.8, plutoTexture,216) è‡ªè½¬ä¸å…¬è½¬ å¦‚æœéœ€è¦æ‰€æœ‰è¡Œæ˜Ÿéƒ½å›´ç»•å¤ªé˜³è½¬åŠ¨ï¼Œå¯ä»¥æŠŠæ‰€æœ‰è¡Œæ˜Ÿéƒ½åŠ åœ¨å¤ªé˜³çš„å­ç±»ä¸­ï¼Œè¿™æ ·å½“å¤ªé˜³è‡ªæ—¶ï¼Œå…¶å®ƒè¡Œæ˜Ÿä¹Ÿéƒ½éšä¹‹è½¬åŠ¨ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šä¸åŒè¡Œæ˜Ÿçš„å…¬è½¬é€Ÿåº¦ä¸åŒã€‚å› æ­¤éœ€è¦ç»™æ¯ä¸ªè¡Œæ˜Ÿéƒ½é…ç½®ä¸€ä¸ªå¹½çµæ’æ˜Ÿï¼Œå‡è®¾è¿™äº›æ’æ˜Ÿå…¨éƒ½ä½äºå¤ªé˜³ä½ç½®ï¼Œä»¥ä¸åŒé€Ÿåº¦è‡ªè½¬ï¼šfunction createPlanet(radius,texture,position,ring) const obj = new THREE.Object3D() // åˆ›é€ è¡Œæ˜Ÿmesh... obj.add(mesh) scene.add(obj) return obj:obj,mesh:meshå†åœ¨animateä¸­è¿›è¡Œå…¬è½¬å’Œè‡ªè½¬çš„æ“ä½œï¼šfunction animate() sun.rotateY(0.004) // å…¬è½¬ mercury.obj.rotateY(0.004) venus.obj.rotateY(0.002) earth.obj.rotateY(0.02) mars.obj.rotateY(0.018) saturn.obj.rotateY(0.038) jupiter.obj.rotateY(0.04) uranus.obj.rotateY(0.03) neptune.obj.rotateY(0.032) pluto.obj.rotateY(0.008) // è‡ªè½¬ mercury.mesh.rotateY(0.04) venus.mesh.rotateY(0.015) earth.mesh.rotateY(0.01) mars.mesh.rotateY(0.008) saturn.mesh.rotateY(0.0009) jupiter.mesh.rotateY(0.002) uranus.mesh.rotateY(0.0004) neptune.mesh.rotateY(0.0001) pluto.mesh.rotateY(0.00007) renderer.render(scene , camera) è¡Œæ˜Ÿç¯åœŸæ˜Ÿå’Œå¤©ç‹æ˜Ÿéƒ½æœ‰æ˜Ÿç¯ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹è¡Œæ˜Ÿå·¥å‚å‡½æ•°ï¼Œç»˜åˆ¶æ˜Ÿç¯"},{"title":"å¯¼å…¥æ¨¡å‹","path":"/wiki/ThreeJs/Wael_03_blender_to_three.html","content":"æºé¡¹ç›®ä»“åº“ï¼š åŠ¨ç”»æ¨¡å‹çš„æ’­æ”¾ç‹—ç‹—æ¨¡å‹æ˜¯é¡¹ç›®åŸä½œè€…WaelYasminaåšçš„ï¼ˆkawaiiæï¼‰æ¨¡å‹å¯¼å‡ºæˆglbæ ¼å¼ä¹‹åï¼Œä¸€èˆ¬é¦–å…ˆåœ¨threejsæä¾›çš„å®˜æ–¹ç¼–è¾‘å™¨ä¸­å¯¼å…¥ï¼Œçœ‹çœ‹æ¨¡å‹ã€åŠ¨ç”»èƒ½ä¸èƒ½æ­£å¸¸æ‰§è¡Œä¸‰ä¸ªè¦ç´ THREE.AnimationMixer æ˜¯Three.jsä¸­ç”¨äºç®¡ç†å’Œæ’­æ”¾æ¨¡å‹åŠ¨ç”»é¢åº¦ç»„ä»¶THREE.AnimationClipæ¨¡å‹ä¸­åŒ…å«çš„åŠ¨ç”»ç‰‡æ®µTHREE.Clockæ—¶é—´æŒ‡æŒ¥æ£’ä¸‹é¢çš„æ­¥éª¤æ˜¯ä¸ºäº†åˆ›å»ºå¥½mixerï¼Œç±»ä¼¼äºåˆæˆä¸€æ¡è§†é¢‘è½¨é“ï¼šlet mixergltfLoader.load(doggo.href,function(gltf) const model = gltf.scene scene.add(model) mixer = new THREE.AnimationMixer(model) const clips = gltf.animations // ä¼ å…¥æ‰€æœ‰åŠ¨ç”» clips.forEach(clip= const action = mixer.clipAction(clip) action.play() ),undefined,function(err) console.error(err))ä»…ä»…æ˜¯åˆæˆå¥½è§†é¢‘è½¨é“ä¹‹åï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ—¶é—´æŒ‡ç¤ºå™¨ï¼Œç”¨äºå‘Šè¯‰mixeråŠ¨ç”»æ‰§è¡Œåˆ°å“ªé‡Œï¼Œå¹¶ä¸”éœ€è¦æ—©animateå‡½æ•°ä¸­æ›´æ–°mixerï¼šconst clock = new THREE.Clock()function animate() if(mixer) mixer.update(clock.getDelta()) renderer.render(scene , camera) å¯¼å…¥æ¨¡å‹åŠ å…¥é˜´å½±ä¸ºå¯¼å…¥çš„æ¨¡å‹æ•´ä½“åŠ ä¸ŠcastShadowå±æ€§æ— æ•ˆï¼Œå› ä¸ºå¯¼å…¥æ¨¡å‹æ˜¯ç”±å„ä¸ªéƒ¨ä½ç»„æˆçš„ï¼Œéœ€è¦éå†æ¨¡å‹æ•´ä½“ä¸‹çš„å„ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å¼€å¯castShadowã€‚éå†å­éƒ¨ä½ä½¿ç”¨çš„æ˜¯ThreeJsä¸­Groupç±»çš„traverseæ–¹æ³•ï¼Œtraverseçš„å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä½œç”¨å’Œç”¨æ³•ä¸forEachç›¸ç±»ä¼¼const gltfLoader = new GLTFLoader()gltfLoader.load(/assets/Wolf.gltf, gltf = // ... gltf.scene.traverse(node = if (node.isObject3D) node.castShadow = true )) åŠ¨ç”»æ‹¼æ¥å¦‚æœåŒæ—¶å¼€å¯å¤šä¸ªclipActionï¼Œå¤šä¸ªåŠ¨ç”»ä¹‹é—´çš„å…³ç³»ä¸ä¼šæ˜¯è¿ç»­ä¸²è¡Œï¼Œè€Œæ˜¯å¹¶è¡Œï¼Œæƒ³è¦å®ç°ä¸²è¡ŒåŠ¨ç”»ï¼Œé¦–å…ˆéœ€è¦å…³é—­åŠ¨ç”»çš„æ— é™å¾ªç¯é€‰é¡¹ï¼ˆåŠ¨ç”»é»˜è®¤æ˜¯loopï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥è§¦å‘mixerçš„finishedäº‹ä»¶ã€‚finishäº‹ä»¶ä¼šåœ¨åŠ¨ç”»å…¨éƒ¨ç»“æŸåè§¦å‘ï¼Œåªè¦åœ¨finishingäº‹ä»¶ä¸­ï¼Œresetåˆå§‹åŒ–å¹¶palyæ’­æ”¾å¦ä¸€ä¸ªåŠ¨ç”»ï¼šlet mixerconst gltfLoader = new GLTFLoader()gltfLoader.load(/assets/Alpaca.gltf, gltf = scene.add(gltf.scene) mixer = new THREE.AnimationMixer(gltf.scene) const action_eat = mixer.clipAction(THREE.AnimationClip.findByName(gltf.animations, Eating)) action_eat.loop = THREE.LoopOnce action_eat.play() const action_walk = mixer.clipAction(THREE.AnimationClip.findByName(gltf.animations, Idle)) action_walk.loop = THREE.LoopOnce // action_walk.play() mixer.addEventListener(finished, function (e) if (e.action._clip.name === Eating) action_walk.reset() action_walk.play() else if (e.action._clip.name === Walk) action_eat.reset() action_eat.play() ))"},{"title":"Shader Tutorial ç€è‰²å™¨","path":"/wiki/ThreeJs/Wael_04_shader_tutorial.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=xZM8UJqN1eY&t=907s ç¨ç¨ä¿®shaderç»˜åˆ¶çš„é¡¶ç‚¹åæ ‡ä¸€ä¸ª10*10çš„ç½‘æ ¼å¹³é¢ï¼Œæ­£å¸¸ç»˜åˆ¶æ—¶ï¼Œå…¶VertexShaderå¦‚ä¸‹ï¼švoid main() gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);ä½†æ˜¯å¦‚æœç¨ç¨åšä¸€äº›ä¿®æ”¹ï¼Œå°†ä½¿ç”¨ä¸‰è§’å‡½æ•°å¯¹positionè¿›è¡Œå˜æ¢ï¼šsinå˜æ¢void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(sin(position), 1.0);coså˜æ¢void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(cos(position), 1.0);tanå˜æ¢void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(tan(position), 1.0); ä¼ å…¥uniformå˜é‡vertex shaderä¸­ä½¿ç”¨uniformå˜é‡ shaderå­˜åœ¨ä¸¤ç§å¯ä»¥ä»jsä¼ å…¥çš„å˜é‡ç±»å‹ï¼Œä¸€ç§æ˜¯attributeï¼Œå¦ä¸€ç§æ˜¯uniformï¼Œattributeé’ˆå¯¹ä¸åŒé¡¶ç‚¹æä¾›ä¸åŒçš„å€¼ï¼Œuniformç±»å‹çš„å˜é‡èƒ½å¤Ÿä½œç”¨äºæ¯ä¸€ä¸ªé¡¶ç‚¹ï¼Œä½¿ç”¨threejsä¼ å…¥uniformç±»å‹çš„å˜é‡çš„ä½ç½®ï¼Œå’Œä¼ å…¥shaderç¨‹åºçš„ä½ç½®ç›¸åŒï¼Œä¹Ÿæ˜¯åœ¨å®šä¹‰Shaderæè´¨çš„æ—¶å€™ä½œä¸ºå±æ€§ä¼ å…¥ï¼šconst uniforms = u_time:type:f,value:0const material = new THREE.ShaderMaterial( vertexShader:document.getElementById(vertex-shader).textContent, fragmentShader:document.getElementById(fragment-shader).textContent, wireframe:true, uniforms // ä¼ å…¥shader);åŠ¨ç”»çš„å…³é”®å±æ€§å°±æ˜¯æ—¶é—´ï¼Œå› æ­¤è¿˜éœ€è¦è€ƒè™‘å±æ€§éšæ—¶é—´çš„å˜åŒ–ï¼Œå¯ä»¥åœ¨animateå‡½æ•°ä¸­å¯¹å±æ€§è¿›è¡Œä¿®æ”¹ï¼šfunction animate() uniforms.u_time.value = clock.getElapsedTime() //... renderer.render(scene, camera)ä»¥ä¸Šæ˜¯åœ¨jsä¸­çš„é…ç½®ï¼Œç€è‰²å™¨ç¨‹åºä¸­ä¹Ÿéœ€è¦å®šä¹‰éœ€è¦æ¥æ”¶çš„uniformå˜é‡ï¼šscript id=vertex-shader type=x-vertex uniform float u_time; void main() float newX = sin(position.x * u_time) * sin(position.y * u_time); vec3 newPosition = vec3(newX, position.y, position.z); gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0); /scriptshaderä¸­å‚ä¸è®¡ç®—çš„æ•°æ®é™„ç€ä¸Šæ—¶é—´å±æ€§åï¼Œæ„æˆäº†åŠ¨ç”»ï¼š fragment shaderä¸­ä½¿ç”¨uniformå˜é‡ è¦å®ç°ç‰‡å…ƒé¢œè‰²æ²¿xè½´æ˜¾ç°å‡ºæ¸å˜è‰²ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“è¯¥ç‰‡å…ƒçš„xè½´åæ ‡ï¼Œè¿™ä¸ªå€¼åœ¨FragmentShaderä¸­æ˜¯æä¾›çš„ï¼šgl_FragCoord.xï¼Œè¿™æ˜¯è¿™ä¸ªç‰‡å…ƒçš„ç»å¯¹ä½ç½®ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦çŸ¥é“è¿™ä¸ªxå€¼ç›¸å¯¹æ•´ä¸ªç”»å¸ƒçš„ä½ç½®ï¼Œå› ä¸ºåªæœ‰è¿™æ ·æ‰èƒ½æŠŠxå€¼å½’ä¸€åŒ–åˆ°-1å’Œ1ä¹‹é—´ï¼Œå› æ­¤ç”»å¸ƒå¤§å°è¿™ä¸ªå˜é‡å°±éœ€è¦ä»jsä¸­ä¼ å…¥ï¼šconst uniforms = // ... u_resolution : type:v2, // vec2 ç±»å‹ // æŒ‰ç…§è®¾å¤‡åƒç´ æ¯”ä¾‹è®¡ç®—å°ºå¯¸ value: new THREE.Vector2(window.innerWidth,window.innerHeight) .multiplyScalar(window.devicePixelRatio) åœ¨fragment shaderä¸­æ¥æ”¶ç”»å¸ƒåˆ†è¾¨ç‡ä¹‹åï¼Œè®¡ç®—å‡ºç‰‡å…ƒçš„ç›¸å¯¹ä½ç½®ï¼Œå†æ ¹æ®è¿™ä¸ªç›¸å¯¹ä½ç½®è®¾ç½®ç‰‡å…ƒé¢œè‰²ï¼šscript id=fragment-shader type=x-fragment uniform vec2 u_resolution; void main() vec2 st = gl_FragCoord.xy / u_resolution; gl_FragColor = vec4(0.0,st.x, 0.0, 1.0); /scriptæœ€ç»ˆç»˜åˆ¶çš„ç»“æœå‘ˆç°æ¸å˜æ•ˆæœï¼š é¼ æ ‡æ§åˆ¶é¢œè‰²å˜åŒ– é¼ æ ‡åæ ‡éœ€è¦ä»jsä¸­ä¼ å…¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é¼ æ ‡ä¾èµ–çš„æ˜¯æµè§ˆå™¨åæ ‡ç³»ï¼Œä»å·¦ä¸Šè§’å¼€å§‹åˆ°å³ä¸‹è§’ï¼Œå…¶yè½´æ–¹å‘ä¸webglä¸­çš„yè½´æ–¹å‘ç›¸åå› æ­¤ä¸€æ–¹é¢éœ€è¦å¯¹é¼ æ ‡åæ ‡è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå¦ä¸€æ–¹é¢éœ€è¦å¯¹yè½´åå‘const uniforms = // ... u_mouse: type:v2, value:new THREE.Vector2(0,0) window.onmousemove= e= uniforms.u_mouse.value.set( e.offsetX/window.innerWidth, 1-e.offsetY/window.innerHeight )uniform vec2 u_mouse;uniform vec2 u_resolution;void main() vec2 st = gl_FragCoord.xy / u_resolution; gl_FragColor = vec4(st.x, u_mouse, 1.0); shaderç»˜åˆ¶çº¹ç†çº¹ç†çš„ä¼ å…¥ä½¿ç”¨çš„ä¹Ÿæ˜¯uniformç±»å‹å˜é‡ï¼Œçº¹ç†ç±»å‹éœ€è¦é™åˆ¶ä¸ºsampler2Då–æ ·å™¨ç±»å‹ï¼Œglesä¸­çš„å–æ ·æ–¹æ³•ä¸ºtexture2Dè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šsampler2Dç±»å‹çš„å›¾ç‰‡å–æ ·å™¨vec2ç±»å‹çš„å›¾ç‰‡åæ ‡åœ¨Vertex Shaderä¸­ï¼ŒThreeJsæä¾›äº†uvå˜é‡ä½œä¸ºå½“å‰è¢«æ¸²æŸ“ç‰©ä½“çš„çº¹ç†åæ ‡å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ç¬¬ä¸€æ­¥ï¼šå°†çº¹ç†å›¾ç‰‡ä½œä¸ºuniformå˜é‡ä¼ å…¥import nebula from ../img/nebula.jpg;const uniforms = //... image : type:t, value:textLoader.load(nebula) ç¬¬äºŒæ­¥ï¼šå°†uvçº¹ç†åæ ‡ä½¿ç”¨varingå˜é‡ä»vertex shaderä¼ å…¥fragment shaderä¸­varying vec2 v_uv;void main() v_uv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0);ç¬¬ä¸‰æ­¥ï¼š åœ¨fragment shaderä¸­è¯»å…¥ä¼ å…¥çš„çº¹ç†å›¾ç‰‡ï¼Œç„¶åç»˜åˆ¶uniform vec2 u_resolution;uniform vec2 u_mouse;uniform float u_time;uniform sampler2D image;varying vec2 v_uv;void main() vec2 st = gl_FragCoord.xy / u_resolution; vec4 texture = texture2D(image, v_uv); gl_FragColor = vec4(vec3(texture),1.0); GLSL Snacksè§†å£å¤§å°å˜åŒ–å¯¼è‡´å…‰æ ‡åç§»ä½¿ç”¨ShaderMaterialåˆ›å»ºä¸€ä¸ªæè´¨ï¼Œè¦æ±‚æè´¨çš„é¢œè‰²ä»¥ è·ç¦»é¼ æ ‡çš„ä½ç½® ä¸ºæ ‡å‡†å˜åŒ–ï¼Œv-shaderscript type=x-vertex id=v-shader void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptf-shaderscript type=x-fragment id=f-shader uniform vec2 u_resolution; uniform vec2 u_mouse; void main() vec2 st = gl_FragCoord.xy/u_resolution; float c = 1.0 - distance(st, u_mouse); float color = pow(c, 10.0); gl_FragColor = vec4(vec3(color), 1.0); /scriptéœ€è¦å‘Fragment Shaderä¸­ä¼ å…¥ä¸¤ä¸ªvec2ç±»å‹çš„uniformå˜é‡ï¼šu_resolution åˆ†è¾¨ç‡u_mouse é¼ æ ‡åæ ‡const uniforms = u_resolution: type: v2, value:new THREE.Vector2(window.innerWidth, window.innerHeight) , u_mouse: type: v2, value:new THREE.Vector2() window.onmousemove = e = uniforms.u_mouse.value.x = e.offsetX / window.innerWidth; uniforms.u_mouse.value.y = 1 - e.offsetY / window.innerHeight;const planeGeo = new THREE.PlaneGeometry(4, 4)const planeMat = new THREE.ShaderMaterial( uniforms, vertexShader: document.getElementById(v-shader).textContent, fragmentShader: document.getElementById(f-shader).textContent)const planeMesh = new THREE.Mesh(planeGeo, planeMat)scene.add(planeMesh)å®ç°æ•ˆæœä½†æ˜¯åœ¨å±å¹•å°ºå¯¸æ”¹å˜æ—¶ï¼Œä¼šå‘ç°å¯¹é¼ æ ‡ä½ç½®çš„è®¡ç®—å‡ºç°åå·®ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨resizeå‡½æ•°ä¸­æ›´æ–°åˆ†è¾¨ç‡å˜é‡u_resolutionçš„å€¼ï¼šwindow.addEventListener(resize, function() // ... uniforms.u_resolution.value.x = window.innerWidth; uniforms.u_resolution.value.y = window.innerHeight; // ...); çº¹ç†é•‚ç©ºæ•ˆæœè¿™é‡Œçš„çº¹ç†é•‚ç©ºæŒ‡çš„æ˜¯å¯¹çº¹ç†è¿›è¡ŒåŠ¨æ€æ˜ å°„ï¼Œæ ¹æ® ç‰‡å…ƒåæ ‡ç›¸å¯¹è§†å£ä½ç½® æ¥è·å– çº¹ç†çš„æ˜ å°„èŒƒå›´ï¼Œvertex shaderscript type=x-vertex id=v-shader void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptfragment shaderscript type=x-fragment id=f-shader uniform vec2 u_resolution; uniform sampler2D image; void main() vec2 st = gl_FragCoord.xy / u_resolution; vec4 texture = texture2D(image, st); gl_FragColor = vec4(vec3(texture), 1.0); /scriptä½¿ç”¨ShaderMaterialä¼ å…¥uniformå˜é‡ï¼šconst uniforms = u_resolution: type:v2, value:new THREE.Vector2(window.innerWidth, window.innerHeight) , image: type:t, value:new THREE.TextureLoader().load(./assets/ice.png) å®ç°é•‚ç©ºæ•ˆæœï¼š å°† çº¹ç†é•‚ç©º æ•ˆæœè½¬æ¢ä¸º çº¹ç†æ˜ å°„ æ•ˆæœï¼Œåªéœ€è¦å¯¹ texture2D é‡‡æ ·ä½¿ç”¨çš„åæ ‡è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œä¼ å…¥çš„uVu(uv)å‚æ•°ï¼Œé€šå¸¸ä»£è¡¨çš„æ˜¯ å½“å‰é¡¶ç‚¹çš„çº¹ç†åæ ‡ ï¼š script type=x-vertex id=v-shader varying vec2 uVu; void main() uVu = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptscript type=x-fragment id=f-shader varying vec2 uVu; uniform vec2 u_resolution; uniform sampler2D image; void main() vec2 st = gl_FragCoord.xy / u_resolution; vec4 texture = texture2D(image, uVu); gl_FragColor = vec4(vec3(texture), 1.0); /script çº¹ç†åŠ¨ç”»æ•ˆæœåŠ¨ç”»çš„å®ç°éœ€è¦å¼•å…¥ä¸€ä¸ªé‡è¦çš„å˜é‡ï¼šæ—¶é—´æ­¥éª¤1ï¼šå®ç°åŠé€æ˜è’™ç‰ˆæ•ˆæœé¦–å…ˆæœ‰ä¸€å¼ æ¸å˜ç°åº¦å›¾ï¼šå°†è¿™å¼ æ¸å˜ç°åº¦å›¾æ˜ å°„åˆ°ç›®æ ‡ç‰©ä½“è¡¨é¢ï¼Œä¸ºäº†å®ç°åŠé€æ˜çš„æ•ˆæœ:å°†çº¹ç†çš„ré€šé“æ˜ å°„åˆ°alphaé€šé“ä¸­å¼€å¯çº¹ç†æè´¨çš„transparentå±æ€§script type=x-fragment id=f-shader uniform sampler2D image; varying vec2 vUv; void main() vec4 textureColor = texture2D(image, vUv); gl_FragColor = vec4(vec3(0.3, 0.2, 0.6), textureColor.r); script/è¿™æ ·èƒ½å¤Ÿå®ç°åŠé€æ˜çš„æ¸å˜æ•ˆæœï¼šæ­¥éª¤2ï¼šå®ç°çº¹ç†æ—‹è½¬æ•ˆæœè¦åšå‡ºæ—‹è½¬çš„æ•ˆæœï¼šä¼ å…¥u_timeæ—¶é—´å‚æ•°åœ¨çº¹ç†æ˜ å°„çš„æ—¶å€™ï¼Œå¯¹uvåæ ‡è¿›è¡Œæ—‹è½¬å¤„ç†script type=x-fragment id=f-shader uniform float u_time; uniform sampler2D image; varying vec2 vUv; vec2 rotate(vec2 uv, float rotation) return vec2( cos(rotation) * uv.x + sin(rotation) * uv.y, cos(rotation) * uv.y - sin(rotation) * uv.x ); void main() vec2 vUv = vUv; vUv -= vec2(0.5); // å›¾åƒä¸­å¿ƒç§»åŠ¨åˆ°å·¦ä¸Šè§’ï¼ˆæ—‹è½¬ä¸­å¿ƒï¼‰ vec2 vUv_rotate = rotate(vUv, u_time); vUv_rotate += vec2(0.5); // å°†å›¾åƒä¸­å¿ƒç§»å› vec4 textureColor = texture2D(image, vUv_rotate); gl_FragColor = vec4(vec3(0.3, 0.2, 0.6), textureColor.r); /scriptu_timeçš„åˆ·æ–°ï¼šfunction animate(time) uniforms.u_time.value = time.toFixed(2)/1000 renderer.render(scene, camera);æ­¥éª¤3ï¼šå®ç°çº¹ç†å åŠ æ•ˆæœå°†gl_FragColorçš„rgbé€šé“ï¼Œæ¢æˆéœ€è¦æ˜ å°„çš„çº¹ç†å³å¯ï¼šscript type=x-fragment id=f-shader uniform float u_time; uniform sampler2D image; uniform sampler2D golconda; varying vec2 vUv; vec2 rotate(vec2 uv, float rotation) // ... void main() vec2 vUv2 = vUv; // ä¿å­˜åŸå§‹çº¹ç†åæ ‡ vec2 vUv = vUv; vUv -= vec2(0.5); vec2 vUv_rotate = rotate(vUv, u_time); vUv_rotate += vec2(0.5); vec4 textureColor = texture2D(image, vUv_rotate); vec4 imageTexture = texture2D(golconda, vUv2); gl_FragColor = vec4(vec3(imageTexture), textureColor.r); /script è¿‡æ»¤æ•ˆæœä¸¤å¼ çº¹ç†ä¹‹é—´çš„è¿‡æ¸¡ï¼Œå¦‚æœä¸å¼•å…¥ä»»ä½•æ•ˆæœï¼Œåªéœ€è¦ä½¿ç”¨ mix å‡½æ•°å°±èƒ½å®ç°ã€‚gl_FragColor = mix(i1Texel, i2Texel, mixRatio);æƒ³è¦å®ç°å…¶ä»–è¿‡æ¸¡æ•ˆæœï¼Œéœ€è¦å¼•å…¥ä¸€å¼ çº¹ç†æè´¨å›¾ç‰‡ï¼šä½¿ç”¨ clump å‡½æ•°å°†çº¹ç†å›¾ç‰‡æ˜ å°„åˆ° mixer å¤„ç†è¿‡çš„å›¾ç‰‡çš„alphaé€šé“ä¸Š:vec4 transitionTexel = texture2D(transition, vUv); // çº¹ç†vec4 i1Texel = texture2D(image, vUv); vec4 i2Texel = texture2D(image2, vUv);// mixRatio ä»£è¡¨æ··åˆç¨‹åº¦float r = mixRatio * 1.6 - 0.3; // [-0.3, 1.3]float mixF = clamp((transitionTexel.r - r) * 3.33, 0.0, 1.0); gl_FragColor = mix(i1Texel, i2Texel, mixF);éœ€è¦ä¼ å…¥çš„uniformæœ‰è¿™äº›ï¼šscript type=x-fragment id=f-shader uniform sampler2D image; uniform sampler2D image2; uniform sampler2D transition; uniform float mixRatio; varying vec2 vUv; void main() vec4 transitionTexel = texture2D(transition, vUv); vec4 i1Texel = texture2D(image, vUv); vec4 i2Texel = texture2D(image2, vUv); float r = mixRatio * 1.6 - 0.3; float mixF = clamp((transitionTexel.r - r) * 3.33, 0.0, 1.0); gl_FragColor = mix(i1Texel, i2Texel, mixF); /script Perlin Noise å™ªç‚¹åŠ¨ç”»è®²åˆ°è¿™é‡Œï¼Œ Wael Yasmina åˆç”©å‡ºæ¥ä¸€ä¸ªå¾ˆå¼ºçš„ç½‘ç«™ï¼šClick to releasehttps://www.clicktorelease.com/blog/vertex-displacement-noise-3d-webgl-glsl-three-js/æ˜¯ä¸€ä½å¤§ä½¬çš„æŠ€æœ¯åˆ†äº«ç½‘ç«™å™ªç‚¹ï¼Œéœ€è¦åœ¨åŸç‰©ä½“é¡¶ç‚¹åæ ‡çš„åŸºç¡€ä¸Šè¿›è¡Œåç§»ï¼Œèƒ½å¤Ÿå®ç°å…‰æ»‘ç‰©ä½“è¡¨é¢ç²—ç³™ä¸å¹³çš„æ•ˆæœï¼Œå¦‚æœè¿™ç§åç§»æ˜¯éœ‡è¡è¿ç»­çš„ï¼Œå°±èƒ½å¤Ÿå®ç°æ³¢æµªå½¢çš„åŠ¨ç”»æ•ˆæœã€‚å™ªç‚¹çš„å®ç°éœ€è¦å€ŸåŠ© Parcel Noiseï¼šAshimaå†™å¥½çš„webglå™ªç‚¹ç¨‹åºå‡†å¤‡å¥½åŸºç¡€çƒä½“ï¼Œç„¶åå°±å¼€å§‹â€¦..å¤åˆ¶ç²˜è´´ï¼Œwebgl-noisesrcä¸‹æä¾›äº†å„ç§å™ªç‚¹ç¨‹åºï¼Œå¤åˆ¶ç²˜è´´éœ€è¦çš„åˆ°vertex shaderä¸­ï¼Œè¿™é‡Œä»¥ classicnoise3D ä¸ºä¾‹ï¼Œé‡Œé¢æä¾›äº†ä¸¤ç§å™ªç‚¹ç¨‹åºï¼šcnoisepnoiseé€‰ç”¨pnoiseå™ªç‚¹ç¨‹åºï¼Œæœ€åçš„vertex shaderå¦‚ä¸‹æ‰€ç¤ºï¼šscript type=x-vertex id=v-shader uniform float u_time; // è¾…åŠ©å‡½æ•° vec3 mod289(vec3 x) return x - floor(x * (1.0 / 289.0)) * 289.0; vec4 mod289(vec4 x) return x - floor(x * (1.0 / 289.0)) * 289.0; vec4 permute(vec4 x) return mod289(((x*34.0)+10.0)*x); vec4 taylorInvSqrt(vec4 r) return 1.79284291400159 - 0.85373472095314 * r; vec3 fade(vec3 t) return t*t*t*(t*(t*6.0-15.0)+10.0); // Classic Perlin noise, periodic variant float pnoise(vec3 P, vec3 rep) vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period Pi0 = mod289(Pi0); Pi1 = mod289(Pi1); vec3 Pf0 = fract(P); // Fractional part for interpolation vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0 vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x); vec4 iy = vec4(Pi0.yy, Pi1.yy); vec4 iz0 = Pi0.zzzz; vec4 iz1 = Pi1.zzzz; vec4 ixy = permute(permute(ix) + iy); vec4 ixy0 = permute(ixy + iz0); vec4 ixy1 = permute(ixy + iz1); vec4 gx0 = ixy0 * (1.0 / 7.0); vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5; gx0 = fract(gx0); vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0); vec4 sz0 = step(gz0, vec4(0.0)); gx0 -= sz0 * (step(0.0, gx0) - 0.5); gy0 -= sz0 * (step(0.0, gy0) - 0.5); vec4 gx1 = ixy1 * (1.0 / 7.0); vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5; gx1 = fract(gx1); vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1); vec4 sz1 = step(gz1, vec4(0.0)); gx1 -= sz1 * (step(0.0, gx1) - 0.5); gy1 -= sz1 * (step(0.0, gy1) - 0.5); vec3 g000 = vec3(gx0.x,gy0.x,gz0.x); vec3 g100 = vec3(gx0.y,gy0.y,gz0.y); vec3 g010 = vec3(gx0.z,gy0.z,gz0.z); vec3 g110 = vec3(gx0.w,gy0.w,gz0.w); vec3 g001 = vec3(gx1.x,gy1.x,gz1.x); vec3 g101 = vec3(gx1.y,gy1.y,gz1.y); vec3 g011 = vec3(gx1.z,gy1.z,gz1.z); vec3 g111 = vec3(gx1.w,gy1.w,gz1.w); vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110))); g000 *= norm0.x; g010 *= norm0.y; g100 *= norm0.z; g110 *= norm0.w; vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111))); g001 *= norm1.x; g011 *= norm1.y; g101 *= norm1.z; g111 *= norm1.w; float n000 = dot(g000, Pf0); float n100 = dot(g100, vec3(Pf1.x, Pf0.yz)); float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z)); float n110 = dot(g110, vec3(Pf1.xy, Pf0.z)); float n001 = dot(g001, vec3(Pf0.xy, Pf1.z)); float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z)); float n011 = dot(g011, vec3(Pf0.x, Pf1.yz)); float n111 = dot(g111, Pf1); vec3 fade_xyz = fade(Pf0); vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z); vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y); float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); return 2.2 * n_xyz; // ä¸»ä½“ void main() float noise = 5.0 * pnoise(position + u_time, vec3(10.0)); float displacement = noise / 10.0; vec3 newPosition = position + normal * displacement; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); /scriptfragment shaderå¦‚ä¸‹ï¼šscript type=x-fragment id=f-shader uniform vec2 u_resolution; void main() vec2 st = gl_FragCoord.xy / u_resolution; gl_FragColor = vec4(vec3(st.x, st.y, 1.0),1.0); /scriptclassicnoise3D/perlin_noiseclassicnoise3D/classic_noise Audio Visualize Animation éŸ³é¢‘å¯è§†åŒ–éŸ³é¢‘å¯è§†åŒ–åœ¨threejsä¸­å¹¶ä¸éš¾å®ç°ï¼Œå…³é”®æ˜¯ï¼š éŸ³é¢‘å€¼åŠ å…¥å™ªç‚¹çš„è®¡ç®—æ­¥éª¤1ï¼šåˆ›å»ºç½‘æ ¼ç‰©ä½“const uniforms = u_time: type: f, value: 0.0 const mat = new THREE.ShaderMaterial( uniforms, wireframe:true, vertexShader: document.getElementById(v-shader).textContent, fragmentShader:document.getElementById(f-shader).textContent)const geo = new THREE.IcosahedronGeometry(4, 20)const mesh = new THREE.Mesh(geo, mat)scene.add(mesh)script type=x-vertex id=v-shader uniform float u_time; void main() gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptscript type=x-fragment id=f-shader void main() gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0); /scriptæ­¥éª¤2ï¼šåŠ å…¥å™ªç‚¹script type=x-vertex id=v-shader // å™ªç‚¹éƒ¨åˆ†çœç•¥ uniform float u_time; void main() float noise = 5.0 * pnoise( position + u_time, vec3(10.0)); float displacement = noise / 10.0; vec3 newPosition = position + displacement; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); /scriptæ­¥éª¤3ï¼šåŠ å…¥éŸ³é¢‘å®˜æ–¹æ–‡æ¡£-éŸ³é¢‘https://threejs.org/docs/index.html?q=AudioLi#api/en/audio/AudioListeneréŸ³é¢‘ä½œä¸ºä¸€ä¸ªå®ä½“ï¼Œå…·æœ‰åæ ‡å±æ€§ï¼Œè¿™é‡Œå¯ä»¥å°†éŸ³é¢‘åŠ å…¥cameraä¸­// åˆ›å»ºä¸€ä¸ªAudioListenerï¼Œæ”¾å…¥cameraconst listener = new THREE.AudioListener();camera.add(listener)// åˆ›å»ºä¸€ä¸ªå…¨å±€éŸ³é¢‘èµ„æºconst sound = new THREE.Audio(listener)// AudioLoaderåŠ è½½éŸ³é¢‘ï¼Œ è®¾ç½®è¿›Audioçš„bufferä¸­const audioLoader = new THREE.AudioLoader();audioLoader.load(./assets/audio/ili.mp3, function (buffer) sound.setBuffer(buffer); sound.loop = true sound.play())å‡†å¤‡å¥½éŸ³ä¹ï¼Œéœ€è¦åˆ›å»ºAudioAnalyserå¯¹éŸ³é¢‘è¿›è¡Œè§£æconst analyser = new THREE.AudioAnalyser(sound, 32)åœ¨animationä¸­æå–å‡ºæ¯ä¸€å¸§çš„å¹³å‡é¢‘ç‡ï¼Œä½œä¸ºå˜é‡ä¼ å…¥vertex shaderï¼šconst uniforms = // .... u_frequency: type: f, value: 0.0 function animate() // ... uniforms.u_frequency.value = analyser.getAverageFrequency()åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼ŒåŠ å…¥u_frequencyè®¡ç®—é¡¶ç‚¹åç§»é‡script type=x-vertex id=v-shader // ... uniform float u_frequency; void main() float noise = 5.0 * pnoise(position + u_time, vec3(10.0)); // åŠ å…¥u_frequencyè®¡ç®— float displacement = (u_frequency / 30.0) * (noise / 10.0); vec3 newPosition = position + normal * displacement; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); /scriptæ­¤å¤„æ— å£°èƒœæœ‰å£°ï¼Œæ²¡æœ‰å£°éŸ³å‡‘åˆå¬æ­¥éª¤4ï¼šguiæ”¹å˜é¢œè‰²å¼•å…¥guiï¼Œå°†rã€gã€bä¸‰ä¸ªé€šé“çš„é¢œè‰²ä½œä¸ºfloatç±»å‹å˜é‡ä¼ å…¥ã€‚const uniforms = // ... u_red: type:f, value:1.0, u_green: type:f, value:1.0, u_blue: type:f, value:1.0,const gui = new GUI()const colorFolder = gui.addFolder(color)colorFolder.add(uniforms.u_red, value).min(0).max(1).name(red)colorFolder.add(uniforms.u_green, value).min(0).max(1).name(green)colorFolder.add(uniforms.u_blue, value).min(0).max(1).name(blue)script type=x-fragment id=f-shader uniform float u_red; uniform float u_green; uniform float u_blue; void main() gl_FragColor = vec4(u_red, u_green, u_blue, 1.0); /scriptæ­¥éª¤5ï¼šåŠ å…¥unrealBloomç‰¹æ•ˆimport RenderPass from three/examples/jsm/postprocessing/renderpass;import EffectComposer from three/examples/jsm/postprocessing/effectcomposer;import UnrealBloomPass from three/examples/jsm/postprocessing/unrealbloompass;import OutputPass from three/examples/jsm/postprocessing/outputpass;// ...const renderScene = new RenderPass(scene, camera)const effectComposer = new EffectComposer(renderer)const unrealBloomPass = new UnrealBloomPass( new THREE.Vector2(window.innerWidth, window.innerHeight), 0.5, 0.2, 0.5)effectComposer.addPass(renderScene)effectComposer.addPass(unrealBloomPass)const outputPass = new OutputPass()effectComposer.addPass(outputPass)const unrealBloomFolder = gui.addFolder(unreal bloom)unrealBloomFolder.add(unrealBloomPass,strength,0,3)unrealBloomFolder.add(unrealBloomPass,radius,0,3)unrealBloomFolder.add(unrealBloomPass,threshold,0,1)unrealBloomFolder.add(renderer,toneMappingExposure,0,3)//...function animation() //... effectComposer.render()æ˜¯ç‰¹æ•ˆï¼æˆ‘åŠ äº†ç‰¹æ•ˆï¼ å—å…‰ç…§å½±å“çš„ShaderMaterialæƒ³è®©è‡ªå®šä¹‰çš„ShaderMaterialå—å…‰ç…§å½±å“ï¼Œæœ‰2ç§æ–¹å¼ï¼šåœ¨shaderç¨‹åºä¸­ç»è¿‡è®¡ç®—å®ç°å…‰ç…§æ•ˆæœé‡å†™å…¶å®ƒå—å…‰ç…§å½±å“çš„æè´¨çš„éƒ¨åˆ†shaderå·²ç»æœ‰å®ç°ç¬¬äºŒç§æ–¹å¼çš„åº“ï¼š å¼•å…¥customShaderMaterialnpmå®‰è£…ï¼šnpm install three-custom-shader-materialimport CustomShaderMaterial from three-custom-shader-material/vanillaconst custom_mat = new CustomShaderMaterial( baseMaterial: THREE.MeshPhysicalMaterial, // éœ€è¦ä¿®æ”¹çš„æè´¨ metalness: 0.6, roughness:0.3, uniforms, vertexShader: document.getElementById(v-shader).textContent, fragmentShader: document.getElementById(f-shader).textContent)CustomShaderMaterialä¸­ä½¿ç”¨shaderï¼Œä¸èƒ½ä»…ä»…ç»™åŸæœ¬GLSLè¾“å‡ºå˜é‡è¿›è¡Œä¿®æ”¹ï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€äº›ä»¥csmï¼ˆcustom shader materialï¼‰å¼€å¤´çš„è¾“å‡ºå˜é‡ï¼Œæ¯”å¦‚ï¼šgl_Position â†’ csm_Positiongl_FragColor â†’ csm_FragColorå¼•å…¥vertexfragment shaderconst mat = new THREE.ShaderMaterial( uniforms, vertexShader: document.getElementById(v-shader).textContent, fragmentShader: document.getElementById(f-shader).textContent)const custom_mat = new CustomShaderMaterial( baseMaterial: THREE.MeshPhysicalMaterial, metalness: 0.6, roughness:0.3, uniforms, vertexShader: document.getElementById(v-shader).textContent, fragmentShader: document.getElementById(f-shader).textContent)script type=x-vertex id=v-shader uniform float u_time; void main() vec3 newPosition = position * sin(u_time); // csm_Position å¿…é¡»ä¿®æ”¹ csm_Position = newPosition; glayerl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); /scriptscript type=x-fragment id=f-shader uniform vec2 u_resolution; void main() vec2 st = gl_FragCoord.xy / u_resolution; // csm_DiffuseColor è¡¨ç¤ºæè´¨çš„åŸå§‹é¢œè‰² csm_DiffuseColor = vec4(st.x / 0.6, st.y / 1.8, (st.x + st.y)/ 1.2, 1.0); /script"},{"title":"Cannon Tutorial ç‰©ç†å¼•æ“","path":"/wiki/ThreeJs/Wael_05_cannon_tutorial.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=xZM8UJqN1eY&t=907s cannon.jså¼•å…¥cannon dochttps://schteppe.github.io/cannon.js/ npm install cannon-es æ¨¡å—å¼•å…¥ï¼š import * as CANNON from cannon-es Worldå®¹å™¨ä¸Bodyå®ä½“CANNON.World cannon.jså¿…é¡»è¦åˆ›å»ºä¸€ä¸ªWorldå®ä¾‹ï¼Œç›¸å½“äºThreeJsä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªSceneå®ä¾‹ä¸€æ ·ï¼ŒWorldå®ä¾‹ç”¨äºç®¡ç†æ‰€æœ‰ç‰©ä½“ã€çº¦æŸã€ç¢°æ’ç­‰ç‰©ç†å…ƒç´ const world = new CANNON.World( // é‡åŠ› gravity:new CANNON.Vec3(0,-9.89,0)) CANNON.Body CANNON.Bodyè¡¨ç¤ºæŸä¸ªç‰©ä½“æ‰€å¯¹åº”çš„ç‰©ç†å±æ€§ï¼ŒCANNON.Bodyå’ŒThree.Meshç»„åˆåœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªå…·æœ‰ç‰©ç†å±æ€§çš„ç‰©ä½“CANNON é‡Œ Mesh è¡¨const planeBody = new CANNON.Body( mass: 1, shape:new CANNON.Plane())world.addBody(planeBody)å°†Bodyæ·»åŠ åˆ°worldä¸­ä¹‹åï¼Œéœ€è¦æ ¹æ®bodyæ¯å¸§è®¡ç®—çš„å€¼æ›´æ–°å¯¹åº”meshçš„å±æ€§å€¼ï¼šconst stepTime = 1/60function animate() world.step(stepTime) // æ¨è¿›wolrd planeMesh.position.copy(planeBody.position) planeMesh.quaternion.copy(planeBody.quaternion) renderer.render(scene, camera)æ ¹æ®è¿™æ®µä»£ç ï¼Œplaneæ˜¯ä¸€ä¸ªè´¨é‡ä¸º1çš„æ— é™å»¶é•¿çš„å¹³é¢ï¼Œåœ¨å‘ä¸‹çš„é‡åŠ›ä½œç”¨ä¸‹ï¼Œplaneå°†ä¼šä¸‹å ï¼š ç‰©ä½“ç¢°æ’æ°´å¹³å¹³é¢ æˆ‘ä»¬å°†å¹³é¢æ°´å¹³æ”¾ç½®ï¼ˆæ²¿xè½´æ—‹è½¬90åº¦ï¼‰ï¼Œä½œä¸ºé™æ€ç‰©ä½“ï¼Œå¹¶ä¸”å°†å¹³é¢çš„å°ºå¯¸è®¾ç½®ä¸º30*30ï¼šconst planeBody = new CANNON.Body( shape: new CANNON.Box(new CANNON.Vec3(15,15,0.5)), type:CANNON.BODY_TYPES.STATIC)groundBody.quaternion.setFromEuler(-Math.PI/2,0,0) åˆ›å»ºä¸€ä¸ªæ–¹å½¢ç‰©ä½“ï¼šï¼ˆæ³¨æ„åˆ›å»ºæ–¹å½¢ç‰©ä½“æ—¶ï¼Œvec3çš„å±æ€§è¡¨ç¤ºè·ç‰©ä½“ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼‰const boxGeo = new THREE.BoxGeometry(3, 3, 3)const boxMat = new THREE.MeshBasicMaterial( color:0x00ff00, wireframe:true)const boxMesh = new THREE.Mesh(boxGeo, boxMat)scene.add(boxMesh)///////////const boxBody = new CANNON.Body( shape: new CANNON.Box(new CANNON.Vec3(1.5, 1.5, 1, 5)), mass: 1, position:new CANNON.Vec3(1,20,0))world.addBody(boxBody)/////////function animate() //... boxMesh.position.copy(boxBody.position) boxMesh.quaternion.copy(boxBody.quaternion) //...å†åˆ›å»ºä¸€ä¸ªçƒä½“ï¼šconst sphereGeo = new THREE.SphereGeometry(3)const sphereMat = new THREE.MeshBasicMaterial( color: 0xff00ff, wireframe:true,)const sphereMesh = new THREE.Mesh(sphereGeo, sphereMat)scene.add(sphereMesh)////////////const sphereBody = new CANNON.Body( shape: new CANNON.Sphere(3), mass: 1, position:new CANNON.Vec3(0,15,0))world.addBody(sphereBody)///////////function animate() // ... sphereMesh.position.copy(sphereBody.position) sphereMesh.quaternion.copy(sphereBody.quaternion) // ... è¿åŠ¨å±æ€§ çº¿æ€§é˜»å°¼å€¼çš„èŒƒå›´åœ¨0-1ä¹‹é—´ï¼Œå€¼è¶Šå¤§ä»£è¡¨æ‘©æ“¦åŠ›è¶Šå¤§ï¼šsphereBody.linearDamping = 0.3è‡ªæ—‹è§’é€Ÿåº¦ï¼Œè‡ªæ—‹é˜»å°¼ï¼šboxBody.angularVelocity.set(10,0,0,0)boxBody.angularDamping = 0.3é¡ºä¾¿ä¸€æï¼Œè‡ªæ—‹è§’æ•´å¾—å¤ªå¤§ï¼Œæ–¹å—ä¼šè¢«åˆ›é£ ç‰©ç†æè´¨æè´¨ ä¸åŒç‰©ç†æè´¨çš„ç‰©ä½“æ¥è§¦æ—¶ä¹Ÿä¼šæœ‰ä¸åŒçš„è¿åŠ¨è½¨è¿¹ï¼Œä¹Ÿå°±æ˜¯ç»™æ¯ç§ç‰©ç†æè´¨èµ‹äºˆç‹¬æœ‰çš„ä¸€ç»„è¿åŠ¨å±æ€§,ä¸‹é¢åˆ†åˆ«å®šä¹‰äº†å¹³é¢ã€ç«‹æ–¹ä½“ã€çƒä½“çš„æè´¨const planePhysMat = new CANNON.Material()const boxPhysMat = new CANNON.Material()const spherePhysMat = new CANNON.Material()å°†æè´¨å’Œå¯¹åº”çš„Bodyè”ç³»åœ¨ä¸€èµ·ï¼šconst planeBody = new CANNON.Body( shape: new CANNON.Box(new CANNON.Vec3(15,15,0.5)), type: CANNON.BODY_TYPES.STATIC, material:planePhysMat)const boxBody = new CANNON.Body( shape: new CANNON.Box(new CANNON.Vec3(1.5, 1.5, 1, 5)), mass: 1, position: new CANNON.Vec3(1, 20, 0), material:boxPhysMat)const sphereBody = new CANNON.Body( shape: new CANNON.Sphere(3), mass: 1, position: new CANNON.Vec3(0, 15, 0), material:spherePhysMat) ç›¸äº’ä½œç”¨ ä¸åŒæè´¨é—´ç›¸äº’ä½œç”¨ï¼Œæ‰èƒ½èµ‹äºˆè¿åŠ¨ä»¥ç‹¬ç‰¹çš„ç‰©ç†å±æ€§ï¼Œå› æ­¤éœ€è¦å°†ä¸åŒçš„æè´¨è”ç³»èµ·æ¥,ä¸‹é¢çš„ä»£ç å°†ç«‹æ–¹ä½“ä¸å¹³é¢çš„æ‘©æ“¦åŠ›è®¾ç½®ä¸º0ï¼Œå°†çƒä½“ä¸å¹³é¢çš„å¼¹è·³ç³»æ•°è®¾ç½®ä¸º0.9const planeBoxContactMat = new CANNON.ContactMaterial( planePhysMat, boxPhysMat, friction:0 )const planeSphereContactMat = new CANNON.ContactMaterial( planePhysMat, spherePhysMat, restitution:0.9 // å›å¼¹ç³»æ•° )world.addContactMaterial(planeBoxContactMat)world.addContactMaterial(planeSphereContactMat) GLTFæ¨¡å‹çš„ç¢°æ’è¿™ä¸ªéƒ¨åˆ†è¸©å‘æ— æ•°ï¼Œbugå bugï¼Œéš¾ç»· è¦ä½¿ç‰©ä½“é—´äº§ç”Ÿç¢°æ’æ•ˆæœï¼Œé¦–å…ˆè¦ä¸ºç¢°æ’ç‰©åˆ›å»ºç¢°æ’ç½‘æ ¼ï¼ˆBodyï¼‰ï¼Œå¦‚ä½•å¯¹GLTFæ¨¡å‹åˆ›å»ºç¢°æ’ç½‘æ ¼ï¼Œéœ€è¦ç”¨åˆ° CANNON.Trimeshæˆ‘æƒ³è¦å®ç°çš„æ•ˆæœæ˜¯ï¼šä¸€æŠŠé’¥åŒ™æ¨¡å‹ä»åŠç©ºæ‰è½åˆ°åœ°æ¿ä¸Šä½¿ç”¨CANNON.Trimeshï¼Œéœ€è¦ç”¨åˆ°vertexå’Œindexä¸¤ä¸ªæ•°ç»„ï¼Œè¿™ä¸¤ä¸ªæ•°æ®æºä»gltfæ¨¡å‹ä¸Šéƒ½èƒ½å–åˆ°ï¼šloader.load(assets/key.glb,gltf= key = gltf.scene.getObjectByName(Object_2) // è·å–ç‰©ä½“ key.scale.set(0.005,0.005,0.005) // ç‰©ä½“åŸæ¨¡å‹è¿‡å¤§ï¼Œéœ€è¦ç¼©å° scene.add(key) const geo = key.geometry const keyShape = new CANNON.Trimesh( geo.attributes.position.array, // vertex geo.index.array // index ) keyBody = new CANNON.Body( mass:1, position:new CANNON.Vec3(0,3,0), shape:keyShape // åŠ è½½shape ) keyBody.quaternion.setFromEuler(Math.PI/2,0,0) world.addBody(keyBody))ä¸Šé¢çš„ä»£ç é‡Œï¼Œå°†positionå’Œindexæ•°æ®ç›´æ¥å–äº†å‡ºæ¥ï¼Œæ”¾å…¥Trimeshä¸­æ„å»ºå®ä½“ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸è¡Œï¼Œé’¥åŒ™ç›´æ¥ç©¿è¿‡å¹³é¢æ‰è½ã€‚chatGPTå‘Šè¯‰æˆ‘ï¼Œä¹‹æ‰€ä»¥ä¼šå‡ºè¿™ä¸ªé—®é¢˜ï¼Œæ˜¯ç”±äºä½¿ç”¨scaleå¯¹æ¨¡å‹è¿›è¡Œç¼©å°ï¼Œä½†ç‰©ä½“å®é™…çš„positionåæ ‡ä¾æ—§æ²¡æœ‰æ”¹å˜ï¼Œæˆ‘ç”¨Trimeshè¿”å›çš„é¡¶ç‚¹åæ ‡ä¿¡æ¯åˆ›å»ºäº†ä¸€ä¸ªç½‘æ ¼ç‰©ä½“ï¼Œå‘ç°å®ƒè¯´çš„æ²¡é”™ï¼Œé¡¶ç‚¹åæ ‡ä¾æ—§ä¿æŒgltfæ¨¡å‹åˆšè¢«å¼•å…¥çš„å°ºå¯¸:å› æ­¤éœ€è¦å¯¹åŸæœ¬çš„vertexè¿›è¡Œæ‰‹åŠ¨ç¼©æ”¾loader.load(assets/key.glb,gltf= gltf.scene.traverse(obj= if(obj.isMesh) obj.castShadow = true ) key = gltf.scene.getObjectByName(Object_2) // scaleç¼©æ”¾ ä¹Ÿå¯ä»¥åœ¨è®¡ç®—å¥½scaledVerticesä¹‹åï¼Œ // ä½¿ç”¨setAttributeå¯¹ç‰©ä½“é¡¶ç‚¹è¿›è¡Œæ›´æ–° key.scale.set(0.005,0.005,0.005) scene.add(key) const geo = key.geometry let vertices = geo.attributes.position.array // æ‰‹åŠ¨ç¼©æ”¾ // for (let i = 0; i vertices.length; i += 3) // scaledVertices.push( // vertices[i] * 0.005, // vertices[i+1] * 0.005, // vertices[i+2] * 0.005, // ) // let scaledVertices = vertices.map(i=i*0.005) const keyShape = new CANNON.Trimesh(scaledVertices, geo.index.array) keyBody = new CANNON.Body( mass:1, position:new CANNON.Vec3(0,3,0), shape:keyShape ) keyBody.quaternion.setFromEuler(Math.PI/2,0,0) world.addBody(keyBody))æ‰‹åŠ¨ç¼©æ”¾åï¼ŒShapeå’Œç‰©ä½“åŸæœ¬ç½‘æ ¼åº”è¯¥ä¿æŒä¸€è‡´ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œæ¨¡å‹è¿˜æ˜¯æ— é™å‘ä¸‹æ‰ï¼ˆshiiiiiiiitï¼‰è¿™æ—¶æˆ‘éšçº¦è§‰å¾—å¯èƒ½ä¸æ˜¯æˆ‘ç”¨äºæ„å»ºTriMeshçš„æ•°æ®æœ‰é—®é¢˜ï¼Œäºæ˜¯æˆ‘å¼•ç”¨äº†ä¸€ä¸ªæ™®é€šç›’å­æ¨¡å‹çš„vertexå’Œindexï¼Œå‘ç°Trimeshæœç„¶è¿˜æ˜¯å¾€ä¸‹æ‰ï¼Œå’Œé¡¶ç‚¹ã€ç´¢å¼•æ•°æ®æ— å…³ã€‚ä¸Šç½‘æœäº†ä¸€ä¸‹ï¼Œå‘ç°åŸæ¥è¿™æ˜¯CANNON.Trimeshçš„ä¸€ä¸ªå®˜æ–¹bugï¼šCANNON.Trimeshæ„å»ºçš„ä¸è§„åˆ™Shapeåªèƒ½å’ŒPlaneSphereç±»å‹çš„Shapeè¿›è¡Œç¢°æ’å¥½å§â€¦â€¦äºæ˜¯æˆ‘æŠŠç¢°æ’å¹³é¢çš„Shapeç±»å‹ä»Boxæ”¹æˆäº†Planeï¼Œç»ˆäºæˆåŠŸå˜const planeGeo = new THREE.PlaneGeometry(12,12)const planeMat = new THREE.MeshPhysicalMaterial( color:0xffffff, roughness:0,)const planeMesh = new THREE.Mesh(planeGeo, planeMat)planeMesh.rotation.x = Math.PI/2planeMesh.receiveShadow = truescene.add(planeMesh)const planeBody = new CANNON.Body( shape:new CANNON.Plane(), type:CANNON.BODY_SLEEP_STATES)planeBody.quaternion.setFromEuler(-Math.PI/2, 0,0)world.addBody(planeBody)"},{"title":"How to Create Objects on MouseClickï¼Ÿé¼ æ ‡ç‚¹å‡»åˆ›å»ºç‰©ä½“","path":"/wiki/ThreeJs/Wael_06_mouse_click_create_object.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=mTPDaw2piKg&list=PLjcjAqAnHd1EIxV4FSZIiJZvsdrBc1Xho&index=7 å®ç°åŸç†Threejsä¸­ä¸æä¾›è·å–é¼ æ ‡åœ¨ç©ºé—´ä¸­ä½ç½®çš„apiå› æ­¤ä½œè€…ç ”ç©¶å‡ºçš„æ–¹æ³•å¦‚å›¾æ‰€ç¤ºï¼šéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼šæ ¹æ®ç›¸æœºä½ç½®ï¼Œåˆ›å»ºä¸€ä¸ªä¸€ç›´æ­£é¢å¯¹ç€ç›¸æœºçš„å¹³é¢ä»¥ç›¸æœºå’ŒåŸç‚¹è¿çº¿ä¸ºæ³•çº¿ï¼ŒåŸç‚¹ä¸ºäº¤ç‚¹ï¼Œåˆ›å»ºå¹³é¢ä½¿ç”¨threejsæä¾›çš„setFromNormalAndCoplanarPointæ–¹æ³•æ ¹æ®é¼ æ ‡å’Œå±å¹•çš„äº¤ç‚¹ï¼Œåˆ¤æ–­ç‚¹å‡»åæ ‡è·å–ç›¸æœºå’Œé¼ æ ‡è¿çº¿ä¸è¾…åŠ©å¹³é¢çš„äº¤ç‚¹ï¼Œå³é¼ æ ‡ç‚¹å‡»åæ ‡ ä»£ç å®ç°åæ ‡è®¡ç®— const mouse = new THREE.Vector2()const planeNormal = new THREE.Vector3()const plane = new THREE.Plane()const raycaster = new THREE.Raycaster()const interSectionPoint = new THREE.Vector3()window.onmousemove = function(e) mouse.x = e.offsetX/window.innerWidth*2 - 1 mouse.y = 1- e.offsetY/window.innerHeight*2 // åˆ›å»ºè¾…åŠ©å¹³é¢ planeNormal.copy(camera.position) plane.setFromNormalAndCoplanarPoint(planeNormal, scene.position) // å°„çº¿äº¤ç‚¹ raycaster.setFromCamera(mouse,camera) raycaster.ray.intersectPlane(plane, interSectionPoint) ç‰©ä½“æ·»åŠ  window.onclick = function(e) const sphereGeo = new THREE.SphereGeometry(0.2) const sphereMat = new THREE.MeshStandardMaterial( color:0xffffff*Math.random(), metalness:0, roughness:0 ) const sphereMesh = new THREE.Mesh(sphereGeo,sphereMat) sphereMesh.position.copy(interSectionPoint) scene.add(sphereMesh) éå…¨å±çš„raycasteråæ ‡è®¡ç®—å…¨å±æ—¶ï¼Œç”»å¸ƒçš„å®½é«˜å–çš„æ˜¯ï¼šwindow.innerWidthwindow.innerHeightéå…¨å±æ—¶ï¼Œéœ€è¦å°†å¤§éƒ¨åˆ†æ¶‰åŠåˆ°å®½é«˜çš„å€¼æ›¿æ¢æˆï¼šdom.clientWidthdom.clientHeight// é¼ æ ‡å°„çº¿const mousePosition = new THREE.Vector2()const raycast = new THREE.Raycaster()window.onmousedown = e = mousePosition.x = e.offsetX/renderBox.clientWidth*2 -1 mousePosition.y = 1- e.offsetY/renderBox.clientHeight*2 raycast.setFromCamera(mousePosition, camera) const intersections = raycast.intersectObjects(scene.children) if (intersections[0] intersections[0].object.isObject3D) intersections[0].object.layers.toggle(BLOOM_LAYER)"},{"title":"How to Create Bouncing Ball on MouseClickï¼Ÿé¼ æ ‡ç‚¹å‡»åˆ›å»ºå¼¹è·³å°çƒ","path":"/wiki/ThreeJs/Wael_07_create_bouncing_ball_on_click.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=mTPDaw2piKg è¦å®ç°é¼ æ ‡ç‚¹å‡»æ‰è½å°å¼¹çƒï¼Œå®é™…ä¸Šå°±æ˜¯é¼ æ ‡ç‚¹å‡»åˆ›å»ºå°çƒ å’Œ cannonç‰©ç†å¼•æ“çš„ç»“åˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªæ–°å»ºçš„å°çƒéƒ½éœ€è¦ç»‘å®šä¸€ä¸ªCANNON.Bodyï¼Œéœ€è¦åœ¨åˆ›å»ºçš„åŒæ—¶ç•™å¥½æ•°æ®çš„è®¿é—®å…¥å£ï¼Œ é¼ æ ‡æ—¶é—´æ§åˆ¶å°çƒåˆ›å»º const mouse = new THREE.Vector2()const planeNormal = new THREE.Vector3()const plane = new THREE.Plane()const raycaster = new THREE.Raycaster()const interSectionPointer = new THREE.Vector3()const BallList = []window.onmousemove = function(e) mouse.x = e.offsetX/window.innerWidth*2 - 1 mouse.y = 1 - e.offsetY/window.innerHeight*2 planeNormal.copy(camera.position) plane.setFromNormalAndCoplanarPoint(planeNormal, scene.position) raycaster.setFromCamera(mouse,camera) raycaster.ray.intersectPlane(plane, interSectionPointer)window.onclick = function(e) const sphereGeo = new THREE.SphereGeometry(0.2) const sphereMat = new THREE.MeshStandardMaterial( color:0xffffff*Math.random(), metalness:0, roughness:0 ) const sphereMesh = new THREE.Mesh(sphereGeo,sphereMat) sphereMesh.position.copy(interSectionPointer) scene.add(sphereMesh) sphereMesh.castShadow = true const ballBody = new CANNON.Body( shape:new CANNON.Sphere(0.2), mass:1, position:interSectionPointer, material:ballPhyMat ) world.addBody(ballBody) BallList.push([sphereMesh,ballBody]) æè´¨æ·»åŠ  const world = new CANNON.World( gravity:new CANNON.Vec3(0,-9.89,0))const planePhyMat = new CANNON.Material()const ballPhyMat = new CANNON.Material()const planeBallContactMat = new CANNON.ContactMaterial( planePhyMat, ballPhyMat, restitution:0.9 )world.addContactMaterial(planeBallContactMat) åŠ¨ç”»æ§åˆ¶ const timeStep = 1/60function animate() world.step(timeStep) groundMesh.position.copy(groundBody.position) groundMesh.quaternion.copy(groundBody.quaternion) BallList.forEach(([mesh,body])= mesh.position.copy(body.position) mesh.quaternion.copy(body.quaternion) ) renderer.render(scene, camera);renderer.setAnimationLoop(animate); é˜´å½±é”¯é½¿ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œæ­¤å¤„çš„çƒä½“é˜´å½±ä¼šå› ä¸ºé”¯é½¿å˜å¾—å‚å·®ä¸é½ï¼šæ¸²æŸ“å™¨åˆ›å»ºæ—¶æœ‰æŠ—é”¯é½¿é€‰é¡¹antialiasï¼Œè®¾ç½®ä¸ºtrueçš„è¯æŠ—é”¯é½¿æ•ˆæœä¼šå¥½ä¸€äº›ï¼šconst renderer = new THREE.WebGLRenderer(antialias: true);çœ‹è§†é¢‘ä½œè€…çš„æ“ä½œï¼Œæ˜¯å°†å…‰æºçš„shadow.mapSizeå±æ€§è¿›è¡Œæ”¾å¤§ï¼špointLight.shadow.mapSize.width = 1024pointLight.shadow.mapSize.height = 1024æ•ˆæœç¡®å®å¥½äº†å¾ˆå¤šã€‚ çœŸçš„æœ‰è¿™ä¹ˆQå¼¹å—ï¼Ÿ"},{"title":"Subdivide Plane é€‰ä¸­ç½‘æ ¼","path":"/wiki/ThreeJs/Wael_08_subdivide_plane.html","content":"é¼ æ ‡é€‰ä¸­ç½‘æ ¼é«˜äº®è¦å®ç°çš„æ•ˆæœæ˜¯ï¼šç½‘æ ¼ä¸Šçš„é«˜äº®å—æ—¶åˆ»è·Ÿè¸ªé¼ æ ‡çš„ç§»åŠ¨ã€‚ å¯ä»¥åˆ†æˆä¸‰æ­¥å®ç°ï¼š è·å–é¼ æ ‡åœ¨ç½‘æ ¼ä¸Šçš„åæ ‡A æ ¹æ®åæ ‡Aè·å–ç½‘æ ¼ä¸Šæ–¹å—çš„åæ ‡B é«˜äº®å¹³é¢çš„åæ ‡ç§»åŠ¨åˆ°åæ ‡Bä½ç½® å®é™…æ˜¾ç¤ºçš„ç½‘æ ¼æ˜¯THREE.GridHelperï¼ˆç½‘æ ¼åŠ©æ‰‹ï¼‰ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªä¸å¯è§çš„è¾…åŠ©å¹³é¢Planeï¼ŒPlaneçš„å°ºå¯¸å’Œä½ç½®å’Œgridå®Œå…¨ä¸€è‡´ï¼Œé¼ æ ‡åœ¨ç§»åŠ¨æ—¶ï¼Œè®¡ç®—ç›¸æœº-é¼ æ ‡raycasterå°„çº¿å’ŒPlaneçš„äº¤ç‚¹pointã€‚pointéœ€è¦ç»è¿‡åç§»å¾—åˆ°é«˜äº®å—ç»˜åˆ¶ä½ç½®ï¼šfloor() å‘ä¸‹å–æ•´addScale(num) xzè½´æ­£å‘åç§»0.5yè½´ä¸º0åˆ›å»ºè¾…åŠ©å¹³é¢å’Œé«˜äº®å¹³é¢const plane = new THREE.Mesh( new THREE.PlaneGeometry(12, 12), new THREE.MeshBasicMaterial( visible:false, ))plane.rotateX(-Math.PI/2)scene.add(plane)const highLight = new THREE.Mesh( new THREE.PlaneGeometry(1, 1), new THREE.MeshBasicMaterial( color: 0xffffff ))highLight.rotateX(-Math.PI/2)highLight.position.set(0.5, 0, 0.5)scene.add(highLight)é€‰ä¸­ç§»åŠ¨é«˜äº®å—ï¼šconst mousePosition = new THREE.Vector2()const raycaster = new THREE.Raycaster()window.onmousemove = e = mousePosition.x = e.offsetX / window.innerWidth * 2 - 1 mousePosition.y = 1 - e.offsetY / window.innerHeight * 2 raycaster.setFromCamera(mousePosition, camera) const interSections = raycaster.intersectObject(plane) if (interSections[0]) const position = interSections[0].point.floor().addScalar(0.5) highLight.position.set(position.x, 0, position.z) åˆ›å»ºç‰©ä½“é¼ æ ‡ç‚¹å‡»äº‹ä»¶ä¸­æ·»åŠ åˆ›å»ºç‰©ä½“é€»è¾‘ï¼Œä½†æ˜¯åœ¨ç‰©ä½“åˆ›å»ºä¹‹å‰éœ€è¦å…ˆåˆ¤æ–­å½“å‰ç½‘æ ¼å†…æ˜¯å¦å·²ç»å­˜åœ¨ç‰©ä½“ï¼šä½¿ç”¨çš„æ˜¯åæ ‡åŒ¹é…çš„æ–¹å¼ã€‚ä¸ºäº†åšæç¤ºï¼Œé¼ æ ‡ç§»åŠ¨åˆ°å·²ç»å­˜åœ¨ç‰©ä½“çš„ç½‘æ ¼ä¸­æ—¶ï¼Œéœ€è¦å°†ç½‘æ ¼æ ‡çº¢ã€‚const mousePosition = new THREE.Vector2()const raycaster = new THREE.Raycaster()const objects = []const isExist = () = objects.find(obj = obj.position.x === highLight.position.x obj.position.z === highLight.position.z)window.onmousemove = e = mousePosition.x = e.offsetX / window.innerWidth * 2 - 1 mousePosition.y = 1 - e.offsetY / window.innerHeight * 2 raycaster.setFromCamera(mousePosition, camera) const interSections = raycaster.intersectObject(plane) if (interSections[0]) const position = interSections[0].point.floor().addScalar(0.5) highLight.position.set(position.x, 0, position.z) highLight.material.color.set( isExist()?0xff0000:0xffffff ) const sphereMesh = new THREE.Mesh( new THREE.SphereGeometry(0.4, 4, 2), new THREE.MeshBasicMaterial( color: 0xFFEF00, wireframe:true ))window.onmousedown = e = if (!isExist()) const sphere = sphereMesh.clone() sphere.position.copy(highLight.position) scene.add(sphere) objects.push(sphere) highLight.material.color.set(0xff0000) åŠ¨ç”»æ•ˆæœé«˜äº®å—é—ªçƒæ•ˆæœæ§åˆ¶é€æ˜åº¦ç‰©ä½“æ—‹è½¬æµ®åŠ¨æ•ˆæœfunction animate(time) highLight.material.opacity = 1 + Math.sin(time / 120) objects.forEach(obj = obj.rotation.x = time / 1000 obj.rotation.z = time / 1000 obj.position.y = 0.5 + 0.5 * Math.abs(Math.sin(time/1000)) ) renderer.render(scene, camera);"},{"title":"GLTF Material ä¸ Skeleton","path":"/wiki/ThreeJs/Wael_09_model_material.html","content":"ä¿®æ”¹GLTFçš„æè´¨ Clippartç¾å·¥ç´ æç½‘ç«™https://openclipart.org/ ä¸€ä¸ªæœ‰å¾ˆå¤šæœ‰è¶£çš„å»ºæ¨¡æ¨¡å‹ç½‘ç«™â€”â€”PATREONhttps://quaternius.com/ threejsä¸­æ”¯æŒé€šè¿‡objectçš„åå­—è·å–åˆ°æ¨¡å‹å­ç±»ï¼šgetObjectByNameé€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å•ç‹¬å¯¹å¯¼å…¥æ¨¡å‹çš„æè´¨è¿›è¡Œä¿®æ”¹,é€šè¿‡å°†æ¨¡å‹å¯¼å…¥threejså®˜æ–¹çš„editorå¹³å°ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è·çŸ¥æ¨¡å‹çš„ç›¸å…³ä¿¡æ¯ï¼šä½¿ç”¨guiå¯¹æ¨¡å‹å­ç±»è¿›è¡Œå®æ—¶æ“ä½œï¼Œå¯ä»¥å®ç°ä¸€ä¸ªæé©´çš„åŠŸèƒ½ï¼šconst gui = new dat.GUI()const options = Main: 0x787A79, Main_Light: 0xb9b9b9, Main_Dark: 0x383838, Hooves: 0x46423c, Hair: 0x383838, Muzzle: 0x3d3426, Eye_Dark: 0x181818, Eye_White: 0xe0e0e0const gltfLoader = new GLTFLoader()const donkeyUrl = new URL(../asserts/Donkey.gltf, import.meta.url)gltfLoader.load(donkeyUrl.href, gltf = const model = gltf.scene; scene.add(model) gui.addColor(options, Main).onChange(newVal = model.getObjectByName(Cube).material.color.set(newVal) ) gui.addColor(options, Main_Light).onChange(newVal = model.getObjectByName(Cube_1).material.color.set(newVal) ) gui.addColor(options, Main_Dark).onChange(newVal = model.getObjectByName(Cube_2).material.color.set(newVal) ) gui.addColor(options, Hooves).onChange(newVal = model.getObjectByName(Cube_3).material.color.set(newVal) ) gui.addColor(options, Hair).onChange(newVal = model.getObjectByName(Cube_4).material.color.set(newVal) ) gui.addColor(options, Muzzle).onChange(newVal = model.getObjectByName(Cube_5).material.color.set(newVal) ) gui.addColor(options, Eye_Dark).onChange(newVal = model.getObjectByName(Cube_6).material.color.set(newVal) ) gui.addColor(options, Eye_White).onChange(newVal = model.getObjectByName(Cube_7).material.color.set(newVal) ), undefined, err = console.error(err))èµ›åšé™å®šæ¬¾é©´ ä¿®æ”¹GLTFçš„éª¨éª¼gltfæ¨¡å‹ç”±è®¸å¤šéª¨æ¶ç»„æˆï¼Œç±»ä¼¼childrenä¸­åŒ…å«çš„å­å®ä½“ï¼Œä¹Ÿéœ€è¦é€šè¿‡ getObjectByName é€‰ä¸­å•ä¸ªéª¨æ¶ã€‚const params = Neptune_01: 0, // æµ·ç‹æ˜Ÿ Uranus_02: 0, // å¤©ç‹æ˜Ÿ Saturn_03: 0, // åœŸæ˜Ÿ Jupiter_04: 0, // æœ¨æ˜Ÿ Mars_05:0 , // ç«æ˜Ÿ Earth_06:0 , // åœ°çƒ Venus_07:0 , // é‡‘æ˜Ÿ Mercury_08:0 , // æ°´æ˜Ÿ Sun_09:0 , // å¤ªé˜³const loader = new GLTFLoader()let modelloader.load(assets/solar_system_model_orrery.glb,gltf= model = gltf.scene model.traverse(obj= if(obj.isMesh) obj.castShadow = true ) model.position.set(0, 0.732,0) model.scale.set(3,3,3) scene.add(model) Object.entries(params).forEach(([key,value])= gui.add(params,key,0,2*Math.PI).onChange(v= // é€šè¿‡åç§°å€¼è·å–éª¨æ¶è¿›è¡Œæ—‹è½¬ model.getObjectByName(key).rotation.y = v check() ) )) æ§åˆ¶Boneå®ç°è§†çº¿è·Ÿéšé¼ æ ‡æ•ˆæœ å®ç°è§†çº¿è¿½è¸ªé¼ æ ‡ï¼Œå®é™…å°±æ˜¯ä¿®æ”¹å¤´éƒ¨çœ¼éƒ¨çš„ç„¦ç‚¹ï¼ˆlookAtï¼‰ä»æ¨¡å‹ä¸­æŠ½å–å‡ºå¤´éƒ¨çœ¼éƒ¨æ¨¡å‹ä½¿ç”¨å…‰çº¿è¿½è¸ªå™¨è·å–é¼ æ ‡çš„3Dåæ ‡ï¼Œå‚è€ƒ é¼ æ ‡ç‚¹å‡»åˆ›å»ºç‰©ä½“let knightModellet knightHead// åŠ è½½éª‘å£«loader.load(assets/medieval_knight.glb,gltf= knightModel = gltf.scene // è·å–æ¨¡å‹çš„å¤´éƒ¨ knightHead = knightModel.getObjectByName(mixamorigHead_06))// raycasterè§†çº¿äº¤ç‚¹let target = new THREE.Vector3()target.z = 4const raycaster = new THREE.Raycaster()const raycaster_select = new THREE.Raycaster() // é€‰æ‹©ç‰©ä½“ç”¨çš„raycasterconst mouse = new THREE.Vector2()const planeNormal = new THREE.Vector3()const interSectionPoint = new THREE.Vector3()const plane = new THREE.Plane()let intersections = []window.onmousemove = e = mouse.x = e.offsetX / window.innerWidth * 2 -1 mouse.y = 1- e.offsetY/window.innerHeight*2 planeNormal.copy(camera.position) plane.setFromNormalAndCoplanarPoint(planeNormal, scene.position) raycaster.setFromCamera(mouse, camera) // æ‰«æè§†çº¿ç‚¹ raycaster.ray.intersectPlane(plane,interSectionPoint) target.copy(interSectionPoint) target.z = 4 target.y = Math.max(interSectionPoint.y, 1)// loopå‡½æ•°let clock = new THREE.Clock()function animate(time) if(knightModel) knightHead.lookAt(target) // ç§»åŠ¨æ¨¡å‹å¤´éƒ¨çš„åæ ‡ renderer.render(scene, camera);"},{"title":"Realistic Scenes çœŸå®åœºæ™¯","path":"/wiki/ThreeJs/Wael_11_realistic_scenes.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=6XvqaokjuYU&list=PLjcjAqAnHd1EIxV4FSZIiJZvsdrBc1Xho&index=11 maxroz HDRIhttps://www.maxroz.com/hdri HDRTone MappingGamma CorrectionsRGB Color SpaceHDRä»€ä¹ˆæ˜¯DRï¼Ÿ DRå…¨ç§°Dynamic Rangeï¼Œè¡¨ç¤ºä¼ æ„Ÿå™¨æˆ–æ˜¾ç¤ºå±èƒ½å¤Ÿæ•æ‰å›¾ç‰‡ä¸­æœ€äº®å’Œæœ€æš—ç‚¹ä¹‹é—´çš„å·®å¼‚ï¼Œè®¾å¤‡èƒ½èƒ½å¤Ÿæ•æ‰çš„DRå€¼è¶Šé«˜ï¼Œå›¾ç‰‡æ˜¾ç¤ºçš„ç»†èŠ‚ç¨‹åº¦å°±è¶Šé«˜ã€‚HDRå…¨ç§°High Dynamic Rangeï¼Œè¦åˆ¶ä½œä¸€å¼ HDRå›¾ç‰‡ï¼ˆå³å…‰å½±åˆ†è¾¨ç‡è¾ƒé«˜çš„å›¾ç‰‡ï¼‰ï¼Œæ‘„å½±å¸ˆéœ€è¦å…ˆæ‹ä¸€å¼ ä¸­é—´è°ƒçš„å›¾ç‰‡ï¼Œç„¶åæ‹å‡ å¼ äº®åº¦ä¸åŒçš„å›¾ç‰‡ï¼Œé€šè¿‡åƒAdobe Lightroomè¿™æ ·çš„è½¯ä»¶åˆæˆåœ¨ä¸€èµ·ã€‚ Tone MappingHDRå’ŒEXRæ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶åŒ…å«çš„æ•°æ®é‡æ›´å¤§ï¼Œå› æ­¤é€‰ç”¨1632bitç¼–ç ï¼Œä½†æ˜¯å¤§å¤šæ•°æ˜¾ç¤ºå±éƒ½æ˜¯8bit10bitçš„ï¼Œå› æ­¤åœ¨æ˜¾ç¤ºè¿™äº›å›¾ç‰‡æ—¶ä¼šä¸¢å¤±å¾ˆå¤šç»†èŠ‚ã€‚æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå¯ä»¥ç”¨Photoshopç­‰ä¸“ä¸šå›¾åƒå¤„ç†è½¯ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨Tone Mapæ˜ å°„ç®—æ³•Tone Mapæ˜ å°„æ–¹æ³•èƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ç®—æ³•æ˜ å°„çš„æ–¹å¼ï¼Œä½¿8bitç¼–ç ä¸­èƒ½å¤Ÿè•´å«1632bitç¼–ç çš„ä¿¡æ¯ Gamma Correctionéšç€å®é™…äº®åº¦çš„å¢é«˜ï¼Œäººçœ¼å¯¹äº®åº¦çš„æ„Ÿå—å¾€å¾€æ›´å¼±ï¼Œè¿™æ˜¯å› ä¸ºäººçœ¼å¯¹é»‘æš—çš„ååº”æ¯”å¯¹å…‰çš„ååº”æ›´åŠ æ•æ„Ÿã€‚ä¸äººçœ¼ç›¸åï¼Œæ˜¾ç¤ºå±æ˜¾ç¤ºå‡ºçš„äº®åº¦å¾€å¾€è¦é«˜äºå®é™…äº®åº¦Gamma Correctionå°±æ˜¯å¯¹è¿™ç§å·®å¼‚è¿›è¡Œæ ¡æ­£çš„æ–¹æ³•ï¼šåœ¨è¦æ˜¾ç¤ºçš„å›¾ç‰‡äº®åº¦ä¸Šä½¿ç”¨äººçœ¼åæ›²çº¿è°ƒæ•´ï¼Œè¿™æ ·æœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥çš„äº®åº¦ä¼šè¢«æ ¡æ­£åˆ°çº¿æ€§å…³ç³»ä¸ŠGamma Correctionçš„æ–¹æ³•åœ¨jpegpngç­‰æ ¼å¼çš„å›¾ç‰‡å†…éƒ¨å®Œæˆï¼Œå› æ­¤è¿™äº›æ ¼å¼çš„å›¾ç‰‡æ•°æ®ä½¿ç”¨åæ›²çº¿æ ¼å¼ä¿å­˜ï¼Œè¦æ›´äº®ä¸€äº›ã€‚è€ŒHDRã€EXRç±»å‹çš„æ–‡ä»¶ä½¿ç”¨çš„ä»ç„¶æ˜¯çº¿æ€§æ ¼å¼ä¿å­˜ï¼Œå› ä¸ºå¤§éƒ¨åˆ†CGIã€æ¸¸æˆæ¸²æŸ“å™¨éƒ½éœ€è¦çº¿æ€§å·¥ä½œæµç¨‹ï¼Œå› æ­¤ä½¿ç”¨çº¿æ€§æ ¼å¼å›¾ç‰‡è¿›è¡Œå¼€å‘ã€‚ sRGB Color SpaceThreeJsä¸­æ¸²æŸ“HDRå›¾åƒï¼Œéœ€è¦é€šè¿‡å›¾åƒçš„åŸå§‹é¢œè‰²ï¼ˆsRGBï¼‰è®¡ç®—å‡ºåƒç´ é¢œè‰²ï¼Œå†æ ¹æ®ç¼–ç ç®—æ³•è¿›è¡ŒGamma CorrectionsRGBæŒ‡çš„æ˜¯æœ€çº¯æ­£çš„RGBé¢œè‰² åœºæ™¯æ¸²æŸ“ç¯å¢ƒåŠ è½½ ä¸ºsceneæ·»åŠ 360Â°HDRèƒŒæ™¯å›¾ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹æ“ä½œï¼šä½¿ç”¨ RGBELoader åŠ è½½å›¾ç‰‡æè´¨çš„æ˜ å°„æ–¹å¼åº”ä¸º EquirectangularReflectionMappingéœ€è¦å°†æ¸²æŸ“å™¨åŠ è½½å›¾ç‰‡çš„ç¼–ç æ ¼å¼é…ç½®æˆ sRGBEncoding0.152.0ç‰ˆæœ¬çš„threejsé»˜è®¤æ˜¯sRGBEncodingæ ¼å¼çš„åœ¨è¿™ä¹‹å‰çš„ç‰ˆæœ¬ä¸­é»˜è®¤å€¼éƒ½æ˜¯LinearEncodingç¼–ç æ ¼å¼å°†ToneMappingç®—æ³•é…ç½®æˆACESFilmicToneMappingé€‚å½“è°ƒæ•´ToneMappingæ›å…‰ç‡å±æ€§import RGBELoader from three/examples/jsm/loaders/RGBELoaderrenderer.outputEncoding = THREE.sRGBEncodingrenderer.toneMapping = THREE.ACESFilmicToneMappingrenderer.toneMappingExposure = 1.8const backgroundUrl = new URL(../asserts/kitchen.hdr,import.meta.url)const rgbeLoader = new RGBELoader()rgbeLoader.load(backgroundUrl.href, texture = texture.mapping = THREE.EquirectangularReflectionMapping scene.background = texture) ç¯å¢ƒåŠ è½½ ç¯å¢ƒè´´å›¾å¯ä»¥å°†ç‰©ä½“æ”¾ç½®åœ¨æŒ‡å®šçš„ç¯å¢ƒå…‰ä¸‹æ¸²æŸ“ï¼Œæ— éœ€å¤–åŠ å…‰æºï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€ç¯å¢ƒé…ç½®çš„æ–¹å¼ï¼šscene.environment = textureä¹Ÿå¯ä»¥å•ç‹¬å¯¹ç‰©ä½“è¿›è¡Œç¯å¢ƒå…‰è´´å›¾ï¼šconst sphere = new THREE.Mesh( new THREE.SphereGeometry(3,50,50), new THREE.MeshStandardMaterial( roughness: 0, metalness: 1, envMap:texture // è´´å›¾å±æ€§ ))"},{"title":"å¦‚ä½•å¯¼å…¥ä»Sketchfabä¸Šä¸‹è½½çš„æ¨¡å‹","path":"/wiki/ThreeJs/Wael_12_import_sketchfab_model.html","content":"Parcelé™æ€æ–‡ä»¶æ‰“åŒ…ä½¿ç”¨parcelæ‰“åŒ…å‰ç«¯é¡¹ç›®æ—¶ï¼Œå¦‚æœæ¶‰åŠåˆ°èµ„æºæ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨importçš„æ–¹å¼ä¸€ä¸€å¯¼å…¥ï¼Œå¦‚æœæ–‡ä»¶å¾ˆå¤šï¼Œå¯¼å…¥çš„ä»£ç éœ€è¦å†™ä¸Šå¾ˆå¤šã€‚å¯ä»¥å®‰è£…å¦ä¸€ä¸ªåŒ…ï¼šparcel-reporter-static-files-copyhttps://www.npmjs.com/package/parcel-reporter-static-files-copyhttps://www.npmjs.com/package/parcel-reporter-static-files-copyå®‰è£…å¥½ä¹‹åï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºstaticç›®å½•ï¼Œå°†é™æ€èµ„æºæ”¾åœ¨é‡Œé¢ï¼Œå†æ¬¡parcelæ‰“åŒ…ä¹‹åï¼Œdistæ–‡ä»¶ä¸­ä¼šå‡ºç°ä¸staticå¯¹åº”çš„ç›®å½•å’Œèµ„æºæ–‡ä»¶ æ¨¡å‹å¯¼å…¥æ¨¡å‹å¯¼å…¥ä¹‹åçš„æ¸²æŸ“æ•ˆæœå¾ˆæš—ï¼Œå³ä½¿æ·»åŠ äº†å…‰æºä¹Ÿæ²¡æœ‰æ•ˆæœï¼Œä¸€èˆ¬å¯¼å…¥æ¨¡å‹åä¼šæ·»åŠ ç¯å¢ƒè´´å›¾ï¼šimport GLTFLoader from three/examples/jsm/loaders/GLTFLoaderimport RGBELoader from three/examples/jsm/loaders/RGBELoaderconst rgbeLoader = new RGBELoader()const gltfLoader = new GLTFLoader()let carrgbeLoader.load(./assets/kitchen.hdr, texture = texture.mapping = THREE.EquirectangularReflectionMapping scene.environment = texture gltfLoader.load(./assets/1975_porsche/scene.gltf, gltf = car = gltf.scene scene.add(car) ))"},{"title":"å¦‚ä½•ä½¿ç”¨gsapæ§åˆ¶ç›¸æœºè¿åŠ¨","path":"/wiki/ThreeJs/Wael_14_camera_move.html","content":"åŸé¡¹ç›®è§†é¢‘https://www.youtube.com/watch?v=O2ouLOL6C4c GSAPhttps://gsap.com/https://gsap.com/åŠ¨ç”»å°±æ˜¯ç‰©ä½“éšç€æ—¶é—´çš„å˜åŒ–è¿åŠ¨è½¨è¿¹çš„å˜åŒ–ï¼Œç›¸å½“äºä¸€ç³»åˆ—ç‚¹ä½ï¼ŒGSAPå°±æ˜¯èƒ½è®¡ç®—å‡ºè¿åŠ¨ç‚¹ä½çš„åŠ¨ç”»åº“ï¼Œä½¿ç”¨GSAPå¯¹THREEçš„åŸºæœ¬å…ƒç´ è¿›è¡ŒåŠ¨ç”»æ§åˆ¶éå¸¸ç®€å•ï¼Œåªéœ€è¦æŒ‡å®šéœ€è¦å˜åŒ–çš„å±æ€§ã€å±æ€§ç›®æ ‡å€¼ã€æŒç»­æ—¶é—´ç­‰ç­‰åŸºæœ¬å‚æ•°å³å¯,gsapä¸­çš„timelineç±»å‹é“¾å¼æ·»åŠ åŠ¨ç”»æ›´åŠ æ–¹ä¾¿const tl = gsap.timeline()const duration = 6const ease = ease tl.to(camera.position, x:0, y:0, z:19.5, duration, ease, onUpdate:function() camera.lookAt(0,0,0) ).to(camera.position, x:-15, y:24, z:0, duration, ease, onUpdate:function() camera.lookAt(0,0,0) ).to(camera.position, x:6, y:-10, z:0, duration, ease, onUpdate:function() camera.lookAt(0,0,0) ,-2) FirstPersonControls ç¬¬ä¸€äººç§°ç›¸æœºæ§åˆ¶å™¨ gsapå¯ä»¥æ§åˆ¶ç›¸æœºåšå„ç§è§†è§’è¿åŠ¨ï¼ˆè¿é•œï¼‰ï¼Œä½†æ˜¯è¦æƒ³å¾—åˆ°ä¸é”™çš„æ•ˆæœï¼Œéœ€è¦æŠ“ä½ç›¸æœºæ‹æ‘„çš„å…³é”®è§’åº¦å’Œåæ ‡ï¼Œè¿™äº›å…³é”®ç‚¹çš„å‚æ•°å¦‚ä½•è·å–ï¼Ÿå¯ä»¥ä½¿ç”¨FirstPersonControlsï¼Œç¬¬ä¸€äººç§°ç›¸æœºæ§åˆ¶å™¨ï¼Œæ¨¡æ‹Ÿç›¸æœºè¿åŠ¨ï¼Œç›¸å½“äºè¸©ç‚¹ï¼Œè®°å½•ä¸‹å‡ ä¸ªå…³é”®çš„ç‚¹ä½ã€‚import FirstPersonControls from three/examples/jsm/controls/FirstPersonControls.js;const controls = new FirstPersonControls(camera, renderer.domElement)controls.movementSpeed = 8controls.lookSpeed = 0.08window.onmouseup = e = // å‚æ•°æ‰“å° console.log(camera.position, camera.rotation)const clock = new THREE.Clock()function animate() controls.update(clock.getDelta()) renderer.render(scene, camera);ç„¶åä½¿ç”¨gsapåœ¨è¿™äº›ç‚¹ä½ä¹‹é—´åšè¿è´¯è¿åŠ¨ï¼šlet progress = 0window.onmousedown = e= switch (progress%9) case 0: cameraMovement(x:1.64, y :0.79, z:-0.16) cameraRotation(x:0.83, y :-1.17, z:0.79) break; case 1: cameraMovement(x:1.35, y :0.83, z:-5.6) cameraRotation(x:0.43, y :0.13, z:-0.06) break; case 2: cameraMovement(x:3.04, y :-0.17, z:-6.33) cameraRotation(x:3, y :-0.9, z:3.03) break; case 4: cameraMovement(x:2.13, y :0.89, z:2.04) cameraRotation(x:2.85, y :-0.99, z:2.89) break; case 5: cameraMovement(x:-0.42, y :-0.13, z:2.11) cameraRotation(x:2.88, y :-0.09, z:3.11) break; case 6: cameraMovement(x:-1.04, y :0.36, z:0.18) cameraRotation(x:2.41, y :1.4, z:-2.42) break; case 7: cameraMovement(x:-0.84, y :0.58, z:-4.4) cameraRotation(x:0.11, y :0.83, z:-0.08) break; case 8: cameraMovement(x:-0.38, y :0.03, z:-1.57) cameraRotation(x:1.57, y :0.08, z:-1.62) break; progress++"},{"title":"å¦‚ä½•æ˜¾ç¤ºèµ„æºåŠ è½½è¿›åº¦","path":"/wiki/ThreeJs/Wael_13_loading_screen.html","content":"ä½¿ç”¨åˆ°çš„æ¨¡å‹åœ°å€ THREE.LoadingManagerLoadingManagerå®ä¾‹é…ç½®åˆ°Loaderä¸­ï¼Œå¯ä»¥ç”¨æ¥ç›‘æ§èµ„æºåŠ è½½çš„å‡ ç§çŠ¶æ€ï¼šonStartonLoadonProgresså‚æ•°:(urlèµ„æºåœ°å€, loadedå·²åŠ è½½æ•°é‡, totalå…¨éƒ¨éœ€è¦åŠ è½½çš„èµ„æºæ•°é‡)onError èµ„æºè¿›åº¦æ¡ä¸»è¦ä¾é onProgresså’ŒonLoadä¸¤ä¸ªé˜¶æ®µï¼ŒonProgressåé¦ˆåŠ è½½è¿›åº¦onLoadåŠ è½½å®Œæ¯•æ—¶å…³é—­è¿›åº¦æ¡ç•Œé¢style * padding:0; margin:0; .progress-content position:absolute; left:0; top:0; width: 100%; height:100vh; background-color:rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; flex-direction: column; .progress-label font-size: 2rem; color:#fff; margin-bottom:3px; #progress-bar width:30%; /stylediv class=progress-content div class=progress-labelLoading.../div progress id=progress-bar value=0 max=100 //divconst loadingManager = new THREE.LoadingManager()const progressBar = document.getElementById(progress-bar)loadingManager.onProgress = (url, loaded, total) = progressBar.setAttribute(value, loaded/total*100)const progressContent = document.querySelector(.progress-content)loadingManager.onLoad = () = progressContent.style.display = noneconst gltfLoader = new GLTFLoader(loadingManager)const rgbeLoader = new RGBELoader(loadingManager)rgbeLoader.load(./assets/MR_INT-006_LoftIndustrialWindow_Griffintown.hdr, texture = texture.mapping = THREE.EquirectangularReflectionMapping scene.environment = texture gltfLoader.load(./assets/mars_one_mission/scene.gltf, gltf = scene.add(gltf.scene) ,undefined,err=console.error(err)))"},{"title":"Cloning And Animating Models Loaded From glTF Files. å…‹éš†åŠ¨ç”»GLTFæ¨¡å‹","path":"/wiki/ThreeJs/Wael_10_cloning_models.html","content":"è¦å®ç°å…‹éš†åŠ¨ç”»æ¨¡å‹çš„åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼šå…‹éš†GLTFæ¨¡å‹éœ€è¦ä½¿ç”¨SkeletonUtilsåº“ï¼Œè¿›è¡Œç‰¹æ®Šæ¨¡å‹å¤åˆ¶å¯¹äºæ¯ä¸€ä¸ªæ¨¡å‹éƒ½è¦åˆ›å»ºå•ç‹¬çš„mixeræ§åˆ¶åŠ¨ç”»åœ¨è¯»å–æ¨¡å‹æ—¶éœ€è¦å°†å…¶ä½œä¸ºæ¨¡å…·å…¨å±€å­˜å‚¨ï¼šconst gltfLoader = new GLTFLoader()const shibaInuURL = new URL(../asserts/ShibaInu.gltf, import.meta.url)let shibaInuModelgltfLoader.load(shibaInuURL.href, gltf = gltf.scene.scale.set(0.3, 0.3, 0.3) shibaInuModel = gltf,undefined,err=console.error(err))é¼ æ ‡ç‚¹å‡»å¹³é¢æ—¶ï¼Œä½¿ç”¨SkeletonUtilså…‹éš†ï¼Œå¹¶åˆ›å»ºç›¸åº”mixeråŠ¨ç”»æ§åˆ¶å™¨ï¼šconst mousePosition = new THREE.Vector2()const raycaster = new THREE.Raycaster()const objects = []const mixers = []const isExist = () = objects.find(obj = obj.position.x === highlight.position.x obj.position.z === highlight.position.z)function getInterSections(e) mousePosition.x = e.offsetX / window.innerWidth * 2 - 1 mousePosition.y = 1 - e.offsetY / window.innerHeight * 2 raycaster.setFromCamera(mousePosition, camera) return raycaster.intersectObject(plane)window.onmousemove = e = let interSections = getInterSections(e) if (interSections[0]) let position = interSections[0].point.floor().addScalar(0.5) highlight.position.set(position.x, 0, position.z) highlight.material.color.set(isExist() ? 0xff0000 : 0xffffff) window.onmousedown = e = if (isExist() || !getInterSections(e)[0]) return let obj = SkeletonUtils.clone(shibaInuModel.scene) scene.add(obj) obj.position.set(highlight.position.x, 0, highlight.position.z) objects.push(obj) const mixer = new THREE.AnimationMixer(obj) const action = mixer.clipAction( THREE.AnimationClip.findByName(shibaInuModel.animations, Idle_2) ) action.play() mixers.push(mixer) highlight.material.color.set(0xff0000)åœ¨åŠ¨ç”»ä¸­å¯¹æ¯ä¸€ä¸ªmixerè¿›è¡Œæ›´æ–°ï¼šlet clock = new THREE.Clock()function animate(time) const delta = clock.getDelta() mixers.forEach(mixer = mixer.update(delta) ) highlight.material.opacity = Math.abs(Math.sin(time/120)) renderer.render(scene, camera);"},{"title":"ä½¿ç”¨yukaæ§åˆ¶ç‰©ä½“è¿åŠ¨","path":"/wiki/ThreeJs/Wael_15_yuka.html","content":"https://mugen87.github.io/yuka/https://mugen87.github.io/yuka/ Yukaæ¸¸æˆä¸­å­˜åœ¨å¾ˆå¤šå¯ä»¥äº¤äº’çš„ç‰©ä½“ï¼Œæ²¿å›ºå®šè·¯å¾„å‰è¿›çš„NPCã€ä¸»åŠ¨è¿½è¸ªè§’è‰²çš„æ€ªç‰©ã€å·¡é€»æœæŸ¥åŒºåŸŸçš„æ•Œäººï¼Œè¿™äº›æœ‰ç‰©ä½“ä¸€èˆ¬ç»Ÿç§°Entityï¼Œå…·æœ‰ä¸åŒç¨‹åº¦çš„AIèƒ½åŠ›ï¼Œyuka.jsä¸­æä¾›äº†å¾ˆå¤šå®ç°æ¸¸æˆaiçš„æ–¹æ³•ã€‚ è¦å®ç°å®ä½“æ²¿å›ºå®šè·¯çº¿ç§»åŠ¨ï¼Œéœ€è¦åšå¦‚ä¸‹å‡†å¤‡ï¼šåˆ›å»ºä¸€ä¸ªå®ä½“Meshï¼ˆè‚‰ä½“ï¼‰åˆ›å»ºMeshå¯¹åº”çš„Vehicleï¼ˆçµé­‚ï¼‰ç»‘å®šMeshå’ŒVehicleåˆ›å»ºè·¯å¾„pathç»‘å®šè·¯å¾„å’ŒVehicleåˆ›å»ºå®ä½“ç®¡ç†å™¨ï¼Œç®¡ç†å®ä½“éšæ—¶é—´æ›´æ–°å®ä½“é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåœ†é”¥å½¢çš„å®ä½“ï¼Œæ³¨æ„éœ€è¦å…³é—­å®ä½“çŸ©é˜µçš„è‡ªåŠ¨æ›´æ–°é€‰é¡¹ã€‚const vehicleGeo = new THREE.ConeGeometry(0.1, 0.8, 8)vehicleGeo.rotateZ(Math.PI/2)const vehicleMat = new THREE.MeshNormalMaterial()const vehicleMesh = new THREE.Mesh(vehicleGeo, vehicleMat)vehicleMesh.matrixAutoUpdate = falsescene.add(vehicleMesh)åˆ›å»ºVehicleï¼Œå°†æ›´æ–°åçš„entityä¸meshè¿›è¡ŒåŒæ­¥const vehicle = new YUKA.Vehicle()vehicle.maxSpeed = 2vehicle.setRenderComponent(vehicleMesh, sync)function sync(entity, renderComponent) renderComponent.matrix.copy(entity.worldMatrix)åˆ›å»ºå¾ªç¯è·¯å¾„const path = new YUKA.Path()path.loop = truepath.add(new YUKA.Vector3(0,0,6))path.add(new YUKA.Vector3(-4,0,4))path.add(new YUKA.Vector3(-6,0,0))path.add(new YUKA.Vector3(-4,0,-4))path.add(new YUKA.Vector3(0,0,1))path.add(new YUKA.Vector3(4,0,-4))path.add(new YUKA.Vector3(6,0,0))path.add(new YUKA.Vector3(4, 0, 4))vehicleMesh.position.copy(path.current)const points = path._waypoints.map(position = [position.x, position.y, position.z]).flat()const lineGeo = new THREE.BufferGeometry()lineGeo.setAttribute(position, new THREE.Float32BufferAttribute(points, 3))const lineMat = new THREE.LineBasicMaterial()const lineMesh = new THREE.LineLoop(lineGeo, lineMat)scene.add(lineMesh)const followPathBehovior = new YUKA.FollowPathBehavior(path, 0.5)vehicle.steering.add(followPathBehovior)const onePathBehavior = new YUKA.OnPathBehavior(path)onePathBehavior.radius = 0vehicle.steering.add(onePathBehavior)æ·»åŠ å®ä½“ç®¡ç†å™¨const entityManager = new YUKA.EntityManager()entityManager.add(vehicle)const clock = new YUKA.Time()function animate() let delta = clock.update().getDelta() entityManager.update(delta) renderer.render(scene, camera); YUKAæ§åˆ¶GLTFæ¨¡å‹gltfæ¨¡å‹åŠ è½½åï¼Œç”±äºå°†matrixAutoUpdateå…³é—­ï¼Œæ— æ³•å¯¹modelMatrixè¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤ä¸èƒ½é€šè¿‡model.scale.set()çš„æ–¹å¼è¿›è¡Œç¼©æ”¾ï¼Œéœ€è¦é€šè¿‡YUKA.Vehicleæä¾›çš„scaleå±æ€§è¿›è¡Œç¼©æ”¾gltfLoader.load(/assets/Debris_BrokenCar.gltf, gltf = let model = gltf.scene model.matrixAutoUpdate = false scene.add(model) vehicle.scale = new THREE.Vector3(0.5,0.5,0.5) vehicle.setRenderComponent(model, sync))const vehicle = new YUKA.Vehicle()vehicle.maxSpeed = 3function sync(entity, renderComponent) renderComponent.matrix.copy(entity.worldMatrix) ç‰©ä½“å¯»è·¯ SeekBehaviorä½¿ç”¨yukaåšå‡ºAç‰©ä½“å¯»æ‰¾Bç‰©ä½“çš„æ•ˆæœï¼Œéœ€è¦ä½¿ç”¨åˆ°SeekBehaviorç±»éœ€è¦æŒ‡å®šç›®æ ‡ç‰©ä½“çš„åæ ‡ï¼Œå°†SeekBehavioræ·»åŠ åˆ°åŠ¨ä½œä¸»ä½“ä¸­ï¼šåˆ›å»ºseekä¸»ä½“const vehicle = new YUKA.Vehicle()vehicle.maxSpeed = 3vehicle.setRenderComponent(vehicleMesh, sync)vehicle.position.set(-6,0,2)åˆ›å»ºtargetå®ä½“const target = new YUKA.GameEntity()target.setRenderComponent(targetMesh, sync)æ·»åŠ è¿½è¸ªè¡Œä¸ºconst seekBehavior = new YUKA.SeekBehavior(target.position)vehicle.steering.add(seekBehavior)æ·»åŠ å®ä½“ç®¡ç†å™¨å¹¶é€å¸§æ›´æ–°const entityManager = new YUKA.EntityManager()entityManager.add(vehicle)entityManager.add(target)const time = new YUKA.Time()function animate() let delta = time.update().getDelta() entityManager.update(delta) renderer.render(scene, camera); ç‰©ä½“æŠµè¾¾ ArriveBehaviorArriveBehaviorå’ŒSeekBehaviorç±»ä¼¼ï¼ŒArriveåœ¨åˆ°è¾¾ç›®çš„åœ°ååœæ­¢ï¼ŒSeekä¾æ—§ä¿æŒæœå¯»ï¼Œåˆ›å»ºArriveè¡Œä¸ºéœ€è¦3ä¸ªå‚æ•°ï¼štarget ç›®çš„åœ°deceleration å‡é€Ÿç‡tolerance å®¹å·®å€¼const arriveBehavior = new YUKA.ArriveBehavior(target.position,1,3)vehicle.steering.add(arriveBehavior) yukaæ§åˆ¶ç‰©ä½“ç§»åŠ¨åˆ°é¼ æ ‡å¤„ æ§åˆ¶è§’è‰²ç§»åŠ¨åˆ°é¼ æ ‡ç‚¹å‡»å¤„çš„æ¸¸æˆæœ‰å¾ˆå¤šï¼Œä½¿ç”¨yukaçš„ArriveBehaviorï¼Œç»“åˆraycasterè·å–é¼ æ ‡åæ ‡ï¼Œå°±èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šç»™è¿½è¸ªè§’è‰²ç»‘å®šVehicleå®ä½“ç»™è¢«è¿½è¸ªç‰©ä½“ç»‘å®šGameEntityå®ä½“ç»‘å®šè¿½è¸ªå…³ç³»ï¼Œæ¿€æ´»å®ä½“ç®¡ç†å™¨åˆ›å»ºè¾…åŠ©å¹³é¢ï¼Œç›‘å¬é¼ æ ‡ç‚¹ä½ç‚¹å‡»å±å¹•ï¼Œåˆ‡æ¢è¢«è¿½è¸ªç‰©åæ ‡è¿™é‡Œç»™è¿½è¸ªçš„å¦å…‹æ¨¡å‹æ·»åŠ äº†ä¸€ä¸ªé¢ ç°¸åŠ¨ç”»ï¼Œç›´æ¥æ·»åŠ åˆ°vehicleæˆ–è€…targetä¸Šä¼šå¯¼è‡´è¿½è¸ªç‰©ä½“ä¸Šä¸‹ç¿»æ»šçš„é—®é¢˜ï¼Œè¿™é‡Œéœ€è¦ç»™vehicleå¤–å¥—ä¸€å±‚groupï¼Œä½¿ç”¨groupæ§åˆ¶ä¸Šä¸‹é¢ ç°¸æ•ˆæœï¼Œè¿½è¸ªç‰©ä½ç½®ä¾ç„¶ç”±vehicleæ§åˆ¶const gltfLoader = new GLTFLoader()const group = new THREE.Group()gltfLoader.load(/assets/Tank.gltf,gltf= gltf.scene.getObjectByName(Cylinder010_1).material.color.set(0x5d3c1d) gltf.scene.getObjectByName(Cylinder010_2).material.color.set(0xc3b598) gltf.scene.matrixAutoUpdate = false group.add(gltf.scene) scene.add(group) vehicle.setRenderComponent(gltf.scene, sync))const time = new YUKA.Time()function animate(t) let delta = time.update().getDelta() entityManager.update(delta) group.position.y = 0.05 * Math.sin(t/100) renderer.render(scene, camera); ç‰©ä½“é€ƒé¿ Flee BehaviorFleeBehavior FleeBehaviorçš„ç”¨æ³•å’Œå…¶ä»–è¡Œä¸ºç›¸ä¼¼ï¼Œéœ€è¦2ä¸ªå‚æ•°ï¼štargetpanicDistance è§„é¿èŒƒå›´const fleeBehavior = new YUKA.FleeBehavior(target.position,5)vehicle.steering.add(fleeBehavior) éšœç¢ç‰©è§„é¿ Orbstacle AvoidanceObstacleAvoidanceBehavior æ‰§è¡Œéšœç¢ç‰©è§„é¿ï¼Œéœ€è¦çŸ¥é“ä¸€äº›å…³é”®æ¡ä»¶ï¼šè§„é¿ä¸»ä½“çš„ç¢°æ’ä½“ç§¯è¢«è§„é¿ç‰©ä½“åˆ—è¡¨ï¼Œä»¥åŠå®ƒä»¬å¯¹åº”çš„ç¢°æ’ä½“ç§¯è®¡ç®—ç¢°æ’ä½“ç§¯éœ€è¦é…åˆThree.jsä¸­Geometryç±»å‹çš„computeBoundingSphereä¸€èµ·ä½¿ç”¨ã€‚const geo = new BoxGeometry(1,1,1)geo.computeBoundingSphere()const mat = new THREE.MeshBasicMaterial()const mesh = new THREE.Mesh(geo, mat)const vehicle = new YUKA.Vehicle()vehicle.setRenderComponent(mesh, sync)vehicle.boundingRadius = geo.boundingSphere.radiusæŒ‰ç…§ä¸Šé¢çš„è®¡ç®—æ–¹å¼ï¼Œè®¡ç®—å‡ºè§„é¿ç‰©å’Œéšœç¢ç‰©çš„ç¢°æ’ä½“ç§¯// ç¢°æ’ç‰©const vehicleGeo = new THREE.ConeBufferGeometry(0.2,0.8,8)vehicleGeo.computeBoundingSphere()vehicleGeo.rotateX(Math.PI/2)const vehicleMat = new THREE.MeshNormalMaterial()const vehicleMesh = new THREE.Mesh(vehicleGeo, vehicleMat)vehicleMesh.matrixAutoUpdate = falsescene.add(vehicleMesh)const vehicle = new YUKA.Vehicle()vehicle.setRenderComponent(vehicleMesh, sync)vehicle.boundingRadius = vehicleGeo.boundingSphere.radius// éšœç¢ç‰©const obstacleGeo = new THREE.BoxGeometry(1,1,1)obstacleGeo.computeBoundingSphere()const obstacleMesh = new THREE.Mesh( obstacleGeo, new THREE.MeshStandardMaterial(color:0xffaa00))const obstacleMesh1 = obstacleMesh.clone()obstacleMesh1.position.set(-7,0,0)scene.add(obstacleMesh1)const obstacle1 = new YUKA.GameEntity()obstacle1.position.copy(obstacleMesh1.position)obstacle1.boundingRadius = obstacleGeo.boundingSphere.radius// obstacle2...// obstacle3...æœ€ç»ˆç»‘å®šObstacleAvoidanceBehaviorconst obstacleAvoidanceBehavior = new YUKA.ObstacleAvoidanceBehavior([ obstacle1, obstacle2, obstacle3,])vehicle.steering.add(obstacleAvoidanceBehavior) å¼•å…¥çš„gltfæ¨¡å‹æ— æ³•ä½¿ç”¨getBoundingSphereæ–¹å¼ç›´æ¥è®¡ç®—åŒ…å›´ç›’ï¼ŒGPTè¯´å¯ä»¥éå†gltfçš„æ¯ä¸€ä¸ªnodeè®¡ç®—åŒ…å›´ç›’ï¼ˆå¬ä¸Šå»åƒä¸ªé¦Šä¸»æ„ï¼‰è¯•é”™è¯•å‡ºä¸€ä¸ªboundingRadiusä¹‹åï¼Œæ±½è½¦ç»•å¼€éšœç¢ç‰©çš„è½¨è¿¹éå¸¸åƒµç¡¬ï¼Œéœ€è¦å¢åŠ è¿è¡Œè½¨è¿¹çš„smoothç¨‹åº¦ï¼šconst smoother = new YUKA.Smoother(30)vehicle.smoother = smoother"},{"title":"ä½¿ç”¨yukaæ§åˆ¶å®ä½“è¿åŠ¨ï¼ˆäºŒï¼‰","path":"/wiki/ThreeJs/Wael_16_ä½¿ç”¨yukaæ§åˆ¶å®ä½“è¿åŠ¨2.html","content":"ç‰©ä½“æ¼«æ¸¸ WanderBehavioryuka.WanderBehavior èƒ½å¤Ÿå®ç°ç‰©ä½“æ¼«æ¸¸è¿åŠ¨æ¼«æ¸¸å±æ€§å¦‚ä¸‹ï¼šradius æ¼«æ¸¸åŠå¾„distance æ¼«æ¸¸åœ†åœˆæŠ•å°„åˆ°å®ä½“å‰æ–¹çš„è·ç¦»jitter æ¯å¸§æ²¿çƒé¢æœ€å¤§ä½ç§»é‡ï¼ˆæ²¡ææ‡‚è¿™ä¸‰ä¸ªé‡çš„å…³ç³»ï¼‰æ·»åŠ æ¼«æ¸¸è¡Œä¸ºconst wanderBehavior = new YUKA.WanderBehavior(3,10,10)vehicle.steering.add(wanderBehavior)è¿™é‡Œæåˆ°äº†Yuka.Vehicleç±»å®ä¾‹è¿›è¡Œæ—‹è½¬çš„æ–¹å¼ï¼švehicle.rotation.fromEuler(0, 2 * Math.PI * Math.random(), 0) é—®é¢˜ ä»å¤–ç•Œå¯¼å…¥çš„gltfæ¨¡å‹å°ºå¯¸ä¸åˆé€‚ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨scaleè¿›è¡Œç¼©æ”¾ï¼Œvehicle.scale = new YUKA.Vector3(0.01, 0.01, 0.01)ç¼©æ”¾ä¹‹åï¼ŒWonderBehaviorçš„å‚æ•°ä¼¼ä¹ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå¸¸è§çš„é—®é¢˜æ˜¯ï¼šåœ¨æ¨¡å‹ç¼©å°ä¹‹åï¼Œç‰©ä½“çš„æ¼«æ¸¸åŠå¾„è¿‡äºåºå¤§ï¼Œå¯¼è‡´æ¨¡å‹æœèµ·å§‹æ–¹å‘æ— é™æ¼«æ¸¸ã€‚è¿™ä¸ªé—®é¢˜ç›®å‰è¿˜æ²¡è§£å†³ã€‚ AnimationGroup å¯¹äºå¤§é‡éœ€è¦æ‰§è¡Œç›¸åŒåŠ¨ç”»çš„æ¨¡å‹ï¼Œæ¯”èµ·å¯¹æ¯ä¸ªæ¨¡å‹éƒ½åˆ›å»ºä¸€ä¸ªæ§åˆ¶åŠ¨ç”»çš„Mixerï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç»„AnimationGroupconst animationGroup = new THREE.AnimationObjectGroup()const mixer = new THREE.AnimationMixer(model)const action = mixer.clipAction( TRHEE.AnimationClip.findByName(originModel.animations,animate_name))action.play()for(let i = 0;i100;i++) const model = SkeletonUtils.clone(originModel) animationGroup.add(model) è¿½èµ¶è¡Œä¸º PursuitBehaviorPursuitè¿½èµ¶æ˜¯SeekBehaviorçš„å¦ä¸€ç§å½¢å¼ï¼ŒåŒºåˆ«åœ¨äºSeekè¡Œä¸ºä¸­ï¼Œè¿½éšç‰©ä½“ä¼šä¸¥æ ¼è·Ÿéšè¢«è¿½éšç‰©ä½“çš„è½¨è¿¹ï¼ŒPersuitè¡Œä¸ºä¸­è¿½éšç‰©ä½“ä¼šå¼•å…¥è½¨è¿¹é¢„æµ‹æœºåˆ¶ï¼Œæå‰è¿›è¡Œæ‹¦æˆªè¿½éšåŠ¨ä½œçš„æ·»åŠ ï¼šconst pursuitBehavior = new YUKA.PursuitBehavior(evader, 0)pursuit.steering.add(pursuitBehavior)ç›®æ ‡ç‰©ä½“çš„è½¨è¿¹ï¼šconst elapsed = time.getElapsed()target.x = Math.cos(elapsed) * Math.sin(elapsed * 0.2) * 6target.z = Math.sin(elapsed * 0.8) * 6PursuitBehaviorçš„ç¬¬äºŒä¸ªå‚æ•°predictionFactorç”¨äºæ§åˆ¶é¢„æµ‹çš„ç¨‹åº¦ã€‚predictionFactor=0æ—¶ï¼Œå°±ç›¸å½“äºSeekBehaviorpredictionFactor=5 ç‰©ä½“è·Ÿéš OffsetPursuitBehaviorç‰©ä½“è·Ÿéšä¸è¿½èµ¶çš„åŒºåˆ«åœ¨äºï¼šç‰©ä½“è·Ÿéšè€…ä¼šå’Œè¢«è·Ÿéšè€…ä¿æŒä¸€å®šçš„è·ç¦»ï¼Œæˆ–è€…è¯´æ˜¯ç›¸å¯¹è¢«è·Ÿéšè€…æœ‰ä¸€ä¸ªç›¸å¯¹åæ ‡ã€‚const offsetPursuitBehavior = new YUKA.OffsetPursuitBehavior(leader, offset)follower.steering.add(offsetPursuitBehavior)å¦‚æœè·Ÿéšè€…çš„é€Ÿåº¦è·Ÿä¸ä¸Šè·Ÿéšè€…ï¼Œå°±ä¼šå‡ºç°ç›¸å¯¹åæ ‡å˜å½¢çš„æƒ…å†µï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼å°±æ˜¯ç»™è·Ÿéšè€…ä¸€ä¸ªå¾ˆé«˜çš„é€Ÿåº¦ï¼Œèƒ½å¤Ÿå…è®¸å®ƒæ—¶åˆ»è·Ÿéšä¸Šleaderï¼Œå¹¶ä¿æŒç›¸å¯¹è·ç¦»ã€‚å˜å½¢æƒ…å†µè·Ÿéšç‰©ä½“åŠ é€Ÿé˜²æ­¢å˜å½¢ ç‰©ä½“å¹²é¢„ AlignmentCohesionSeparationä¹‹å‰åœ¨wanderBehavioræ¼«æ¸¸è¡Œä¸ºä¸­ï¼Œå®ç°äº†50ä¸ªå®ä½“è‡ªç”±æ¼«æ¸¸çš„æ•ˆæœï¼Œä½†æ˜¯è¿™50ä¸ªå®ä½“ç›¸äº’ä¹‹é—´æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œyukaä¸­æä¾›äº†ä¸€äº›å¯ä»¥ä½¿å®ä½“ä¹‹é—´ç›¸äº’å¹²é¢„çš„ç±»ï¼šAlignment åŒåŒ–èƒ½å¤Ÿå°†å®ä½“ä¸´è¿‘åœˆneightborhoodRadiusèŒƒå›´å†…çš„å…¶ä»–å®ä½“åŒåŒ–Cohesion èšåˆåŠ›Separation æ–¥åŠ›yukaçš„æ¯ç§behavioréƒ½å­˜åœ¨weightå±æ€§ï¼Œè¡¨ç¤ºåŠ›çš„æƒé‡ï¼Œæƒé‡è¶Šé«˜çš„behaviorå¯¹ç‰©ä½“è¿åŠ¨è½¨è¿¹çš„å½±å“è¶Šå¤§ã€‚è¦æƒ³åˆ›å»ºä¸€ä¸ªé›†ç¾¤å¼çš„å°¸ä½“ç¾¤è½ï¼Œä¸ªä½“ä¸ä¸ªä½“ä¹‹é—´éœ€è¦æ—¢æœ‰èšåˆåŠ›åˆæœ‰æ–¥åŠ›ï¼Œä¸ªä½“æ¼«æ¸¸ï¼Œæ•´ä½“åŒåŒ–ï¼Œå„ä¸ªåŠ›çš„æƒé‡å¦‚ä¸‹ï¼šconst alignmentBehavior = new YUKA.AlignmentBehavior()alignmentBehavior.weight = 2const cohesionBehavior = new YUKA.CohesionBehavior()cohesionBehavior.weight = 0.9const separationBehavior = new YUKA.SeparationBehavior()separationBehavior.weight = 0.2const wanderBehavior = new YUKA.WanderBehavior()wanderBehavior.weight = 0.8ä»¥ä¸Šçš„ä½œç”¨åŠ›çš„è®¡ç®—éƒ½éœ€è¦ä½¿ç”¨åˆ°å½±å“åŠ›åœˆè¿™ä¸ªæ¦‚å¿µï¼Œç›¸äº’ä½œç”¨åŠ›çš„æ•ˆæœä¼šéšç€å½±å“åŠ›åœˆçš„å˜å¤§è€Œå˜å¤§ã€‚vehicle.updateNeighborhood = truevehicle.neighborhoodRadius = 10é²¨é±¼è¿‡å¢ƒ ä¸­ç‚¹è¿½è¸ª InterposeBehaviorInterposBehavioréœ€è¦æŒ‡å®š2ä¸ªè¢«è¿½éšè€…ï¼Œè¿½éšç›®æ ‡ä¼šè½åœ¨è¿™ä¸¤è€…çš„ä¸­ç‚¹ä½ç½®ã€‚const interposeBehavior = new YUKA.InterposeBehavior(evader1, evader2)vehicle.steering.add(interposeBehavior) åˆ›å»ºå˜åŒ–çº¿æ®µ å˜åŒ–çº¿æ®µçš„é¡¶ç‚¹ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤åœ¨åˆ›å»ºGeometryçš„æ—¶å€™ï¼Œè¦ç”¨setFromPointsç•™å‡ ä¸ªç©ºç«¯ç‚¹ï¼šconst lineGeo = new THREE.BufferGeometry().setFromPoints([ new THREE.Vector3(), new THREE.Vector3()])const lineMat = new THREE.LineBasicMaterial( color: 0xffaa00 )const line = new THREE.Line(lineGeo, lineMat)scene.add(line)éœ€è¦æ”¹å˜ç«¯ç‚¹çš„æ—¶å€™ï¼Œéœ€è¦å°†çº¿æ®µçš„positionç¼“å†²åŒºå–å‡ºæ¥ï¼Œä½¿ç”¨setXYZå‡½æ•°ä¿®æ”¹é¡¶ç‚¹åæ ‡æ•°æ®ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºé¡¶ç‚¹çš„åºå·ï¼Œå…¶ä½™å‚æ•°åˆ†åˆ«è¡¨ç¤ºxyzï¼Œæœ€åéœ€è¦å°†needsUpdateèµ‹å€¼ä¸ºtrueï¼Œè¡¨ç¤ºæ›´æ–°const linePosition = line.geometry.attributes.positionlinePosition.setXYZ(0, evader1.position.x, 0, evader1.position.z)linePosition.setXYZ(1, evader2.position.x, 0, evader2.position.z)linePosition.needsUpdate = truerenderer.render(scene, camera);"},{"title":"ç»ç’ƒæè´¨","path":"/wiki/ThreeJs/Wael_18_glass_material.html","content":"ç»ç’ƒæè´¨çš„å…³é”®åœ¨äº2ç‚¹ï¼šé«˜åå°„ç‡é«˜é€æ˜åº¦æŠŠmetalnessæ‹‰åˆ°æœ€é«˜çš„é‡‘å±æè´¨å°½ç®¡æœ‰å¾ˆé«˜çš„åå°„ç‡ï¼Œä½†æ˜¯å¦‚æœåœ¨é‡‘å±æè´¨çš„åŸºç¡€ä¸Šæ‹‰ä½é€æ˜åº¦ï¼Œä¼šæŠŠè¡¨é¢åå°„çš„æ•ˆæœä¹Ÿå‡å¼±ã€‚åŠé€æ˜é‡‘å±è´¨åœ°MeshPhysicalMaterialæä¾›äº†å®ç°ç»ç’ƒæ•ˆæœçš„å‚æ•°transmission é€å…‰ç‡å’Œopacityçš„åŒºåˆ«åœ¨äºèƒ½å¤Ÿé™ä½é€æ˜åº¦çš„åŒæ—¶ä¸å‡å¼±åå°„æ•ˆæœioræŠ˜å°„ç‡å†³å®šæŠ˜å°„æ˜¾åƒæ¸…æ™°åº¦å€¼åœ¨1-2.33ä¹‹é—´"},{"title":"Controls æ§åˆ¶å™¨","path":"/wiki/ThreeJs/Wael_17_orbit_controls.html","content":"OrbitControlsèƒ½å¤Ÿæ§åˆ¶ç›¸æœºæ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»ï¼Œå…¶ä¸­æä¾›äº†ä¸å°‘å¯ä»¥ä¿®æ”¹çš„å‚æ•°ã€‚ï¼ˆæœ¬äººæ™•3dï¼ŒOrbitControlsè¿˜å¥½ï¼ŒFirstPersonControlså¼€å‘å¤ªè“ç˜¦äº†ï¼‰ OrbitControls è½¨é“æ§åˆ¶å™¨æ§åˆ¶å™¨å‚æ•°config é…ç½®å‚æ•°ä¸å°‘ï¼ŒThreejsé‡Œé¢ä¸å°‘APIéƒ½æ˜¯è¿™æ ·ï¼Œæƒ³ä¸èµ·æ¥å°±çœ‹ç¼–è¯‘å™¨æç¤ºæˆ–è€…å®˜æ–¹æ–‡æ¡£å®åœ¨ä¸è¡Œçœ‹æºç ä¹ŸæŒºå¥½ã€‚panSpeed å¹³ç§»é€Ÿåº¦rotateSpeed æ—‹è½¬é€Ÿåº¦maxDistance ç¼©æ”¾å¤§å°enablePan æ˜¯å¦å…è®¸å¹³ç§»enableDamping æ˜¯å¦å¼€å¯é˜»å°¼-ï¼ˆæ³¨æ„å¼€å¯ä¹‹åloopä¸­å¿…é¡»å¯¹æ§åˆ¶å™¨è¿›è¡Œupdateæ›´æ–°ï¼‰dampingFactor é˜»å°¼å¤§å°autoRotate è‡ªåŠ¨æ—‹è½¬autoRotateSpeed è‡ªåŠ¨æ—‹è½¬é€Ÿåº¦target ç„¦ç‚¹ç„¦ç‚¹å’Œç›¸æœºä½ç½®é‡å ä¼šå¯¼è‡´æ§åˆ¶å™¨å¤±æ•ˆä¹‹å‰å› ä¸ºä¸çŸ¥é“è¿™ä¸€ç‚¹èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œæ¼å•Šå¼€å¯é˜»å°¼ä¹‹åï¼Œç›¸æœºç§»åŠ¨ä¸æ»‘å¾ˆå¤š è‡ªå®šä¹‰æ§åˆ¶é”®æ§åˆ¶é”® é…ç½®é¼ æ ‡æ§åˆ¶å™¨ï¼šorbit.mouseButtons.LEFT = THREE.MOUSE.ROTATEorbit.mouseButtons.RIGHT = THREE.MOUSE.PANé”®ç›˜æ§åˆ¶å™¨ï¼ˆæ³¨æ„æœ€åéœ€è¦å°†ç›‘å¬å™¨æ·»åŠ åˆ°windowä¸Šï¼‰ï¼šorbit.keys = LEFT:ArrowLeft, UP:ArrowUp, RIGHT:KeyD, BOTTOM:KeySorbit.listenToKeyEvents(window)orbit.keyPanSpeed = 20 çŠ¶æ€ä¿å­˜saveState() çŠ¶æ€ä¿å­˜reset() çŠ¶æ€é‡ç½®è¯»å–window.onkeydown = e = if (e.code === KeyS) orbit.saveState() else if (e.code === KeyL) orbit.reset() é™åˆ¶æ°´å¹³æ–¹ä½è§’é™åˆ¶minAzimuthAnglemaxAzimuthAngleå‚ç›´æ–¹ä½è§’é™åˆ¶minPolarAnglemaxPolarAngle TrackballControls è½¨è¿¹çƒæ§åˆ¶å™¨https://threejs.org/examples/#misc_controls_trackballhttps://threejs.org/examples/#misc_controls_trackballTrackballControls å’Œ OrbitControls éå¸¸ç±»ä¼¼ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼Œä¸¤ç§æ§åˆ¶å™¨çš„ä¸åŒæ˜¯ TrackballControlsæ— æ³•æ’å®šä¿æŒæ‘„åƒæœºçš„upå‘é‡ï¼Œï¼ˆæ²¡çœ‹æ‡‚ï¼‰ä½†ä¸¤è€…çš„é€‚ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒï¼šOrbitControls é™æ€å¹³æ»‘çš„æ—‹è½¬æ•ˆæœï¼Œé€‚åˆç”¨æˆ·é€šè¿‡å¹³ç§»æ—‹è½¬ç­‰æ“ä½œï¼ŒæŸ¥çœ‹3dæ¨¡å‹TrackballControls ä½¿ç”¨éœ€è¦å¿«é€Ÿäº¤äº’å’ŒåŠ¨æ€æ—‹è½¬çš„åœºæ™¯ï¼Œç›¸æœºçš„ç§»åŠ¨ç›¸å¯¹å¹³æ»‘ä¹Ÿå¯ä»¥æŠŠä¸¤ä¸ªæ§åˆ¶å™¨ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ï¼šå¹³ç§»ã€ç¼©æ”¾ä½¿ç”¨ OrbitControlsæ—‹è½¬ä½¿ç”¨ TrackballControlsé¦–å…ˆéœ€è¦åˆ›å»ºä¸¤ä¸ªæ§åˆ¶å™¨ï¼šconst orbitControls = new OrbitControls(camera,renderer.domElement)orbitControls.enableDamping = trueorbitControls.dampingFactor = 0.12orbitControls.enableZoom = falseconst trackBallControls = new TrackballControls(camera, renderer.domElement)trackBallControls.noRotate = truetrackBallControls.noPan = truetrackBallControls.noZoom = falsetrackBallControls.zoomSpeed = 1.5åœ¨loopå‡½æ•°å†…éœ€è¦æ›´æ–°æ§åˆ¶å™¨ï¼šconst target = orbitControls.targetorbitControls.update()trackBallControls.target.set(target.x, target.y, target.z)trackBallControls.update() Cursor Following Camera Animation ç›¸æœºè·Ÿéšé¼ æ ‡æ»‘åŠ¨è¦åšå‡ºç›¸æœºè¿é•œçš„æ•ˆæœï¼Œéœ€è¦å¯¹ç›¸æœºè¿›è¡Œå¦‚ä¸‹ä¸€ç³»åˆ—å¤„ç†ï¼šæ ¹æ®é¼ æ ‡ç›¸å¯¹å±å¹•çš„ä½ç½®è®¡ç®—ç›¸æœºä½ç½®è®¡ç®—æ¯æ¬¡é¼ æ ‡ç›¸å¯¹å±å¹•ç§»åŠ¨çš„è·ç¦»ç¼©å°ç§»åŠ¨æ­¥é•¿ï¼Œèƒ½å¤Ÿæé«˜ç§»åŠ¨çš„å¹³æ»‘ç¨‹åº¦ç›¸æœºå§‹ç»ˆæœ›å‘ç„¦ç‚¹ç‰©ä½“ lookAtç›¸æœºåæ ‡deltaå€¼çš„è®¡ç®—ï¼šlet mouseX = 0;let mouseY = 0window.onmousemove = e= const windowHalfX = window.innerWidth / 2; const windowHalfY = window.innerHeight / 2; mouseX = (e.clientX - windowHalfX) / 100; mouseY = (e.clientY - windowHalfY) / 100;ç§»åŠ¨æ—¶ç¼©å°æ­¥é•¿ï¼Œä¿æŒç›¸æœºlookAtç„¦ç‚¹ç‰©ä½“çš„ä½ç½®ï¼šfunction animate() // ... camera.position.x += (mouseX - camera.position.x) * 0.05; camera.position.y += (-mouseY - camera.position.y) * 0.05; camera.lookAt(scene.position) renderer.render(scene, camera);"},{"title":"RenderPass && EffectComposer æ¸²æŸ“é€šé“å’Œç‰¹æ•ˆç»„åˆ","path":"/wiki/ThreeJs/Wael_19_effect_composer.html","content":"ç±»ä¼¼Photoshopç­‰åª’ä½“åæœŸè½¯ä»¶ï¼Œthreeä¸­ç‰¹æ•ˆçš„å åŠ ä¹Ÿå’Œå›¾å±‚æ§åˆ¶çš„æœºåˆ¶ç›¸ç±»ä¼¼ã€‚RenderPass åŸå§‹å›¾åƒå›¾å±‚åŸå§‹å›¾å±‚è¦æ”¾åœ¨æœ€åº•å±‚ï¼ˆç¬¬ä¸€ä¸ªåŠ å…¥é€šé“ï¼‰EffectComposer æ•ˆæœç»„åˆå™¨èƒ½å¤Ÿå°†ä¸åŒæ•ˆæœå›¾å±‚å åŠ åœ¨ä¸€èµ·æ¸²æŸ“æ•ˆæœå±‚åŠ å…¥çš„é¡ºåºä¼šå½±å“æœ€ç»ˆçš„æ¸²æŸ“ç»“æœè¦æ·»åŠ æ•ˆæœï¼Œé¦–å…ˆå°±éœ€è¦å°†åŸå§‹å›¾å±‚ä½œä¸ºå›¾å±‚åŠ å…¥é€šé“ã€‚import RenderPass from three/examples/jsm/postprocessing/RenderPassimport EffectComposer from three/examples/jsm/postprocessing/EffectComposerconst renderScene = new RenderPass(scene, camera)const effectComposer = new EffectComposer(renderer)effectComposer.addPass(renderScene)è¿˜éœ€è¦ä¿®æ”¹å¸¸è§„æ¯å¸§renderer.renderæ¸²æŸ“å‡½æ•°ï¼Œè¿™é‡ŒWael Yasminaæé†’è¯´ä½ç‰ˆæœ¬çš„threejsä¸æ”¯æŒåœ¨loopå‡½æ•°é‡Œç”¨effectComposeré‡æ¸²æŸ“ï¼Œæˆ‘è¯•äº†ä¸‹0.133.0ç‰ˆæœ¬çš„threejsï¼Œåº”è¯¥æ˜¯å¯ä»¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œéœ€è¦ä¿®æ”¹æ‰§è¡Œrenderçš„å¯¹è±¡ï¼Œä»renderæ”¹æˆeffectComposereffectComposer.render() è™šå¹»æ•ˆæœ|ç”µå½±æ•ˆæœ|æ¯›åˆºæ•ˆæœ"},{"title":"CANNON-Constraint çº¦æŸåŠ›","path":"/wiki/ThreeJs/Wael_20_lock_constraint.html","content":"Lock Constraintè¯´å®è¯ï¼Œå¬å®ŒWael Yasminaè®²çš„ä¹‹åï¼Œæˆ‘ä¹Ÿæ²¡å¼„æ˜ç™½åˆ°åº•ä»€ä¹ˆæ˜¯Lock Constraintï¼Œè§†é¢‘ä¸‹æ–¹ç›¸å…³çš„ä¸€äº›æ–‡ç« éƒ½æ˜¯å…¨è‹±æ–‡è®ºæ–‡ï¼ˆæ‚è„¸ï¼‰ï¼Œå®é™…æ“ä½œä¹‹åï¼Œconstraintä¼¼ä¹åƒæ˜¯ä¸€ç§é”é“¾å…³ç³»ï¼Œå°†ä¸¤ä¸ªç¦»æ•£çš„ç‰©ä½“ä½œä¸ºä¸€ä¸ªæ•´ä½“è®¡ç®—å—åŠ›æƒ…å†µã€‚Cannonä¸“é—¨æä¾›äº†ä¸€ä¸ªç±»ç”¨äºå®ç°Constraintï¼Œå°±æ˜¯LockConstraintï¼Œå®ä¾‹åŒ–æ—¶å¿…å¡«2ä¸ªå‚æ•°ï¼šå‚æ•°1ï¼šå½“å‰Bodyå‚æ•°2ï¼šå½“å‰Bodyå…·æœ‰é”å®šå…³ç³»çš„ä¸Šä¸€ä¸ªBodyå°†ä¸€è¿ä¸²ç‰©ä½“ä½¿ç”¨LockConstrainé”åœ¨ä¸€èµ·åï¼Œå®ƒä»¬å°†ä½œä¸ºä¸€ä¸ªæ•´ä½“å—åŠ›ï¼Œä½†åŒæ—¶æ•´ä½“çš„å„ä¸ªéƒ¨åˆ†ç›¸äº’ä¹‹é—´ä¹Ÿæœ‰åŠ›çš„ä½œç”¨ã€‚const world = new CANNON.World( gravity: new CANNON.Vec3(0, -9.81, 0))const size = 0.5const space = size * 0.1const N = 10const shape = new CANNON.Box(new CANNON.Vec3(size, size, size))const mass = 1const meshes = []const bodies = []const geo = new THREE.BoxGeometry(size * 2, size * 2, size * 2)const mat = new THREE.MeshBasicMaterial( color: 0xffaa00 )for (let i = 0; i N; i++) const boxBody = new CANNON.Body( shape, mass, position: new CANNON.Vec3((i - N / 2) * (size+space) * 2, 0, 0) // position: new CANNON.Vec3(-(N-i-N/2), 0, 0) ) world.addBody(boxBody) bodies.push(boxBody) const boxMesh = new THREE.Mesh(geo, mat) scene.add(boxMesh) meshes.push(boxMesh) if (i 0) const lockConstraint = new CANNON.LockConstraint(boxBody, bodies[i - 1]) world.addConstraint(lockConstraint) const leftFlatMesh = new THREE.Mesh(geo, mat)scene.add(leftFlatMesh)meshes.push(leftFlatMesh)const leftFlatBody = new CANNON.Body( shape, type: CANNON.BODY_TYPES.STATIC, position:new CANNON.Vec3(-N*(size+space),-3,0))world.addBody(leftFlatBody)bodies.push(leftFlatBody)const rightFlatMesh = new THREE.Mesh(geo, mat)scene.add(rightFlatMesh)meshes.push(rightFlatMesh)const rightFlatBody = new CANNON.Body( shape, type: CANNON.BODY_TYPES.STATIC, position:new CANNON.Vec3((N-1 - N / 2) * (size+space) * 2,-3,0))world.addBody(rightFlatBody)bodies.push(rightFlatBody)function animate() world.step(1 / 60) for (let i = 0; i meshes.length; i++) meshes[i].position.copy(bodies[i].position) meshes[i].quaternion.copy(bodies[i].quaternion) renderer.render(scene, camera)renderer.setAnimationLoop(animate) Distance Constraint Constrains two bodies to be at a constant distance from each others center of mass. DistanceConstrainçš„åŠŸèƒ½æ˜¯å°†ä¸¤ä¸ªbodyä¿æŒå›ºå®šè·ç¦»çº¦æŸåœ¨ä¸€èµ·ã€‚å®ä¾‹åŒ–CANNON.DistanceConstrainéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼šbodyAbodyBdistanceä¸ºäº†åˆ¶ä½œä¸€ä¸ªç”±15Ã—15ä¸ªå°çƒç»„æˆçš„çŸ©å½¢ç½‘æ ¼ï¼Œé¦–å…ˆéœ€è¦åˆ›å»º15Ã—15ä¸ªbodyï¼Œæ¥ç€å¯¹è¿™äº›bodyè¿›è¡Œå…³è”ã€‚ä½¿ç”¨çŸ©é˜µè¡Œåˆ—ç´¢å¼•å“ˆå¸Œè¡¨å­˜å‚¨æ•°æ®ï¼Œåœ¨å…³è”æ—¶ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚const row = 15const col = 15const size = 0.2const space = 0.05const ballMeshes = []const ballBodies = []const ballGeo = new THREE.SphereGeometry(size)const ballMat = new THREE.MeshBasicMaterial( color: 0xffaa00 )const particles = for (let i = 0; i row; i++) for (let j = 0; j col; j++) const ballMesh = new THREE.Mesh(ballGeo, ballMat) ballMeshes.push(ballMesh) const x = (i - row / 2) * (size * 2 + space) + size const z = (j - col / 2) * (size * 2 + space) + size scene.add(ballMesh) const body = new CANNON.Body( shape: new CANNON.Sphere(size), position: new CANNON.Vec3(x, 5, z), mass: 1 ) world.addBody(body) ballBodies.push(body) particles[`$i $j`] = body function connect(i1, j1, i2, j2) const distanceConstrain = new CANNON.DistanceConstraint( particles[`$i1 $j1`], particles[`$i2 $j2`], space*10 ) world.addConstraint(distanceConstrain)for (let i = 0; i row; i++) for (let j = 0; j col; j++) if (i row - 1) connect(i, j, i + 1, j) if (j col - 1) connect(i, j, i, j + 1) Cloth Simulate æ¨¡æ‹Ÿå¸ƒæ–™å’Œä¸Šä¸€éƒ¨åˆ† Distance Constraint çš„åŸç†ç›¸ä¼¼ï¼Œä¸€å—æ–¹å½¢çš„å¸ƒæ–™å¯ä»¥çœ‹åšä¸€å—çŸ©é˜µï¼ŒçŸ©é˜µçš„ç›¸é‚»å…ƒç´ ä¹‹é—´å­˜åœ¨Distance Constrainå…³ç³»ã€‚è¿™é‡Œç»„æˆçŸ©é˜µçš„bodyä½¿ç”¨CANNON.Particleç±»ã€‚ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºå¸ƒæ–™å®ä½“ï¼ŒæŒ‰ç…§å¸ƒæ–™çŸ©é˜µçš„è¡Œåˆ—é¡¶ç‚¹æ•°é…ç½®segments:const clothGeo = new THREE.PlaneGeometry(1, 1, row, col)const clothMaterial = new THREE.MeshBasicMaterial( side: THREE.DoubleSide, // ä¸ºå¸ƒæ–™æ·»åŠ çº¹ç† map:new THREE.TextureLoader().load(/assets/jean-philippe-delberghe-75xPHEQBmvA-unsplash.jpg))const clothMesh = new THREE.Mesh(clothGeo, clothMaterial)scene.add(clothMesh)ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºbodyçŸ©é˜µï¼Œæ³¨æ„ï¼šnÃ—måˆ†æ®µçš„geometryä¸Šå®é™…ä¸Šæœ‰(n+1)*(m+1)ä¸ªé¡¶ç‚¹for (let i = 0; i row + 1; i++) const vec = [] for (let j = 0; j col + 1; j++) const body = new CANNON.Body( shape, mass:j==col?0:mass, position: new CANNON.Vec3((i - row / 2) * dist, (j - col / 2) * dist, 0), velocity:new CANNON.Vec3(0,-0.1*(col-j)) ) world.addBody(body) vec.push(body) bodies.push(vec)ç¬¬ä¸‰æ­¥ï¼Œä¸ºbodyçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ æ¡ä»¶constraintæ¡ä»¶ï¼šfunction createConstraint(i1, j1, i2, j2) const constraint = new CANNON.DistanceConstraint( bodies[i1][j1], bodies[i2][j2], dist ) world.addConstraint(constraint)for (let i = 0; i = row; i++) for (let j = 0; j = col; j++) if (i row) createConstraint(i, j, i + 1, j) if (j col) createConstraint(i, j, i, j + 1) ç¬¬å››æ­¥ï¼Œåˆ›å»ºå¸ƒæ–™åŒæ­¥å‡½æ•°ï¼Œåœ¨loopå‡½æ•°ä¸­ä¼šé€å¸§è°ƒç”¨æ¯æ¬¡åˆ·æ–°å¸ƒæ–™geometryä¸­attrç±»å‹å˜é‡positionçš„å¯¹åº”é¡¶ç‚¹function updatePosition() for (let i = 0; i = row; i++) for (let j = 0; j = col; j++) const index = i * (row + 1) + j const position = clothGeo.attributes.position const bodyPosition = bodies[i][j].position position.setXYZ(index, bodyPosition.x, bodyPosition.y, bodyPosition.z) position.needsUpdate = true ç¬¬äº”æ­¥ï¼Œåˆ›å»ºçƒå½¢const sphereGeo = new THREE.SphereGeometry(radius)const sphereMat = new THREE.MeshPhysicalMaterial()const sphere = new THREE.Mesh(sphereGeo, sphereMat)scene.add(sphere)const sphereBody = new CANNON.Body( shape: new CANNON.Sphere(radius*1.3), type: CANNON.BODY_TYPES.STATIC)world.addBody(sphereBody)ç¬¬å…­æ­¥ã€å¯åŠ¨åŠ¨ç”»å¸§const timeStep = 1 / 60function animate(time) world.step(timeStep) updatePosition() sphereBody.position.set( radius * Math.sin(time / 1000), 0, radius * Math.cos(time / 1000), ) sphere.position.copy(sphereBody.position) renderer.render(scene, camera);"},{"title":"CSS2DRenderer","path":"/wiki/ThreeJs/Wael_21_css_renderer.html","content":"CSS2DRendererä½¿ç”¨CSSRendererå¯ä»¥æ¸²æŸ“htmlæ ‡ç­¾åˆ°3Dåœºæ™¯ä¸­ï¼Œå¯¹domå…ƒç´ è¿›è¡Œå¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ç­‰å˜æ¢ï¼Œä¸»è¦æ˜¯é€šè¿‡cssä¸­çš„transformå±æ€§ã€‚æœ‰ä¸¤ç§ç±»å‹çš„CSSRendererï¼šCSS2DRenderer 2ç»´å˜åŒ–CSS3DRenderer3ç»´å˜åŒ–æç¤ºå› ä¸ºCSSRendererä¸»è¦æ˜¯å¯¹domçš„transformå±æ€§è¿›è¡Œå˜åŒ–ï¼Œå› æ­¤å°½é‡åœ¨æ¯ä¸ªæ¸²æŸ“å…ƒç´ å¤–å†åŒ…ä¸€å±‚domï¼Œé˜²æ­¢è‡ªå®šä¹‰çš„transformå±æ€§è¢«è¦†ç›–ã€‚const inner = document.createElement(div)const outer = document.createElement(div)outer.appendChild(innter)const obj = new CSS2DRenderer(outer)CSSRenderçš„ä½¿ç”¨å’ŒWebGLRenderä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºCSSRendererå†…çš„Object æ— æ³•å—åˆ°å…‰ç…§çš„å½±å“ ã€‚CSSRendererçš„åˆ›å»ºï¼šconst cssRenderer = new CSS2DRenderer()cssRenderer.setSize( window.innerWidth, window.innerHeight)document.body.append(cssRenderer.domElement)Loopå‡½æ•°ä¸­æ›´æ–°ï¼šcssRenderer.render(scene,camera)"},{"title":"Instenced Mesh å®ä¾‹åŒ–ç½‘æ ¼","path":"/wiki/ThreeJs/Wael_22_instanced_mesh.html","content":"æ¸²æŸ“å¤§é‡ç½‘æ ¼æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜Render Call åœ¨ä½¿ç”¨threejsåœ¨åœºæ™¯ä¸­ç»˜åˆ¶å‡ºä¸€ä¸ªå®ä½“æ—¶ï¼Œthreejså®é™…åœ¨åå°å¸®æˆ‘ä»¬ç•¥å»äº†å¾ˆå¤šå¤æ‚çš„ç»˜å›¾æ“ä½œã€‚è¿™äº›æ“ä½œä¸­åŒ…æ‹¬æ¯”è¾ƒå…³é”®çš„æ­¥éª¤ï¼šCPUä¸GPUä¹‹é—´çš„é€šä¿¡ã€‚CPUå‘å‡ºç»˜å›¾æŒ‡ä»¤ï¼ŒGPUè´Ÿè´£æ‰§è¡Œç»˜å›¾ã€‚åœºæ™¯ä¸­æœ‰Nä¸ªå®ä½“ï¼Œè¿™ç§é€šä¿¡å°±è¦æ‰§è¡ŒNæ¬¡ã€‚å¦‚æœç»˜åˆ¶çš„å›¾å½¢å¦‚æœå…·æœ‰ç›¸åŒçš„Geometryå’ŒMaterialï¼Œè¿™æ ·çš„æ“ä½œå¦‚æœæ‰§è¡ŒNæ¬¡ä¼šå¯¼è‡´æ¸²æŸ“æ•ˆç‡ä½ä¸‹ã€‚å°±å¥½åƒä½ è¦æŠŠåŒä¸€æ¡çŸ­ä¿¡å‘ç»™å¥½å‡ ä¸ªäººï¼Œå¦‚æœä¸€ä¸ªä¸€ä¸ªå‘æ•ˆç‡è‡ªç„¶ä¼šå¾ˆä½ä¸‹ã€‚ InstancedMeshTHREE.InstancedMeshèƒ½å¤Ÿä¸€æ¬¡æ€§åˆ›å»ºNä¸ªå…·æœ‰ç›¸åŒGeoå’ŒMatçš„å®ä½“ï¼Œæ— éœ€å†ä½¿ç”¨forå¾ªç¯Næ¬¡ã€‚let mesh = new THREE.InstancedMesh(geo, mat, count)InstancedMeshä¸­æä¾›äº†ä¿®æ”¹å†…éƒ¨å®ä¾‹çš„å˜æ¢çŸ©é˜µ å’Œ é¢œè‰²çš„æ¥å£ï¼šmatrixInstancedMesh.setMatrixAt(index,matrix)æ³¨æ„setMatrixAtè°ƒç”¨è¿‡åï¼Œéœ€è¦å°†InstancedMesh.instanceMatrix.needsUpdateæ”¹ä¸ºtrueï¼Œæ›´æ–°çŸ©é˜µInstancedMesh.getMatrixAt(index,matrix)colorInstancedMesh.setColorAt(index, THREE.Color)åŒæ ·çš„éœ€è¦å†ä¹‹åå°†InstancedMesh.instanceColor.needsUpdateä¿®æ”¹ä¸ºtruemesh.setMatrixAt(i, dummy.matrix)mesh.instanceMatrix.needsUpdate = truemesh.setColorAt(i,new THREE.Color(Math.random()*0xffffff))mesh.instanceColor.needsUpdate = trueå¦‚æœåœ¨loopå‡½æ•°ä¸­ï¼Œéœ€è¦è·å–meshå†…å®ä¾‹çš„æ¨¡å‹çŸ©é˜µçš„å„ä¸ªåˆ†é‡ï¼ˆæ—‹è½¬ã€å¹³ç§»ã€ç¼©æ”¾ï¼‰ï¼Œå¯ä»¥ç”¨Matrix4.decomposeæ‹†è§£å®ä¾‹çš„æ¨¡å‹çŸ©é˜µmatrixï¼šconst matrix = new THREE.Matrix4() // ç©ºçŸ©é˜µmesh.getMatrixAt(i, matrix) // è·å–meshå†…ç¬¬iä¸ªå®ä¾‹çš„matrixmatrix.decompose(dummy.position, dummy.rotation, dummy.scale) // æ‹†è§£"},{"title":"colorWrite && renderOrder","path":"/wiki/ThreeJs/Wael_24_object_occlusion.html","content":"colorWrite renderOrdercolorWriteæè´¨ä¸Šçš„ä¸€ä¸ªå¸ƒå°”å€¼å±æ€§ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦ç»˜åˆ¶æè´¨çš„é¢œè‰²ã€‚å½“colorWriteä¸ºfalseæ—¶ï¼Œç»˜åˆ¶çš„ç‰©ä½“æè´¨å°†ä»èƒŒæ™¯ä¸­å–è‰²ï¼ŒrenderOrderæ§åˆ¶ç‰©ä½“ç»˜åˆ¶çš„å±‚çº§ï¼Œç»˜åˆ¶é¡ºåºä¸ºï¼šä½å±‚çº§â†’é«˜å±‚çº§ç»˜åˆ¶é¡ºåºå†³å®šäº†é€æ˜ç‰©ä½“è¢«ç»˜åˆ¶å‡ºæ¥æ—¶ï¼ŒèƒŒæ™¯ç»˜åˆ¶çš„æƒ…å†µï¼Œå¦‚æœåæ–¹ç‰©ä½“å…ˆäºé€æ˜ç‰©ä½“ç»˜åˆ¶ï¼Œå…ˆç»˜åˆ¶çš„ç‰©ä½“ä¼šæˆä¸ºèƒŒæ™¯çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœåæ–¹ç‰©ä½“åäºé€æ˜ç‰©ä½“ç»˜åˆ¶ï¼Œåˆ™åæ–¹ç‰©ä½“åˆ™ä¼šè¢«å®Œå…¨é®æŒ¡ã€‚plane1Mesh.renderOrder = 2plane2Mesh.renderOrder = 1ringMesh.renderOrder = 0plane1Mesh.renderOrder = 0plane2Mesh.renderOrder = 2ringMesh.renderOrder = 1 æ§åˆ¶gltfæ¨¡å‹çš„renderOrderè¿™ä¸€æ­¥å’Œå¼€å¯gltfæ¨¡å‹é˜´å½±éå¸¸ç›¸ä¼¼ï¼Œç”¨åˆ°çš„æ˜¯traverseæ–¹æ³•ï¼šmodel.traverse(m= if(m.isObject3D)m.castShadow = true if(m.isMesh)m.renderOrder = 2)é€šè¿‡åœ¨é—¨çš„å·¦å³ä¸¤ä¾§é˜²æ­¢é®ç½©ç‰©ä½“çš„æ–¹å¼ï¼Œèƒ½å¤Ÿå®ç°è§’è‰²ç©¿è¿‡é—¨åæ¶ˆå¤±çš„æ•ˆæœä½†æ˜¯è¿™ç§é®ç½©çš„æ•ˆæœå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæ— æ³•é®ç›–ä½ç‰©ä½“çš„å½±å­ï¼ˆä»€ä¹ˆé¬¼æ•…äº‹ï¼‰"},{"title":"DRACOLoader","path":"/wiki/ThreeJs/Wael_23_draco_loader.html","content":"DRACOLoaderæœ‰æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¼•å…¥ä¸€äº›å¾ˆå¤§çš„æ¨¡å‹ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†æ€§èƒ½ä¼šå¾ˆä½ï¼Œå¯ä»¥åœ¨ä½¿ç”¨Blenderå¯¼å‡ºæ¨¡å‹æ—¶è¿›è¡Œå‹ç¼©ï¼šå³ä¾§èœå•æ DataCompressionå‹ç¼©è¿‡çš„æ¨¡å‹åœ¨threeJsä¸­åŠ è½½æ—¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨GLTFLoaderè¿›è¡ŒåŠ è½½ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨GLTFLoaderåŠ è½½Dracoå‹ç¼©æ¨¡å‹ï¼Œä¼šæŠ¥é”™ï¼šNo DRACOLoader instance provided.éœ€è¦å¼•å…¥å¦ä¸€ä¸ªå‹ç¼©æ¨¡å‹çš„åŠ è½½å™¨ï¼šDRACOLoaderï¼Œç”¨åˆ°DRACOLoaderæ—¶ï¼Œé‡åˆ°äº†ä¸å°‘å‘ å‘1ï¼šDRACOLoaderåŠ è½½æ¨¡å‹å¿…é¡»ç»è¿‡dracoå‹ç¼© å¦‚æœåŠ è½½æœªç»è¿‡dracoå‹ç¼©çš„æ¨¡å‹ï¼Œä¼šæŠ¥é”™ï¼Œæˆ‘åŸæœ¬ç†è§£é”™è¯¯ï¼Œä»¥ä¸ºå¯¹æ¨¡å‹å‹ç¼©çš„æ­¥éª¤æ˜¯åœ¨Loaderè¿‡ç¨‹ä¸­å®ç°çš„ï¼Œå®é™…ä¸Šå‹ç¼©æ¨¡å‹éœ€è¦åœ¨Blenderé‡Œé¢å®Œæˆï¼ŒDRACOLoaderåªæ˜¯é’ˆå¯¹å‹ç¼©æ¨¡å‹çš„ä¸€ä¸ªåŠ è½½å™¨ã€‚ å‘2ï¼šè§£ææ–‡ä»¶è·¯å¾„é…ç½® ç½‘ä¸Šæœ‰ä¸å°‘åœ°æ–¹è¯´é…ç½®è·¯å¾„å¯ä»¥é€šè¿‡å¤åˆ¶draco gitä»“åº“çš„readmeæ–‡æ¡£ä¸­æä¾›çš„urlå®ç°ï¼šdLoader.setDecoderPath(https://www.gstatic.com/draco/versioned/decoders/1.5.7/)ä¸€å¼€å§‹æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆé…ç½®çš„ï¼Œä½†æ˜¯æ¯”è¾ƒäº†ä¸€ä¸‹æ¨¡å‹çš„åŠ è½½é€Ÿåº¦ï¼Œå¥½åƒæ²¡æœ‰å¤šå¤§å˜åŒ–ï¼Œæˆ‘ä»¥ä¸ºæ˜¯è·¯å¾„é…ç½®é”™è¯¯ï¼Œäºæ˜¯å°±å¼€å§‹ä¸‹é¢ä¸€é”™å†é”™çš„ç—›è‹¦ç»å†ï¼šthreejsä¸­çš„DRACOLoaderç±»è¦è§£æå‹ç¼©æ¨¡å‹éœ€è¦å‡ ä¸ªå…³é”®è§£ææ–‡ä»¶ï¼šdraco_decoder.js Emscripten-compiled decoderdraco_decoder.wasm WebAssembly decoderdraco_wasm_wrapper.js JavaScript wrapperå¥½çš„æˆ‘å·²ç»çœ‹ä¸æ‡‚äº†ï¼Œåæ­£ä¸‰ä¸ªéƒ½æ˜¯è§£ç å™¨ã€‚æ€»ä¹‹DRACOLoaderçš„decoderPathè§£ç è·¯å¾„åªè¦æŒ‡å‘è¿™ä¸‰ä¸ªæ–‡ä»¶å°±è¡Œäº†ï¼Œåœ¨åŒ…ç®¡ç†å™¨ä¸­ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼šthreeexamplesjsmlibsdracoé‚£æ˜¯ä¸æ˜¯æŠŠè§£ç å™¨è·¯å¾„é…ç½®æˆä¸Šé¢è¿™ä¸ªå°±è¡Œäº†ï¼ŸdLoader.setDecoderPath(/examples/jsm/libs/draco/)è¿˜æ˜¯æŠ¥é”™ï¼šUncaught SyntaxError: Unexpected token â€˜â€™ (at f11573a6-dd88-4e61-930c-e24ebf877308:2:1)æŠ¥çš„æ˜¯è¯­æ³•é”™è¯¯ï¼Œè¯´æ˜è§£ææœ‰é—®é¢˜ï¼Œè§£ææ–‡ä»¶æ²¡æœ‰è·å–åˆ°ã€‚åœ¨ç½‘ä¸Šç¿»åˆ°äº†è¿™ç¯‡åšæ–‡ï¼šhttps://juejin.cn/post/7072701904291102728https://juejin.cn/post/7072701904291102728æŠŠåˆšæ‰çš„dracoæ–‡ä»¶ç§»åŠ¨åˆ°publicæ–‡ä»¶å¤¹ï¼Œåœ¨æµè§ˆå™¨ç«¯è¿è¡Œæ—¶å¯ä»¥è·å–åˆ°ï¼Œdracoæ¨¡å‹æ­£å¸¸åŠ è½½ï¼šconst loader = new GLTFLoader()const dLoader = new DRACOLoader()dLoader.setDecoderPath(public/draco/)dLoader.setDecoderConfig(type:js)loader.setDRACOLoader(dLoader)loader.load(assets/lamborghini_centenario_roadster_sdc.glb,gltf= scene.add(gltf.scene) gltf.scene.traverse(model=model.castShadow = true))"},{"title":"LOD","path":"/wiki/ThreeJs/Wael_25_LOD.html","content":"LODLODå…¨ç§°Level of Detailï¼Œèƒ½å¤Ÿæ ¹æ®ç›¸æœºä¸ç‰©ä½“çš„è·ç¦»åŠ è½½ä¸åŒçš„æ¨¡å‹ï¼Œæ˜¯ä¸€ç§æ¨¡å‹åŠ è½½çš„å¸¸ç”¨ä¼˜åŒ–æ–¹å¼ã€‚ç‰©ä½“æ¸²æŸ“çš„æ€§èƒ½ä¸ç½‘æ ¼çš„é¡¶ç‚¹æ•°é‡ç­‰æ•°å€¼æœ‰å…³ï¼Œå› æ­¤å½“ç›¸æœºè§†è§’æ‹‰è¿œæ—¶ï¼Œå¯ä»¥å±•ç¤ºç»†èŠ‚æ›´å°‘çš„æ¨¡å‹ï¼Œåä¹‹å½“ç›¸æœºè§†è§’æ‹‰è¿‘ï¼Œå±•ç¤ºç»†èŠ‚æ›´å¤šçš„æ¨¡å‹ã€‚let lod = new THREE.LOD()scene.add(lod)loader.load(assets/cactus/Cactus_01.glb,gltf= // è·ç¦»0å¤„çš„æ¨¡å‹ lod.addLevel(addGLTFModel(gltf), 0))loader.load(assets/cactus/Cactus_02.glb,gltf= // è·ç¦»3å¤„çš„æ¨¡å‹ lod.addLevel(addGLTFModel(gltf), 3))loader.load(assets/cactus/Cactus_1.glb,gltf= // è·ç¦»6å¤„çš„æ¨¡å‹ lod.addLevel(addGLTFModel(gltf), 6))"},{"title":"Gimbal Lock","path":"/wiki/ThreeJs/Wael_26_Gimbal_Lock.html","content":"Gimbal Lockç¯æ¶é”å®š https://en.wikipedia.org/wiki/Gimbal_lockhttps://en.wikipedia.org/wiki/Gimbal_lockä¸‰ç»´ç‰©ä½“æ—‹è½¬æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œå…¶ä¸­æœ‰ä¸€ç§å«åšæ¬§æ‹‰è§’çš„æ–¹å¼ï¼Œå…¶ç‰¹ç‚¹å°±æ˜¯å°†ä¸€æ¬¡æ—‹è½¬åˆ†ä¸º3æ¬¡æ—‹è½¬ï¼Œè¿™ä¸‰æ¬¡æ—‹å¯ä»¥æ˜¯XYZã€XZYã€ZYXâ€¦â€¦ç­‰ç­‰é¡ºåºï¼Œè¿™ä¸ªä¸é‡è¦ï¼Œä½†æ˜¯ç¬¬ä¸€æ¬¡æ—‹è½¬çš„é‚£ä¸ªè½´æ€»æ˜¯ä¸–ç•Œåæ ‡è½´ï¼Œä¹Ÿå°±æ˜¯ä¸å˜çš„ï¼Œæ—‹è½¬è§’åº¦ç§°ä¸ºé™æ€æ¬§æ‹‰è§’é™æ€æ¬§æ‹‰è§’å…¶ä½™çš„ä¸¤æ¬¡æ—‹è½¬åˆ™æ˜¯ç›¸å¯¹ç‰©ä½“è‡ªèº«çš„åæ ‡è½´ï¼Œæ—‹è½¬è§’åº¦ç§°ä¸ºåŠ¨æ€æ¬§æ‹‰è§’åŠ¨æ€æ¬§æ‹‰è§’ä¸ç»´åº¦é‡å åŒºåˆ«å°±æ˜¯ï¼šåŠ¨æ€æ¬§æ‹‰è§’åæ ‡ç³»æ—‹è½¬æ—¶ï¼Œå…¶ä½™ä¸¤ä¸ªåæ ‡ç³»éƒ½ä¼šéšç‰©ä½“è½¬åŠ¨è€Œè½¬åŠ¨ï¼Œè€Œé™æ€æ¬§æ‹‰è§’è½¬åŠ¨æ—¶åˆ™ä¸ä¼šã€‚å‡è®¾ä¸‰ä¸ªè½´æ—‹è½¬çš„é¡ºåºæ˜¯ABCï¼ŒAè½´ä½œä¸ºç¬¬ä¸€ä¸ªæ—‹è½¬è½´ï¼Œå…¶ä½¿ç”¨é™æ€æ¬§æ‹‰è§’æ—‹è½¬ï¼Œæ—‹è½¬æ—¶BCåæ ‡è½´ä¸å˜ï¼ŒBè½´æ—‹è½¬æ—¶ï¼Œä¸ºäº†ä¿è¯Aè½´åˆšæ‰çš„æ—‹è½¬ä¸ä¸¢å¤±ï¼ŒAè½´ä¹Ÿä¼šéšç‰©ä½“ä¸€èµ·æ—‹è½¬ï¼Œä½†Cè½´ä¸å˜Cæ—‹è½¬æ—¶ï¼Œä¸ºäº†ä¿è¯ABæ—‹è½¬è§’åº¦ä¸ä¸¢å¤±ï¼ŒABéƒ½ä¼šéšç‰©ä½“ä¸€èµ·æ—‹è½¬ï¼Œä½†æ˜¯Cè½´æœ¬èº«æ˜¯é™æ­¢çš„ï¼Œèƒ½å¤Ÿæ—‹è½¬çš„åªæœ‰ABè½´è€Œå·²ï¼Œä¸‡å‘é”é—®é¢˜å‡ºç°åœ¨ç¬¬äºŒæ­¥ï¼šBè½´å¸¦åŠ¨Aè½´è½¬åŠ¨ä¸Šï¼Œè¿™æ—¶å¦‚æœBè½´è½¬åŠ¨çš„è§’åº¦æ˜¯Â±90Â°ï¼Œä¼šå¯¼è‡´BCè½´é‡å ï¼Œé€ æˆç»´åº¦ä¸¢å¤±çš„é—®é¢˜ã€‚ ä¸‡å‘é”çš„è§£å†³æ–¹å¼å››å…ƒç»„ é€šè¿‡å››å…ƒç»„æ—‹è½¬ç‰©ä½“ï¼Œå¯ä»¥è§£å†³ä¸‡å‘é”ã€‚https://zh.wikipedia.org/wiki/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AChttps://zh.wikipedia.org/wiki/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC// XYZæ¨¡å¼ä¸‹ æ²¿Yã€Zè½´çš„æ—‹è½¬const quaternionY = new THREE.Quaternion()quaternionY.setFromAxisAngle(new THREE.Vector3(0,1,0).normalize(),Math.PI/2)cloneMonkey.applyQuaternion(quaternionY)const quaternionZ = new THREE.Quaternion()quaternionZ.setFromAxisAngle(new THREE.Vector3(0,0,1).normalize(),Math.PI/2)cloneMonkey.applyQuaternion(quaternionZ) å››å…ƒç»„çš„å…¶ä»–ç”¨æ³• åŒæ—¶å››å…ƒç»„è¿˜å¯ä»¥ç”¨æ¥å®ç°ç‰©ä½“æ²¿ä»»æ„ï¼ˆè€Œéåæ ‡è½´ï¼‰è½´çº¿æ—‹è½¬çš„åŠŸèƒ½ï¼šå·¦ä¾§ä¸ºå››å…ƒç»„æ—‹è½¬ï¼Œå³ä¾§ä¸ºæ¬§æ‹‰æ—‹è½¬å¦‚æœå°†æ—‹è½¬æ•ˆæœåº”ç”¨åˆ°positionè€Œä¸æ˜¯rotationä¸Šï¼Œèƒ½å¤Ÿå®ç°å›´ç»•ä¸–ç•Œåæ ‡ç³»æ—‹è½¬çš„æ•ˆæœï¼šconst quaternionO = new THREE.Quaternion() .setFromAxisAngle(new THREE.Vector3(0,1,0).normalize(), 0.01)model.position.applyQuaternion(quaternionO)ç›¸æœºçš„æ—‹è½¬ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼šfunction rotateCamera() const quaternionO = new THREE.Quaternion() quaternionO.setFromAxisAngle(new THREE.Vector3(0,1,0).normalize(), -0.01) camera.position.applyQuaternion(quaternionO) camera.lookAt(0,0,0) rotateTowards slerpsetFromAxisAngleå¯ä»¥é€šè¿‡æŒ‡å®šåæ ‡è½´å’Œæ—‹è½¬è§’æ¥é…ç½®å››å…ƒç»„ï¼ŒrotateTowardséœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šq Quaternionç±»å‹step Floatç±»å‹å¯ä»¥å°†å½“å‰çš„quaternionæŒ‰ç…§stepé€æ­¥ç§»åŠ¨æ¥è¿‘æœ€ç»ˆçš„qæ•°å€¼ï¼šcube.quaternion.rotateTowards(cube2.quaternion, 0.01)ä½¿ç”¨slerpä¹Ÿæ˜¯ç›¸åŒçš„æ–¹å¼ï¼šcube.quaternion.slerp(cube2.quaternion, 0.1)slerpçš„ç¬¬äºŒä¸ªå‚æ•°æ§åˆ¶å•æ¬¡æ—‹è½¬é‡ï¼Œèƒ½å®ç°æ›´åŠ ä¸æ»‘çš„æ—‹è½¬æ•ˆæœå·¦ä¾§æ˜¯slerpå®ç°çš„æ—‹è½¬æ•ˆæœ"},{"title":"Layer å›¾å±‚","path":"/wiki/ThreeJs/Wael_27_Layer.html","content":"LayerThreeJsæä¾›åºå·åœ¨0-31ä¹‹é—´å…±32ä¸ªå›¾å±‚ï¼Œä¸€ä¸ªç‰©ä½“å¯ä»¥åŒæ—¶å­˜åœ¨åœ¨ä¸åŒçš„å›¾å±‚ä¸Šï¼Œåªæœ‰ä¸ç›¸æœºåŒå›¾å±‚çš„ç‰©ä½“æ‰èƒ½è¢«è§‚å¯Ÿåˆ°ã€‚https://threejs.org/docs/index.html?q=Layer#api/en/core/Layershttps://threejs.org/docs/index.html?q=Layer#api/en/core/LayersLayerç±»æä¾›äº†ä¸€äº›ç®€å•çš„æ“ä½œï¼šset æŒ‡å®šä¸ºæŸä¸€å›¾å±‚enableAll å¼€å¯å…¨éƒ¨å›¾å±‚enable å¼€å¯æŸä¸€å›¾å±‚å›¾å±‚æ“ä½œåˆ‡æ¢ç‰©ä½“å¯è§æ€§ å›¾å±‚+æ¸²æŸ“é€šé“æ§åˆ¶å¯ä»¥ä½¿ç”¨å›¾å±‚æ¥æ§åˆ¶æŸä¸ªç‰©ä½“ï¼Œæˆ–ç‰©ä½“çš„æŸä¸ªéƒ¨åˆ†æ˜¯å¦éœ€è¦å åŠ æ¸²æŸ“æ•ˆæœã€‚æ‹¿UnrealBloomè¿™ä¸ªæ¸²æŸ“æ•ˆæœä¸ºä¾‹ï¼Œæœªç»æ¸²æŸ“çš„åŸå§‹æ•ˆæœå¦‚ä¸‹ï¼šæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰ç‰©ä½“çš„çº¹ç†å˜æˆæ·±è‰²ï¼šå°†éœ€è¦åº”ç”¨æ•ˆæœçš„ç‰©ä½“ä»ä¸­æ’é™¤ï¼Œä¿æŒåŸæ¥çš„æè´¨ï¼Œè¿™é‡Œç”¨åˆ°çš„æ˜¯å±‚çº§æ§åˆ¶ï¼šæ·»åŠ UnrealBloomçš„æ¸²æŸ“æ•ˆæœï¼Œï¼ˆæ·±è‰²çº¹ç†ä¸å—unrealBloomæ•ˆæœçš„å½±å“ï¼‰æœ€åä¸€æ­¥ï¼šå°†ç‰©ä½“çš„åŸå§‹çº¹ç†æ˜ å°„é‡æ–°å–å‡º ä¸Šé¢çš„æ­¥éª¤æ˜¯threeæ¸²æŸ“çš„æµç¨‹ï¼Œå®é™…å®ç°æµç¨‹å¦‚ä¸‹ï¼šstep1step2step3step4æ­¥éª¤1ï¼š ç»˜åˆ¶åŸå§‹å›¾åƒlet model, mixerconst loader = new GLTFLoader()loader.load(assets/fantasy_sword.glb, gltf = model = gltf.scene scene.add(model) model.position.set(0, 126, -127) mixer = new THREE.AnimationMixer(model) const action = mixer.clipAction( THREE.AnimationClip.findByName(gltf.animations,Idle) ) action.play())æ­¥éª¤2ï¼šæ·»åŠ Bloomæ•ˆæœåˆæˆå™¨const renderScene = new RenderPass(scene, camera)const unrealBloomPass = new UnrealBloomPass( new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 1, 0.1)const bloomComposer = new EffectComposer(renderer)bloomComposer.addPass(renderScene)bloomComposer.addPass(unrealBloomPass)function animate() // ... bloomComposer.render()window.addEventListener(resize, function() // ... bloomComposer.setSize(window.innerWidth, window.innerHeight));æ­¥éª¤3ï¼šæ·»åŠ Bloomå’ŒåŸå§‹å›¾åƒçš„æ··åˆåˆæˆå™¨è¿™ä¸ªåˆæˆå™¨åŒ…å«3ä¸ªä¸»è¦çš„é€šé“ï¼šåŸå§‹åŸºå±‚å›¾åƒé€šé“ renderPassåˆæˆBloomå’ŒåŸºå±‚ä¼šç”¨åˆ°çš„ç€è‰²å™¨é€šé“ shaderPassè¾“å‡ºæœ€ç»ˆæ•ˆæœçš„é€šé“ outputPassæˆ‘ä»¬åªéœ€è¦ç”¨bloomRenderçš„æ¸²æŸ“æ•ˆæœè¿›è¡Œåˆæˆï¼Œå¹¶ä¸éœ€è¦å°†å®ƒæ¸²æŸ“åˆ°åœºæ™¯ä¸­ï¼šbloomComposer.renderToScreen = falseå¯¹å¤šä¸ªçº¹ç†è¿›è¡Œåˆæˆï¼Œéœ€è¦ç”¨åˆ°ShaderPassï¼ŒShaderPassæ¥æ”¶ShaderMaterialä½œä¸ºå‚æ•°ï¼Œåœ¨htmlä¸­å‡†å¤‡å¥½vertexShaderå’ŒfragmentShaderï¼šVertexShaderscript type=x-vertex id=v-shader varying vec2 vUv; void main() vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptFragmentShadrescript type=x-fragment id=f-shader varying vec2 vUv; uniform sampler2D baseTexture; uniform sampler2D bloomTexture; void main() gl_FragColor = (texture2D(baseTexture, vUv) + vec4(1.0)*texture2D(bloomTexture, vUv)); /scriptå…¶ä¸­gl_FragColorå¯ä»¥æ‹†åˆ†æˆ3ä¸ªéƒ¨åˆ†ï¼šåŸå§‹æ¸²æŸ“çº¹ç† texture2D(baseTexture, vUv)bloomæ¸²æŸ“æ•ˆæœçº¹ç† texture2D(bloomTexture, vUv)æ¸²æŸ“æ•ˆæœå¼ºåº¦ vec4(1.0)åˆ›å»ºShaderPassï¼šconst mixPass = new ShaderPass( new THREE.ShaderMaterial( uniforms: baseTexture: value: null , bloomTexture: value: bloomComposer.renderTarget2.texture , vertexShader: document.getElementById(v-shader).textContent, fragmentShader: document.getElementById(f-shader).textContent, ),baseTexture)åˆ›å»ºæ¸²æŸ“æœ€åæ•ˆæœçš„åˆæˆå™¨ï¼šconst outputPass = new OutputPass()finalComposer.addPass(renderScene)finalComposer.addPass(mixPass)finalComposer.addPass(outputPass)function animate() // ... finalComposer.render()window.addEventListener(resize, function() // ... finalComposer.setSize(window.innerWidth, window.innerHeight));æ­¥éª¤4ï¼šåŠ å…¥å›¾å±‚æ§åˆ¶æè´¨åˆ›å»ºBloomå›¾å±‚ã€æš—è‰²çº¹ç†ã€çº¹ç†å­˜å‚¨å¯¹è±¡ï¼šconst BLOOM_LAYER = 1const bloomLayer = new THREE.Layers()bloomLayer.set(BLOOM_LAYER)const darkMaterial = new THREE.MeshStandardMaterial( color: 0x000000 )const materials = function storeMaterial(obj) if (obj.isMesh !bloomLayer.test(obj.layers)) materials[obj.uuid] = obj.material obj.material = darkMaterial function restoreMaterial(obj) if (materials[obj.uuid]) obj.material = materials[obj.uuid] delete materials[obj.uuid] åœ¨loopå‡½æ•°å†…è¿›è¡Œå›¾å±‚æ§åˆ¶æ“ä½œï¼šfunction animate() // ... scene.traverse(storeMaterial) // ä¸åœ¨bloomå±‚çš„å˜æš— bloomComposer.render() // bloomé€šé“ç”Ÿæˆæ•ˆæœçº¹ç† scene.traverse(restoreMaterial) // æ¢å¤å˜æš—éƒ¨åˆ†çš„çº¹ç† finalComposer.render() // æ··åˆbloomä¸åŸå§‹æ•ˆæœåšå¥½è¿™äº›å·¥ä½œä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡å›¾å±‚æ§åˆ¶çš„æ–¹å¼ï¼Œç»™ä¸åŒéƒ¨åˆ†æ·»åŠ æ¸²æŸ“æ•ˆæœï¼šfunction createGUI() const gui = new GUI() const configs = const names = [Object_11, Object_12, Object_13, Object_14] names.forEach(name = configs[name] = false gui.add(configs, name).onChange(val = model.getObjectByName(name).layers.toggle(BLOOM_LAYER) ) )"},{"title":"Object Follow Path ç‰©ä½“è·Ÿéšè·¯å¾„","path":"/wiki/ThreeJs/Wael_29_follow_path.html","content":"CatmullRomCurve3 æ›²çº¿è·¯å¾„è¯´åˆ°ç‰©ä½“è·Ÿéšè·¯å¾„ç§»åŠ¨ï¼Œå°±æƒ³åˆ°ä½¿ç”¨yukaåº“æ¥å®ç°ï¼Œå¦‚æœä¸ç”¨yukaå®ç°å‘¢ï¼Ÿyukaé‡Œï¼Œéœ€è¦åˆ›å»ºä¸€æ¡yuka.Pathï¼Œé€šè¿‡è¿™æ¡è·¯å¾„ï¼Œåœ¨åŠ¨ç”»å¸§é‡Œåˆ·æ–°ç‰©ä½“çš„åæ ‡å’Œæ–¹å‘ï¼Œåœ¨Threejsä¸­ï¼ŒCatmullRomCurve3ä¹Ÿå¯ä»¥ä½¿ç”¨å‡ ä¸ªå…³é”®åæ ‡åˆ›å»ºå‡ºä¸€æ¡æ›²çº¿ï¼šconst points = [ new THREE.Vector3(-10, 0, 10), new THREE.Vector3(-5, 5, 5), new THREE.Vector3(0, 0, 0), new THREE.Vector3(5, -5, 5), new THREE.Vector3(10, 0, 10),]const path = new THREE.CatmullRomCurve3(points,true)const pathGeometry = new THREE.BufferGeometry().setFromPoints(path.getPoints(50))const pathMaterial = new THREE.LineBasicMaterial( color:0xff0000,)const pathObject = new THREE.Line(pathGeometry,pathMaterial)scene.add(pathObject)åœ¨ threeexamplesjsmcurvesCurveExtras é‡Œï¼Œè¿˜æä¾›äº†å¾ˆå¤šç±»å‹çš„æ›²çº¿åˆ›å»ºæ–¹å¼https://threejs.org/docs/index.html?q=Cur#api/en/extras/curves/CatmullRomCurve3https://threejs.org/docs/index.html?q=Cur#api/en/extras/curves/CatmullRomCurve3æ›²çº¿åˆ›å»ºå¥½åï¼Œéœ€è¦å†å¸§åŠ¨ç”»ä¸­ï¼Œé€šè¿‡è¿ç»­çš„æ—¶é—´å‚æ•°è·å–æ›²çº¿ä¸Šçš„ç‚¹ä½åˆ‡çº¿æ–¹å‘é€šè¿‡è¿™äº›å±æ€§å¯¹ç‰©ä½“è¿›è¡Œå˜æ¢ï¼šfunction animate(time) const t = (time / 2000 % 6)/6 // tæ˜¯ä¸€ä¸ªåœ¨0-1ä¹‹é—´è¿ç»­å˜åŒ–çš„å€¼ const point = path.getPointAt(t) // æå–ç‚¹ä½ shipModel.position.copy(point) const tangent = path.getTangentAt(t).normalize() // æå–åˆ‡çº¿å‘é‡ shipModel.lookAt( point.clone().add(tangent) ) renderer.render(scene, camera); èµ›åšå¸å†°"},{"title":"Map åœ°å›¾","path":"/wiki/ThreeJs/Wael_28_map.html","content":"mini map åœºæ™¯å°åœ°å›¾çš„æ·»åŠ åˆ¶ä½œåœºæ™¯å°åœ°å›¾ï¼Œæ„å‘³ç€é™¤äº†æ¸²æŸ“sceneå’Œä¸»è§†è§’æ§åˆ¶çš„cameraå¤–ï¼Œè¿˜ä¼šç”¨åˆ°ä¸€ä¸ªå°åœ°å›¾ä¸“ç”¨çš„æ‘„åƒæœºã€‚è¿™é‡Œçš„conrtolsæ§åˆ¶å™¨ä½¿ç”¨ MapControls ä¼šæ›´å¥½ï¼ŒMapControls æ§åˆ¶æ‘„åƒæœºçš„æ–¹å¼åå‘ é¸Ÿç°è§†è§’https://threejs.org/examples/#misc_controls_maphttps://threejs.org/examples/#misc_controls_mapimport MapControls from three/examples/jsm/controls/MapControls;// ...const controls = new MapControls(camera, renderer.domElement);controls.enableDamping = truecontrols.dampingFactor = 0.05controls.enableZoom = false// æ³¨æ„å¼€å¯é˜»å°¼ä¹‹åï¼Œéœ€è¦å†animateå‡½æ•°ä¸­updateæ§åˆ¶å™¨function animate() controls.update()åˆ›å»ºä¸€ä¸ªæ–°çš„domå®¹å™¨ï¼Œç”¨äºæ¸²æŸ“å°åœ°å›¾ï¼š style #mini-map position:absolute; width:250px; height:250px; right:1rem; bottom:1rem; box-shadow:0px 0px 5px #000; /stylediv id=mini-map/divä¸ºå°åœ°å›¾å‡†å¤‡ä¸“é—¨çš„ æ¸²æŸ“å™¨ ã€ æ‘„åƒæœº const miniMapDom = document.getElementById(mini-map)const miniMapRenderer = new THREE.WebGLRenderer(antialias:true);miniMapRenderer.setSize(miniMapDom.clientWidth, miniMapDom.clientHeight)miniMapDom.appendChild(miniMapRenderer.domElement)miniMapRenderer.setClearColor(0xffffff)const miniMapCamera = new THREE.PerspectiveCamera( 45, miniMapDom.clientWidth / miniMapDom.clientHeight, 0.1, 1000)miniMapCamera.position.set(0, 50, 0)miniMapCamera.lookAt(0,0,0)function miniMapAnimation() miniMapRenderer.render(scene, miniMapCamera)miniMapRenderer.setAnimationLoop(miniMapAnimation)è§†è§’è”åŠ¨é€šè¿‡raycasterè·å–é¼ æ ‡åœ¨å°åœ°å›¾ä¸Šçš„ç‚¹å‡»ä½ç½®Pï¼Œå°†å¤§åœ°å›¾çš„ç›¸æœºä½ç½®ç§»åŠ¨åˆ°På¤„ï¼Œæ³¨æ„ç›¸æœºä½ç½®ç§»åŠ¨åï¼Œè¿˜éœ€è¦ä¿®æ”¹controls.targetæ‰èƒ½ä¿®æ”¹ç›¸æœºçš„æœå‘const mousePosition = new THREE.Vector2()const raycaster = new THREE.Raycaster()miniMapDom.onmousedown = e = let rect = miniMapDom.getBoundingClientRect() let x = e.offsetX let y = e.offsetY mousePosition.x = (x/miniMapDom.clientWidth*2) - 1 mousePosition.y = 1 - (y/miniMapDom.clientHeight * 2) raycaster.setFromCamera(mousePosition, miniMapCamera) let intersections = raycaster.intersectObject(model) if(intersections[0]) const point = intersections[0].point camera.position.set(point.x, 8, point.z) controls.target.set(point.x, 0, point.z) texture + layer æ§åˆ¶å®ç°å°åœ°å›¾ å°åœ°å›¾ä¸€èˆ¬ä¸éœ€è¦è¿‡äºç²¾ç»†çš„æ¸²æŸ“ï¼Œå› æ­¤ä¸ºè¿™ä¸ªåŠŸèƒ½ä¸“é—¨æ¸²æŸ“ä¸€ä¸ªæ¨¡å‹ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šæ€§èƒ½ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨ä¸€å¼ textureçº¹ç†å›¾ç‰‡ä»£æ›¿æ¨¡å‹ï¼šconst textureLoader = new THREE.TextureLoader()const mapTexture = textureLoader.load(assets/painting/MiniMap.png)mapTexture.colorSpace = THREE.SRGBColorSpaceconst planeGeo = new THREE.PlaneGeometry(41,41)const planeMat = new THREE.MeshBasicMaterial( map:mapTexture)const planeMesh = new THREE.Mesh(planeGeo, planeMat)planeMesh.rotation.set(-Math.PI/2, 0, 0 )scene.add(planeMesh)é€šè¿‡å›¾å±‚æ§åˆ¶çš„æ–¹å¼ï¼Œå°†å°åœ°å›¾ç”¨åˆ°çš„textureå’Œå®é™…çš„modelåˆ†å¼€åˆ°ä¸¤ä¸ªå›¾å±‚ï¼Œå°åœ°å›¾æ¸²æŸ“å™¨åªå¯¹textureå›¾å±‚è¿›è¡Œæ¸²æŸ“ï¼Œä½†æ˜¯ä»èƒ½ä¿ç•™raycasteräº¤äº’äº‹ä»¶ï¼šminiMapCamera.layers.disableAll()miniMapCamera.layers.enable(1)planeMesh.layers.disable(0)planeMesh.layers.enable(1) åœ¨å°åœ°å›¾ä¸­æ ‡æ³¨åœºæ™¯ç‰©ä½“ä½ç½®åœ¨åœºæ™¯ä¸­åŠ¨æ€æ·»åŠ å»ºç­‘ç‰©ï¼Œé€šè¿‡raycasterèƒ½å¤Ÿè·å¾—ç‰©ä½“åæ ‡ï¼Œåœ¨å°åœ°å›¾çš„åŒåæ ‡ä½ç½®åˆ›å»ºå›¾æ ‡ï¼ˆè´´å›¾å¹³é¢ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°åœ°å›¾å›¾æ ‡éœ€è¦å’Œå°åœ°å›¾åœ¨åŒä¸€ä¸ªå›¾å±‚ï¼š// åŠ è½½tower iconconst towerTexture= textureLoader.load(assets/painting/tower.png)towerTexture.colorSpace = THREE.SRGBColorSpaceconst towerMat = new THREE.MeshBasicMaterial( map:towerTexture, transparent:true)const towerGeo = new THREE.PlaneGeometry(3.5,3.5)window.onkeydown = e = if(e.key == t tower) raycaster.setFromCamera(mousePosition, camera) const intersections = raycaster.intersectObject(model) if(intersections[0]) const point = intersections[0].point let group = new THREE.Group() scene.add(group) // ... æ·»åŠ å¡”éƒ¨åˆ†çœç•¥ // å°åœ°å›¾å›¾æ ‡ const towerMesh = new THREE.Mesh(towerGeo, towerMat) group.add(towerMesh) towerMesh.position.y = 0.1 towerMesh.rotation.set(-Math.PI/2, 0, 0) towerMesh.layers.disable(0) // ä¿®æ”¹å›¾æ ‡æ‰€åœ¨å›¾å±‚ towerMesh.layers.enable(1) DLC1ï¼šå¡”æ¥¼æ·»åŠ shaderé›·è¾¾æ•ˆæœ ç”¨shaderå’Œä¸€å¼ ç°åº¦è½¬åœºå›¾å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå åŠ åœ¨åŒä¸€yè½´çš„ç‰©ä½“ä¼šå‡ºç°æ·±åº¦å†²çªçš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦ç»™yè½´ä¸€å®šçš„åç§»ï¼šMath.random() * 0.01script type=x-vertex id=v-shader varying vec2 vUv; void main() vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); /scriptscript type=x-fragment id=f-shader varying vec2 vUv; uniform sampler2D u_transition; uniform float u_time; mat2 rotate(float angle) return mat2( cos(angle), -sin(angle), sin(angle), cos(angle) ); void main() vec2 vUv = vUv; vUv -= 0.5; vUv *= rotate(u_time); vUv +=0.5; vec4 texture = texture2D(u_transition, vUv); gl_FragColor = vec4( 0.4, texture.g/1.3, texture.b/1.3, texture.r ); /script// æ¸å˜æè´¨const uniforms = u_transition: type:t, value:textureLoader.load(assets/transition/transition6.png) , u_time:type:f, value: 0.0const radarMat = new THREE.ShaderMaterial( uniforms, transparent:true, vertexShader:document.getElementById(v-shader).textContent, fragmentShader:document.getElementById(f-shader).textContent,)const radarGeo = new THREE.CircleGeometry(5,20)window.onkeydown = e = if(e.key == t tower) raycaster.setFromCamera(mousePosition, camera) const intersections = raycaster.intersectObject(model) if(intersections[0]) const point = intersections[0].point let group = new THREE.Group() scene.add(group) // ç•¥.... // åº•éƒ¨æ‰«ææ•ˆæœ const radarMesh = new THREE.Mesh(radarGeo, radarMat) radarMesh.rotation.set(-Math.PI/2 , 0,0) group.add(radarMesh) radarMesh.position.y = Math.random() * 0.01 DLC2:CSS2DRender å¼•å…¥CSS2DRenderå®ç°é€šè¿‡input:rangeæ§åˆ¶æ‰«æåœˆçš„å¤§å°const labelRenderer = new CSS2DRenderer()labelRenderer.setSize(window.innerWidth, window.innerHeight)document.body.appendChild(labelRenderer.domElement)labelRenderer.domElement.style.position = absolutelabelRenderer.domElement.style.top = 0pxlabelRenderer.domElement.style.pointerEvents = none//...window.onkeydown = e = if(e.key == t tower) raycaster.setFromCamera(mousePosition, camera) const intersections = raycaster.intersectObject(model) if(intersections[0]) const point = intersections[0].point let group = new THREE.Group() scene.add(group) // ... // ç¼©æ”¾æ»‘åŠ¨æ¡ let slider = document.createElement(input) slider.type = range slider.max = 3 slider.min = 1 slider.value = 2 slider.step = 0.1 slider.style.pointerEvents = all const sliderLabel = new CSS2DObject(slider) sliderLabel.position.set(0,2,0) // group.add(sliderLabel) slider.addEventListener(input,e= radarMesh.scale.set(slider.value, slider.value, slider.value) ) å°åœ°å›¾æ˜¾ç¤ºåŠ¨æ€ç‰©ä½“å°åœ°å›¾ä¸Šç‰©ä½“å›¾æ ‡çš„å˜åŒ–å’Œå®é™…ç‰©ä½“çš„å˜åŒ–åŸç†å®Œå…¨ä¸€è‡´ï¼Œä¸‹é¢ä»£ç å®ç°ä¸€å°ä½ç©ºé£è¡Œçš„ç›´å‡é£æœºï¼š// åŠ è½½ç›´å‡é£æœºlet helicoptelet mixerloader.load(assets/helicopter.glb,gltf= helicopte = gltf.scene helicopte.scale.set(0.2,0.2,0.2) helicopte.position.set(0,1,0) scene.add(helicopte) mixer = new THREE.AnimationMixer(helicopte) const action = mixer.clipAction( THREE.AnimationClip.findByName(gltf.animations, Rotation) ) action.play())è¿™è¾†ç›´å‡é£æœºæœ‰å›ºå®šçš„èˆªè¿¹ï¼Œä½¿ç”¨CatmullRomCurve3åˆ›å»ºï¼šconst points = [ new THREE.Vector3(-5,1,-5), new THREE.Vector3(-5,3,3), new THREE.Vector3(5,5,5), new THREE.Vector3(10,3,-1), new THREE.Vector3(3,2,-8),]const path = new THREE.CatmullRomCurve3(points,true)const pathGeo = new THREE.BufferGeometry().setFromPoints(path.getPoints(50))const pathMat = new THREE.LineBasicMaterial(color:0xffaa00)const pathMesh = new THREE.Line(pathGeo, pathMat)scene.add(pathMesh)æ­¤å¤–ï¼Œè¿˜éœ€è¦åœ¨å°åœ°å›¾ä¸­åˆ›å»ºä¸€ä¸ªç›´å‡é£æœºå¯¹åº”çš„iconï¼šconst helicopterIconMat = new THREE.ShaderMaterial( uniforms, transparent:true, vertexShader:document.getElementById(v-shader).textContent, fragmentShader:document.getElementById(f-shader-2).textContent,)const helicopterIconGeo = new THREE.CircleGeometry(5,20)const helicopterIconMesh = new THREE.Mesh(helicopterIconGeo, helicopterIconMat)helicopterIconMesh.position.y = 1helicopterIconMesh.rotation.x = -Math.PI/2helicopterIconMesh.layers.disable(0)helicopterIconMesh.layers.enable(1)scene.add(helicopterIconMesh)iconä½¿ç”¨shaderMaterialè‡ªå®šä¹‰æ³¢çº¹æ•ˆæœï¼šscript type=x-fragment id=f-shader-2 varying vec2 vUv; uniform float u_time; void main() vec2 vUv = vUv; float distance = distance(vec2(0.5), vUv); // fract å–å°æ•°éƒ¨åˆ† 10.0æ§åˆ¶æ³¢çº¹å¯†åº¦ 40.0æ§åˆ¶æ³¢çº¹é€æ˜åº¦ float color = fract(distance * 10.0 - u_time) / distance / 40.0; gl_FragColor = vec4(vec3(1.0, 0.0, 0.0), color); /scriptåœ¨åŠ¨ç”»å¸§ä¸­æ”¹å˜ç›´å‡é£æœºå’Œé£æœºå›¾æ ‡çš„positionå’Œåˆ‡å‘é‡const clock = new THREE.Clock()function animate(time) if(mixer) mixer.update(clock.getDelta()) const t = (time/2000 % 10) /10 const position = path.getPointAt(t) const tangent = path.getTangentAt(t) helicopte.position.copy(position) helicopte.lookAt( position.clone().add(tangent) ) helicopterIconMesh.position.copy(position) // ..."},{"title":"Basic Components - ThreeJsçš„åŸºæœ¬å…ƒç´ ","path":"/wiki/ThreeJs/learning_03_basicComponents.html","content":"Create a SceneThree Types of Components Determine the Scene to Show camera : what is renderedlight : how the material be renderedobject : the thing be renderedObject3D æ˜¯threeJsä¸­å¤§éƒ¨åˆ†å¯¹è±¡çš„åŸºç±»Scene is the Container of these different components Basic functionality of a scene Example 02 Basic Sceneé­”æ”¹ç‰ˆExample 02 Basic Scenescene-related functionsTHREE.Scene.Add æ·»åŠ å…ƒç´ THREE.Scene.Remove ç§»é™¤å…ƒç´ THREE.Scene.children è·å–æ‰€æœ‰å­å…ƒç´ THREE.Scene.getObjectByName é€šè¿‡å…ƒç´ çš„nameè·å–å…ƒç´ THREE.Scene.traverse éå†sceneçš„æ‰€æœ‰å­å…ƒç´ THREE.Scene.fog é›¾THREE.Scene.overrideMaterial è¦†ç›–æè´¨ Scene.fog åœ¨ä¸Šé¢ä¸¤ä¸ªdemoä¸­åŠ ä¸Šé›¾æ°”æ•ˆæœï¼šscene.fog = new THREE.Fog(0xffffff, 0.015, 100)åŠ ä¸Šfogæ•ˆæœé­”æ”¹ç‰ˆFog Scene.overrideMaterial é€šè¿‡scene.overrideMaterialèƒ½å¤Ÿè¦†å†™é¡µé¢ä¸Šçš„æ‰€æœ‰å…ƒç´ çš„æè´¨scene.overrideMaterial = new THREE.MeshLambertMaterial( wireframe:true)overrideMaterialè¦†å†™æè´¨é­”æ”¹ç‰ˆ Geometries MeshesWhatâ€™s geometry? A geometry is basically a collection of points in a 3D spacetip: a collection of points å³ vertices Different Cameras"},{"title":"Start - å¼€å§‹ThreeJsä¹‹æ—…","path":"/wiki/ThreeJs/learning_02_start.html","content":"Rendering and viewing a 3D objectè¦ç»„æˆä¸€ä¸ª3Dç”»é¢ï¼Œéœ€è¦3ä¸ªä¸»è¦å…ƒç´ ï¼š åœºæ™¯ Scene Store and keep track of all the objects we want to render and all the lights we want to use const scene = new THREE.Scene() ç›¸æœº Camera Defines what weâ€™ll see when we render a scene const camera = new THREE.PerspectiveCamera( 45, window.innerWidth/window.innerHeight, 0.1, 1000 ) æ¸²æŸ“å™¨ Renderer Calculating what the scene object will look like const renderer = new THREE.WebGLRenderer()renderer.setClearColor(new THREE.Color(0x000000))renderer.setSize(window.innerWidth, window.innerHeight) Renderers ThreeJsæä¾›å¤šç§æ¸²æŸ“å™¨ï¼šWebGLRendererCanvasRendererSVGRendererCssRenderer AxesHelper åæ ‡è¾…åŠ©å™¨ a helpful debugging toolconst axes = new THREE.AxesHepler(5)scene.add(axes) Materials, lights, and shadowsLight åŠ å…¥å…‰æºspotLight èšå…‰ç¯spotLightHepler èšå…‰ç¯è¾…åŠ©çº¿let spotLight = new THREE.SpotLight(0xaa00aa)spotLight.position.set( 1.5, 0.7, 1.5 );spotLight.intensity = 7scene.add(spotLight)const spotLightHelper = new THREE.SpotLightHelper( spotLight );scene.add( spotLightHelper ); Material threeJsä¸­æœ‰äº›æè´¨æ˜¯ä¸å—å…‰çº¿å½±å“çš„ï¼Œå¦‚MeshBasicMaterialæƒ³è¦åˆ›å»ºå—å…‰ç…§ä½œç”¨çš„æè´¨ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–æè´¨ï¼Œå¦‚ï¼šMeshLambertMaterialMeshPhongMaterial Shadow ç”±äºæ¸²æŸ“shadowä¼šè€—è´¹å¤§é‡CPUèµ„æºï¼Œå› æ­¤é»˜è®¤æ˜¯disabledçš„ï¼Œéœ€è¦ä¸‰æ­¥å¼€å¯shadowï¼šå¼€å¯æŒ‡å®šæŠ•å°„é˜´å½±ç‰©å’Œè¢«æŠ•å°„é˜´å½±ç‰©çš„é˜´å½±æŠ•å°„å±æ€§ castShadowreceiveShadow// æŠ•å°„é˜´å½±ç‰©ä½“cube.castShadow = true// è¢«æŠ•å°„é˜´å½±ç‰©ä½“plan.receiveShadow = trueå¼€å¯æŒ‡å®šå…‰æºçš„é˜´å½±æŠ•å°„å±æ€§ castShadowspotLight.castShadow = trueå¼€å¯æ¸²æŸ“å™¨Rendererçš„é˜´å½±è´´å›¾shadowMaprenderer.shadowMap.enabled = trueæ·»åŠ é˜´å½±ä¹‹åçš„æ•ˆæœ Stats æ€§èƒ½æ£€æµ‹æ’ä»¶ Statsèƒ½å¤Ÿæ£€æµ‹å½“å‰å±å¹•çš„fpså€¼fps : frame per secondimport Stats from three/examples/jsm/libs/stats.moduleconst stats = new Stats()document.body.appendChild(stats.domElement)function animate() requestAnimationFrame(animate) stats.update() // æ›´æ–°çŠ¶æ€ç›‘æ§å™¨ renderer.render(scene,camera) AnimationsrequestAnimationFrame requestAnimationFrame(nextFrameFun)function nextFrameFun()requestAnimationFrameç›¸å½“äºå‘Šè¯‰æµè§ˆå™¨ç»˜åˆ¶ä¸‹ä¸€å¸§æ—¶è°ƒç”¨çš„å‡½æ•°ï¼ŒthreeJsä¸­çš„æ›´æ–°å‡½æ•°ä¸€èˆ¬åœ¨requestAnimationFrameæŒ‡å®šçš„å‡½æ•°ä¸­è°ƒç”¨function animation() requestAnimationFrame(animation) controls.upadte() // æ›´æ–°è½¨é“æ§åˆ¶å™¨ stats.update() // æ›´æ–°å¸§ç›‘å¬å™¨ renderer.render(scene,camera) // æ¸²æŸ“å™¨é‡æ¸²æŸ“ GUIdat.gui lil-guiæä¾›å¿«é€Ÿç¼–è¾‘æ¸²æŸ“å‚æ•°çš„å·¥å…·æ’ä»¶dat.gui - githubhttps://github.com/dataarts/dat.gui Resizeresize éœ€è¦åœ¨windowçš„resizeäº‹ä»¶æ—¶åšä¸‹é¢ä¸¤æ­¥window.addEventListener(resize,resize)function resize() camera.aspect = window.innerWidth/window.innerHeight // ä¿®æ”¹å®½é«˜æ¯”å€¼ camera.updateProjectionMatrix() // æ›´æ–°è§†å›¾çŸ©é˜µ renderer.setSize(window.innerWidth,window.innerHeight) // æ›´æ–°æ¸²æŸ“å™¨å®½é«˜ render result"},{"title":"Requirements - å‡†å¤‡å·¥ä½œ","path":"/wiki/ThreeJs/learning_01_requirements.html","content":"å®˜æ–¹æä¾›çš„ä¸€ä¸ªè¶…é…·çš„Demo Eye texture raytracing demohttps://www.vill.ee/eye/è¿™çœŸæ˜¯...æ³°è£¤è¾£ï¼ Things that Three.js makes easy geometries ä¸‰ç»´å›¾å½¢çš„åˆ›å»º Aniamating and moving ä¸‰ç»´åœºæ™¯å†…çš„å›¾å½¢åŠ¨ç”»å’Œå˜æ¢ textures and materials çº¹ç†å’Œæè´¨ light sources å…‰æº 3D-modeling 3Dæ¨¡å‹ postprocessing effects åæœŸæ¸²æŸ“æ•ˆæœ custom shaders è‡ªå®šä¹‰ç€è‰²å™¨ point clouds ç‚¹äº‘ two types of 3D-based renderer WebGL-based rendererç”±Three.jsæä¾›CSS 3D-based rendererç”¨äºåˆ›å»ºåŸºäºCSSçš„3Dåœºæ™¯ä¼˜åŠ¿ï¼šå¤§éƒ¨åˆ†çš„PCå’Œç§»åŠ¨è®¾å¤‡æµè§ˆå™¨éƒ½æ”¯æŒæ”¯æŒåœ¨3Dç©ºé—´ä¸­ç›´æ¥æ¸²æŸ“ HTMLå…ƒç´  Requirements to use Three.jsGetting the source code Setting up a local web server UnixLinuxMac systemsä¸€èˆ¬éƒ½æœ‰Pythonç¯å¢ƒï¼Œå› æ­¤å¯ä»¥ç›´æ¥å¼€å¯æœ¬åœ°æœåŠ¡å™¨ï¼špython -m SimpleHTTPServerNode.jsæœ‰Nodeç¯å¢ƒå¯ä»¥ç›´æ¥ç”¨npmå®‰è£…http-serversimple-http-serveråŒ…ï¼šnpm install -g http-serverhttp-servernpm install -g simple-http-servernserverMongooseæ²¡æœ‰Pythonå’ŒNodeç¯å¢ƒçš„å¯ä»¥ç”¨Mongooseï¼Œå°†ç³»ç»Ÿå¯¹åº”ç‰ˆæœ¬çš„Mongooseå¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•ä¸‹è¿è¡Œã€‚https://code.google.com/archive/p/mongoose/downloadshttps://code.google.com/archive/p/mongoose/downloadsSecurity exceptionsChromeFirefoxå¯åŠ¨Chromeæ—¶åœ¨å‘½ä»¤åé¢åŠ ä¸Šåç¼€ï¼šâ€“disable-web-securityWindowschrome.exe â€“disable-web-securityLinuxgoogle-chrome â€“disable-web-securityMacopen -a Google\\ Chrome â€“args â€“disable-web-securityåœ¨å¯¼èˆªæ è¾“å…¥urlï¼šabout:configè¿›å…¥é…ç½®é¡¹æœç´¢ security.fileuri.strict-origin_policy å˜é‡æ”¹æˆfalseMixed contentä¸€èˆ¬çš„ç½‘é¡µä½¿ç”¨çš„éƒ½æ˜¯httpsåè®®ï¼Œä½†æ˜¯åœ¨é¡¹ç›®ä¹‹ä¸­è°ƒç”¨çš„ç¬¬ä¸‰æ–¹æ¥å£æ—¶ä½¿ç”¨çš„å¯èƒ½æ˜¯httpåè®®ï¼Œç‰ˆæœ¬æ¯”è¾ƒæ–°çš„Chromeå’ŒFireFoxæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†httpåè®®å‡çº§ä¸ºhttpsåè®®ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å®‰å…¨è­¦å‘Šï¼Œä½†å¦‚æœç¬¬ä¸‰æ–¹ä¸æ”¯æŒhttpsåè®®ï¼Œå°±ä¼šæŠ¥Mixed contenté”™è¯¯ã€‚ChromeFireFoxå‚è€ƒåšå®¢https://blog.csdn.net/weixin_42393724/article/details/109775036ç‚¹å‡»urlæ å·¦ä¾§é“é”æŒ‰é’®ï¼ˆæŸ¥çœ‹ç½‘ç«™ä¿¡æ¯ï¼‰ç‚¹å‡»ç½‘ç«™è®¾ç½®å°†ä¸å®‰å…¨å†…å®¹çš„æƒé™ä¿®æ”¹ä¸ºå…è®¸FireFoxå®˜ç½‘å¯¹æ··åˆå†…å®¹çš„è¯¦ç»†ä»‹ç»https://support.mozilla.org/zh-CN/kb/%E9%98%BB%E6%AD%A2%E6%B7%B7%E5%90%88%E5%86%85%E5%AE%B9?as=u&utm_source=inproduct&redirectslug=how-does-content-isnt-secure-affect-my-safety&redirectlocale=en-USç‚¹å‡»urlå·¦ä¾§é“é”æŒ‰é’®ç‚¹å‡»å®‰å…¨è¿æ¥ç‚¹å‡»æš‚æ—¶è§£é™¤ä¿æŠ¤æŒ‰é’®"},{"title":"CSS3DRendererï¼šå…ƒç´ å‘¨æœŸè¡¨","path":"/wiki/ThreeJs/official_demo_01_periodictable.html","content":"https://threejs.org/examples/#css3d_periodictablehttps://threejs.org/examples/#css3d_periodictable CSS3D-PeriodicTable Intro ä½¿ç”¨CSS3DObjectåˆ›å»ºå‘¨æœŸè¡¨å¡ç‰‡ï¼Œç»„åˆæˆä¸åŒçš„3Då½¢çŠ¶Renderï¼š CSS3DRendererControlsï¼š TrackballControlsminDistanceï¼š 500maxDistanceï¼š 6000Cameraï¼š PerspectiveCamerafovï¼š 40nearï¼š 1farï¼š 10000åˆå§‹zï¼š 10000å…ˆä¸ç®¡è¿™ä¸ªdemoé‡Œå¥‡å¥‡æ€ªæ€ªçš„å¥½å‡ ç§å›¾å½¢å˜åŒ–ï¼Œåªéœ€è¦å…³æ³¨å‡ ç‚¹ï¼šæœ€å¼€å§‹æ—¶å¡ç‰‡çš„åæ ‡ä½ç½®æ¯æ¬¡å˜åŒ–ç»“æŸæ—¶å¡ç‰‡çš„åæ ‡ä½ç½®å¡ç‰‡ä¸­é—´çš„å˜æ¢è¿‡ç¨‹TIPè¿™ä¸ªä¾‹å­å¾ˆåƒåœ¨ä¸Šä½“è‚²è¯¾æ—¶ï¼Œå­¦ç”Ÿä»¬åœ¨æ“åœºä¸Šè‡ªç”±æ´»åŠ¨ï¼Œè¿™æ—¶çš„ä½ç½®éƒ½æ˜¯éšæœºçš„ï¼Œä¸€æ—¦ä½“è‚²è€å¸ˆå¹å“¨é›†åˆï¼Œ å­¦ç”Ÿä»¬å½’é˜Ÿåˆ°åŸå…ˆæŒ‡å®šçš„ä½ç½®ï¼ˆäº‹å…ˆå®‰æ’å¥½çš„ï¼‰è¿™æ ·å°±æŠŠå®ç°æ•ˆæœçš„æ­¥éª¤æ‹†åˆ†ä¸ºäº†ä»¥ä¸‹éƒ¨åˆ†ï¼šåˆå§‹åŒ–å¡ç‰‡åæ ‡ï¼ˆéšæœºï¼‰è®¡ç®—å‡ºå¡ç‰‡åœ¨ç»“æŸååº”è¯¥çš„åæ ‡é€šè¿‡Tweenå®ç°å¡ç‰‡ç§»åŠ¨çš„è¿ç»­æ•ˆæœ æ­¥éª¤1ï¼šå‡†å¤‡å·¥ä½œ â€å›¾å½¢å­¦çš„å¤§éƒ¨åˆ†å·¥ä½œå®é™…ä¸Šéƒ½èŠ±åœ¨äº†æ•°æ®åˆ†æä¸Šâ€œ â€”â€”â€”â€”è°è¯´çš„æ¥ç€é™¤äº†sceneã€cameraã€rendererã€controlsè¿™äº›åŸºç¡€åœºæ™¯å…ƒç´ å¤–ï¼Œè¿˜æœ‰resizeã€animationç­‰æ ‡é…å‡½æ•°å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæœ€æœ€å…³é”®çš„ä¸œè¥¿éœ€è¦å‡†å¤‡ï¼šå…ƒç´ è¡¨æ•°æ®ï¼Œå®˜æ–¹demoä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç±»ä¼¼indexç´¢å¼•çš„åŒ…å«5ä¸ªå±æ€§çš„å®Œå…¨è¢«æ‰“å¹³çš„æ•°ç»„ï¼šconst table = [//ç®€ç§° å…¨ç§° ç›¸å¯¹åŸå­è´¨é‡ è¡Œæ•° åˆ—æ•° H, Hydrogen, 1.00794, 1, 1, He, Helium, 4.002602, 18, 1, Li, Lithium, 6.941, 1, 2, Be, Beryllium, 9.012182, 2, 2, B, Boron, 10.811, 13, 2, C, Carbon, 12.0107, 14, 2, // ....]åˆå§‹åŒ–åœºæ™¯ä¸­çš„å®ä½“ï¼šfunction init() camera = new THREE.PerspectiveCamera( 40, window.innerWidth/ window.innerHeight, 1, 10000 ) camera.position.z = 3000 scene = new THREE.Scene() renderer = new CSS3DRenderer() renderer.setSize(window.innerWidth,window.innerHeight) document.getElementById(container).appendChild(renderer.domElement) controls = new TrackballControls(camera, renderer.domElement) controls.minDistance = 500 // æœ€å°è·ç¦» controls.maxDistance = 6000 // æœ€å¤§è·ç¦» controls.addEventListener(change, render)function render() renderer.render(scene, camera)è¿™é‡Œä½¿ç”¨çš„æ˜¯TrackballControlsï¼Œé‡Œé¢è®¾ç½®äº†2ä¸ªå‚æ•°ï¼šminDistance æ‹‰é•œæœ€å°å€¼maxDistance æ‹‰é•œæœ€å¤§å€¼çª—å£å¤§å°resizeäº‹ä»¶ï¼šfunction animation() window.requestAnimationFrame(animation) controls.update() TWEEN.update() // æ›´æ–°TWEENåŠ¨ç”»å¸§å‡½æ•°ï¼šfunction animation() window.requestAnimationFrame(animation) controls.update() TWEEN.update() æ­¥éª¤2ï¼šåˆå§‹ç‚¹ä½å’Œæœ€ç»ˆç‚¹ä½è®¡ç®— åœ¨æ•´ä¸ªå˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½éœ€è¦ä¸€ä¸ªobjectsæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å­˜æ”¾æ‰€æœ‰æ¸²æŸ“å‡ºæ¥çš„CSS3DObjectå®ä¾‹ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªtargetæ•°ç»„ï¼Œå’Œobjectsæ•°ç»„ä¸­çš„ç‰©ä½“ä¸€ä¸€å¯¹åº”ï¼Œå› ä¸ºtargetä¸­å­˜æ”¾çš„å®é™…æ˜¯objectsä¸­å…ƒç´ å¯¹åº”çš„ç›®æ ‡ç‚¹ä½å’Œæ—‹è½¬è§’åº¦ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Object3Då¯¹è±¡å­˜å‚¨const objects = []const targets = []åˆå§‹åŒ–çš„ç‚¹ä½é‡‡ç”¨éšæœºçš„æ–¹å¼ç”Ÿæˆï¼Œ for(let i = 0; itable.length;i+=5) // 1ã€ åˆ›å»ºdomå…ƒç´  const element = document.createElement(div) element.className = element element.style.background = `rgba(0,127,127,$Math.random()*0.5+0.25)` const number = document.createElement(div) number.className = number number.textContent = (i/5)+1 element.appendChild(number) const symbol = document.createElement(div) symbol.className = symbol symbol.textContent = table[i] element.appendChild(symbol) const details = document.createElement(div) details.className = details details.innerHTML = table[i+1]+br+table[i+2] element.appendChild(details) const objectCSS = new CSS3DObject(element) // åˆå§‹åŒ–åæ ‡ åœ¨[-2000, 2000]çš„èŒƒå›´ä¹‹å†… objectCSS.position.x = Math.random() * 4000 - 2000 objectCSS.position.y = Math.random() * 4000 - 2000 objectCSS.position.z = Math.random() * 4000 - 2000 scene.add(objectCSS) objects.push(objectCSS) // æœ€ç»ˆåæ ‡ const object = new THREE.Object3D() object.position.x = ( table[ i + 3 ] * 140 ) - 1330; object.position.y = - ( table[ i + 4 ] * 180 ) + 990; targets.table.push(object)å…¶ä¸­è®¡ç®—ç‰¹å®šå¡ç‰‡åœ¨åœºæ™¯ä¸­çš„ä½ç½®ï¼Œå®é™…ä¸Šç”¨åˆ°çš„æ˜¯ï¼š// col = æ€»åˆ—æ•° colIndex = å½“å‰åˆ—æ•° cw = å•å¼ å¡ç‰‡å®½åº¦// row = æ€»è¡Œæ•° rowIndex = å½“å‰è¡Œæ•° ch = å•å¼ å¡ç‰‡é«˜åº¦x = ( colIndex - (col+1)/2 ) * cwy = ( (row+1)/2 - rowIndex ) * chçƒå½¢ã€èºæ—‹å½¢ã€æ …æ ¼å½¢çš„å˜æ¢åŸç†ä¹Ÿæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä¸åŒçš„æ˜¯è®¡ç®—çš„æ–¹å¼:çƒå½¢åæ ‡è®¡ç®— çƒå½¢åæ ‡ç³»ä¸€ä¸ªçƒå½¢åæ ‡ç³»éœ€è¦3ä¸ªå‚æ•°ï¼š r(radius-åŠå¾„) Î¸(polar angle - æè§’) èŒƒå›´åœ¨ 0-Ï€ ä¹‹é—´ Ï†(azimuthal angle - æ–¹ä½è§’) èŒƒå›´åœ¨ 0-2Ï€ ä¹‹é—´ è¿™é‡Œå¯¹çƒå½¢åæ ‡çš„è®¡ç®—åªä½¿ç”¨åˆ°æ¯ä¸ªå…ƒç´ çš„indexç´¢å¼•å€¼: æè§’çš„è®¡ç®—é¦–å…ˆå°†indexæ˜ å°„åˆ°-1åˆ°1çš„èŒƒå›´ä¹‹å†…ï¼Œå†é€šè¿‡åä½™å¼¦è½¬æ¢ä¸ºæè§’å€¼ï¼š è®¡ç®—æè§’å€¼æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼Œarccoså‡½æ•°çš„å‚æ•°èŒƒå›´åœ¨-1åˆ°1ä¹‹é—´ï¼Œå› æ­¤éœ€è¦ç°å°†iç´¢å¼•å€¼ç›¸å¯¹læ˜ å°„åˆ°-1åˆ°1ä¹‹é—´ï¼ˆè¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼ŒMath.acosè¿”å›NaNï¼‰ æ–¹å‘è§’çš„èŒƒå›´éœ€è¦åœ¨0-2Ï€ä¹‹é—´ï¼Œå› æ­¤åœ¨phiä¹‹å‰éœ€è¦åŠ ä¸€ä¸ªä¹˜æ•°å› å­ï¼Œç”¨äºæ‰©å¤§åæ ‡ä¹‹é—´çš„é—´éš”ã€‚ // i=å…ƒç´ ç´¢å¼• l=å…ƒç´ æ€»æ•°const phi = Math.acos(i*2/l - 0.5) // æè§’å€¼const theta = Math.sqrt(l * Math.PI) * phi // æ–¹å‘è§’ ä½¿ç”¨Vector3.setFromSphericalCoordsè·å–åˆ°åæ ‡ï¼Œ object.position.setFromSphericalCoords(800, phi, theta) è¿™æ ·å¾—åˆ°äº†åæ ‡ç‚¹ï¼Œæ¥ä¸‹æ¥éœ€è¦è®©å¡ç‰‡è½¬å‘ï¼Œå®é™…ä¸Šå°±æ˜¯å°†å¡ç‰‡åæ ‡Pä¸åŸç‚¹Oç›¸è¿çš„çŸ¢é‡OPå‚ç›´äºå¡ç‰‡è¡¨é¢ï¼Œå¯ä»¥ä½¿ç”¨Vector3.multiplyScalaråˆ›å»ºä¸€ä¸ªåœ¨OPå»¶é•¿çº¿ä¸Šçš„åæ ‡ç‚¹ï¼Œç„¶åè®©å¡ç‰‡è½¬å‘å®ƒ(lookAt)ï¼š vector.copy(object.position).multiplyScalar(2)object.lookAt(vector) æœ€ç»ˆå®ç°çƒå½¢æ˜ å°„ï¼š const vector = new THREE.Vector3()for(let i = 0, l = objects.length;iobjects.length;i++) const phi = Math.acos( -1 +(2*i)/l ) // -1 - 1 const theta = Math.sqrt(l * Math.PI) * phi const object = new THREE.Object3D() object.position.setFromSphericalCoords(800, phi, theta) vector.copy(object.position).multiplyScalar(2) object.lookAt(vector) targets.sphere.push(object) èºæ—‹åæ ‡çš„è®¡ç®— åœ†æŸ±åæ ‡ç³»åœ†æŸ±åæ ‡ç³»çš„ä¸‰ä¸ªå‚æ•°ï¼š é•œåƒè·ç¦» æ–¹ä½è§’ é«˜åº¦ é€šè¿‡ç´¢å¼•è®¡ç®—æ–¹å‘è§’, const theta = i * 0.175 ä¹˜ä»¥ä¸€ä¸ªè¾ƒå°çš„å‚æ•°ç”¨äºå‡åŒ€åˆ†å¸ƒï¼Œ æ¥ä¸‹æ¥è®¡ç®—é«˜åº¦ï¼š const y = (-i*8)+450 é€šè¿‡Vector3.setFromCylindricalCoordså°†åæ ‡è½¬æ¢åˆ°æŸ±çŠ¶åæ ‡ç³»ä¸Šï¼Œå¹¶ä»¥å’ŒSphereåŒæ ·çš„æ–¹å¼å¯¹ç‰©ä½“è¿›è¡Œæ—‹è½¬ï¼š object.position.setFromCylindricalCoords(900,theta,y)vector.x = object.position.x * 2;vector.y = object.position.y;vector.z = object.position.z * 2;object.lookAt(vector) æœ€ç»ˆå®ç°èºæ—‹åˆ†å¸ƒï¼š for(let i =0;iobjects.length;i++) const theta = i * 0.175 + Math.PI const y = -(i*8)+450 const object = new THREE.Object3D() object.position.setFromCylindricalCoords(900, theta, y) vector.x = object.position.x * 2; vector.y = object.position.y; vector.z = object.position.z * 2; object.lookAt(vector) targets.helix.push(object) å®é™…ä¸Šï¼Œä½¿ç”¨çƒå½¢åæ ‡ä¹Ÿèƒ½å®ç°èºæ—‹çš„æ•ˆæœï¼Œä½†æ˜¯æ˜¯çƒå½¢èºæ—‹ä½“ï¼š const phi = Math.acos( -1 +(2*i)/l ) // -1 - 1const theta = 10 * phi æ …æ ¼åæ ‡è®¡ç®— for(let i = 0;iobjects.length;i++) const object = new THREE.Object3D() object.position.x = ((i%5) * 400) - 800 object.position.y = (-(Math.floor(i/5)%5)*400) +800; object.position.z = (Math.floor(i/25))* 1000 - 2000; targets.grid.push(object) æ­¥éª¤3ï¼šè¿‡æ¸¡å‡½æ•° https://tweenjs.github.io/tween.js/docs/user_guide.htmlhttps://tweenjs.github.io/tween.js/docs/user_guide.htmlé€šè¿‡TWEENå®ç°åæ ‡çš„è½¬æ¢ã€‚æ¯æ¬¡åˆ‡æ¢å›¾å½¢æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿‡æ¸¡å‡½æ•°ï¼ŒTWEENçš„ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œç±»ä¼¼äºGsapæˆ–animate keyframe,éœ€è¦å°†ç‰©ä½“çš„positionå’Œrotationç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®ï¼š for(let i =0;iobjects.length;i++) const object = objects[i] const target = targets[i] new TWEEN.Tween(object.position) .to( x:target.position.x, y:target.position.y, z:target.position.z, , (Math.random()+1)*duration) .easing(TWEEN.Easing.Exponential.InOut) .start() new TWEEN.Tween(object.rotation) .to( x:target.rotation.x, y:target.rotation.y, z:target.rotation.z, ,(Math.random()+1)*duration) .easing(TWEEN.Easing.Exponential.InOut) .start()å˜æ¢ç»“æŸåï¼Œéœ€è¦è°ƒç”¨renderå‡½æ•°è¿›è¡Œé‡ç»˜ï¼šnew TWEEN.Tween(this) .to(,duration*2) .onUpdate(render) .start()å¦å¤–ï¼Œè¿˜éœ€è¦åœ¨æœ€æ–°å‘èµ·çš„å˜æ¢ä¹‹å‰ï¼Œç»“æŸå½“å‰æ­£åœ¨è¿›è¡Œçš„å˜æ¢ï¼šTWEEN.removeAll()å¦åˆ™ï¼Œåœ¨é¢‘ç¹çš„å˜æ¢ä¹‹åï¼Œä¼šå‡ºç°å˜æ¢é”™ä¹±çš„ç°è±¡ï¼šæœ€åï¼Œéœ€è¦åœ¨å¸§åŠ¨ç”»ä¸­å¯¹TWEENè¿›è¡Œæ›´æ–°ï¼šTWEEN.update() å…¶ä»–ç‰ˆæœ¬"},{"title":"CSS3DRendererï¼šSprite","path":"/wiki/ThreeJs/official_demo_02_sprite.html","content":"https://threejs.org/examples/#css3d_spriteshttps://threejs.org/examples/#css3d_sprites Spriteç”¨äºåˆ›å»ºæ€»æ˜¯é¢å¯¹ç›¸æœºçš„å®ä½“ï¼ŒCSS3DSpriteåˆ™æ˜¯ç”¨äºåˆ›å»ºæ€»æ˜¯é¢å¯¹ç›¸æœºçš„ä¸‰ç»´å®šä½çš„domå…ƒç´ ã€‚åˆ›å»ºCSS3DSpriteçš„æ–¹æ³•å’ŒCSS3DObjectä¸€æ ·ï¼šconst object = new CSS3DSprite(domElement)é‡‘å±è¡¨å±‚çƒä½“å®é™…ä¸Šæ˜¯ä¸€å¼ å›¾ç‰‡ï¼šconst image = document.createElement(img) // åˆ›å»ºå›¾ç‰‡å…ƒç´ image.addEventListener(load, function() // åˆå§‹åŒ–åæ ‡ for(let i = 0; i particlesTotal; i++) const object = new CSS3DSprite(image.cloneNode()) // åˆ›å»ºCSS3DSprite object.position.x = Math.random() * 4000 - 2000 object.position.y = Math.random() * 4000 - 2000 object.position.z = Math.random() * 4000 - 2000 scene.add(object) objects.push(object) transition())image.src = ./assets/img/sprite.pngè¿™ä¸ªä¾‹å­çš„å˜æ¢åŸç†å’Œ å…ƒç´ å‘¨æœŸè¡¨ å®Œå…¨ä¸€æ ·ï¼Œéœ€è¦é¢å¤–ä»‹ç»çš„æ˜¯å‡ ç§ä¸åŒå›¾å½¢çš„åæ ‡çš„è®¡ç®—æ–¹å¼ã€‚æ³¢æµªé¢è¿™é‡Œçš„æ³¢æµªé¢ä»¥xzå¹³é¢ä¸ºæ°´å¹³é¢ï¼Œyæ–¹å‘æ³¢å½¢èµ·ä¼ã€‚ ç”±äºæ³¢æµªé¢å½¢çŠ¶æ˜¯ç”±æ— æ•°ç‚¹ä½ç»„æˆçš„ï¼Œé¦–å…ˆéœ€è¦è®¡ç®—å‡ºè¿™äº›ç‚¹ä½çš„åæ ‡ï¼š amountXï¼šæ²¿xè½´æ–¹å‘ï¼Œä¸€è¡Œçš„ç‚¹æ•° amountZï¼šæ²¿zè½´æ–¹å‘ï¼Œä¸€è¡Œçš„ç‚¹æ•° separationPlaneï¼šç‚¹ä¸ç‚¹ä¹‹é—´çš„é—´è· çŸ¥é“è¿™äº›ä¹‹åå°±å¯ä»¥å¾—åˆ°ä¸€å¼ å¹³é¢ï¼Œä½†æ˜¯è¿˜éœ€è¦ç»™å¹³é¢ä¸€ä¸ªä½ç§»ï¼Œä½¿å…¶ä»xzå¹³é¢ç¬¬ä¸€è±¡é™çš„ä½ç½®ç§»åŠ¨åˆ°æ­£ä¸­é—´: // å®é™…ä¸Šå°±æ˜¯è®¡ç®—å‡ºå¹³é¢å®½é«˜çš„ä¸€åŠconst offsetX = (amountX-1)*separationPlane/2;const offsetZ = (amountZ-1)*separationPlane/2; xè½´å’Œzè½´çš„è®¡ç®—éƒ½æ¯”è¾ƒç®€å•ï¼š // ç‚¹ä½åºå· = iconst x = (i%amountX)*separationPlane - offsetX;const z = Math.floor((i/amountX)%amountZ)*separationPlane - offsetZ; yè½´è®¡ç®—æ˜¯xzè½´åæ ‡çš„ç»“åˆï¼Œå…¶ä¸­æ¶‰åŠåˆ°ä¸€äº›è°ƒå¹…å’Œä¸‰è§’å‡½æ•°çš„åŸç†ï¼Œæˆ‘ä¸æ‡‚å°±ä¸å¤šbbäº† const y = (Math.sin(0.5*x) + Math.sin(0.5*z)) * 200 çƒå½¢çƒå½¢ä¹‹å‰ç”¨çš„æ˜¯Vector3.setFromSphericalCoordsï¼Œè¿™ä¸ªæ¥å£è·å–åˆ°çƒåæ ‡ç³»ä¸‹çš„åæ ‡éœ€è¦ç”¨åˆ°3ä¸ªå‚æ•°ï¼šåŠå¾„ã€æ–¹ä½è§’ã€æè§’ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŠŠç›´è§’åæ ‡è½¬åŒ–ä¸ºçƒåæ ‡ï¼š // æè§’ = theta// æ–¹ä½è§’ = phi// åŠå¾„ = radiusconst x = radius * Math.cos(theta) * sin(phi) const y = radius * Math.sin(theta) * sin(phi) const z = radius * Math.cos(phi) é™¤äº†åæ ‡è®¡ç®—çš„æ–¹å¼ä¸åŒä¹‹å¤–ï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿˜æœ‰ä¸€ä¸ªä¸åŒä¹‹å¤„ï¼Œå°±æ˜¯åæ ‡ç‚¹çš„å­˜å‚¨æ–¹å¼ï¼šç”±äºæ¶‰åŠåˆ°å»¶æ—¶è‡ªåŠ¨åˆ‡æ¢å½¢çŠ¶ï¼Œè¿™é‡Œå°†æ‰€æœ‰åæ ‡éƒ½æ”¾åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç±»ä¼¼äºäºŒç»´æ•°ç»„æ‰“å¹³æˆä¸€ç»´æ•°ç»„å–å€¼ï¼š// offset = å½“å‰å˜æ¢å½¢çŠ¶çš„é¦–åæ ‡// current = å½“å‰å˜æ¢å½¢çŠ¶çš„åºå·// particlesTotal = æ•°ç»„æ€»æ•°const offset = current * particlesTotal * 3æœ€ååœ¨AnimationFrameå‡½æ•°ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªç‰©ä½“è·Ÿéšxè½´ä½ç½®ï¼Œéšæ—¶é—´è¿›è¡ŒåŠ¨æ€æ”¶ç¼©çš„åŠ¨ç”»ï¼Œå…¶ä¸­ç”¨åˆ°äº†performance.now()ç”¨äºè·å–ä¸€ä¸ªé«˜ç²¾åº¦çš„æ—¶é—´å¸§:const time = performance.now()for(let i = 0, l = objects.length; i l; i++) const object = objects[i] const scale = Math.sin(Math.floor(object.position.x) + time) * 0.002 * 0.3 + 1 object.scale.set(scale, scale, scale) è¡ç”Ÿæ ·å¼"},{"title":"Camera","path":"/wiki/ThreeJs/official_doc_01_camera.html","content":"camera array ç›¸æœºé˜µåˆ—ArrayCamera å¤šæœºä½æ¡ˆä¾‹ArrayCameraæ–‡æ¡£æ”¯æŒæ·»åŠ å¤šä¸ªsubCameraå­ç›¸æœºï¼Œé€šè¿‡è®¾ç½®å­ç›¸æœºçš„viewportæ¥æ‘†è®¾æœºä½ï¼š// æœºä½æ•°é‡const AMOUNT = 6const ASPEC_RATIO = window.innerWidth / window.innerHeightconst WIDTH = (window.innerWidth / AMOUNT) * window.devicePixelRatioconst HEIGHT = (window.innerHeight / AMOUNT) * window.devicePixelRatiofor(let y = 0; yAMOUNT; y++) for(let x = 0; x AMOUNT; x++) // åˆ›å»ºå­ç›¸æœº const subcamera = new THREE.PerspectiveCamera( 40, ASPEC_RATIO, 0.1, 10 ) // è®¾ç½®è§†å£çš„åæ ‡å’Œå®½é«˜ subcamera.viewport = new THREE.Vector4( Math.floor(x * WIDTH), Math.floor(y * HEIGHT), Math.ceil(WIDTH), Math.ceil(HEIGHT) ) // è®¾ç½®æœºä½ subcamera.position.set( x/AMOUNT - 0.5, 0.5 - y/AMOUNT, 1.5 ) // è°ƒæ•´ç„¦è· subcamera.position.multiplyScalar(2) subcamera.lookAt(0, 0, 0) subcamera.updateMatrixWorld() cameras.push(subcamera) // åˆ›å»ºç›¸æœºé˜µåˆ—camera = new THREE.ArrayCamera(cameras)camera.position.z = 3å…³é”®ç‚¹å¯¹ç›¸æœºviewportçš„å¸ƒå±€ï¼Œéœ€è¦åœ¨window.resizeä¸­è¿›è¡Œé‡æ–°æ’ç‰ˆï¼Œé€šè¿‡camera.camerasè·å–åˆ°æ‰€æœ‰å­ç›¸æœºçš„åˆ—è¡¨ï¼Œæ›´æ–°ç›¸æœºçš„æ¯”ä¾‹å’Œå°ºå¯¸æ—¶ï¼Œä¸ä»…ä»…è¦æ›´æ–°å­ç›¸æœºçš„ï¼Œè¿˜è¦æ›´æ–°ArrayCameraç±»å‹çš„çˆ¶ç›¸æœºï¼šcamera.aspect = ASPEC_RATIOcamera.updateProjectionMatrix()for(let y = 0; y AMOUNT; y++) for(let x = 0;xAMOUNT;x++) const subcamera = camera.cameras[AMOUNT * y + x]; subcamera.viewport.set( Math.floor( x * WIDTH ), Math.floor( y * HEIGHT ), Math.ceil( WIDTH ), Math.ceil( HEIGHT ) ); subcamera.aspect = ASPEC_RATIO subcamera.updateProjectionMatrix() ä½¿ç”¨åˆ°å’Œæ¯”ä¾‹ç›¸å…³çš„æ•°æ®ï¼Œéƒ½ç”¨åˆ°äº†window.devicePixelRatioï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬ç”¨äºæ ¹æ®å±å¹•çš„åˆ†è¾¨ç‡è°ƒæ•´cssçš„pxå¤§å°ï¼Œå› ä¸ºå¤šæœºä½æ¶‰åŠåˆ°è§†å£çš„å®šä½ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¸²æŸ“ç”»å¸ƒçš„åˆ†è¾¨ç‡ä¹Ÿè¿›è¡Œè°ƒæ•´ï¼šrenderer.setPixelRatio(window.devicePixelRatio)ä½¿ç”¨ArrayCameraï¼Œèƒ½å¤Ÿå®ç°å¤šæœºä½æ‹æ‘„çš„æ•ˆæœï¼šå¤šæœºä½æ‹æ‘„ä½¿ç”¨å¤šæœºä½æ‹æ‘„çš„åŠ¨æ€èƒŒæ™¯è’™ç‰ˆ StereoCamera VRç›¸æœºStereoCameraå®˜æ–¹æ–‡æ¡£StereoEffectSteareoEffectèƒ½å¤Ÿè¿›è¡ŒåŒå±æ¸²æŸ“ï¼Œé€šè¿‡VRå¤´æ˜¾è®¾å¤‡ï¼Œèƒ½å¤Ÿäº§ç”Ÿç«‹ä½“æ•ˆæœç”»é¢ã€‚åŒå±æ˜¾ç¤ºåŸç†æ ¹æ®è§†å·®åŸç†ï¼Œå·¦å³çœ¼å•ç‹¬æ¥æ”¶åˆ°çš„ä¿¡æ¯å„ä¸ç›¸åŒï¼Œå°†å„è‡ªçš„ä¿¡æ¯åœ¨å¤§è„‘åˆæˆåï¼Œå°±èƒ½ç»„åˆæˆå¯¹ç«‹ä½“ç©ºé—´çš„æ„Ÿè§‰ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·ä½©æˆ´VRå¤´æ˜¾æ—¶ï¼Œå·¦çœ¼å’Œå³çœ¼æ¥æ”¶åˆ°çš„æ˜¾ç¤ºå±çš„å›¾åƒç•¥æœ‰å·®å¼‚ï¼Œç›¸å½“äºå¯¹ç°å®ä¸–ç•Œä¸­å·¦å³çœ¼æ¥æ”¶åˆ°ä¿¡æ¯çš„å·®å¼‚ï¼Œå³æ¨¡æ‹Ÿè§†å¯Ÿï¼Œæ¨¡æ‹Ÿå‡ºæ¥çš„è§†å·®åœ¨å¤§è„‘ä¸­åˆæˆäº†ç«‹ä½“çš„è§†è§‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯SteareoEffectçš„æ•ˆæœä¸ºåŒå±æ¸²æŸ“çš„åŸºæœ¬åŸç†ã€‚"},{"title":"RenderPass && EffectComposer","path":"/wiki/ThreeJs/official_doc_02_RenderPass.html","content":"æ¸²æŸ“é€šé“ç‰¹æ•ˆç»„åˆåŸç† å®˜æ–¹æ¡ˆä¾‹å®˜æ–¹æ¡ˆä¾‹ 1ï¼šç‚¹åŒ– + RGBè‰²è°ƒåˆ†ç¦»æ¡ˆä¾‹åœ°å€ ä»£ç å®ç°è§£æ 1.æ·»åŠ éšæœºç‰©ä½“"},{"title":"material æè´¨","path":"/wiki/ThreeJs/official_doc_03_material.html","content":"æè´¨é€šç”¨å±æ€§flatShading å¹³é¢ç€è‰²flat shadingåŸç†ä½¿ç”¨FlatShadingæ¸²æŸ“æè´¨ï¼Œå®ç°å¹³é¢åå…‰çš„æ•ˆæœå®ç°æ•ˆæœï¼š æ›´ç¡¬æœ—ã€å‡ ä½•æ„Ÿæ›´å¼ºçš„å¤–è§‚ï¼ˆç±»ä¼¼äºç¡¬é˜´å½±çš„æ•ˆæœï¼‰æ³¢å…‰ç²¼ç²¼çš„é—ªå…‰æ„Ÿ"},{"title":"multiple å¤šåœºæ™¯","path":"/wiki/ThreeJs/official_doc_04_multiple.html","content":"MultipleåŠ è½½å¤šä¸ªåœºæ™¯Sceneå®˜æ–¹æ¡ˆä¾‹"},{"title":"loader åŠ è½½å™¨","path":"/wiki/ThreeJs/official_doc_05_loader.html","content":"PCDLoaderPCDLoader å®˜æ–¹æ–‡æ¡£æ–‡ç« ï¼šPCDæ ¼å¼ä»‹ç»Point Cloud Data ç‚¹äº‘æ ¼å¼æ–‡ä»¶åˆ†ä¸ºæ–‡ä»¶å¤´å’Œæ•°æ®éƒ¨åˆ†ï¼Œéœ€è¦æ ¹æ®æ–‡ä»¶å¤´æ¥è§£ææ•°æ®éƒ¨åˆ†"},{"title":"NEXT TO 2037","path":"/wiki/ThreeJs/rec_01_NEXT_TO_2037.html","content":"å±•ç¤ºåœ°å€ æŠ€æœ¯æ ˆä»‹ç» ç½‘ç«™æ¡†æ¶ï¼šnext-reactåŠ¨ç”»å…ƒç´ ï¼šlottiedomåŠ¨ç”»ï¼šgsapèƒŒæ™¯ï¼šthreejs 3Dç‰©ä½“æ—‹è½¬èƒŒæ™¯ä½¿ç”¨threejsåˆ›å»ºçš„åœºæ™¯ï¼Œç”¨åˆ°çš„æ˜¯ å®˜ç½‘æ¡ˆä¾‹ç”¨æ»¤é•œå¤„ç†å¤šä¸ªå‡ ä½•ä½“æ—‹è½¬çš„åœºæ™¯ç”»é¢ï¼šå…³é”®ç‚¹1ï¼šåœºæ™¯æ­å»ºå…³é”®ç‚¹2ï¼šå‡ ä½•æè´¨å’Œä½ç½®å…³é”®ç‚¹3ï¼šæ»¤é•œsceneã€cameraã€rendereråŸºé…åœºæ™¯åŠ ä¸Šfogæ›´æœ‰ç©ºé—´æ™¯æ·±æ„ŸåŠ ä¸Šç¯å¢ƒå…‰å’Œç›´å°„å…‰scene = new THREE.Scene()camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 1000)camera.position.z = 400camera.lookAt(0,0,0)scene.add(camera)renderer = new THREE.WebGLRenderer(antialias:true)renderer.setPixelRatio(window.devicePixelRatio)renderer.setSize(window.innerWidth, window.innerHeight)renderer.setClearColor(0x000000, 1)renderer.setAnimationLoop(animation)canvasRef?.current?.appendChild(renderer.domElement)const fog = new THREE.Fog(0x000000, 1, 1000)scene.fog = fogconst ambientLight = new THREE.AmbientLight(0xcccccc)scene.add(ambientLight)const directionLight = new THREE.DirectionalLight(0xffffff,3)directionLight.position.set(1,1,1)scene.add(directionLight)æè´¨å¼€å¯ flatShading é€ç‰‡å…ƒæ¸²æŸ“ï¼Œå¢å¼ºå¤šè¾¹ä½“ç¡¬æœ—çš„å°è±¡åˆ›å»ºç‰©ä½“ï¼Œå¹¶è¿›è¡Œéšæœºæ˜ å°„ï¼šå°†ç‰©ä½“åæ ‡æ˜ å°„åˆ°[-1,1]ä¹‹é—´çš„éšæœºä½ç½®å°†ç‰©ä½“åæ ‡ç¼©æ”¾åˆ°[0, 400]ä¹‹é—´éšæœºçš„å¤§å°å°†ç‰©ä½“éšæœºç¼©æ”¾[1,50]ä¹‹é—´çš„å¤§å°å°†ç‰©ä½“æ²¿xã€yã€zè½´è¿›è¡Œéšæœºæ—‹è½¬const geometry = new THREE.SphereGeometry(1,4,4)const material = new THREE.MeshPhongMaterial( color:0xffffff, flatShading:true)object = new THREE.Object3D()for(let i = 0;i 100 ; i++) const element = new THREE.Mesh(geometry,material) // normalize è§„èŒƒåŒ– element.position.set( Math.random()-0.5, Math.random()-0.5, Math.random()-0.5, ).normalize() // éšæœºæ˜ å°„ element.position.multiplyScalar(Math.random() * 400) const scale = Math.random() * 50 element.scale.set(scale,scale ,scale) element.rotation.set( Math.random()*2, Math.random()*2, Math.random()*2, ) object.add(element)scene.add(object)RenderPass EffectComposeræ·»åŠ 2å±‚æ»¤é•œï¼šDotScreenShader ç‚¹åŒ–æ»¤é•œRGBShiftShader rgpåˆ†ç¦»æ»¤é•œcomposer = new EffectComposer(renderer)composer.addPass(new RenderPass(scene, camera))const effect1 = new ShaderPass(DotScreenShader)effect1.uniforms[scale].value = 4composer.addPass(effect1)const effect2 = new ShaderPass(RGBShiftShader)effect2.uniforms[amount].value = 0.003composer.addPass(effect2)const effect3 = new OutputPass()composer.addPass(effect3) lottieåŠ¨ç”»lottie-react å®˜ç½‘æ–‡æ¡£ä¸ºäº†åœ¨reactä¸­æ›´æ–¹ä¾¿çš„ä½¿ç”¨Lottieï¼Œå¯ä»¥ç›´æ¥å®‰è£…lottie-reactåº“ï¼šnpm i lottie-reactlottieç»„ä»¶å±•ç¤ºåŠ¨ç”»éœ€è¦ç”¨åˆ°çš„jsonåŠ¨ç”»æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ LottieFiles ä¸­è·å–ï¼Œç½‘ç«™ä¸­æœ‰å¾ˆå¤šè‰ºæœ¯å®¶åˆ†äº«çš„å¼€æºåŠ¨ç”»ã€‚å°†åŠ¨ç”»jsonæ–‡ä»¶ç›´æ¥å¼•å…¥ï¼Œæ³¨å…¥Lottieç»„ä»¶çš„animationDataå±æ€§ä¸­ï¼Œå°±èƒ½å®ç°lottieåŠ¨ç”»ï¼šimport AppleAnimation from ./Apple_Animation.jsonimport Lottie from lottie-reactexport default function Page() return ( Lottie animationData=AppleAnimation / ) GSAPåŠ¨ç”»æ•ˆæœå®˜ç½‘ä»‹ç»å®‰è£…gsapåº“npm i @gsap/react, gsapæ³¨å†Œgsapæ’ä»¶ï¼šimport gsap from gsap;gsap.registerPlugin(useGSAP);"},{"title":"Custom Mouse è‡ªå®šä¹‰Cursor","path":"/wiki/ThreeJs/rec_02_Custom_Mouse.html","content":"é¡¹ç›®ä»‹ç»é¡¹ç›®åœ°å€ èµ„æºé“¾æ¥ three webgl loader pcdCodePenå‚è€ƒé“¾æ¥Custom Dot Cursor è‡ªå®šä¹‰å…‰æ ‡CodePen Home star background mouse hover ver.2 èƒŒæ™¯ç§»åŠ¨LottieåŠ¨ç”»æ¥æºï¼šFree 3D Shape Animation AnimationFree App Loading Animation 03 AnimationFree Background looping animation AnimationFree click Animationå­—ä½“èµ„æºï¼šOrbitron è‡ªå®šä¹‰Cursorå‚è€ƒCodePen htmlcssjsåœ¨å…‰æ ‡ç§»åŠ¨çš„çˆ¶å®¹å™¨Pageä¸­ï¼Œåˆ›å»ºè‡ªå®šä¹‰å…‰æ ‡å®¹å™¨ï¼šbody class=body-content!-- å…‰æ ‡å¤–ç¯ -- div class=cursor-dot-outline/div!-- å…‰æ ‡ç„¦ç‚¹ -- div class=cursor-dot/div/bodyåŠ ä¸Šéšæ„æ ·å¼ï¼Œæœ€å¥½æ˜¯è½®å»“çº¿æ¡æµç•…çš„å½¢çŠ¶ï¼š:root --primary:#00ff2a;body width:50vw; height:50vh; overflow:hidden; position:relative; cursor:none.cursor-dot-outline,.cursor-dot position:absolute; pointer-events: none; top:0; left:0; border-radius:50%; transform:translate(-50%, -50%); opacity: 0; transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;.cursor-dot-outline width:50px; height: 50px; background:rgb(from var(--primary) r g b / 0.2);.cursor-dot width:8px; height:8px; background:var(--primary);è®¾è®¡æ§åˆ¶å…‰æ ‡çš„ç±»ï¼Œéœ€è¦æ³¨æ„ä¸€äº›äº¤äº’äº‹ä»¶çš„è§¦å‘æ—¶æœºï¼šé¼ æ ‡ç‚¹å‡»äº‹ä»¶æ•ˆæœï¼šç‚¹å‡»è½®å»“å˜å¤§ï¼Œç„¦ç‚¹å˜å°ï¼Œæ¾å¼€æ¢å¤åŸæ ·ç»‘å®šäº‹ä»¶ï¼šmousedownmouseupé¼ æ ‡è¿›å…¥å’Œäº¤äº’å…ƒç´ äº‹ä»¶æ•ˆæœï¼šç§»å…¥è½®å»“å˜å¤§ï¼Œç„¦ç‚¹å˜å°ï¼Œç§»å‡ºæ¢å¤åŸæ ·ç»‘å®šäº‹ä»¶ï¼šäº¤äº’å…ƒç´ çš„mouseovermouseleaveé¼ æ ‡è¿›å…¥ç¦»å¼€å±å¹•äº‹ä»¶æ•ˆæœï¼šè¿›å…¥å±å¹•é€æ˜åº¦ä¸º1ï¼Œç¦»å¼€å±å¹•é€æ˜åº¦ä¸º0ç»‘å®šäº‹ä»¶ï¼šmouseentermouseleaveé¼ æ ‡ç§»åŠ¨äº‹ä»¶æ•ˆæœï¼šç§»åŠ¨é¼ æ ‡ï¼Œç„¦ç‚¹å®šä½ï¼Œè½®å»“è·Ÿéšç»‘å®šäº‹ä»¶ï¼šmousemoveclass Cursor /** * contentDom å®¹å™¨dom * dotDom ç„¦ç‚¹dom * outlineDom è½®å»“dom */ constructor(contentDom, dotDom, outlineDom) /** * _x è½®å»“åœ†çš„xåæ ‡ */ this. _x = 0 /** * _y è½®å»“åœ†çš„yåæ ‡ */ this._y = 0 /** * endX é¼ æ ‡ç„¦ç‚¹çš„xåæ ‡ */ this.endX = window.innerWidth / 2 /** * endY é¼ æ ‡ç„¦ç‚¹çš„yåæ ‡ */ this.endY = window.innerHeight / 2 /** * delay å»¶è¿Ÿçš„æ­¥æ•° */ this.delay = 8 /** * cursorVisible è‡ªå®šä¹‰å…‰æ ‡å¯è§åº¦ */ this.cursorVisible = true /** * cursorEnlarged è‡ªå®šä¹‰å…‰æ ‡æ˜¯å¦æ”¾å¤§ */ this.cursorEnlarged = false; /** * $content é¼ æ ‡å®¹å™¨dom */ this.$content = contentDom /** * $dot ç„¦ç‚¹dom */ this.$dot = dotDom /** * $outline å¤–è½®å»“dom */ this.$outline = outlineDom /** * dotSize ç„¦ç‚¹å®½åº¦ */ this.dotSize = dotDom.offsetWidth /** * outlineSize å¤–è½®å»“å®½åº¦ */ this.outlineSize = outlineDom.offsetWidth this.setupEventListeners() this.updateOutlineDot() /** * ç»‘å®šæ³¨å†Œäº‹ä»¶ */ setupEventListeners() this.$content.querySelectorAll(a).forEach(el= el.addEventListener(mouseover, ()= this.cursorEnlarged = true this.toggleCursorSize() ) el.addEventListener(mouseout,()= this.cursorEnlarged = false this.toggleCursorSize() ) ) this.$content.addEventListener(mousedown,()= this.cursorEnlarged = true this.toggleCursorSize() ) this.$content.addEventListener(mouseup,()= this.cursorEnlarged = false this.toggleCursorSize() ) this.$content.addEventListener(mouseenter,()= this.cursorVisible = true this.toggleCursorVisibility() ) this.$content.addEventListener(mouseleave,()= this.cursorVisible = false this.toggleCursorVisibility() ) this.$content.addEventListener(mousemove,e= const rect = e.target.getBoundingClientRect() this.endX = rect.left + e.offsetX this.endY = rect.top + e.offsetY // console.log(`RectLeft=$rect.left RectTop=$rect.top OffsetX=$e.offsetX OffsetY=$e.offsetY`) this.$dot.style.top = `$this.endYpx` this.$dot.style.left = `$this.endXpx` ) /** * æ›´æ–°OutlineDotçš„ä½ç½® */ updateOutlineDot() this._x += (this.endX - this._x) / this.delay this._y += (this.endY - this._y) / this.delay this.$outline.style.top = `$this._ypx` this.$outline.style.left = `$this._xpx` requestAnimationFrame(this.updateOutlineDot.bind(this)) /** * åˆ‡æ¢cursorçš„å°ºå¯¸ */ toggleCursorSize() if(this.cursorEnlarged) this.$dot.style.transform = `translate(-50%, -50%) scale(0.7)` this.$outline.style.transform = `translate(-50%, -50%) scale(1.5)` else this.$dot.style.transform = `translate(-50%, -50%) scale(1)` this.$outline.style.transform = `translate(-50%, -50%) scale(1)` /** * åˆ‡æ¢cursorçš„æ˜¾éš */ toggleCursorVisibility() if(this.cursorVisible) this.$dot.style.opacity = 1 this.$outline.style.opacity = 1 else this.$dot.style.opacity = 0 this.$outline.style.opacity = 0 èƒŒæ™¯è·Ÿéšé¼ æ ‡æ™ƒåŠ¨å‚è€ƒCodePen èƒŒæ™¯å›¾ç‰‡domï¼šbody div class=background-image/div/bodyæ·»åŠ æ ·å¼ï¼Œæ³¨æ„èƒŒæ™¯å›¾ç‰‡éœ€è¦æ¯”çˆ¶å®¹å™¨ç¨å¾®å¤§ä¸€äº›ï¼Œè¿™æ ·å³ä¾¿åœ¨ä¸Šä¸‹å·¦å³æ™ƒåŠ¨æ—¶å›¾ç‰‡ä¹Ÿä¸ä¼šè¢«æ™ƒå‡ºçˆ¶å®¹å™¨ï¼š* margin:0; padding:0; background-repeat: no-repeat; background-size:cover;body width:100vw; height:100vh; overflow:hidden;.background-image width:120%; height:120%; background-image: url(./mountains.jpg);æ·»åŠ é¼ æ ‡è·Ÿéšæ™ƒåŠ¨jsè„šæœ¬ï¼Œæ ¸å¿ƒæ–¹æ³•å°±æ˜¯å°†é¼ æ ‡ç›¸å¯¹å±å¹•çš„åæ ‡ï¼Œè½¬æ¢ä¸ºèƒŒæ™¯å›¾ç‰‡çš„åç§»é‡ã€‚const bg = document.querySelector(body)let mouse_endX = 0, mouse_endY = 0let mouse_x = 0, mouse_y = 0let delay = 10bg.addEventListener(mousemove, e= // å°†é¼ æ ‡ç§»åŠ¨çš„ç»å¯¹è·ç¦»ç”± [0, 1] æ˜ å°„åˆ° [0, 10] ä¸Š mouse_endX = e.clientX / window.innerWidth * 10 mouse_endY = e.clientY / window.innerHeight * 10)// è·Ÿéšæ•ˆæœfunction updateBackPosition() mouse_x += (mouse_endX - mouse_x) / delay mouse_y += (mouse_endY - mouse_y) / delay bg.style.transform = `translate3d($-mouse_x%, $-mouse_y%, 0)` requestAnimationFrame(updateBackPosition)updateBackPosition() å…¶å®ƒ3Dæ¨¡å‹éƒ¨åˆ†çš„å®ç°ä½¿ç”¨çš„æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒPCDLoaderéƒ¨åˆ†çš„Demoå®˜æ–¹DemoPCDLoader é¼ æ ‡ç‚¹å‡»æ•ˆæœæ·»åŠ é¼ æ ‡ç‚¹å‡»å‡ºå‡ºç°çš„æ³¢çº¹åŠ¨ç”»ä¸ºæ˜¯ç”¨Lottieå®ç°çš„ï¼Œæ€è·¯å°±æ˜¯åœ¨è·å–é¼ æ ‡ç‚¹å‡»å¤„çš„åæ ‡ï¼Œåœ¨ç‚¹å‡»æ•°ç»„ä¸­æ·»åŠ æ–°çš„ç‚¹ä½ï¼Œé¡µé¢æ ¹æ®ç‚¹å‡»æ•°ç»„å“åº”å¼æ¸²æŸ“æ–°Lottieç»„ä»¶ï¼Œç›‘å¬Lottieç»„ä»¶çš„onCompleteäº‹ä»¶ï¼Œç¡®ä¿åœ¨åŠ¨ç”»æ’­æ”¾ç»“æŸä¹‹ååˆ é™¤ç‚¹å‡»æ•°æ®ï¼šimport Lottie from lottie-react;import Animation_Clicking from @/assets/Animation/Animation_Clicking.json;interface ConfettiVO /** * ç¤¼èŠ±å”¯ä¸€æ ‡è¯† */ id:number, /** * xåæ ‡ */ x:number, /** * yåæ ‡ */ y:number// ç‚¹å‡»å°ºå¯¸const confetti_w = 100, confetti_h = 100;let idCounter = 0;export default function CustomDotCursorComp() /** * é¼ æ ‡ç‚¹å‡»ï¼Œæ–°å¢æ•ˆæœ */ const [confettiList, setConfettiList] = useStateConfettiVO[]([]) function addConfetti(event: any): any const newConfetti: ConfettiVO = id: idCounter++, x: event.pageX, y: event.pageY, setConfettiList([...confettiList, newConfetti]) /** * åŠ¨ç”»æ’­æ”¾ç»“æŸï¼Œå°†ç‚¹ä½æ¸…é™¤ * @param confetti */ function animationComplete(confetti: ConfettiVO) setConfettiList(confettiList.filter(point = point.id !== confetti.id)) return ( div onMouseDown=addConfetti confettiList.map((point) = return Lottie key=point.id animationData=Animation_Clicking className=styles[mouse-confetti] style= top: `$point.ypx`, left: `$point.xpx`, width: `$confetti_wpx`, height: `$confetti_hpx` loop=false onComplete=() = animationComplete(point) / ) div/ )clickäº‹ä»¶bugè¿™éƒ¨åˆ†æ•ˆæœçš„å®ç°å­˜åœ¨ä¸€ä¸ªbugï¼Œå°±æ˜¯è‡ªå®šä¹‰å…‰æ ‡ç›‘å¬äº†ç„¦ç‚¹çš„mousedownå’Œmouseupäº‹ä»¶ï¼Œé¼ æ ‡ç‚¹ä¸‹å’ŒæŠ¬èµ·æ„æˆä¸€ä¸ªå®Œæ•´çš„è§¦å‘æ•ˆæœï¼Œä½†æ˜¯åŒæ—¶åœ¨é¼ æ ‡ç‚¹ä¸‹æ—¶åˆ›å»ºäº†ä¸€ä¸ªæ³¢çº¹æ•ˆæœï¼Œæ³¢çº¹æ•ˆæœdomé®ç›–ä½äº†é¼ æ ‡çš„mouseupäº‹ä»¶çš„è§¦å‘ï¼Œæ‰€ä»¥å¯¼è‡´é¼ æ ‡ç‚¹ä¸‹çš„ç¼©æ”¾æ•ˆæœæ— æ³•æ­£å¸¸å®ç°ã€‚è§£å†³æ–¹æ³•ï¼šå°†æ³¢çº¹æ•ˆæœdomçš„csså±æ€§point-eventè®¾ç½®ä¸ºnone"},{"title":"WebGLæ¦‚è¿°","path":"/wiki/WebGL/chapter_01_01.html","content":"æœ¬ä¹¦æºç è®¿é—®åœ°å€ https://sites.google.com/site/webglbook/home/downloadshttps://sites.google.com/site/webglbook/home/downloads WebGLçš„èµ·æºPCå¸¸ç”¨ä¸‰ç»´å›¾å½¢æ¸²æŸ“æŠ€æœ¯ Direct3D å¾®è½¯DirectXæŠ€æœ¯çš„ä¸€éƒ¨åˆ†ä¸€å¥—ç”±å¾®è½¯æ§åˆ¶çš„ç¼–ç¨‹æ¥å£ç”¨äºWindowså¹³å°OpenGLå…è´¹å¼€æºï¼Œå¯ä»¥åœ¨Macintochã€Linuxã€Windowsç³»ç»Ÿä¸Šä½¿ç”¨æœ€åˆç”±SGIï¼ˆSilicon Graphics Incï¼‰å¼€å‘1992å¹´å‘å¸ƒä¸ºå¼€æºæ ‡å‡†OpenGL ESOpenGLçš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬ä¸“é—¨ç”¨äºåµŒå…¥å¼è®¾å¤‡2003~2004é¦–æ¬¡æå‡º2007 ESå‡çº§2.02012 ESå‡çº§3.0WebGLåŸºäºOpenGL ES 2.0 ç€è‰²å™¨ OpenGL 2.0æ”¯æŒäº†ä¸€é¡¹éå¸¸é‡è¦çš„ç‰¹æ€§ï¼šå¯ç¼–ç¨‹ç€è‰²å™¨æ–¹æ³•ï¼ˆprogrammable shader functionsï¼‰ ç€è‰²å™¨è¯­è¨€ï¼ˆshading languageï¼‰OpenGL ES 2.0 åŸºäº OpenGLç€è‰²å™¨è¯­è¨€ï¼ˆGLSLï¼‰ã€‚GLSL ä¹Ÿç§° OpenGL ESç€è‰²å™¨è¯­è¨€ï¼ˆGLSL ESï¼‰ã€‚WebGLä¹Ÿä½¿ç”¨GLSL ESç¼–å†™ç€è‰²å™¨ã€‚ æ›´æ–°ä¸æ ‡å‡†åŒ– OpenGLè§„èŒƒçš„æ›´æ–°ä¸æ ‡å‡†åŒ–ç”± Khronosç»„ç»‡ è´Ÿè´£ã€‚ç”±2011å¹´å‘å¸ƒäº†WebGLè§„èŒƒçš„ç¬¬1ä¸ªç‰ˆæœ¬ã€‚ WebGLç¨‹åºçš„ç»“æ„WebGLé¡µé¢åŒ…å«ä¸‰ç§è¯­è¨€ï¼š HTML5 JavaScript GLSL ES å¯¹æ¯”ä¼ ç»Ÿç½‘é¡µä¸WebGLç½‘é¡µçš„ç»“æ„ é€šå¸¸GLSL ESæ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼åœ¨JSä¸­ç¼–å†™çš„ï¼Œå› æ­¤WebGLç½‘é¡µä¸ä¼ ç»Ÿç½‘é¡µç»“æ„ç›¸åŒï¼Œåªç”¨åˆ°HTMLæ–‡ä»¶ å’Œ JavaScriptæ–‡ä»¶ã€‚"},{"title":"Custom_Cursor_Switch è‡ªå®šä¹‰å…‰æ ‡åˆ‡æ¢","path":"/wiki/ThreeJs/rec_03_Custom_cursor_switch.html","content":"é¡¹ç›®åœ°å€ èµ„æºé“¾æ¥ CodePenå‚ç…§é“¾æ¥ï¼šKyle Brumm | Custom Dot CursorFuzionix | Curzr | Free cursor libraryå­—ä½“èµ„æºï¼š é¡µé¢ä»‹ç»å¤§éƒ¨åˆ†å‚è€ƒçš„Fuzionix | Curzr | Free cursor libraryå¤–åœˆè·Ÿè¸ªå†…ç‚¹æ•ˆæœå‚è€ƒçš„æ˜¯Kyle Brumm | Custom Dot Cursoråç»­å¾…ä¼˜åŒ–éƒ¨åˆ†ï¼šæ‰‹æœºç«¯touchäº‹ä»¶é€‚é…å°è£…æˆnpmç»„ä»¶åº“æ·»åŠ æ–°é¼ æ ‡æ•ˆæœ"},{"title":"WebGLå…¥é—¨","path":"/wiki/WebGL/chapter_02_01.html","content":"Canvasæ˜¯ä»€ä¹ˆï¼Ÿcanvasæ ‡ç­¾å®šä¹‰äº†ç½‘é¡µä¸Šçš„ç»˜ç”»åŒºåŸŸ canvasæ ‡ç­¾çš„å¼•ç”¨å°±åƒè¿™æ ·ï¼š canvas id=example width=500 height=500å¯¹äºä¸æ”¯æŒcanvasæ ‡ç­¾çš„è€å¼æµè§ˆå™¨ï¼Œä¼šæ˜¾ç¤ºè¿™æ¡é”™è¯¯ä¿¡æ¯/canvas ä½¿ç”¨canvasç»˜åˆ¶çŸ©å½¢ DrawRectangleç»˜åˆ¶ç»“æœHTML!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title/headbody onload=main()canvas id=example width=400 height=400 Please use a browser that supports canvas/canvasscript src=DrawRectangle.js/script/body/htmlJavaScript// DrawRecrangle.jsfunction main() var canvas = document.getElementById(example); if(!canvas) console.log(Failed to retrieve the canvas element) return false; // get the rendering context for 2DCG var ctx = canvas.getContext(2d); ctx.fillStyle = rgba(0,0,255,1.0); //set color ctx.fillRect(120,10,150,150); //fill a rectangeleæ­¥éª¤åˆ†è§£æ­¥éª¤1 è·å–canvaså…ƒç´ var canvas = document.getElementById(example);if(!canvas) console.log(Failed to retrieve the canvas element); return false;æ­¥éª¤2 å‘è¯¥å…ƒç´ è¯·æ±‚äºŒç»´ä¸‰ç»´å›¾å½¢çš„â€œç»˜å›¾ä¸Šä¸‹æ–‡â€var ctx = canvas.getContext(2d);ä¸Šä¸‹æ–‡ contextgetContext() çš„å‚æ•°ç”¨äºæŒ‡å®šä¸Šä¸‹æ–‡ç±»å‹ï¼Œæœ‰ä¸¤ç§ç±»å‹ï¼š äºŒç»´ä¸‰ç»´æ­¥éª¤3 åœ¨ç»˜å›¾ä¸Šä¸‹æ–‡è°ƒç”¨ç›¸åº”ç»˜å›¾å‡½æ•°ctx.fillStyle = rgba(0,0,255,1.0);ctx.fillRect(120,10,150,150);canvasçš„åæ ‡ç³»ç»Ÿxè½´ åæ ‡ç³»æ¨ªè½´ï¼Œæ­£æ–¹å‘æœâ†’yè½´ åæ ‡ç³»çºµè½´ï¼Œæ­£æ–¹å‘æœâ†“åŸç‚¹ è½åœ¨å·¦ä¸Šæ–¹ fillRectçš„å‚æ•°param1 çŸ©å½¢å·¦ä¸Šé¡¶ç‚¹xåæ ‡param2 çŸ©å½¢å·¦ä¸Šé¡¶ç‚¹yåæ ‡param3 çŸ©å½¢å®½åº¦param4 çŸ©å½¢é«˜åº¦ æœ€çŸ­çš„WebGLç¨‹åºï¼šæ¸…ç©ºç»˜å›¾åŒºHelloCanvas code æ¸…ç©ºç»˜å›¾åŒºæ•ˆæœHelloCanvas.htmlHelloCanvas.jsbody onload=main() canvas id=webgl width=400 height=400 Come on! Why you still use your grammys browser? /canvas script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/cuon-utils.js/script script src=./HelloCanvas.js/script/bodyfunction main() // è·å–canvaså…ƒç´  var canvas = document.getElementById(webgl); // è·å–WebGLç»˜å›¾ä¸Šä¸‹æ–‡ var gl = getWebGLContext(canvas); if (!gl) console.log(Congratulate! You meet a bug!) return; // æŒ‡å®šæ¸…ç©ºcanvasé¢œè‰² gl.clearColor(0.0, 0.0, 0.0, 1.0); // æ¸…ç©ºcanvas gl.clear(gl.COLOR_BUFFER_BIT);æ­¥éª¤åˆ†è§£è·å–canvaså…ƒç´ let canvas = document.getElementById(webgl);è·å–WebGLç»˜å›¾ä¸Šä¸‹æ–‡getContext å’Œ getWebGLContext getContextæ¥æ”¶çš„å‚æ•°ï¼ˆâ€™2dâ€™â€˜3dâ€™â€™ï¼‰åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸­ä¸åŒã€‚let gl = canvas.getContext(2d); getWebGLContextåœ¨å¼•å…¥çš„cuon-utils.jsä¸­ï¼Œç”¨äºéšè—ä¸åŒæµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ã€‚let gl = getWebGLContext(canvas); ä¸Šä¸‹æ–‡å‘½åæŠ€å·§ä¹‹æ‰€ä»¥æœ‰äººä¹ æƒ¯å°†ç»˜å›¾ä¸Šä¸‹æ–‡å‘½åä¸ºglï¼Œæ˜¯å› ä¸º WebGL æ˜¯åŸºäº OpenGL ES çš„ï¼Œè¿™æ ·å¯ä»¥å°†ä¸¤è€…çš„å‡½æ•°åå¯¹åº”èµ·æ¥ï¼Œæ¯”å¦‚ï¼šgl.clearColor() ä¸ glClearColor()è®¾ç½®èƒŒæ™¯è‰²gl.clearColor(0.0, 0.0, 0.0, 1.0);é¢œè‰²åˆ†é‡å–å€¼ç»§æ‰¿è‡ªOpenGLï¼Œå› æ­¤èŒƒå›´åœ¨0.0-1.0ï¼ŒRGBé¢œè‰²è¶Šé«˜å°±è¶Šäº®ã€‚æ¸…ç©ºcanvasgl.clear(gl.COLOR_BUFFER_BIT);BUFFERç”±äºclearç»§æ‰¿è‡ªOpenGLï¼ŒåŸºäºå¤šåŸºæœ¬ç¼“å†²åŒºæ¨¡å‹ï¼Œæ¯”äºŒç»´ç»˜å›¾ä¸Šä¸‹æ–‡è¦å¤æ‚ã€‚æ¸…ç©ºç»˜å›¾åŒºåŸŸï¼Œå®é™…ä¸Šæ˜¯æ¸…ç©ºé¢œè‰²ç¼“å†²åŒºï¼ˆcolor bufferï¼‰ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•æ¸…ç©ºå¯¹åº”ç¼“å†²åŒºï¼š"},{"title":"ç»˜åˆ¶ä¸€ä¸ªç‚¹","path":"/wiki/WebGL/chapter_02_02.html","content":"HelloPoint1ç€è‰²å™¨ï¼ˆshaderï¼‰ å¦‚æœè¦åœ¨ç»˜å›¾åŒºåŸŸä¸­å¿ƒç»˜åˆ¶ä¸€ä¸ªçº¢ç‚¹,ç†è®ºä¸Šåªéœ€è¦ä¸¤æ­¥ï¼šæŒ‡å®šç‚¹çš„é¢œè‰²æŒ‡å®šç‚¹çš„ä½ç½®å’Œå¤§å°gl.drawColor(1.0, 0.0, 0.0, 1.0);gl.drawPoint(0, 0, 0, 10);ä¸å¹¸çš„æ˜¯ï¼ŒWebGLä¾èµ–ä¸€ç§ç§°ä¸º**ç€è‰²å™¨ï¼ˆshaderï¼‰**çš„ç»˜å›¾æœºåˆ¶ï¼Œshaderå¼ºå¤§ä¸”å¤æ‚ï¼Œä»…ç”¨ä¸€æ¡ç®€å•ç»˜å›¾å‘½ä»¤æ— æ³•æ“ä½œã€‚ HelloPoint1 Code ç‚¹ç»˜æ•ˆæœHelloPoint1.htmlHelloPoint1.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=./HelloPoint1.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/cuon-utils.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨ç¨‹åºvar VSHADER_SOURCE = ` void main() gl_Position = vec4(0.0,0.0,0.0,1.0); //è®¾ç½®åæ ‡ gl_PointSize = 10.0; //è®¾ç½®å°ºå¯¸ `;//ç‰‡æºç€è‰²å™¨ç¨‹åºvar FSHADER_SOURCE = ` void main() gl_FragColor = vec4(1.0, 0.0 ,0.0 ,1.0); //è®¾ç½®é¢œè‰² `;function main() // è·å–canvaså…ƒç´  var canvas = document.getElementById(webgl); // è·å–WebGLç»˜å›¾ä¸Šä¸‹æ–‡ var gl = getWebGLContext(canvas); if (!gl) console.log(ç»˜å›¾ä¸Šä¸‹æ–‡è·å–å¤±è´¥); return; // åˆå§‹åŒ–ç€è‰²å™¨ if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è®¾ç½®ç”»æ¿èƒŒæ™¯è‰² gl.clearColor(0.0, 0.0, 0.0, 1.0); // æ¸…ç©ºç”»æ¿ gl.clear(gl.COLOR_BUFFER_BIT); // ç»˜åˆ¶ç‚¹ gl.drawArrays(gl.POINTS, 0, 1); ä»€ä¹ˆæ˜¯ç€è‰²å™¨ï¼ŸWhat is shader? é¡¶ç‚¹ç€è‰²å™¨ç‰‡å…ƒç€è‰²å™¨Vertex shaderæè¿°èŒƒå›´ï¼š é¡¶ç‚¹ç‰¹æ€§ï¼ˆå¦‚ä½ç½®ã€é¢œè‰²ç­‰ï¼‰é¡¶ç‚¹ï¼ˆvertexï¼‰ï¼š äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼ˆå¦‚ç«¯ç‚¹ã€äº¤ç‚¹ç­‰ï¼‰Fragment shaderæè¿°èŒƒå›´ï¼š è¿›è¡Œé€ç‰‡å…ƒå¤„ç†è¿‡ç¨‹ï¼ˆå¦‚å…‰ç…§ç­‰ï¼‰ç‰‡å…ƒï¼ˆfragmentï¼‰ï¼š ç±»ä¼¼äºåƒç´ ï¼ˆå›¾åƒçš„å•å…ƒï¼‰ shaderç¨‹åºä»¥Stringçš„å½¢å¼åµŒå…¥åœ¨JavaScriptæ–‡ä»¶ä¸­ã€‚ Browseræ‰§è¡ŒJavaScriptçš„ç»˜åˆ¶æµç¨‹ ç®€åŒ–ç‰ˆæµç¨‹ ä½¿ç”¨shaderçš„WebGLç¨‹åºçš„ç»“æ„ é¡¶ç‚¹ç€è‰²å™¨ç‰‡å…ƒç€è‰²å™¨ä¸»ç¨‹åºVertex shader programvar VSHADER_SOURCE = ` void main() gl_Position = vec4(0.0,0.0,0.0,1.0); gl_PointSize = 10.0; `;Fragment shader programvar FSHADER_SOURCE = ` void main() gl_FragColor = vec4(1.0,0.0,0.0,1.0); `;Main programfunction main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, 1); æ­¥éª¤åˆ†è§£ 1.è·å–canvaså…ƒç´ let canvas = document.getElementById(webgl);2.è·å–WebGLç»˜å›¾ä¸Šä¸‹æ–‡let gl = getWebGLContext(canvas);3.åˆå§‹åŒ–ç€è‰²å™¨initShaders(gl,VSHADER_SOURCE,FSHADER_SOURCE);initShadersè¯¥å‡½æ•°è¢«å®šä¹‰åœ¨ cuon.util.js ä¸­ã€‚initShaders()çš„è¡Œä¸ºä¸Šå›¾æœ‰å‡ ç‚¹éœ€è¦é‡ç‚¹æ³¨æ„çš„ï¼šç€è‰²å™¨è¿è¡Œåœ¨WebGLç³»ç»Ÿä¸­ï¼Œè€Œä¸æ˜¯JavaScriptç³»ç»Ÿä¸­ã€‚ç‰‡å…ƒç€è‰²å™¨æ¥æ”¶åˆ°çš„æ˜¯ç»è¿‡å…‰æ …åŒ–å¤„ç†åçš„ç‰‡å…ƒå€¼ã€‚WebGLç¨‹åºåŒ…æ‹¬è¿è¡ŒäºBrowserçš„JSå’Œè¿è¡ŒäºWebGLçš„shaderä¸¤ä¸ªéƒ¨åˆ†4.è®¾ç½®canvasèƒŒæ™¯è‰²gl.clearColor(0.0,0.0,0.0,1.0);5.æ¸…é™¤canvasgl.clear(gl.COLOR_BUFFER_BIT);6.ç»˜å›¾gl.drawArrays(gl.POINTS,0,1) åˆå§‹åŒ–shaderåå¦‚ä½•ç»˜å›¾ï¼Ÿ è¦ç”»ä¸€ä¸ªç‚¹ï¼Œä½ éœ€è¦3ä¸ªå…³é”®ä¿¡æ¯ï¼šä½ç½®å°ºå¯¸é¢œè‰²é¡¶ç‚¹ç€è‰²å™¨shaderç¨‹åºæœ¬èº«å¿…é¡»åŒ…å«ä¸€ä¸ª main å‡½æ•°ã€‚æ³¨æ„ï¼šgl_Positionå¿…é¡»èµ‹å€¼ï¼Œgl_PointSizeå¯é€‰ï¼Œé»˜è®¤å€¼ä¸º1.0é¡¶ç‚¹ç€è‰²å™¨çš„å†…ç½®å˜é‡é¡¶ç‚¹ç€è‰²å™¨å†…ç½®å˜é‡å¯¹åº”çš„GLESæ•°æ®ç±»å‹floatè¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨æµ®ç‚¹å½¢å¼çš„æ•°å­—è¿›è¡Œèµ‹å€¼ã€‚è¿™æ ·å†™å°±ä¼šå‡ºé”™ï¼šgl_PointSize = 10;vec4çŸ¢é‡ï¼ˆvectorï¼‰ï¼Œè¡¨ç¤ºç”±4ä¸ªæµ®ç‚¹æ•°ç»„æˆçš„çŸ¢é‡ï¼Œshaderæä¾›äº†å†…ç½®å‡½æ•° vec4() åˆ›å»ºvec4ç±»å‹çš„å˜é‡ã€‚é½æ¬¡åæ ‡æœ‰4ä¸ªåˆ†é‡ç»„æˆçš„çŸ¢é‡è¢«ç§°ä¸ºé½æ¬¡åæ ‡ã€‚ç‰‡å…ƒç€è‰²å™¨ç‰‡å…ƒå°±æ˜¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ä¸€ä¸ªåƒç´ ã€‚gl_FragColor æ˜¯ç‰‡å…ƒç€è‰²å™¨å”¯ä¸€çš„å†…ç½®å˜é‡ã€‚ç»˜åˆ¶æ“ä½œdrawArrays() å¯ä»¥ç”¨æ¥ç»˜åˆ¶å„ç§å›¾å½¢ã€‚ gl.drawArrays(gl.POINTS,0,1);ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆgl.POINTSï¼‰ï¼šè¡¨ç¤ºç»˜åˆ¶å•ç‚¹ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ0ï¼‰ï¼šä»ç¬¬1ä¸ªé¡¶ç‚¹å¼€å§‹ç»˜åˆ¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆ1ï¼‰ï¼šè¡¨ç¤ºä»…ç»˜åˆ¶1ä¸ªç‚¹ä¸€æ—¦Vertex_shaderæ‰§è¡Œå®Œæ¯•ï¼ŒFragment_shaderå°±å¼€å§‹æ‰§è¡Œ WebGLåæ ‡ç³»ç»ŸWebGLä½¿ç”¨çš„æ˜¯ä¸‰ç»´åæ ‡ç³»ç»Ÿï¼ˆç¬›å¡å°”åæ ‡ç³»ï¼‰ã€‚WebGLåæ ‡ç³»å³æ‰‹åæ ‡ç³»WebGLé»˜è®¤ä½¿ç”¨å³æ‰‹åæ ‡ç³»ï¼Œä½†å®é™…ä¸Šï¼ŒWebGLæœ¬èº«ä¸æ˜¯å·¦æ‰‹ä¹Ÿä¸æ˜¯å³æ‰‹åæ ‡ç³»ï¼Œè¦å¤æ‚å¾—å¤šã€‚å³æ‰‹åæ ‡ç³»åæ ‡æ˜ å°„éœ€è¦å°†WebGLçš„åæ ‡ç³»æ˜ å°„åˆ°canvasç»˜å›¾åŒºä¸­ã€‚åæ ‡å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼šWebGLåæ ‡canvasåæ ‡( 0.0, 0.0, 0.0)ä¸­å¿ƒç‚¹(-1.0, 0.0, 0.0)å·¦è¾¹ç¼˜( 1.0, 0.0, 0.0)å³è¾¹ç¼˜( 0.0, -1.0, 0.0)ä¸‹è¾¹ç¼˜( 0.0, 1.0, 0.0)ä¸Šè¾¹ç¼˜WebGLå’Œcanvasåæ ‡æ˜ å°„å…³ç³» HelloPoint2å¯¹æ¯”ç‰ˆæœ¬1å’Œç‰ˆæœ¬2 ç‰ˆæœ¬1ï¼š ç‚¹ä½ç¡¬ç¼–ç åœ¨Vertex Shaderä¸­ç‰ˆæœ¬2ï¼š ç‚¹ä½åæ ‡ä»JSä¼ åˆ°Shaderç¨‹åºä¸­ attributeä¸uniform è¦å®ç°ä»JavaScriptç¨‹åºå‘Vertex_Shaderä¼ è¾“ä½ç½®ä¿¡æ¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°ï¼ˆä½¿ç”¨å“ªä¸€ä¸ªå–å†³äºéœ€ä¼ è¾“çš„æ•°æ®æœ¬èº«ï¼‰ï¼š attributeå˜é‡ä¼ è¾“çš„æ˜¯é‚£äº›ä¸é¡¶ç‚¹ç›¸å…³çš„æ•°æ®ã€‚ uniformå˜é‡ä¼ è¾“çš„æ˜¯é‚£äº›ä¸é¡¶ç‚¹æ— å…³çš„æ•°æ®ã€‚ ä½¿ç”¨attributeå˜é‡ attributeå˜é‡å®é™…ä¸Šæ˜¯ä¸€ç§ GLSL ES å˜é‡ï¼ŒåŠŸèƒ½å°±æ˜¯è¢«ç”¨æ¥ ä»å¤–éƒ¨å‘Vertex_Shaderå†…éƒ¨ä¼ è¾“æ•°æ® ã€‚ä½¿ç”¨attributeéœ€è¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼šå£°æ˜ï¼š åœ¨Vertex_Shaderä¸­å£°æ˜attributeå˜é‡ã€‚èµ‹å€¼ï¼š å°†attributeå˜é‡èµ‹å€¼ç»™gl_Positionå˜é‡ã€‚ä¼ è¾“ï¼š å‘attributeå˜é‡ä¼ è¾“æ•°æ®ã€‚ HelloPoint2 Code HelloPoint2è¿è¡Œç»“æœHelloPoint2.htmlHelloPoint2.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/cuon-utils.js/script script src=./HelloPoint2.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;// ç‰‡æºç€è‰²å™¨var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,1.0); `;function main() // è·å–canvaså…ƒç´  var canvas = document.getElementById(webgl); // è·å–WebGLä¸Šä¸‹æ–‡ var gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; // åˆå§‹åŒ–ç€è‰²å™¨ if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(åˆå§‹åŒ–ç€è‰²å™¨å¤±è´¥); return; // è·å–attributeå˜é‡çš„å­˜å‚¨ä½ç½® var a_Position = gl.getAttribLocation(gl.program, a_Position); if (a_Position 0) console.log(Failed to get the storage location of a_Position); return; // å°†é¡¶ç‚¹ä½ç½®ä¼ è¾“ç»™attributeå˜é‡ gl.vertexAttrib3f(a_Position, 0.0, 0.0, 0.0); // è®¾ç½®canvasèƒŒæ™¯è‰² gl.clearColor(0.0, 0.0, 0.0, 1.0); // æ¸…é™¤canvas gl.clear(gl.COLOR_BUFFER_BIT); // ç»˜åˆ¶ç‚¹ä½ gl.drawArrays(gl.POINTS, 0, 1); attributeä½¿ç”¨æ­¥éª¤è¯¦è§£ æ­¥éª¤ä¸€ï¼šå£°æ˜attributeåˆç§° å­˜å‚¨é™å®šç¬¦ ï¼ˆstorage qualifierï¼‰ã€‚attributeå˜é‡å¿…é¡»å£°æ˜æˆå…¨å±€å˜é‡ï¼Œattributeå˜é‡å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š å­˜å‚¨é™å®šç¬¦ ç±»å‹ å˜é‡å attributeå˜é‡å£°æ˜æ ¼å¼ æ­¥éª¤äºŒï¼šè·å–æ¯ä¸ªå˜é‡éƒ½å…·æœ‰ä¸€ä¸ªå­˜å‚¨åœ°å€ï¼Œä»¥ä¾¿é€šè¿‡å­˜å‚¨åœ°å€å‘å˜é‡ä¼ è¾“æ•°æ®ã€‚ getAttribLocation() ç”¨äºè·å–attributeå˜é‡çš„åœ°å€ã€‚å…¶æ¥æ”¶2ä¸ªå‚æ•°ï¼š å‚æ•°1ï¼šç¨‹åºå¯¹è±¡ï¼ˆprogram objectï¼‰åªè¦å¼•ç”¨gl.programå³å¯ï¼ŒåŒ…æ‹¬äº†Vertex_Shaderå’ŒFrag_Shaderï¼Œç”± initShader() å‡½æ•°åˆ›å»ºï¼Œå› æ­¤å¿…é¡»åœ¨initShaderå‡½æ•°è°ƒç”¨ä¹‹åè®¿é—®ã€‚å‚æ•°2ï¼šattributeå˜é‡çš„å­˜å‚¨åœ°å€æ­¥éª¤ä¸‰ï¼šèµ‹å€¼ å¦‚æœå¯¹äºvec4ç±»å‹çš„å˜é‡é€šè¿‡vertexAttrib3fä¼ å‚ï¼Œè‡ªç„¶ä¼šçœç•¥æ‰1ä¸ªå‚æ•°ï¼Œåˆ™é»˜è®¤ä¸º1.0ã€‚ gl.vertexAttrib3f()åŒæ—å‡½æ•° gl.vertextAttrib[1-4]fæœ‰ä¸€ç³»åˆ—å‡½æ•°ï¼Œä¸“é—¨è´Ÿè´£ä»JavaScriptå‘Vertex_Shaderä¸­çš„attributeå˜é‡ä¼ å‚ã€‚ gl.vertextAttrib[1-4]fä¹Ÿæä¾›çŸ¢é‡ç‰ˆæœ¬gl.vertextAttrib[1-4]fvï¼šåå­—ä»¥vç»“å°¾æ¥å—ç±»å‹åŒ–æ•°ç»„å‚æ•°var position = new Float32Array([1.0, 2.0, 3.0, 1.0]);gl.vertexAttrib4fv(a_Position, position); WebGLå‡½æ•°å‘½åè§„èŒƒ ä¸OpenGL ES 2.0ä¸€è‡´ã€‚ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šåŸºç¡€å‡½æ•°åå‚æ•°ä¸ªæ•°å‚æ•°ç±»å‹"},{"title":"é¼ æ ‡ç»˜ç‚¹","path":"/wiki/WebGL/chapter_02_03.html","content":"ClickedPointsClickedPoints Code ClickedPointsè¿è¡Œç»“æœClickedPoints.htmlClickedPoints.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/cuon-utils.js/script script src=./ClickedPoints.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;// ç‰‡å…ƒç€è‰²å™¨var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,1.0); `;function main() // è·å–canvaså…ƒç´  let canvas = document.getElementById(webgl); // è·å–WebGLä¸Šä¸‹æ–‡ let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; // åˆå§‹åŒ–ç€è‰²å™¨ if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è·å–attributeå˜é‡å­˜å‚¨ä½ç½® let a_Position = gl.getAttribLocation(gl.program, a_Position); if (a_Position 0) console.log(å˜é‡å†…å­˜è·å–å¤±è´¥); return; // æ³¨å†Œé¼ æ ‡ç‚¹å‡»äº‹ä»¶å“åº”å‡½æ•° canvas.onmousedown = function (ev) click(ev, gl, canvas, a_Position); ; gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT);var g_points = []; //é¼ æ ‡ç‚¹å‡»ä½ç½®æ•°ç»„function click(ev, gl, canvas, a_Position) var x = ev.clientX; //é¼ æ ‡ç‚¹å‡»å¤„xåæ ‡ var y = ev.clientY; //é¼ æ ‡ç‚¹å‡»å¤„yåæ ‡ var rect = ev.target.getBoundingClientRect(); x = ((x - rect.left) - canvas.width / 2) / (canvas.width / 2); y = (canvas.height / 2 - (y - rect.top)) / (canvas.height / 2); // å°†åæ ‡å­˜å‚¨åˆ°g_pointsæ•°ç»„ä¸­ g_points.push(x); g_points.push(y); // æ¸…é™¤canvas gl.clear(gl.COLOR_BUFFER_BIT); var len = g_points.length; for (var i = 0; i len; i += 2) // å°†ç‚¹çš„ä½ç½®ä¼ é€’åˆ°å˜é‡ä¸­a_Position gl.vertexAttrib3f(a_Position, g_points[i], g_points[i + 1], 0.0); // ç»˜åˆ¶ç‚¹ gl.drawArrays(gl.POINTS, 0, 1); å“åº”é¼ æ ‡ç‚¹å‡»äº‹ä»¶ä¸‹é¢æ˜¯onmousedownè§¦å‘çš„åç»­æ“ä½œ ç¬¬ä¸€æ­¥è·å–é¼ æ ‡ç‚¹å‡»çš„ä½ç½®ï¼Œå­˜å‚¨äºä¸€ä¸ªæ•°ç»„ä¸­ã€‚var x = ev.clientX;var y = ev.clientY;var rect = ev.target.getBoundingClientRect();x = ((x-rect.left-canvas.width/2))/(canvas.width/2);y = ((rect.top+canvas.height/2-y))/(canvas.height/2);gl_points.push(x);gl_points.push(y);ç¬¬äºŒæ­¥æ¸…ç©ºcanvasgl.clear(gl.COLOR_BUFFER_BIT);ç¬¬ä¸‰æ­¥åœ¨ç›¸åº”çš„ä½ç½®ç»˜åˆ¶ç‚¹var len = gl_points.length;for(var i=0;ilen;i+=2) gl.vertexAttrib3f(a_Position,gl_points[i],gl_points[i+1],1.0); gl.drawArrays(gl.POINTS,0,1); è®¾ç½®åæ ‡çš„2ä¸ªæ³¨æ„ç‚¹ ev.client[X|Y] æ˜¯ç›¸å¯¹ æµè§ˆå™¨å®¢æˆ·åŒºï¼ˆclient areaï¼‰ çš„åæ ‡ã€‚canvasåæ ‡ç³»å’ŒWebGLåæ ‡ç³»çš„ åŸç‚¹ å’Œ Yè½´æ­£æ–¹å‘ éƒ½ä¸åŒã€‚ åæ ‡æ˜ å°„æ­¥éª¤åˆ†è§£ ç¬¬ä¸€æ­¥å°†é¼ æ ‡ç‚¹å‡»ä½ç½®çš„åæ ‡ä» å®¢æˆ·åŒºåæ ‡ç³» è½¬æ¢åˆ° canvasåæ ‡ç³» ä¸Šï¼š( x, y) â†’ ( x - rect.left, y - rect.top)ç¬¬äºŒæ­¥è®¡ç®— WebGLä¸­å¿ƒç‚¹ ç›¸å¯¹ canvasåæ ‡ç³» çš„åæ ‡ä½ç½®ï¼š( canvas.width2, canvas.height2)ç¬¬ä¸‰æ­¥è®¡ç®— é¼ æ ‡ç‚¹ ç›¸å¯¹ *WebGLä¸­å¿ƒç‚¹ çš„åæ ‡ä½ç½®ï¼š( x - rect.left - canvas.width2 , canvas.height2 - y + rect.top)ç¬¬å››æ­¥å°†åæ ‡è¿›è¡Œ å½’ä¸€åŒ–å¤„ç†ï¼š( ( x - rect.left - canvas.width )( canvas.width2 ), ( canvas.height2 - y + rect.top )(canvas.height2) ) é¢œè‰²ç¼“å†²åŒºçš„é‡ç½® ä¸ºä»€ä¹ˆè¦æŠŠæ¯ä¸€æ¬¡ç‚¹å‡»çš„ç‚¹ä½éƒ½è®°å½•ä¸‹æ¥ï¼Ÿå› ä¸ºWebGLä½¿ç”¨çš„æ˜¯é¢œè‰²ç¼“å†²åŒºã€‚ç»˜åˆ¶æ“ä½œå®é™…ä¸Šæ˜¯åœ¨é¢œè‰²ç¼“å†²åŒºä¸­è¿›è¡Œç»˜åˆ¶çš„ï¼Œä¸€æ—¦ç»˜åˆ¶ç»“æŸï¼Œé¢œè‰²ç¼“å†²åŒºå°±ä¼šè¢« é‡ç½®ï¼Œå†…å®¹å°±ä¼šä¸¢å¤±ã€‚å› æ­¤å¦‚æœä½ å¸Œæœ›ä¿ç•™å·²ç»ç»˜åˆ¶çš„å†…å®¹ï¼Œå°±éœ€è¦ä¿ç•™æ¶‰åŠåˆ°ç»˜åˆ¶çš„å˜é‡æ‰€å ç”¨çš„å†…å­˜åœ°å€ã€‚"},{"title":"æ”¹å˜ç‚¹çš„é¢œè‰²","path":"/wiki/WebGL/chapter_02_04.html","content":"ColoredPointsæœ¬ç¨‹åºä¸»è¦æ˜¯ä»‹ç»ï¼š å¦‚ä½•ä½¿ç”¨ uniformå˜é‡ å°†å€¼ä¼ ç»™shaderçš„ã€‚ ç¬¬ä¸€æ­¥ï¼šå£°æ˜åœ¨ Fragment_Shader ä¸­å£°æ˜å¥½ uniformå˜é‡ ã€‚ç¬¬äºŒæ­¥ï¼šèµ‹å€¼ç”¨ uniformå˜é‡ å‘ gl_FragColor èµ‹å€¼ã€‚ç¬¬ä¸‰æ­¥ï¼šä¼ è¾“å°†é¢œè‰²æ•°æ®ä¼ è¾“ç»™ uniformå˜é‡ ã€‚ ColoredPoints Code ColoredPointsè¿è¡Œç»“æœColoredPoints.htmlColoredPoints.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./ColoredPoints.js/script/headbody onload=main() canvas id=webgl width=400 height=300/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;// ç‰‡æºç€è‰²å™¨var FSHADER_SOURCE = ` precision mediump float; uniform vec4 u_FragColor; void main() gl_FragColor = u_FragColor; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è·å–a_Positionå˜é‡çš„å­˜å‚¨ä½ç½® let a_Position = gl.getAttribLocation(gl.program, a_Position); // è·å–u_FragColorå˜é‡çš„å­˜å‚¨ä½ç½® let u_FragColor = gl.getUniformLocation(gl.program, u_FragColor); if (a_Position 0 || u_FragColor ) console.log(è·å–å˜é‡å­˜å‚¨ä½ç½®å¤±è´¥); return; // æ³¨å†Œé¼ æ ‡ç‚¹å‡»äº‹ä»¶ canvas.onmousedown = function (ev) click(ev, gl, canvas, a_Position, u_FragColor); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT);let gl_points = [];let gl_colors = [];function click(ev,gl,canvas,a_Position,u_FragColor) let x = ev.clientX; let y = ev.clientY; let rect = ev.target.getBoundingClientRect(); x = (x - rect.left - canvas.width / 2) / (canvas.width / 2); y = (rect.top + canvas.height / 2 - y) / (canvas.height / 2); gl_points.push([x, y]); gl_colors.push([ Math.random().toFixed(1), Math.random().toFixed(1), Math.random().toFixed(1), 1.0, ]); gl.clear(gl.COLOR_BUFFER_BIT); gl_points.forEach((point, index) = // å°†åæ ‡å­˜å‚¨åˆ°gl_pointsæ•°ç»„ä¸­ gl.vertexAttrib2f(a_Position, point[0], point[1]); // gl.uniform4f( u_FragColor, gl_colors[index][0], gl_colors[index][1], gl_colors[index][2], gl_colors[index][3] ) gl.drawArrays(gl.POINTS, 0, 1); ) uniform å˜é‡å‘ç‰‡æºç€è‰²å™¨ä¼ è¾“æ•°æ®çš„ä¸¤ç§æ–¹å¼uniformçš„å£°æ˜uniformç”¨äºä¼ è¾“ ä¸€è‡´ä¸å˜çš„æ•°æ® ï¼Œå…¶å£°æ˜æ ¼å¼ä¸ attribute ç›¸åŒï¼š å­˜å‚¨é™å®šç¬¦ ç±»å‹ å˜é‡å ç²¾åº¦é™å®šè¯ï¼ˆprecision qualifierï¼‰ ç”¨äºæŒ‡å®šå˜é‡çš„èŒƒå›´å’Œç²¾åº¦ã€‚precision mediump float; //è¡¨ç¤ºä¸­ç­‰ç²¾åº¦ è·å–uniformå˜é‡çš„å­˜å‚¨åœ°å€ getUniformLocationä¸getAttribLocationè¿”å›å€¼çš„åŒºåˆ« getAttribLocationï¼šå¦‚æœattributeå˜é‡ä¸å­˜åœ¨ï¼Œè¿”å› -1 ã€‚ getUniformLocationï¼šå¦‚æœuniformå˜é‡ä¸å­˜åœ¨ï¼Œè¿”å› null ã€‚ å‘uniformå˜é‡èµ‹å€¼uniform[1-4]f çš„åŠŸèƒ½ä¸å‚æ•°ä¸ vertexAttrib[1-4]f å¾ˆç›¸è¿‘ã€‚ uniform4fçš„åŠŸèƒ½ä¸å‚æ•° uniform4fçš„åŒæ—å‡½æ•°"},{"title":"ç»˜åˆ¶å¤šä¸ªç‚¹","path":"/wiki/WebGL/chapter_03_01.html","content":"ä¸‰ç»´æ¨¡å‹çš„åŸºæœ¬å•ä½æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š ä¸‰è§’å½¢ â–³ä¸ç®¡ä¸‰ç»´æ¨¡å‹çš„å½¢çŠ¶å¤šä¹ˆå¤æ‚ï¼ŒåŸºæœ¬ç»„æˆå•ä½éƒ½æ˜¯ä¸‰è§’å½¢ã€‚åªä¸è¿‡å¤æ‚çš„æ¨¡å‹ç”±æ›´å¤šçš„ä¸‰è§’å½¢æ„æˆè€Œå·²ã€‚ MultiPointç¼“å†²åŒºå¯¹è±¡ï¼ˆbuffer objectï¼‰ å¦‚æœä½ è¦ç»˜åˆ¶ä¸€ä¸ªå›¾å½¢ï¼Œä½ éœ€è¦ä¸€æ¬¡æ€§çš„å°†å›¾å½¢çš„é¡¶ç‚¹å…¨éƒ¨ä¼ å…¥Vertex_Shaderã€‚ç¼“å†²åŒºå¯¹è±¡ æ”¯æŒä¸€æ¬¡æ€§åœ°å‘shaderä¼ å…¥å¤šä¸ªé¡¶ç‚¹çš„æ•°æ®ã€‚å®ƒæ˜¯WebGLç³»ç»Ÿä¸­çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚ MultiPoints Code MultiPointsç»˜åˆ¶æ•ˆæœMultiPoints.htmlMultiPoints.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./MultiPoints.js/script/headbody onload=main() canvas id=webgl width=500 height=300/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;// ç‰‡å…ƒç€è‰²å™¨var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,1.0); `function main() var canvas = document.getElementById(webgl); var gl = getWebGLContext(canvas); initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE); // è®¾ç½®é¡¶ç‚¹ä½ç½® var n = initVertexBuffers(gl); if (n 0) console.log(è®¾ç½®é¡¶ç‚¹ä½ç½®å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, n);function initVertexBuffers(gl) var vertices = new Float32Array([ 0.0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); var n = 3; //ç‚¹æ•° // åˆ›å»ºç¼“å†²åŒºå¯¹è±¡ var vertexBuffer = gl.createBuffer(); if (!vertexBuffer) console.log(åˆ›å»ºç¼“å†²åŒºå¯¹è±¡å¤±è´¥); return -1; // å°†ç¼“å†²åŒºå¯¹è±¡ç»‘å®šåˆ°ç›®æ ‡ gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); // å‘ç¼“å†²åŒºå¯¹è±¡ä¸­å†™å…¥æ•°æ® gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); var a_Position = gl.getAttribLocation(gl.program, a_Position); // å°†ç¼“å†²åŒºå¯¹è±¡åˆ†é…ç»™a_Positionå˜é‡ gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); // è¿æ¥a_Positionå˜é‡ä¸åˆ†é…ç»™å®ƒçš„ç¼“å†²åŒºå¯¹è±¡ gl.enableVertexAttribArray(a_Position); return n; ä½¿ç”¨ç¼“å†²åŒºå¯¹è±¡æµç¨‹ ç¼“å†²åŒºå¯¹è±¡æ˜¯WebGLç³»ç»Ÿä¸­çš„ä¸€å—å­˜å‚¨åŒºã€‚1. åˆ›å»ºç¼“å†²åŒºå¯¹è±¡gl.createBuffer()var vertexBuffer = gl.createBuffer();if(!vertexBuffer) console.log(Failed to create the buffer object); return -1;2. ç»‘å®šç¼“å†²åŒºå¯¹è±¡gl.bindBuffer()gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);3. å°†æ•°æ®å†™å…¥ç¼“å†²åŒºå¯¹è±¡gl.bufferData()gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);4. å°†ç¼“å†²åŒºå¯¹è±¡åˆ†é…ç»™ä¸€ä¸ªattributeå˜é‡gl.vertexAttribPointer()var a_Position = gl.getAttribLocation(gl.program,a_Position);gl.vertexAttribPointer(a_Position,2,gl.FLOAT,false,0,0);5. å¼€å¯attributeå˜é‡gl.enableVertexAttribArray()gl.enableVertexAttribArray(a_Position); æ­¥éª¤åˆ†è§£ åˆ›å»ºç¼“å†²åŒºå¯¹è±¡gl.createBuffer()ç¼“å†²åŒºå¯¹è±¡å¯ä»¥è¢«åˆ›å»º å’Œ åˆ é™¤ ã€‚createBufferdeleteBufferç»‘å®šç¼“å†²åŒºå¯¹è±¡gl.bindBuffer()å°† ç¼“å†²åŒºå¯¹è±¡ ç»‘å®šåˆ°WebGLç³»ç»Ÿä¸­å·²ç»å­˜åœ¨çš„ target ä¸Šï¼Œè¿™ä¸ª target è¡¨ç¤º ç¼“å†²åŒºå¯¹è±¡çš„ç”¨é€”ã€‚ bindBufferå†™å…¥ç¼“å†²åŒºå¯¹è±¡gl.bufferData()ä¸èƒ½ç›´æ¥å‘ç¼“å†²åŒºå†™å…¥æ•°æ®ï¼Œåªèƒ½å‘ä¸ç¼“å†²åŒºç»‘å®šçš„ç›®æ ‡å†™å…¥æ•°æ®ã€‚bufferDataåˆ†é…attributeå˜é‡ç»™ç¼“å†²åŒºå¯¹è±¡gl.vertexAttribPointer()vertexAttribPointerå¯ä»¥å°†æ•´ä¸ªç¼“å†²åŒºå¯¹è±¡çš„å¼•ç”¨åˆ†é…ç»™attributeå˜é‡vertexAttribPointerå¼€å¯attributeå¯¹è±¡gl.enableVertexAttribArray()é€šè¿‡enableVertexAttribArrayï¼Œç¼“å†²åŒºå¯¹è±¡å’Œattributeå˜é‡ä¹‹é—´çš„è¿æ¥å°±çœŸæ­£å»ºç«‹èµ·æ¥äº†ã€‚ enableVertexAttribArrayå‡½æ•°åä¼šè®©å¾ˆå¤šäººè¯¯è§£å®ƒæ˜¯ç”¨äºå¤„ç†é¡¶ç‚¹çš„ï¼Œè¿™æ˜¯ç”±äºç»§æ‰¿è‡ªOpenGLã€‚ç¼“å†²åŒºå¯¹è±¡ä¸attributeå˜é‡ä¹‹é—´çš„è¿æ¥å¯ä»¥é€šè¿‡ enableVertexAttribArray å»ºç«‹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ disableVertexAttribArray å…³é—­ã€‚enableVertexArraydisableVertexArrayå¼€å§‹ç»˜åˆ¶gl.drawArrays()shaderçš„æ‰§è¡Œæ¬¡æ•°ä¸drawArraysçš„countå‚æ•°ç›¸ä¸€è‡´ã€‚å› æ­¤åœ¨MultiPointsä¸­ï¼ŒShaderå®é™…ä¸Šè¢«æ‰§è¡Œäº†3æ¬¡ã€‚é¡¶ç‚¹ç€è‰²å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç¼“å†²åŒºæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ä¸‹é¢æ˜¯2ä¸ªå¯¹äºgl.drawArrayså‡½æ•°çš„å°å®éªŒï¼šdrawArrays(gl.POINTS,0,1)drawArrays(gl.POINTS,1,2) ç±»å‹åŒ–æ•°ç»„WebGLä¸­çš„å¾ˆå¤šæ“ä½œéƒ½è¦ç”¨åˆ°ç±»å‹åŒ–æ•°ç»„ã€‚ æç¤º: ç±»å‹åŒ–æ•°ç»„ä¸æ”¯æŒ push å’Œ pop ã€‚åˆ›å»ºç±»å‹åŒ–æ•°ç»„çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ä½¿ç”¨ newè¿ç®—ç¬¦ ã€‚ WebGLä½¿ç”¨çš„å„ç§ç±»å‹åŒ–æ•°ç»„ ç±»å‹åŒ–æ•°ç»„çš„æ–¹æ³•ã€å±æ€§å’Œå¸¸é‡"},{"title":"ç§»åŠ¨ã€æ—‹è½¬","path":"/wiki/WebGL/chapter_03_03.html","content":"ä»¿å°„å˜æ¢ å¯¹å›¾å½¢è¿›è¡Œå¹³ç§»ã€æ—‹è½¬å’Œç¼©æ”¾ï¼Œè¿™æ ·çš„æ“ä½œç§°ä¸º å˜æ¢ï¼ˆtransformationsï¼‰ï¼Œæˆ– ä»¿å°„å˜æ¢ï¼ˆaffine transformationsï¼‰ å¹³ç§»é—®é¢˜æè¿°å°†ç‚¹ p(x,y,z) å¹³ç§»åˆ° pâ€™(xâ€™,yâ€™,zâ€™),åœ¨Xè½´ã€Yè½´ã€Zè½´ä¸‰ä¸ªæ–¹å‘å¹³ç§»çš„è·ç¦»åˆ†åˆ«ä¸ºï¼šTxï¼ŒTyï¼Œ Tz ï¼Œå…¶ä¸­ Tz0 ã€‚ç­‰å¼xâ€™ x + Txyâ€™ y + Tyzâ€™ z + Tzå›¾è§£ç€è‰²å™¨å¹³ç§»æ˜¯ä¸€ä¸ª é€é¡¶ç‚¹æ“ä½œï¼ˆper-vertex operationï¼‰ï¼Œå› æ­¤ä¿®æ”¹åº”å½“å‘ç”Ÿåœ¨ é¡¶ç‚¹ç€è‰²å™¨ ã€‚ Translated TriangleTranslatedTriangle Code TranslatedTriangleè¿è¡Œæ•ˆæœTranslatedTriangle.htmlTranslatedTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./TranslatedTriangle.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; uniform vec4 u_Translation; void main() gl_Position = a_Position + u_Translation; `;// ç‰‡å…ƒç€è‰²å™¨var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.4); `;// åœ¨xã€yã€zæ–¹å‘ä¸Šå¹³ç§»çš„è·ç¦»var Tx = 0.5, Ty = 0.5, Tz = 0.0;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è®¾ç½®ç‚¹ä½ var n = initVertexBuffer(gl); if (n 0) console.log(ç¼“å†²åŒºåˆå§‹åŒ–å¤±è´¥); return; // å°†å¹³ç§»è·ç¦»ä¼ è¾“ç»™é¡¶ç‚¹ç€è‰²å™¨ var u_Translation = gl.getUniformLocation(gl.program, u_Translation); if (!u_Translation) console.log(å˜é‡è·å–å¤±è´¥); return; gl.uniform4f(u_Translation, Tx, Ty, Tz, 0.0); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); let n = vertices.length / 2; let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return n; é½æ¬¡åæ ‡ gl.uniform4f() éœ€è¦æ¥æ”¶ é½æ¬¡åæ ‡ï¼Œé½æ¬¡åæ ‡å…±æœ‰ 4ä¸ªåˆ†é‡ï¼Œæœ€åä¸€ä¸ªåˆ†é‡å¦‚æœæ˜¯ 1.0ï¼Œ è¡¨ç¤ºå‰ä¸‰ä¸ªåˆ†é‡æ˜¯ ä¸€ä¸ªç‚¹çš„ä¸‰ç»´åæ ‡ã€‚ æ—‹è½¬ä¸ºäº†æè¿°ä¸€æ¬¡æ—‹è½¬ï¼Œå¿…é¡»æŒ‡æ˜ä»¥ä¸‹3ä¸ªæ¡ä»¶ï¼š æ—‹è½¬è½´æ—‹è½¬æ–¹å‘æ—‹è½¬è§’åº¦ å³æ‰‹æ³•åˆ™æ—‹è½¬ï¼ˆright-hand-rule rotationï¼‰ ä¹Ÿç§° æ­£æ—‹è½¬ï¼Œåˆ¤æ–­æ ‡å‡†å°±æ˜¯ï¼šå³æ‰‹æ¡æ‹³ï¼Œæ‹‡æŒ‡æœä¸ŠæŒ‡å‘zè½´æ­£æ–¹å‘ï¼Œå…¶ä½™å››æŒ‡æŒ‡å‘çš„æ–¹å‘å°±æ˜¯æ—‹è½¬çš„æ­£æ–¹å‘ã€‚ æ•°å­¦è¡¨è¾¾ é—®é¢˜æè¿°ç‚¹ p(x,y,z) æ—‹è½¬ Î² è§’åº¦ä¹‹åå˜ä¸ºäº†ç‚¹ pâ€™(xâ€™,yâ€™,zâ€™),æ—‹è½¬æ˜¯ç»•Zè½´é€†æ—¶é’ˆè¿›è¡Œçš„ã€‚æ—‹è½¬ç­‰å¼è®¾ o ä¸ºåŸç‚¹è®¾ r opè®¾ Î± ä¸º op ä¸ xè½´å¤¹è§’xâ€™ rcos( Î± + Î² ) r(cosÎ±cosÎ² - sinÎ±sinÎ²) xcosÎ² - ysinÎ²yâ€™ rsin( Î± + Î² ) r(sinÎ±cosÎ² + sinÎ²cosÎ±) ycosÎ² + xsinÎ²zâ€™ zå›¾è§£ç€è‰²å™¨ä¾æ—§æ˜¯ç”±é¡¶ç‚¹ç€è‰²å™¨å¤„ç†ã€‚ Rotated TriangleRotatedTriangle Code RotatedTriangleè¿è¡Œæ•ˆæœRotatedTriangle.htmlRotatedTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./RotatedTriangle.js/script/headbody onload=main() canvas id=webg width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` // x = xcosb - ysinb // y = xsinb + ycosb // z = z attribute vec4 a_Position; uniform float u_CosB, u_SinB; void main() gl_Position.x = a_Position.x * u_CosB - a_Position.y * u_SinB; gl_Position.y = a_Position.x * u_SinB + a_Position.y * u_CosB; gl_Position.z = a_Position.z; gl_Position.w = 1.0; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.4); `;let ANGLE = 90.0;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); if (n 0) console.log(ç¼“å†²åŒºåˆå§‹åŒ–å¤±è´¥); return; // å¼§åº¦åˆ¶ let radian = Math.PI * ANGLE / 180; let cosB = Math.cos(radian); let sinB = Math.sin(radian); let u_CosB = gl.getUniformLocation(gl.program, u_CosB); let u_SinB = gl.getUniformLocation(gl.program, u_SinB); if (!u_CosB || !u_SinB) console.log(è·å–å˜é‡å¤±è´¥); return; gl.uniform1f(u_CosB, cosB); gl.uniform1f(u_SinB, sinB); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); if (a_Position 0) console.log(è·å–å˜é‡å¤±è´¥); return -1; gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return vertices.length / 2; ä¸€äº›å°é—®é¢˜ å…³äºuniformå˜é‡å€¼çš„è®¡ç®—ä½ç½®é—®é¢˜ä¸€èˆ¬å°†uniformå˜é‡æ”¾åœ¨JSä¸­ç®—å¥½å†ä¼ é€’åˆ°shaderä¸­ï¼Œè¿™æ ·åªéœ€è¦è®¡ç®—ä¸€æ¬¡ï¼Œæ•ˆç‡æ›´é«˜ã€‚ ç‚¹æ“ä½œç¬¦è®¿é—®åˆ†é‡é—®é¢˜åœ¨shaderç¨‹åºä¸­ï¼Œæ— è®ºæ˜¯å¯¹ ä¼ å…¥çš„å˜é‡ è¿˜æ˜¯ glå˜é‡ï¼Œéƒ½ä½¿ç”¨ ç‚¹æ“ä½œç¬¦ æ¥è®¿é—®åˆ†é‡ã€‚ å¼§åº¦åˆ¶å‚æ•°é—®é¢˜JSå†…ç½®å‡½æ•° Math.sin() å’Œ Math.cos()éƒ½åªæ¥å— å¼§åº¦åˆ¶å‚æ•°ã€‚å› æ­¤éœ€è¦å°† è§’åº¦å€¼å‚æ•° è½¬æ¢ä¸º å¼§åº¦åˆ¶å‚æ•°: let radian Math.PI * ANGLE 180.0 ; ä½¿ç”¨æ•°ç»„ä¼ å…¥ä¸‰è§’å‡½æ•°å€¼Vertex_Shader let VSHADER_SOURCE = ` attribute vec4 a_Position; uniform vec2 u_CosBSinB; void main() gl_Position.x = a_Position.x*u_CosBSinB.x - a_Position.y*u_CosBSinB.y; gl_Position.y = a_Position.y*u_CosBSinB.x + a_Position.x*u_CosBSinB.y; gl_Position.z = a_Position.z; gl_Position.w = a_Position.w; `; ä¼ å…¥uniformå˜é‡ let u_CosBSinB = gl.getUniformLocation(gl.program, u_CosBSinB);gl.uniform2f(u_CosBSinB, cosB, sinB); Rotated Triangle å‡çº§ç‰ˆ è¹¦è¹¦åºŠç¨‹åºä¸­å¯¹u_sinBå’Œu_cosBçš„èµ‹å€¼ï¼šgl.uniform1f(u_sinB, Math.sin(currentAngle*Math.PI/180.0));gl.uniform1f(u_cosB, Math.cos(currentAngle));"},{"title":"å˜æ¢çŸ©é˜µ","path":"/wiki/WebGL/chapter_03_04.html","content":"å˜æ¢çŸ©é˜µï¼šæ—‹è½¬å˜æ¢çŸ©é˜µï¼ˆTransformation matrixï¼‰ ä¸ºä»€ä¹ˆéœ€è¦å˜æ¢çŸ©é˜µï¼Ÿå¦‚æœæˆ‘ä»¬è¦å®ç°ä¸€ä¸ª æ—‹è½¬åå¹³ç§»çš„æ“ä½œï¼Œéœ€è¦ä»¥ä¸‹çš„ç­‰å¼ï¼š let VSHADER_SOURCE = ` attribute vec4 a_Position; uniform vec4 u_Transition; uniform vec2 u_SinCos; void main() gl_Position.x = a_Position.x*u_SinCos.x - a_Position.y*u_SinCos.y + u_Transition.x; gl_Position.y = a_Position.y*u_SinCos.x + a_Position.x*u_SinCos.y + u_Transition.y; gl_Position.z = a_Position.z + u_Transition.z; gl_Position.w = a_Position.w; `; å¯ä»¥çœ‹åˆ°å˜æ¢å¼å˜å¾—è¶Šæ¥è¶Šç¹çï¼Œä½†æ˜¯å¦‚æœç”¨å˜é‡çŸ©é˜µæ¥å®ç°å°±èƒ½ç®€å•å¾ˆå¤šï¼Œå˜æ¢çŸ©é˜µï¼ˆTransformation matrixï¼‰ ç›¸å½“é€‚åˆæ“ä½œè®¡ç®—æœºå›¾å½¢ã€‚ ä¸€äº›çŸ©é˜µä¹˜æ³•åŸºæœ¬æ¡ä»¶ çŸ©é˜µä¹˜æ³•ä¸æ»¡è¶³äº¤æ¢å¾‹ çŸ©é˜µåˆ—æ•°å¿…é¡»ç­‰äºçŸ¢é‡è¡Œæ•° çŸ©é˜µä¹˜æ³•ç­‰å¼ æ—‹è½¬çŸ©é˜µï¼ˆrotation matrixï¼‰ å˜æ¢çŸ©é˜µï¼šå¹³ç§»éœ€è¦ä¸€ä¸ª4Ã—4çš„å˜æ¢çŸ©é˜µ å› ä¸ºåœ¨å¹³ç§»çš„ç­‰å¼ä¸­å­˜åœ¨ å¸¸é‡é¡¹ ï¼Œå› æ­¤éœ€è¦ç»™ä¸‰ç»´çŸ¢é‡æ·»åŠ  ç¬¬4ä¸ªåˆ†é‡ ï¼ŒåŒæ—¶éœ€è¦å¯¹å˜æ¢çŸ©é˜µè¿›è¡Œæ‰©å……ã€‚ 4Ã—4çš„æ—‹è½¬çŸ©é˜µæ—‹è½¬çŸ©é˜µçš„ç»´åº¦æ‰©å…… RotatedTriangle_MatrixRotatedTriangle_Matrix Code RotatedTriangle_Matrixè¿è¡Œæ•ˆæœRotatedTriangle_Matrix.htmlRotatedTriangle_Matrix.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./RotatedTriangle_Matrix.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmlvar VSHADER_SOURCE = ` attribute vec4 a_Position; uniform mat4 u_xformMatrix; void main() gl_Position = u_xformMatrix * a_Position; `;var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.4); `;// æ—‹è½¬è§’åº¦let ANGLE = 90.0;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è®¾ç½®é¡¶ç‚¹ä½ç½® let n = initVertexBuffers(gl); if (n 0) console.log(ç¼“å†²åŒºåˆå§‹åŒ–å¤±è´¥); return; // åˆ›å»ºæ—‹è½¬çŸ©é˜µ let radian = Math.PI * ANGLE / 180.0; let cosB = Math.cos(radian), sinB = Math.sin(radian); // WebGLä¸­çŸ©é˜µæ˜¯åˆ—ä¸»åºçš„ let xformMatrix = new Float32Array([ cosB, sinB, 0, 0, -sinB, cosB, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ]); let u_xformMatrix = gl.getUniformLocation(gl.program, u_xformMatrix); if (!u_xformMatrix) console.log(è·å–å˜é‡å¤±è´¥); return; gl.uniformMatrix4fv(u_xformMatrix, false, xformMatrix); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffers(gl) let vertices = new Float32Array([ 0.0, 0.3, -0.3, -0.3, 0.3, -0.3 ]); let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return vertices.length / 2; ä¸€äº›å°é—®é¢˜ ä¼ å…¥ç€è‰²å™¨å†…çš„çŸ©é˜µå˜é‡çš„å¤„ç†ä½¿ç”¨ä¸€è¡Œå°±èƒ½å¤Ÿå®ç°çŸ¢é‡ä¸çŸ©é˜µçš„åŠ æ³•ï¼š gl_Position = u_xformMatrix * a_Position ; å› ä¸ºshaderå†…ç½®äº†å¸¸ç”¨çš„çŸ¢é‡å’ŒçŸ©é˜µè¿ç®—åŠŸèƒ½ã€‚ mat4ç±»å‹æŒ‡çš„æ˜¯4Ã—4çš„çŸ©é˜µç±»å‹ ä¸¤ç§åœ¨æ•°ç»„ä¸­å­˜å‚¨çŸ©é˜µå…ƒç´ çš„æ–¹å¼WebGLå’ŒOpenGLçš„çŸ©é˜µå…ƒç´ éƒ½æ˜¯æŒ‰åˆ—ä¸»åºå­˜å‚¨åœ¨æ•°ç»„ä¸­çš„ã€‚ æŒ‰è¡Œä¸»åºï¼ˆrow major orderï¼‰ æŒ‰åˆ—ä¸»åºï¼ˆcolumn major orderï¼‰ gl.uniformMatrix4fx()å‡½æ•°åæœ€åä¸€ä¸ªå­—æ¯æ˜¯vï¼Œè¡¨ç¤ºå¯ä»¥å‘shaderä¼ è¾“å¤šä¸ªæ•°æ®å€¼ã€‚ ç¬¬äºŒä¸ªå‚æ•°Transposeä¹‹æ‰€ä»¥å¿…é¡»æ˜¯false æ˜¯ç”±äºè¯¥å‚æ•°è¡¨ç¤º æ˜¯å¦è½¬ç½®çŸ©é˜µï¼Œå› ä¸ºWebGLæ²¡æœ‰æä¾›çŸ©é˜µè½¬ç½®çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¯¥å‚æ•°å¿…é¡»æ˜¯falseã€‚å¹³ç§»ï¼šç›¸åŒçš„ç­–ç•¥è¿è¡Œç»“æœ å¹³ç§»ä½¿ç”¨çš„å˜æ¢çŸ©é˜µlet xformMatrix = new Float32Array([ 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, Tx, Ty, 0.0, 1.0]);å˜æ¢çŸ©é˜µï¼šç¼©æ”¾å›¾è§£ç­‰å¼å˜æ¢çŸ©é˜µçŸ©é˜µæ•°ç»„let xformMatrix = new Float32Array([ Sx, 0, 0, 0, 0, Sy, 0, 0, 0, 0, Sz, 0, 0, 0, 0, 1.0])è¿è¡Œç»“æœ"},{"title":"ç»˜åˆ¶å¤šè¾¹å½¢","path":"/wiki/WebGL/chapter_03_02.html","content":"Hello TriangleHelloTriangle Code HelloTriangleè¿è¡Œæ•ˆæœå›¾HelloTriangle.htmlHelloTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./HelloTriangle.js/script/headbody onload=main() canvas id=webgl width=500 height=400/canvas/body/html// é¡¶ç‚¹ç€è‰²å™¨var VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;// ç‰‡å…ƒç€è‰²å™¨var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.4); `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; // è®¾ç½®é¡¶ç‚¹ä½ç½® let n = initVertexBuffer(gl); if (n 0) console.log(ç¼“å­˜åŒºåˆå§‹åŒ–å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n); function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0,0.5,-0.5,-0.5,0.5,-0.5 ]); let n = vertices.length / 2; // åˆ›å»ºç¼“å†²åŒº let vertexBuffer = gl.createBuffer(); // ç»‘å®šç¼“å†²åŒº gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); // å†™å…¥ç¼“å†²åŒº gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); // åˆ†é…å˜é‡ç»™ç¼“å†²åŒº let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); // è¿é€šå˜é‡ä¸ç¼“å†²åŒº gl.enableVertexAttribArray(a_Position); return n;; åŸºæœ¬å›¾å½¢gl.drawArrays()ç¬¬ä¸€ä¸ªå‚æ•°mode é€šè¿‡ç»™ç¬¬ä¸€ä¸ªå‚æ•°modeæŒ‡å®šä¸åŒçš„å€¼ï¼Œå¯ä»¥ä»¥7ç§ä¸åŒçš„æ–¹å¼æ¥ç»˜åˆ¶å›¾å½¢ï¼šgl.POINTSgl.LINESgl.LINE_STRIPgl.LINE_LOOPgl.TRIANGLESgl.TRIANGLE_STRIPgl.TRIANGLE_FAN Hello RectangleHelloQuad Code HelloQuadè¿è¡Œç»“æœHelloQuad.htmlHelloQuad.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./HelloQuad.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmlvar VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; `;var FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.6); `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); if (n 0) console.log(ç¼“å†²åŒºåˆå§‹åŒ–å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLE_STRIP, 0, n);function initVertexBuffer(gl) let vertices = new Float32Array([ -0.5, 0.5, -0.5, -0.5, 0.5, 0.5, 0.5, -0.5, ]); let n = vertices.length / 2; let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return n;"},{"title":"å¤åˆå˜æ¢","path":"/wiki/WebGL/chapter_04_01.html","content":"å¹³ç§»ï¼Œç„¶åæ—‹è½¬å¤§å¤šæ•°WebGLå¼€å‘è€…éƒ½ä½¿ç”¨çŸ©é˜µæ“ä½œå‡½æ•°åº“æ¥éšè—çŸ©é˜µè®¡ç®—çš„ç»†èŠ‚ã€‚ çŸ©é˜µå˜æ¢åº“ï¼šcuon-matrix.js OpenGLæä¾›äº†ä¸€ç³»åˆ—åˆ›å»ºå˜æ¢çŸ©é˜µçš„å‡½æ•°ï¼Œä½†WebGLéƒ½æ²¡æœ‰ã€‚matrix4åœ¨ cuon-matrix.jsä¸­æä¾›äº†ä¸€ç§ Matrix4 ç±»ï¼Œå…¶ä¸­å°è£…äº†è®¸å¤šåˆ›å»ºå˜æ¢çŸ©é˜µçš„æ–¹æ³•ã€‚Matrix4 è¡¨ç¤º 4Ã—4çš„çŸ©é˜µï¼Œå…¶å®ä¾‹å†…éƒ¨ä¸€è´¯ä½¿ç”¨ Float32Arrayç±»å‹ æ¥å­˜å‚¨çŸ©é˜µå…ƒç´ ã€‚ RotatedTriangle_Matrix4RotatedTriangle_Matrix4 Code RotatedTriganle_Matrixè¿è¡Œç»“æœRotatedTriangle_Matrix4.htmlRotatedTriangle_Matrix4.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/cuon-matrix.js/script script src=./RotatedTriangle_Matrix4.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; uniform mat4 u_xformMatrix; void main() gl_Position = u_xformMatrix * a_Position; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.7); `;let ANGLE = 90.0;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(åˆ›å»ºä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); if (n 0) console.log(é¡¶ç‚¹ç¼“å†²åŒºåˆå§‹åŒ–å¤±è´¥); return; let xformMatrix = new Matrix4(); xformMatrix.setRotate(ANGLE, 0, 0, 1); let u_xformMatrix = gl.getUniformLocation(gl.program, u_xformMatrix); if (!u_xformMatrix) console.log(è·å–å˜é‡å¤±è´¥); return; gl.uniformMatrix4fv(u_xformMatrix, false, xformMatrix.elements); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.3, -0.3, -0.3, 0.3, -0.3 ]); let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return vertices.length / 2; Matrix4.setRotate(ANGLE, x, y ,z) ANGLEï¼š è¡¨ç¤ºæ—‹è½¬è§’ï¼Œæ˜¯è§’åº¦åˆ¶ä¸æ˜¯å¼§åº¦åˆ¶ï¼ˆxï¼Œyï¼Œzï¼‰ï¼š è¡¨ç¤ºæ—‹è½¬è½´æ—‹è½¬è§’åº¦æ˜¯æ­£å€¼ è¡¨ç¤ºé€†æ—¶é’ˆæ–¹å‘æ—‹è½¬ç»•xè½´é€†æ—¶é’ˆæ—‹è½¬ (1,0,0)ç»•yè½´é€†æ—¶é’ˆæ—‹è½¬ (0,1,0)ç»•zè½´é€†æ—¶é’ˆæ—‹è½¬ (0,0,1) Matrix4ç±»å‹setIdentity() å°†Matrix4å®ä¾‹åˆå§‹åŒ–ä¸º å•ä½é˜µã€‚let mat4 = new Matrix4();console.log(mat4.setIdentity().elements);/** * [ * 1,0,0,0, * 0,1,0,0, * 0,0,1,0, * 0,0,0,1 * ] */setTranslate(x,y,z) å°†Matrixå®ä¾‹è®¾ç½®ä¸º å¹³ç§»å˜æ¢çŸ©é˜µï¼Œ(x,y,z)è¡¨ç¤ºåœ¨xyzè½´ä¸Šå¹³ç§»è·ç¦»ã€‚let mat4 = new Matrix4();console.log(mat4.setTranslate(0.3, 0.3, 0.0).elements);/** * [1, 0, 0, 0, * 0, 1, 0, 0, * 0, 0, 1, 0, * 0.30000001192092896, 0.30000001192092896, 0, 1] */setRotate(angle,x,y,z) å°†Matrix4å®ä¾‹è®¾ç½®ä¸º æ—‹è½¬å˜æ¢çŸ©é˜µã€‚angle è¡¨ç¤ºæ—‹è½¬è§’åº¦(x,y,z) è¡¨ç¤ºæ—‹è½¬è½´ï¼Œæ— éœ€è¿›è¡Œå½’ä¸€åŒ–let mat4 = new Matrix4();console.log(mat4.setRotate(90.0, 0, 0,1).elements);/** * [ * 6.123234262925839e-17, 1, 0, 0, * -1, 6.123234262925839e-17, 0, 0, * 0, 0, 1, 0, * 0, 0, 0, 1 * ] */ setScale(x,y,z) å°†Matrix4å®ä¾‹è®¾ç½®ä¸º ç¼©æ”¾å˜æ¢çŸ©é˜µ ï¼Œ(x,y,z)è¡¨ç¤ºä¸‰ä¸ªè½´ä¸Šçš„ç¼©æ”¾å› å­ã€‚let mat4 = new Matrix4();console.log(mat4.setScale(3.0, 2.0, 1.0).elements);/** * [ * 3, 0, 0, 0, * 0, 2, 0, 0, * 0, 0, 1, 0, * 0, 0, 0, 1 * ] */translate(x,y,z) å°†Matrix4å®ä¾‹ ä¹˜ä»¥ä¸€ä¸ªå¹³ç§»å˜æ¢çŸ©é˜µlet mat4 = new Matrix4();mat4.setScale(1, 2, 3);console.log(mat4.translate(0.1, 0.5, 0.0).elements);/** * [ * 1, 0, 0, 0, * 0, 2, 0, 0, * 0, 0, 3, 0, * 0.10000000149011612, 1, 0, 1, * ] */rotate(angle,x,y,z) å°†Matrix4å®ä¾‹ ä¹˜ä»¥ä¸€ä¸ªæ—‹è½¬å˜æ¢çŸ©é˜µlet mat4 = new Matrix4();mat4.setScale(1, 2, 3);console.log(mat4.rotate(90, 0, 1, 0).elements);/** * [ * 6.123234262925839e-17, 0, -3, 0, * 0, 2, 0, 0, * 1, 0, 1.8369702788777518e-16, 0, * 0, 0, 0, 1 * ] */scale(x,y,z) å°†Matrix4å®ä¾‹ ä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾å˜æ¢çŸ©é˜µlet mat4 = new Matrix4();mat4.setScale(1, 2, 3);console.log(mat4.scale(1, 0.5, 0.3).elements);/** * [ * 1, 0, 0, 0, * 0, 1, 0, 0, * 0, 0, 0.8999999761581421, 0, * 0, 0, 0, 1 * ] */set(m) å°†Matrix4å®ä¾‹ è®¾ç½®ä¸ºmï¼Œmå¿…é¡»æ˜¯ä¸€ä¸ªMatrix4å®ä¾‹ã€‚let m = new Matrix4();m.setScale(1, 2, 3);let mat4 = new Matrix4();mat4.set(m);// trueconsole.log(m.elements.toString() === mat4.elements.toString());elements ç±»å‹åŒ–æ•°ç»„ Floated2Arrayï¼ŒåŒ…å«äº†Matrix4å®ä¾‹çš„çŸ©é˜µå…ƒç´ ã€‚ æœ‰æ— setå‰ç¼€çš„åŒºåˆ« æœ‰setå‰ç¼€çš„æ–¹æ³•ä¼šæ ¹æ®å‚æ•°è®¡ç®—å‡ºå˜æ¢çŸ©é˜µï¼Œç„¶åå°†å˜æ¢çŸ©é˜µå†™å…¥åˆ°è‡ªèº«ä¸­ã€‚ æ²¡æœ‰setå‰ç¼€çš„æ–¹æ³•ä¼šå…ˆæ ¹æ®å‚æ•°è®¡ç®—å‡ºå˜æ¢çŸ©é˜µï¼Œç„¶åå°†è‡ªèº«ä¸åˆšåˆšè®¡ç®—å¾—åˆ°çš„å˜æ¢çŸ©é˜µç›¸ä¹˜ï¼Œæœ€ç»ˆæŠŠç»“æœå†™å…¥åˆ°Matrix4å¯¹è±¡ä¸­ã€‚ å¤åˆå˜æ¢3Ã—3çŸ©é˜µä¹˜æ³• é—®é¢˜æè¿°éœ€è¦å°†å›¾å½¢å…ˆå¹³ç§»ï¼Œå†æ—‹è½¬ã€‚å›¾è§£å˜æ¢ç­‰å¼( æ—‹è½¬çŸ©é˜µ Ã— å¹³ç§»çŸ©é˜µ ) Ã— åŸå§‹åæ ‡ Rotated Translated TriangleRotatedTranslatedTriangle Code RotatedTranslatedTriangleè¿è¡Œç»“æœRotatedTranslatedTriangle.htmlRotatedTranslatedTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./RotatedTranslatedTriangle.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet ANGEL = 60.0;let Tx = 0.5, Ty = 0.0, Tz = 0.0;let VSHADER_SOURCE = ` attribute vec4 a_Position; uniform mat4 u_ModelMatrix; void main() gl_Position = a_Position * u_ModelMatrix ; gl_Position = u_ModelMatrix *a_Position ; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.8); `;function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.2, -0.25, -0.25, 0.25, -0.25 ]); let vertexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return vertices.length / 2;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); let modelMatrix = new Matrix4(); let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); modelMatrix.setRotate(ANGEL, 0, 0, 1); modelMatrix.translate(Tx, Ty, Tz); gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);å°æ¡ˆä¾‹ï¼šå…ˆæ—‹è½¬å†å¹³ç§»å¯¹æ¯”åŒºåˆ«éœ€è¦è°ƒç”¨çš„æ–¹æ³•å’Œé¡ºåºéƒ½è¦å˜æ¢modelMatrix.setTranslate(Tx, Ty, Tz);modelMatrix.rotate(ANGEL, 0, 0, 1);è¿è¡Œç»“æœ"},{"title":"åŠ¨ç”»","path":"/wiki/WebGL/chapter_04_02.html","content":"å®ç°åŠ¨ç”»çš„å…³é”®å°±æ˜¯ï¼šä¸æ–­æ“¦é™¤å¹¶é‡ç»˜åŠ¨ç”»å›¾å½¢ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡é‡ç»˜æ—¶è½»å¾®çš„æ”¹å˜åŠ¨ç”»å±æ€§ã€‚ Rotating TriangleRotatingTriangle Code RotatingTriangleè¿è¡Œæ•ˆæœRotatingTriangle.htmlRotatingTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./RotatingTriangle.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; uniform mat4 u_ModelMatrix; void main() gl_Position = u_ModelMatrix * a_Position; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.5); `;let ANGLE_STEP = 45.0;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); gl.clearColor(0.0, 0.0, 0.0, 1.0); // ä¸‰è§’å½¢å½“å‰æ—‹è½¬è§’åº¦ let currentAngle = 0.0; // æ¨¡å‹çŸ©é˜µ Matrix4å¯¹è±¡ let modelMatrix = new Matrix4(); // å¼€å§‹ç»˜åˆ¶ä¸‰è§’å½¢ var tick = function () // æ›´æ–°æ—‹è½¬è§’ currentAngle = animate(currentAngle); draw(gl, n, currentAngle, modelMatrix, u_ModelMatrix); // è¯·æ±‚æµè§ˆå™¨è°ƒç”¨tick requestAnimationFrame(tick); ; tick(); function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.25, -0.25, -0.25, 0.25, -0.25 ]); let vertexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return vertices.length / 2;function draw(gl, n, currentAngle, modelMatrix, u_ModelMatrix) // è®¾ç½®æ—‹è½¬çŸ©é˜µ modelMatrix.setRotate(currentAngle, 0, 0, 1); // å°†æ—‹è½¬çŸ©é˜µä¼ è¾“ç»™é¡¶ç‚¹ç€è‰²å™¨ gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements); // æ¸…é™¤canvas gl.clear(gl.COLOR_BUFFER_BIT); // ç»˜åˆ¶ä¸‰è§’å½¢ gl.drawArrays(gl.TRIANGLES, 0, n);// è®°å½•ä¸Šä¸€æ¬¡è°ƒç”¨å‡½æ•°çš„æ—¶åˆ»let g_last = Date.now();function animate(angle) // è®¡ç®—è·ç¦»ä¸Šæ¬¡è°ƒç”¨ç»è¿‡å¤šé•¿æ—¶é—´ var now = Date.now(); var elapsed = now - g_last; // æ¯«ç§’ g_last = now; // æ ¹æ®è·ç¦»ä¸Šæ¬¡è°ƒç”¨çš„æ—¶é—´ï¼Œæ›´æ–°å½“å‰æ—‹è½¬è§’åº¦ let newAngle = angle + (ANGLE_STEP * elapsed) / 1000.0; return newAngle %= 360; æ­¥éª¤åˆ†è§£ åå¤è°ƒç”¨ç»˜åˆ¶å‡½æ•° tick()tickä¸­å®ç°äº†å…³é”®çš„2ä¸ªæ­¥éª¤ï¼š æ›´æ–°è§’åº¦ é‡ç»˜ ä¸‹å›¾çš„åŸºæœ¬æ­¥éª¤å¯ä»¥ç”¨æ¥å®ç°å„ç§åŠ¨ç”»ï¼Œæ˜¯3Då›¾å½¢ç¼–ç¨‹çš„å…³é”®æŠ€æœ¯ã€‚ æŒ‰ç…§æŒ‡å®šæ—‹è½¬è§’åº¦ç»˜åˆ¶ä¸‰è§’å½¢ draw()drawä¸€å…±æœ‰å››æ­¥æ“ä½œï¼š step1è®¾ç½®æ—‹è½¬çŸ©é˜µã€‚modelMatrix.setRotate(currentAngle,0,0,1);step2å°†æ—‹è½¬çŸ©é˜µä¼ å…¥Vertex_Shaderã€‚gl.uniformMatrix4fv(u_ModelMatrix,false,modelMatrix.elements);step3æ¸…é™¤canvasã€‚gl.clear(gl.COLOR_BUFFER_BIT);step4å¼€å§‹ç»˜åˆ¶ã€‚gl.drawArrays(gl.TRIANGLES,0,n);è¯·æ±‚å†æ¬¡è¢«è°ƒç”¨ requestAnimationFrame()ä¸ºä»€ä¹ˆä¸ç”¨setIntervalï¼Ÿ å¦‚æœè¦å®ç° é‡å¤æ‰§è¡ŒæŸä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼ŒsetInterval æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªå¼Šç«¯ï¼šä¸ç®¡å…¶è¢«è°ƒç”¨çš„æ ‡ç­¾é¡µæ˜¯å¦è¢«æ¿€æ´»ï¼Œå…¶ä¸­çš„setInterval()å‡½æ•°éƒ½ä¼šåå¤è°ƒç”¨ã€‚è¿™ä¼šå¢åŠ æµè§ˆå™¨çš„è´Ÿè·ï¼ŒrequestAnimationåªæœ‰åœ¨æ ‡ç­¾é¡µæ¿€æ´»æ—¶æ‰ç”Ÿæ•ˆã€‚ ä¹Ÿå¯ä»¥é€šè¿‡ cancelAnimationFrame å–æ¶ˆè¯·æ±‚ï¼š æ›´æ–°æ—‹è½¬è§’ aniamte()è¦æ³¨æ„çš„æ˜¯ï¼šè°ƒç”¨requestAnimationFrame(),åªæ˜¯è¯·æ±‚æµè§ˆå™¨åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨å‚æ•°å‡½æ•°ï¼Œå› æ­¤ä¸èƒ½ä¿è¯æ¯æ¬¡è°ƒç”¨é—´éš”çš„æ—¶é—´ç›¸åŒï¼Œéœ€è¦è®¡ç®—æ—¶é—´é—´éš”ï¼Œå¹¶ç”±æ—¶é—´é—´éš”è®¡ç®—è¿™ä¸€å¸§ä¸­ä¸‰è§’å½¢çš„æ—‹è½¬è§’åº¦ã€‚ g_last ä¸Šä¸€å¸§å¼€å§‹çš„æ—¶é—´elapsed ä¸¤å¸§ä¹‹é—´æ—¶é—´é—´éš” è¿™ä¸€å¸§å¼€å§‹çš„æ—¶é—´ - g_lastANGLE_STEP1000.0 æ¯æ¯«ç§’æ—‹è½¬åº¦æ•°æ—‹è½¬å˜åŒ–åº¦æ•° ANGLE_STEP 1000.0 * elapsed let newAngle = angle + (ANGLE_STEP * elapsed) / 1000.0; Rotating Translated Triangleç»“åˆæœ¬ç« å†…å®¹çš„å°åŠ¨ç”»"},{"title":"é€ç‰‡å…ƒæ“ä½œ","path":"/wiki/WebGL/chapter_05_02.html","content":"å‡ ä½•å½¢çŠ¶çš„è£…é…å’Œå…‰æ …åŒ–ColoredTriangle ä¿®æ”¹MultiAttributeColoré‡ŒdrawArrayså‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º TRIANGLESã€‚gl.drawArrays(gl.TRIANGLES, 0, n);ColoredTriangleè¿è¡Œç»“æœ å›¾å…ƒè£…é…ä¸å…‰æ …åŒ–è¿‡ç¨‹ è€ƒè™‘å‡ ä¸ªå°é—®é¢˜Fragment_Shaderå¦‚ä½•è¿›è¡Œé€ç‰‡å…ƒæ“ä½œçš„ï¼Ÿç­”ï¼š ä¼ å…¥é¡¶ç‚¹åæ ‡ã€å›¾å½¢è£…é…ã€å…‰æ …åŒ–ã€æ‰§è¡Œç‰‡å…ƒç€è‰²å™¨ã€‚ è°æ¥ç¡®å®šå“ªäº›åƒç´ éœ€è¦è¢«ç€è‰²ï¼Ÿç­”ï¼š gl.drawArray()å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±å†³å®šå‡ ä½•å›¾å½¢çš„ç±»å‹ï¼Œå³å›¾å…ƒè£…é…è¿‡ç¨‹çš„æœ€ç»ˆç»“æœå†³å®šéœ€è¦è¢«ç€è‰²çš„åƒç´ ä½ç½®ã€‚ è°æ¥è´Ÿè´£è°ƒç”¨ç‰‡å…ƒç€è‰²å™¨ï¼Ÿç­”ï¼š ä¸€æ—¦å…‰æ …åŒ–è¿‡ç¨‹ç»“æŸåï¼Œç¨‹åºå°±å¼€å§‹é€ç‰‡å…ƒè°ƒç”¨ç‰‡æºç€è‰²å™¨ã€‚ ç‰‡å…ƒç€è‰²å™¨æ˜¯æ€æ ·å¤„ç†æ¯ä¸ªç‰‡å…ƒçš„ï¼Ÿç­”ï¼š ç‰‡å…ƒç€è‰²å™¨è®¡ç®—å‡ºè¯¥ç‰‡å…ƒçš„é¢œè‰²ï¼Œå¹¶å†™å…¥é¢œè‰²ç¼“å†²åŒºã€‚ é€ç‰‡å…ƒæ“ä½œæ­¥éª¤è·å–é¡¶ç‚¹åæ ‡å›¾å…ƒè£…é…ï¼šå°†ç¦»æ•£é¡¶ç‚¹åæ ‡è£…é…æˆå‡ ä½•å›¾å½¢ã€‚å…‰æ …åŒ–ï¼šå°†è£…é…å¥½çš„å‡ ä½•å›¾å½¢è½¬åŒ–ä¸ºç‰‡å…ƒã€‚æ‰§è¡Œç‰‡å…ƒç€è‰²å™¨å›¾å…ƒï¼ˆprimitivesï¼‰å‡ ä½•å›¾å½¢è£…é…ï¼ˆgeometric shape assemblyï¼‰ï¼Œåˆç§°å›¾å…ƒè£…é…è¿‡ç¨‹ï¼ˆprimitive assembly processï¼‰ï¼Œå›¾å…ƒï¼ˆprimitivesï¼‰ï¼š æŒ‡è¢«è£…é…å‡ºçš„åŸºæœ¬å›¾å½¢ï¼ˆç‚¹çº¿é¢ï¼‰å…‰æ …åŒ–ï¼ˆrasterizationï¼‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å›¾å½¢æ˜¯ç”± åƒç´  ç»„æˆçš„ï¼Œå› æ­¤éœ€è¦å°†å›¾å½¢è½¬åŒ–ä¸º ç‰‡å…ƒï¼Œè¿™ä¸ªè¿‡ç¨‹å³ç§°ä¸º å…‰æ …åŒ–ã€‚ç‰‡å…ƒæ•°ç›® å°±æ˜¯å›¾å½¢æœ€ç»ˆåœ¨å±å¹•ä¸Šæ‰€è¦†ç›–çš„åƒç´ æ•°ã€‚é€ç‰‡å…ƒæ“ä½œæ­¥éª¤åˆ†è§£ä»¥ç»˜åˆ¶å•è‰²ä¸‰è§’å½¢ä¸ºä¾‹step1æ‰§è¡Œé¡¶ç‚¹ç€è‰²å™¨ï¼Œå°†ç¼“å†²åŒºå¯¹è±¡ç¬¬ä¸€ä¸ªé¡¶ç‚¹åæ ‡ä¼ é€’ç»™gl_Positionï¼Œä½¿å…¶å­˜å‚¨è¿›å…¥å›¾å½¢è£…é…åŒºåŸŸã€‚step2åŒæ ·æ–¹æ³•ä¼ å…¥å¹¶å­˜å‚¨ç¬¬äºŒä¸ªé¡¶ç‚¹åæ ‡ã€‚step3åŒæ ·æ–¹æ³•ä¼ å…¥å¹¶å­˜å‚¨ç¬¬ä¸‰ä¸ªé¡¶ç‚¹åæ ‡ã€‚step4ä½¿ç”¨ä¼ å…¥åæ ‡ï¼Œæ ¹æ®gl.drawArrays()ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¼€å§‹è£…é…å›¾å½¢ã€‚step5å°†å›¾å½¢è½¬åŒ–ä¸ºç‰‡å…ƒï¼Œå³å…‰æ …åŒ–ã€‚step6-15é€ç‰‡å…ƒè°ƒç”¨ç‰‡å…ƒç€è‰²å™¨ï¼Œè®¡ç®—æ¯ä¸ªç‰‡å…ƒçš„é¢œè‰²ï¼Œå†™å…¥é¢œè‰²ç¼“å†²åŒºã€‚ Colored Triangleæœ¬æ¡ˆä¾‹å¯ä»¥è¯æ˜ç‰‡å…ƒç€è‰²å™¨å¯¹æ¯ä¸ªç‰‡å…ƒçš„æ“ä½œç¡®å®å­˜åœ¨ã€‚ gl_FragCoord ç‰‡å…ƒç€è‰²å™¨ä½¿ç”¨ å†…ç½®å˜é‡ gl_FragCoord æ¥è®¿é—®ç‰‡å…ƒçš„åæ ‡ã€‚ æ³¨æ„gl_FragCoordé‡‡ç”¨çš„æ˜¯canvasåæ ‡ç³»ç»Ÿã€‚ ColoredTriangle Code ColoredTriangleè¿è¡Œç»“æœColoredTriangle.htmlColoredTriangle.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./ColoredTriangle.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; `;let FSHADER_SOURCE = ` precision mediump float; uniform float u_Width; uniform float u_Height; void main() gl_FragColor = vec4( 0.0, gl_FragCoord.x/u_Width, gl_FragCoord.y/u_Height, 1.0 ); `;function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); let n = 3; let vertexBuffer = gl.createBuffer(); if (!vertexBuffer) return -1; gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return n;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(è·å–ä¸Šä¸‹æ–‡å¤±è´¥); return; if (!initShaders(gl,VSHADER_SOURCE,FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); if (n 0) console.log(åˆ›å»ºç¼“å†²åŒºå¤±è´¥); return; let u_Width = gl.getUniformLocation(gl.program, u_Width), u_Height = gl.getUniformLocation(gl.program, u_Height); gl.uniform1f(u_Width, canvas.width); gl.uniform1f(u_Height, canvas.height); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n); varyingå˜é‡çš„ä½œç”¨å’Œå†…æ’è¿‡ç¨‹å†…æ’è¿‡ç¨‹ v_shaderä¸­çš„varyingå˜é‡åœ¨ä¼ å…¥f_shaderä¹‹å‰ç»è¿‡äº†å†…æ’è¿‡ç¨‹ã€‚ä¸ºä»€ä¹ˆè¦å°†è¿™ç§åœ¨ç€è‰²å™¨ä¹‹é—´ä¼ é€’æ•°å€¼çš„ç±»å‹ç§°ä¸ºvaryingï¼Ÿç­”ï¼š å› ä¸ºç‰‡å…ƒç€è‰²å™¨ä¸­å£°æ˜çš„åŒååŒç±»å‹å˜é‡å’Œé¡¶ç‚¹ç€è‰²å™¨å£°æ˜çš„å˜é‡å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚ è¦ç»˜åˆ¶ä¸€æ¡ä¸¤ç«¯é¢œè‰²ä¸åŒçš„çº¿æ®µï¼Œåªè¦å‘ é¡¶ç‚¹ç€è‰²å™¨çš„varyingå˜é‡ é™„ä¸Šä¸¤ç§é¢œè‰²ï¼ŒWebGLå°±ä¼š è‡ªåŠ¨è®¡ç®—å‡ºçº¿æ®µä¸Šçš„æ‰€æœ‰ç‰‡å…ƒï¼ˆç‚¹ï¼‰çš„é¢œè‰²,ç„¶åèµ‹å€¼ç»™ ç‰‡å…ƒç€è‰²å™¨çš„varyingå˜é‡ ã€‚ è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º å†…æ’è¿‡ç¨‹ï¼ˆinterpolation processï¼‰ã€‚å…‰æ …åŒ–è´Ÿè´£å°†çŸ¢é‡å‡ ä½•å›¾å½¢è½¬å˜ä¸ºæ …æ ¼åŒ–çš„ç‰‡å…ƒï¼ˆåƒç´ ï¼‰ã€‚"},{"title":"é¢œè‰²ä¸çº¹ç†","path":"/wiki/WebGL/chapter_05_01.html","content":"MutiAttributeSizeæœ¬æ¡ˆä¾‹ä¸»è¦ä»‹ç»å¦‚ä½•å°†å¤šä¸ªé¡¶ç‚¹æ•°æ®é€šè¿‡ç¼“å†²åŒºå¯¹è±¡ä¼ å…¥é¡¶ç‚¹ç€è‰²å™¨ MutiAttributeSize Code MutiAttributeSizeè¿è¡Œç»“æœMutiAttributeSize.htmlMutiAttributeSize.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./MutiAttributeSize.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute float a_PointSize; void main() gl_Position = a_Position; gl_PointSize = a_PointSize; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.5); `;function initVertexBuffer(gl) let vertices = new Float32Array([ 0.0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); let sizes = new Float32Array([ 10.0, 20.0, 30.0 ]); let vertexBuffer = gl.createBuffer(); let sizeBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); gl.bindBuffer(gl.ARRAY_BUFFER, sizeBuffer); gl.bufferData(gl.ARRAY_BUFFER, sizes, gl.STATIC_DRAW); let a_PointSize = gl.getAttribLocation(gl.program, a_PointSize); gl.vertexAttribPointer(a_PointSize, 1, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_PointSize); return sizes.lengthfunction main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(åˆå§‹åŒ–ç€è‰²å™¨å¤±è´¥); return; let n = initVertexBuffer(gl); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, n); 2ç§æ”¯æŒä¼ é€’å¤šç§é¡¶ç‚¹æ•°æ®ä¿¡æ¯çš„æ–¹å¼ æ–¹æ³•1ï¼šåˆ›å»ºå¤šä¸ªç¼“å†²åŒºå¯¹è±¡æœ€ç®€å•ç²—æš´çš„ä¸€ç§æ–¹å¼ã€‚è¦å‘Vertex_Shaderä¼ é€’å¤šä»½é€é¡¶ç‚¹æ•°æ®ä¿¡æ¯ï¼Ÿåªéœ€è¦ä¸ºé¡¶ç‚¹çš„æ¯ç§æ•°æ®å»ºç«‹ä¸€ä¸ªç¼“å†²åŒºå°±OKäº†ã€‚ **OSï¼š**è¿™ç§æ–¹æ³•å°±åƒå­¦æ ¡çš„æ•™ç§‘ä¹¦ï¼Œæ¯ç« ä¹ é¢˜ä¸åŠ åœ¨è¿™ä¸€ç« åé¢ï¼Œéè¦é…å¥—æ¥ä¸€å¥—ä¹ é¢˜é›†ï¼Œåšé¢˜æ—¶ä¸¤æœ¬ä¹¦åŠ è‰ç¨¿çº¸æ‘Šå¼€æ¡Œå­ä¹±çš„ç¬”éƒ½æ‰¾ä¸åˆ°ã€‚ï¼ˆè„‘è¡¥ä¸€ä¸‹æ¡Œå­å¯¹åº”çš„å°±æ˜¯è¿è¡Œç¯å¢ƒï¼‰ æ–¹æ³•2ï¼šåˆ©ç”¨vertexAttribPointerçš„æ­¥è¿›å’Œåç§»å‚æ•°åˆ›å»ºå¤šä¸ªç¼“å†²åŒºæ¯”è¾ƒé€‚åˆ æ•°æ®é‡ä¸å¤§çš„æƒ…å†µã€‚ æ›´å¸¸ç”¨çš„æ˜¯åˆ©ç”¨æŸäº›æœºåˆ¶åˆ†åˆ«è®¿é—®ç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡ä¸­çš„ä¸åŒç§ç±»æ•°æ®ã€‚è¿™é‡Œä»‹ç»çš„æ˜¯ äº¤é”™ç»„ç»‡ï¼ˆinterleavingï¼‰å³å°†ä¸åŒç§ç±»æ•°æ®äº¤å‰å­˜å‚¨åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼Œåˆ©ç”¨vertexAttribPointerçš„ æ­¥è¿›ï¼ˆstrideï¼‰ å’Œ åç§»(offset) æ¥è·å–ç‰¹å®šæ•°æ®ã€‚ let verticesSizes = new Float32Array([ 0.0, 0.5, 10.0, // ç¬¬ä¸€ä¸ªç‚¹ -0.5, -0.5, 20.0, // ç¬¬äºŒä¸ªç‚¹ 0.5, -0.5, 30.0, // ç¬¬ä¸‰ä¸ªç‚¹]) MultiAttributeSize_Interleavedæœ¬æ¡ˆä¾‹ä¸»è¦ä»‹ç»åˆ©ç”¨vertexAttribPointerçš„æ­¥è¿›å’Œåç§»æ¥è·å–ç‰¹å®šæ•°æ®ã€‚ MutiAttributeSize_Interleaved MutiAttributeSize_Interleavedè¿è¡Œç»“æœMutiAttributeSize_Interleaved.htmlMutiAttributeSize_Interleaved.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./MultiAttributeSize_Interleaved.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute float a_PointSize; void main() gl_Position = a_Position; gl_PointSize = a_PointSize; `;let FSHADER_SOURCE = ` void main() gl_FragColor = vec4(0.0,1.0,0.0,0.4); `;function initVertexBUffer(gl) let verticesSize = new Float32Array([ 0.0, 0.5, 10.0, // ç¬¬ä¸€ä¸ªç‚¹ -0.5, -0.5, 20.0, // ç¬¬äºŒä¸ªç‚¹ 0.5, -0.5, 30.0, // ç¬¬ä¸‰ä¸ªç‚¹ ]) let n = 3; let vertexSizeBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexSizeBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesSize, gl.STATIC_DRAW); let FSIZE = verticesSize.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 3, 0); gl.enableVertexAttribArray(a_Position); let a_PointSize = gl.getAttribLocation(gl.program, a_PointSize); gl.vertexAttribPointer(a_PointSize, 1, gl.FLOAT, false,FSIZE * 3, FSIZE * 2); gl.enableVertexAttribArray(a_PointSize); return n;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBUffer(gl); gl.clearColor(0.0,0.0,0.0,1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, n); vertexAttribPointerçš„ä½œç”¨æœºåˆ¶ BYTES_PRE_ELEMENTç±»å‹åŒ–æ•°ç»„çš„é»˜è®¤å±æ€§ï¼Œå¯ä»¥è¡¨ç¤ºæ•°ç»„ä¸­ æ¯ä¸ªå…ƒç´ æ‰€å çš„å­—èŠ‚æ•° ã€‚ MultiAttributeColorï¼ˆvaryingå˜é‡ï¼‰æœ¬ç¨‹åºä¸»è¦ä»‹ç»å¦‚ä½•ä½¿Vertex_Shaderçš„æ•°æ®è¿›å…¥Fragment_Shaderã€‚ï¼ˆæå‰å‰§é€ï¼šä½¿ç”¨varyingå˜é‡ï¼‰ MultiAttributeColor MultiAttributeColorè¿è¡Œæ•ˆæœMultiAttributeColor.htmlMultiAttributeColor.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./MultiAttributeColor.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; varying vec4 v_Color; // varyingå˜é‡å£°æ˜ void main() gl_Position = a_Position; gl_PointSize = 10.0; v_Color = a_Color; // å°†æ•°æ®ä¼ é€’ç»™Fragment_Shader `;let FSHADER_SOURCE = ` precision mediump float; varying vec4 v_Color; void main() gl_FragColor = v_Color; // ä»é¡¶ç‚¹ç€è‰²å™¨æ¥å—æ•°æ® `;function initVertexBuffer(gl) let verticesColors = new Float32Array([ 0.0, 0.5, 1.0, 0.0, 0.0, -0.5, -0.5, 0.0, 1.0, 0.0, 0.5, -0.5, 0.0, 0.0, 1.0 ]); let n = 3; let FSIZE = verticesColors.BYTES_PER_ELEMENT; let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 5, 0); gl.enableVertexAttribArray(a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, FSIZE * 5, FSIZE * 2); gl.enableVertexAttribArray(a_Color); return n;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, n); varyingå˜é‡ varyingå˜é‡å¯é€‰ç±»å‹ï¼š float vec[2-4] mat[2-4] æˆ‘ä»¬åœ¨Vertex_Shaderä¸­å£°æ˜äº†ä¸€ä¸ªvaryingå˜é‡ï¼Œé‚£Fragment_Shaderè¦æ€ä¹ˆæ¥æ”¶å‘¢ï¼Ÿç­”ï¼šåœ¨Fragment_Shaderä¸­å£°æ˜ä¸€ä¸ªåŒåä¸”åŒç±»å‹çš„varyingå˜é‡å°±å¯ä»¥äº†ã€‚"},{"title":"çº¹ç†","path":"/wiki/WebGL/chapter_05_03.html","content":"åœ¨çŸ©é˜µè¡¨é¢è´´ä¸Šå›¾åƒå‡ ä¸ªåè¯ çº¹ç†æ˜ å°„ï¼ˆtexture mappingï¼‰ï¼š æ ¹æ®çº¹ç†å›¾åƒï¼Œä¸ºå…‰æ …åŒ–åçš„æ¯ä¸ªç‰‡å…ƒå¡«å……é€‚å½“çš„é¢œè‰²çº¹ç†ï¼ˆtextureï¼‰çº¹ç†å›¾åƒï¼ˆtexture imageï¼‰çº¹ç´ ï¼ˆtexelsï¼Œtexture elementsï¼‰ï¼š ç»„æˆçº¹ç†å›¾åƒçš„åƒç´ çº¹ç†åæ ‡ï¼ˆtexture coordinatesï¼‰ï¼š å†³å®šçº¹ç†å›¾åƒå“ªä¸ªéƒ¨åˆ†ç”¨äºè¦†ç›– çº¹ç†åæ ‡ è¡¨ç¤ºå›¾åƒä¸Šçš„åæ ‡ï¼ŒåŒæ ·è¿›è¡Œäº†å½’ä¸€åŒ–å¤„ç†ï¼Œä¸ºäº†å’Œxyåæ ‡åŒºåˆ†ï¼ŒWebGLä½¿ç”¨ ståæ ‡ç³»ç»Ÿ ã€‚ çº¹ç†æ˜ å°„æ­¥éª¤ å°†çº¹ç†åæ ‡æ˜ å°„åˆ°é¡¶ç‚¹ä¸Šstep1-æä¾›çº¹ç†å‡†å¤‡å¥½æ˜ å°„åˆ°å‡ ä½•å›¾å½¢ä¸Šçš„çº¹ç†å›¾åƒã€‚step2-é…ç½®æ˜ å°„ä¸ºå‡ ä½•å›¾å½¢é…ç½®çº¹ç†æ˜ å°„æ–¹å¼ã€‚step3-åŠ è½½çº¹ç†åŠ è½½çº¹ç†å›¾åƒå¹¶å¯¹å…¶è¿›è¡Œä¸€äº›é…ç½®ã€‚step4-æŠ½å–çº¹ç´ åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­å°†ç›¸åº”çº¹ç´ ä»çº¹ç†ä¸­æŠ½å–å‡ºæ¥ï¼Œèµ‹å€¼ç»™ç‰‡å…ƒã€‚ TexturedQuadTexturedQuad TexturedQuadè¿è¡Œæ•ˆæœTexturedQuad.htmlTexturedQuad.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./TexturedQuad.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/html// ç¬¬1éƒ¨åˆ†ï¼šè®¾ç½®é¡¶ç‚¹ç€è‰²å™¨let VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec2 a_TexCoord; varying vec2 v_TexCoord; void main() gl_Position = a_Position; v_TexCoord = a_TexCoord; `;// ç¬¬2éƒ¨åˆ†ï¼šè®¾ç½®ç‰‡å…ƒç€è‰²å™¨let FSHADER_SOURCE = ` precision mediump float; uniform sampler2D u_Sampler; varying vec2 v_TexCoord; void main() gl_FragColor = texture2D(u_Sampler,v_TexCoord); `;// ç¬¬3éƒ¨åˆ†ï¼šåˆ›å»ºåæ ‡ç¼“å†²åŒºfunction main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffers(gl); if (n 0) console.log(å˜é‡è·å–å¤±è´¥); return; if (!initTextures(gl, n)) console.log(çº¹ç†æ˜ å°„å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0);function initVertexBuffers(gl) let verticesTexCoords = new Float32Array([ -0.5, 0.5, 0.0, 1.0, -0.5, -0.5, 0.0, 0.0, 0.5, 0.5, 1.0, 1.0, 0.5, -0.5, 1.0, 0.0 ]); let n = 4; let FSIZE = verticesTexCoords.BYTES_PER_ELEMENT; let vertexTexCoordBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexTexCoordBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesTexCoords, gl.STATIC_DRAW); let a_Position = gl.getAttribLocation(gl.program, a_Position); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 4, 0); gl.enableVertexAttribArray(a_Position); let a_TexCoord = gl.getAttribLocation(gl.program, a_TexCoord); gl.vertexAttribPointer(a_TexCoord, 2, gl.FLOAT, false, FSIZE * 4, FSIZE * 2); gl.enableVertexAttribArray(a_TexCoord); return n;// ç¬¬4éƒ¨åˆ†ï¼šå‡†å¤‡çº¹ç†function initTextures(gl, n) // åˆ›å»ºçº¹ç†å¯¹è±¡ let texture = gl.createTexture(); // è·å–u_Sampler let u_Sampler = gl.getUniformLocation(gl.program, u_Sampler); // åˆ›å»ºimage let image = new Image(); // æ³¨å†Œå›¾åƒåŠ è½½äº‹ä»¶çš„å“åº”å‡½æ•° image.onload = function () loadTexture(gl, n, texture, u_Sampler, image); ; // æµè§ˆå™¨åŠ è½½å›¾åƒ image.src = ../img/tobydog.jpg; return true// ç¬¬5éƒ¨åˆ†ï¼šä½¿ç”¨çº¹ç†function loadTexture(gl, n, texture, u_Sampler, image) // å¯¹çº¹ç†å›¾åƒè¿›è¡Œyè½´åè½¬ gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1); // å¼€å¯0å·çº¹ç†å•å…ƒ gl.activeTexture(gl.TEXTURE0); // å‘targetç»‘å®šçº¹ç†å¯¹è±¡ gl.bindTexture(gl.TEXTURE_2D, texture); // é…ç½®çº¹ç†å‚æ•° gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); // é…ç½®çº¹ç†å›¾åƒ gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image); // å°†0å·çº¹ç†ä¼ é€’ç»™ç€è‰²å™¨ gl.uniform1i(u_Sampler, 0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLE_STRIP, 0, n); æ­¥éª¤è§£æ è®¾ç½®çº¹ç†åæ ‡ï¼šinitVertexBuffers()å°†é¡¶ç‚¹åæ ‡åˆ†é…ç»™a_Positionå¹¶å¼€å¯ï¼šlet a_Position = gl.getAttribLocation(gl.program, a_Position);gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 4, 0);gl.enableVertexAttribArray(a_Position);å°†çº¹ç†åæ ‡åˆ†é…ç»™a_TexCoordå¹¶å¼€å¯ï¼šlet a_TexCoord = gl.getAttribLocation(gl.program, a_TexCoord);gl.vertexAttribPointer(a_TexCoord, 2, gl.FLOAT, false, FSIZE * 4, FSIZE * 2);gl.enableVertexAttribArray(a_TexCoord);é…ç½®å’ŒåŠ è½½çº¹ç†ï¼šinitTexture()gl.createTexture()ç”¨äºåˆ›å»ºçº¹ç†å¯¹è±¡ã€‚çº¹ç†å›¾åƒç®¡ç†å•å…ƒä¸€å…±æœ‰8ä¸ªç®¡ç†çº¹ç†å›¾åƒçš„çº¹ç†å•å…ƒï¼šgl.TEXTURE[0-7] ï¼Œæ¯ä¸€ä¸ªéƒ½ä¸ gl.TEXTURE_2D ç›¸å…³ï¼Œgl.TEXTURE_2Dæ˜¯ ç»‘å®šçº¹ç†æ—¶çš„çº¹ç†ç›®æ ‡ã€‚ ä½¿ç”¨ gl.deleteTexture() åˆ é™¤çº¹ç†å¯¹è±¡ï¼šå¼‚æ­¥åŠ è½½çº¹ç†å›¾åƒå¤„äºå®‰å…¨è€ƒè™‘ï¼ŒWebGLä¸è¿è¡Œè·¨åŸŸè¯·æ±‚çº¹ç†å›¾åƒã€‚ OpenGLç¨‹åº ä¸ WebGLç½‘é¡µ è¯»å–çº¹ç†å›¾ç‰‡çš„åŒºåˆ«ï¼š OpenGLç›´æ¥ä»å­˜å‚¨çº¹ç†å›¾åƒçš„ç£ç›˜ä¸Šè¯»å–çº¹ç†å›¾åƒã€‚ WebGLä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦å‘æµè§ˆå™¨è¯·æ±‚å›¾åƒèµ„æºã€‚ ä¸ºWebGLé…ç½®çº¹ç†ï¼šloadTexture()function loadTexture(gl, n, texture, u_Sampler, image) // å¯¹çº¹ç†å›¾åƒè¿›è¡Œyè½´åè½¬ gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1); // å¼€å¯0å·çº¹ç†å•å…ƒ gl.activeTexture(gl.TEXTURE0); // å‘targetç»‘å®šçº¹ç†å¯¹è±¡ gl.bindTexture(gl.TEXTURE_2D, texture); // é…ç½®çº¹ç†å‚æ•° gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); // é…ç½®çº¹ç†å›¾åƒ gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image); // å°†0å·çº¹ç†ä¼ é€’ç»™ç€è‰²å™¨ gl.uniform1i(u_Sampler, 0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLE_STRIP, 0, n); çº¹ç†é…ç½®è¯¦ç»†æ­¥éª¤ STEP1ï¼šå›¾åƒYè½´åè½¬gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1); ä¸ºä»€ä¹ˆè¦è¿›è¡ŒYè½´åè½¬ï¼Ÿ ç­”ï¼š WebGLä¸ä¸€èˆ¬æ ¼å¼å›¾ç‰‡çš„yè½´æ–¹å‘ ç›¸åï¼Œéœ€è¦å°†å›¾ç‰‡yè½´åè½¬æ‰èƒ½è¿›è¡Œæ­£ç¡®æ˜ å°„ï¼Œæˆ–è€…æ‰‹åŠ¨åè½¬æ˜ å°„åæ ‡ã€‚ WebGL Yï¼ˆtï¼‰è½´æ–¹å‘ï¼š â†‘å›¾ç‰‡ç³»ç»Ÿ Yè½´æ–¹å‘ï¼š â†“ STEP2ï¼šæ¿€æ´»çº¹ç†å•å…ƒgl.activeTexture(gl.TEXTURE0); çº¹ç†å•å…ƒï¼ˆtexture unitï¼‰æ˜¯ç”¨æ¥å¹²å˜›çš„ï¼Ÿ ç­”ï¼š æ˜¯WebGLç”¨äº åŒæ—¶ä½¿ç”¨å¤šä¸ªçº¹ç† çš„ä¸€ç§æœºåˆ¶ã€‚æ¯ä¸ªçº¹ç†å•å…ƒæœ‰ä¸€ä¸ª å•å…ƒç¼–å· æ¥ç®¡ç†ä¸€å¼ çº¹ç†å›¾åƒï¼Œç³»ç»Ÿæ”¯æŒçš„çº¹ç†å•å…ƒçš„ä¸ªæ•°å–å†³äºï¼š ç¡¬ä»¶æµè§ˆå™¨çš„WebGLå®ç° ï¼ˆé€šå¸¸æ˜¯8ä¸ªï¼‰ STEP3ï¼šç»‘å®šçº¹ç†å¯¹è±¡gl.bindTexture(gl.TEXTURE_2D,texture); WebGLçš„ä¸¤ç§çº¹ç†ç±»å‹ å¯ä»¥çœ‹åˆ°ï¼Œçº¹ç†å¯¹è±¡çš„ç»‘å®šå®é™…ä¸Šæœ‰2æ­¥ï¼š çº¹ç†å¯¹è±¡çš„å¼€å¯ çº¹ç†å•å…ƒ ä¸ çº¹ç†å¯¹è±¡ çš„ç»‘å®š æ— æ³•ç›´æ¥æ“ä½œçº¹ç†å¯¹è±¡å¿…é¡»å°†çº¹ç†å¯¹è±¡ç»‘å®šåˆ°çº¹ç†å•å…ƒä¸Šï¼Œé€šè¿‡æ“ä½œçº¹ç†å•å…ƒæ¥æ“ä½œçº¹ç†å¯¹è±¡ã€‚ STEP4ï¼šé…ç½®çº¹ç†å¯¹è±¡çš„å‚æ•°gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR); é…ç½®æ¶‰åŠçš„å†…å®¹éƒ½åŒ…æ‹¬å“ªäº›ï¼Ÿ çº¹ç´ è·å–æ–¹å¼ çº¹ç†å¡«å……æ–¹å¼ çº¹ç†å‚æ•°å¯ä»¥æŒ‡å®š4ä¸ªå€¼ï¼š çº¹ç†è·å–æ–¹å¼ çº¹ç†å¡«å……æ–¹å¼ æ–¹æ³•å çº¹ç†å‚æ•° æè¿° é»˜è®¤å€¼ å›¾è§£ å‚æ•°å€¼ å‚æ•°æè¿° æ”¾å¤§æ–¹æ³• gl.TEXTURE_MAG_FILTER å°çº¹ç†ç»˜åˆ¶å¤§èŒƒå›´ï¼Œå¡«å……ç©ºéš™ gl.LINEAR gl.NEAREST ä»¥ä¸­å¿ƒåƒç´ ä¸ºé”šç‚¹ï¼Œ æŒ‰ç…§ç‚¹ä½ä¸ä¸­å¿ƒç‚¹çš„æ›¼å“ˆé¡¿è·ç¦»å¤§å°æ˜ å°„ gl.LINEAR è·åƒç´ ä¸­å¿ƒæœ€è¿‘çš„å››ä¸ªåƒç´ é¢œè‰²å€¼åŠ æƒå¹³åˆ†æ±‚å‡ºçš„ï¼Œè´¨é‡æ›´å¥½ï¼Œå¼€é”€æ›´å¤§ ç¼©å°æ–¹æ³• gl.TEXTURE_MIN_FILTER å¤§çº¹ç†ç»˜åˆ¶å°èŒƒå›´ï¼Œå‰”é™¤åƒç´  gl.NEAREST_MIPMAP_LINEAR gl.NEAREST - gl.LINEAR - æ°´å¹³å¡«å…… gl.TEXTURE_WRAP_S å·¦å³ä¾§åŒºåŸŸçš„å¡«å…… gl.REPEAT gl.REPEAT å¹³é“ºå¼çš„é‡å¤çº¹ç† gl.MIRRORED_REPEAT é•œåƒå¯¹ç§°å¼çš„é‡å¤çº¹ç† gl.CLAMP_TO_EDGE ä½¿ç”¨çº¹ç†å›¾åƒè¾¹ç¼˜å€¼ å‚ç›´å¡«å…… gl.TEXTURE_WRAP_T ä¸Šä¸‹åŒºåŸŸçš„å¡«å…… gl.REPEAT - gl.MIRRORED_REPEAT - gl.CLAMP_TO_EDGE - MIPMAPï¼ˆé‡‘å­—å¡”ï¼‰çº¹ç†ç±»å‹å®é™…ä¸Šæ˜¯åŸå§‹çº¹ç†å›¾åƒçš„ä¸€ç³»åˆ—ä¸åŒåˆ†è¾¨ç‡çš„ç‰ˆæœ¬ã€‚ æ›¼å“ˆé¡¿è·ç¦»å³ç›´è§’è·ç¦»ï¼Œæ£‹ç›˜è·ç¦»ï¼Œï¼ˆx1ï¼Œy1ï¼‰ä¸ï¼ˆx2ï¼Œy2ï¼‰çš„æ›¼å“ˆé¡¿è·ç¦»ä¸º|x1-x2|+|y1-y2|ã€‚ STEP5ï¼šå°†çº¹ç†å›¾åƒåˆ†é…ç»™çº¹ç†å¯¹è±¡gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,gl.RGB,gl.UNSIGNED_BYTE,image); çº¹ç†æ•°æ®æ ¼å¼ï¼ˆinternalformatï¼‰ çº¹ç†æ•°æ®æ ¼å¼çš„é€‰æ‹©è¦æ ¹æ® çº¹ç†å›¾åƒçš„æ ¼å¼ï¼šPNG é€šå¸¸ä½¿ç”¨ gl.RGBAJPGã€BMP é€šå¸¸ä½¿ç”¨ gl.RGBç°åº¦å›¾ é€šå¸¸ä½¿ç”¨ gl.LUMINANCEgl.LUMINANCE_ALPHAæµæ˜ï¼ˆluminanceï¼‰è¡¨ç¤ºç‰©ä½“è¡¨é¢äº®åº¦ï¼Œé€šå¸¸ä½¿ç”¨ç‰©ä½“è¡¨é¢çº¢ç»¿è“åˆ†é‡å€¼åŠ æƒå¹³å‡è®¡ç®—æµæ˜ã€‚WebGLä¸­ï¼Œinternalformatå¿…é¡»å’Œformatä¸€æ ·ã€‚ çº¹ç†æ•°æ®ç±»å‹ï¼ˆtypeï¼‰ é™¤äº†UNSIGNED_BYTEæ•°æ®ç±»å‹ï¼Œå…¶ä»–æ ¼å¼åŸºæœ¬éƒ½éµå¾ª16æ¯”ç‰¹è§„åˆ™ï¼šå°†RGBä¸‰åˆ†é‡å‹ç¼©å…¥16æ¯”ç‰¹ä¸­ã€‚è®¾ç½®ä¸åŒæ ¼å¼ç›®çš„æ˜¯ä¸ºäº† å‹ç¼©æ•°æ®ï¼Œå‡å°‘åŠ è½½æ—¶é—´ ã€‚ STEP6ï¼šå°†çº¹ç†å•å…ƒä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨sampler2D uniform sampler2D u_Sampler;uniform è¡¨ç¤ºçº¹ç†å›¾åƒä¸ä¼šéšç‰‡å…ƒå˜åŒ–sampler2D æ˜¯ä¸€ç§ä¸“ç”¨äºçº¹ç†å¯¹è±¡çš„æ•°æ®ç±»å‹ uniform1i gl.uniform1i(u_Sampler,0); // 0 è¡¨ç¤º gl.TEXTURE0å¯¹äºsamplerç±»å‹ï¼Œå¿…é¡»å°†å…¶æŒ‡å®šçš„ çº¹ç†å•å…ƒç¼–å·ï¼ˆtexture unit numberï¼‰ ä¼ ç»™ç€è‰²å™¨ã€‚ STEP7ï¼šä»é¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡å…ƒç€è‰²å™¨ä¼ è¾“çº¹ç†åæ ‡let VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec2 a_TexCoord; varying vec2 v_TexCoord; void main() gl_Position = a_Position; v_TexCoord = a_TexCoord; ` ä¼ é€’Vertex_Shaderè·å–åˆ°çº¹ç†åæ ‡a_TexCoordåï¼Œé€šè¿‡v_TexCoordä¼ é€’åˆ°Fragment_Shaderã€‚å†…æ’è™½ç„¶åªæ˜ç¡®ä¼ å…¥äº†ç»˜åˆ¶èŒƒå›´çš„é¡¶ç‚¹çº¹ç†åæ ‡ï¼Œä½†æ˜¯ç‰‡å…ƒçš„çº¹ç†åæ ‡ä¼šåœ¨å…‰æ …åŒ–çš„è¿‡ç¨‹ä¸­å†…æ’å‡ºæ¥ã€‚æŠ½å–åå¡«è‰²æ ¹æ®è®¡ç®—å‡ºçš„ç‰‡å…ƒçº¹ç†åæ ‡ï¼Œä»çº¹ç†å›¾åƒä¸ŠæŠ½å–å‡ºçº¹ç´ çš„é¢œè‰²ï¼Œç„¶åæ¶‚æŠ¹åˆ°ç‰‡å…ƒä¸Šã€‚STEP8ï¼šåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è·å–çº¹ç†åƒç´ é¢œè‰²gl_FragColor = texture2D( u_Sampler, v_TexCoord); texture2Dæ˜¯GLSL ESçš„å†…ç½®å‡½æ•°ï¼Œå®ƒåªéœ€è¦çŸ¥é“ä¸¤ä¸ªå‚æ•°ï¼š çº¹ç†å•å…ƒç¼–å· å’Œ çº¹ç†åæ ‡ï¼Œå°±èƒ½å¤Ÿå–å¾—çº¹ç†ä¸Šçš„åƒç´ é¢œè‰²ã€‚ **OSï¼š**åŸºæœ¬åŸç†å°±å’ŒæŸ¥å­—å…¸ä¸€æ ·ï¼ŒçŸ¥é“å¤§ä½“çš„æ¨¡å—ï¼Œå†çŸ¥é“å…·ä½“åæ ‡ï¼Œå°±èƒ½æå–åˆ°ä¸€åˆ‡ä½ éœ€è¦æŸ¥è¯¢çš„ä¿¡æ¯ã€‚ texture2Dçš„è¿”å›å€¼ å°±å¿…é¡»è¦æåˆ°ä¹‹å‰å¯¹WebGLçº¹ç†è¿›è¡Œé…ç½®çš„ texParameteri å’Œ texImage2Dã€‚texParameteri çš„ çº¹ç†å‚æ•°ï¼ˆpnameï¼‰ ç›´æ¥å†³å®šWebGLæ±‚å–ç‰‡å…ƒçº¹ç†åæ ‡å†…æ’å€¼çš„æ–¹å¼ã€‚texImage2D çš„ çº¹ç†æ•°æ®æ ¼å¼ï¼ˆinternalformatï¼‰ ç›´æ¥å†³å®š texture2Dè¿”å›å€¼ç±»å‹ã€‚ å°å®éªŒ TexturedQuad_Repeatlet verticesTexCoords = new Float32Array([ -0.5, 0.5, -0.3, 1.7, -0.5, -0.5, -0.3, -0.2, 0.5, 0.5, 1.7, 1.7, 0.5, -0.5, 1.7, -0.2]); TexturedQuad_Repeatè¿è¡Œç»“æœ ä¹‹æ‰€ä»¥ä¼šé‡å¤ï¼Œæ˜¯å› ä¸º gl.TEXTURE_WRAP_S å’Œ gl.TEXTURE_WRAP_T éƒ½è®¾ç½®ä¸ºäº† gl.REPEATã€‚çº¹ç†åæ ‡ç¤ºæ„å›¾ TexturedQuad_Mirrorgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.MIRRORED_REPEAT);gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.MIRRORED_REPEAT); TexturedQuad_Mirrorè¿è¡Œç»“æœ MultiTextureæœ¬æ¡ˆä¾‹ä¸»è¦ä»‹ç»å¦‚ä½•åŒæ—¶å¤„ç†å¤šå¹…çº¹ç†ã€‚ MultiTexture Code MultiTextureè¿è¡Œç»“æœMultiTexture.htmlMultiTextture.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./MultiTexture.js/script/headbody onload=main() canvas id=webgl width=300 height=300/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec2 a_TexCoord; varying vec2 v_TexCoord; void main() gl_Position = a_Position; v_TexCoord = a_TexCoord; `;let FSHADER_SOURCE = ` precision mediump float; uniform sampler2D u_Sampler0; uniform sampler2D u_Sampler1; varying vec2 v_TexCoord; void main() vec4 color0 = texture2D(u_Sampler0,v_TexCoord); vec4 color1 = texture2D(u_Sampler1,v_TexCoord); gl_FragColor = color0 * color1; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); if (!initTexture(gl, n)) console.log(çº¹ç†æ˜ å°„å¤±è´¥); return; gl.clearColor(0.0, 0.0, 0.0, 1.0);function initVertexBuffer(gl) let verticesTexCoords = new Float32Array([ -0.5, 0.5, 0.0, 1.0, -0.5, -0.5, 0.0, 0.0, 0.5, 0.5, 1.0, 1.0, 0.5, -0.5, 1.0, 0.0 ]); let n = 4; let FSIZE = verticesTexCoords.BYTES_PER_ELEMENT; let vertexTexCoordBuffer = gl.createBuffer(); let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_TexCoord = gl.getAttribLocation(gl.program, a_TexCoord); gl.bindBuffer(gl.ARRAY_BUFFER, vertexTexCoordBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesTexCoords, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 4, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_TexCoord, 2, gl.FLOAT, false, FSIZE * 4, FSIZE * 2); gl.enableVertexAttribArray(a_TexCoord); return n;function initTexture(gl, n) let texture0 = gl.createTexture(); let texture1 = gl.createTexture(); let u_Sampler0 = gl.getUniformLocation(gl.program, u_Sampler0); let u_Sampler1 = gl.getUniformLocation(gl.program, u_Sampler1); let image0 = new Image(); let image1 = new Image(); image0.onload = function () loadTexture(gl, n, texture0, u_Sampler0, image0, 0); image1.onload = function () loadTexture(gl, n, texture1, u_Sampler1, image1, 1); image0.src = ../img/tobydog.jpg; image1.src = ../img/blueflower.jpg; return true;let g_texUnit0 = false;let g_texUnit1 = false;function loadTexture(gl, n, texture, u_Sampler, image, texUnit) gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1); if (texUnit === 0) gl.activeTexture(gl.TEXTURE0); g_texUnit0 = true; else gl.activeTexture(gl.TEXTURE1); g_texUnit1 = true; gl.bindTexture(gl.TEXTURE_2D, texture); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image); gl.uniform1i(u_Sampler, texUnit); gl.clear(gl.COLOR_BUFFER_BIT); if (g_texUnit0 g_texUnit1) gl.drawArrays(gl.TRIANGLE_STRIP, 0, n); GLSL ESä¸­çš„vec4çŸ¢é‡çš„åˆ†é‡ä¹˜æ³•"},{"title":"ç¨‹åºæµç¨‹æ§åˆ¶","path":"/wiki/WebGL/chapter_06_02.html","content":"åˆ†æ”¯ä¸å¾ªç¯ifå’Œif-elseè¯­å¥ float distance = 0.7;if(distance0.5) gl_FragColor = vec4(1.0,0.0,0.0,1.0);else gl_FragColor = vec4(0.0,1.0,0.0,1.0);TIP1ï¼šåˆ¤æ–­å¼ä¸­ä¸å¯ä»¥ä½¿ç”¨å¸ƒå°”å€¼ç±»å‹çŸ¢é‡ã€‚TIP2ï¼šGLSL ESä¸­æ²¡æœ‰ switchè¯­å¥ã€‚ forè¯­å¥ int sum = 0;for(int i = 0;i3;i++) sum += i; continueã€breakã€discardè¯­å¥ continuefor(int i = 0; i10; i++) if(i==8) continue; // è·³è¿‡å¾ªç¯ä½“ï¼Œå¼€å¯ä¸‹ä¸€æ®µå¾ªç¯ break for(int i = 0;i10;i++) if(i == 8) break; discardåªèƒ½åœ¨Fragment shaderä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºæ”¾å¼ƒå½“å‰ç‰‡å…ƒç›´æ¥å¤„ç†ä¸‹ä¸€ä¸ªç‰‡å…ƒã€‚ å‡½æ•°å‡½æ•°å£°æ˜ è¿”å›ç±»å‹å‡½æ•°å (type0 arg0, type1 arg1, ..., typen argn) æ‰§è¡Œè¯­å¥ return è¿”å›å€¼; å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œä¸€å®šè¦å£°æ˜å‡½æ•°æ˜¯voidç±»å‹ã€‚æ³¨æ„ï¼šGLSL ESä¸å…è®¸é€’å½’è°ƒç”¨ï¼Œè¿™æ˜¯ä¸ºäº†ä¾¿äºç¼–è¯‘å™¨å¯¹å‡½æ•°è¿›è¡Œå†…è”å±•å¼€ã€‚å°ä¾‹å­ï¼šå°†RGBAé¢œè‰²å€¼è½¬åŒ–ä¸ºäº®åº¦å€¼çš„å‡½æ•°float luma(vec4 color) //å‡½æ•°å£°æ˜ return 0.2126 * color.r + 0.7162 * color.g + 0.0722 * color.b;attribute vec4 a_Color;void main() float brightness = luma(a_Color); //å‡½æ•°è°ƒç”¨è§„èŒƒå£°æ˜å¦‚æœåœ¨å‡½æ•°å£°æ˜ä¹‹å‰å°±è¿›è¡Œè°ƒç”¨ï¼Œå¿…é¡»åœ¨è°ƒç”¨ä¹‹å‰è¿›è¡Œ è§„èŒƒå£°æ˜ã€‚ è§„èŒƒå£°æ˜çš„ç›®çš„åœ¨äºï¼šå‘Šè¯‰WebGLç³»ç»Ÿå‡½æ•°çš„å‚æ•°ã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ç­‰ç­‰ã€‚float luma(vec4); //è§„èŒƒå£°æ˜void main() vec4 a_Color = vec4(0.5,0.0,0.0,1.0); float brightness = luma(a_Color);float luma(vec4 color) return 0.2126 * color.r + 0.7162 * color.g + 0.0722 * color.b; å‚æ•°é™å®šè¯ å‚æ•°é™å®šè¯å¯ä»¥ç”¨æ¥æ§åˆ¶å‚æ•°çš„è¡Œä¸ºï¼Œå¤§ä½“ä¸ŠåŒ…æ‹¬ï¼šä¼ å…¥å‡½æ•°çš„è¦è¢«èµ‹å€¼å¹¶ä¼ å‡ºå‡½æ•°çš„è¦è¢«ä¼ å…¥ã€èµ‹å€¼ã€ä¼ å‡ºå‡½æ•°çš„inæ˜¯é»˜è®¤çš„å‚æ•°é™å®šå­—ã€‚ä½¿ç”¨å‚æ•°é™å®šè¯é‡å†™lumaå‡½æ•°void luma(in vec3 color, out float brightness) brightness = 0.2126 * color.r + 0.7162 * color.g + 0.0722 * color.b;void main() vec3 v3 = vec3(0.0,1.0,1.0); float brightness; luma(v3, brightness); å†…ç½®å‡½æ•°"},{"title":"ç‰¹æ®Šå£°æ˜","path":"/wiki/WebGL/chapter_06_03.html","content":"å…¨å±€å˜é‡ä¸å±€éƒ¨å˜é‡ å…¨å±€å˜é‡ å£°æ˜åœ¨å‡½æ•°å¤–é¢å±€éƒ¨å˜é‡ å£°æ˜åœ¨å‡½æ•°å†…éƒ¨attributeã€varyingã€uniformå˜é‡éƒ½å¿…é¡»æ˜¯å…¨å±€å˜é‡ã€‚ å­˜å‚¨é™å®šå­—constå˜é‡ constå˜é‡å£°æ˜æ—¶ å¿…é¡»è¿›è¡Œåˆå§‹åŒ–ã€‚const int lightspeed = 299792458;void main() const vec4 red = vec4(1.0,0.0,0.0,1.0); const mat4 identity = mat4(1.0);è¯•å›¾å‘constå˜é‡èµ‹å€¼ ä¼šå¯¼è‡´ç¼–è¯‘æŠ¥é”™ã€‚const int lightspeed = w299792458;lightspeed = 300000000; //error attributeå˜é‡ å£°æ˜é™åˆ¶åªèƒ½å‡ºç°åœ¨ é¡¶ç‚¹ç€è‰²å™¨ ä¸­åªèƒ½æ˜¯ å…¨å±€å˜é‡åªèƒ½æ˜¯ æµ®ç‚¹ã€çŸ¢é‡ã€çŸ©é˜µ ç±»å‹attribute vec4 a_Color; attribute float a_PointSize; uniformå˜é‡ å£°æ˜é™åˆ¶åªèƒ½æ˜¯ å…¨å±€å˜é‡åªèƒ½æ˜¯ é™¤æ•°ç»„æˆ–ç»“æ„ä½“ä¹‹å¤– çš„ä»»æ„ç±»å‹ç±»å‹ç‰¹å¾uniformå˜é‡æ˜¯ åªè¯»çš„VertexShaderå’ŒFragmentShaderå£°æ˜çš„åŒåuniformå˜é‡ï¼Œä¼šè¢«ä¸¤ä¸ªç€è‰²å™¨å…±äº«uniformå˜é‡ä¸»è¦åŒ…å«é€‚ç”¨äº æ¯ä¸ªé¡¶ç‚¹ç‰‡å…ƒ çš„æ•°æ® varyingå˜é‡ å£°æ˜é™åˆ¶åªèƒ½æ˜¯ å…¨å±€å˜é‡éœ€è¦åœ¨ä¸¤ä¸ªç€è‰²å™¨ä¸­ å£°æ˜åŒåã€åŒç±»å‹ çš„varyingå˜é‡åªèƒ½æ˜¯ æµ®ç‚¹æ•°ã€çŸ¢é‡ã€çŸ©é˜µ ç±»å‹ä¸ºä»€ä¹ˆè¦å¯¹varyingå˜é‡ç±»å‹è¿›è¡Œé™åˆ¶ï¼Ÿç­”ï¼š é¡¶ç‚¹ç€è‰²å™¨çš„varyingå€¼åœ¨ä¼ ç»™ç‰‡å…ƒç€è‰²å™¨çš„åŒååŒç±»å‹varyingå€¼æ—¶ï¼Œç»å†äº† å…‰æ …åŒ–è¿‡ç¨‹ã€‚æ ¹æ®ç»˜åˆ¶çš„å›¾å½¢ï¼Œé¡¶ç‚¹ä¸é¡¶ç‚¹ä¹‹é—´çš„ç‰‡å…ƒå±æ€§å€¼éœ€è¦é€šè¿‡å†…æ’è®¡ç®—ï¼Œå› æ­¤varyingå˜é‡çš„æ•°æ®ç±»å‹éƒ½å¿…é¡»èƒ½å¤Ÿè¿›è¡Œå†…æ’è®¡ç®—ã€‚ æ•°é‡é™åˆ¶ attributeã€uniformã€varyingçš„æ•°é‡é™åˆ¶ éƒ½ä¸è®¾å¤‡æœ‰å…³ã€‚ ç²¾åº¦é™å®šå­—æ‰€è°“ç²¾åº¦é™å®šå­—å°±æ˜¯ç”¨æ¥è¡¨ç¤ºæ¯ç§æ•°æ®å…·æœ‰çš„ç²¾åº¦ã€‚ ä¸ºä»€ä¹ˆè¦å¼•å…¥ç²¾åº¦é™å®šå­—ï¼Ÿ ç­”ï¼š å› ä¸ºéœ€è¦å¸®åŠ©ç€è‰²å™¨ç¨‹åº æé«˜è¿è¡Œæ•ˆç‡ï¼Œå‰Šå‡å†…å­˜å¼€æ”¯ã€‚é€šè¿‡ä½¿ç”¨ç²¾åº¦é™å®šå­—ï¼Œå¯ä»¥ç²¾ç»†åœ°æ§åˆ¶ç¨‹åºåœ¨æ•ˆæœå’Œæ€§èƒ½é—´çš„å¹³è¡¡ã€‚ WebGLç¨‹åºçš„ç²¾åº¦çº§åˆ« highp é«˜ç²¾åº¦mediump ä¸­ç²¾åº¦lowp ä½ç²¾åº¦WebGLåœ¨ä½ç²¾åº¦ä¸‹è¿è¡Œç»“æœä¼šæ¯”è¾ƒç²—ç³™æˆ–ä¸å‡†ç¡®ã€‚æ•°å€¼èŒƒå›´å’Œç²¾åº¦çš„æ£€æŸ¥å¯ä»¥åœ¨WebGLç¯å¢ƒä¸‹ä½¿ç”¨ gl.getShaderPrecisionFormat() æ¥æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒçš„æ•°å€¼èŒƒå›´å’Œç²¾åº¦ã€‚//WebGLShaderPrecisionFormatrangeMin: 127, rangeMax: 127, precision: 23gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT) ç²¾åº¦å£°æ˜ å£°æ˜å•ä¸ªå˜é‡çš„ç²¾åº¦mediump float size; //ä¸­ç²¾åº¦æµ®ç‚¹æ•°highp vec4 position; //é«˜ç²¾åº¦4ç»´çŸ¢é‡lowp vec4 color; //ä½ç²¾åº¦4ç»´çŸ¢é‡å£°æ˜é»˜è®¤ç²¾åº¦é»˜è®¤ç²¾åº¦æ˜¯æŒ‡ ç€è‰²å™¨çš„é»˜è®¤ç²¾åº¦ï¼Œå³ æŒ‡å®šç±»å‹ çš„å˜é‡å…¶é»˜è®¤ç²¾åº¦ç”± ç²¾åº¦é™å®šå­— æŒ‡å®šï¼Œä¹Ÿå³ ä¸ä»¥ç²¾åº¦é™å®šå­—ä¿®é¥°è¯¥ç±»å‹å˜é‡ï¼Œå…¶ç²¾åº¦å°±æ˜¯ é»˜è®¤ç²¾åº¦ã€‚å£°æ˜æ ¼å¼precision ç²¾åº¦é™å®šå­— ç±»å‹åç§°;ç€è‰²å™¨é»˜è®¤ç²¾åº¦åªæœ‰ ç‰‡å…ƒç€è‰²å™¨çš„floatç±»å‹ æ²¡æœ‰é»˜è®¤ç²¾åº¦ã€‚å…¶å®ƒæ•°æ®ç±»å‹é»˜è®¤ç²¾åº¦å¦‚ä¸‹ï¼š é¢„å¤„ç†æŒ‡ä»¤é¢„å¤„ç†æŒ‡ä»¤æ˜¯ç”¨æ¥åœ¨çœŸæ­£ç¼–è¯‘ä¹‹å‰å¯¹ä»£ç è¿›è¡Œé¢„å¤„ç†çš„ã€‚ å°ä¾‹å­ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»å®šä¹‰äº†GL_ESå®#ifdef GL_ESprecision mediump float;#endif GLSL ESä¸­å¯èƒ½ç”¨åˆ°çš„ä¸‰ç§é¢„å¤„ç†æŒ‡ä»¤ #if æ¡ä»¶è¡¨è¾¾å¼æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œ#endif#ifdef æŸå®å®šä¹‰äº†æŸå®æ—¶æ‰§è¡Œ#endif#ifndef æŸå®æ²¡æœ‰å®šä¹‰æŸå®æ—¶æ‰§è¡Œ#endifåˆ†æ”¯é¢„å¤„ç†#define NUM 100#if NUM== 100 NUM==100æ—¶æ‰§è¡Œ#else NUM!=100æ—¶æ‰§è¡Œ#endif å®å®šä¹‰ å®å®šä¹‰æ ¼å¼#define å®å å®å†…å®¹ // å®å®šä¹‰#undef å®å //è§£é™¤å®å®šä¹‰å†…ç½®å®ä½¿ç”¨å†…ç½®å®è¿›è¡Œç²¾åº¦é™åˆ¶#ifdef GL_ES#ifdef GL_FRAGMENT_PRECISION_HIGHprecision highp float; //æ”¯æŒé«˜ç²¾åº¦#elseprecision mediump float; //ä¸æ”¯æŒé«˜ç²¾åº¦#endif#endif#versionæ˜¯ç”¨äºæŒ‡å®šç€è‰²å™¨ä½¿ç”¨çš„ GLSL ESç‰ˆæœ¬çš„ã€‚ #versionæŒ‡ä»¤å¿…é¡»æ”¾åœ¨ç€è‰²å™¨çš„æœ€é¡¶éƒ¨ã€‚ä½¿ç”¨æ ¼å¼#version numberå¯ä»¥æ¥å—çš„ç‰ˆæœ¬æœ‰ï¼š 100 GLSL ES 1.00101 GLSL ES 1.01æŒ‡å®šGLSL ESç‰ˆæœ¬ä¸º1.01#version 101"},{"title":"GLSL ESè¯­æ³•","path":"/wiki/WebGL/chapter_06_01.html","content":"GLSL ESå’ŒGLSLæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ GLSL ESæ˜¯åœ¨GLSLåŸºç¡€ä¸Š åˆ é™¤å’Œç®€åŒ–ä¸€éƒ¨åˆ†åŠŸèƒ½åå½¢æˆçš„ã€‚å°½ç®¡æ˜¯åŸºäºOpenGLç€è‰²å™¨è¯­è¨€ä¸“ä¸º ç”µå­äº§å“åµŒå…¥å¼è®¾å¤‡ æ‰“é€ çš„ï¼Œä½†ç°åœ¨ GLSL ES ä¹Ÿå¼€å§‹è¢«ç”¨æ¥å®Œæˆä¸€äº›é€šç”¨ä»»åŠ¡ï¼Œå¦‚ GPGPUï¼ˆå›¾åƒå¤„ç†å’Œæ•°æ®è¿ç®—ï¼‰ã€‚ åŸºç¡€è¯­æ³•GLSL ESåŸºæœ¬æ³¨æ„ç‚¹ å¤§å°å†™æ•æ„Ÿè¯­å¥ä»¥åˆ†å·ç»“å°¾ æ‰§è¡Œæ¬¡åºï¼šä»¥å”¯ä¸€çš„mainå‡½æ•°ä¸ºå…¥å£ã€‚ æ³¨é‡Š å•è¡Œæ³¨é‡Š å¤šè¡Œæ³¨é‡Š ** æ•°æ®å€¼ç±»å‹ æ•°å€¼ç±»å‹æ•´å‹æ•°æµ®ç‚¹æ•°å¸ƒå°”å€¼ç±»å‹ GLSLå˜é‡å‘½åä¸èƒ½ä»¥gl_ã€webgl_ã€_webgl_å¼€å¤´ã€‚ GLSL ESå…³é”®å­— GLSL ESåŸºæœ¬ç±»å‹ GLSL ESç±»å‹è½¬æ¢å‡½æ•° GLSL ESè¿ç®—ç¬¦ çŸ¢é‡å’ŒçŸ©é˜µç±»å‹å£°æ˜ void main() vec3 position; //3ç»´æµ®ç‚¹çŸ¢é‡ ivec2 offset; //2ç»´æ•´å‹çŸ¢é‡ bvec4 bb; //4ç»´å¸ƒå°”çŸ¢é‡ mat4 mvpMatrix; //4ç»´æµ®ç‚¹çŸ©é˜µ èµ‹å€¼å’Œæ„é€  æ¯ç§ç±»å‹éƒ½å¯¹åº”ä¸€ç§ æ„é€ å‡½æ•°ï¼ˆconstructor functionsï¼‰ ä»¥ä¾›åˆ›å»ºå¯¹åº”ç±»å‹å˜é‡ã€‚æ„é€ å‡½æ•°çš„åç§°å’Œå…¶åˆ›å»ºå˜é‡çš„ç±»å‹åç§°æ€»æ˜¯ä¸€è‡´çš„ã€‚vec3 position = vec3(1.0,0.0,0.5);ivec2 offset = ivec2(1,2);bvec4 bb = bvec4(false,false,true,false);mat2 mvpMatrix = mat2(1.0,2.0,3.0,4.0); çŸ¢é‡æ„é€ å‡½æ•° GLSL ESæ„å»ºçŸ¢é‡çš„æ–¹å¼ç›¸å½“çµæ´»ã€‚æ ‡å‡†æ„å»ºvec3 v3 = vec3(1.0,0.3,0.5);éœ€è¦å‰”é™¤å¤šä½™å…ƒç´ çš„æ„å»ºvec3 v3 = vec3(1.0,0.3,0.5);vec2 v2 = vec2(v3); //(1.0,0.3)ä½¿ç”¨åŒä¸€å€¼å¡«å……å…¨çŸ¢é‡å…ƒç´ çš„æ„å»ºvec4 v4 = vec4(1.0); //(1.0,1.0,1.0,1.0)ä½¿ç”¨å¤šä¸ªå…¶ä»–å˜é‡ç»“æ„æ„å»ºvec3 v3 = vec3(1.0,0.3,0.5);vec2 v2 = vec2(v3); //(1.0,0.3)vec4 v4 = vec4(1.0); //(1.0,1.0,1.0,1.0)vec4 v4b = vec4(v2,v4); //(1.0,0.3,1.0,1.0)å‚æ•°æ•°é‡1ä¸”å°äºåº”ä»˜çš„å€¼æ•°ï¼ŒæŠ¥é”™vec3 v33 = vec3(1.0,0.5); //Error çŸ©é˜µæ„é€ å‡½æ•° GLSLä¸­çŸ©é˜µå…ƒç´ çš„å­˜å‚¨æ˜¯åˆ—ä¸»åºçš„ã€‚ä¼ å…¥çŸ©é˜µçš„æ¯ä¸€ä¸ªå…ƒç´ /* 1.0 5.0 9.0 13.0 2.0 6.0 10.0 14.0 3.0 7.0 11.0 15.0 4.0 8.0 12.0 16.0*/mat4 m4 = mat4( 1.0,2.0,3.0,4.0, 5.0,6.0,7.0,8.0, 9.0,10.0,11.0,12.0, 13.0,14.0,15.0,16.0);ä¼ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªçŸ¢é‡// ä½¿ç”¨2ä¸ªvec2æ„å»ºmat2å¯¹è±¡vec2 v2_1 = vec2(1.0,3.0);vec2 v2_2 = vec2(2.0,4.0);// 1.0 2.0// 3.0 4.0mat2 m2_1 = mat2(v2_1,v2_2);// ä½¿ç”¨1ä¸ªvec4æ„å»ºmat2å¯¹è±¡vec4 v4 = vec4(1.0,3.0,2.0,4.0);// 1.0 2.0// 3.0 4.0mat2 m2_2 = mat2(v4);åŒæ—¶ä¼ å…¥çŸ¢é‡å’Œæ•°å€¼// ä½¿ç”¨ä¸¤ä¸ªæµ®ç‚¹æ•°å’Œä¸€ä¸ªvec2å¯¹è±¡åˆ›å»ºmat2å¯¹è±¡vec2 v2 = vec2(2.0,4.0);// 1.0 2.0// 3.0 4.0mat2 m2 = mat2(1.0,3.0,v2);åªä¼ ä¸€ä¸ªæ•°å€¼ï¼Œç”Ÿæˆä¸€ä¸ªå¯¹è§’çº¿å…¨ä¸ºè¯¥æ•°å€¼çš„çŸ©é˜µ // 1.0 0.0// 0.0 1.0mat2 m2 = mat2(1.0);ä¼ å…¥æ•°å€¼æ•°é‡å¤§äº1ï¼Œåˆæ²¡æœ‰è¾¾åˆ°çŸ©é˜µå…ƒç´ çš„æ•°é‡ï¼Œå¯¼è‡´é”™è¯¯mat4 m4 = mat4(1.0,2.0,3.0); //Error è®¿é—®å…ƒç´  ç‚¹è¿ç®—ç¬¦ç‚¹è¿ç®—ç¬¦å¯ä»¥è®¿é—®çš„åˆ†é‡**TIP1ï¼š**è¿™äº›å¯ä»¥é€šè¿‡åç§°è®¿é—®çš„åˆ†é‡äº‹å®ä¸Šè¿˜æ˜¯é€šè¿‡å‚æ•°é¡ºåºè·å–çš„ã€‚**TIP2ï¼š**è¿™äº›åˆ†é‡åªæ˜¯ç´¢å¼•çš„è®¿é—®çš„è¯­æ³•ç³–ï¼Œå› æ­¤å¯ä»¥éšæ„äº¤å ä½¿ç”¨ã€‚**TIP3ï¼š**è®¿é—®è¶…è¿‡çŸ¢é‡é•¿åº¦çš„åˆ†é‡ä¼šå‡ºé”™ã€‚vec3 v3 = vec3(1.0,2.0,3.0);float f;f = v3.x; //1.0f = v3.g; //2.0f = v3.p; //3.0f = v3.w; //Error:è®¿é—®äº†è¶…å‡ºçŸ¢é‡é•¿åº¦çš„åˆ†é‡æ··åˆï¼ˆswizzlingï¼‰æ··åˆæ˜¯æŒ‡å°†å¤šä¸ªåˆ†é‡åå…±åŒç½®äºç‚¹è¿ç®—ç¬¦åï¼Œå¯ä»¥åŒæ—¶ä»çŸ¢é‡ä¸­æŠ½å–å‡ºå¤šä¸ªåˆ†é‡ã€‚ vec3 v3 = vec3(1.0,2.0,3.0);vec2 v2;v2 = v3.xy; // (1.0,2,0)v2 = v3.tp; // (2.0,3.0)v2 - v3.gg; // (2.0,2.0)èšåˆåˆ†é‡åå¯ä½œä¸ºèµ‹å€¼è¡¨è¾¾å¼çš„å·¦å€¼vec3 v3 = vec3(1.0,2.0,3.0);vec2 v2;v2.xy = v3.gb;v2.s = v3.x;æ··åˆçš„åˆ†é‡åå¿…é¡»å±äºåŒä¸€ä¸ªåˆ†é‡é›†åˆvec3 v3 = vec3(1.0,2.0,3.0);vec2 v2;v2.xy = v3.ry; //Error[]è¿ç®—ç¬¦çŸ©é˜µå…ƒç´ è¯»å–ä»ç„¶æŒ‰ç…§åˆ—ä¸»åºã€‚mat4 m4 = mat4( 1.0,2.0,3.0,4.0, 5.0,6.0,7.0,8.0, 9.0,10.0,11.0,12.0, 13.0,14.0,15.0,16.0);vec4 v4 = m4[0]; //[1.0,2.0,3.0,4.0]ä½¿ç”¨ä¸¤ä¸ª[]è®¿é—®å…·ä½“å…ƒç´ mat4 m4 = mat4( 1.0,2.0,3.0,4.0, 5.0,6.0,7.0,8.0, 9.0,10.0,11.0,12.0, 13.0,14.0,15.0,16.0);float m24 = m4[1][3]; //8.0ä½¿ç”¨[]å’Œåˆ†é‡åè®¿é—®å…·ä½“å…ƒç´ float m12 = m4[0].g; // 2.0[]ä¸­ç´¢å¼•å€¼åªèƒ½æ˜¯å¸¸é‡ç´¢å¼•å€¼å¸¸é‡ç´¢å¼•å€¼åŒ…æ‹¬ï¼šæ•´å‹å­—é¢é‡constå£°æ˜çš„å€¼å¾ªç¯ç´¢å¼•å¸¸é‡è¡¨è¾¾å¼ è¿ç®—ç¬¦ çŸ¢é‡å’ŒçŸ©é˜µçš„æ¯”è¾ƒè¿ç®—ç¬¦åªé™äºå’Œ!ï¼Œä¸ç­‰å¤§å°çš„æ¯”è¾ƒéœ€è¦é€šè¿‡å†…ç½®å‡½æ•°ã€‚çŸ¢é‡å’Œæµ®ç‚¹æ•°çš„è¿ç®— ç›¸åŠ è¿ç®—v3b = v3a + f; è¿ç®—ç»“æœv3b.x = v3a.x + f;v3b.y = v3a.y + f;v3b.z = v3a.z + f; çŸ¢é‡è¿ç®— çŸ¢é‡çš„æ¯ä¸ªåˆ†é‡éƒ½å‚ä¸è¿ç®—v3c = v3a + v3b; è¿ç®—ç»“æœv3c.x = v3a.x + v3b.x;v3c.y = v3a.y + v3b.y;v3c.z = v3a.z + v3b.z; çŸ©é˜µå’Œæµ®ç‚¹æ•°è¿ç®— çŸ©é˜µçš„æ¯ä¸ªåˆ†é‡éƒ½å‚ä¸æµ®ç‚¹æ•°è¿ç®—m3b = m3a * f; è¿ç®—ç»“æœm3b[0].x = m3a[0].x * f;m3b[0].y = m3a[0].y * f;m3b[0].z = m3a[0].z * f;/////////////////////////m3b[1].x = m3a[1].x * f;m3b[1].y = m3a[1].y * f;m3b[1].z = m3a[1].z * f;/////////////////////////m3b[2].x = m3a[2].x * f;m3b[2].y = m3a[2].y * f;m3b[2].z = m3a[2].z * f; çŸ©é˜µå³ä¹˜çŸ¢é‡ ç»“æœä¸ºçŸ¢é‡v3b = m3a * v3a; è¿ç®—ç»“æœv3b.x = m3a[0].x * v3a.x + m3a[1].x * v3a.y + m3a[2].x + v3a.z;v3b.y = m3a[0].y * v3a.y + m3a[1].y * v3a.y + m3a[2].y + v3a.z;v3b.z = m3a[0].z * v3a.x + m3a[1].z * v3a.y + m3a[2].z + v3a.z; çŸ©é˜µå·¦ä¹˜çŸ¢é‡ å·¦ä¹˜ç»“æœä¸å³ä¹˜ä¸åŒv3b = v3a * m3a; è¿ç®—ç»“æœv3b.x = v3a.x * m3a[0].x + v3a.y * m3a[0].y + v3a.z * m3a[0].z; v3b.y = v3a.x * m3a[1].x + v3a.y * m3a[1].y + v3a.z * m3a[1].z; v3b.z = v3a.x * m3a[2].x + v3a.y * m3a[2].y + v3a.z * m3a[2].z; çŸ©é˜µç›¸ä¹˜ m3c = m3a * m3b; è¿ç®—ç»“æœm3c[0].x = m3a[0].x * m3b[0].x + m3a[1].x * m3b[0].y + m3a[2].x * m3b[0].z;m3c[0].y = m3a[0].y * m3b[0].x + m3a[1].y * m3b[0].y + m3a[2].y * m3b[0].z;m3c[0].z = m3a[0].z * m3b[0].x + m3a[1].z * m3b[0].y + m3a[2].z * m3b[0].z;////////////////m3c[1].x = m3a[0].x * m3b[1].x + m3a[1].x * m3b[1].y + m3a[2].x * m3b[1].z;m3c[1].y = m3a[0].y * m3b[1].x + m3a[1].y * m3b[1].y + m3a[2].y * m3b[1].z;m3c[1].z = m3a[0].z * m3b[1].x + m3a[1].z * m3b[1].y + m3a[2].z * m3b[1].z;////////////////m3c[2].x = m3a[0].x * m3b[2].x + m3a[1].x * m3b[2].y + m3a[2].x * m3b[2].z;m3c[2].y = m3a[0].y * m3b[2].x + m3a[1].y * m3b[2].y + m3a[2].y * m3b[2].z;m3c[2].z = m3a[0].z * m3b[2].x + m3a[1].z * m3b[2].y + m3a[2].z * m3b[2].z; ç»“æ„ä½“ç»“æ„ä½“ï¼ˆstructï¼‰ æ³¨æ„ï¼šç»“æ„ä½“æˆå‘˜ä¸èƒ½åŒ…å«æ•°ç»„ã€‚ // å®šä¹‰ç»“æ„ä½“ç±»å‹struct light vec4 color; vec3 position;;light light1,light2;å¯ä»¥åœ¨å®šä¹‰ç»“æ„ä½“çš„åŒæ—¶å£°æ˜è¯¥ç±»å‹çš„å˜é‡ã€‚struct light vec4 color; vec3 position; light1; ç»“æ„ä½“æ„é€  ç»“æ„ä½“æ„é€ å‡½æ•°çš„åç§°ä¸ç»“æ„ä½“åç§° ä¸€è‡´ã€‚å‚æ•°é¡ºåºå¿…é¡»ä¸ç»“æ„ä½“ä¸­å®šä¹‰çš„æˆå‘˜é¡ºåº ä¸€è‡´ã€‚ // å®šä¹‰ç»“æ„ä½“ç±»å‹struct light vec4 color; vec3 position;;light l1 = light( vec4(0.0,1.0,0.0,1.0), //color vec3(8.0,3.0,0.0) //position); ç»“æ„ä½“æˆå‘˜çš„è®¿é—® ç»“æ„ä½“å¯¹è±¡.æˆå‘˜åç§°struct light vec4 color; vec3 position;;light l1 = light( vec4(0.0,1.0,0.0,1.0), //color vec3(8.0,3.0,0.0) //position);vec4 color = l1.color; //(0.0,1.0,0.0,1.0)vec3 position = l1.position; //(8.0,3.0,0.0) ç»“æ„ä½“è¿ç®—ç¬¦ ç»“æ„ä½“ç›¸ç­‰çš„æ¡ä»¶æ˜¯æ‰€æœ‰æˆå‘˜éƒ½ç›¸ç­‰ã€‚ æ•°ç»„GLSL ESä¸­æ•°ç»„çš„æ³¨æ„ç‚¹ åªæ”¯æŒ ä¸€ç»´æ•°ç»„æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ å¤§äº0çš„æ•´å‹å¸¸é‡è¡¨è¾¾å¼ï¼ˆintegral constant expressionï¼‰ç´¢å¼•å€¼ ä»0å¼€å§‹ç´¢å¼•å€¼åªèƒ½æ˜¯ æ•´å‹å¸¸é‡è¡¨è¾¾å¼ æˆ– uniformå˜é‡æ•°ç»„ä¸èƒ½åœ¨å£°æ˜æ—¶ è¢«ä¸€æ¬¡æ€§çš„åˆå§‹åŒ–ï¼Œå¿…é¡»æ˜¾å¼ å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œåˆå§‹åŒ–æ•°ç»„å…ƒç´ å¯ä»¥å‚ä¸å…¶è‡ªèº«ç±»å‹æ”¯æŒçš„ä»»æ„è¿ç®— æ•°ç»„çš„å£°æ˜float floatArray[4];vec3 vec3Array[2];æ•°ç»„é•¿åº¦å¿…é¡»æ˜¯å¤§äº0çš„æ•´å‹å¸¸é‡è¡¨è¾¾å¼int size = 4;vec4 vec4Array[size]; //errorä½¿ç”¨ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ int intArray[4];intArray[0] = 1;intArray[1] = 2;intArray[2] = 3;intArray[3] = 4;int num = intArray[1]; //2å¿…é¡»æ˜¾å¼å¯¹æ•°ç»„æ¯ä¸ªå…ƒç´ è¿›è¡Œåˆå§‹åŒ–vec4 vec4Array[4];vec4Array[2] = vec4(0.0,0.0,0.0,1.0);vec4Array[1] = vec4(1.0,0.0,0.0,1.0);æ•°ç»„çš„è¿ç®—float floatArray[4];floatArray[1] = 1.0;float f = floatArray[1] * 3.14; //3.14vec2 vec2Array[3];vec2Array[0] = vec2(0.5,0.9);vec2 v2 = floatArray[1] * vec2Array[0]; //(0.5,0.9) å–æ ·å™¨ï¼ˆsamplerï¼‰å–æ ·å™¨ç±»å‹ sampler2DsamplerCube å–æ ·å™¨å˜é‡ åªèƒ½æ˜¯ uniform å˜é‡ã€‚uniform sampler2D u_Sampler;samplerå”¯ä¸€èƒ½å¤Ÿæ¥æ”¶çš„å˜é‡å°±æ˜¯ çº¹ç†å•å…ƒç¼–å·ï¼Œå¿…é¡»ä½¿ç”¨ gl.uniform1i() å°†çº¹ç†å•å…ƒç¼–å·ä»WebGLä¼ å…¥ shader ä¸­ã€‚ gl.uniform1i(u_Sampler,0);samplerå˜é‡åªèƒ½è¿›è¡Œèµ‹å€¼ï¼ˆï¼‰ã€ç›¸ç­‰ï¼ˆï¼‰ã€ä¸ç­‰ï¼ˆ!ï¼‰æ“ä½œã€‚samplerç±»å‹å†…ç½®æœ€å°æ•°é‡ è¿ç®—ç¬¦ä¼˜å…ˆçº§"},{"title":"è¿›å…¥ä¸‰ç»´ä¸–ç•Œ","path":"/wiki/WebGL/chapter_07_01.html","content":"ä¸‰ç»´ä¸–ç•Œçš„è§‚å¯Ÿè€…ç«‹æ–¹ä½“æ˜¯ç”±ä¸‰è§’å½¢æ„æˆçš„ 12ä¸ªä¸‰è§’å½¢ç»„æˆçš„ç«‹æ–¹ä½“åœ¨ç»˜åˆ¶ä¸‰ç»´ç‰©ä½“æ—¶ï¼Œéœ€è¦è€ƒè™‘ç‰©ä½“çš„ æ·±åº¦ä¿¡æ¯ï¼ˆdepth informationï¼‰ä¸‰ç»´ä¸–ç•Œçš„è§‚å¯Ÿè€…å¦‚ä½•å®šä¹‰ä¸‰ç»´ä¸–ç•Œçš„è§‚å¯Ÿè€…ï¼Ÿéœ€è¦å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼šä»–åœ¨å“ªä»–æœå“ªçœ‹ä»–è§†é‡æœ‰å¤šå®½ä»–èƒ½çœ‹å¤šè¿œ è§†ç‚¹å’Œè§†çº¿ ä¸ºäº†å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œéœ€è¦è€ƒè™‘2ç‚¹ï¼šè§‚å¯Ÿæ–¹å‘å¯è§†è·ç¦»å¦‚ä½•æè¿°è§‚å¯Ÿè€…çš„å±æ€§ï¼Ÿè§†ç‚¹ï¼ˆeye pointï¼‰ è§‚å¯Ÿè€…çš„ä½ç½®è§†çº¿ï¼ˆviewing directionï¼‰ è§‚å¯Ÿè€…æ²¿è§‚å¯Ÿæ–¹å‘çš„å°„çº¿ 3é¡¹ä¿¡æ¯å¯ä»¥ç¡®å®šè§‚å¯Ÿè€…çŠ¶æ€ï¼š ä¸‰é¡¹ä¿¡æ¯ç¡®å®šè§‚å¯Ÿè€…çŠ¶æ€è§†ç‚¹ï¼ˆeye pointï¼‰å³è§‚å¯Ÿè€…åœ¨ ä¸‰ç»´ç©ºé—´ä¸­çš„ä½ç½®ï¼Œä¹Ÿå³ è§†çº¿çš„èµ·ç‚¹ ã€‚ä¸€èˆ¬ä½¿ç”¨ ( eyeX, eyeY, eyeZ)è¡¨ç¤ºè§‚å¯Ÿç›®æ ‡ç‚¹ï¼ˆlook-at pointï¼‰å³ è¢«è§‚å¯Ÿç›®æ ‡æ‰€åœ¨çš„ç‚¹ï¼Œå¯ä»¥ç”¨æ¥ç¡®å®šè§†çº¿ï¼Œä¸€èˆ¬ä½¿ç”¨ ( atX, atY, atZ)è¡¨ç¤ºåŒæ—¶çŸ¥é“è§‚å¯Ÿç›®æ ‡ç‚¹å’Œè§†ç‚¹å°±èƒ½è®¡ç®—å‡ºè§†çº¿æ–¹å‘ã€‚ä¸Šæ–¹å‘ï¼ˆup directionï¼‰æœ€ç»ˆç»˜åˆ¶åœ¨å±å¹•ä¸Šçš„ å½±åƒä¸­çš„å‘ä¸Šçš„æ–¹å‘ã€‚ä¸€èˆ¬ä½¿ç”¨ 3ç»´çŸ¢é‡( upX, upY, upZ)è¡¨ç¤ºä¸ºä»€ä¹ˆä¸€å®šè¦æŒ‡å®šä¸Šæ–¹å‘ï¼Ÿç­”ï¼š åŒºåˆ†å‡ºè§‚å¯Ÿè€…ä»¥è§†çº¿ä¸ºè½´æ—‹è½¬çš„çŠ¶æ€ï¼ˆæƒ³æƒ³ä½ æ­ªå¤´çœ‹ä¸œè¥¿çš„æ—¶å€™ï¼‰ è§†å›¾çŸ©é˜µï¼ˆview matrixï¼‰ è§†å›¾çŸ©é˜µæ˜¯åšä»€ä¹ˆçš„ï¼Ÿç­”ï¼š ç”¨æ¥è¡¨ç¤ºè§‚å¯Ÿè€…çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è§†ç‚¹ã€è§‚å¯Ÿç›®æ ‡ç‚¹ã€ä¸Šæ–¹å‘ç­‰ä¿¡æ¯ã€‚ è§†å›¾çŸ©é˜µçš„ä½¿ç”¨ä½ç½®ï¼Ÿç­”ï¼š åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨ã€‚ ä¸ºä»€ä¹ˆè¦å«è§†å›¾çŸ©é˜µï¼Ÿç­”ï¼š å› ä¸ºå®ƒæœ€ç»ˆå½±å“çš„æ˜¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„è§†å›¾ã€‚ Matrix4.setLookAt()çŸ©é˜µå·¥å…·åº“ cuon-matrix.js å¼•å…¥çš„ Matrix4 ç±»å‹æä¾›äº†åˆ›å»ºè§†å›¾çŸ©é˜µçš„æ–¹æ³•ï¼š WebGLä¸­è§‚å¯Ÿè€…çš„é»˜è®¤çŠ¶æ€ è§†ç‚¹ï¼š (0,0,0)è§‚å¯Ÿç‚¹ï¼š (0,0,-1)è§†çº¿ï¼š Zè½´è´Ÿæ–¹å‘ä¸Šæ–¹å‘ï¼š Yè½´è´Ÿæ–¹å‘ï¼Œå³(0,1,0)åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºé»˜è®¤çŠ¶æ€çš„çŸ©é˜µvar initialViewMatrix = new Matrix4();initialViewMatrix.setLookAt( 0,0,0, //è§†ç‚¹ 0,0,-1, //ç›®æ ‡è§‚å¯Ÿç‚¹ 0,1,0 //ä¸Šæ–¹å‘) LookAtTrianglesLookAtTriangles Code LookAtTrianglesè¿è¡Œç»“æœLookAtTriangles.htmlLookAtTriangles.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./LookArTriangles.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_ViewMatrix; varying vec4 v_Color; void main() gl_Position = u_ViewMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(ç€è‰²å™¨åˆå§‹åŒ–å¤±è´¥); return; let n = initVertexBuffer(gl); // è·å–u_ViewMatrix let u_ViewMatrix = gl.getUniformLocation(gl.program, u_ViewMatrix); // è®¾ç½®è§†ç‚¹ã€è§†çº¿ã€ä¸Šæ–¹å‘ let viewMatrix = new Matrix4(); viewMatrix.setLookAt(0.20, 0.25, 0.25, 0, 0, 0, 0, 1, 0); // å°†è§†å›¾çŸ©é˜µä¼ å…¥é¡¶ç‚¹ç€è‰²å™¨ gl.uniformMatrix4fv(u_ViewMatrix, false, viewMatrix.elements); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffer(gl) let verticesColors = new Float32Array([ // ç»¿è‰²ä¸‰è§’å½¢ 0.0, 0.5, -0.4, 0.4, 1.0, 0.4, -0.5, -0.5, -0.4, 0.4, 1.0, 0.4, 0.5, -0.5, -0.4, 1.0, 0.4, 0.4, // é»„è‰²ä¸‰è§’å½¢ 0.5, 0.4, -0.2, 1.0, 0.4, 0.4, -0.5, 0.4, -0.2, 1.0, 1.0, 0.4, 0.0, -0.6, -0.2, 1.0, 1.0, 0.4, // è“è‰²ä¸‰è§’å½¢ 0.0, 0.5, 0.0, 0.4, 0.4, 1.0, -0.5, -0.5, 0.0, 0.4, 0.4, 1.0, 0.5, -0.5, 0.0, 1.0, 0.4, 0.4 ]); let n = 9; let FSIZE = verticesColors.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, FSIZE * 6, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, FSIZE * 6, FSIZE * 3); gl.enableVertexAttribArray(a_Color); return n; æ¯”è¾ƒå˜æ¢çŸ©é˜µä¸è§†å›¾çŸ©é˜µ å˜æ¢çŸ©é˜µï¼ˆä»¥æ—‹è½¬çŸ©é˜µä¸ºä¾‹ï¼‰ç€è‰²å™¨ç¨‹åºattribute vec4 a_Position;attribute vec4 a_Color;varying vec4 v_Color;uniform mat4 u_rotMatrix;void main() gl_Position = u_rotMatrix * a_Position; v_Color = a_Color;å˜æ¢çŸ©é˜µçš„è®¡ç®—ä¸ä¼ å…¥let u_rotMatrix = gl.getUniformLocation(gl.program, u_rotMatrix);let rotMatrix = new Matrix4();rotMatrix.setRotate(90, 0, 0, 1); //ç»•zè½´æ—‹è½¬90Â°gl.uniformMatrix4fv(u_rotMatrix, false, rotMatrix.elements); è§†å›¾çŸ©é˜µç€è‰²å™¨ç¨‹åºattribute vec4 a_Position;attribute vec4 a_Color;uniform mat4 u_ViewMatrix;varying vec4 v_Color;void main() gl_Position = u_ViewMatrix * a_Position; v_Color = a_Color;è§†å›¾çŸ©é˜µçš„è®¡ç®—ä¸ä¼ å…¥let u_ViewMatrix = gl.getUniformLocation(gl.program, u_ViewMatrix);let viewMatrix = new Matrix4();viewMatrix.setLookAt( 0.2, 0.25, 0.25, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0);gl.uniformMatrix4fv(u_ViewMatrix, false, viewMatrix.elements); æ”¹å˜è§‚å¯Ÿè€…çš„çŠ¶æ€ ä¸ å¯¹æ•´ä¸ªä¸–ç•Œè¿›è¡Œå¹³ç§»å’Œæ—‹è½¬å˜æ¢ï¼Œè¿™äºŒè€…æœ¬è´¨ä¸Šæ˜¯ ä¸€æ · çš„ã€‚ LookAtRotatedTrianglesä»æŒ‡å®šè§†è§’è§‚å¯Ÿæ—‹è½¬åçš„ä¸‰è§’å½¢ è¿™ä¸ªæ¡ˆä¾‹çš„å…³é”®é—®é¢˜åœ¨äºï¼šæ€ä¹ˆç¡®å®šæ—‹è½¬çŸ©é˜µä¸è§†å›¾çŸ©é˜µçš„ä½¿ç”¨é¡ºåºã€‚ç­”ï¼š å…ˆæ—‹è½¬å›¾å½¢ï¼Œå†ç§»åŠ¨è§†è§’ã€‚ä¸‹å¼å±•ç¤ºçš„æ˜¯ è§‚å¯Ÿå˜æ¢å›¾å½¢çš„çŸ©é˜µè®¡ç®—å¼ ï¼šresultMatrix = è§†å›¾çŸ©é˜µ * æ¨¡å‹çŸ©é˜µ * åŸå§‹é¡¶ç‚¹åæ ‡ LookAtRotatedTriangles Code LookAtRotatedTrianglesè¿è¡Œç»“æœLookAtRotatedTriangles.htmlLookAtRotatedTriangles.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./LookAtRotatedTriangles.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; varying vec4 v_Color; uniform mat4 u_ModelMatrix; uniform mat4 u_ViewMatrix; void main() gl_Position = u_ViewMatrix * u_ModelMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(failed to get context); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); if (n 0) console.log(failed to init vertex buffer); return; let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); let u_ViewMatrix = gl.getUniformLocation(gl.program, u_ViewMatrix); if (!(u_ModelMatrix u_ViewMatrix)) console.log(failed to get uniform variable); return; let modelMatrix = new Matrix4(); let viewMatrix = new Matrix4(); modelMatrix.setRotate(-10, 0, 0, 1); viewMatrix.setLookAt( 0.2, 0.25,0.25, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_ViewMatrix, false, viewMatrix.elements); gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffers(gl) let verticesColors = new Float32Array([ // çº¢è‰²ä¸‰è§’å½¢ æœ€ä¸‹å±‚ 0.0, 0.5, -0.4, 1.0, 0.4, 0.4, -0.5, -0.5, -0.4, 1.0, 0.3, 0.5, 0.5, -0.5, -0.4, 1.0, 1.0, 0.3, // ç»¿è‰²ä¸‰è§’å½¢ ä¸­é—´å±‚ 0.0, -0.6, -0.2, 0.4, 1.0, 0.4, -0.5, 0.5, -0.2, 0.3, 1.0, 0.5, 0.5, 0.5, -0.2, 1.0, 1.0, 0.3, // è“è‰²ä¸‰è§’å½¢ æœ€ä¸Šå±‚ 0.0, 0.5, 0.0, 0.4, 0.4, 1.0, -0.5, -0.5, 0.0, 0.3, 0.5, 1.0, 0.5, -0.5, 0.0, 0.5, 1.0, 1.0 ]); let n = 9; let FSIZE = verticesColors.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, FSIZE * 6, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, FSIZE * 6, FSIZE * 3); gl.enableVertexAttribArray(a_Color); return n; æ¨¡å‹è§†å›¾çŸ©é˜µæ¨¡å‹è§†å›¾çŸ©é˜µï¼ˆmodel view matrixï¼‰ LookAtRotatedTriangleä¸ºä»€ä¹ˆéœ€è¦æ”¹è¿›ï¼Ÿgl_Position = u_ViewMatrix * u_ModelMatrix * a_Position; å¯¹äºæ¯ä¸€ä¸ªé¡¶ç‚¹ï¼ŒVertex_Shaderéƒ½éœ€è¦é‡å¤åšä¸€éçŸ©é˜µç›¸ä¹˜è®¡ç®—ã€‚è¿™æ˜¾ç„¶ä¼šé€ æˆä¸å¿…è¦çš„å¼€é”€ï¼Œæœ€å¥½æŠŠè¿™ä¸€æ­¥æåˆ°Jsä¸­ã€‚ æ¨¡å‹è§†å›¾çŸ©é˜µ è§†å›¾çŸ©é˜µ * æ¨¡å‹çŸ©é˜µgl_Position æ¨¡å‹è§†å›¾çŸ©é˜µ * é¡¶ç‚¹åæ ‡ LookAtRotatedTriangle_mvMatrix Code Tip1ï¼šmultiplyæ–¹æ³•è¿›è¡ŒçŸ©é˜µç›¸ä¹˜çš„é¡ºåº mA.multiply(mB) mB * mA Tip2ï¼šjséƒ¨åˆ†è¿˜å¯ä»¥æ›´åŠ ç®€åŒ–let u_mvMatrix = gl.getUniformLocation(gl.program, u_ModelViewMatrix);let mvMatrix = new Matrix4();mvMatrix.setLookAt(0.20, 0.25, 0.25, 0, 0, 0, 0, 1, 0).rotate(-10,0,0,1);gl.uniformMatrix4fv(u_mvMatrix, false, mvMatrix.elements);Vertex_ShaderLookAtRotatedTriangle_mvMatrix.jsattribute vec4 a_Position;attribute vec4 a_Color;varying vec4 v_Color;uniform mat4 u_ModelViewMatrix;void main() gl_Position = u_ModelViewMatrix * a_Position; v_Color = a_Color;let u_mvMatrix = gl.getUniformLocation(gl.program, u_ModelViewMatrix);let modelMatrix = new Matrix4();let viewMatrix = new Matrix4();modelMatrix.setRotate(-10, 0, 0, 1);viewMatrix.setLookAt( 0.2, 0.25,0.25, 0, 0, 0, 0, 1, 0);let mvMatrix = viewMatrix.multiply(modelMatrix);gl.uniformMatrix4fv(u_mvMatrix, false, mvMatrix.elements); åˆ©ç”¨é”®ç›˜æ”¹å˜è§†ç‚¹LookAtTrianglesWithKeys Code LookAtTrianglesWithKeysè¿è¡Œç»“æœLookAtTrianglesWithKeys.htmlLookAtTrianglesWithKeys.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./LookAtTrianglesWithKeys.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_mvMatrix; varying vec4 v_Color; void main() gl_Position = u_mvMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!gl) console.log(failed to get context); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); if (n 0) console.log(failed to init vertex buffers); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); let u_mvMatrix = gl.getUniformLocation(gl.program, u_mvMatrix); let mvMatrix = new Matrix4(); document.onkeydown = function (ev) keydown(ev,gl,n,u_mvMatrix,mvMatrix); draw(gl, n, u_mvMatrix, mvMatrix);let g_eye = [0.2, 0.25, 0.25];function keydown(ev, gl, n, u_mvMatrix, mvMatrix) switch (ev.keyCode) case 39: g_eye[0] += 0.01; break; //å³é”® case 38: g_eye[2] += 0.01; break; //ä¸Šé”® case 37: g_eye[0] -= 0.01; break; //å·¦é”® case 40: g_eye[2] -= 0.01; break; //ä¸‹é”® default: break; draw(gl, n, u_mvMatrix, mvMatrix);function draw(gl, n, u_mvMatrix, mvMatrix) mvMatrix.setLookAt( ...g_eye, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_mvMatrix, false, mvMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffers(gl) let verticesColor = new Float32Array([ 0.0, 0.5, -0.4, 1.0, 0.4, 0.4, -0.5, -0.5, -0.4, 1.0, 0.4, 0.4, 0.5, -0.5, -0.4, 0.0, 0.4, 0.4, -0.4, 0.4, -0.2, 0.4, 1.0, 0.4, 0.4, 0.4, -0.2, 0.4, 1.0, 0.4, 0.0, -0.6, -0.2, 0.4, 0.0, 0.4, 0.0, 0.5, 0.0, 0.4, 0.4, 1.0, -0.5, -0.5, -0.0, 0.4, 0.4, 1.0, 0.5, -0.5, -0.0, 0.4, 0.4, 0.0 ]); let n = 9; let FSIZE = verticesColor.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColor, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, 6 * FSIZE, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 6 * FSIZE, 3*FSIZE); gl.enableVertexAttribArray(a_Color); return n;"},{"title":"å¯è§†èŒƒå›´","path":"/wiki/WebGL/chapter_07_02.html","content":"å¯è§†èŒƒå›´ï¼ˆvisible rangeï¼‰ åœ¨ LookAtTrianglesWithKeys ç¨‹åºä¸­ï¼Œä¸‰è§’å½¢çš„ä¸€è§’è¢«æ®‹å¿åœ°å’¬æ‰äº†ã€‚ä¸‰è§’å½¢ç•Œçš„çµå¼‚ç…§ç‰‡è¿™æ˜¯å› ä¸ºæ²¡æœ‰è®¾ç½® å¯è§†èŒƒå›´ï¼ŒWebGLåªæ˜¾ç¤ºå¯è§†èŒƒå›´å†…çš„åŒºåŸŸã€‚ å¯è§†èŒƒå›´ï¼ˆæ­£å°„ç±»å‹ï¼‰ä¸ç»˜åˆ¶å¯è§†èŒƒå›´å¤–çš„å¯¹è±¡ï¼Œæ˜¯åŸºæœ¬çš„é™ä½ç¨‹åºå¼€é”€çš„æ‰‹æ®µã€‚ ä¸ºä»€ä¹ˆè¦è®¾ç½®å¯è§†èŒƒå›´ï¼Ÿ å› ä¸ºå¤§å‹ç½‘æ¸¸earth Onlineæœ€åˆå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼ˆå¤§é›¾ï¼‰ï¼earth Onlineè®¾è®¡è€…è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œç»™äº†ä½ è§†çº¿èŒƒå›´ï¼Œè¦ä¸è®©ä½ éšä¾¿æœå¤©ä¸Šæ‰«ä¸€çœ¼ï¼Œå°±èƒ½çœ‹åˆ°æœˆçƒä¸Šè·³èˆçš„å°äººå—ï¼Ÿ å¿ƒå¤–æ— ç‰©ï¼Œå¿ƒå¤–æ— äº‹ï¼Œå¿ƒå¤–æ— ç† è™½ç„¶earth Onlineä¸­çš„å“²å­¦åˆ†æ”¯å¯è°“å¤æ‚çº·çº­ï¼Œä½†æ˜¯è¦ç†è§£WebGLä¸–ç•Œä¸­çš„å¯è§†è·ç¦»æœºåˆ¶ï¼Œä¸»è§‚å”¯å¿ƒä¸»ä¹‰è§‚ç‚¹å¯èƒ½ä¼šå¯¹ä½ æœ‰æ‰€å¯å‘ï¼šå­˜åœ¨å³è¢«æ„ŸçŸ¥ â€”â€”ã€è‹±ã€‘è´å…‹è± äººç±»æœ¬èº«ä¹Ÿåªèƒ½çœ‹åˆ°çœ¼å‰çš„ä¸œè¥¿ï¼Œæ°´å¹³è§†è§’å¤§çº¦200åº¦å·¦å³ã€‚ å¯è§†ç©ºé—´ï¼ˆview volumeï¼‰ æœ‰ä¸¤ç±»å¸¸ç”¨çš„å¯è§†ç©ºé—´ï¼š æ­£å°„æŠ•å½±orthographic projection é•¿æ–¹å½¢å¯è§†ï¼ˆç›’çŠ¶ï¼‰ç©ºé—´ç‰©ä½“çœ‹ä¸Šå»å¤§å°ä¸å…¶æ‰€åœ¨ä½ç½®æ²¡æœ‰å…³ç³»å¯ä»¥æ–¹ä¾¿åœ°æ¯”è¾ƒåœºæ™¯ä¸­ç‰©ä½“å¤§å°å¸¸ç”¨äºå¹³é¢ç»˜å›¾ç­‰æŠ€æœ¯ é€è§†æŠ•å½±perspective projectionå››æ£±é”¥ï¼ˆé‡‘å­—å¡”ï¼‰å¯è§†ç©ºé—´ä½¿ä¸‰ç»´åœºæ™¯çœ‹ä¸Šå»æ›´æœ‰æ·±åº¦æ„Ÿï¼Œæ›´è‡ªç„¶çœŸå®ä¸–ç•Œä¹Ÿæ˜¯é€è§†æŠ•å½± ç›’çŠ¶å¯è§†ç©ºé—´ è¿‘è£å‰ªé¢ ä¸ è¿œè£å‰ªé¢ ä¹‹é—´çš„ç©ºé—´å°±æ˜¯ ç›’çŠ¶å¯è§†ç©ºé—´ã€‚åªæœ‰åœ¨æ­¤ç©ºé—´å†…çš„ç‰©ä½“ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ å¦‚æœè£å‰ªé¢å’Œcanvasç”»å¸ƒçš„å®½é«˜æ¯”ä¸åŒä¼šæ€ä¹ˆæ ·ï¼Ÿç­”ï¼š ä¼šæŒ‰ç…§canvasçš„å®½é«˜å¯¹ç”»é¢è¿›è¡Œå‹ç¼©ï¼Œç‰©ä½“ä¼šè¢«æ‰­æ›²ã€‚ å®šä¹‰ç›’çŠ¶å¯è§†ç©ºé—´ Matrix4.setOrtho() è®¾ç½®æŠ•å½±çš„çŸ©é˜µè¢«ç§°ä¸º æ­£å°„æŠ•å½±çŸ©é˜µï¼ˆorthographic projection matrixï¼‰ã€‚ OrthoViewè¯¥æ¡ˆä¾‹æ”¯æŒé”®ç›˜æ§åˆ¶å¯è§†ç©ºé—´æ·±åº¦å¤§å°ã€‚ OrthoView Code åè½¬è§†ç‚¹è§‚å¯ŸOrthoViewè¿è¡Œæ•ˆæœè§‚å¯Ÿä¸‰è§’å½¢æ¶ˆå¤±é¡ºåºä¸ç›’ç©ºé—´åšåº¦çš„å…³ç³»OrthoView.htmlOrthoView.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./OrthoView.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas p id=nearFar/p/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_ProjMatrix; varying vec4 v_Color; void main() gl_Position = u_ProjMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let nf = document.getElementById(nearFar); let gl = getWebGLContext(canvas); if (!gl) console.log(failed to get context); return; if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); if (n 0) console.log(failed to init vertex buffers); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); let u_ProjMatrix = gl.getUniformLocation(gl.program, u_ProjMatrix); let projMatrix = new Matrix4(); document.onkeydown = function (ev) keydown(ev, gl, n, u_ProjMatrix, projMatrix, nf); draw(gl, n, u_ProjMatrix, projMatrix, nf);let g_nf = [0.0, 0.5];function keydown(ev,gl,n,u_ProjMatrix,projMatrix,nf) switch (ev.keyCode) case 39: g_nf[0] += 0.01; break;//å³é”® case 37: g_nf[0] -= 0.01; break;//å·¦é”® case 38: g_nf[1] += 0.01; break;//ä¸Šé”® case 40: g_nf[1] -= 0.01; break;//ä¸‹é”® default: break; draw(gl, n, u_ProjMatrix, projMatrix, nf);function draw(gl,n,u_ProjMatrix,projMatrix,nf) projMatrix.setOrtho(-1, 1, -1, 1, g_nf[0], g_nf[1]); gl.uniformMatrix4fv(u_ProjMatrix, false, projMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT); // nf.innerHTML = near: + Math.round(g_nf[0] * 100) / 100 + // ,far: + Math.round(g_nf[1] * 100) / 100; nf.innerHTML = near: + g_nf[0].toFixed(2) + ,far: + g_nf[1].toFixed(2); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffers(gl) let verticesColor = new Float32Array([ // çº¢è‰²ä¸‰è§’å½¢ 0.0, 0.5, -0.4, 1.0, 0.4, 0.4, -0.5, -0.5, -0.4, 1.0, 0.4, 0.4, 0.5, -0.5, -0.4, 0.0, 0.4, 0.4, // ç»¿è‰²ä¸‰è§’å½¢ -0.4, 0.4, -0.2, 0.4, 1.0, 0.4, 0.4, 0.4, -0.2, 0.4, 1.0, 0.4, 0.0, -0.6, -0.2, 0.4, 0.0, 0.4, // è“è‰²ä¸‰è§’å½¢ 0.0, 0.5, 0.0, 0.4, 0.4, 1.0, -0.5, -0.5, -0.0, 0.4, 0.4, 1.0, 0.5, -0.5, -0.0, 0.4, 0.4, 0.0 ]); let n = 9; let FSIZE = verticesColor.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColor, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, 6 * FSIZE, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 6 * FSIZE, 3*FSIZE); gl.enableVertexAttribArray(a_Color); return n; nearã€farä¸ä¸‰è§’å½¢æ¶ˆå¤±çš„å…³ç³» Jsä¸­å¯¹å›ºå®šä½å°æ•°ç‰¹æ®Šçš„å¤„ç†æ–¹å¼// æ–¹æ³•1:Math.roundlet digit = Math.pow( 100, 2);let result = Math.round(num * digit)/digit; // æ–¹æ³•2 toFixlet digit = 2;let result = num.toFixed(digit);ShapeZ VauleShow Conditionimg classâ€lazyâ€ srcâ€imageswikiWebGLOrtho_1.pngâ€ data-srcâ€imageswikiWebGLOrtho_1.pngâ€onerrorâ€this.srcdata:imagesvg+xml,%3Csvg xmlnsâ€™http://www.w3.org/2000/svgâ€˜ widthâ€™2remâ€™ heightâ€™2remâ€™ viewBoxâ€™0 0 24 24â€™%3E%3C!â€“ Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ â€“%3E%3Cpath fillâ€™%23F44336â€™ dâ€™M22 12.698c-.002 1.47-.013 2.718-.096 3.743c-.097 1.19-.296 2.184-.74 3.009a4.2 4.2 0 0 1-.73.983c-.833.833-1.893 1.21-3.237 1.39C15.884 22 14.2 22 12.053 22h-.106c-2.148 0-3.83 0-5.144-.177c-1.343-.18-2.404-.557-3.236-1.39c-.738-.738-1.12-1.656-1.322-2.795c-.2-1.12-.236-2.512-.243-4.241Q1.999 12.737 2 12v-.054c0-2.148 0-3.83.177-5.144c.18-1.343.557-2.404 1.39-3.236s1.893-1.21 3.236-1.39c1.168-.157 2.67-.175 4.499-.177a.697.697 0 1 1 0 1.396c-1.855.002-3.234.018-4.313.163c-1.189.16-1.906.464-2.436.994S3.72 5.8 3.56 6.99C3.397 8.2 3.395 9.788 3.395 12v.784l.932-.814a2.14 2.14 0 0 1 2.922.097l3.99 3.99a1.86 1.86 0 0 0 2.385.207l.278-.195a2.79 2.79 0 0 1 3.471.209l2.633 2.37c.265-.557.423-1.288.507-2.32c.079-.972.09-2.152.091-3.63a.698.698 0 0 1 1.396 0â€™ opacityâ€™.5â€™%3E%3Cpath fillâ€™%23F44336â€™ fill-ruleâ€™evenoddâ€™ dâ€™M17.5 11c-2.121 0-3.182 0-3.841-.659S13 8.621 13 6.5s0-3.182.659-3.841S15.379 2 17.5 2s3.182 0 3.841.659S22 4.379 22 6.5s0 3.182-.659 3.841S19.621 11 17.5 11m-1.47-7.03a.75.75 0 1 0-1.06 1.06l1.47 1.47l-1.47 1.47a.75.75 0 0 0 1.06 1.06l1.47-1.47l1.47 1.47a.75.75 0 1 0 1.06-1.06L18.56 6.5l1.47-1.47a.75.75 0 0 0-1.06-1.06L17.5 5.44zâ€™ clip-ruleâ€™evenoddâ€™%3E%3Csvg%3Eâ€0.0near0.00 far0.00img classâ€lazyâ€ srcâ€imageswikiWebGLOrtho_2.pngâ€ data-srcâ€imageswikiWebGLOrtho_2.pngâ€onerrorâ€this.srcdata:imagesvg+xml,%3Csvg xmlnsâ€™http://www.w3.org/2000/svgâ€˜ widthâ€™2remâ€™ heightâ€™2remâ€™ viewBoxâ€™0 0 24 24â€™%3E%3C!â€“ Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ â€“%3E%3Cpath fillâ€™%23F44336â€™ dâ€™M22 12.698c-.002 1.47-.013 2.718-.096 3.743c-.097 1.19-.296 2.184-.74 3.009a4.2 4.2 0 0 1-.73.983c-.833.833-1.893 1.21-3.237 1.39C15.884 22 14.2 22 12.053 22h-.106c-2.148 0-3.83 0-5.144-.177c-1.343-.18-2.404-.557-3.236-1.39c-.738-.738-1.12-1.656-1.322-2.795c-.2-1.12-.236-2.512-.243-4.241Q1.999 12.737 2 12v-.054c0-2.148 0-3.83.177-5.144c.18-1.343.557-2.404 1.39-3.236s1.893-1.21 3.236-1.39c1.168-.157 2.67-.175 4.499-.177a.697.697 0 1 1 0 1.396c-1.855.002-3.234.018-4.313.163c-1.189.16-1.906.464-2.436.994S3.72 5.8 3.56 6.99C3.397 8.2 3.395 9.788 3.395 12v.784l.932-.814a2.14 2.14 0 0 1 2.922.097l3.99 3.99a1.86 1.86 0 0 0 2.385.207l.278-.195a2.79 2.79 0 0 1 3.471.209l2.633 2.37c.265-.557.423-1.288.507-2.32c.079-.972.09-2.152.091-3.63a.698.698 0 0 1 1.396 0â€™ opacityâ€™.5â€™%3E%3Cpath fillâ€™%23F44336â€™ fill-ruleâ€™evenoddâ€™ dâ€™M17.5 11c-2.121 0-3.182 0-3.841-.659S13 8.621 13 6.5s0-3.182.659-3.841S15.379 2 17.5 2s3.182 0 3.841.659S22 4.379 22 6.5s0 3.182-.659 3.841S19.621 11 17.5 11m-1.47-7.03a.75.75 0 1 0-1.06 1.06l1.47 1.47l-1.47 1.47a.75.75 0 0 0 1.06 1.06l1.47-1.47l1.47 1.47a.75.75 0 1 0 1.06-1.06L18.56 6.5l1.47-1.47a.75.75 0 0 0-1.06-1.06L17.5 5.44zâ€™ clip-ruleâ€™evenoddâ€™%3E%3Csvg%3Eâ€-0.2near0.20 far0.20img classâ€lazyâ€ srcâ€imageswikiWebGLOrtho_3.pngâ€ data-srcâ€imageswikiWebGLOrtho_3.pngâ€onerrorâ€this.srcdata:imagesvg+xml,%3Csvg xmlnsâ€™http://www.w3.org/2000/svgâ€˜ widthâ€™2remâ€™ heightâ€™2remâ€™ viewBoxâ€™0 0 24 24â€™%3E%3C!â€“ Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ â€“%3E%3Cpath fillâ€™%23F44336â€™ dâ€™M22 12.698c-.002 1.47-.013 2.718-.096 3.743c-.097 1.19-.296 2.184-.74 3.009a4.2 4.2 0 0 1-.73.983c-.833.833-1.893 1.21-3.237 1.39C15.884 22 14.2 22 12.053 22h-.106c-2.148 0-3.83 0-5.144-.177c-1.343-.18-2.404-.557-3.236-1.39c-.738-.738-1.12-1.656-1.322-2.795c-.2-1.12-.236-2.512-.243-4.241Q1.999 12.737 2 12v-.054c0-2.148 0-3.83.177-5.144c.18-1.343.557-2.404 1.39-3.236s1.893-1.21 3.236-1.39c1.168-.157 2.67-.175 4.499-.177a.697.697 0 1 1 0 1.396c-1.855.002-3.234.018-4.313.163c-1.189.16-1.906.464-2.436.994S3.72 5.8 3.56 6.99C3.397 8.2 3.395 9.788 3.395 12v.784l.932-.814a2.14 2.14 0 0 1 2.922.097l3.99 3.99a1.86 1.86 0 0 0 2.385.207l.278-.195a2.79 2.79 0 0 1 3.471.209l2.633 2.37c.265-.557.423-1.288.507-2.32c.079-.972.09-2.152.091-3.63a.698.698 0 0 1 1.396 0â€™ opacityâ€™.5â€™%3E%3Cpath fillâ€™%23F44336â€™ fill-ruleâ€™evenoddâ€™ dâ€™M17.5 11c-2.121 0-3.182 0-3.841-.659S13 8.621 13 6.5s0-3.182.659-3.841S15.379 2 17.5 2s3.182 0 3.841.659S22 4.379 22 6.5s0 3.182-.659 3.841S19.621 11 17.5 11m-1.47-7.03a.75.75 0 1 0-1.06 1.06l1.47 1.47l-1.47 1.47a.75.75 0 0 0 1.06 1.06l1.47-1.47l1.47 1.47a.75.75 0 1 0 1.06-1.06L18.56 6.5l1.47-1.47a.75.75 0 0 0-1.06-1.06L17.5 5.44zâ€™ clip-ruleâ€™evenoddâ€™%3E%3Csvg%3Eâ€-0.4near0.40 far0.40 è¡¥ä¸Šä¸‰è§’å½¢ç¼ºæ‰çš„è§’ç®€è¿°ï¼šå³æ¨è¿œè¿œè£å‰ªé¢ï¼Œæœ¬ä¾‹ä¸»è¦ä»‹ç»è§†å›¾çŸ©é˜µä¸æ­£å°„æŠ•å½±çŸ©é˜µçš„æ··åˆä½¿ç”¨ æ­£å°„çŸ©é˜µå’Œè§†å›¾æŠ•å½±çŸ©é˜µçš„ä½¿ç”¨é¡ºåº gl_Position = ProjMatrix * ViewMatrix * a_Position;å¾—åˆ°é¡¶ç‚¹åœ¨è§†å›¾åæ ‡ç³»ä¸‹çš„åæ ‡ä½¿ç”¨æ­£å°„æŠ•å½±çŸ©é˜µè®¡ç®—å¯è§†èŒƒå›´ LookAtTrianglesWithKeys_ViewVolume ä¸‰è§’å½¢æ•´å½¢å‰ ä¸‰è§’å½¢æ•´å‹å å¯è§†ç©ºé—´ä¸canvasçš„æ¯”ä¾‹å†²çªæ¯”ä¾‹å†²çªä¼šå¯¼è‡´å‹ç¼©å˜å½¢ ç”»å¸ƒå¤§å°ä¸å˜ï¼Œå¯è§†ç©ºé—´æ¨ªæˆªé¢ç¼©å‡ä¸€åŠè¿è¡Œæ•ˆæœï¼š å›¾å½¢å˜ä¸ºåŸæ¥å¤§å°çš„ä¸¤å€ï¼Œè¶…å‡ºå¯è§†ç©ºé—´éƒ¨åˆ†è¢«è£å‰ªã€‚projMatrix.setOrtho(-0.5,0.5,-0.5,0.5,0.0,1.0)ç”»å¸ƒå¤§å°ä¸å˜ï¼Œå¯è§†ç©ºé—´æ¯”ä¾‹æ”¹å˜è¿è¡Œæ•ˆæœï¼š å›¾å½¢åœ¨å®½åº¦ä¸Šè¢«æ‹‰ä¼¸å¯¼è‡´å˜å½¢ï¼Œè¶…å‡ºå¯è§†ç©ºé—´éƒ¨åˆ†è¢«è£å‰ªã€‚projMatrix.setOrtho(-0.3,0.3,-1.0,1.0,0.0,1.0)"},{"title":"å¯è§†ç©ºé—´ï¼ˆé€è§†æŠ•å½±ï¼‰","path":"/wiki/WebGL/chapter_07_03.html","content":"å®šä¹‰é€è§†æŠ•å½±å¯è§†ç©ºé—´å¦‚ä½•è¡¨è¾¾é€è§†æŠ•å½±å¯è§†ç©ºé—´ï¼Ÿ ç­”ï¼š è§†ç‚¹ã€è§†çº¿ã€è¿‘è£å‰ªé¢ã€è¿œè£å‰ªé¢ï¼Œå®½é«˜æ¯”ã€‚é€è§†æŠ•å½±çŸ©é˜µï¼ˆperspective projection matrixï¼‰setPerspective(30.0,1.0,1.0,100) fov 30.0 aspect 1.0 near 1.0 far 100.0 PerspectiveView Code PerspectiveViewè¿è¡Œæ•ˆæœPerspectiveView.htmlPerspectiveView.js!DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 meta http-equiv=X-UA-Compatible content=IE=edge meta name=viewport content=width=device-width, initial-scale=1.0 titleDocument/title script src=../examples/lib/cuon-matrix.js/script script src=../examples/lib/cuon-utils.js/script script src=../examples/lib/webgl-debug.js/script script src=../examples/lib/webgl-utils.js/script script src=./PerspectiveView.js/script/headbody onload=main() canvas id=webgl width=400 height=400/canvas p id=nearFar/p/body/htmllet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_ViewMatrix; uniform mat4 u_ProjMatrix; varying vec4 v_Color; void main() gl_Position = u_ProjMatrix * u_ViewMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let nf = document.getElementById(nearFar); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); let n = initVertexBuffers(gl); let u_ViewMatrix = gl.getUniformLocation(gl.program, u_ViewMatrix); let viewMatrix = new Matrix4(); viewMatrix.setLookAt( 0, 0, 5, 0, 0, -100, 0, 1, 0 ); gl.uniformMatrix4fv(u_ViewMatrix, false, viewMatrix.elements); let u_ProjMatrix = gl.getUniformLocation(gl.program, u_ProjMatrix); let projMatrix = new Matrix4(); document.onkeydown = function (ev) keydown(canvas,gl,ev,n,u_ProjMatrix,projMatrix,nf); draw(canvas,gl,n,u_ProjMatrix,projMatrix,nf);let g_fov = 30.0;let g_far = 100.0;function keydown(canvas,gl,ev,n,u_ProjMatrix,projMatrix,nf) switch (ev.keyCode) case 37: g_far -= 1.0; break; case 38: g_fov += 1.0; break; case 39: g_far += 1.0; break; case 40: g_fov -= 1.0; break; default: break; draw(canvas,gl, n, u_ProjMatrix, projMatrix, nf);function draw(canvas,gl,n,u_ProjMatrix,projMatrix,nf) projMatrix.setPerspective(g_fov, canvas.width / canvas.height, 1.0, g_far); gl.uniformMatrix4fv(u_ProjMatrix, false, projMatrix.elements); nf.innerHTML = fov: + Math.round(g_fov * 10) / 10 + far: + Math.round(g_far * 10) / 10; gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n);function initVertexBuffers(gl) let verticesColors = new Float32Array([ //* å³ä¾§3ä¸ªä¸‰è§’å½¢ // ç»¿è‰²-æœ€å 0.75, 1.0, -4.0, 0.4, 1.0, 0.4, 0.25, -1.0, -4.0, 0.4, 1.0, 0.4, 1.25, -1.0, -4.0, 1.0, 0.4, 0.4, // é»„è‰²-ä¸­é—´ 0.75, 1.0, -2.0, 1.0, 1.0, 0.4, 0.25, -1.0, -2.0, 1.0, 1.0, 0.4, 1.25, -1.0, -2.0, 1.0, 0.4, 0.4, // è“è‰²-æœ€å‰ 0.75, 1.0, 0.0, 0.4, 0.4, 1.0, 0.25, -1.0, 0.0, 0.4, 0.4, 1.0, 1.25, -1.0, 0.0, 1.0, 0.4, 0.4, //* å·¦ä¾§3ä¸ªä¸‰è§’å½¢ // ç»¿è‰²-æœ€å -0.75, 1.0, -4.0, 0.4, 1.0, 0.4, -1.25, -1.0, -4.0, 0.4, 1.0, 0.4, -0.25, -1.0, -4.0, 1.0, 0.4, 0.4, // é»„è‰²-ä¸­é—´ -0.75, 1.0, -2.0, 1.0, 1.0, 0.4, -1.25, -1.0, -2.0, 1.0, 1.0, 0.4, -0.25, -1.0, -2.0, 1.0, 0.4, 0.4, // è“è‰²-æœ€å‰ -0.75, 1.0, 0.0, 0.4, 0.4, 1.0, -1.25, -1.0, 0.0, 0.4, 0.4, 1.0, -0.25, -1.0, 0.0, 1.0, 0.4, 0.4, ]); let n = 18; let FSIZE = verticesColors.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, 6 * FSIZE, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 6 * FSIZE, 3 * FSIZE); gl.enableVertexAttribArray(a_Color); return n; é€è§†çŸ©é˜µçš„ä½œç”¨ é€è§†çŸ©é˜µå®é™…ä¸Šå¯¹ä¸‰è§’å½¢è¿›è¡Œäº† ä¸¤æ¬¡å˜æ¢ï¼šç¼©å°å˜æ¢ï¼š æ ¹æ®ä¸‰è§’å½¢ä¸è§†ç‚¹è·ç¦»æŒ‰æ¯”ä¾‹å¯¹ä¸‰è§’å½¢è¿›è¡Œç¼©å°å˜æ¢ã€‚å¹³ç§»å˜æ¢ï¼š ä½¿ä¸‰è§’å½¢è´´è¿‘è§†çº¿ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¯¹ç›’å¼ç©ºé—´ä¸­çš„å›¾å½¢è¿›è¡Œå‡ ä½•å˜æ¢ï¼Œä½¿å…¶è¾¾åˆ°å…·æœ‰æ·±åº¦çš„è§†è§‰æ•ˆæœã€‚ç›’çŠ¶å¯è§†ç©ºé—´ï¼ˆCanonical View Volumeï¼‰ ä¸é‡‘å­—å¡”çŠ¶å¯è§†ç©ºé—´çš„å…³ç³» å…±å†¶ä¸€ç‚‰PerspectiveViewæœ‰ä»€ä¹ˆé—®é¢˜æ˜¯éœ€è¦ä¼˜åŒ–çš„ï¼Ÿ ç­”ï¼š å·¦å³ä¸¤åˆ—ä¸‰è§’å½¢å¯¹ç§°ï¼Œå®Œå…¨å¯ä»¥ç”±ä¸€åˆ—ä¸‰è§’å½¢å¹³ç§»è·å¾—ã€‚ å‡†å¤‡è™šçº¿ä¸‰è§’å½¢é¡¶ç‚¹æ•°æ® æ²¿Xè½´æ­£æ–¹å‘å¹³ç§»0.75å•ä½ï¼Œç»˜åˆ¶å‡ºç»“æœ æ²¿Xè½´è´Ÿæ–¹å‘å¹³ç§»0.75å•ä½ï¼Œç»˜åˆ¶å‡ºç»“æœ mvpçŸ©é˜µ æ¨¡å‹çŸ©é˜µï¼ˆModel Matrixï¼‰è§†å›¾çŸ©é˜µï¼ˆView Matrixï¼‰æŠ•å½±çŸ©é˜µï¼ˆProject Matrixï¼‰gl_Position = æŠ•å½±çŸ©é˜µ * è§†å›¾çŸ©é˜µ * æ¨¡å‹çŸ©é˜µ * a_Position; PerspectiveView_mvp Code å’ŒPerspectiveViewè¿è¡Œç»“æœä¸€æ ·VSHADER_SOURCEmain()initVertexBuffer()let VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_ViewMatrix; uniform mat4 u_ProjMatrix; uniform mat4 u_ModelMatrix; varying vec4 v_Color; void main() gl_Position = u_ProjMatrix * u_ViewMatrix * u_ModelMatrix * a_Position; v_Color = a_Color; `;let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix);let modelMatrix = new Matrix4();modelMatrix.setTranslate(-0.75, 0, 0);gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements);gl.drawArrays(gl.TRIANGLES, 0, n);modelMatrix.setTranslate(0.75, 0, 0);gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements);gl.drawArrays(gl.TRIANGLES, 0, n);let verticesColors = new Float32Array([ //* å³ä¾§3ä¸ªä¸‰è§’å½¢ // ç»¿è‰²-æœ€å 0.0, 1.0, -4.0, 0.4, 1.0, 0.4, -0.5, -1.0, -4.0, 0.4, 1.0, 0.4, 0.5, -1.0, -4.0, 1.0, 0.4, 0.4, // é»„è‰²-ä¸­é—´ 0.0, 1.0, -2.0, 1.0, 1.0, 0.4, -0.5, -1.0, -2.0, 1.0, 1.0, 0.4, 0.5, -1.0, -2.0, 1.0, 0.4, 0.4, // è“è‰²-æœ€å‰ 0.0, 1.0, 0.0, 0.4, 0.4, 1.0, -0.5, -1.0, 0.0, 0.4, 0.4, 1.0, 0.5, -1.0, 0.0, 1.0, 0.4, 0.4,]); PerspectiveView_mvpéœ€è¦æ³¨æ„çš„éƒ¨åˆ† æ€§èƒ½çœŸçš„æé«˜äº†å—ï¼Ÿç­”ï¼š è™½ç„¶å‡å°‘äº†é¡¶ç‚¹çš„ä¸ªæ•°ï¼Œä½†æ˜¯å¢åŠ äº†drawArraysçš„æ¬¡æ•°ï¼Œå› æ­¤å®é™…ä½¿ç”¨æ—¶æ€§èƒ½ä¸ä¸€å®šæé«˜ã€‚ å¯ä¸å¯ä»¥æŠŠçŸ©é˜µçš„è®¡ç®—æ‹‰å‡ºç€è‰²å™¨ï¼Ÿç­”ï¼š è¢«æ‹‰å‡ºçš„çŸ©é˜µè¢«ç§°ä¸º æ¨¡å‹è§†å›¾æŠ•å½±çŸ©é˜µã€‚ å…³é”®ä»£ç è¡Œ mvpMatrix.set(projMatrix).multiply(viewMatrix).multiply(modelMatrix);"},{"title":"ç«‹æ–¹ä½“","path":"/wiki/WebGL/chapter_07_05.html","content":"ä½¿ç”¨drawArraysç»˜åˆ¶ç«‹æ–¹ä½“ ä¸€ä¸ªç«‹æ–¹ä½“ä¸€å…±8ä¸ªé¡¶ç‚¹ï¼Œ6ä¸ªé¢ï¼Œ12ä¸ªä¸‰è§’å½¢ã€‚ModeVertex NumberDraw TimeTRIANGLES361TRIANGLE_FAN246TRIANGLE_STRIP141 é€šè¿‡é¡¶ç‚¹ç´¢å¼•ç»˜åˆ¶ç‰©ä½“drawElements ç«‹æ–¹ä½“ç»˜åˆ¶æ‰€éœ€å»ºç«‹çš„æ•°æ®ç»“æ„drawArrayså’ŒdrawElementsåŒºåˆ«æœ€é‡è¦çš„åŒºåˆ«å°±åœ¨äºdrawElementséœ€è¦æŒ‡å®šé¡¶ç‚¹çš„ç´¢å¼•å€¼ï¼Œå› æ­¤ä½¿ç”¨çš„æ˜¯ gl.ELEMENT_ARRAY_BUFFER è€Œä¸æ˜¯gl.ARRAY_BUFFERã€‚ drawArrayså°±åƒç­çº§é‡Œè€å¸ˆç›´æ¥å«åå­—ç»™åŒå­¦å®‰æ’åº§ä½drawElementsæ›´åƒå­¦æ ¡é‡Œé€šè¿‡å­¦å·å®‰æ’è€ƒåœºå…³äºç¬¬ä¸‰ä¸ªå‚æ•°typeçš„æ³¨æ„ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯typeå‚æ•°å’Œgl.ELEMENT_ARRAY_BUFFERçš„æ•°æ®ç±»å‹ä¸ä¸€è‡´ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¯èƒ½ä¼šç»˜åˆ¶å‡ºä¸€äº›ä¸å¯åçŠ¶ä¹‹ç‰©ã€‚ HelloCubes Code HelloCubesè¿è¡Œæ•ˆæœShadermaininitVertexBufferslet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_MvpMatrix; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let mvpMatrix = new Matrix4(); mvpMatrix.setPerspective(30, 1, 1, 100); mvpMatrix.lookAt( 3, 3, 7, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.enable(gl.DEPTH_TEST); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function initVertexBuffers(gl) let verticesColors = new Float32Array([ // Vertex coordinates and color 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, // v0 White -1.0, 1.0, 1.0, 1.0, 0.0, 1.0, // v1 Magenta -1.0, -1.0, 1.0, 1.0, 0.0, 0.0, // v2 Red 1.0, -1.0, 1.0, 1.0, 1.0, 0.0, // v3 Yellow 1.0, -1.0, -1.0, 0.0, 1.0, 0.0, // v4 Green 1.0, 1.0, -1.0, 0.0, 1.0, 1.0, // v5 Cyan -1.0, 1.0, -1.0, 0.0, 0.0, 1.0, // v6 Blue ]); let FSIZE = verticesColors.BYTES_PER_ELEMENT; let indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, //å‰ 0, 3, 4, 0, 4, 5, //å³ 0, 5, 6, 0, 6, 1, //ä¸Š 1, 6, 7, 1, 7, 2, //å·¦ 7, 4, 3, 7, 3, 2, //ä¸‹ 4, 7, 6, 4, 6, 5, //å ]); let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, 6 * FSIZE, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 6 * FSIZE, 3 * FSIZE); gl.enableVertexAttribArray(a_Color); // write index buffer let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length; é¡¶ç‚¹ç´¢å¼•çš„å†™å…¥ é¡¶ç‚¹ç´¢å¼•æ•°ç»„çš„ç±»å‹æ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Ÿlet indices = new Int8Array([ 0, 1, 2, 0, 2, 3, 0, 1, 6, 0, 5, 6, 0, 3, 4, 0, 4, 5, 1, 2, 7, 1, 6, 7, 5, 6, 7, 5, 4, 7, 2, 3, 7, 4, 3, 7]); ç­”ï¼š éœ€è¦é¡¶ç‚¹ä¸ªæ•°æ¥ç¡®å®šï¼ŒInt8Arrayç±»å‹å¯ä»¥ç”¨æ¥ç»˜åˆ¶256ä¸ªé¡¶ç‚¹ã€‚ gl.ELEMENT_ARRAY_BUFFERå’Œgl.ARRAY_BUFFERçš„å†…å®¹æ˜¯å¦‚ä½•äº§ç”Ÿè”ç³»çš„ï¼Ÿé¡¶ç‚¹ç´¢å¼•å’Œé¡¶ç‚¹å…³ç³»æ•°æ®ç»“æ„å›¾ é€šè¿‡ç´¢å¼•è·å–é¡¶ç‚¹æ•°æ®ç¤ºæ„å›¾gl.drawElementsçš„nå‚æ•°è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆçš„ä¸ªæ•°ï¼Ÿgl.drawElements(gl.TRIANGLES,n,gl.UNSIGNED_BYTE,0); ç­”ï¼š nè¡¨ç¤ºé¡¶ç‚¹ç´¢å¼•æ•°ç»„çš„é•¿åº¦ã€‚ é€šè¿‡ç´¢å¼•æ¥è®¿é—®é¡¶ç‚¹æ•°æ®çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ä¼˜ç‚¹èƒ½å¤Ÿå¾ªç¯åˆ©ç”¨é¡¶ç‚¹ä¿¡æ¯ï¼Œæ§åˆ¶å†…å­˜çš„å¼€é”€ã€‚ ç¼ºç‚¹éœ€è¦é€šè¿‡ç´¢å¼•æ¥é—´æ¥åœ°è®¿é—®ï¼ŒæŸç§ç¨‹åº¦ä¸Šä½¿ç¨‹åºå¤æ‚åŒ–äº†ã€‚ ä¸ºç«‹æ–¹ä½“çš„æ¯ä¸ªè¡¨é¢æŒ‡å®šé¢œè‰²éœ€è¦åˆ›å»ºå¤šä¸ªåæ ‡ç›¸åŒï¼Œé¢œè‰²ä¸åŒçš„é¡¶ç‚¹ ç«‹æ–¹ä½“çš„ä¸€ä¸ªé¡¶ç‚¹åŒæ—¶åœ¨ä¸‰ä¸ªå¹³é¢çš„äº¤ç‚¹å¤„ï¼Œå› æ­¤éœ€è¦è®¾ç½®3ä¸ªåæ ‡ç›¸åŒï¼Œé¢œè‰²ä¸åŒçš„é¡¶ç‚¹ã€‚è¿™æ ·ä¸€å…±å°±éœ€è¦åˆ›å»º3*824ä¸ªé¡¶ç‚¹ã€‚ ColoredCube ColoredCubeè¿è¡Œæ•ˆæœShadermaininitVertexBuffersinitArrayBufferlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_MvpMatrix; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let mvpMatrix = new Matrix4(); mvpMatrix.setPerspective( 30, 1, 1, 100 ).lookAt( 3, 3, 7, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); gl.clearColor(0, 0, 0, 1); gl.enable(gl.DEPTH_TEST); gl.clear(gl.COLOR_BUFFER_BIT | gl.FEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function initVertexBuffers(gl) // v6------ v5 // /| /| // v1--------v0| // | | | | // | |v7-----|-|v4 // |/ |/ // v2-------v3 let vertices = new Float32Array([ // font-back-left-right-up-down 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, //front v0-v1-v2-v3 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1,//back v5-v6-v7-v4 -1, 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, //left v1-v2-v7-v6 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1,//right v0-v3-v4-v5 1, 1, 1, -1, 1, 1, -1, 1, -1, 1, 1, -1,//up v0-v1-v6-v5 1, -1, 1, -1, -1, 1, -1, -1, -1, 1, -1, -1//down v3-v2-v7-v4 ]); let colors = new Float32Array([ 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, //front 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, //back 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, //left 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, //right 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, //up 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, //down ]); let indices = new Int8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // back 8, 9,10, 8,10,11, // left 12,13,14, 12,14,15, // right 16,17,18, 16,18,19, // up 20,21,22, 20,22,23 // down ]); let indexBuffer = gl.createBuffer(); initArrayBuffer(gl, vertices, 3, gl.FLOAT, a_Position); initArrayBuffer(gl, colors, 3, gl.FLOAT, a_Color); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer(gl, data, num, type, attribute) let buffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); let a_attribute = gl.getAttribLocation(gl.program, attribute); gl.vertexAttribPointer(a_attribute, num, type, false, 0, 0,); gl.enableVertexAttribArray(a_attribute); çº¯ç™½ç›’å­ let colors = new Float32Array([ 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]);ColoredCube_singleColorè¿è¡Œæ•ˆæœ"},{"title":"æ·±åº¦","path":"/wiki/WebGL/chapter_07_04.html","content":"æ­£ç¡®å¤„ç†å¯¹è±¡çš„å‰åå…³ç³»WebGLèƒ½è‡ªåŠ¨åˆ†æå‡ºä¸‰ç»´å¯¹è±¡çš„è¿œè¿‘å—ï¼Ÿ ç­”ï¼š ä¸èƒ½ã€‚WebGLä¸èƒ½æ­£ç¡®å¤„ç†é®æŒ¡å…³ç³»ï¼Œåç»˜åˆ¶çš„å›¾å½¢æ€»æ˜¯è¦†ç›–å…ˆç»˜åˆ¶çš„å›¾å½¢ã€‚WebGLä¸ºäº†åŠ é€Ÿç»˜å›¾æ“ä½œï¼Œä¼˜å…ˆæŒ‰ç…§é¡¶ç‚¹åœ¨ç¼“å†²åŒºçš„é¡ºåºè¿›è¡Œå¤„ç†ï¼ˆå¤„ç†é®æŒ¡å…³ç³»çš„è¯éœ€è¦å¯¹é¡¶ç‚¹æ•°æ®è¿›è¡Œæ‰“ä¹±é‡æ’å—ï¼Ÿï¼‰ã€‚ æ‰“ä¹±PerspectiveViewçš„ç¼“å†²åŒºé¡¶ç‚¹é¡ºåºç»˜åˆ¶æ•ˆæœå¦‚ä½•ï¼Ÿ let verticesColors = new Float32Array([ // è“è‰² 0.0, 1.0, 0.0, 0.4, 0.4, 1.0, -0.5, -1.0, 0.0, 0.4, 0.4, 1.0, 0.5, -1.0, 0.0, 1.0, 0.4, 0.4, // é»„è‰² 0.0, 1.0, -2.0, 1.0, 1.0, 0.4, -0.5, -1.0, -2.0, 1.0, 1.0, 0.4, 0.5, -1.0, -2.0, 1.0, 0.4, 0.4, // ç»¿è‰² 0.0, 1.0, -4.0, 0.4, 1.0, 0.4, -0.5, -1.0, -4.0, 0.4, 1.0, 0.4, 0.5, -1.0, -4.0, 1.0, 0.4, 0.4,]);åç»˜åˆ¶çš„å›¾å½¢è¦†ç›–äº†å…ˆç»˜åˆ¶çš„å›¾å½¢ éšè—é¢æ¶ˆé™¤éšè—é¢æ¶ˆé™¤ï¼ˆhidden surface removalï¼‰ å…·ä½“åŠŸèƒ½ï¼š æ¶ˆé™¤è¢«é®æŒ¡çš„è¡¨é¢ï¼Œå·²ç»è¢«å†…åµŒåœ¨WebGLä¸­ã€‚å¼€å¯æ–¹å¼éš¾é“å°±ä¸èƒ½ç»™ä¸ªBooleanå±æ€§ç›´æ¥è¡¨ç¤ºå¼€å¯æˆ–å…³é—­å—ï¼Ÿæ¼å•Šï¼éšè—é¢æ¶ˆé™¤å‰æå¿…é¡»è¦å…ˆè®¾ç½®å¯è§†ç©ºé—´ï¼Œæ— è®ºæ˜¯æ­£å°„è¿˜æ˜¯é€è§†ç±»å‹ã€‚1.å¼€å¯éšè—é¢æ¶ˆé™¤åŠŸèƒ½gl.enable(gl.DEPTH_TEST);2.ç»˜åˆ¶å‰æ¸…é™¤æ·±åº¦ç¼“å†²åŒºgl.clear(gl.DEAPTH_BUFFER_BIT);enableå’Œdisableenableç”¨æ¥å¼€å¯WebGLæ±‡æ€»çš„å¤šç§åŠŸèƒ½ï¼Œdisableä¸ä¹‹ç›¸åã€‚capçš„å–å€¼ä¸æ­¢è¿™äº›æ›´å¤šå¯å‚é˜…OpenGL Programming Guideä¸€ä¹¦ã€‚ä¸ºä»€ä¹ˆè¯´æ·±åº¦ç¼“å†²åŒºæ˜¯ä¸ªä¸­é—´å¯¹è±¡ï¼Ÿç­”ï¼š æƒ³ä¸€æƒ³ï¼Œå¦‚æœè¦æ ¹æ®é¡¶ç‚¹çš„æ·±åº¦åæ ‡å¯¹å›¾å½¢è¿›è¡Œéšè—é¢æ¶ˆé™¤ï¼Œé‚£é¦–å…ˆå°±è¦çŸ¥é“ æ¯ä¸ªå‡ ä½•å›¾å½¢çš„æ·±åº¦ä¿¡æ¯ï¼Œæ·±åº¦ç¼“å†²åŒºå°±æ˜¯ç”¨æ¥å­˜å‚¨ æ·±åº¦ä¿¡æ¯ çš„ã€‚ ä¸ºä»€ä¹ˆéšè—é¢æ¶ˆé™¤åŠŸèƒ½è¦å‘½åä¸ºDEAPTH_TESTï¼Ÿç­”ï¼š å› ä¸ºè¯¥åŠŸèƒ½çš„å®ç°åŸç†å°±æ˜¯é€šè¿‡æ£€æµ‹ï¼ˆTestï¼‰ç‰©ä½“æ¯ä¸ªåƒç´ çš„æ·±åº¦ï¼ˆDepthï¼‰æ¥å†³å®šæ˜¯å¦ç»˜åˆ¶çš„ã€‚ æ·±åº¦ç¼“å†²åŒºçš„æ¸…ç©ºæ—¶æœºç­”ï¼š åœ¨ç»˜åˆ¶ä»»æ„ä¸€å¸§ä¹‹å‰éƒ½è¦æ¸…é™¤æ·±åº¦ç¼“å†²åŒºã€‚åŒæ—¶æ¸…é™¤ä¸¤ä¸ªç¼“å†²åŒºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ æŒ‰ä½æˆ–æ“ä½œ è¿›è¡Œç®€åŒ–ã€‚gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); DepthBuffer Code å¼€å¯DEPTH_TESTåï¼Œå®ç°äº†éšè—é¢æ¶ˆé™¤gl.enable(gl.DEPTH_TEST);gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); æ·±åº¦å†²çªæ·±åº¦å†²çªï¼ˆZ fightingï¼‰ æŒ‡çš„æ˜¯ç‰©ä½“ä¸¤ä¸ªè¡¨é¢æä¸ºæ¥è¿‘æ—¶ï¼Œç»˜åˆ¶å‡ºæ¥çš„è¡¨é¢æ–‘é©³ä¸å¹³æ»‘ã€‚åŸå› æ˜¯åœ¨è¡¨é¢è¿‡äºæ¥è¿‘æ—¶ï¼Œæ·±åº¦ç¼“å†²åŒºæœ‰é™ç²¾åº¦ä¸è¶³ä»¥åŒºåˆ†å‰åã€‚ è¿™ç§é—®é¢˜æœ€å®¹æ˜“å‡ºç°åœ¨åœºæ™¯ä¸­æœ‰å¤šä¸ªè¿åŠ¨ç€çš„ç‰©ä½“æ—¶ã€‚å¤šè¾¹å½¢åç§»ï¼ˆpolygon offsetï¼‰æ˜¯WebGLç”¨äºè§£å†³æ·±åº¦å†²çªçš„æ–¹å¼ã€‚å®ç°åŸç†ï¼š è‡ªåŠ¨åœ¨Zå€¼ä¸ŠåŠ ä¸€ä¸ªåç§»é‡ï¼Œè¯¥å€¼ç”± ç‰©ä½“è¡¨é¢ç›¸å¯¹äºè§‚å¯Ÿè€…è§†çº¿çš„è§’åº¦ æ¥ç¡®å®šã€‚å¤šè¾¹å½¢åç§»æœºåˆ¶çš„å¯ç”¨ï¼ˆ2æ­¥ï¼‰1.å¯ç”¨å¤šè¾¹å½¢åç§»gl.enable(gl.POLYGON_OFFSET_FILL);2.ç»˜åˆ¶ä¹‹å‰æŒ‡å®šè®¡ç®—åç§»é‡çš„å‚æ•°gl.polygonOffset(1.0,1.0);gl.polygonOffset(factor,units) = m * factor + r * units;m è¡¨ç¤ºé¡¶ç‚¹æ‰€åœ¨è¡¨é¢ç›¸å¯¹äºè§‚å¯Ÿè€…çš„è§†çº¿çš„è§’åº¦r è¡¨ç¤ºç¡¬ä»¶èƒ½å¤ŸåŒºåˆ†ä¸¤ä¸ªzå€¼ä¹‹å·®çš„æœ€å°å€¼ Zflighting Zflighting CodesetPerspectivelookAtverticesColorspvMatrix.setPerspective( 30, canvas.width / canvas.height, 1.0, 100.0);pvMatrix.lookAt( 3,0,10, 0, 0, -6, 0, 1, 0);let verticesColors = new Float32Array([ // ç»¿è‰²ä¸‰è§’å½¢ 0.0, 2.5, -5.0, 1.0, 1.0, 0.0, -2.5, -2.5, -5.0, 0.0, 1.0, 0.0, 2.5, -2.5, -5.0, 0.0, 1.0, 0.0, // è“è‰²ä¸‰è§’å½¢ 0.0, 3.0, -5.0, 0.0, 0.0, 1.0, -3.0, -3.0, -5.0, 0.0, 1.0, 1.0, 3.0, -3.0, -5.0, 0.0, 1.0, 1.0,]);å¤šè¾¹å½¢åç§»å‰åå¯¹æ¯” å¤šè¾¹å½¢åç§»å‰ç»˜åˆ¶ç»“æœgl.enable(gl.POLYGON_OFFSET_FILL);gl.drawArrays(gl.TRIANGLES, 0, n/2); // draw green triangle// gl.polygonOffset(1.0, 1.0); // set polygon offsetgl.drawArrays(gl.TRIANGLES, n/2, n/2); // draw blue triangle å¤šè¾¹å½¢åç§»åç»˜åˆ¶ç»“æœgl.enable(gl.POLYGON_OFFSET_FILL);gl.drawArrays(gl.TRIANGLES, 0, n/2); // draw green trianglegl.polygonOffset(1.0, 1.0); // set polygon offsetgl.drawArrays(gl.TRIANGLES, n/2, n/2); // draw blue triangle"},{"title":"å…‰ç…§åŸç†","path":"/wiki/WebGL/chapter_08_01.html","content":"å…‰çº¿ç…§å°„æ—¶éœ€è¦æ³¨æ„çš„ä¸¤ä¸ªé‡è¦çš„ç°è±¡ ç‰©ä½“ä¸åŒè¡¨é¢çš„ æ˜æš—ç¨‹åº¦ å˜å¾—ä¸ä¸€è‡´ ç‰©ä½“å‘åœ°é¢æŠ•ä¸‹äº† å½±å­ ç€è‰²å™¨ä¸å…‰ç…§ ç€è‰²ï¼ˆshadingï¼‰ çœŸæ­£çš„å«ä¹‰å°±æ˜¯ï¼š æ ¹æ®å…‰ç…§æ¡ä»¶é‡å»ºç‰©ä½“å„è¡¨é¢æ˜æš—ä¸ä¸€çš„æ•ˆæœã€‚ç€è‰²å™¨ï¼ˆShaderï¼‰ æœ€åˆè¢«å‘æ˜å‡ºæ¥å°±æ˜¯ä¸ºäº†ï¼š é‡å»ºå…‰ç…§äº§ç”Ÿçš„æ˜æš—ç°è±¡ã€‚ ç€è‰²è¿‡ç¨‹éœ€è¦é‡ç‚¹è€ƒè™‘çš„ä¸¤ç‚¹ï¼š å‘å‡ºå…‰çº¿çš„ å…‰æºç±»å‹ç‰©ä½“è¡¨é¢ å¦‚ä½•åå°„å…‰çº¿ å…‰æºç±»å‹ä¸‰ç§åŸºæœ¬å…‰æºç±»å‹ ç±»å‹æè¿°å®šä¹‰æ¡ä»¶ç±»æ¯”å¹³è¡Œå…‰ï¼ˆdirectional lightï¼‰å…‰çº¿ç›¸äº’å¹³è¡Œï¼Œå¯ä»¥çœ‹åšæ— é™è¿œå¤„å…‰æºå‘å‡ºçš„å…‰æ–¹å‘ï¼Œé¢œè‰²å¤ªé˜³å…‰ç‚¹å…‰æºå…‰ï¼ˆpoint lightï¼‰ä»ä¸€ä¸ªç‚¹å‘å‘¨å›´æ‰€æœ‰æ–¹å‘å‘å‡ºçš„å…‰ä½ç½®ï¼Œé¢œè‰²ç¯æ³¡ã€ç«ç„°ç¯å¢ƒå…‰ï¼ˆambient lightï¼‰ä»å„ä¸ªè§’åº¦ç…§å°„ç‰©ä½“ï¼Œå¼ºåº¦ä¸€è‡´é¢œè‰²æ‰“å¼€å†°ç®±é—¨çš„ç¯å…‰ åå°„ç±»å‹å½±å“åå°„å…‰çš„2ä¸ªå› ç´ æ˜¯ä»€ä¹ˆï¼Ÿ ç­”ï¼š å…¥å°„å…‰å’Œç‰©ä½“è¡¨é¢çš„ç±»å‹ã€‚å…¥å°„å…‰ç‰©ä½“è¡¨é¢æ–¹å‘åŸºåº•è‰²é¢œè‰²åå°„ç‰¹æ€§ ç‰©ä½“è¡¨é¢åå°„å…‰çº¿çš„æ–¹å¼ï¼ˆ2ç§ï¼‰ æ¼«åå°„ diffuse reflectionç¯å¢ƒåå°„ enviroment ambient reflectionæ¼«åå°„ç¯å¢ƒåå°„æ¼«åå°„æ˜¯é’ˆå¯¹å¹³è¡Œå…‰æˆ–ç‚¹å…‰æºçš„ã€‚åå°„æ–¹å‘æ¼«åå°„åå°„å…‰ åœ¨å„ä¸ªæ–¹å‘ä¸Šæ˜¯å‡åŒ€çš„ ã€‚ä¸€èˆ¬é’ˆå¯¹è¡¨é¢ç²—ç³™çš„æè´¨ï¼Œæ˜¯ä¸€ç§ç†æƒ³çš„åå°„æ¨¡å‹ã€‚åå°„é¢œè‰²åå°„é¢œè‰²å—ä¸‰ä¸ªå› ç´ çš„å½±å“ï¼šå…¥å°„å…‰çš„é¢œè‰²è¡¨é¢çš„åŸºåº•è‰²å…¥å°„è§’ å…¥å°„å…‰ä¸è¡¨é¢å‘ç°å½¢æˆçš„å¤¹è§’Î¸æ¼«åå°„å…‰é¢œè‰²çš„è®¡ç®—å…¬å¼ï¼šæ¼«åå°„å…‰é¢œè‰² = å…¥å°„å…‰é¢œè‰² * è¡¨é¢åŸºåº•è‰² * cosÎ¸ ç¯å¢ƒåå°„æ˜¯é’ˆå¯¹ç¯å¢ƒå…‰çš„ã€‚åå°„æ–¹å‘åå°„å…‰æ–¹å‘å¯ä»¥è®¤ä¸ºå°±æ˜¯ å…¥å°„å…‰çš„åæ–¹å‘ ã€‚ åå°„é¢œè‰²ç¯å¢ƒåå°„å…‰é¢œè‰² = å…¥å°„å…‰é¢œè‰² * è¡¨é¢åŸºåº•è‰² æ¼«åå°„å’Œç¯å¢ƒåå°„åŒæ—¶å­˜åœ¨æ—¶çš„é¢œè‰²è®¡ç®—å…¬å¼ è¡¨é¢çš„åå°„å…‰é¢œè‰² = æ¼«åå°„å…‰é¢œè‰² + ç¯å¢ƒåå°„å…‰é¢œè‰² å…¥å°„è§’çš„è®¡ç®—çŸ¢é‡ç‚¹ç§¯ å¦‚æœè¦å¯¹ çŸ¢é‡n å’Œ çŸ¢é‡l åšç‚¹ç§¯è¿ç®—ï¼Œå…¬å¼å¦‚ä¸‹ï¼šnÂ·l = |n| * |l| * cosÎ¸ç”±æ­¤å¯ä»¥æ¨æ¼”å‡ºå…¥å°„è§’cosÎ¸çš„è®¡ç®—å…¬å¼ï¼šcosÎ¸ = nÂ·l/(|n| * |l|)GLSL_ESä¸­å†…ç½®äº†ç‚¹ç§¯è¿ç®—å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Â·è¡¨ç¤ºç‚¹ç§¯è¿ç®—ã€‚cosÎ¸ = å…‰çº¿æ–¹å‘ Â· æ³•çº¿æ–¹å‘ å†…ç½®å‡½æ•°è®¡ç®—ç‚¹ç§¯å®é™…ç”¨åˆ°çš„å…¬å¼n ( nx, ny, nz )l ( lx, ly, lz )nÂ·l = nx*lx + ny*ly + nz*lz ä½¿ç”¨ç‚¹ç§¯è¡¨ç¤ºçš„æ¼«åå°„å…‰é¢œè‰²å…¬å¼ æ¼«åå°„å…‰é¢œè‰² = å…¥å°„å…‰é¢œè‰² * è¡¨é¢åŸºåº•è‰² * (å…‰çº¿æ–¹å‘ Â· æ³•çº¿æ–¹å‘)æ³¨æ„ç‚¹1ï¼šå‚ä¸è®¡ç®—çš„çŸ¢é‡éœ€è¦è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚å…‰çº¿æ–¹å‘çŸ¢é‡ å’Œ è¡¨é¢æ³•çº¿çŸ¢é‡ é•¿åº¦å¿…é¡»æ˜¯1ï¼Œå¦åˆ™åå°„å…‰é¢œè‰²å°±ä¼šè¿‡æš—æˆ–è¿‡äº®ã€‚ å½’ä¸€åŒ–ï¼ˆnormalizationï¼‰ æŒ‡çš„æ˜¯å°†ä¸€ä¸ªçŸ¢é‡ é•¿åº¦è°ƒæ•´ä¸º1ï¼ŒåŒæ—¶ä¿æŒæ–¹å‘ä¸å˜ã€‚å‡è®¾çŸ¢é‡n (nx,ny,nz)è®¾çŸ¢é‡nçš„é•¿åº¦ä¸ºmï¼Œå³ |n| m sqrt(nx^2 + ny^2 + nz^2)nå½’ä¸€åŒ–åç»“æœä¸º (nxm,nym,nzm)å¦‚è®¾n (2.0,2.0,1.0)|n| sqrt(2^2 + 2^2 + 1^2) 3nå½’ä¸€åŒ–ç»“æœ (2.03, 2.03, 1.03)æ³¨æ„ç‚¹2ï¼šå…‰çº¿æ–¹å‘åˆ°åº•æ˜¯æŒ‡å‘å“ªé‡Œï¼Ÿç­”ï¼š å®é™…ä¸Šæ˜¯å…¥å°„æ–¹å‘çš„åæ–¹å‘ã€‚ æ³•çº¿æ³•çº¿æ˜¯ä»€ä¹ˆï¼Ÿ æ³•çº¿ æˆ– æ³•å‘é‡ï¼Œè¡¨ç¤ºç‰©ä½“è¡¨é¢çš„æœå‘ï¼Œå³å‚ç›´äºè¡¨é¢çš„æ–¹å‘ã€‚æ³•å‘é‡çš„ç›¸å…³é—®é¢˜éœ€è¦è€ƒè™‘ä¸‹é¢ä¸¤ç‚¹ï¼šæ³¨æ„ç‚¹1ï¼šä¸€ä¸ªè¡¨é¢å…·æœ‰ä¸¤ä¸ªæ³•å‘é‡å°±å¥½åƒå¥¥åˆ©å¥¥çš„å¤¹å¿ƒä¸¤è¾¹éƒ½æœ‰é¥¼å¹²ä¸€æ ·ã€‚ å¦‚ xyå¹³é¢ çš„ä¸¤ä¸ªæ³•å‘é‡åˆ†åˆ«æ˜¯ï¼š (0,0,1) (0,0,-1) æ³¨æ„ç‚¹2ï¼šå¹³é¢çš„æ³•å‘é‡å”¯ä¸€æ³•å‘é‡è¡¨ç¤ºçš„æ˜¯ æ–¹å‘ï¼Œå’Œä½ç½®æ— å…³ï¼Œå› æ­¤ï¼š åŒä¸€å¹³é¢çš„ä»»æ„ä¸€ç‚¹éƒ½æœ‰ç›¸åŒçš„æ³•å‘é‡ æ³•å‘é‡åªè¡¨ç¤ºæ–¹å‘ï¼Œä¸ä½ç½®æ— å…³ æœå‘ç›¸åŒçš„ä¸ªä¸åŒå¹³é¢çš„æ³•å‘é‡ä¹Ÿç›¸åŒå°±åƒåŒä¸€æ ¹ç­¾ç©¿èµ·æ¥çš„ç³–è‘«èŠ¦çƒä¸€æ ·ã€‚ æ³•å‘é‡çš„å†™å…¥è®¡ç®—å¥½çš„æ³•å‘é‡å’Œå…¶ä»–attributeç±»å‹çš„å±æ€§ä¸€æ ·ï¼Œä¹Ÿéœ€è¦ä¼ ç»™é¡¶ç‚¹ç€è‰²å™¨ç¨‹åºï¼Œå…¶æ“ä½œæ–¹æ³•ç±»ä¼¼äº ColoredCube ä¸­ é¢œè‰²ç¼“å†²åŒº çš„å†™å…¥ã€‚å¦‚ç«‹æ–¹ä½“çš„æ¯ä¸ªé¡¶ç‚¹å¯¹åº”3ä¸ªæ³•å‘é‡ï¼ˆè¿™æ˜¯ç”±äºç«‹æ–¹ä½“è¡¨é¢å‚ç›´ç›¸äº¤çš„ç¼˜æ•…ï¼Œä½†æ˜¯è¡¨é¢å…‰æ»‘çš„ç‰©ä½“é€šå¸¸æ¯ä¸ªé¡¶ç‚¹åªå¯¹åº”1ä¸ªæ³•å‘é‡ï¼‰ã€‚"},{"title":"å…‰ç…§å®ç°","path":"/wiki/WebGL/chapter_08_02.html","content":"LightedCubeLightedCube Code LightedCubeè¿è¡Œæ•ˆæœshadermaininitVertexBuffersinitArrayBufferlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute vec4 a_Normal; // æ³•å‘é‡ uniform mat4 u_MvpMatrix; uniform vec3 u_LightColor; // å…‰çº¿é¢œè‰² uniform vec3 u_LightDirection; // å½’ä¸€åŒ–çš„ä¸–ç•Œåæ ‡ varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; // å¯¹æ³•å‘é‡è¿›è¡Œå½’ä¸€åŒ– vec4 â†’ vec3 vec3 normal = normalize(vec3(a_Normal)); // è®¡ç®—cosÎ¸ï¼ˆå…‰çº¿æ–¹å‘Â·æ³•å‘é‡ï¼‰ float nDotL = max(dot(u_LightDirection,normal),0.0); // è®¡ç®—åå°„å…‰é¢œè‰² ï¼ˆå…¥å°„å…‰é¢œè‰²*åŸºåº•é¢œè‰²*cosÎ¸ ï¼‰ vec3 diffuse = u_LightColor * vec3(a_Color) * nDotL; v_Color = vec4(diffuse, 1.0); `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let u_LightColor = gl.getUniformLocation(gl.program, u_LightColor); let u_LightDirection = gl.getUniformLocation(gl.program, u_LightDirection); // è®¾ç½®å…‰çº¿é¢œè‰²-ç™½è‰² gl.uniform3f(u_LightColor, 1.0, 1.0, 1.0); // è®¾ç½®å…‰çº¿æ–¹å‘-ä¸–ç•Œåæ ‡ç³»ä¸‹ // 0.25+9+16 = 25.25 let lightDirection = new Vector3([0.5, 3.0, 4.0]); lightDirection.normalize(); // å½’ä¸€åŒ– gl.uniform3fv(u_LightDirection, lightDirection.elements); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let mvpMatrix = new Matrix4(); mvpMatrix.setPerspective( 30, 1.0, 1.0, 100.0 ).lookAt( 3, 3, 7, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); let n = initVertexBuffers(gl); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.enable(gl.DEPTH_TEST); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function initVertexBuffers(gl) let vertices = new Float32Array([ 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, // v0-v1-v2-v3 front 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, -1.0, // v0-v3-v4-v5 right 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, // v0-v5-v6-v1 up -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, // v1-v6-v7-v2 left -1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0, // v7-v4-v3-v2 down 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0 // v4-v7-v6-v5 back ]); var colors = new Float32Array([ // Colors 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // v0-v1-v2-v3 front 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // v0-v3-v4-v5 right 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // v0-v5-v6-v1 up 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // v1-v6-v7-v2 left 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, // v7-v4-v3-v2 down 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0 // v4-v7-v6-v5 back ]); var normals = new Float32Array([ // Normal 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, // v0-v1-v2-v3 front 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, // v0-v3-v4-v5 right 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v5-v6-v1 up -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, // v1-v6-v7-v2 left 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, // v7-v4-v3-v2 down 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0 // v4-v7-v6-v5 back ]); var indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9, 10, 8, 10, 11, // up 12, 13, 14, 12, 14, 15, // left 16, 17, 18, 16, 18, 19, // down 20, 21, 22, 20, 22, 23 // back ]); initArrayBuffer(gl, a_Position, vertices, 3, gl.FLOAT); initArrayBuffer(gl, a_Color, colors, 3, gl.FLOAT); initArrayBuffer(gl, a_Normal, normals, 3, gl.FLOAT); let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer(gl,attribute,data,num,type) let buffer = gl.createBuffer(); let a_Attribute = gl.getAttribLocation(gl.program, attribute); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Attribute, num, type, false, 0, 0); gl.enableVertexAttribArray(a_Attribute); ä¸€äº›å°é—®é¢˜ å…¥å°„å…‰æ–¹å‘è®¾ç½®åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç­”ï¼š è¡¨ç¤ºå…‰ç…§æ•ˆæœæ˜¯åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹è®¡ç®—çš„ã€‚è¿™æ ·åšå¯ä»¥ä½¿ç¨‹åºæ›´ç®€å•ï¼Œä»£ç æ¯”è¾ƒç›´è§‚ã€‚ ä¸ºä»€ä¹ˆåœ¨å…¥å°„å…‰æ–¹å‘å½’ä¸€åŒ–å¤„ç†åœ¨Jsä¸­ï¼Œæ³•å‘é‡å½’ä¸€åŒ–å¤„ç†åœ¨ç€è‰²å™¨å†…ï¼Ÿç­”ï¼š å…¥å°„å…‰æ–¹å‘ u_LightDirection æ˜¯ uniform ç±»å‹ï¼Œé€‚ç”¨äºæ‰€æœ‰é¡¶ç‚¹ï¼Œæ²¡æœ‰å¿…è¦åœ¨ç€è‰²å™¨ä¸­é€é¡¶ç‚¹é‡å¤å½’ä¸€åŒ–æ“ä½œï¼Œå› æ­¤å½’ä¸€åŒ–åä¼ å…¥å³å¯ã€‚ æ³•å‘é‡ a_Normal æ˜¯ attribute ç±»å‹ï¼Œæ”¾åœ¨ç¼“å†²åŒºä¼ å…¥ï¼Œæ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰å¯¹åº”çš„æ³•å‘é‡å€¼ï¼Œéœ€è¦åœ¨ç€è‰²å™¨å†…é€é¡¶ç‚¹çš„å¤„ç†ã€‚ æ³•å‘é‡å’Œå…¥å°„å…‰å‘é‡ç‚¹ç§¯å€¼å°äº0ï¼Œè¯´æ˜å‡ºç°äº†ä»€ä¹ˆæƒ…å†µï¼Ÿç­”ï¼š cosÎ¸0ï¼Œè¯´æ˜Î¸90Â°ï¼Œå³ å…‰çº¿ç…§åœ¨äº†è¡¨é¢çš„èƒŒé¢ä¸Šã€‚ Shaderå’ŒJsä¸­çš„normalizeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸShaderä¸­ vec3 normal = normalize(vec3(a_Normal));normalizeä¸ºGLSL ESçš„å†…ç½®å‡½æ•°ï¼Œæ¥å—å¹¶è¿”å› vec3 ç±»å‹å‚æ•°ã€‚ Jsä¸­ let lightDirection = new Vector3([0.5, 3.0, 4.0]);lightDirection.normalize(); // å½’ä¸€åŒ–gl.uniform3fv(u_LightDirection, lightDirection.elements);Vector3å¯¹è±¡çš„normalizeå‡½æ•°è¿”å› Float32Array ç±»å‹å‚æ•°ï¼Œå¹¶å­˜å‚¨åœ¨Vectorå¯¹è±¡çš„ elements å±æ€§ä¸­ã€‚ LightedCube_animation LightedCube_animationè¿è¡Œæ•ˆæœæ³¨æ„åœ¨Cubeé¡¶ç‚¹Positionæ—‹è½¬å˜æ¢æ—¶ï¼Œä¹Ÿéœ€è¦å¯¹é¡¶ç‚¹çš„æ³•å‘é‡è¿›è¡Œæ—‹è½¬å˜æ¢ã€‚Shadermainlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_NormalMatrix; // æ³•å‘é‡å˜æ¢çš„æ¨¡å‹çŸ©é˜µ uniform vec3 u_LightColor; uniform vec3 u_LightDirection; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; vec3 normal = vec3(u_NormalMatrix * a_Normal); float nDotL = max(dot(normal,u_LightDirection),0.0); vec3 diffuse = u_LightColor * vec3(a_Color) * nDotL; v_Color = vec4(diffuse,1.0); `;let u_LightColor = gl.getUniformLocation(gl.program, u_LightColor); let u_LightDirection = gl.getUniformLocation(gl.program, u_LightDirection); gl.uniform3f(u_LightColor,1.0, 1.0, 1.0); let lightDirection = new Vector3([0.5, 3.0, 4.0]); lightDirection.normalize(); gl.uniform3fv(u_LightDirection, lightDirection.elements); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); let mvMatrix = new Matrix4(); let normalMatrix = new Matrix4(); mvMatrix.setPerspective( 30, 1.0, 1.0, 100.0 ).lookAt( 3, 3, 7, 0, 0, 0, 0, 1, 0 ); let modelMatrix = new Matrix4(); let mvpMatrix = new Matrix4(); let n = initVertexBuffers(gl); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.enable(gl.DEPTH_TEST); let angle = 0; let tick = function () // p * v * m angle = animation(angle); modelMatrix.setRotate(angle, 0, 1, 0); mvpMatrix.set(mvMatrix).multiply(modelMatrix); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); normalMatrix.setInverseOf(modelMatrix); normalMatrix.transpose(); gl.uniformMatrix4fv(u_NormalMatrix, false, normalMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0); requestAnimationFrame(tick); tick(); ç¯å¢ƒå…‰ä¸‹çš„æ¼«åå°„LightedCubeå­˜åœ¨çš„é—®é¢˜ Cubeçš„å³ä¾§é¢å‡ ä¹æ˜¯é»‘è‰²çš„ å®é™…å…‰ç…§ä¸‹ç‰©ä½“å„é¢äº®åº¦å·®å¼‚ä¸ä¼šè¿™ä¹ˆå¤§ LightedCubeä¸­ä½¿ç”¨çš„æ˜¯ å¹³è¡Œå…‰æº ï¼Œæ²¡æœ‰è¢«ç›´å°„å…‰ç…§å°„åˆ°çš„é¢æŒ‰ç†æ¥è¯´åº”è¯¥è¢« ç¯å¢ƒå…‰ ç…§äº®ã€‚ç”±äºç¯å¢ƒå…‰æ˜¯ç”±å…¶ä»–ç‰©ä½“åå°„äº§ç”Ÿçš„ï¼Œå› æ­¤ç¯å¢ƒå…‰çš„å¼ºåº¦é€šå¸¸æ¯”è¾ƒå¼±ã€‚ LightedCube_ambient åªæœ‰å¹³è¡Œå…‰çš„å…‰ç…§æ•ˆæœ æ·»åŠ äº†ç¯å¢ƒå…‰çš„å…‰ç…§æ•ˆæœ Shadermainlet VSHADER_SOURCE = ` ... uniform vec3 u_AmbientLight; //ç¯å¢ƒå…‰é¢œè‰² void main ... // è®¡ç®—ç¯å¢ƒå…‰äº§ç”Ÿçš„åå…‰é¢œè‰² vec3 ambient = u_AmbientLight * a_Color.rbg; v_Color = vec4((diffuse + ambient), 1.0); `;let u_AmbientLight = gl.getUniformLocation(gl.program, u_AmbientLight);gl.uniform3f(u_AmbientLight, 0.2, 0.2, 0.2); è¿åŠ¨ç‰©ä½“çš„å…‰ç…§æ•ˆæœè¿åŠ¨ç‰©ä½“çš„æ³•å‘é‡ å½“å¯¹ç‰©ä½“è¿›è¡Œå˜æ¢æ—¶ï¼Œéœ€è¦è€ƒè™‘å…¶æ³•å‘é‡çš„å˜æ¢æƒ…å†µã€‚å¹³ç§»å˜æ¢ ä¸ä¼šæ”¹å˜æ³•å‘é‡æ—‹è½¬å˜æ¢ ä¼šæ”¹å˜æ³•å‘é‡ç¼©æ”¾å˜æ¢ æœ‰å¯èƒ½ä¼šæ”¹å˜æ³•å‘é‡ï¼Œå­˜åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå¦‚ï¼šæ‰€æœ‰è½´ç­‰æ¯”ç¼©æ”¾å‘ä¸¤ä¸ªè½´çš„æ–¹å‘ç­‰æ¯”ç¼©æ”¾ é­”æ³•çŸ©é˜µï¼šé€†è½¬ç½®çŸ©é˜µ å¦‚ä½•è®¡ç®—å˜æ¢ä¹‹åçš„æ³•å‘é‡å‘¢ï¼Ÿç­”ï¼š å°†å˜æ¢ä¹‹å‰çš„æ³•å‘é‡ä¹˜ä»¥ ModelMatrixçš„é€†è½¬ç½®çŸ©é˜µï¼ˆinverse transpose matrixï¼‰ å³å¯ã€‚ é€†çŸ©é˜µï¼ˆinverse matrixï¼‰å¦‚æœçŸ©é˜µMçš„é€†çŸ©é˜µæ˜¯Rï¼Œåˆ™ R*MM*Rå•ä½çŸ©é˜µlet modelMatrix = new Matrix4(); //æ¨¡å‹çŸ©é˜µlet normalMatrix = new Matrix4(); //æ³•å‘é‡å˜æ¢çŸ©é˜µ...normalMatrix.setInverseOf(normalMatrix); // æ±‚é€†çŸ©é˜µnormalMatrix.transpose(); //è½¬ç½®å¤„ç† LightedTranslatedRotatedCube æ²¡æœ‰å¯¹æ³•å‘é‡è¿›è¡Œå˜æ¢å¤„ç†çš„æ•ˆæœ å¯¹æ³•å‘é‡è¿›è¡Œå˜æ¢å¤„ç†çš„æ•ˆæœ Shadermainlet VSHADER_SOURCE = ` ... uniform mat4 u_NormalMatrix; //æ³•å‘é‡çš„æ¨¡å‹çŸ©é˜µ void main() ... vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal)); ... `;let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); let mvpMatrix = new Matrix4(); let modelMatrix = new Matrix4(); let normalMatrix = new Matrix4(); modelMatrix.setTranslate( 0,0.9,0 ).rotate( 90, 0, 0, 1 ); mvpMatrix.setPerspective( 30, 1.0, 1.0, 100.0 ).lookAt( 3, 3, 7, 0, 0, 0, 0, 1, 0 ).multiply(modelMatrix); normalMatrix.setInverseOf(modelMatrix); normalMatrix.transpose(); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); gl.uniformMatrix4fv(u_NormalMatrix, false, normalMatrix.elements); ç‚¹å…‰æºå…‰ç‚¹å…‰æºå…‰çš„æ–¹å‘ ç‚¹å…‰æºå…‰çš„æ–¹å‘ä¸æ˜¯ æ’å®šä¸å˜ çš„ï¼Œè€Œæ˜¯ æ ¹æ®æ¯ä¸ªé¡¶ç‚¹çš„ä½ç½® é€ä¸€è®¡ç®—çš„ã€‚ è®¡ç®—ç‚¹å…‰æºå…‰çº¿æ–¹å‘éœ€è¦å“ªäº›å€¼å‘¢ï¼Ÿå›é¡¾å¹³è¡Œå…‰æºæ–¹å‘çš„è·å–let VSHADER_SOURCE = ` ... uniform vec3 u_LightDirection; // ç›´æ¥å®šä¹‰å¹¶ä»å¤–ç•Œä¼ å…¥ï¼ˆä¸–ç•Œåæ ‡ç³»ä¸‹ï¼‰ ...`éœ€è¦ä¸¤ä¸ªå€¼ï¼š ç‚¹å…‰æºä½ç½® u_LightPositioné¡¶ç‚¹ä½ç½® a_Positionè®¡ç®—é¡¶ç‚¹çš„ä¸–ç•Œåæ ‡çš„æ¨¡å‹çŸ©é˜µ u_ModelMatrixé¡¶ç‚¹å¯¹åº”æ³•å‘é‡çš„æ¨¡å‹çŸ©é˜µ u_NormalMatrixå¦‚ä½•è®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„ç‚¹å…‰æºæ–¹å‘å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Ÿç­”ï¼š ä½ å¯èƒ½å·²ç»çŸ¥é“ u_MvpMatrix æ˜¯åšä»€ä¹ˆç”¨çš„äº†ï¼Œå®ƒä¼šè®¾ç½®ä¸€ä¸ªè§†ç‚¹ï¼Œå¹¶è®¡ç®—å‡ºä¼ å…¥çš„åæ ‡ a_Position ç›¸å¯¹è§†ç‚¹çš„ç»˜åˆ¶åæ ‡ï¼Œ ç‚¹å…‰æºå…‰çº¿æ˜¯å’Œ ç‚¹å…‰æºå’Œç‰©ä½“é¡¶ç‚¹çš„ç›¸å¯¹ä½ç½® æœ‰å…³çš„ï¼Œå³ä¸¤ä¸ªç‰©ä½“çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼Œè¿™ä¸ªä½ç½®å…³ç³»æ˜¯ ç»å¯¹çš„ï¼Œä¸è§†ç‚¹åæ ‡ç³»æ— å…³ï¼Œ å› æ­¤å°±éœ€è¦ä¸€ä¸ª ç»å¯¹çš„ç©ºé—´ æ¥ä¸ºå®ƒä»¬åšåŸºå‡†ï¼Œè¿™å°±æ˜¯ ä¸–ç•Œåæ ‡ç³»ã€‚ å°±åƒå†¬å¤©ä½ ä»å¯’å†·çš„å¤–é¢è¿›å…¥æ­£å¸¸æ°”æ¸©çš„å±‹å­ä¸€æ ·ï¼Œä½ å¯èƒ½è®¤ä¸ºå±‹å†…æ°”æ¸©æ¯”å®é™…çš„è¦é«˜ä¸€äº›ï¼Œä¸–ç•Œåæ ‡ç³»å°±åƒæ¸©åº¦è®¡ä¸€æ ·ï¼Œå‘Šè¯‰ä½ ç»å¯¹ç°å®æ˜¯ä»€ä¹ˆã€‚è§†ç‚¹åæ ‡ï¼šæˆ‘ç›¸æ¯”ä¹‹å‰æ„Ÿè§‰æœ‰äº†å¾ˆå¤§çš„è¿›æ­¥ï¼Œæˆ‘æ­£åœ¨é€æ¸ç†è§£ä¸€åˆ‡ï¼ä¸–ç•Œåæ ‡ï¼šå“¦ï¼Ÿä½ æ˜¯è¿™æ ·è®¤ä¸ºçš„å—ï¼Ÿ Step1è®¡ç®—é¡¶ç‚¹åœ¨ ä¸–ç•Œåæ ‡ç³» ä¸­çš„åæ ‡ï¼Œè®¡ç®— ä¸–ç•Œé¡¶ç‚¹ ç›¸å¯¹åº”çš„ æ³•å‘é‡ã€‚Step2è®¡ç®—é¡¶ç‚¹å¤„ ç‚¹å…‰æºæ–¹å‘ ï¼šè®¾ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œé¡¶ç‚¹å‘é‡ä¸º OAï¼Œç‚¹å…‰æºå‘é‡ä¸º OBåˆ™é¡¶ç‚¹å¤„ç‚¹å…‰æºå…‰çº¿å‘é‡ä¸º BA OA - OBå³ é¡¶ç‚¹ä¸–ç•ŒçŸ¢é‡ - ç‚¹å…‰æºä¸–ç•ŒçŸ¢é‡æ¼«åå°„å…‰çš„æ–¹å‘ä¸å…¥å°„å…‰æ–¹å‘ç›¸åï¼Œå› æ­¤æœ€ç»ˆåå°„å…‰çº¿ ç‚¹å…‰æºä¸–ç•ŒçŸ¢é‡ - é¡¶ç‚¹ä¸–ç•ŒçŸ¢é‡ PointLightedCube PointLightedCubeè¿è¡Œæ•ˆæœShadermainlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_ModelMatrix; uniform mat4 u_NormalMatrix; uniform vec3 u_LightColor; // ç‚¹å…‰æºé¢œè‰² uniform vec3 u_LightPosition; // ç‚¹å…‰æºä½ç½® uniform vec3 u_AmbientLight; // ç¯å¢ƒå…‰é¢œè‰² varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; vec3 normal = vec3(u_NormalMatrix * a_Normal); //è®¡ç®—æ³•å‘é‡ vec3 vertexPosition = vec3(u_ModelMatrix * a_Position); //è®¡ç®—ä¸–ç•Œåæ ‡ vec3 lightDirection = normalize( u_LightPosition - vertexPosition ); //è®¡ç®—å…‰çº¿æ–¹å‘ float nDotl = max(dot(lightDirection,normal),0.0); //è®¡ç®—cosÎ¸ vec3 diffuse = u_LightColor * a_Color.rbg * nDotl; //æ¼«åå°„ vec3 ambient = u_AmbientLight * a_Color.rbg; //ç¯å¢ƒåå°„ v_Color = vec4( diffuse + ambient , 1.0); `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); let u_LightColor = gl.getUniformLocation(gl.program, u_LightColor); let u_LightPosition = gl.getUniformLocation(gl.program, u_LightPosition); let u_AmbientLight = gl.getUniformLocation(gl.program, u_AmbientLight); let mvpMatrix = new Matrix4(); let modelMatrix = new Matrix4(); let normalMatrix = new Matrix4(); modelMatrix.setRotate(90, 0, 1, 0); mvpMatrix.setPerspective( 30, 1, 1, 100 ).lookAt( 6, 6, 14, 0, 0, 0, 0, 1, 0 ).multiply(modelMatrix); normalMatrix.setInverseOf(modelMatrix); normalMatrix.transpose(); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements); gl.uniformMatrix4fv(u_NormalMatrix, false, normalMatrix.elements); gl.uniform3f(u_LightColor, 1.0, 1.0, 1.0); gl.uniform3f(u_AmbientLight, 0.2, 0.2, 0.2); gl.uniform3f(u_LightPosition, 2.3, 4.0, 3.5); let n = initVertexBuffers(gl); gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.enable(gl.DEPTH_TEST); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0); é€ç‰‡å…ƒå…‰ç…§PointLightCube_animation å½“ç‰©ä½“è¿åŠ¨æ—¶ï¼Œä¼šå‘ç° ç«‹æ–¹ä½“è¡¨é¢ä¸Šæœ‰ä¸è‡ªç„¶çš„çº¿æ¡ã€‚è¿™æ˜¯ç‰‡å…ƒçš„é¢œè‰²æ˜¯ ç”±é¡¶ç‚¹é¢œè‰²å†…æ’å¾—å‡ºçš„ ï¼Œå› æ­¤ä¸å¤Ÿé€¼çœŸã€‚ é€ç‰‡ç‰‡å…ƒæ“ä½œå®é™…ä¸Šå°±æ˜¯æŠŠåå°„å…‰é¢œè‰²è®¡ç®—çš„æ­¥éª¤æå–åˆ°ç‰‡å…ƒç€è‰²å™¨ä¸­ã€‚ PointLightedCube_perFragment å¯ä»¥çœ‹åˆ°é€ç‰‡å…ƒå¤„ç†çš„ç‰©ä½“è¡¨é¢é¢œè‰²è¿‡æ¸¡æ›´åŠ è‡ªç„¶ã€‚ é€é¡¶ç‚¹å¤„ç† é€ç‰‡å…ƒå¤„ç† ä¸€äº›å°é—®é¢˜å°†è®¡ç®—è¿‡ç¨‹æå–åˆ°ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œéœ€è¦å‡†å¤‡å“ªäº›æ•°æ®ï¼Ÿç­”ï¼š ç‰‡å…ƒä¸–ç•Œåæ ‡ ç‰‡å…ƒå¤„æ³•å‘é‡ æŠŠé¡¶ç‚¹åæ ‡åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œå°†æ³•å‘é‡è¿›è¡Œç›¸åº”è½¬æ¢ï¼Œè¿™æ ·é€šè¿‡varyingä¼ å…¥çš„åŒåå˜é‡å°±å·²ç»æ˜¯å†…æ’åçš„é€ç‰‡å…ƒå€¼äº†ã€‚ æ³•å‘é‡ä¼ å…¥ç‰‡å…ƒç€è‰²å™¨åä¸ºä»€ä¹ˆåˆè¦è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Ÿç­”ï¼š å› ä¸ºå†…æ’ä¹‹åçš„æ³•å‘é‡å¯èƒ½ä¸å†æ˜¯1.0äº†ã€‚ Vertex_ShaderFragment_Shaderlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_ModelMatrix; uniform mat4 u_NormalMatrix; varying vec3 v_Position; varying vec3 v_Normal; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; v_Position = vec3(u_ModelMatrix * a_Position); //è®¡ç®—ä¸–ç•Œåæ ‡ v_Normal = normalize(vec3(u_NormalMatrix * a_Normal)); //è®¡ç®—æ³•å‘é‡ v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform vec3 u_LightColor; // ç‚¹å…‰æºé¢œè‰² uniform vec3 u_LightPosition; // ç‚¹å…‰æºä½ç½® uniform vec3 u_AmbientLight; // ç¯å¢ƒå…‰é¢œè‰² varying vec3 v_Position; varying vec3 v_Normal; varying vec4 v_Color; void main() // éœ€è¦é‡æ–°å¯¹æ³•çº¿è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå› ä¸ºå†…æ’ä¹‹åé•¿åº¦ä¸ä¸€å®šæ˜¯1.0 vec3 normal = normalize(v_Normal); vec3 lightDirection = normalize( u_LightPosition - v_Position ); //è®¡ç®—å…‰çº¿æ–¹å‘ float nDotl = max(dot(lightDirection,normal),0.0); //è®¡ç®—cosÎ¸ vec3 diffuse = u_LightColor * v_Color.rbg * nDotl; //æ¼«åå°„ vec3 ambient = u_AmbientLight * v_Color.rbg; //ç¯å¢ƒåå°„ gl_FragColor = vec4( diffuse + ambient , 1.0); `; ä¸€äº›å°å®éªŒ å¤šä¸ªç‚¹å…‰æºé€é¡¶ç‚¹å’Œé€ç‰‡å…ƒç»˜åˆ¶å¯¹æ¯” é€é¡¶ç‚¹ç»˜åˆ¶çƒä½“ï¼šè¡¨é¢é¢œè‰²æ–‘é©³ é€ç‰‡å…ƒç»˜åˆ¶çƒä½“ï¼šé¢œè‰²è¿‡æ¸¡æ›´è‡ªç„¶"},{"title":"å±‚æ¬¡æ¨¡å‹","path":"/wiki/WebGL/chapter_09_01.html","content":"å¤æ‚æ¨¡å‹å¬åˆ°å¤æ‚ä¸¤ä¸ªå­—åˆ«å®³æ€•ï¼Œå†å¤æ‚çš„å¤§æ¨¡å‹éƒ½æ˜¯ç”±ç®€å•çš„å°æ¨¡å‹ç»„æˆå“’ ä»¥æœºå™¨äººæ‰‹è‡‚ä¸ºä¾‹ å°±åƒæ‹¼ä¹é«˜ä¸€æ ·ï¼Œå¤§æ¨¡å‹çš„çš„å•ä½å°±æ˜¯è¿™äº›å°é›¶ä»¶ï¼Œä½ éœ€è¦çŸ¥é“çš„å°±æ˜¯ æœ‰å“ªäº›é›¶ä»¶ å’Œ æ‹¼æ¥å…³ç³»ã€‚ä¹é«˜ç§¯æœ¨è¯´æ˜ä¹¦è¦å®ç°è¿™æ ·ä¸€ä¸ªç®€å•çš„æœºå™¨äººæ‰‹è‡‚ï¼Œä½ éœ€è¦è€ƒè™‘ä¸€ä¸‹è¿™æ ·å‡ ä¸ªå…³èŠ‚ï¼šéƒ¨ä½æ—‹è½¬è½´å¸¦åŠ¨éƒ¨ä½æ— å½±å“éƒ¨ä½ä¸Šè‡‚è‚©å…³èŠ‚å‰è‡‚ã€æ‰‹æŒã€æ‰‹æŒ‡å‰è‡‚è‚˜å…³èŠ‚æ‰‹æŒã€æ‰‹æŒ‡ä¸Šè‡‚æ‰‹æŒè…•å…³èŠ‚æ‰‹æŒ‡ä¸Šè‡‚ã€å‰è‡‚æ‰‹æŒ‡ä¸Šè‡‚ã€å‰è‡‚ã€æ‰‹æŒ å±‚æ¬¡ç»“æ„æ¨¡å‹ æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯æŒ‰ å±‚æ¬¡é¡ºåº-ç”±é«˜åˆ°ä½ é€ä¸€ç»˜åˆ¶ã€‚ä¸‰ç»´æ¨¡å‹å„ä¸ªéƒ¨ä»¶çš„è¿åŠ¨æœ€é‡è¦çš„å°±æ˜¯å®ç°ï¼š éƒ¨ä»¶Aè½¬åŠ¨å¸¦åŠ¨éƒ¨ä»¶Bè½¬åŠ¨ å•å…³èŠ‚æ¨¡å‹arm2 å‰è‡‚joint1 è‚˜å…³èŠ‚arm1 ä¸Šè‡‚å‚ç›´äº¤ç‚¹ è‚©å…³èŠ‚å•å…³èŠ‚æ¨¡å‹å˜æ¢çš„æ ¸å¿ƒå°±æ˜¯ joint1-è‚˜å…³èŠ‚ï¼šä¸Šè‡‚ ä»¥è‚˜å…³èŠ‚æ‰€åœ¨çš„ yè½´æ—‹è½¬å‰è‡‚ ä»¥è‚˜å…³èŠ‚æ‰€åœ¨çš„ zè½´æ—‹è½¬ JointMode JointModeè¿è¡Œç»“æœshadersmainbufferkeydowndrawlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_NormalMatrix; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; vec3 lightDirection = normalize(vec3(0.0,0.5,0.7)); vec4 color = vec4( 0.0, 0.4, 0.4, 1.0); vec3 normal = normalize((u_NormalMatrix * a_Normal).xyz); float nDotL = max(dot(normal,lightDirection ),0.0); v_Color = vec4(color.rgb * nDotL + vec3(0.3),color.a); `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); //set the vertex information gl.clearColor(0.0, 0.0, 0.0, 1.0); gl.enable(gl.DEPTH_TEST); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); let vpMatrix = new Matrix4(); vpMatrix.setPerspective( 50, 1.0, 1.0, 100.0 ).lookAt( 20, 10, 30, 0, 0, 0, 0, 1, 0 ); document.onkeydown = function (ev) keydown(gl,ev,n,u_MvpMatrix,u_NormalMatrix,vpMatrix); draw(gl,n,u_MvpMatrix,u_NormalMatrix,vpMatrix);function initVertexBuffers(gl) var vertices = new Float32Array([ 1.5, 10.0, 1.5, -1.5, 10.0, 1.5, -1.5, 0.0, 1.5, 1.5, 0.0, 1.5, // v0-v1-v2-v3 front 1.5, 10.0, 1.5, 1.5, 0.0, 1.5, 1.5, 0.0,-1.5, 1.5, 10.0,-1.5, // v0-v3-v4-v5 right 1.5, 10.0, 1.5, 1.5, 10.0,-1.5, -1.5, 10.0,-1.5, -1.5, 10.0, 1.5, // v0-v5-v6-v1 up -1.5, 10.0, 1.5, -1.5, 10.0,-1.5, -1.5, 0.0,-1.5, -1.5, 0.0, 1.5, // v1-v6-v7-v2 left -1.5, 0.0,-1.5, 1.5, 0.0,-1.5, 1.5, 0.0, 1.5, -1.5, 0.0, 1.5, // v7-v4-v3-v2 down 1.5, 0.0,-1.5, -1.5, 0.0,-1.5, -1.5, 10.0,-1.5, 1.5, 10.0,-1.5 // v4-v7-v6-v5 back ]); // Normal var normals = new Float32Array([ 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, // v0-v1-v2-v3 front 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, // v0-v3-v4-v5 right 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v5-v6-v1 up -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, // v1-v6-v7-v2 left 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, // v7-v4-v3-v2 down 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0 // v4-v7-v6-v5 back ]); // Indices of the vertices var indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]); initArrayBuffer(gl, a_Position, vertices, 3, gl.FLOAT); initArrayBuffer(gl, a_Normal, normals, 3, gl.FLOAT); let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer(gl, attribute, data, num, type) let buffer = gl.createBuffer(); let a_Attribute = gl.getAttribLocation(gl.program, attribute); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Attribute, num, type, false, 0, 0); gl.enableVertexAttribArray(a_Attribute);let ANGLE_STEP = 5.0; // the increments of rotation anglelet g_arm1Angle = -90.0; let g_joint1Angle = 0.0;function keydown(gl, ev, n, u_MvpMatrix, u_NormalMatrix, vpMatrix) // â†â†’ï¼šarm1 â†‘â†“ï¼šarm2 switch (ev.keyCode) case 37: g_arm1Angle = (g_arm1Angle - ANGLE_STEP) % 360; break; //â† case 38: if (g_joint1Angle 135.0) g_joint1Angle += ANGLE_STEP; break; //â†‘ case 39: g_arm1Angle = (g_arm1Angle + ANGLE_STEP) % 360; break; //â†’ case 40: if (g_joint1Angle -135.0) g_joint1Angle -= ANGLE_STEP; break; //â†“ default: break; draw(gl,n,u_MvpMatrix,u_NormalMatrix,vpMatrix); let g_modelMatrix = new Matrix4(); // Model Matrixlet g_mvpMatrix = new Matrix4();// count modelMatrixfunction draw(gl,n,u_MvpMatrix,u_NormalMatrix,vpMatrix) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // Arm1 let arm1Length = 10.0; g_modelMatrix.setTranslate(0.0, -12.0, 0.0); g_modelMatrix.rotate(g_arm1Angle, 0.0, 1.0, 0.0); drawBox(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix); // Arm2 g_modelMatrix.translate(0.0, arm1Length, 0.0); g_modelMatrix.rotate(g_joint1Angle, 0.0, 0.0, 1.0); g_modelMatrix.scale(1.3, 1.0, 1.3); drawBox(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix);let g_normalMatrix = new Matrix4();// count mvpMatrix and normalMatrix , then draw the resultfunction drawBox(gl,n,u_MvpMatrix,u_NormalMatrix,vpMatrix) g_mvpMatrix.set( vpMatrix ).multiply( g_modelMatrix ); gl.uniformMatrix4fv(u_MvpMatrix, false, g_mvpMatrix.elements); g_normalMatrix.setInverseOf(g_modelMatrix); g_normalMatrix.transpose(); gl.uniformMatrix4fv(u_NormalMatrix, false, g_normalMatrix.elements); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0); å¤šèŠ‚ç‚¹æ¨¡å‹finger1finger2 ä¸¤æ ¹æ‰‹æŒ‡palm æ‰‹æŒarm2 å‰è‡‚arm1 ä¸Šè‡‚base åŸºåº§å˜é‡åå¯¹åº”éƒ¨ä½æ“æ§é”®g_arm1Angleä¸Šè‡‚â†â†’g_joint1Angleè‚˜å…³èŠ‚â†‘â†“g_joint2Angleè…•å…³èŠ‚xzg_joint3AngleæŒ‡å¼ è§’cv MultiJointModel MultiJointModelè¿è¡Œæ•ˆæœkeydowndrawdrawBoxfunction keydown(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix, ev) switch (ev.keyCode) case 37: //â† arm1 clockwise rotation g_arm1Angle = (g_arm1Angle - ANGLE_STEP) % 360; break; case 38: //â†‘ joint1 open if (g_joint1Angle joint1_limit) g_joint1Angle += ANGLE_STEP; break; case 39: //â†’ arm1 anticlockwise rotation g_arm1Angle = (g_arm1Angle + ANGLE_STEP) % 360; break; case 40: //â†“ joint1 close if (g_joint1Angle -joint1_limit) g_joint1Angle -= ANGLE_STEP; break; case 67: //c the negative rotation of joint3 if (g_joint3Angle -joint3_limit) g_joint3Angle -= ANGLE_STEP; break; case 86: //v the positive rotation of joint3 if (g_joint3Angle joint3_limit) g_joint3Angle += ANGLE_STEP; break; case 88: //x the position rotattion of joint2 g_joint2Angle = (g_joint2Angle + ANGLE_STEP) % 360; break; case 90: //z the negative rotattion of joint2 g_joint2Angle = (g_joint2Angle - ANGLE_STEP) % 360; break; default: break; draw(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix);let baseHeight = 2.0;let arm1Length = 10.0;let arm2Length = 10.0;let palmLength = 2.0;function draw(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // base g_modelMatrix.setTranslate(0, -12, 0); drawBox(gl, n, 10.0, baseHeight, 10.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // arm1 g_modelMatrix.translate(0, baseHeight, 0); g_modelMatrix.rotate(g_arm1Angle, 0, 1, 0); drawBox(gl, n, 3.0, arm1Length, 3.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // arm2 g_modelMatrix.translate(0, arm1Length, 0); g_modelMatrix.rotate(g_joint1Angle, 0, 0, 1); drawBox(gl, n, 4.0, arm2Length, 4.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // palm g_modelMatrix.translate(0, arm2Length, 0); g_modelMatrix.rotate(g_joint2Angle, 0, 1, 0); drawBox(gl, n, 2.0, palmLength, 6.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // fingers g_modelMatrix.translate(0, palmLength, 0); // finger1 pushMatrix(g_modelMatrix); g_modelMatrix.translate(0, 0, 2.0); g_modelMatrix.rotate(g_joint3Angle, 1, 0, 0); drawBox(gl, n, 1.0, 2.0, 1.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); g_modelMatrix = popMatrix(); // finger2 g_modelMatrix.translate(0.0, 0.0, -2.0); g_modelMatrix.rotate(-g_joint3Angle, 1, 0, 0); drawBox(gl, n, 1.0, 2.0, 1.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); let g_matrixStack = []; //Array for storing matrixfunction pushMatrix(m) let m2 = new Matrix4(m); g_matrixStack.push(m2);function popMatrix() return g_matrixStack.pop();function drawBox(gl, n, width, height, depth, vpMatrix, u_MvpMatrix, u_NormalMatrix) pushMatrix(g_modelMatrix); g_modelMatrix.scale(width, height, depth); g_mvpMatrix.set(vpMatrix).multiply(g_modelMatrix); g_normalMatrix.setInverseOf(g_modelMatrix); g_normalMatrix.transpose(); gl.uniformMatrix4fv(u_MvpMatrix, false, g_mvpMatrix.elements); gl.uniformMatrix4fv(u_NormalMatrix, false, g_normalMatrix.elements); gl.drawElements(gl.TRIANGLES,n,gl.UNSIGNED_BYTE,0); g_modelMatrix = popMatrix(); ç»˜åˆ¶éƒ¨ä»¶drawSegments MultiJoinModelæ–¹æ³•æ¦‚æ‹¬æ€»ä½“æ¥è¯´èšç„¦äº æ¨¡å‹çŸ©é˜µï¼šä¸€åˆ‡éƒ¨ä»¶çš„ ç¼“å†²åŒºæ•°æ® éƒ½ä¸€æ ·é€šè¿‡æ”¹å˜ æ¨¡å‹çŸ©é˜µ æ¥ç»˜åˆ¶å‡ºå¤–å½¢ä¸åŒçš„éƒ¨ä»¶ä½å±‚çº§ç»˜åˆ¶ä½¿ç”¨çš„æ¨¡å‹çŸ©é˜µéœ€è¦ åŸºäº é«˜å±‚çº§çš„æ¨¡å‹çŸ©é˜µéœ€è¦å¯¹å¤šä¸ªéƒ¨ä»¶è¿›è¡Œç¼©æ”¾å˜æ¢æ—¶ï¼Œéœ€è¦ä½¿ç”¨ çŸ©é˜µç®¡ç†æ ˆç»˜åˆ¶éƒ¨ä»¶çš„æ–¹æ³•æœ‰å¦‚ä¸‹çš„ç‰¹æ€§ï¼šå¯¹æ¯ä¸€ä¸ªéƒ¨ä»¶éƒ½å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„ ç¼“å†²åŒºå¯¹è±¡ å­˜å‚¨å¯¹åº”é¡¶ç‚¹æ•°æ®å„ä¸ªéƒ¨ä»¶å¯ä»¥æ ¹æ®éƒ¨ä»¶ç‰¹æ€§é€‰æ‹©æ€§ å…±äº« æŸäº›æ•°æ® MultiJointModel_segment maindrawdrawBox/SegmentinitBuffersä¸åŒç‚¹åœ¨äºsegmentæ–¹æ³•åœ¨mainä¸­å°±å¼•å…¥äº† a_Positionï¼Œå› ä¸ºä¹‹åéœ€è¦ä½¿ç”¨ä¸åŒéƒ¨ä»¶çš„ åæ ‡ç¼“å†²åŒºæ•°æ® ã€‚ MultiJoinModelfunction main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); gl.clearColor(0, 0, 0, 1); gl.enable(gl.DEPTH_TEST); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); let vpMatrix = new Matrix4(); vpMatrix.setPerspective( 50, 1, 1, 100 ).lookAt( 20, 10, 30, 0, 0, 0, 0, 1, 0 ); document.onkeydown = function (ev) keydown(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix, ev); draw(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix); MultiJointModel_segmentfunction main() ... let a_Position = gl.getAttribLocation(gl.program, a_Position); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_NormalMatrix = gl.getUniformLocation(gl.program, u_NormalMatrix); document.onkeydown = function (ev) keydown(gl, ev, n, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); draw(gl, n, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); ä¸åŒç‚¹åœ¨äºï¼šModelJointModel ä½¿ç”¨æ¨¡å‹çŸ©é˜µå¯¹åŒä¸€ä¸ªæ¨¡å‹è¿›è¡Œæ‹‰ä¼¸åˆ›å»ºä¸åŒçš„éƒ¨ä»¶ModelJointModel_segment ä½¿ç”¨ä¸åŒçš„ç¼“å†²åŒºæ•°æ®ç»™a_Positioné‡æ–°èµ‹å€¼ä»¥åˆ›å»ºä¸åŒçš„éƒ¨ä»¶ ModelJointModelfunction draw(gl, n, u_MvpMatrix, u_NormalMatrix, vpMatrix) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // base g_modelMatrix.setTranslate(0, -12, 0); drawBox(gl, n, 10.0, baseHeight, 10.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // arm1 g_modelMatrix.translate(0, baseHeight, 0); g_modelMatrix.rotate(g_arm1Angle, 0, 1, 0); drawBox(gl, n, 3.0, arm1Length, 3.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // arm2 g_modelMatrix.translate(0, arm1Length, 0); g_modelMatrix.rotate(g_joint1Angle, 0, 0, 1); drawBox(gl, n, 4.0, arm2Length, 4.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // palm g_modelMatrix.translate(0, arm2Length, 0); g_modelMatrix.rotate(g_joint2Angle, 0, 1, 0); drawBox(gl, n, 2.0, palmLength, 6.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); // fingers g_modelMatrix.translate(0, palmLength, 0); // finger1 pushMatrix(g_modelMatrix); g_modelMatrix.translate(0, 0, 2.0); g_modelMatrix.rotate(g_joint3Angle, 1, 0, 0); drawBox(gl, n, 1.0, 2.0, 1.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); g_modelMatrix = popMatrix(); // finger2 g_modelMatrix.translate(0.0, 0.0, -2.0); g_modelMatrix.rotate(-g_joint3Angle, 1, 0, 0); drawBox(gl, n, 1.0, 2.0, 1.0, vpMatrix, u_MvpMatrix, u_NormalMatrix); ModelJointModel_segmentfunction draw(gl, n, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); g_ModelMatrix.setTranslate(0.0, -12.0, 0.0); drawSegment(gl, n, g_baseBuffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); g_ModelMatrix.translate( 0.0, baseHeight, 0.0 ).rotate( g_arm1Angle, 0, 1, 0 ); drawSegment(gl, n, g_arm1Buffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); g_ModelMatrix.translate( 0.0, arm1Length, 0.0 ).rotate( g_joint1Angle, 0, 0, 1 ); drawSegment(gl, n, g_arm2Buffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); g_ModelMatrix.translate( 0.0, arm2Length, 0.0 ).rotate( g_joint2Angle, 0, 1, 0 ); drawSegment(gl, n, g_palmBuffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); g_ModelMatrix.translate( 0.0, palmLength, 0.0 ); pushMatrix(g_ModelMatrix); g_ModelMatrix.translate( 0.0, 0.0, 2.0 ).rotate( g_joint3Angle, 1, 0, 0 ); drawSegment(gl, n, g_fingerBuffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); g_ModelMatrix = popMatrix(); g_ModelMatrix.translate( 0.0, 0.0, -2.0 ).rotate( -g_joint3Angle, 1, 0, 0 ); drawSegment(gl, n, g_fingerBuffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix); drawBox éœ€è¦æ ¹æ®å°ºå¯¸å¯¹ç»„ä»¶è¿›è¡Œæ‹‰ä¼¸ï¼Œéœ€è¦é€šè¿‡æ ˆå¯¹æœªæ‹‰ä¼¸çš„çŸ©é˜µè¿›è¡Œä¿å­˜drawSegment éœ€è¦æ ¹æ®ç¼“å†²åŒºé‡æ–°å¯¹a_Positionèµ‹å€¼ ModelJointModelfunction drawBox(gl, n, width, height, depth, vpMatrix, u_MvpMatrix, u_NormalMatrix) pushMatrix(g_modelMatrix); g_modelMatrix.scale(width, height, depth); ... g_modelMatrix = popMatrix(); ModelJointModel_segmentfunction drawSegment(gl, n, buffer, vpMatrix, a_Position, u_MvpMatrix, u_NormalMatrix) // write segments data gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT,false, 0, 0); gl.enableVertexAttribArray(a_Position); ... segmentæ–¹æ³•ä¸åœ¨è¿™é‡Œå¯¹ a_Position è¿›è¡Œèµ‹å€¼ï¼Œè¿™é‡Œéœ€è¦å¯¹æ‰€æœ‰éƒ¨ä»¶çš„ç¼“å†²åŒºè¿›è¡Œ æ•°æ®å†™å…¥ï¼Œä½†æ˜¯ä¸å¯¹a_Positionè¿›è¡Œèµ‹å€¼ã€‚ MultiJoinModelfunction initVertexBuffers(gl) var vertices = new Float32Array([ 0.5, 1.0, 0.5, -0.5, 1.0, 0.5, -0.5, 0.0, 0.5, 0.5, 0.0, 0.5, // v0-v1-v2-v3 front 0.5, 1.0, 0.5, 0.5, 0.0, 0.5, 0.5, 0.0,-0.5, 0.5, 1.0,-0.5, // v0-v3-v4-v5 right 0.5, 1.0, 0.5, 0.5, 1.0,-0.5, -0.5, 1.0,-0.5, -0.5, 1.0, 0.5, // v0-v5-v6-v1 up -0.5, 1.0, 0.5, -0.5, 1.0,-0.5, -0.5, 0.0,-0.5, -0.5, 0.0, 0.5, // v1-v6-v7-v2 left -0.5, 0.0,-0.5, 0.5, 0.0,-0.5, 0.5, 0.0, 0.5, -0.5, 0.0, 0.5, // v7-v4-v3-v2 down 0.5, 0.0,-0.5, -0.5, 0.0,-0.5, -0.5, 1.0,-0.5, 0.5, 1.0,-0.5 // v4-v7-v6-v5 back ]); // Normal var normals = new Float32Array([ 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, // v0-v1-v2-v3 front 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, // v0-v3-v4-v5 right 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v5-v6-v1 up -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, // v1-v6-v7-v2 left 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, // v7-v4-v3-v2 down 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0 // v4-v7-v6-v5 back ]); // Indices of the vertices var indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]); initArrayBuffer(gl, a_Position, vertices, 3, gl.FLOAT); initArrayBuffer(gl, a_Normal, normals, 3, gl.FLOAT); let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer(gl, attribute, data, num, type) let buffer = gl.createBuffer(); let a_Attribute = gl.getAttribLocation(gl.program, attribute); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Attribute, num, type, false, 0, 0); gl.enableVertexAttribArray(a_Attribute); MultiJointModel_segmentfunction initVertexBuffers(gl) var vertices_base = new Float32Array([ // Base(10x2x10) ]); var vertices_arm1 = new Float32Array([ // Arm1(3x10x3) ]); var vertices_arm2 = new Float32Array([ // Arm2(4x10x4) ]); var vertices_palm = new Float32Array([ // Palm(2x2x6) ]); var vertices_finger = new Float32Array([ // Fingers(1x2x1) ]);// Normal var normals = new Float32Array([ ]);// Indices of the vertices var indices = new Uint8Array([ ]); // Write coords to buffer, but dont assign to attribute variables // Just like regist g_baseBuffer = initArrayBufferForLaterUse(gl, vertices_base, 3, gl.FLOAT); g_arm1Buffer = initArrayBufferForLaterUse(gl, vertices_arm1, 3, gl.FLOAT); g_arm2Buffer = initArrayBufferForLaterUse(gl, vertices_arm2, 3, gl.FLOAT); g_palmBuffer = initArrayBufferForLaterUse(gl, vertices_palm, 3, gl.FLOAT); g_fingerBuffer = initArrayBufferForLaterUse(gl, vertices_finger, 3, gl.FLOAT); // write normals to a buffer ,assign it to a_Normal initArrayBuffer(gl, a_Normal, normals, 3, gl.FLOAT); let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;// regist bufferfunction initArrayBufferForLaterUse(gl, data, num, type) let buffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); // set the num and type in advance // instead of use vertexAttribPointer buffer.num = num; buffer.type = type; return buffer;// regist buffer and assign function initArrayBuffer(gl, attribute, data, num, type) let buffer = gl.createBuffer(); let a_Attribute = gl.getAttribLocation(gl.program, attribute); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Attribute, num, type, false, 0, 0); gl.enableVertexAttribArray(a_Attribute);"},{"title":"é¼ æ ‡äº¤äº’","path":"/wiki/WebGL/chapter_10_01.html","content":"é¼ æ ‡æ§åˆ¶ç‰©ä½“æ—‹è½¬ç®€å•å®ç°æ€è·¯ ä¸€å¥è¯ï¼šæ ¹æ®é¼ æ ‡ç§»åŠ¨æƒ…å†µæ›´æ–°ä½œç”¨äºç‰©ä½“é¡¶ç‚¹æ—‹è½¬çŸ©é˜µã€‚è¿™æ˜¯å½“é¼ æ ‡å·¦é”®æŒ‰ä¸‹æ—¶ä¼šå‘ç”Ÿçš„ä¸€äº›æ“ä½œï¼šè®°å½•é¼ æ ‡å·¦é”® åˆå§‹åæ ‡é¼ æ ‡ç§»åŠ¨æ—¶è·å– å½“å‰åæ ‡å½“å‰åæ ‡å‡å»åˆå§‹åæ ‡è·å¾— é¼ æ ‡ä½ç§»æ ¹æ®ä½ç§»è®¡ç®— æ—‹è½¬çŸ©é˜µæ ¹æ®æ—‹è½¬çŸ©é˜µ æ›´æ–°é¡¶ç‚¹ä½ç½® RotateObject Code RotateObjectè¿è¡Œç»“æœShadersmaindrawbuffertextureeventlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec2 a_TexCoord; uniform mat4 u_MvpMatrix; varying vec2 v_TexCoord; void main() gl_Position = u_MvpMatrix * a_Position; v_TexCoord = a_TexCoord; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform sampler2D u_Sampler; varying vec2 v_TexCoord; void main() gl_FragColor = texture2D(u_Sampler, v_TexCoord); `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(Failed to init shaders); return; gl.clearColor(0, 0, 0, 1); gl.enable(gl.DEPTH_TEST); let n = initVertexBuffers(gl); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let vpMatrix = new Matrix4(); vpMatrix.setPerspective( 30, 1, 1, 100 ).lookAt( 3, 7, 7, 0, 0, 0, 0, 1, 0 ); let currentAngle = [0, 0]; if (!initEventHandlers(canvas, currentAngle)) console.log(Failed to init evnet handlers); return; if (!initTextures(gl)) console.log(failed to init texture); return; let tick = function (ev) draw(gl, n, vpMatrix, u_MvpMatrix, currentAngle); requestAnimationFrame(tick); ; tick();let g_MvpMatrix = new Matrix4();function draw(gl, n, vpMatrix, u_MvpMatrix, currentAngle) g_MvpMatrix.set(vpMatrix); g_MvpMatrix.rotate( currentAngle[0], 1, 0, 0 ).rotate( currentAngle[1], 0, 1, 0 ); gl.uniformMatrix4fv(u_MvpMatrix, false, g_MvpMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function initVertexBuffers(gl) var vertices = new Float32Array([ // Vertex coordinates 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, // v0-v1-v2-v3 front 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, -1.0, // v0-v3-v4-v5 right 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, // v0-v5-v6-v1 up -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, // v1-v6-v7-v2 left -1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0, // v7-v4-v3-v2 down 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0 // v4-v7-v6-v5 back ]); var texCoords = new Float32Array([ // Texture coordinates 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v1-v2-v3 front 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, // v0-v3-v4-v5 right 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, // v0-v5-v6-v1 up 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v1-v6-v7-v2 left 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, // v7-v4-v3-v2 down 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0 // v4-v7-v6-v5 back ]);// Indices of the vertices var indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9, 10, 8, 10, 11, // up 12, 13, 14, 12, 14, 15, // left 16, 17, 18, 16, 18, 19, // down 20, 21, 22, 20, 22, 23 // back ]); initArrayBuffer(gl, a_Position, vertices, 3, gl.FLOAT); initArrayBuffer(gl, a_TexCoord, texCoords, 2, gl.FLOAT); let indexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer(gl, attribute, data, num, type) let buffer = gl.createBuffer(); let a_Attribute = gl.getAttribLocation(gl.program, attribute); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Attribute, num, type, false, 0, 0); gl.enableVertexAttribArray(a_Attribute);function initTextures(gl) let texture = gl.createTexture(); let u_Sampler = gl.getUniformLocation(gl.program, u_Sampler); let image = new Image(); image.onload = function () loadTexture(gl, texture, u_Sampler, image); image.src = ../img/blueflower.jpg; return true;function loadTexture(gl, texture, u_Sampler, image) gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1); gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D, texture); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, image); gl.uniform1i(u_Sampler, 0);function initEventHandlers(canvas,currentAngle) let dragging = false; let lastX = -1, lastY = -1; canvas.onmousedown = function (ev) let x = ev.x, y = ev.y; let rect = ev.target.getBoundingClientRect(); if ( (rect.left = x x rect.right) (rect.top = y y rect.bottom) ) dragging = true; lastX = x; lastY = y; canvas.onmouseup = function (ev) dragging = false; canvas.onmousemove = function (ev) let x = ev.x, y = ev.y; if (dragging) let factor = 100 / canvas.height; let dx = factor * (x - lastX); let dy = factor * (y - lastY); // currentAngle[0] = Math.max(Math.min(currentAngle[0] + dy, 360), -360); // currentAngle[1] = Math.max(Math.min(currentAngle[1] + dx, 360), -360); currentAngle[0] = currentAngle[0] + dy; currentAngle[1] = currentAngle[1] + dx; lastX = x; lastY = y; return true; é€‰ä¸­ç‰©ä½“æ€è€ƒä¸€ä¸‹ï¼šå¦‚ä½•ä½¿ç”¨æ•°å­¦è¿‡ç¨‹æ¥è®¡ç®—é¼ æ ‡æ˜¯å¦æ‚¬æµ®åœ¨æŸä¸ªå›¾å½¢ä¸Šï¼Ÿ ç®€å•å®ç°æ€è·¯ ä¸€å¥è¯ï¼šé­”æœ¯æŠŠæˆï¼Œåˆ©ç”¨è¶…å‡ºäººçœ¼ååº”é€Ÿåº¦çš„åˆ·æ–°å¸§æ•°æ¥å¯¹ç‰©ä½“è¿›è¡Œåˆ‡æ¢ã€‚é¼ æ ‡å·¦é”®æŒ‰ä¸‹æ—¶ï¼šå°†ç«‹æ–¹ä½“é‡ç»˜ä¸º å•è‰² ï¼ˆå‡è®¾çº¢è‰²ï¼‰è¯»å–é¼ æ ‡ç‚¹å‡»å¤„çš„ åƒç´ é¢œè‰²å¦‚æœè¯»å–çš„é¢œè‰²æ˜¯ çº¢è‰² ï¼Œå°±åˆ¤æ–­ç‰©ä½“è¢«é€‰ä¸­å°†çº¯è‰²ç«‹æ–¹ä½“ å¤åŸé‡ç»˜ æˆåŸæ¥çš„çº¹ç† PickObject Code PickObjectè¿è¡Œç»“æœShadermaincheckdrawbufferlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_MvpMatrix; uniform bool u_Clicked; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; if (u_Clicked) v_Color = vec4(1.0, 0.0, 0.0, 1.0); else v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(Failed to init shaders); return; gl.clearColor(0, 0, 0, 1); gl.enable(gl.DEPTH_TEST); let n = initVertexBuffers(gl); let u_Clicked = gl.getUniformLocation(gl.program, u_Clicked); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let vpMatrix = new Matrix4(); vpMatrix.setPerspective( 30, 1, 1, 100 ).lookAt( 0, 0, 7, 0, 0, 0, 0, 1, 0 ); // åˆå§‹åŒ–u_Clicked gl.uniform1i(u_Clicked, 0); let currentAngle = 0.0; canvas.onmousedown = function (ev) let x = ev.x, y = ev.y; let rect = ev.target.getBoundingClientRect(); if ((rect.left = x x rect.right) (rect.top = y y rect.bottom)) // pressed inside canvas // window.position â†’ canvas.position let x_in_canvas = x - rect.left; let y_in_canvas = rect.bottom - y; let picked = check(gl, n, x_in_canvas, y_in_canvas, currentAngle, u_Clicked, vpMatrix, u_MvpMatrix); if (picked) alert(The cube was selected!); // æ—‹è½¬åŠ¨ç”» let tick = function() currentAngle = animate(currentAngle); draw(gl, n, currentAngle, vpMatrix, u_MvpMatrix); requestAnimationFrame(tick); tick();function check(gl, n, x, y, currentAngle, u_Clicked, vpMatrix, u_MvpMatrix) let picked = false; gl.uniform1i(u_Clicked, 1); // Pass true to u_Clicked draw(gl, n, currentAngle, vpMatrix, u_MvpMatrix); // Draw Cube with red let pixels = new Uint8Array(4); //Array for storing the pixel value gl.readPixels(x, y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels); if (pixels[0] === 255) //Selected picked = true; // rewrite the cube gl.uniform1i(u_Clicked, 0); draw(gl, n, currentAngle, vpMatrix, u_MvpMatrix); return picked;let g_MvpMatrix = new Matrix4();function draw(gl, n, currentAngle, vpMatrix, u_MvpMatrix) g_MvpMatrix.set(vpMatrix); g_MvpMatrix.rotate( currentAngle, 1, 1, 1 ); gl.uniformMatrix4fv(u_MvpMatrix, false, g_MvpMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);let ANGLE_STEP = 20.0;let g_last = Date.now();function animate(currentAngle) let now = Date.now(); let elapse = now - g_last; g_last = now; return (currentAngle + elapse * ANGLE_STEP / 1000) % 360;function initVertexBuffers(gl) // Create a cube // v6----- v5 // /| /| // v1------v0| // | | | | // | |v7---|-|v4 // |/ |/ // v2------v3 var vertices = new Float32Array([ // Vertex coordinates 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0,-1.0, 1.0, 1.0,-1.0, 1.0, // v0-v1-v2-v3 front 1.0, 1.0, 1.0, 1.0,-1.0, 1.0, 1.0,-1.0,-1.0, 1.0, 1.0,-1.0, // v0-v3-v4-v5 right 1.0, 1.0, 1.0, 1.0, 1.0,-1.0, -1.0, 1.0,-1.0, -1.0, 1.0, 1.0, // v0-v5-v6-v1 up -1.0, 1.0, 1.0, -1.0, 1.0,-1.0, -1.0,-1.0,-1.0, -1.0,-1.0, 1.0, // v1-v6-v7-v2 left -1.0,-1.0,-1.0, 1.0,-1.0,-1.0, 1.0,-1.0, 1.0, -1.0,-1.0, 1.0, // v7-v4-v3-v2 down 1.0,-1.0,-1.0, -1.0,-1.0,-1.0, -1.0, 1.0,-1.0, 1.0, 1.0,-1.0 // v4-v7-v6-v5 back ]); var colors = new Float32Array([ // Colors 0.2, 0.58, 0.82, 0.2, 0.58, 0.82, 0.2, 0.58, 0.82, 0.2, 0.58, 0.82, // v0-v1-v2-v3 front 0.5, 0.41, 0.69, 0.5, 0.41, 0.69, 0.5, 0.41, 0.69, 0.5, 0.41, 0.69, // v0-v3-v4-v5 right 0.0, 0.32, 0.61, 0.0, 0.32, 0.61, 0.0, 0.32, 0.61, 0.0, 0.32, 0.61, // v0-v5-v6-v1 up 0.78, 0.69, 0.84, 0.78, 0.69, 0.84, 0.78, 0.69, 0.84, 0.78, 0.69, 0.84, // v1-v6-v7-v2 left 0.32, 0.18, 0.56, 0.32, 0.18, 0.56, 0.32, 0.18, 0.56, 0.32, 0.18, 0.56, // v7-v4-v3-v2 down 0.73, 0.82, 0.93, 0.73, 0.82, 0.93, 0.73, 0.82, 0.93, 0.73, 0.82, 0.93, // v4-v7-v6-v5 back ]); // Indices of the vertices var indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]); // Write vertex information to buffer object if (!initArrayBuffer(gl, vertices, gl.FLOAT, 3, a_Position)) return -1; // Coordinate Information if (!initArrayBuffer(gl, colors, gl.FLOAT, 3, a_Color)) return -1; // Color Information // Create a buffer object var indexBuffer = gl.createBuffer(); if (!indexBuffer) return -1; // Write the indices to the buffer object gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer (gl, data, type, num, attribute) // Create a buffer object var buffer = gl.createBuffer(); if (!buffer) console.log(Failed to create the buffer object); return false; // Write date into the buffer object gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); // Assign the buffer object to the attribute variable var a_attribute = gl.getAttribLocation(gl.program, attribute); if (a_attribute 0) console.log(Failed to get the storage location of + attribute); return false; gl.vertexAttribPointer(a_attribute, num, type, false, 0, 0); // Enable the assignment to a_attribute variable gl.enableVertexAttribArray(a_attribute); return true; ç¨‹åºåˆ†æ readPixelsè¯»å–ç‚¹å‡»å¤„åƒç´ é¢œè‰² è¯»å–æ¥æºæ˜¯ é¢œè‰²ç¼“å†²åŒº è¯»å–ä½ç½®ç”± xã€y ç¡®å®š è¯»å–å¤§å°ç”± widthã€height ç¡®å®š è¯»å–ç»“æœå­˜æ”¾åœ¨ pixels ä¸­ pixels å¿…é¡»æ˜¯ Uint8Array ç±»å‹çš„æ•°ç»„ æ³¨æ„ï¼š å¯¹äºç»‘å®šåœ¨ gl.FRAMEBUFFER ä¸Šçš„ å¸§ç¼“å†²åŒºå¯¹è±¡ï¼ŒreadPixelsè¯»å–çš„æ˜¯ å¸§ç¼“å†²åŒº ï¼Œè€Œéé¢œè‰²ç¼“å†²åŒºã€‚ é€šè¿‡é˜»å¡ä»£ç è¿è¡Œè§‚å¯Ÿé‡ç»˜å‰çš„ç«‹æ–¹ä½“é€šè¿‡æŒ‡å®šé¢œè‰²åˆ¤æ–­æ˜¯å¦é€‰ä¸­ç‰©ä½“æ–¹æ³•çš„å±€é™å¦‚æœåœºæ™¯ä¸­æœ‰å¾ˆå¤šçš„ç‰©ä½“ï¼Œå¯ä»¥ ä¸ºæ¯ä¸ªç‰©ä½“åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„é¢œè‰²å€¼ã€‚é¢œè‰²ç¼“å†²åŒºä¸­ï¼šRGBA æ¯ä¸ªåˆ†é‡éƒ½æ˜¯8bitã€‚é‚£ä¹ˆRGBAä¸€å…±å°±å¯ä»¥è¡¨ç¤º 32bitï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åŒºåˆ† 2^32 ç§ç‰©ä½“ã€‚ å…¶ä»–åˆ¤æ–­ç‰©ä½“é€‰ä¸­çš„æ–¹æ³• ä½¿ç”¨ç®€åŒ–çš„æ¨¡å‹ç¼©å°ç»˜å›¾åŒºåŸŸä½¿ç”¨å¸§ç¼“å†²åŒºå¯¹è±¡ é€‰ä¸­ä¸€ä¸ªè¡¨é¢å®é™…ä¸Šä½¿ç”¨çš„æ˜¯å’ŒPickObjectåŒæ ·çš„æ–¹æ³• ä¸PickObjectä¸åŒçš„åœ°æ–¹åœ¨ ç”¨æˆ·ç‚¹å‡»é¼ æ ‡é‡ç»˜ç«‹æ–¹ä½“æ—¶ï¼Œå°† æ¯ä¸ªåƒç´ å±äºå“ªä¸ªé¢ çš„ä¿¡æ¯å†™å…¥åˆ° é¢œè‰²ç¼“å†²åŒº çš„ Î±åˆ†é‡ ä¸­ã€‚å³é¼ æ ‡ç‚¹å‡»äº‹ä»¶è¢«è§¦å‘ä¹‹åï¼Œä¸æ˜¯å°†ç‰©ä½“é¢œè‰²è¿›è¡Œé‡å†™ï¼Œè€Œæ˜¯ä½¿ç”¨æŒ‡å®šå€¼å¯¹é¢œè‰²é€æ˜åº¦é€šé“è¿›è¡Œé‡å†™ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹å…¶å®ƒé€šé“è¿›è¡Œä¸ç«‹æ–¹ä½“é¢åºå·ç»‘å®šçš„é‡å†™ã€‚ PickFace Code PickFaceshadermainlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute float a_Face; // Surface number uniform mat4 u_MvpMatrix; uniform int u_PickedFace; // selected surface number varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; int face = int(a_Face); // Convert to int vec3 color = (face == u_PickedFace) ? vec3(1.0) : a_Color.rgb; if(u_PickedFace == 0) // In case of 0, insert the face number into alpha v_Color = vec4(color, a_Face/255.0); else v_Color = vec4(color, a_Color.a); `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; gl.clearColor(0, 0, 0, 1); gl.enable(gl.DEPTH_TEST); let n = initVertexBuffers(gl); let currentAngle = 0; let vpMatrix = new Matrix4().setPerspective( 30, 1, 1, 100 ).lookAt( 7, 0, 0, 0, 0, 0, 0, 1, 0 ); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_PickedFace = gl.getUniformLocation(gl.program, u_PickedFace); gl.uniform1i(u_PickedFace, -1); canvas.onmousedown = function (ev) let x = ev.x, y = ev.y; let rect = ev.target.getBoundingClientRect(); if ((rect.left = x x rect.right) (rect.top = y y rect.bottom)) let x_in_canvas = x - rect.left; let y_in_canvas = rect.bottom - y; let face = checkFace(gl, n, vpMatrix, currentAngle, u_MvpMatrix, u_PickedFace, x_in_canvas, y_in_canvas); gl.uniform1i(u_PickedFace, face); draw(gl, n, vpMatrix, currentAngle, u_MvpMatrix); let tick = function () currentAngle = animate(currentAngle); draw(gl, n, vpMatrix, currentAngle, u_MvpMatrix); requestAnimationFrame(tick); tick();function checkFace(gl,n,vpMatrix,currentAngle,u_MvpMatrix,u_PickedFace,x,y) let pixels = new Uint8Array(4); gl.uniform1i(u_PickedFace, 0); draw(gl, n, vpMatrix, currentAngle, u_MvpMatrix); gl.readPixels(x, y, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels); return pixels[3]; ä¸ºä»€ä¹ˆåœ¨ç€è‰²å™¨ä¸­éœ€è¦å¯¹a_Faceè¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Ÿ attribute float a_Face;void main() ... int face = int(a_Face); ...ç­”ï¼š å› ä¸º attribute ç±»å‹çš„å˜é‡ä¸æ”¯æŒ int ç±»å‹ï¼Œå¹¶ä¸”éœ€è¦ä¸ intç±»å‹ çš„ u_PickedFace è¿›è¡Œæ¯”è¾ƒã€‚uniform int u_PickedFace;void main() ... vec3 color = (face == u_PickedFace) ? vec3(1.0) : a_Color.rgb; ...æ³¨æ„ï¼šåœ¨ä¹‹åè®¡ç®— Î±é€šé“æ•°å€¼ çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ æœªç»è½¬æ¢çš„a_Face ã€‚v_Color = vec4( color, a_Face/255.0);"},{"title":"initShaderså‡½æ•°","path":"/wiki/WebGL/chapter_09_02.html","content":"æ­¥éª¤ç®€è¿°ä¸€å¥è¯è¯´æ¸…initShaderså‡½æ•°çš„åŠŸèƒ½ ç¼–è¯‘GLSL ESä»£ç ï¼Œåˆ›å»ºå’Œåˆå§‹åŒ–ç€è‰²å™¨æä¾›WebGLä½¿ç”¨ã€‚ 7ä¸ªä¸»è¦æ­¥éª¤ Step1 gl.createShader()åˆ›å»ºç€è‰²å™¨å¯¹è±¡Step2 gl.shaderSource()å‘ç€è‰²å™¨å¯¹è±¡ä¸­å¡«å……ç€è‰²å™¨ç¨‹åºçš„æºä»£ç Step3 gl.compileShaderç¼–è¯‘ç€è‰²å™¨Step4 gl.createProgram()åˆ›å»ºç¨‹åºå¯¹è±¡Step5 gl.attachShader()ä¸ºç¨‹åºå¯¹è±¡åˆ†é…ç€è‰²å™¨Step6 gl.linkProgram()è¿æ¥ç¨‹åºå¯¹è±¡Step7 gl.useProgram()ä½¿ç”¨ç¨‹åºå¯¹è±¡ä¸¤ç§å¯¹è±¡ä¸€ä¸ªç¨‹åºå¯¹è±¡å¯¹åº”ä¸¤ä¸ªç€è‰²å™¨å¯¹è±¡ ç€è‰²å™¨å¯¹è±¡ shader object ç®¡ç†ä¸€ä¸ª é¡¶ç‚¹ç€è‰²å™¨ æˆ– ç‰‡å…ƒç€è‰²å™¨æ¯ä¸€ä¸ªç€è‰²å™¨éƒ½æœ‰ä¸€ä¸ª ç€è‰²å™¨å¯¹è±¡ ç¨‹åºå¯¹è±¡ program objectç®¡ç† ç€è‰²å™¨å¯¹è±¡ çš„å®¹å™¨ä¸€ä¸ªç¨‹åºå¯¹è±¡å¿…é¡»åŒ…å«ä¸€ä¸ª é¡¶ç‚¹ç€è‰²å™¨ å’Œä¸€ä¸ª ç‰‡å…ƒç€è‰²å™¨ æ­¥éª¤è¯¦è¿°Step1 åˆ›å»ºç€è‰²å™¨å¯¹è±¡ createShader å‚æ•°æŒ‡å®š ç€è‰²å™¨ç±»å‹ï¼šgl.VERTEX_SHADER é¡¶ç‚¹ç€è‰²å™¨gl.FRAGMENT_SHADER ç‰‡å…ƒç€è‰²å™¨ deleteShader å¦‚æœç€è‰²å™¨å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ï¼ŒdeleteShaderä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰å¾…ç€è‰²å™¨ä¸å†è¢«å ç”¨åå†å°†å…¶åˆ é™¤ã€‚ Step2 æŒ‡å®šç€è‰²å™¨å¯¹è±¡çš„ä»£ç  Step3 ç¼–è¯‘ç€è‰²å™¨ compileShader å…³äºç¼–è¯‘çš„æ—¶æœºå¦‚æœè°ƒç”¨ shaderSource é‡æ–°æŒ‡å®šç€è‰²å™¨ä»£ç ï¼Œå°±ä¸€å®šè¦ä½¿ç”¨ compileShader æ‰‹åŠ¨é‡æ–°ç¼–è¯‘ï¼Œå¦åˆ™WebGLç³»ç»Ÿä¸­æ—§ä»£ç éƒ¨åˆ†ä¸ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ã€‚ getShaderParameter æ˜¯ç”¨æ¥ æ£€æŸ¥ç€è‰²å™¨çš„çŠ¶æ€çš„ ï¼Œç¬¬äºŒä¸ªå‚æ•°pnameå’Œè¿”å›å€¼æœ‰å¦‚ä¸‹å…³ç³»ï¼špnamedescriptionreturngl.SHADER_TYPEç€è‰²å™¨ç±»å‹gl.VERTEX_SHADERgl.FRAGMENT_SHADERgl.DELETE_STATUSæ˜¯å¦è¢«åˆ é™¤æˆåŠŸtruefalsegl.COMPILE_STATUSæ˜¯å¦è¢«ç¼–è¯‘æˆåŠŸtruefalse getShaderInfoLog åœ¨ ç¼–è¯‘å¤±è´¥ çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå³åœ¨ gl.getShaderParameter(shader,gl.COMPILE_STATUS) = false çš„æƒ…å†µä¸‹ã€‚è¿”å›å€¼ä¸ºç¼–è¯‘é”™è¯¯æ—¶ WebGLå†™å…¥ç€è‰²å™¨çš„ ä¿¡æ¯æ—¥å¿—ï¼ˆinformation logï¼‰ã€‚ Step4 åˆ›å»ºç¨‹åºå¯¹è±¡ gl.createProgram() ç”¨äº åˆ›å»ºç¨‹åºå¯¹è±¡ã€‚let a_Position = gl.getAttribLocation(gl.program,a_Position);let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix);gl.getAttribLocation å’Œ gl.getUniformLocation çš„ç¬¬ä¸€ä¸ªå‚æ•° gl.program å°±æ˜¯ ç¨‹åºå¯¹è±¡ gl.deleteProgram() ç”¨äº åˆ é™¤ç¨‹åºå¯¹è±¡ã€‚ Step5 ä¸ºç¨‹åºå¯¹è±¡åˆ†é…ç€è‰²å™¨å¯¹è±¡ attachShader ç”¨äº åˆ†é…ç€è‰²å™¨ï¼Œæ¯ä¸ªç¨‹åºå¿…é¡»å¯¹åº” ä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨ å’Œ ä¸€ä¸ªç‰‡å…ƒç€è‰²å™¨ã€‚æŠŠç©ºçš„ç€è‰²å™¨é™„ç»™ç¨‹åºå¯¹è±¡ä¹Ÿå¯ä»¥ detachShader ç”¨äº è§£é™¤å·²åˆ†é…çš„ç€è‰²å™¨ã€‚ Step6 è¿æ¥ç¨‹åºå¯¹è±¡ linkProgram ç”¨äº è¿æ¥é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨ã€‚è¿æ¥ç€è‰²å™¨çš„ç›®çš„å¯¹é¡¶ç‚¹ç‰‡å…ƒç€è‰²å™¨çš„ varyingå˜é‡ è¿›è¡Œ åŒååŒç±»å‹å¯¹åº”ç¡®ä¿é¡¶ç‚¹ç€è‰²å™¨çš„ æ¯ä¸ªvaryingéƒ½èµ‹äº†å€¼å¯¹é¡¶ç‚¹ç‰‡å…ƒç€è‰²å™¨çš„ uniformå˜é‡ è¿›è¡Œ åŒç±»å‹å¯¹åº”ç¡®ä¿attributeã€uniformã€varyingå˜é‡çš„ä¸ªæ•°æ²¡æœ‰è¶…è¿‡ ç€è‰²å™¨çš„ä¸Šé™ getProgramParameter ç”¨äºæ£€æŸ¥ ç€è‰²å™¨æ˜¯å¦è¿æ¥æˆåŠŸã€‚è¿æ¥æˆåŠŸ å‘WebGLç³»ç»Ÿè¿”å›ä¸€ä¸ª äºŒè¿›åˆ¶å¯æ‰§è¡Œæ¨¡å—è¿æ¥å¤±è´¥ ä¼šåœ¨ ä¿¡æ¯æ—¥å¿— ä¸­ç”Ÿäº§æˆ è¿æ¥å‡ºé”™ä¿¡æ¯LINK_STATUSå’ŒVALIDATE_STATUSçš„åŒºåˆ«LINK_STATUS ç¨‹åºæ˜¯å¦ æˆåŠŸè¿æ¥ä»…æ£€æµ‹ è¿æ¥é˜¶æ®µVALIDATE_STATUS ç¨‹åºæ˜¯å¦ é€šè¿‡éªŒè¯æ£€æµ‹ è¿è¡Œé˜¶æ®µæ€§èƒ½å¼€é”€å¾ˆå¤§ï¼Œé€šå¸¸åœ¨ è°ƒè¯•ç¨‹åº æ—¶è¿™æ ·åš getProgramInfoLog ç”¨äº ä»ä¿¡æ¯æ—¥å¿—ä¸­è·å–è¿æ¥å‡ºé”™ä¿¡æ¯ Step7 å‘ŠçŸ¥WebGLç³»ç»Ÿæ‰€ä½¿ç”¨çš„ç¨‹åºå¯¹è±¡ è¿™ä¹Ÿä¸ºWebGLæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼šåªéœ€è¦å‡†å¤‡å¤šä¸ª ç¨‹åºå¯¹è±¡ï¼Œç»˜åˆ¶æ—¶æ ¹æ®éœ€è¦ åˆ‡æ¢ç¨‹åºå¯¹è±¡ã€‚ å†…éƒ¨æµç¨‹initShaders(gl, vshader, fshader) function initShaders(gl, vshader, fshader) // 1. åˆ›å»ºä¸€ä¸ªè¿æ¥å¥½çš„ç¨‹åºå¯¹è±¡ let program = createProgram(gl, vshader, fshader); if (!program) console.log(Failed to create program); return false; // 2. å‘Šè¯‰WebGLç³»ç»Ÿæ¥ä½¿ç”¨è¿™ä¸ªç¨‹åºå¯¹è±¡ gl.useProgram(program); // 3. å°†ç¨‹åºå¯¹è±¡è®¾ä¸ºglå¯¹è±¡çš„programå±æ€§ gl.program = program; createProgram(gl, vshader, fshader) function createProgram(gl, vshader, fshader) // 1. åˆ›å»ºç€è‰²å™¨å¯¹è±¡ let vertexShader = loadShader(gl, gl.VERTEX_SHADER, vshader); let fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fshader); if (!vertexShader || !fragmentShader) return null; // 2. åˆ›å»ºç¨‹åºå¯¹è±¡ let program = gl.createProgram(); if (!program) return null; // 3. åˆ†é…ç€è‰²å™¨ gl.attachShader(program, vertexShader); gl.attachShader(program, fragmentShader); // 4. è¿æ¥ç€è‰²å™¨ gl.linkProgram(program); // 5. æ£€æŸ¥è¿æ¥ let linked = gl.getProgramParameter(program, gl.LINK_STATUS); if (!linked) let error = gl.getProgramInfoLog(program); console.log(Failed to link program: + error); // åˆ é™¤ç¨‹åºå’Œç€è‰²å™¨ gl.deleteProgram(program); gl.deleteShader(fragmentShader); gl.deleteShader(vertexShader); return null; return program; loadShader(gl, type, source) function loadShader(gl, type, source) // 1. åˆ›å»ºç€è‰²å™¨å¯¹è±¡ let shader = gl.createShader(type); if (shader == null) console.log(unable to create shader); return null; // 2. è®¾ç½®ç€è‰²å™¨æºä»£ç  gl.shaderSource(shader, source); // 3. ç¼–è¯‘ç€è‰²å™¨ gl.compileShader(shader); // 4. æ£€æŸ¥ç€è‰²å™¨çš„ç¼–è¯‘çŠ¶æ€ if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) let error = gl.getShaderInfoLog(shader); console.log(failed to compile shader: + error); gl.deleteShader(shader); return null; return shader;"},{"title":"HUD","path":"/wiki/WebGL/chapter_10_02.html","content":"HUDå¹³è§†æ˜¾ç¤ºå™¨ä»€ä¹ˆæ˜¯HUDï¼Ÿ ç­”ï¼š head up display ï¼Œå³ å¹³è§†æ˜¾ç¤ºå™¨ ã€‚ä¹‹æ‰€ä»¥æ˜¯ å¹³è§† ï¼Œ æ˜¯å› ä¸ºæœ€åˆæ˜¯ç”¨äºç§°å‘¼æ–¹ä¾¿é£è¡Œå‘˜èƒ½å¤Ÿå¹³è§†å‰æ–¹çš„é©¾é©¶èˆ±ç»ç’ƒå°±èƒ½å¤Ÿçœ‹åˆ°ä»ªè¡¨å›¾å½¢æŠ•å½±çš„æ˜¾ç¤ºå™¨ã€‚ æœ¬ä¾‹è¦å®ç°çš„HUDå³åœ¨ä¸‰ç»´åœºæ™¯å‰æ–¹ç»˜åˆ¶äºŒç»´ä¸‰è§’å½¢å’Œæ–‡æœ¬ã€‚ ç®€å•å®ç°æ€è·¯ ä¸º ä¸‰ç»´å›¾å½¢ å’Œ äºŒç»´å›¾å½¢ å„è‡ªå‡†å¤‡ä¸€ä¸ª canvasã€‚å°†ä¸¤ä¸ªcanvas é‡å æ”¾ç½® ï¼ˆHUDåœ¨ä¸Šï¼‰ã€‚åœ¨ä¸‰ç»´canvasä¸Šä½¿ç”¨ WebGL API ç»˜åˆ¶ä¸‰ç»´åœºæ™¯ã€‚åœ¨äºŒç»´canvasä¸Šä½¿ç”¨ canvas 2D APIç»˜åˆ¶HUDä¿¡æ¯ã€‚ HUD Code HUDè¿è¡Œæ•ˆæœhtmlmaindraw2Dbody onload=main() canvas id=webgl width=400 height=400 style=position:absolute; z-index:0;/canvas canvas id=hud width=400 height=400 style=position:absolute; z-index:1;/canvas/bodyfunction main() let canvas = document.getElementById(webgl); let hud = document.getElementById(hud); let gl = getWebGLContext(canvas); let ctx = hud.getContext(2d); ... let tick = function () currentAngle = animate(currentAngle); draw(gl, n, vpMatrix, currentAngle, u_MvpMatrix); draw2D(ctx, currentAngle); requestAnimationFrame(tick); tick(); hud.onmousedown = function (ev) ... function draw2D(ctx, currentAngle) // Draw triangle ctx.clearRect(0, 0, 400, 400); ctx.beginPath(); ctx.moveTo(120, 10); ctx.lineTo(200, 150); ctx.lineTo(40, 150); ctx.closePath(); ctx.strokeStyle = rgba(0,255,0,1); ctx.stroke(); // Draw letters ctx.font = 18px Times New Roman; ctx.fillStyle = rgba(0,255,0,1); ctx.fillText(HUD: Head Up Display, 40, 180); ctx.fillText(Triangle is drawn by Canvas 2D API,, 40, 200); ctx.fillText(Cube is drawn by WebGL API., 40, 220); ctx.fillText(Current Angle: + Math.floor(currentAngle), 40, 240); æœ‰å…³ç¨‹åºçš„ä¸€äº›é—®é¢˜ã€‚ HUD.jså¤§éƒ¨åˆ†æ˜¯åŸºäºPickFace.jsçš„ï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ è·å–çš„ä¸Šä¸‹æ–‡ä¸åŒ PickFace åªè·å–ä¸‰ç»´ç”»å¸ƒlet canavs = document.getElementById(webgl);let gl = getWebGLContext(canvas); HUD è·å–äºŒç»´å’Œä¸‰ç»´ç”»å¸ƒlet canavs = document.getElementById(webgl);let hud = document.getElementById(hud);let gl = getWebGLContext(canvas);let ctx = getWebGLContext(hud); é¼ æ ‡ç‚¹å‡»äº‹ä»¶æ³¨å†Œçš„ç”»å¸ƒä¸åŒï¼ˆä¸»è¦æ˜¯å› ä¸ºç”»å¸ƒå±‚çº§ä¸åŒï¼‰ PickFace çš„é¼ æ ‡äº‹ä»¶æ³¨å†Œåˆ° ä¸‰ç»´ç”»å¸ƒ ä¸Šcanvas.onmousedown = function(ev)... HUD çš„é¼ æ ‡äº‹ä»¶æ³¨å†Œåˆ° äºŒç»´ç”»å¸ƒ ä¸Šhud.onmousedown = function(ev)... draw2Dä¸­ç»˜åˆ¶ä½¿ç”¨çš„å‡½æ•°éƒ½å…·æœ‰ä»€ä¹ˆç‰¹å¾ï¼ŸW3Cå¯¹canvasæ–¹æ³•çš„ä»‹ç»https://www.w3school.com.cn/tags/html_ref_canvas.asp clearRectctx.clearRect(0,0,400,400)ç”¨äºæ¸…é™¤ç»™å®šçŸ©å½¢å†…çš„åƒç´ ã€‚beginPathctx.beginPath()ç”¨äºèµ·å§‹ä¸€æ¡è·¯å¾„ï¼Œæˆ–é‡ç½®å½“å‰è·¯å¾„ã€‚moveToctx.moveTo(120, 10);ç”¨äºæŠŠè·¯å¾„ç§»åŠ¨åˆ°ç”»å¸ƒä¸­çš„æŒ‡å®šç‚¹ï¼Œä¸åˆ›å»ºçº¿æ¡ã€‚lineToctx.lineTo(200,150);ctx.lineTo(40,150);ç”¨äºæ·»åŠ ä¸€ä¸ªæ–°ç‚¹ï¼Œç„¶ååœ¨ç”»å¸ƒä¸­åˆ›å»ºä»è¯¥ç‚¹åˆ°æœ€åæŒ‡å®šç‚¹çš„çº¿æ¡ã€‚closePathctx.closePath();ç”¨äºåˆ›å»ºä»å½“å‰ç‚¹å›åˆ°èµ·å§‹ç‚¹çš„è·¯å¾„ã€‚strokectx.strokeStyle = rgba(0,255,0,1);ç”¨äºè®¾ç½®æˆ–è¿”å›ç”¨äºç¬”è§¦çš„é¢œè‰²ã€æ¸å˜æˆ–æ¨¡å¼ã€‚ctx.stroke();ç”¨äºç»˜åˆ¶å·²å®šä¹‰çš„è·¯å¾„ã€‚textctx.font = 18px Times New Roman;ç”¨äºè®¾ç½®æˆ–è¿”å›æ–‡æœ¬å†…å®¹çš„å½“å‰å­—ä½“å±æ€§ctx.fillStye = rgba(0,255,0,1);ç”¨äºè®¾ç½®æˆ–è¿”å›ç”¨äºå¡«å……ç»˜ç”»çš„é¢œè‰²ã€æ¸å˜æˆ–æ¨¡å¼ã€‚ctx.fillText(HUD: Head Up Display, 40, 180);ctx.fillText(Triangle is drawn by Canvas 2D API,, 40, 200);ctx.fillText(Cube is drawn by WebGL API., 40, 220);ctx.fillText(Current Angle: + Math.floor(currentAngle), 40, 240);ç”¨äºåœ¨ç”»å¸ƒä¸Šç»˜åˆ¶è¢«å¡«å……çš„æ–‡æœ¬ã€‚ åœ¨ç½‘é¡µä¸Šæ–¹æ˜¾ç¤ºä¸‰ç»´ç‰©ä½“è¯¥ç¨‹åºæ˜¯åŸºäºPickFaceã€‚ 3DoverWeb Code 3DoverWebè¿è¡Œæ•ˆæœhtmljsbody onload=main() canvas id=webgl width=400 height=400 style=position:absolute;/canvas div h119h1 h2Great Designs Come from Great Designers --- Not from Great Design Processes/h2 pThe basic premise underlying the SEIs [Software Engineering Institute] work on software process maturity is that the quality of a software product is largely determined by the quality of the software development and maintenance processes used to build it./p Mark Paulk [1995], The evolution of clothe SEIs capability maturity model for software p...[W]hile some may see them as the crazy ones, we see genius, because the ones who are crazy enough to think that they can change the world, are the ones who do./p Steve Jobs, Apple commercial (1997) /div/bodyä¸PickFaceå”¯ä¸€çš„ä¸åŒå°±æ˜¯canvasèƒŒæ™¯è‰²çš„è®¾ç½®ã€‚...function main() ... gl.clearColor(0,0,0,0); ..."},{"title":"é›¾åŒ–/åœ†ç‚¹","path":"/wiki/WebGL/chapter_10_03.html","content":"ä»€ä¹ˆæ˜¯é›¾åŒ–ï¼Ÿ ç­”ï¼š åœ¨ä¸‰ç»´å›¾å½¢å­¦ä¸­ï¼Œé›¾åŒ–ï¼ˆfogï¼‰ æŒ‡çš„æ˜¯è¿œå¤„çš„ç‰©ä½“çœ‹ä¸Šå»è¾ƒä¸ºæ¨¡ç³Šçš„ç°è±¡ã€‚ å¦‚ä½•å®ç°é›¾åŒ–ï¼Ÿçº¿æ€§é›¾åŒ–ï¼ˆlinear fogï¼‰ çº¿æ€§é›¾åŒ–è¡¨ç¤º é›¾åŒ–ç¨‹åº¦ä¸è¯¥ç‚¹ä¸è§†ç‚¹çš„è·ç¦»å‘ˆçº¿æ€§å…³ç³»ã€‚é›¾åŒ–ç¨‹åº¦å–å†³äº å®ƒä¸è§†ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ é›¾åŒ–èµ·ç‚¹ å¼€å§‹é›¾åŒ–ä¹‹å¤„é›¾åŒ–ç»ˆç‚¹ å®Œå…¨é›¾åŒ–ä¹‹å¤„ é›¾åŒ–å› å­ï¼ˆfog factorï¼‰ æŸä¸€ç‚¹é›¾åŒ–çš„ç¨‹åº¦å¯ä»¥è¢«å®šä¹‰ä¸º é›¾åŒ–å› å­ï¼ˆfog factorï¼‰é›¾åŒ–å› å­è®¡ç®—å…¬å¼é›¾åŒ–å› å­ ï¼ˆ ç»ˆç‚¹ - å½“å‰ç‚¹ä¸è§†ç‚¹é—´çš„è·ç¦» ï¼‰ï¼ˆç»ˆç‚¹ - èµ·ç‚¹ ï¼‰é›¾åŒ–å› å­ä¸è§†ç‚¹è·ç¦»çº¿æ€§å…³ç³»å›¾ç‰©ä½“ç¦»è§†ç‚¹è¶Šè¿œï¼Œé›¾åŒ–å› å­è¶Šå°ï¼Œç‰©ä½“è¶Šæ¨¡ç³Šã€‚æ ¹æ®é›¾åŒ–å› å­è®¡ç®—ç‰‡å…ƒé¢œè‰²å…¬å¼ç‰‡å…ƒé¢œè‰² ã€ç‰©ä½“è¡¨é¢é¢œè‰² * é›¾åŒ–å› å­ã€‘ + ã€é›¾çš„é¢œè‰² * ï¼ˆ1 - é›¾åŒ–å› å­ï¼‰ã€‘ é›¾åŒ–ç¨‹åºå®ç°æ€è·¯ æ³¨æ„æ­¤ç¨‹åºçš„é›¾åŒ–å› å­æ˜¯åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹è®¡ç®—çš„ã€‚é¡¶ç‚¹ç€è‰²å™¨è®¡ç®—å‡ºå½“å‰é¡¶ç‚¹ä¸è§†ç‚¹è·ç¦»ï¼Œä¼ å…¥ç‰‡å…ƒç€è‰²å™¨ã€‚ç‰‡å…ƒç€è‰²å™¨æ ¹æ® ç‰‡å…ƒä¸è§†ç‚¹çš„è·ç¦»ï¼Œè®¡ç®—å‡º é›¾åŒ–å› å­ã€‚ Fog Code Fogè¿è¡Œæ•ˆæœshadermainkeydownbufferlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_MvpMatrix; uniform mat4 u_ModelMatrix; uniform vec4 u_Eye; // è§†ç‚¹ varying vec4 v_Color; varying float v_Dist; void main() gl_Position = u_MvpMatrix * a_Position; v_Color = a_Color; // Calculate the distance to each vertex from eye point // è®¡ç®—ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œè§†ç‚¹å’Œç‰©ä½“ä¹‹é—´çš„è·ç¦» v_Dist = distance(u_ModelMatrix * a_Position, u_Eye); `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform vec3 u_FogColor; uniform vec2 u_FogDist; varying vec4 v_Color; varying float v_Dist; void main() float fogFactor = clamp((u_FogDist.y - v_Dist)/(u_FogDist.y-u_FogDist.x),0.0,1.0); vec3 color = mix(u_FogColor,vec3(v_Color),fogFactor); gl_FragColor = vec4(color,v_Color.a); `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl,VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shader); return; let n = initVertexBuffers(gl); let fogColor = new Float32Array([0.137, 0.231, 0.323]); let fogDist = new Float32Array([55, 80]); let eye = new Float32Array([25, 65, 35, 1.0]); let u_MvpMatrix = gl.getUniformLocation(gl.program, u_MvpMatrix); let u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); let u_Eye = gl.getUniformLocation(gl.program, u_Eye); let u_FogColor = gl.getUniformLocation(gl.program, u_FogColor); let u_FogDist = gl.getUniformLocation(gl.program, u_FogDist); gl.uniform3fv(u_FogColor, fogColor); gl.uniform2fv(u_FogDist, fogDist); gl.uniform4fv(u_Eye, eye); gl.clearColor(...fogColor,1.0); gl.enable(gl.DEPTH_TEST); let modelMatrix = new Matrix4(); modelMatrix.setScale(10, 10, 10); //ä¸–ç•Œåæ ‡è½¬æ¢çŸ©é˜µ gl.uniformMatrix4fv(u_ModelMatrix, false, modelMatrix.elements); let mvpMatrix = new Matrix4(); mvpMatrix.setPerspective( 30, 1, 1, 1000 ).lookAt( ...eye, 0, 2, 0, 0, 1, 0 ).multiply(modelMatrix); gl.uniformMatrix4fv(u_MvpMatrix, false, mvpMatrix.elements); document.onkeydown = function (ev) keydown(ev, gl, n, u_FogDist, fogDist); gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function keydown(ev, gl, n, u_FogDist, fogDist) switch (ev.keyCode) case 38: fogDist[1] += 1; break; //â†‘ case 40: if (fogDist[1] fogDist[0]) fogDist[1] -= 1; break; default: return; gl.uniform2fv(u_FogDist, fogDist); //Pass the distance of fog gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); gl.drawElements(gl.TRIANGLES, n, gl.UNSIGNED_BYTE, 0);function initVertexBuffers(gl) // Create a cube // v6----- v5 // /| /| // v1------v0| // | | | | // | |v7---|-|v4 // |/ |/ // v2------v3 var vertices = new Float32Array([ // Vertex coordinates 1, 1, 1, -1, 1, 1, -1,-1, 1, 1,-1, 1, // v0-v1-v2-v3 front 1, 1, 1, 1,-1, 1, 1,-1,-1, 1, 1,-1, // v0-v3-v4-v5 right 1, 1, 1, 1, 1,-1, -1, 1,-1, -1, 1, 1, // v0-v5-v6-v1 up -1, 1, 1, -1, 1,-1, -1,-1,-1, -1,-1, 1, // v1-v6-v7-v2 left -1,-1,-1, 1,-1,-1, 1,-1, 1, -1,-1, 1, // v7-v4-v3-v2 down 1,-1,-1, -1,-1,-1, -1, 1,-1, 1, 1,-1 // v4-v7-v6-v5 back ]); var colors = new Float32Array([ // Colors 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, // v0-v1-v2-v3 front 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, // v0-v3-v4-v5 right 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, 1.0, 0.4, 0.4, // v0-v5-v6-v1 up 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, // v1-v6-v7-v2 left 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, // v7-v4-v3-v2 down 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0, 0.4, 1.0, 1.0 // v4-v7-v6-v5 back ]); var indices = new Uint8Array([ // Indices of the vertices 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]); // Create a buffer object var indexBuffer = gl.createBuffer(); if (!indexBuffer) return -1; // Write the vertex property to buffers (coordinates and normals) if (!initArrayBuffer(gl, vertices, 3, gl.FLOAT, a_Position)) return -1; if (!initArrayBuffer(gl, colors, 3, gl.FLOAT, a_Color)) return -1; // Write the indices to the buffer object gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW); return indices.length;function initArrayBuffer (gl, data, num, type, attribute) // Create a buffer object var buffer = gl.createBuffer(); if (!buffer) console.log(Failed to create the buffer object); return false; // Write date into the buffer object gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); // Assign the buffer object to the attribute variable var a_attribute = gl.getAttribLocation(gl.program, attribute); if (a_attribute 0) console.log(Failed to get the storage location of + attribute); return false; gl.vertexAttribPointer(a_attribute, num, type, false, 0, 0); // Enable the assignment of the buffer object to the attribute variable gl.enableVertexAttribArray(a_attribute); // Unbind the buffer object gl.bindBuffer(gl.ARRAY_BUFFER, null); return true; ç¨‹åºè§£æ å¦‚ä½•ä½¿ç”¨distance()è®¡ç®—é¡¶ç‚¹ä¸è§†ç‚¹é—´çš„è·ç¦»ï¼Ÿ// é¡¶ç‚¹ä¸è§†ç‚¹é—´è· = distance( é¡¶ç‚¹åæ ‡, è§†ç‚¹åæ ‡)v_Dist = distance( u_ModelMatrix * a_Position, u_Eye); u_ModelMatrixï¼š å°†é¡¶ç‚¹è½¬æ¢åˆ° ä¸–ç•Œåæ ‡ç³» ä¸‹çš„æ¨¡å‹çŸ©é˜µ u_ModelMatrix*a_Positionï¼š ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ é¡¶ç‚¹åæ ‡ u_Eyeï¼š ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ è§†ç‚¹åæ ‡ å¦‚ä½•ä½¿ç”¨clamp()è®¡ç®—é›¾åŒ–å› å­å¤§å°ï¼Ÿfloat fogFactor = clamp( (u_FogDist.y - v_Dist) / (u_FogDist.y - u_FogDist.x), 0.0, 1.0 ); u_FogDist é›¾çš„èŒƒå›´ u_FogDist.x é›¾çš„èµ·ç‚¹ u_FogDist.y é›¾çš„ç»ˆç‚¹ u_FogDist.y - u_FogDist.x èµ·ç‚¹ä¸ç»ˆç‚¹ä¹‹é—´çš„è·ç¦» v_Dist é¡¶ç‚¹ä¸è§†ç‚¹é—´çš„è·ç¦» clampå‡½æ•° åŠŸèƒ½ å¯¹è®¡ç®—ç»“æœè¿›è¡ŒåŒºé—´é™åˆ¶å‚æ•°å‚æ•°1 è®¡ç®—å‡ºçš„é›¾åŒ–å› å­å‚æ•°2 åŒºé—´çš„æœ€å°å€¼å‚æ•°3 åŒºé—´çš„æœ€å¤§å€¼ å¦‚ä½•ä½¿ç”¨mix()è®¡ç®—ç‰‡å…ƒé¢œè‰²ï¼Ÿvec3 color = mix(u_FogColor, vec3(v_Color), fogFactor); åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾ç½®ï¼š x u_FogColor è¡¨ç¤ºé›¾çš„é¢œè‰² y vec3(v_Color) è¡¨ç¤ºç‰©ä½“è¡¨é¢é¢œè‰² z fogFactor è¡¨ç¤ºé›¾åŒ–å› å­ mix(x,y,z) = x*(1-z) + y*z; xä¸zæˆ åæ¯” yä¸zæˆ æ­£æ¯” é™¤äº†çº¿æ€§é›¾åŒ–ï¼Œè¿˜æœ‰å…¶ä»–å“ªäº›é›¾åŒ–ç®—æ³•ï¼Ÿç­”ï¼š è¿˜æœ‰æŒ‡æ•°é›¾åŒ–ç®—æ³•ç­‰ç­‰ã€‚æƒ³è¦ä½¿ç”¨å…¶ä»–çš„é›¾åŒ–ç®—æ³•ï¼Œåªéœ€ ä¿®æ”¹é›¾åŒ–æŒ‡æ•°çš„è®¡ç®—æ–¹æ³• ã€‚ ä½¿ç”¨wåˆ†é‡è¿‘ä¼¼ä¼°ç®—æ³• Fog.jsä¸­shaderç¨‹åºçš„ç¼ºé™·å³åœ¨ é¡¶ç‚¹ç€è‰²å™¨ ä¸­è®¡ç®— é¡¶ç‚¹ä¸è§†ç‚¹çš„è·ç¦» ,ä¼šé€ æˆè¾ƒå¤§çš„å¼€é”€ï¼Œå½±å“æ€§èƒ½ã€‚è¿‘ä¼¼ä¼°ç®—æ³•éœ€è¦ä¸ºè§†ç‚¹å’Œè§†çº¿è®¾ç½® ç‰¹æ®Šæ¡ä»¶ï¼š è§†ç‚¹ åœ¨ åŸç‚¹è§†çº¿ æ²¿ Zè½´è´Ÿæ–¹å‘ç”±æ­¤å¯ä»¥æ¨å‡ºå‡ ä¸ªç»“è®ºï¼šåœ¨è§‚å¯Ÿè€…åæ ‡ç³»ä¸‹ï¼Œç‰©ä½“åŠè§†å›¾çš„ zåˆ†é‡éƒ½æ˜¯è´Ÿå€¼wåˆ†é‡å¯ä»¥ç›´æ¥çœ‹åš é¡¶ç‚¹ä¸è§†ç‚¹çš„è·ç¦»wåˆ†é‡æ˜¯vec4ç±»å‹çš„é¡¶ç‚¹åæ ‡çš„æœ€åä¸€ä¸ªåˆ†é‡wåˆ†é‡çš„å€¼åˆšå¥½æ˜¯ zåˆ†é‡å€¼ä¹˜ä»¥-1 æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„vertex shaderç¨‹åº é€šè¿‡distanceè®¡ç®—è·ç¦»void main() gl_Position = u_MvpModel * a_Position; v_Color = a_Color; v_Dist = distance( u_ModelMatrix * a_Position, u_Eye); é€šè¿‡wåˆ†é‡ä¼°ç®—è·ç¦»void main() gl_Position = u_MvpMatrix * a_Position; v_Color = a_Color; v_Dist = gl_Position.w; ç»˜åˆ¶åœ†å½¢çš„ç‚¹å¦‚ä½•ç»˜åˆ¶åœ†ç‚¹ï¼Ÿ ç­”ï¼š åƒåšé¥¼å¹²ä¸€æ ·ï¼Œéœ€è¦å°†åŸå…ˆçš„æ–¹ç‚¹ å‰Šå‡ æˆåœ†å½¢ã€‚ å‰Šå‡çš„è¿‡ç¨‹å°±å’Œåšé¥¼å¹²ä¸€æ ·åœ¨åšé¥¼å¹²çš„æ—¶å€™ï¼Œé¥¼å¹²æ¨¡å…·ä¼šå¸®åŠ©æˆ‘ä»¬åˆ‡å‰²ç”œé¥¼ã€‚ä½†æ˜¯åœ¨è®¡ç®—æœºä¸­æ²¡æœ‰æ¨¡å…·ï¼Œè¦å€ŸåŠ©ä»€ä¹ˆå·¥å…·åˆ¤æ–­åˆ‡å‰²è¾¹ç•Œå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯åæ ‡ç³»ã€‚ éœ€è¦åˆ‡å‰²çš„ç‰‡å…ƒ ä»¥åæ ‡è½´ä½œä¸ºåˆ‡å‰²å·¥å…· gl_PointCoordæ­¥éª¤1 æ£€æŸ¥å½“å‰ç‰‡å…ƒæ˜¯å¦è·ç¦»ç‚¹ä¸­å¿ƒ **ï¼ˆ0.5,0.5ï¼‰**è·ç¦»è¶…è¿‡0.5æ­¥éª¤2 å¦‚æœæ˜¯ï¼Œä½¿ç”¨ discard è¯­å¥æ”¾å¼ƒæ­¤ç‰‡å…ƒ RoundedPoint Code RoundedPointè¿è¡Œæ•ˆæœshadermainbufferlet VSHADER_SOURCE = ` attribute vec4 a_Position; void main() gl_Position = a_Position; gl_PointSize = 10.0; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif void main() float d = distance(gl_PointCoord, vec2(0.5,0.5)); if(d0.5) gl_FragColor = vec4(0.0,1.0,0.0,1.0); else discard; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; let n = initVertexBuffers(gl); gl.clearColor(0, 0, 0, 1); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.POINTS, 0, n); function initVertexBuffers(gl) let vertices = new Float32Array([ 0, 0.5, -0.5, -0.5, 0.5, -0.5 ]); let n = 3; let a_Position = gl.getAttribLocation(gl.program, a_Position); let vertexBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer); gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); gl.enableVertexAttribArray(a_Position); return n; ç»˜åˆ¶é€»è¾‘ç®€è¿° å®é™…ä¸Šæ‰€æœ‰çš„ç»˜åˆ¶é€»è¾‘åœ¨ ç‰‡å…ƒç€è‰²å™¨ ä¸­å®ç°ï¼š è®¡ç®—ç‰‡å…ƒè·ç¦»æ‰€å±ç‚¹ä¸­å¿ƒçš„è·ç¦» float d = distance(gl_PointCoord,vec2(0.5,0.5));å¦‚æœè·ç¦»å°äº0.5å°±ç»˜åˆ¶ï¼Œå¦åˆ™èˆå¼ƒ if(d0.5) gl_FragColor = vec4(0.0,1.0,0.0,1.0);else discard;"},{"title":"Î±æ··åˆ","path":"/wiki/WebGL/chapter_10_04.html","content":"Î±åˆ†é‡ ä»£è¡¨ R G B A ä¸­çš„ Aé€šè¿‡æ§åˆ¶Aåˆ†é‡æ¥å®ç°åŠé€æ˜æ•ˆæœçš„æ–¹å¼ï¼Œè¢«ç§°ä¸º Î±æ··åˆï¼ˆalpha blendingï¼‰ã€‚ å®ç°Î±æ··åˆæ•™å ‚åŠé€æ˜çš„å½©è‰²ç»ç’ƒæ˜¯å®—æ•™ç¾å­¦çš„å…¸å‹ä»£è¡¨ å¦‚ä½•å¼€å¯Î±æ··åˆ å¼€å¯æ··åˆåŠŸèƒ½gl.enable(gl.BLEND);æŒ‡å®šæ··åˆå‡½æ•°gl.blendFunc(gl.SRC.ALPHA,gl.ONE_MINUS_SRC_ALPHA); LookAtBlendedTriangles Code shadermaininitVertexBufferskeydown&&drawlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_ViewMatrix; uniform mat4 u_ProjMatrix; varying vec4 v_Color; void main() gl_Position = u_ProjMatrix * u_ViewMatrix * a_Position; v_Color = a_Color; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders); return; gl.clearColor(0, 0, 0, 1); gl.enable(gl.BLEND); gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA); let u_ProjMatrix = gl.getUniformLocation(gl.program, u_ProjMatrix); let u_ViewMatrix = gl.getUniformLocation(gl.program, u_ViewMatrix); let viewMatrix = new Matrix4(); let projMatrix = new Matrix4(); projMatrix.setOrtho( -1, 1, -1, 1, 0, 2 ); gl.uniformMatrix4fv(u_ProjMatrix, false, projMatrix.elements); let n = initVertexBuffers(gl); draw(gl, n, u_ViewMatrix, viewMatrix); window.onkeydown = function (ev) keydown(gl, ev, n, u_ViewMatrix, viewMatrix); function initVertexBuffers(gl) let verticesColors = new Float32Array([ 0.0, 0.5, -0.4, 0.4, 1.0, 0.4, 0.4, // The back green one -0.5, -0.5, -0.4, 0.4, 1.0, 0.4, 0.4, 0.5, -0.5, -0.4, 1.0, 0.4, 0.4, 0.4, 0.5, 0.4, -0.2, 1.0, 0.4, 0.4, 0.4, // The middle yerrow one -0.5, 0.4, -0.2, 1.0, 1.0, 0.4, 0.4, 0.0, -0.6, -0.2, 1.0, 1.0, 0.4, 0.4, 0.0, 0.5, 0.0, 0.4, 0.4, 1.0, 0.4, // The front blue one -0.5, -0.5, 0.0, 0.4, 0.4, 1.0, 0.4, 0.5, -0.5, 0.0, 1.0, 0.4, 0.4, 0.4, ]); let n = 9; let FSIZE = verticesColors.BYTES_PER_ELEMENT; let a_Position = gl.getAttribLocation(gl.program, a_Position); let a_Color = gl.getAttribLocation(gl.program, a_Color); let vertexColorBuffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, vertexColorBuffer); gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW); gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, FSIZE*7, 0); gl.enableVertexAttribArray(a_Position); gl.vertexAttribPointer(a_Color, 4, gl.FLOAT, false, FSIZE*7, FSIZE*3); gl.enableVertexAttribArray(a_Color); return n;let g_EyeX = 0.2, g_EyeY = 0.25, g_EyeZ = 0.25;function keydown(gl, ev, n,u_ViewMatrix, viewMatrix) switch (ev.keyCode) case 37: g_EyeX -= 0.01; break; case 39: g_EyeX += 0.01; break; default: break; draw(gl, n, u_ViewMatrix, viewMatrix);function draw(gl, n, u_ViewMatrix, viewMatrix) viewMatrix.setLookAt( g_EyeX, g_EyeY, g_EyeZ, 0, 0, 0, 0, 1, 0 ); gl.uniformMatrix4fv(u_ViewMatrix, false, viewMatrix.elements); gl.clear(gl.COLOR_BUFFER_BIT); gl.drawArrays(gl.TRIANGLES, 0, n); æ··åˆå‡½æ•°gl.blendFunc() åœ¨LookAtBlendedTrianglesä¸­æœ‰ä¸¤è¡Œæ¶‰åŠÎ±æ··åˆçš„å…³é”®ä»£ç ï¼šgl.enable(gl.BLEND);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);Î±æ··åˆæ¶‰åŠä¸¤ä¸ªé¢œè‰²ï¼šæºé¢œè‰²ï¼ˆsource colorï¼‰å¾…æ··åˆè¿›å»çš„é¢œè‰²ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¦å åŠ çš„å¯¹è±¡çš„é¢œè‰²åƒ åŠ å¥¶å’–å•¡ é‡Œçš„ ç‰›å¥¶ï¼ˆåŠ è¿›å»çš„åŸæ–™ï¼‰ç›®æ ‡é¢œè‰²ï¼ˆdestination colorï¼‰å¾…è¢«æ··åˆè¿›å»çš„é¢œè‰²ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ç”»æ¿ä¸Šå·²æœ‰çš„é¢œè‰²åƒ åŠ å¥¶å’–å•¡ é‡Œçš„ å’–å•¡ï¼ˆè¢«åŠ çš„åŸºåº•ï¼‰æºé¢œè‰²å°±åƒæ‹¿é“é‡Œè°ƒå’Œé£å‘³çš„ç‰›å¥¶ï¼Œç›®æ ‡é¢œè‰²åˆ™æ˜¯ä½œä¸ºåŸºåº•çš„å’–å•¡åŠ æ³•æ··åˆï¼ˆadditive blendingï¼‰åŠ æ³•æ··åˆä¼šä½¿è¢«æ··åˆçš„åŒºåŸŸæ›´åŠ æ˜äº®ï¼Œæ‰€ä»¥å¸¸å¸¸ç”¨æ¥å®ç° çˆ†ç‚¸ çš„å…‰ç…§æ•ˆæœã€‚blendFuncçš„å‚æ•°æºé¢œè‰²åˆ†é‡ï¼šï¼ˆRsï¼ŒGsï¼ŒBsï¼ŒAsï¼‰ç›®æ ‡é¢œè‰²åˆ†é‡ï¼šï¼ˆRdï¼ŒGdï¼ŒBdï¼ŒAdï¼‰é•‚ç©ºæ•ˆæœï¼šgl.blendFunc(gl.ZERO,gl.ZERO) src_factor gl.ZERO è¡¨ç¤ºå¿½è§†æºé¢œè‰² dst_factor gl.ZERO è¡¨ç¤ºå¿½è§†ç›®æ ‡é¢œè‰² åŒæ—¶å¿½è§†æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ï¼Œå°±è¡¨ç¤ºé•‚ç©ºå¤„ç† gl.blendFunc(gl.ZERO,gl.ZERO)æ¶‰åŠåˆ°çš„è®¡ç®— é•‚ç©ºæ•ˆæœåªå–æºé¢œè‰²gl.blendFunc(gl.ONE,gl.ZERO) src_factor gl.ONE è¡¨ç¤ºå®Œå…¨ä¿ç•™æºé¢œè‰² dst_factor gl.ZERO è¡¨ç¤ºå¿½è§†ç›®æ ‡é¢œè‰² å®Œå…¨å¿½è§†åº•è‰²ï¼Œç›´æ¥å°†æºé¢œè‰²ç»˜åˆ¶åœ¨æ— è§†canvasèƒŒæ™¯ç”»å¸ƒçš„domå®¹å™¨ä¹‹ä¸­ gl.blendFunc(gl.ONE,gl.ZERO)æ¶‰åŠåˆ°çš„è®¡ç®— ç”±äºç‰©ä½“æ˜¯åŠé€æ˜çš„ï¼Œç›´æ¥å’Œbodyçš„é¢œè‰²æ··åˆåœ¨äº†ä¸€èµ·ï¼Œæ— è§†äº†canvasèƒŒæ™¯è‰²åªå–ç›®æ ‡é¢œè‰²gl.blendFunc(gl.ZERO,gl.ONE) src_factor gl.ONE è¡¨ç¤ºå¿½è§†æºé¢œè‰² dst_factor gl.ZERO è¡¨ç¤ºå®Œå…¨ä¿ç•™ç›®æ ‡é¢œè‰² å®Œå…¨å¿½è§†æºé¢œè‰²ï¼Œä¿ç•™ç›®æ ‡é¢œè‰²å°±è¡¨ç¤ºä¿å­˜ç”»å¸ƒï¼Œä»€ä¹ˆéƒ½ä¸ç»˜åˆ¶ å¥½åƒåœ¨ç”¨é€æ˜å¢¨æ°´ç”»ç”»ä¸€æ · gl.blendFunc(gl.ZERO,gl.ONE)æ¶‰åŠåˆ°çš„è®¡ç®— ç‰©ä½“çš„ç¡®æ˜¯ç”»äº†ï¼Œä½†åªæ˜¯é¢œè‰²æ˜¯é€æ˜çš„ï¼ˆç¬‘ï¼‰ åŠé€æ˜çš„ä¸‰ç»´ç‰©ä½“å½©è™¹æ°´æ™¶ åœ¨ColoredCubeåŸºç¡€ä¹‹ä¸Š è¿˜è®°çš„ColoredCubeè¿è¡Œæ•ˆæœå—ï¼Ÿhttp://localhost:4000/wiki/webgl/chapter_22.html#%E4%B8%BA%E7%AB%8B%E6%96%B9%E4%BD%93%E7%9A%84%E6%AF%8F%E4%B8%AA%E8%A1%A8%E9%9D%A2%E6%8C%87%E5%AE%9A%E9%A2%9C%E8%89%B2æŒ‰ç…§ä¹‹å‰ä»‹ç»çš„å®ç° Î±æ··åˆ çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºé¢œè‰²ç¼“å†²åŒºå¡«å…¥çš„æ•°æ®æ·»åŠ ä¸Šé€æ˜åº¦ï¼š let colors = new Float32Array([ 0.4, 0.4, 1.0, 0.4, 0.4, 0.4, 1.0,0.4, 0.4, 0.4, 1.0,0.4, 0.4, 0.4, 1.0,0.4, //front 0.4, 1.0, 1.0, 0.4, 0.4, 1.0, 1.0,0.4, 0.4, 1.0, 1.0,0.4, 0.4, 1.0, 1.0,0.4, //back 1.0, 1.0, 0.4, 0.4, 1.0, 1.0, 0.4,0.4, 1.0, 1.0, 0.4,0.4, 1.0, 1.0, 0.4,0.4, //left 0.4, 1.0, 0.4, 0.4, 0.4, 1.0, 0.4,0.4, 0.4, 1.0, 0.4,0.4, 0.4, 1.0, 0.4,0.4, //right 1.0, 0.4, 0.4, 0.4, 1.0, 0.4, 0.4,0.4, 1.0, 0.4, 0.4,0.4, 1.0, 0.4, 0.4,0.4, //up 1.0, 1.0, 1.0, 0.4, 1.0, 1.0, 1.0,0.4, 1.0, 1.0, 1.0,0.4, 1.0, 1.0, 1.0,0.4, //down]);initArrayBuffer(gl, a_Color, colors, 4, gl.FLOAT);å†åŠ ä¸Šå¼€å¯Î±æ··åˆçš„é…ç½®ä»£ç ï¼šgl.enable(gl.BLEND);gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);åº”è¯¥å°±å¯ä»¥å®ç°äº†ï¼Œä½†æ˜¯äº‹å®ä¸Šçš„è¿è¡Œæ•ˆæœå´å’ŒæœŸæœ›å¾—åˆ°çš„ä¸åŒï¼šå®é™…ä¸Šå¹¶æ²¡æœ‰å®ç°é€æ˜ä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°é€æ˜å‘¢ï¼Ÿç­”ï¼š å› ä¸ºå¼€å¯äº† DEPTH_TESTï¼ˆéšè—é¢æ¶ˆé™¤ï¼‰ ã€‚ gl.enable(gl.DEPTH_TEST);å¼€å¯äº†éšè—é¢æ¶ˆé™¤ä¼šä½¿å¾— è¢«éšè—çš„ç‰‡å…ƒæ ¹æœ¬ä¸è¢«ç»˜åˆ¶ ï¼Œ è‡ªç„¶æ›´ä¸ä¼šæœ‰æ··åˆè¿‡ç¨‹ã€‚æ‰€ä»¥åªéœ€è¦ å…³é—­gl.DEPTH_TEST å³å¯ã€‚ å¼€å¯DEPTH_TESTéšè—é¢æ²¡æœ‰è¢«ç»˜åˆ¶ï¼Œå› æ­¤ä¸å­˜åœ¨æ··åˆè¿‡ç¨‹ å…³é—­DEPTH_TESTå°†éšè—é¢çº³å…¥æ··åˆè¿‡ç¨‹ä¹‹ä¸­ é€æ˜ä¸ä¸é€æ˜ç‰©ä½“å…±å­˜å¦‚ä½•åŒæ—¶å®ç°éšè—é¢æ¶ˆé™¤å’ŒåŠé€æ˜æ•ˆæœï¼Ÿ BlendedCubeç›´æ¥æŠŠDEPTH_TESTå…³é—­äº†ï¼Œè¿™ç§æ–¹æ³•å¤ªç®€å•ç²—æš´ï¼Œä¸€ç‚¹éƒ½ä¸ä¼˜é›…ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸‹é¢è¿™ç§æœºåˆ¶åŒæ—¶å®ç° éšè—é¢æ¶ˆé™¤ å’Œ åŠé€æ˜æ•ˆæœã€‚æå‰å‰§é€ï¼š å°†é€æ˜ç‰©ä½“å’Œéé€æ˜ç‰©ä½“åˆ†å¼€ç»˜åˆ¶1.å¼€å¯gl.DEPTH_TESTgl.enable(gl.DEPTH_TEST);2.ç»˜åˆ¶å‡ºæ‰€æœ‰ä¸é€æ˜çš„ç‰©ä½“gl.drawElements(éé€æ˜ç‰©ä½“)3.ç¦æ­¢æ·±åº¦ç¼“å†²åŒºçš„å†™å…¥æ“ä½œæ·±åº¦ç¼“å†²åŒºæ˜¯ç”¨äºè¿›è¡Œ éšè—é¢æ¶ˆé™¤ çš„ï¼Œè¿™ä¸€æ­¥éœ€è¦ç¦æ­¢æ¥ä¸‹æ¥æ·±åº¦ç¼“å†²åŒºçš„ å†™å…¥æ“ä½œï¼Œä½¿ä¹‹å˜å¾— åªè¯»ã€‚gl.depthMask(false);4.ç»˜åˆ¶æ‰€æœ‰åŠé€æ˜ç‰©ä½“æ³¨æ„å®ƒä»¬åº”å½“æŒ‰ç…§ æ·±åº¦è¿›è¡Œæ’åºgl.drawElements(åŠé€æ˜ç‰©ä½“)5.é‡Šæ”¾æ·±åº¦ç¼“å†²åŒºé‡æ–°ä½¿æ·±åº¦ç¼“å†²åŒº å¯è¯»å†™gl.depthMask(true); BlendedWithDepthMask BlendedWithDepthMaskè¿è¡Œæ•ˆæœ> ä¸»è¦ç»˜åˆ¶é€»è¾‘function draw(gl, u_MvpMatrix, mvpMatrix, projMatrix) // 1. æ¸…é™¤ç¼“å†²åŒº gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // 2. ç»˜åˆ¶ä¸é€æ˜ç‰©ä½“ let n_Solid = initVertexBuffer_Solid(gl); gl.drawElements(gl.TRIANGLES,n_Solid,gl.UNSIGNED_BYTE,0); // 3.ç¦æ­¢æ·±åº¦ç¼“å†²åŒºçš„å†™å…¥æ“ä½œ gl.depthMask(false); // 4.ç»˜åˆ¶é€æ˜ç‰©ä½“ let n_Blend = initVertexBuffer_Blend(gl); gl.drawElements(gl.TRIANGLES,n_Blend,gl.UNSIGNED_BYTE,0); // 5.è§£é”æ·±åº¦ç¼“å†²åŒºå†™å…¥æ“ä½œ gl.depthMask(true);"},{"title":"åˆ‡æ¢ç€è‰²å™¨","path":"/wiki/WebGL/chapter_10_05.html","content":"ä¸€ä¸ªç€è‰²å™¨å¤Ÿç”¨å—ï¼Ÿ è¿™ä¸ªé—®é¢˜å°±å¥½åƒåˆ«äººé—®ä½ ï¼šä¸€å¤©ä¸€é¡¿é¥­èƒ½åƒé¥±å—ï¼Ÿä¸€å¹´ä¸€åŒè¢œå­å¤Ÿç©¿å—ï¼Ÿç¬”è®°æœ¬4Gå†…å­˜å¤Ÿç”¨å—ï¼Ÿç­”æ¡ˆè‡ªç„¶æ˜¯ å¯ä»¥ï¼Œä½†æ²¡å¿…è¦ï¼Œä¸åŒçš„ç‰©ä½“ç»å¸¸éœ€è¦ä½¿ç”¨ä¸åŒçš„ç€è‰²å™¨ç»˜åˆ¶ã€‚ å¦‚ä½•å®ç°åˆ‡æ¢ç€è‰²å™¨åˆ‡æ¢æ­¥éª¤ è¯´æ˜¯åˆ‡æ¢æ­¥éª¤ï¼Œå®é™…ä¸Šæ¯ä¸ªç»˜åˆ¶è¿‡ç¨‹çš„æ­¥éª¤éƒ½æ˜¯å®Œå…¨åˆ†ç¦»ï¼Œäº’ä¸å½±å“çš„ã€‚1.å‡†å¤‡é˜¶æ®µAå‡†å¤‡ç”¨æ¥ç»˜åˆ¶ Aç‰©ä½“ çš„ç€è‰²å™¨ ShaderA çš„ä»£ç 2.å‡†å¤‡é˜¶æ®µBå‡†å¤‡ç”¨æ¥ç»˜åˆ¶ Bç‰©ä½“ çš„ç€è‰²å™¨ ShaderB çš„ä»£ç 3.åˆ›å»ºé˜¶æ®µAè°ƒç”¨ createProgram() ï¼Œä½¿ç”¨ ShaderA åˆ›å»ºå‡ºç€è‰²å™¨ç¨‹åºå¯¹è±¡ ProgramA4.åˆ›å»ºé˜¶æ®µBè°ƒç”¨ createProgram() ï¼Œä½¿ç”¨ ShaderB åˆ›å»ºå‡ºç€è‰²å™¨ç¨‹åºå¯¹è±¡ ProgramB5.ç»˜åˆ¶Aâ‘ è°ƒç”¨ gl.useProgram() æŒ‡å®š ProgramA6.ç»˜åˆ¶Aâ‘¡é€šè¿‡ç¼“å†²åŒºå¯¹è±¡å‘ ShaderA ä¼ å…¥attributeå˜é‡å¹¶å¼€å¯7.ç»˜åˆ¶Aâ‘¢ç»˜åˆ¶A8.ç»˜åˆ¶Bâ‘ è°ƒç”¨ gl.useProgram() æŒ‡å®š ProgramB9.ç»˜åˆ¶Bâ‘¡é€šè¿‡ç¼“å†²åŒºå¯¹è±¡å‘ ShaderB ä¼ å…¥attributeå˜é‡å¹¶å¼€å¯10.ç»˜åˆ¶Bâ‘¢ç»˜åˆ¶B ProgramObject Code ProgramObjectè¿è¡Œæ•ˆæœshaderstoggle shaderinit buffer&vertexdrawuniform function// ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ç€è‰²å™¨// çº¯è‰²ç«‹æ–¹ä½“-é¡¶ç‚¹ç€è‰²å™¨let SOLID_VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_NormalMatrix; varying vec4 v_Color; void main() vec3 lightDirection = vec3(0.0, 0.0, 1.0); vec4 color = vec4(0.0,1.0,0.0,1.0); gl_Position = u_MvpMatrix * a_Position; vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal)); float nDotL = max(dot(normal,lightDirection), 0.0); v_Color = vec4(color.rgb * nDotL, color.a); `// çº¯è‰²ç«‹æ–¹ä½“-ç‰‡å…ƒç€è‰²å™¨let SOLID_FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `// çº¹ç†ç«‹æ–¹ä½“-é¡¶ç‚¹ç€è‰²å™¨let TEXTURE_VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Normal; attribute vec2 a_TexCoord; uniform mat4 u_MvpMatrix; uniform mat4 u_NormalMatrix; varying vec2 v_TexCoord; varying float v_NdotL; void main() vec3 lightDirection = vec3(0.0, 0.0, 1.0); gl_Position = u_MvpMatrix * a_Position; v_TexCoord = a_TexCoord; vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal)); v_NdotL = max(dot(normal, lightDirection), 0.0); `// çº¹ç†ç«‹æ–¹ä½“-ç‰‡å…ƒç€è‰²å™¨let TEXTURE_FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform sampler2D u_Sampler; varying vec2 v_TexCoord; varying float v_NdotL; void main() vec4 color = texture2D(u_Sampler, v_TexCoord); gl_FragColor = vec4( color.rgb*v_NdotL, color.a ); `// çº¯è‰²ç«‹æ–¹ä½“ç€è‰²å™¨ åˆ‡æ¢ä¸attributeå˜é‡åˆå§‹åŒ–function drawSolidCube(gl, program, o, x, angle, viewProjMatrix) gl.useProgram(program); initAttributeVariable(gl, program.a_Position, o.vertexBuffer); initAttributeVariable(gl, program.a_Normal, o.normalBuffer); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, o.indexBuffer); drawCube(gl, program, o, x, angle, viewProjMatrix);// çº¹ç†ç«‹æ–¹ä½“ç€è‰²å™¨ åˆ‡æ¢ä¸attributeå˜é‡åˆå§‹åŒ–function drawTexCube(gl,program,o,texture,x,angle,viewProjMatrix) gl.useProgram(program); initAttributeVariable(gl, program.a_Position, o.vertexBuffer); initAttributeVariable(gl, program.a_TexCoord, o.texCoordBuffer); initAttributeVariable(gl, program.a_Normal, o.normalBuffer); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, o.indexBuffer); gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D, texture); drawCube(gl, program, o, x, angle, viewProjMatrix);// ç”¨æ¥æ³¨å…¥attribute bufferçš„é€šç”¨å‡½æ•°function initAttributeVariable(gl, a_attribute, buffer) gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.vertexAttribPointer(a_attribute, buffer.num, buffer.type, false, 0, 0); gl.enableVertexAttribArray(a_attribute);// åˆå§‹åŒ–vertex bufferfunction initVertexBuffers(gl) let vertices = new Float32Array([ // Vertex coordinates 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0,-1.0, 1.0, 1.0,-1.0, 1.0, // v0-v1-v2-v3 front 1.0, 1.0, 1.0, 1.0,-1.0, 1.0, 1.0,-1.0,-1.0, 1.0, 1.0,-1.0, // v0-v3-v4-v5 right 1.0, 1.0, 1.0, 1.0, 1.0,-1.0, -1.0, 1.0,-1.0, -1.0, 1.0, 1.0, // v0-v5-v6-v1 up -1.0, 1.0, 1.0, -1.0, 1.0,-1.0, -1.0,-1.0,-1.0, -1.0,-1.0, 1.0, // v1-v6-v7-v2 left -1.0,-1.0,-1.0, 1.0,-1.0,-1.0, 1.0,-1.0, 1.0, -1.0,-1.0, 1.0, // v7-v4-v3-v2 down 1.0,-1.0,-1.0, -1.0,-1.0,-1.0, -1.0, 1.0,-1.0, 1.0, 1.0,-1.0 // v4-v7-v6-v5 back ]); let normals = new Float32Array([ // Normal 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, // v0-v1-v2-v3 front 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, // v0-v3-v4-v5 right 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v5-v6-v1 up -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, // v1-v6-v7-v2 left 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, // v7-v4-v3-v2 down 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0 // v4-v7-v6-v5 back ]); let texCoords = new Float32Array([ // Texture coordinates 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v1-v2-v3 front 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, // v0-v3-v4-v5 right 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, // v0-v5-v6-v1 up 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v1-v6-v7-v2 left 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, // v7-v4-v3-v2 down 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0 // v4-v7-v6-v5 back ]); let indices = new Uint8Array([ // Indices of the vertices 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]); let o = new Object(); // å°†é¡¶ç‚¹æ•°æ®å†™å…¥buffer o.vertexBuffer = initArrayBufferForLaterUse(gl, vertices, 3, gl.FLOAT); o.normalBuffer = initArrayBufferForLaterUse(gl, normals, 3, gl.FLOAT); o.texCoordBuffer = initArrayBufferForLaterUse(gl, texCoords, 2, gl.FLOAT); o.indexBuffer = initElementArrayBufferForLaterUse(gl, indices, gl.UNSIGNED_BYTE); o.numIndices = indices.length; gl.bindBuffer(gl.ARRAY_BUFFER, null); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null); return o;// åˆå§‹åŒ–texturefunction initTextures(gl, program) let texture = gl.createTexture(); let image = new Image(); image.onload = function () gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1); // Flip the image Y coordinate gl.activeTexture(gl.TEXTURE0); gl.bindTexture(gl.TEXTURE_2D, texture); gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR); gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image); gl.useProgram(program); gl.uniform1i(program.u_Sampler, 0); gl.bindTexture(gl.TEXTURE_2D, null); ; image.src = ../img/sky.jpg; return texture;// åˆå§‹åŒ–ARRAY_BUFFERç±»å‹bufferå†…å­˜function initArrayBufferForLaterUse(gl,data,num,type) let buffer = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buffer); gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW); buffer.num = num; buffer.type = type; return buffer;// ç”¨äºåˆ›å»ºELEMENT_ARRAY_BUFFERçš„é€šç”¨å‡½æ•°function initElementArrayBufferForLaterUse(gl,data,type) let buffer = gl.createBuffer(); gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer); gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW); buffer.type = type; return buffer;// ç”¨äºè¿›è¡Œå˜æ¢çš„çŸ©é˜µlet g_modelMatrix = new Matrix4();let g_mvpMatrix = new Matrix4();let g_normalMatrix = new Matrix4();// ç»˜åˆ¶ç«‹æ–¹ä½“çš„é€šç”¨å‡½æ•°function drawCube(gl,program,o,x,angle,viewProjMatrix) g_modelMatrix.setTranslate( x, 0, 0 ).rotate( 20, 1, 0, 0 ).rotate( angle, 0, 1, 0 ); // è®¡ç®—normalMatrix g_normalMatrix.setInverseOf(g_modelMatrix); g_normalMatrix.transpose(); gl.uniformMatrix4fv(program.u_NormalMatrix, false, g_normalMatrix.elements); g_mvpMatrix.set(viewProjMatrix); g_mvpMatrix.multiply(g_modelMatrix); gl.uniformMatrix4fv(program.u_MvpMatrix, false, g_mvpMatrix.elements); gl.drawElements(gl.TRIANGLES, o.numIndices, gl.UNSIGNED_BYTE,0);let ANGLE_STEP = 30;let last = Date.now();function animate(angle) let now = Date.now(); let ellapse = now - last; last = now; return ((angle + ANGLE_STEP * ellapse / 1000)) % 360;function main() let canvas = document.getElementById(webgl); let gl = getWebGLContext(canvas); // åˆ›å»ºç€è‰²å™¨ç¨‹åºå¯¹è±¡ let solidProgram = createProgram(gl, SOLID_VSHADER_SOURCE, SOLID_FSHADER_SOURCE); let texProgram = createProgram(gl, TEXTURE_VSHADER_SOURCE, TEXTURE_FSHADER_SOURCE); // è·å–attributeå’Œuniformå¯¹è±¡ solidProgram.a_Position = gl.getAttribLocation(solidProgram, a_Position); solidProgram.a_Normal = gl.getAttribLocation(solidProgram, a_Normal); solidProgram.u_MvpMatrix = gl.getUniformLocation(solidProgram, u_MvpMatrix); solidProgram.u_NormalMatrix = gl.getUniformLocation(solidProgram, u_NormalMatrix); texProgram.a_Position = gl.getAttribLocation(texProgram, a_Position); texProgram.a_TexCoord = gl.getAttribLocation(texProgram, a_TexCoord); texProgram.a_Normal = gl.getAttribLocation(texProgram, a_Normal); texProgram.u_MvpMatrix = gl.getUniformLocation(texProgram, u_MvpMatrix); texProgram.u_NormalMatrix = gl.getUniformLocation(texProgram, u_NormalMatrix); texProgram.u_Sampler = gl.getUniformLocation(texProgram, u_Sampler); // åˆå§‹åŒ–attribute buffer let cube = initVertexBuffers(gl); let texture = initTextures(gl, texProgram); gl.enable(gl.DEPTH_TEST); gl.clearColor(0.0, 0.0, 0.0, 1.0); let viewProjMatrix = new Matrix4(); viewProjMatrix.setPerspective( 30.0, canvas.width / canvas.height, 1.0, 100.0 ).lookAt( 0.0, 0.0, 15.0, 0, 0, 0, 0, 1, 0 ); let currentAngle = 0.0; let tick = function () gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); currentAngle = animate(currentAngle); drawSolidCube(gl, solidProgram, cube, -2.0, currentAngle, viewProjMatrix); drawTexCube(gl, texProgram, cube, texture, 2.0, currentAngle, viewProjMatrix); window.requestAnimationFrame(tick); tick(); åˆ‡æ¢ç€è‰²å™¨å¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ ç­”ï¼š åœ¨åŒä¸€ä¸ªåœºæ™¯ä¸­ç»˜åˆ¶å‡ºå„ç§ä¸åŒæ•ˆæœç»„åˆã€‚æ¡ˆä¾‹å¾…è¡¥å……"},{"title":"é˜´å½±","path":"/wiki/WebGL/chapter_10_07.html","content":"é˜´å½±è´´å›¾ å®ç°é˜´å½±çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæœ¬èŠ‚ä»‹ç»çš„æ–¹æ³•å«åš é˜´å½±è´´å›¾ï¼Œé˜´å½±è´´å›¾ï¼ˆshadow mapï¼‰ ä¹Ÿç§° æ·±åº¦è´´å›¾ï¼ˆdepth mapï¼‰ å¦‚ä½•å®ç°é˜´å½±é˜´å½±è´´å›¾çš„åŸç† ä½¿ç”¨ä¸¤å¯¹ç€è‰²å™¨ä»¥å®ç°é˜´å½±ï¼Œè®¾ç¬¬ä¸€å¯¹ç€è‰²å™¨ä¸ºS1ï¼Œç¬¬äºŒå¯¹ç€è‰²å™¨ä¸ºS2ï¼Œå…‰æºä¸ºOï¼Œç‰©ä½“ä¸Šå­˜åœ¨ä¸€ç‚¹P1ï¼ŒP1åœ¨é˜´å½±ä¸Šçš„ä½ç½®æ—¶P2S1è®¡ç®—å‡ºOP1ä½¿ç”¨ä¸€å¼ çº¹ç†å›¾åƒå°†S1çš„è®¡ç®—ç»“æœä¼ å…¥S2ä¸­è¿™å¼ çº¹ç†å›¾åƒå°±æ˜¯ é˜´å½±è´´å›¾ï¼ˆshadow mapï¼‰ é˜´å½±æ˜ å°„çš„å®é™…æ­¥éª¤ å³å°†è§†ç‚¹ç§»åˆ°å…‰æºä½ç½®å¤„å°†æ¯ä¸ªåƒç´ æœ€å‰é¢çš„zå€¼å†™å…¥åˆ°é˜´å½±è´´å›¾ä¸­å¦‚p1çš„zå€¼å°†è§†ç‚¹ç§»å›åŸæ¥çš„ä½ç½®è®¡ç®—å‡ºæ¯ä¸ªç‰‡å…ƒåœ¨å…‰æºåæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œä¸é˜´å½±è´´å›¾ä¸­è®°å½•çš„zå€¼æ¯”è¾ƒå¦‚p2çš„zå€¼ä¸p1çš„zå€¼å¦‚æœå‰è€…å¤§äºåè€…ï¼Œå°±è¯´æ˜å½“å‰ç‰‡å…ƒå¤„åœ¨é˜´å½±ä¹‹ä¸­ï¼Œç”¨è¾ƒæ·±é¢œè‰²ç»˜åˆ¶p2.z p1.z ï¼Œå› æ­¤p2å¤„äºé˜´å½±ä¹‹ä¸­ ShadowShadow Code Shadowè¿è¡Œæ•ˆæœshadermain&&aniamtedrawbufferframebuffer// é˜´å½±vertex shaderlet SHADOW_VSHADER_SOURCE = ` attribute vec4 a_Position; uniform mat4 u_MvpMatrix; void main() gl_Position = u_MvpMatrix * a_Position; `// é˜´å½±fragment shaderlet SHADOW_FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif void main() // write the z-value in r gl_FragColor = vec4(gl_FragCoord.z, 0.0, 0.0, 0.0); `// vertex shaderlet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; uniform mat4 u_MvpMatrix; uniform mat4 u_MvpMatrixFromLight; // å…‰æºåæ ‡ç³» varying vec4 v_PositionFromLight; // å…‰æºåæ ‡ç³»ä¸‹çš„ç‰©ä½“åæ ‡ varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; v_PositionFromLight = u_MvpMatrixFromLight * a_Position; v_Color = a_Color; `// fragment shaderlet FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform sampler2D u_ShadowMap; varying vec4 v_PositionFromLight; varying vec4 v_Color; void main() vec3 shadowCoord = (v_PositionFromLight.xyz/v_PositionFromLight.w)/2.0 + 0.5; vec4 rgbaDepth = texture2D(u_ShadowMap, shadowCoord.xy); float depth = rgbaDepth.r; float visibility = (shadowCoord.z depth + 0.005) ? 0.7 : 1.0; gl_FragColor = vec4(v_Color.rgb * visibility, v_Color.a); `// å¸§ç¼“å†²åŒºæ¸²æŸ“å°ºå¯¸let OFFSCREEN_WIDTH = 2048 let OFFSCREEN_HEIGHT = 2048 // å…‰ç…§ç‚¹let LIGHT_X = 0let LIGHT_Y = 7let LIGHT_Z = 2function main() let canvas = document.getElementById(webgl) let gl = getWebGLContext(canvas) if (!gl) console.log(failed to get the rendering context for webgl) return; // initialize shaders for generating a shadow map let shadowProgram = createProgram(gl, SHADOW_VSHADER_SOURCE, SHADOW_FSHADER_SOURCE) shadowProgram.a_Position = gl.getAttribLocation(shadowProgram, a_Position) shadowProgram.u_MvpMatrix = gl.getUniformLocation(shadowProgram, u_MvpMatrix) if (shadowProgram.a_Position 0 || !shadowProgram.u_MvpMatrix) console.log(failed to get the storage location of attribute or uniform variable from shadowProgram) return // initialize shaders for regular drawing let normalProgram = createProgram(gl, VSHADER_SOURCE, FSHADER_SOURCE); normalProgram.a_Position = gl.getAttribLocation(normalProgram, a_Position) normalProgram.a_Color = gl.getAttribLocation(normalProgram, a_Color) normalProgram.u_MvpMatrix = gl.getUniformLocation(normalProgram, u_MvpMatrix) normalProgram.u_MvpMatrixFromLight = gl.getUniformLocation(normalProgram, u_MvpMatrixFromLight) normalProgram.u_ShadowMap = gl.getUniformLocation(normalProgram, u_ShadowMap) if (normalProgram.a_Position 0 || normalProgram.a_Color 0 || !normalProgram.u_MvpMatrix || !normalProgram.u_MvpMatrixFromLight || !normalProgram.u_ShadowMap ) console.log(failed to get the storage location of attribute or uniform varibale fron normalProgram) return // set the vertex information let triangle = initVertexBuffersForTriangle(gl) let plane = initVertexBuffersForPlane(gl) if (!triangle || !plane) console.log(failed to set the vertex information) return // initialize framebuffer object (FBO) let fbo = initFramebufferObject(gl) if (!fbo) console.log(failed to initialize frame buffer object) return gl.activeTexture(gl.TEXTURE0) // set a texture obejct to the texture unit gl.bindTexture(gl.TEXTURE_2D, fbo.texture) // set the clear color and enable the depth tes gl.clearColor(0, 0, 0, 1) gl.enable(gl.DEPTH_TEST) // prepare a view projection matrix for generating a shadow map let viewProjMatrixFromLight = new Matrix4() viewProjMatrixFromLight.setPerspective( 70.0, OFFSCREEN_WIDTH/OFFSCREEN_HEIGHT, 1.0, 100.0 ).lookAt( LIGHT_X, LIGHT_Y, LIGHT_Z, 0, 0, 0, 0, 1, 0 ) // prepare a view projection matrix for regular drawing let viewProjMatrix = new Matrix4() viewProjMatrix.setPerspective( 45, canvas.width/canvas.clientHeight, 1.0, 100.0 ).lookAt( 0.0, 7.0, 9.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 ) let currentAngle = 0.0 // a model view projection matrix from light source for triangle let mvpMatrixFromLight_t = new Matrix4() // a model view projection matrix from light source for plant let mvpMatrixFromLight_p = new Matrix4() let tick = function () currentAngle = animate(currentAngle) /** æ­¥éª¤1 ä½¿ç”¨é˜´å½±ç€è‰²å™¨è®¡ç®—å‡ºé˜´å½±è´´å›¾ **/ gl.bindFramebuffer(gl.FRAMEBUFFER, fbo) // change the drawing destination to FBO gl.viewport(0, 0, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT) // set view port for FBO gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) // clear FBO gl.useProgram(shadowProgram) // set shaders for generating a shadow map // draw the triangle and the plane for generating a shadow map drawTriangle(gl, shadowProgram, triangle, currentAngle, viewProjMatrixFromLight) mvpMatrixFromLight_t.set(g_mvpMatrix) drawPlane(gl, shadowProgram, plane, viewProjMatrixFromLight) mvpMatrixFromLight_p.set(g_mvpMatrix) /** æ­¥éª¤2 ä½¿ç”¨ç»˜å›¾ç€è‰²å™¨æŒ‰ç…§é˜´å½±æ˜ å°„åŸç†ç»˜å›¾ **/ gl.bindFramebuffer(gl.FRAMEBUFFER, null) gl.viewport(0, 0, canvas.width, canvas.height) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) gl.useProgram(normalProgram) gl.uniform1i(normalProgram.u_ShadowMap, 0) // Pass 0 because gl.TEXTURE0 is enabled gl.uniformMatrix4fv(normalProgram.u_MvpMatrixFromLight, false, mvpMatrixFromLight_t.elements) drawTriangle(gl, normalProgram, triangle, currentAngle, viewProjMatrix) gl.uniformMatrix4fv(normalProgram.u_MvpMatrixFromLight, false, mvpMatrixFromLight_p.elements) drawPlane(gl, normalProgram, plane, viewProjMatrix) window.requestAnimationFrame(tick) tick()let ANGLE_STEP = 40let last = Date.now()function animate(angle) let now = Date.now() let elapsed = now - last last = now return (angle + elapsed * ANGLE_STEP / 1000) % 360let g_modelMatrix = new Matrix4()let g_mvpMatrix = new Matrix4()function drawTriangle(gl, program, triangle, angle, viewProjMatrix) // ç»˜åˆ¶æ—‹è½¬ä¸‰è§’å½¢ g_modelMatrix.setRotate( angle, 0, 1, 0 ) draw(gl, program, triangle, viewProjMatrix)function drawPlane(gl, program, plane, viewProjMatrix) // ç»˜åˆ¶æŠ•å½±å¹³é¢ g_modelMatrix.setRotate( -45, 0, 1, 1 ) draw(gl, program, plane, viewProjMatrix)// ç»˜åˆ¶åŠŸèƒ½å‡½æ•°function draw(gl, program, o, viewProjMatrix) initAttributeVariable(gl, program.a_Position, o.vertexBuffer) if (program.a_Color != undefined) initAttributeVariable(gl, program.a_Color, o.colorBuffer) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, o.indexBuffer) g_mvpMatrix.set( viewProjMatrix ).multiply( g_modelMatrix ) gl.uniformMatrix4fv(program.u_MvpMatrix, false, g_mvpMatrix.elements) gl.drawElements(gl.TRIANGLES, o.numIndices, gl.UNSIGNED_BYTE, 0)// å†™å…¥attributeæ•°æ®function initAttributeVariable(gl, a_attribute, buffer) gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.vertexAttribPointer(a_attribute, buffer.num, buffer.type, false, 0, 0) gl.enableVertexAttribArray(a_attribute)// å¡«å…¥planeç»˜åˆ¶æ‰€éœ€ç¼“å†²åŒºæ•°æ®function initVertexBuffersForPlane(gl) let vertices = new Float32Array([ 3.0, -1.7, 2.5, -3.0, -1.7, 2.5, -3.0, -1.7, -2.5, 3.0, -1.7, -2.5 ]) let colors = new Float32Array([ 1.0, 1.0, 0.7, 1.0, 0.7, 1.0, 0.7, 1.0, 1.0, 0.7, 0.7, 0.7 ]) let indices = new Uint8Array([ 0, 1, 2, 0, 2, 3 ]) let o = new Object() o.vertexBuffer = initArrayBufferForLaterUse(gl, vertices, 3, gl.FLOAT) o.colorBuffer = initArrayBufferForLaterUse(gl, colors, 3, gl.FLOAT) o.indexBuffer = initElementArrayBufferForLaterUse(gl, indices, gl.UNSIGNED_BYTE) if (!o.vertexBuffer || !o.colorBuffer || !o.indexBuffer) return null o.numIndices = indices.length gl.bindBuffer(gl.ARRAY_BUFFER, null) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null) return o// å¡«å…¥triangleç»˜åˆ¶æ‰€éœ€ç¼“å†²åŒºæ•°æ®function initVertexBuffersForTriangle(gl) let vertices = new Float32Array([ -0.8, 3.5, 0.0, 0.8, 3.5, 0.0, 0.0, 3.5, 1.8 ]) let colors = new Float32Array([ 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0 ]) let indices = new Uint8Array([ 0, 1, 2 ]) let o = new Object() o.vertexBuffer = initArrayBufferForLaterUse(gl, vertices, 3, gl.FLOAT) o.colorBuffer = initArrayBufferForLaterUse(gl, colors, 3, gl.FLOAT) o.indexBuffer = initElementArrayBufferForLaterUse(gl, indices, gl.UNSIGNED_BYTE) if (!o.vertexBuffer || !o.colorBuffer || !o.indexBuffer) return null o.numIndices = indices.length gl.bindBuffer(gl.ARRAY_BUFFER, null) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null) return ofunction initArrayBufferForLaterUse(gl, data, num, type) let buffer = gl.createBuffer() if (!buffer) console.log(failed to create the buffer object) return null gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW) buffer.num = num buffer.type = type return bufferfunction initElementArrayBufferForLaterUse(gl, data, type) let buffer = gl.createBuffer() if (!buffer) console.log(failed to create the buffer object) return null gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer) gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW) buffer.type = type return buffer// åˆ›å»ºå¸§ç¼“å†²åŒºå¯¹è±¡function initFramebufferObject(gl) let framebuffer, texture, depthBuffer // error handling function let error = function () if (framebuffer) gl.deleteFramebuffer(framebuffer) if (texture) gl.deleteTexture(texture) if (depthBuffer) gl.deleteRenderbuffer(depthBuffer) return null // åˆ›å»ºå¸§ç¼“å†²åŒºå¯¹è±¡ framebuffer = gl.createFramebuffer() if (!framebuffer) console.log(failed to create frame buffer object) return error() // åˆ›å»ºçº¹ç†ç¼“å†²åŒºå¯¹è±¡å¹¶è®¾ç½®å°ºå¯¸ texture = gl.createTexture() if (!texture) console.log(failed to create texture object) return error() gl.bindTexture(gl.TEXTURE_2D, texture) gl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT, 0, gl.RGBA, gl.UNSIGNED_BYTE, null ) gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR ) // åˆ›å»ºæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡å¹¶è®¾ç½®å°ºå¯¸ depthBuffer = gl.createRenderbuffer() if (!depthBuffer) console.log(failed to create depthbuffer object) return error() gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer) gl.renderbufferStorage( gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT ) // å°†çº¹ç†ç¼“å†²åŒºå’Œæ¸²æŸ“ç¼“å†²åŒºä¸æ¸²æŸ“ç¼“å†²åŒºè”ç³»èµ·æ¥ gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer) gl.framebufferTexture2D( gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0 ) gl.framebufferRenderbuffer( gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer ) // æ£€æŸ¥å¸§ç¼“å†²åŒºçŠ¶æ€ let e = gl.checkFramebufferStatus(gl.FRAMEBUFFER) if (gl.FRAMEBUFFER_COMPLETE !== e) console.log(Frame buffer object is incomplete: + e.toString()) return error() // ä¿ç•™æ‰€éœ€çš„æ•°æ® framebuffer.texture = texture // è§£ç»‘å®š gl.bindFramebuffer(gl.FRAMEBUFFER, null) gl.bindTexture(gl.TEXTURE_2D, null) gl.bindRenderbuffer(gl.RENDERBUFFER, null) return framebuffer æ­¥éª¤åˆ†è§£æ­¥éª¤1ï¼šè·å–é˜´å½±è´´å›¾ ç»˜åˆ¶ç›®æ ‡ï¼š å¸§ç¼“å†²åŒºå¯¹è±¡ ç»˜åˆ¶è§†ç‚¹ï¼š å…‰æº ç»˜åˆ¶ç€è‰²å™¨ï¼š é¡¶ç‚¹ç€è‰²å™¨ï¼šè´Ÿè´£å°†é¡¶ç‚¹åæ ‡åˆ‡æ¢åˆ°å…‰æºåæ ‡ç³»ä¸‹ ç‰‡å…ƒç€è‰²å™¨ï¼šå°†ç‰‡å…ƒçš„zå€¼å†™å…¥çº¹ç†è´´å›¾ä¸­ å¦‚ä½•ä½¿ç”¨æ¯ä¸ªç‰‡å…ƒçš„zå€¼åˆ¶ä½œä¸€å¼ é˜´å½±è´´å›¾ï¼Ÿ å…‰æºè§†è§’ä¸‹è®¡ç®—é˜´å½±è´´å›¾gl_FragColor = vec4(gl_FragCoord.z. 0.0, 0.0, 0.0);å®é™…ä¸Šå­˜å…¥é˜´å½±è´´å›¾çš„å€¼ä¹Ÿå°±æ˜¯æ¯ä¸ªç‰‡å…ƒçš„ gl_FragCoord.z çš„å€¼gl_FragCoordgl_FragCoord æ˜¯ vec4 ç±»å‹çš„ gl_FragCoord.xyï¼šç‰‡å…ƒåœ¨å±å¹•ä¸Šçš„åæ ‡ gl_FragCoord.zï¼š ç‰‡å…ƒçš„æ·±åº¦å€¼ gl_FragCoordæ˜¯å¦‚ä½•è¢«è®¡ç®—å‡ºæ¥çš„ï¼Ÿç­”ï¼š gl_FragCoordæ˜¯ç”± gl_Positionå½’ä¸€åŒ– å¾—åˆ°çš„ã€‚ä» [-1.0, 1.0] å½’ä¸€åŒ–åˆ° [0.0, 1.0] gl_FragCoord.z 0.0 è¡¨ç¤ºç‰‡å…ƒåœ¨ è¿‘è£å‰ªé¢ ä¸Š gl_FragCoord.z 1.0 è¡¨ç¤ºç‰‡å…ƒåœ¨ è¿œè£å‰ªé¢ ä¸Š å½’ä¸€åŒ–å…¬å¼ gl_FragCoord.xyz = (gl_Position.xyz/gl_Position.w)/2.0+0.5 æ­¥éª¤2ï¼šä½¿ç”¨é˜´å½±è´´å›¾ ç»˜åˆ¶ç›®æ ‡ï¼š é¢œè‰²ç¼“å†²åŒº ç»˜åˆ¶è§†ç‚¹ï¼š åŸè§†ç‚¹ è®¡ç®—å‡ºæ¥çš„é˜´å½±è´´å›¾è¦æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ æ¯ä¸€ä¸ªç‰‡å…ƒéƒ½æœ‰ä¸¤ä¸ªå€¼ï¼šå…‰ç…§åæ ‡ç³»ä¸‹çš„zå€¼ï¼ˆv_PositionFromLight.zï¼‰è¯¥ç‰‡å…ƒå¯¹åº”é˜´å½±è´´å›¾ä¸­å­˜å‚¨çš„zå€¼(shadowMap)éœ€è¦å°†è¿™ä¸¤ä¸ªå€¼æ‹¿æ¥æ¯”è¾ƒï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼šé—®é¢˜1ï¼šæ€ä¹ˆè·å–ç‰‡å…ƒåœ¨å…‰ç…§åæ ‡ç³»ä¸‹çš„zå€¼å‘¢ï¼Ÿç­”ï¼š åªéœ€è¦ a_Position é¡¶ç‚¹åæ ‡ u_MvpMatrixFromLight å…‰æºæ¨¡å‹è§†å›¾æŠ•å½±çŸ©é˜µ è®¡ç®—å…‰æºMVPçŸ©é˜µä¸‹çš„é¡¶ç‚¹åæ ‡å³å¯ï¼š v_PositionFromLight = u_MvpMatrixFromLight * a_Position;é—®é¢˜2ï¼šæ€ä¹ˆè·å–ç‰‡å…ƒå¯¹åº”shadowMapä¸­å­˜å‚¨çš„å¯¹åº”å€¼å‘¢ï¼Ÿéœ€è¦ä¸¤æ­¥ï¼š æ ¹æ®ä¸Šä¸€æ­¥è®¡ç®—å‡ºæ¥çš„v_PositionFromLightè½¬åŒ–ä¸ºçº¹ç´ åæ ‡ æ ¹æ®çº¹ç´ åæ ‡ä»é˜´å½±è´´å›¾ä¸­æŠ½å–å¯¹åº”çº¹ç´  æ­¥éª¤1ï¼šå°†å…‰ç…§åæ ‡ç³»ä¸‹çš„é¡¶ç‚¹åæ ‡è½¬åŒ–ä¸ºçº¹ç´ åæ ‡ åŒæ ·éœ€è¦å¯¹é¡¶ç‚¹åæ ‡è¿›è¡Œ çº¹ç´ å½’ä¸€åŒ–å¤„ç†ï¼Œè¿™æ˜¯ç”±äºé¡¶ç‚¹åæ ‡å’Œçº¹ç´ åæ ‡çš„åŒºé—´ä¸åŒï¼šé¡¶ç‚¹åæ ‡ï¼š[-1.0, 1.0]çº¹ç´ åæ ‡ï¼š [0.0, 1.0]å½’ä¸€åŒ–å¤„ç†ä¸gl_Positionåˆ°gl_FragCoordå½’ä¸€åŒ–çš„è¿‡ç¨‹ç›¸ä¼¼s = (v_PositionFromLight.x/v_PositionFromLight.w)/2.0+0.5;t = (v_PositionFromLight.y/v_PositionFromLight.w)/2.0+0.5;å°†å½’ä¸€åŒ–å¾—åˆ°çš„çº¹ç´ åæ ‡æ”¾åˆ°shadowCoordä¸­å»vec3 shadowCoord = (v_PositionFromLight.xyz/v_PositionFromLight.w)/2.0+0.5;shadowCoordåŒ…å«äº†å¾ˆå¤šä¿¡æ¯ï¼šshadowCoord.xyï¼š è¯¥ç‰‡å…ƒå¯¹åº”çš„shadowMapåæ ‡shadowCoord.zï¼šå½“å‰ç‰‡å…ƒåœ¨å…‰æºåæ ‡ç³»ä¸­çš„å½’ä¸€åŒ–zå€¼ æ­¥éª¤2ï¼šæŠ½å–é˜´å½±è´´å›¾ä¸­çš„çº¹ç´  æ—¢ç„¶è®¡ç®—å‡ºshadowCoordï¼Œå‰©ä¸‹çš„å·¥ä½œå°±æ¯”è¾ƒç®€å•äº†ï¼Œå¯ä»¥é€šè¿‡ shadowCoord.xy ä» shadowMap ä¸­æŠ½å–çº¹ç´ ï¼Œè¿™é‡Œåˆ«å¿˜äº† å†…æ’è¿‡ç¨‹depthé‡Œæœ€ç»ˆæ”¾ç€é˜´å½±è´´å›¾ä¸­å¯¹åº”çš„zå€¼vec4 rgbaDepth = texture2D(u_ShadowMap, shadowCoord.xy);float depth = rgbaDepth.r;ä» é—®é¢˜2 ä¸­ï¼Œæˆ‘ä»¬è·å¾—äº†ç”¨äºæ¯”è¾ƒçš„ä¸¤ä¸ªå€¼ï¼šshadowCoord.z å…‰ç…§åæ ‡ç³»ä¸‹è¢«å½’ä¸€åŒ–çš„ç‰‡å…ƒçš„zå€¼depth åŒä¸€ç‰‡å…ƒå¯¹åº”çš„é˜´å½±è´´å›¾ä¸­çš„å€¼æ¥ä¸‹æ¥åªéœ€è¦å°†è¿™ä¸¤ä¸ªå€¼æ‹¿æ¥æ¯”è¾ƒå°±å¯ä»¥äº†ï¼šfloat visibility = (shadowCoord.z depth +0.005)?0.7:1.0;gl_FragColor = vec4(v_Color.rgb * visibility, v_Color.a); é©¬èµ«å¸¦(Mach band) ä¸ºä»€ä¹ˆåœ¨æ¯”è¾ƒzå€¼å’Œé˜´å½±è´´å›¾å€¼çš„æ—¶å€™è¦å¤šç»™é˜´å½±è´´å›¾åŠ ä¸Š 0.005?å¦‚æœæŠŠè¿™0.005æ‹¿æ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿfloat visibility = (shadowCoord.z depth)?0.7:1.0;é©¬èµ«å¸¦ä¸ºä»€ä¹ˆä¼šå‡ºç°é©¬èµ«å¸¦ï¼Ÿç­”ï¼š ç”±äºç”¨äºæ¯”è¾ƒçš„ä¸¤ä¸ªå€¼å­˜åœ¨ ç²¾åº¦åå·® shadowCoord.z ç±»å‹ï¼šRGBAåˆ†é‡ ä½æ•°ï¼š8ä½ ç²¾åº¦ï¼š1256 depth ç±»å‹ï¼šfloat ä½æ•°ï¼š16ä½ ç²¾åº¦ï¼š165536 å¦‚ä½•æ¶ˆé™¤é©¬èµ«å¸¦ç­”ï¼š ç»™è¾ƒå¤§ç²¾åº¦çš„å€¼åŠ ä¸Šä¸€ä¸ªåç§»é‡ã€‚ æ³¨æ„ï¼š åç§»é‡åº”å½“ç•¥å¤§äºç²¾åº¦ å¦‚ï¼šN M ?N: 8ä½ ç²¾åº¦1256Mï¼š16ä½ ç²¾åº¦165536å› ä¸ºMç²¾åº¦å€¼è¾ƒå¤§ï¼Œæ‰€ä»¥åº”è¯¥åŠ ä¸Šä¸€ä¸ªç•¥å¤§äº1256çš„å€¼ï¼ˆ0.005ï¼‰âˆ´ N M + 0.005 é˜´å½±ç»˜åˆ¶æ­¥éª¤ Step1 programå‡†å¤‡ç»˜åˆ¶çš„ç€è‰²å™¨ç¨‹åºStep2 bufferå‡†å¤‡ç»˜åˆ¶å›¾å½¢çš„é¡¶ç‚¹æ•°æ®Step3 frameBufferåˆ›å»ºå¸§ç¼“å†²åŒºå¯¹è±¡Step4 bindTextureå°†0å·çº¹ç†ç»‘å®šåˆ°å¸§ç¼“å†²åŒºçš„çº¹ç†å¯¹è±¡ä¸ŠStep5 count shadowMapåˆ‡æ¢å…‰æºè§†è§’ï¼Œè®¡ç®—å‡ºé˜´å½±è´´å›¾Step6 draw by shadowMapåˆ‡æ¢å±å¹•è§†è§’ï¼Œä½¿ç”¨é˜´å½±è´´å›¾å¼€å§‹ç»˜å›¾ æé«˜ç²¾åº¦Shadow.jså­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ Shadow.jså­˜åœ¨ç²¾åº¦ç¼ºé™·é—®é¢˜ï¼š è¿‘è·ç¦»å…‰æºlet LIGHT_X = 0let LIGHT_Y= 7let LIGHT_Z= 2è¿‘è·ç¦»å…‰æº è¿œè·ç¦»å…‰æºlet LIGHT_X = 0let LIGHT_Y= 40let LIGHT_Z= 2è¿œè·ç¦»å…‰æº å­˜åœ¨ç²¾åº¦ç¼ºé™·çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ éšç€å…‰æºä¸ç…§å°„ç‰©é—´è·çš„å˜å¤§ï¼Œgl_FragCoord.zçš„å€¼ä¹Ÿä¼šéšä¹‹å˜å¤§ï¼Œæœ€ç»ˆ8ä½çš„Råˆ†é‡æ— æ³•å­˜å‚¨ä¸‹gl_FragCoord.zï¼Œå¯¼è‡´ç²¾åº¦ç¼ºé™· Shadow_highp å…‰æºä½ç½®ï¼š(0, 40, 4) 8ä½ç²¾åº¦Shadow.jsç»˜åˆ¶æ•ˆæœ æé«˜ç²¾åº¦Shadow_highp.jsç»˜åˆ¶æ•ˆæœ é˜´å½±ç‰‡å…ƒç€è‰²å™¨ç»˜åˆ¶ç‰‡å…ƒç€è‰²å™¨let SHADOW_FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif void main() const vec4 bitShift = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0); const vec4 bitMask = vec4(1.0/256.0, 1.0/256.0, 1.0/256.0, 0.0); vec4 rgbaDepth = fract(gl_FragCoord.z * bitShift); rgbaDepth -= rgbaDepth.gbaa * bitMask; gl_FragColor = rgbaDepth; `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; varying vec4 v_PositionFromLight; uniform sampler2D u_ShadowMap; float unpackDepth(const in vec4 rgbaDepth) const vec4 bitShift = vec4(1.0,1.0/256.0,1.0/(256.0*256.0),1.0/(256.0*256.0*256.0)); float depth = dot(rgbaDepth, bitShift); return depth; void main() vec3 shadowCoord = (v_PositionFromLight.xyz/v_PositionFromLight.w)/2.0 + 0.5; vec4 rgbaDepth = texture2D(u_ShadowMap, shadowCoord.xy); float depth = unpackDepth(rgbaDepth); float visibility = (shadowCoord.z depth + 0.0015)?0.7:1.0; gl_FragColor = vec4(v_Color.rgb * visibility, v_Color.a); `; æé«˜ç²¾åº¦åShadowMapé‡Œéƒ½å­˜çš„ä»€ä¹ˆï¼Ÿ å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªç‰‡å…ƒåæ ‡zå€¼ï¼šgl_FragCoord.z 2.135793057816414332378301å¦‚æœåªä½¿ç”¨ gl_FragColor.r æ¥å­˜å‚¨å®ƒçš„è¯å®é™…å­˜å‚¨çš„ç»“æœæ˜¯ gl_FragCoord.z * 2^(-8) * 2^(-8) 2.1328125æ—¢ç„¶gl_FragColor.ræ”¾ä¸ä¸‹ç²¾åº¦è¿™ä¹ˆå¤§çš„å€¼ï¼Œé‚£å°±æŠŠgl_FragColorçš„ rgba å››ä¸ª8ä½å€¼å…¨ç”¨ä¸ŠR: ï¼ˆ2^-8, 2^0)G: ï¼ˆ2^-16, 2^-8)B: ï¼ˆ2^-24, 2^-16)A: ï¼ˆ0, 2^-24)ä¸€ä¸ªä½æ•°æå–çš„é—®é¢˜ å¦‚ä½•åœ¨ä¸ç ´åä¸€ä¸ªäºŒè¿›åˆ¶æ•°çš„å…¶ä»–ä½çš„æƒ…å†µä¸‹ï¼Œå°†å…¶ä¸­éœ€è¦çš„ä½æ•°æå–å‡ºæ¥ï¼Ÿå¦‚ï¼šæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶æ•° 0b0001_0001_0000_1000æˆ‘è¦å¦‚ä½•å°†å®ƒçš„é«˜8ä½å’Œä½8ä½åˆ†åˆ«æå–å‡ºæ¥ï¼Ÿ fractå‡½æ•°ï¼ˆæ¨¡ç³Šï¼‰ä½œç”¨ï¼š èˆå¼ƒå‚æ•°çš„æ•´æ•°éƒ¨åˆ†ï¼Œè¿”å›å°æ•°éƒ¨åˆ†ã€‚ æ¶ˆé™¤é©¬èµ«å¸¦åç§»é‡float visibility = ( shadowCoord.z depth + 0.0015 )?0.7:1.0; ä¹‹æ‰€ä»¥é€‰0.0015ä½œä¸ºåç§»é‡æ˜¯å› ä¸ºï¼š zç²¾åº¦å·²ç»æé«˜åˆ°äº†floatåœ¨mediumpç²¾åº¦ä¸‹ï¼Œç²¾åº¦ä¸º2^-102^-10 0.000976563"},{"title":"ä¸‰ç»´æ¨¡å‹","path":"/wiki/WebGL/chapter_10_08.html","content":"åŠ è½½ä¸‰ç»´æ¨¡å‹åŠ è½½ä¸‰ç»´æ¨¡å‹ä¸€èˆ¬æµç¨‹ OperateDataTypeStep1è¯»å…¥é¡¶ç‚¹æ•°æ®verticesFloat32ArrayStep2è¯»å…¥é¢œè‰²æ•°æ®colorsFloat32ArrayStep3è¯»å…¥æ³•çº¿æ•°æ®normalsFloat32ArrayStep4è¯»å…¥é¡¶ç‚¹ç´¢å¼•æ•°æ®indicesUnit16ArrayUnit8ArrayStep5 æ•°æ®å†™å…¥ç¼“å†²åŒºStep6 gl.drawElements() OBJæ–‡ä»¶æ ¼å¼OBJæ–‡ä»¶wikiä»‹ç»https://en.wikipedia.org/wiki/Wavefront_.obj_file OBJæ–‡ä»¶æ ¼å¼ç®€ä»‹ ä¸€ä¸ªç®€å•çš„ç»˜åˆ¶äº†ç«‹æ–¹ä½“çš„objæ–‡ä»¶cube.objç»˜åˆ¶çš„ç«‹æ–¹ä½“# Blender v2.60 (sub 0) OBJ File: # www.blender.orgmtllib cube.mtlo Cubev 1.000000 -1.000000 -1.000000v 1.000000 -1.000000 1.000000v -1.000000 -1.000000 1.000000v -1.000000 -1.000000 -1.000000v 1.000000 1.000000 -1.000000v 1.000000 1.000000 1.000001v -1.000000 1.000000 1.000000v -1.000000 1.000000 -1.000000usemtl Materialf 1 2 3 4f 5 8 7 6f 2 6 7 3f 3 7 8 4f 5 1 4 8usemtl Material.001f 1 5 6 2æ³¨é‡Šå¼•ç”¨å‘½åé¡¶ç‚¹åæ ‡æè´¨è¡¨é¢# å¼€å¤´è¡Œè¡¨ç¤ºæ³¨é‡Š# Blender v2.60 (sub 0) OBJ File: # www.blender.orgmtllib å¤–éƒ¨æè´¨æ–‡ä»¶åmtllib cube.mtl # å¼•ç”¨ä¸€ä¸ªå¤–éƒ¨æè´¨æ–‡ä»¶æ¨¡å‹åç§°v x y z [w] # wå€¼å¯é€‰ï¼Œæ²¡æœ‰é»˜è®¤ä¸º1.0v 1.000000 -1.000000 -1.000000v 1.000000 -1.000000 1.000000v -1.000000 -1.000000 1.000000v -1.000000 -1.000000 -1.000000v 1.000000 1.000000 -1.000000v 1.000000 1.000000 1.000001v -1.000000 1.000000 1.000000v -1.000000 1.000000 -1.000000usemtl æè´¨åusemtl Materialusemtl Material.001è¡¨é¢æ˜¯ç”±é¡¶ç‚¹ã€çº¹ç†åæ ‡å’Œæ³•çº¿çš„ ç´¢å¼•åºåˆ— å®šä¹‰çš„æ³¨æ„ï¼š ç´¢å¼•å€¼ä»1å¼€å§‹f v1 v2 v3 v4usemtl Materialf 1 2 3 4f 5 8 7 6f 2 6 7 3f 3 7 8 4f 5 1 4 8usemtl Material.001f 1 5 6 2åŒ…å«äº†æ³•çº¿çš„è¡¨é¢çš„å®šä¹‰ç¨æœ‰ä¸åŒå³ é¡¶ç‚¹ç´¢å¼•æ³•çº¿å‘é‡ç´¢å¼• çš„æ ¼å¼æ³•çº¿å‘é‡ç´¢å¼•ä¹Ÿæ˜¯ä»1å¼€å§‹f v1//vn1 v2//vn2 v3//vn3 MTLæ–‡ä»¶æ ¼å¼# Blender MTL File: # Material Count: 2newmtl MaterialKa 0.000000 0.000000 0.000000Kd 1.000000 0.000000 0.000000Ks 0.000000 0.000000 0.000000Ns 96.078431Ni 1.000000d 1.000000illum 0newmtl Material.001Ka 0.000000 0.000000 0.000000Kd 1.000000 0.450000 0.000000Ks 0.000000 0.000000 0.000000Ns 96.078431Ni 1.000000d 1.000000illum 0æ–°æè´¨æè´¨å‚æ•°newmtl æè´¨åè¡¨ç¤ºå®šä¹‰ä¸€ä¸ªæ–°æè´¨å³objæ–‡ä»¶å¼•ç”¨çš„æè´¨åusemtl æè´¨ånewmtl MaterialKa # ç¯å¢ƒè‰²Kd # æ¼«å°„è‰²Ks # é«˜å…‰è‰²Ns # é«˜å…‰è‰²æƒé‡Ni # è¡¨é¢å…‰å­¦å¯†åº¦d # é€æ˜åº¦illum # å…‰ç…§æ¨¡å‹Ka|Kd|Kséƒ½ä½¿ç”¨äº†RGBæ ¼å¼å®šä¹‰ï¼Œæ¯ä¸ªåˆ†é‡å–å€¼åŒºé—´ä¸º [0.0, 1.0]Ka 0.000000 0.000000 0.000000Kd 1.000000 0.000000 0.000000Ks 0.000000 0.000000 0.000000Ns 96.078431Ni 1.000000d 1.000000illum 0 OBJViewer.jsç®€å•æ­¥éª¤ Step1å‡†å¤‡ä¸€ä¸ªç©ºç¼“å†²åŒºStep2è¯»å–OBJæ–‡ä»¶ä¸­çš„å†…å®¹Step3å¯¹è¯»å–çš„å†…å®¹è¿›è¡Œè§£æStep4å°†è§£æå‡ºçš„æ•°æ®å†™å…¥ç¼“å†²åŒºStep5è¿›è¡Œç»˜åˆ¶ è‡ªå®šä¹‰OBJæ–‡ä»¶è§£æç±»OBJæ–‡ä»¶è§£æçš„å†…éƒ¨ç»“æ„ Souce Code //------------------------------------------------------------------------------// OBJParser//------------------------------------------------------------------------------// OBJDoc object// Constructorvar OBJDoc = function(fileName) this.fileName = fileName; this.mtls = new Array(0); // Initialize the property for MTL this.objects = new Array(0); // Initialize the property for Object this.vertices = new Array(0); // Initialize the property for Vertex this.normals = new Array(0); // Initialize the property for Normal// Parsing the OBJ fileOBJDoc.prototype.parse = function(fileString, scale, reverse) var lines = fileString.grid( ); // Break up into lines and store them as array lines.push(null); // Append null var index = 0; // Initialize index of line var currentObject = null; var currentMaterialName = ; // Parse line by line var line; // A string in the line to be parsed var sp = new StringParser(); // Create StringParser while ((line = lines[index++]) != null) sp.init(line); // init StringParser var command = sp.getWord(); // Get command if(command == null) continue; // check null command switch(command) case #: continue; // Skip comments case mtllib: // Read Material chunk var path = this.parseMtllib(sp, this.fileName); var mtl = new MTLDoc(); // Create MTL instance this.mtls.push(mtl); var request = new XMLHttpRequest(); request.onreadystatechange = function() if (request.readyState == 4) if (request.status != 404) onReadMTLFile(request.responseText, mtl); else mtl.complete = true; request.open(GET, path, true); // Create a request to acquire the file request.send(); // Send the request continue; // Go to the next line case o: case g: // Read Object name var object = this.parseObjectName(sp); this.objects.push(object); currentObject = object; continue; // Go to the next line case v: // Read vertex var vertex = this.parseVertex(sp, scale); this.vertices.push(vertex); continue; // Go to the next line case vn: // Read normal var normal = this.parseNormal(sp); this.normals.push(normal); continue; // Go to the next line case usemtl: // Read Material name currentMaterialName = this.parseUsemtl(sp); continue; // Go to the next line case f: // Read face var face = this.parseFace(sp, currentMaterialName, this.vertices, reverse); currentObject.addFace(face); continue; // Go to the next line return true;OBJDoc.prototype.parseMtllib = function(sp, fileName) // Get directory path var i = fileName.lastIndexOf(/); var dirPath = ; if(i 0) dirPath = fileName.substr(0, i+1); return dirPath + sp.getWord(); // Get pathOBJDoc.prototype.parseObjectName = function(sp) var name = sp.getWord(); return (new OBJObject(name));OBJDoc.prototype.parseVertex = function(sp, scale) var x = sp.getFloat() * scale; var y = sp.getFloat() * scale; var z = sp.getFloat() * scale; return (new Vertex(x, y, z));OBJDoc.prototype.parseNormal = function(sp) var x = sp.getFloat(); var y = sp.getFloat(); var z = sp.getFloat(); return (new Normal(x, y, z));OBJDoc.prototype.parseUsemtl = function(sp) return sp.getWord();OBJDoc.prototype.parseFace = function(sp, materialName, vertices, reverse) var face = new Face(materialName); // get indices for(;;) var word = sp.getWord(); if(word == null) break; var subWords = word.grid(/); if(subWords.length = 1) var vi = parseInt(subWords[0]) - 1; face.vIndices.push(vi); if(subWords.length = 3) var ni = parseInt(subWords[2]) - 1; face.nIndices.push(ni); else face.nIndices.push(-1); // calc normal var v0 = [ vertices[face.vIndices[0]].x, vertices[face.vIndices[0]].y, vertices[face.vIndices[0]].z]; var v1 = [ vertices[face.vIndices[1]].x, vertices[face.vIndices[1]].y, vertices[face.vIndices[1]].z]; var v2 = [ vertices[face.vIndices[2]].x, vertices[face.vIndices[2]].y, vertices[face.vIndices[2]].z]; // é¢ã®æ³•ç·šã‚’è¨ˆç®—ã—ã¦normalã«è¨­å®š var normal = calcNormal(v0, v1, v2); // æ³•ç·šãŒæ­£ã—ãæ±‚ã‚ã‚‰ã‚ŒãŸã‹èª¿ã¹ã‚‹ if (normal == null) if (face.vIndices.length = 4) // é¢ãŒå››è§’å½¢ãªã‚‰åˆ¥ã®3ç‚¹ã®çµ„ã¿åˆã‚ã›ã§æ³•ç·šè¨ˆç®— var v3 = [ vertices[face.vIndices[3]].x, vertices[face.vIndices[3]].y, vertices[face.vIndices[3]].z]; normal = calcNormal(v1, v2, v3); if(normal == null) // æ³•ç·šãŒæ±‚ã‚ã‚‰ã‚Œãªã‹ã£ãŸã®ã§Yè»¸æ–¹å‘ã®æ³•ç·šã¨ã™ã‚‹ normal = [0.0, 1.0, 0.0]; if(reverse) normal[0] = -normal[0]; normal[1] = -normal[1]; normal[2] = -normal[2]; face.normal = new Normal(normal[0], normal[1], normal[2]); // Devide to triangles if face contains over 3 points. if(face.vIndices.length 3) var n = face.vIndices.length - 2; var newVIndices = new Array(n * 3); var newNIndices = new Array(n * 3); for(var i=0; in; i++) newVIndices[i * 3 + 0] = face.vIndices[0]; newVIndices[i * 3 + 1] = face.vIndices[i + 1]; newVIndices[i * 3 + 2] = face.vIndices[i + 2]; newNIndices[i * 3 + 0] = face.nIndices[0]; newNIndices[i * 3 + 1] = face.nIndices[i + 1]; newNIndices[i * 3 + 2] = face.nIndices[i + 2]; face.vIndices = newVIndices; face.nIndices = newNIndices; face.numIndices = face.vIndices.length; return face;// Analyze the material filefunction onReadMTLFile(fileString, mtl) var lines = fileString.grid( ); // Break up into lines and store them as array lines.push(null); // Append null var index = 0; // Initialize index of line // Parse line by line var line; // A string in the line to be parsed var name = ; // Material name var sp = new StringParser(); // Create StringParser while ((line = lines[index++]) != null) sp.init(line); // init StringParser var command = sp.getWord(); // Get command if(command == null) continue; // check null command switch(command) case #: continue; // Skip comments case newmtl: // Read Material chunk name = mtl.parseNewmtl(sp); // Get name continue; // Go to the next line case Kd: // Read normal if(name == ) continue; // Go to the next line because of Error var material = mtl.parseRGB(sp, name); mtl.materials.push(material); name = ; continue; // Go to the next line mtl.complete = true;// Check MaterialsOBJDoc.prototype.isMTLComplete = function() if(this.mtls.length == 0) return true; for(var i = 0; i this.mtls.length; i++) if(!this.mtls[i].complete) return false; return true;// Find color by material nameOBJDoc.prototype.findColor = function(name) for(var i = 0; i this.mtls.length; i++) for(var j = 0; j this.mtls[i].materials.length; j++) if(this.mtls[i].materials[j].name == name) return(this.mtls[i].materials[j].color) return(new Color(0.8, 0.8, 0.8, 1));//------------------------------------------------------------------------------// Retrieve the information for drawing 3D modelOBJDoc.prototype.getDrawingInfo = function() // Create an arrays for vertex coordinates, normals, colors, and indices var numIndices = 0; for(var i = 0; i this.objects.length; i++) numIndices += this.objects[i].numIndices; var numVertices = numIndices; var vertices = new Float32Array(numVertices * 3); var normals = new Float32Array(numVertices * 3); var colors = new Float32Array(numVertices * 4); var indices = new Uint16Array(numIndices); // Set vertex, normal and color var index_indices = 0; for(var i = 0; i this.objects.length; i++) var object = this.objects[i]; for(var j = 0; j object.faces.length; j++) var face = object.faces[j]; var color = this.findColor(face.materialName); var faceNormal = face.normal; for(var k = 0; k face.vIndices.length; k++) // Set index indices[index_indices] = index_indices; // Copy vertex var vIdx = face.vIndices[k]; var vertex = this.vertices[vIdx]; vertices[index_indices * 3 + 0] = vertex.x; vertices[index_indices * 3 + 1] = vertex.y; vertices[index_indices * 3 + 2] = vertex.z; // Copy color colors[index_indices * 4 + 0] = color.r; colors[index_indices * 4 + 1] = color.g; colors[index_indices * 4 + 2] = color.b; colors[index_indices * 4 + 3] = color.a; // Copy normal var nIdx = face.nIndices[k]; if(nIdx = 0) var normal = this.normals[nIdx]; normals[index_indices * 3 + 0] = normal.x; normals[index_indices * 3 + 1] = normal.y; normals[index_indices * 3 + 2] = normal.z; else normals[index_indices * 3 + 0] = faceNormal.x; normals[index_indices * 3 + 1] = faceNormal.y; normals[index_indices * 3 + 2] = faceNormal.z; index_indices ++; return new DrawingInfo(vertices, normals, colors, indices);//------------------------------------------------------------------------------// MTLDoc Object//------------------------------------------------------------------------------var MTLDoc = function() this.complete = false; // MTL is configured correctly this.materials = new Array(0);MTLDoc.prototype.parseNewmtl = function(sp) return sp.getWord(); // Get nameMTLDoc.prototype.parseRGB = function(sp, name) var r = sp.getFloat(); var g = sp.getFloat(); var b = sp.getFloat(); return (new Material(name, r, g, b, 1));//------------------------------------------------------------------------------// Material Object//------------------------------------------------------------------------------var Material = function(name, r, g, b, a) this.name = name; this.color = new Color(r, g, b, a);//------------------------------------------------------------------------------// Vertex Object//------------------------------------------------------------------------------var Vertex = function(x, y, z) this.x = x; this.y = y; this.z = z;//------------------------------------------------------------------------------// Normal Object//------------------------------------------------------------------------------var Normal = function(x, y, z) this.x = x; this.y = y; this.z = z;//------------------------------------------------------------------------------// Color Object//------------------------------------------------------------------------------var Color = function(r, g, b, a) this.r = r; this.g = g; this.b = b; this.a = a;//------------------------------------------------------------------------------// OBJObject Object//------------------------------------------------------------------------------var OBJObject = function(name) this.name = name; this.faces = new Array(0); this.numIndices = 0;OBJObject.prototype.addFace = function(face) this.faces.push(face); this.numIndices += face.numIndices;//------------------------------------------------------------------------------// Face Object//------------------------------------------------------------------------------var Face = function(materialName) this.materialName = materialName; if(materialName == null) this.materialName = ; this.vIndices = new Array(0); this.nIndices = new Array(0);//------------------------------------------------------------------------------// DrawInfo Object//------------------------------------------------------------------------------var DrawingInfo = function(vertices, normals, colors, indices) this.vertices = vertices; this.normals = normals; this.colors = colors; this.indices = indices;//------------------------------------------------------------------------------// Constructorvar StringParser = function(str) this.str; // Store the string specified by the argument this.index; // Position in the string to be processed this.init(str);// Initialize StringParser objectStringParser.prototype.init = function(str) this.str = str; this.index = 0;// Skip delimitersStringParser.prototype.skipDelimiters = function() for(var i = this.index, len = this.str.length; i len; i++) var c = this.str.charAt(i); // Skip TAB, Space, (, ) if (c == \\t|| c == || c == ( || c == ) || c == ) continue; break; this.index = i;// Skip to the next wordStringParser.prototype.skipToNextWord = function() this.skipDelimiters(); var n = getWordLength(this.str, this.index); this.index += (n + 1);// Get wordStringParser.prototype.getWord = function() this.skipDelimiters(); var n = getWordLength(this.str, this.index); if (n == 0) return null; var word = this.str.substr(this.index, n); this.index += (n + 1); return word;// Get integerStringParser.prototype.getInt = function() return parseInt(this.getWord());// Get floating numberStringParser.prototype.getFloat = function() return parseFloat(this.getWord());// Get the length of wordfunction getWordLength(str, start) var n = 0; for(var i = start, len = str.length; i len; i++) var c = str.charAt(i); if (c == \\t|| c == || c == ( || c == ) || c == ) break; return i - start;//------------------------------------------------------------------------------// Common function//------------------------------------------------------------------------------function calcNormal(p0, p1, p2) // v0: a vector from p1 to p0, v1; a vector from p1 to p2 var v0 = new Float32Array(3); var v1 = new Float32Array(3); for (var i = 0; i 3; i++) v0[i] = p0[i] - p1[i]; v1[i] = p2[i] - p1[i]; // The cross product of v0 and v1 var c = new Float32Array(3); c[0] = v0[1] * v1[2] - v0[2] * v1[1]; c[1] = v0[2] * v1[0] - v0[0] * v1[2]; c[2] = v0[0] * v1[1] - v0[1] * v1[0]; // Normalize the result var v = new Vector3(c); v.normalize(); return v.elements; è¯»å…¥éƒ¨åˆ†ç¨‹åºOBJViewer Code OBJViewerè¿è¡Œç»“æœShadermainreadonReadonReadCompletedrawbufferanimtelet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; attribute vec4 a_Normal; uniform mat4 u_MvpMatrix; uniform mat4 u_NormalMatrix; varying vec4 v_Color; void main() gl_Position = u_MvpMatrix * a_Position; vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal)); vec3 lightDirection = vec3(-0.35, 0.35, 0.87); float nDotL = max(dot(normal, lightDirection), 0.0); v_Color = vec4(nDotL*a_Color.rgb, a_Color.a); `;let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `function main() let canvas = document.getElementById(webgl) let gl = getWebGLContext(canvas) if (!gl) console.log(failed to get webgl context) return if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders) return gl.clearColor(0.3, 0.3, 0.4, 1) gl.enable(gl.DEPTH_TEST) let program = gl.program program.a_Position = gl.getAttribLocation(program,a_Position) program.a_Color = gl.getAttribLocation(program,a_Color) program.a_Normal = gl.getAttribLocation(program, a_Normal) program.u_MvpMatrix = gl.getUniformLocation(program,u_MvpMatrix) program.u_NormalMatrix = gl.getUniformLocation(program,u_NormalMatrix) if (program.a_Postion 0 || program.a_Color 0 || program.a_Normal 0 || !program.u_MvpMatrix || !program.u_NormalMatrix ) console.log(failed to get attribute or uniform location) return let model = initVertexBuffers(gl, program) if (!model) console.log(failed to init vertex buffers) return let viewProjMatrix = new Matrix4() viewProjMatrix.setPerspective( 30.0, canvas.width/canvas.height,1.0,5000.0 ).lookAt( 0.0, 500.0, 200.0, 0, 0, 0, 0, 1, 0 ) readOBJFile(../img/cube.obj, gl, model, 60, true) let currentAngle = 0.0 let tick = function () currentAngle = animate(currentAngle) draw(gl, program, currentAngle, viewProjMatrix, model) window.requestAnimationFrame(tick) tick()å‘èµ·è¯»å–æ–‡ä»¶è¯·æ±‚let g_objDoc = nulllet g_draingInfo = nullfunction readOBJFile(fileName, gl, model, scale, reverse) let request = new XMLHttpRequest() request.onreadystatechange = function () if (request.readyState === 4 request.status !== 404) onReadOBJFile(request.responseText, fileName, gl, model, scale, reverse) request.open(GET, fileName, true) request.send()æ–‡ä»¶è¯»å–ç»“æŸfunction onReadOBJFile(fileString, fileName, gl, o, scale, reverse) let objDoc = new OBJDoc(fileName) let result = objDoc.parse(fileString, scale, reverse) if (!result) g_objDoc = null g_drawingInfo = null console.log(OBJ file parsing error) return g_objDoc = objDocå¯¹è¯»å–å†…å®¹è§£æå¹¶å†™å…¥ç¼“å†²åŒºfunction onReadComplete(gl, model, objDoc) let drawingInfo = objDoc.getDrawingInfo() gl.bindBuffer(gl.ARRAY_BUFFER, model.vertexBuffer) gl.bufferData(gl.ARRAY_BUFFER, drawingInfo.vertices, gl.STATIC_DRAW) gl.bindBuffer(gl.ARRAY_BUFFER, model.colorBuffer) gl.bufferData(gl.ARRAY_BUFFER, drawingInfo.colors, gl.STATIC_DRAW) gl.bindBuffer(gl.ARRAY_BUFFER, model.normalBuffer) gl.bufferData(gl.ARRAY_BUFFER, drawingInfo.normals, gl.STATIC_DRAW) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, model.indexBUffer) gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, drawingInfo.indices, gl.STATIC_DRAW) return drawingInfolet g_modelMatrix = new Matrix4()let g_mvpMatrix = new Matrix4()let g_normalMatrix = new Matrix4()function draw(gl, program, angle, vpMatrix, model) if (g_objDoc != null g_objDoc.isMTLComplete()) g_drawingInfo = onReadComplete(gl, model, g_objDoc) g_objDoc = null if (!g_drawingInfo) return gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) g_modelMatrix.setRotate(angle, 1, 1, 1) g_normalMatrix.setInverseOf(g_modelMatrix) g_normalMatrix.transpose() gl.uniformMatrix4fv(program.u_NormalMatrix,false,g_normalMatrix.elements) g_mvpMatrix.set(vpMatrix).multiply(g_modelMatrix) gl.uniformMatrix4fv(program.u_MvpMatrix,false,g_mvpMatrix.elements) gl.drawElements(gl.TRIANGLES, g_drawingInfo.indices.length, gl.UNSIGNED_SHORT, 0)function initVertexBuffers(gl, program) let o = new Object() o.vertexBuffer = createEmptyArrayBuffer(gl, program.a_Position, 3, gl.FLOAT) o.colorBuffer = createEmptyArrayBuffer(gl, program.a_Color, 4, gl.FLOAT) o.normalBuffer = createEmptyArrayBuffer(gl, program.a_Normal, 3, gl.FLOAT) o.indexBUffer = gl.createBuffer() if (!o.vertexBuffer || !o.colorBuffer || !o.normalBuffer || !o.indexBUffer ) return null gl.bindBuffer(gl.ARRAY_BUFFER, null) return ofunction createEmptyArrayBuffer(gl,a_attribute,num,type) let buffer = gl.createBuffer() if (!buffer) console.log(failed to create buffer) return null gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.vertexAttribPointer(a_attribute, num, type, false, 0, 0) gl.enableVertexAttribArray(a_attribute) return buffer var ANGLE_STEP = 30; // The increments of rotation angle (degrees)var last = Date.now(); // Last time that this function was calledfunction animate(angle) var now = Date.now(); // Calculate the elapsed time var elapsed = now - last; last = now; // Update the current rotation angle (adjusted by the elapsed time) var newAngle = angle + (ANGLE_STEP * elapsed) / 1000.0; return newAngle % 360;"},{"title":"å®æ—¶æ¸²æŸ“","path":"/wiki/WebGL/chapter_10_06.html","content":"æœ¬ç¯‡åšå®¢å¼•ç”¨çš„é¡¹ç›®æºç½‘å€http://www.artvily.com/ æ¸²æŸ“åˆ°çº¹ç†æ‰€è°“æ¸²æŸ“åˆ°çº¹ç† å°±æ˜¯å°† æ¸²æŸ“ç»“æœ ä½œä¸ºçº¹ç†è´´åˆ°å¦ä¸€ä¸ªä¸‰ç»´ç‰©ä½“ä¸Šå»ï¼Œå®é™…ä¸Šå°±æ˜¯ åŠ¨æ€ç”Ÿæˆå›¾åƒã€‚ åº”ç”¨åœºæ™¯åŠ¨æ€æ¨¡ç³Šæ™¯æ·±æ•ˆæœ å¸§ç¼“å†²åŒºå¯¹è±¡å’Œæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡è¿˜è®°å¾—WebGLçš„ç»˜åˆ¶ç»“æœå­˜å‚¨åœ¨å“ªä¸ªç¼“å†²åŒºä¸­å—ï¼Ÿ ç­”ï¼š é»˜è®¤æƒ…å†µä¸‹åœ¨ é¢œè‰²ç¼“å†²åŒº ä¸­ç»˜å›¾ å¼€å¯DEPTH_TESTæ—¶ï¼Œè¿˜ä¼šç”¨åˆ° æ·±åº¦ç¼“å†²åŒº æ€»ä¹‹ï¼Œç»˜åˆ¶ç»“æœå­˜å‚¨åœ¨ é¢œè‰²ç¼“å†²åŒº ä¸­ å¸§ç¼“å†²åŒºå¯¹è±¡å¸§ç¼“å†²åŒºå¯¹è±¡ï¼ˆframebuffer objectï¼‰ å¯ä»¥ç”¨æ¥ä»£æ›¿ é¢œè‰²ç¼“å†²åŒº æˆ– æ·±åº¦ç¼“å†²åŒº ä¸ºä»€ä¹ˆåœ¨å¸§ç¼“å†²åŒºä¸­ç»˜åˆ¶çš„è¿‡ç¨‹åˆç§°ä¸ºç¦»å±ç»˜åˆ¶ï¼ˆoffscreen drawingï¼‰ç­”ï¼š å› ä¸ºç»˜åˆ¶åœ¨å¸§ç¼“å†²åŒºçš„å¯¹è±¡ä¸ä¼šç›´æ¥æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Š å¸§ç¼“å†²åŒºçš„å†…å®¹ä¸€èˆ¬ä¼šåšå¦‚ä¸‹å¤„ç†ï¼š è¿›è¡Œä¸€äº›å¤„ç†å†æ˜¾ç¤º ç›´æ¥ç”¨å…¶ä¸­çš„å†…å®¹ä½œä¸º çº¹ç†å›¾åƒ å¸§ç¼“å†²åŒºå¯¹è±¡çš„ç»“æ„ ç»˜åˆ¶æ“ä½œä¸æ˜¯ç›´æ¥å‘ç”Ÿåœ¨ å¸§ç¼“å†²åŒº ä¸­çš„ï¼Œè€Œæ˜¯å‘ç”Ÿåœ¨å¸§ç¼“å†²åŒº æ‰€å…³è”çš„å¯¹è±¡ï¼ˆattachmentï¼‰ ä¸Šã€‚ å¸§ç¼“å†²åŒºçš„3ä¸ªå…³è”å¯¹è±¡é¢œè‰²å…³è”å¯¹è±¡ color attachment ä»£æ›¿é¢œè‰²ç¼“å†²åŒºæ·±åº¦å…³è”å¯¹è±¡ depth attachment ä»£æ›¿æ·±åº¦ç¼“å†²åŒºæ¨¡æ¿å…³è”å¯¹è±¡ stencil attachment ä»£æ›¿æ¨¡æ¿ç¼“å†²åŒº æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ï¼ˆrenderbuffer objectï¼‰ å¸§ç¼“å†²åŒºçš„æ¯ä¸€ä¸ªå…³è”å¯¹è±¡å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼šçº¹ç†å¯¹è±¡å­˜å‚¨äº†çº¹ç†å›¾åƒæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ è¡¨ç¤ºä¸€ç§ æ›´åŠ é€šç”¨ çš„ç»˜å›¾åŒºåŸŸï¼Œå¯ä»¥å‘å…¶ä¸­å†™å…¥å¤šç§ç±»å‹çš„æ•°æ® å¦‚ä½•å®ç°æ¸²æŸ“åˆ°çº¹ç†å®ç°æ­¥éª¤å®ç°ç›®çš„ï¼š æŠŠWebGLæ¸²æŸ“å‡ºçš„å›¾åƒä½œä¸ºçº¹ç†ä½¿ç”¨å®ç°æ–¹å¼ï¼š å°†çº¹ç†å¯¹è±¡ä½œä¸ºé¢œè‰²å…³è”å¯¹è±¡å…³è”åˆ° å¸§ç¼“å†²åŒºå¯¹è±¡ä¸Š çº¹ç†å¯¹è±¡ â† é¢œè‰²å…³è”å¯¹è±¡ å°†æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ä½œä¸ºæ·±åº¦å…³è”å¯¹è±¡å…³è”åˆ° å¸§ç¼“å†²åŒºå¯¹è±¡ä¸Š æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ â† æ·±åº¦å…³è”å¯¹è±¡ å°æ¯”å–»ï¼šé›ªåªšå¨˜ ç»˜å›¾å°±åƒçƒ¹é¥ªä¸€æ ·ï¼Œå¯¹åº”çš„å¯¹è±¡å°±åƒæ˜¯ é£Ÿæ ä¸ å·¥åº ä¸€æ ·ã€‚WebGLçš„ç¼“å†²åŒºå¯¹åº”çƒ¹é¥ªä¸­çš„å‡ ä¸ªè¦ç´ ä¸€æ ·ï¼š é¢œè‰²ç¼“å†²åŒºï¼šé£Ÿæ æ·±åº¦ç¼“å†²åŒºï¼šå±‚æ¬¡ ä½†æ˜¯åªä½¿ç”¨é¢œè‰²ç¼“å†²åŒºå’Œæ·±åº¦ç¼“å†²åŒºå°±å¥½åƒåšä¸€é“å·¥åºç®€å•çš„èœï¼Œé£Ÿæ æ–°é²œï¼Œå±‚æ¬¡ ç›´è§‚ï¼Œå°±æ¯”å¦‚è¦åšè¥¿çº¢æŸ¿ç‚’é¸¡è›‹ï¼Œé£Ÿæï¼ˆé¢œè‰²ç¼“å†²åŒºï¼‰æœ‰é¸¡è›‹ã€ç•ªèŒ„ï¼Œå·¥åºï¼ˆæ·±åº¦ç¼“å†²åŒºï¼‰å°±æ˜¯å…ˆæ”¾é¸¡è›‹å†æ”¾ç•ªèŒ„ã€‚ ä½†å¦‚æœæƒ³è¦åš é›ªåªšå¨˜ è¿™æ ·å·¥åºæ¯”è¾ƒç¹ççš„ç”œç‚¹ï¼Œä½ éœ€è¦è€ƒè™‘ çš®æ–™ï¼ˆç³¯ç±³ç²‰ã€å‡‰ç™½å¼€ï¼‰ï¼Œå¹¶ä¸”çš®æ–™çš„å·¥åºå·²ç»æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å‡†å¤‡çš®æ–™çš„å·¥åºå•ç‹¬å–å‡ºæ¥ï¼Œå’Œå…¶ä»–å·¥åºåŒºåˆ«å¼€æ¥ï¼Œè¿™å°±ç›¸å½“äºå¸§ç¼“å†²åŒºçš„ ç¦»å±ç»˜åˆ¶ï¼Œ é‚£ä¹ˆä¸Šé¢ä½¿ç”¨å¸§ç¼“å†²åŒºå¯¹è±¡æ¸²æŸ“åˆ°çº¹ç†çš„ç›®çš„å’Œæ–¹å¼ä¹Ÿå¯ä»¥å¯¹åº”å¦‚ä¸‹çš„æè¿°ï¼šå®ç°ç›®çš„ï¼š è‡ªåˆ¶é›ªåªšå¨˜å®ç°æ–¹å¼ï¼š å°†é£Ÿè°±ï¼ˆå¸§ç¼“å†²åŒºå¯¹è±¡ï¼‰ä¸­çš„é£Ÿæ(é¢œè‰²å…³è”å¯¹è±¡)æŒ‡å‘ç³¯ç±³çš®ï¼ˆçº¹ç†å¯¹è±¡ï¼‰è‡³äºç³¯ç±³çš®æ€ä¹ˆåˆ¶ä½œçš„ï¼Œåˆæ˜¯å•ç‹¬çš„ä¸€é“å·¥åºäº†ï¼ˆå³çº¹ç†ç»˜åˆ¶ï¼‰ åˆ›å»ºæ­¥éª¤ step 1åˆ›å»º å¸§ç¼“å†²åŒºå¯¹è±¡gl.createFramebuffer()step 2åˆ›å»º çº¹ç†å¯¹è±¡ å¹¶è®¾ç½®å…¶å°ºå¯¸å’Œå‚æ•°gl.createTexture()gl.bindTexture()gl.texImage2d()gl.Parameteri()step 3åˆ›å»º æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡gl.createRenderbuffer()step 4ç»‘å®šæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ å¹¶è®¾ç½®å°ºå¯¸gl.bindRenderbuffer()gl.renderbufferStorage()step 5åˆ†é… çº¹ç†å¯¹è±¡ åˆ°å¸§ç¼“å†²åŒºçš„ é¢œè‰²å…³è”å¯¹è±¡gl.framebufferRenderbuffer()step 6åˆ†é… æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ åˆ°å¸§ç¼“å†²åŒºçš„ æ·±åº¦å…³è”å¯¹è±¡gl.framebufferRenderbuffer()step 7æ£€æŸ¥å¸§ç¼“å†²åŒº æ˜¯å¦æ­£ç¡®é…ç½®gl.checkFramebufferStatus()step 8åœ¨å¸§ç¼“å†²åŒºä¸­ è¿›è¡Œç»˜åˆ¶gl.bindFramebuffer() FramebufferObjectFramebufferObject Code FramebufferObjectè¿è¡Œç»“æœshadersmaininit_Buffer&&TextureinitFramedrawattribute&&animatelet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec2 a_TexCoord; uniform mat4 u_MvpMatrix; varying vec2 v_TexCoord; void main() gl_Position = u_MvpMatrix * a_Position; v_TexCoord = a_TexCoord; `let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif uniform sampler2D u_Sampler; varying vec2 v_TexCoord; void main() gl_FragColor = texture2D(u_Sampler, v_TexCoord); `// ç¦»å±ç»˜åˆ¶å°ºå¯¸let OFFSCREEN_WIDTH = 256;let OFFSCREEN_HEIGHT = 256;function main() let canvas = document.getElementById(webgl) let gl = getWebGLContext(canvas) if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders) return let program = gl.program program.a_Position = gl.getAttribLocation(program, a_Position) program.a_TexCoord = gl.getAttribLocation(program, a_TexCoord) program.u_MvpMatrix = gl.getUniformLocation(program, u_MvpMatrix) let cube = initVertexBuffersForCube(gl) // åˆå§‹åŒ–ç«‹æ–¹ä½“é¡¶ç‚¹ä¿¡æ¯ let plane = initVertexBuffersForPlane(gl) // åˆå§‹åŒ–å¹³é¢å®šç‚¹ä¿¡æ¯ let texture = initTextures(gl) // åˆå§‹åŒ–çº¹ç† let fbo = initFramebufferObject(gl) // åˆå§‹åŒ–å¸§ç¼“å†²åŒºå¯¹è±¡ gl.enable(gl.DEPTH_TEST) // æ‰“å¼€æ·±åº¦ç¼“å†²åŒº let viewProjMatrix = new Matrix4() // è§†å›¾é€è§†çŸ©é˜µ ä¸ºé¢œè‰²ç¼“å†²åŒºåšå‡†å¤‡ viewProjMatrix.setPerspective( 30, canvas.width/canvas.height, 1.0, 100.0 ) viewProjMatrix.lookAt( 0.0, 0.0, 7.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 ) let viewProjMatrixFBO = new Matrix4(); // å¸§ç¼“å†²å™¨å¯¹è±¡ä½¿ç”¨çš„é€è§†çŸ©é˜µ viewProjMatrixFBO.setPerspective( 30.0, OFFSCREEN_WIDTH/OFFSCREEN_HEIGHT, 1.0, 100.0 ) viewProjMatrixFBO.lookAt( 0.0, 2.0, 7.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 ) let currentAngle = 0.0 let tick = function () currentAngle = animate(currentAngle) draw(gl, canvas, fbo, plane, cube, currentAngle, texture, viewProjMatrix, viewProjMatrixFBO) window.requestAnimationFrame(tick, canvas) tick()// åˆå§‹åŒ–ç«‹æ–¹ä½“é¡¶ç‚¹ç¼“å†²åŒºfunction initVertexBuffersForCube(gl) let vertices = new Float32Array([ // é¡¶ç‚¹ç¼“å†²åŒºæ•°ç»„ 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, -1.0,-1.0, 1.0, 1.0,-1.0, 1.0, // v0-v1-v2-v3 front 1.0, 1.0, 1.0, 1.0,-1.0, 1.0, 1.0,-1.0,-1.0, 1.0, 1.0,-1.0, // v0-v3-v4-v5 right 1.0, 1.0, 1.0, 1.0, 1.0,-1.0, -1.0, 1.0,-1.0, -1.0, 1.0, 1.0, // v0-v5-v6-v1 up -1.0, 1.0, 1.0, -1.0, 1.0,-1.0, -1.0,-1.0,-1.0, -1.0,-1.0, 1.0, // v1-v6-v7-v2 left -1.0,-1.0,-1.0, 1.0,-1.0,-1.0, 1.0,-1.0, 1.0, -1.0,-1.0, 1.0, // v7-v4-v3-v2 down 1.0,-1.0,-1.0, -1.0,-1.0,-1.0, -1.0, 1.0,-1.0, 1.0, 1.0,-1.0 // v4-v7-v6-v5 back ]) let texCoords = new Float32Array([ // çº¹ç†ç¼“å†²åŒºæ•°ç»„ 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v1-v2-v3 front 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, // v0-v3-v4-v5 right 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, // v0-v5-v6-v1 up 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v1-v6-v7-v2 left 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, // v7-v4-v3-v2 down 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0 // v4-v7-v6-v5 back ]) let indices = new Uint8Array([ // ç´¢å¼•ç¼“å†²åŒºæ•°ç»„ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back ]) let o = new Object(); o.vertexBuffer = initArrayBuffersForLaterUse(gl, vertices, 3, gl.FLOAT) o.texCoordBuffer = initArrayBuffersForLaterUse(gl, texCoords, 2, gl.FLOAT) o.indexBuffer = initElementArrayBufferForLaterUse(gl, indices, gl.UNSIGNED_BYTE) if (!o.vertexBuffer || !o.texCoordBuffer || !o.indexBuffer) return null o.numIndices = indices.length gl.bindBuffer(gl.ARRAY_BUFFER, null) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null) return o// åˆå§‹åŒ–å¹³é¢é¡¶ç‚¹ç¼“å†²åŒºfunction initVertexBuffersForPlane(gl) let vertices = new Float32Array([ 1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0,-1.0, 0.0, 1.0,-1.0, 0.0 // v0-v1-v2-v3 ]) let texCoords = new Float32Array([ 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0 ]) let indices = new Uint8Array([ 0, 1, 2, 0, 2, 3 ]) let o = new Object() o.vertexBuffer = initArrayBuffersForLaterUse(gl, vertices, 3, gl.FLOAT) o.texCoordBuffer = initArrayBuffersForLaterUse(gl, texCoords, 2, gl.FLOAT) o.indexBuffer = initElementArrayBufferForLaterUse(gl, indices, gl.UNSIGNED_BYTE) if (!o.vertexBuffer || !o.texCoordBuffer || !o.indexBuffer) return null o.numIndices = indices.length gl.bindBuffer(gl.ARRAY_BUFFER, null) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null) return o// åˆå§‹åŒ–ARRAY_BUFFERfunction initArrayBuffersForLaterUse(gl, data, num, type) let buffer = gl.createBuffer() if (!buffer) console.log(failed to init Array Buffer) return null gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW) buffer.num = num buffer.type = type return buffer// åˆå§‹åŒ–ç´¢å¼•ç¼“å†²åŒºfunction initElementArrayBufferForLaterUse(gl, data, type) let buffer = gl.createBuffer() if (!buffer) console.log(failed to init element array buffer) return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer) gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, gl.STATIC_DRAW) buffer.type = type return buffer // åˆå§‹åŒ–çº¹ç†å¯¹è±¡function initTextures(gl) let texture = gl.createTexture() if (!texture) console.log(failed to create the Texture object) return null let u_Sampler = gl.getUniformLocation(gl.program, u_Sampler) if (!u_Sampler) console.log(failed to get the storage location of u_Sampler) return null let image = new Image() image.onload = function () gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1) gl.bindTexture(gl.TEXTURE_2D, texture) gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR) gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image) gl.uniform1i(u_Sampler, 0) gl.bindTexture(gl.TEXTURE_2D, null) image.src = ../img/sky_cloud.jpg return texture// åˆå§‹åŒ–å¸§ç¼“å†²åŒºå¯¹è±¡function initFramebufferObject(gl) let framebuffer let texture let depthBuffer let error = function () if (framebuffer) gl.deleteFramebuffer(framebuffer) if (texture) gl.deleteTexture(texture) if (depthBuffer) gl.deleteRenderbuffer(depthBuffer) return null framebuffer = gl.createFramebuffer() // åˆ›å»ºå¸§ç¼“å†²åŒº if (!framebuffer) console.log(failed to create frame buffer object) return error() texture = gl.createTexture() // åˆ›å»ºçº¹ç†ç¼“å†²åŒº if (!texture) console.log(failed to create texture object) return error() gl.bindTexture(gl.TEXTURE_2D, texture) gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT, 0, gl.RGBA, gl.UNSIGNED_BYTE, null) gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR) framebuffer.texture = texture // å­˜å…¥çº¹ç†å¯¹è±¡ depthBuffer = gl.createRenderbuffer() // åˆ›å»ºæ¸²æŸ“ç¼“å†²åŒº if (!depthBuffer) console.log(failed to create renderbuffer object) return error() gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer) gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT) // å°†çº¹ç†å¯¹è±¡ä¸æ¸²æŸ“å¯¹è±¡ç»‘å®šåˆ°å¸§ç¼“å†²åŒºå¯¹è±¡ä¸Š gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer) gl.framebufferTexture2D( gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0 ) gl.framebufferRenderbuffer( gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer ) let e = gl.checkFramebufferStatus(gl.FRAMEBUFFER) if (gl.FRAMEBUFFER_COMPLETE !== e) console.log(frame buffer is incomplete: + e.toString()) return error() gl.bindFramebuffer(gl.FRAMEBUFFER, null) gl.bindTexture(gl.TEXTURE_2D, null) gl.bindRenderbuffer(gl.RENDERBUFFER, null) return framebuffer// ç»˜åˆ¶function draw(gl, canvas, fbo, plane, cube, angle, texture, viewProjMatrix, viewProjMatrixFBO) // å…ˆç»˜åˆ¶åœ¨å¸§ç¼“å†²åŒºä¸Š gl.bindFramebuffer(gl.FRAMEBUFFER, fbo) gl.viewport(0, 0, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT) gl.clearColor(0.2, 0.2, 0.4, 1.0) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) drawTextureCube(gl, gl.program, cube, angle, texture, viewProjMatrixFBO) // å†ç»˜åˆ¶åœ¨canvasä¸Š gl.bindFramebuffer(gl.FRAMEBUFFER, null) gl.viewport(0, 0, canvas.width, canvas.height) gl.clearColor(0.0, 0.0, 0.0, 1.0) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) drawTexturedPlane(gl, gl.program, plane, angle, fbo.texture, viewProjMatrix)let g_modelMatrix = new Matrix4()let g_mvpMatrix = new Matrix4()// ç»˜åˆ¶å¸¦çº¹ç†çš„ç«‹æ–¹ä½“function drawTextureCube(gl, program, o, angle, texture, viewProjMatrix) g_modelMatrix.setRotate( 20.0, 1.0, 0.0, 0.0 ).rotate( angle, 0.0, 1.0, 0.0 ) g_mvpMatrix.set( viewProjMatrix ).multiply( g_modelMatrix ) gl.uniformMatrix4fv(program.u_MvpMatrix, false, g_mvpMatrix.elements) drawTexturedObject(gl, program, o, texture)// ç»˜åˆ¶å¹³é¢function drawTexturedPlane(gl, program, o, angle, texture, viewProjMatrix) g_modelMatrix.setTranslate( 0, 0, 1 ).rotate( 20.0, 1.0, 0.0, 0.0 ).rotate( angle, 0.0, 1.0, 0.0 ) g_mvpMatrix.set( viewProjMatrix ).multiply( g_modelMatrix ) gl.uniformMatrix4fv(program.u_MvpMatrix, false, g_mvpMatrix.elements) drawTexturedObject(gl, program, o, texture)// ç»˜åˆ¶çº¹ç†å¯¹è±¡function drawTexturedObject(gl, program, o, texture) initAttributeVariable(gl, program.a_Position, o.vertexBuffer) initAttributeVariable(gl, program.a_TexCoord, o.texCoordBuffer) gl.activeTexture(gl.TEXTURE0) gl.bindTexture(gl.TEXTURE_2D, texture) gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, o.indexBuffer) gl.drawElements(gl.TRIANGLES, o.numIndices, o.indexBuffer.type, 0)// è·å–attributefunction initAttributeVariable(gl, a_attribute, buffer) gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.vertexAttribPointer(a_attribute, buffer.num, buffer.type, false, 0, 0) gl.enableVertexAttribArray(a_attribute)let ANGLE_STEP = 30let last = Date.now()function animate(angle) let now = Date.now() let elapsed = now - last last = now let newAngle = angle + (ANGLE_STEP * elapsed) / 1000.0; return newAngle % 360 æ¸²æŸ“æµç¨‹è¯¦è§£åˆ›å»ºå¸§å†²åŒºå¯¹è±¡framebuffer = gl.createFramebuffer() createFramebufferç”¨äºåˆ›å»ºå¸§ç¼“å†²åŒºå¯¹è±¡ deleteFramebufferç”¨äºåˆ é™¤å¸§ç¼“å†²åŒºå¯¹è±¡ åˆ›å»ºçº¹ç†å¯¹è±¡å¹¶è®¾ç½®å°ºå¯¸å’Œå‚æ•°texture = gl.createTexture() // åˆ›å»ºçº¹ç†å¯¹è±¡gl.bindTexture(gl.TEXTURE_2D, texture)gl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT, 0, gl.RGBA, gl.UNSIGNED_BYTE, null)gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)framebuffer.texture = texture // å­˜å…¥çº¹ç†å¯¹è±¡ åˆ›å»ºæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡depthBuffer = gl.createRenderbuffer(); createRenderbufferåˆ›å»ºæ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ deleteRenderbufferåˆ é™¤æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡ ç»‘å®šæ¸²æŸ“ç¼“å†²åŒºå¹¶è®¾ç½®å…¶å°ºå¯¸gl.bindRenderbuffer(gl.RENDERBUFFER, depthBuffer)gl.renderbufferStorage( gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT) bindRenderbufferç»‘å®šæ¸²æŸ“ç¼“å†²åŒº renderbufferStorageåˆ›å»ºå¹¶åˆå§‹åŒ–æ¸²æŸ“ç¼“å†²åŒºçš„æ•°æ®åŒº æ·±åº¦å…³è”å¯¹è±¡çš„æ¸²æŸ“ç¼“å†²åŒºå®½é«˜å¿…é¡»ä¸çº¹ç†ç¼“å†²åŒºä¸€è‡´ å°†çº¹ç†å¯¹è±¡å…³è”åˆ°å¸§ç¼“å†²åŒºå¯¹è±¡gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer); // ç»‘å®šå¸§ç¼“å†²åŒºgl.framebufferTexture2D( gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0) bindFramebufferç»‘å®šå¸§ç¼“å†²åŒºå¯¹è±¡ framebufferTexture2DæŒ‡å®šé¢œè‰²å’Œæ¸²æŸ“å…³è”å¯¹è±¡ ä¸ºä»€ä¹ˆé¢œè‰²å…³è”å¯¹è±¡å­˜åœ¨0åç¼€ï¼Ÿç­”ï¼š åœ¨OpenGLä¸­æœ‰å¾ˆå¤šé¢œè‰²å…³è”å¯¹è±¡ï¼Œä½†åœ¨WebGLä¸­åªæœ‰1ä¸ªï¼Œæ‰€ä»¥å°±åªå°†åºå·ä¸º0çš„é¢œè‰²å…³è”å¯¹è±¡åˆ†ç»™äº†WebGLã€‚ å°†æ¸²æŸ“ç¼“å†²åŒºå¯¹è±¡å…³è”åˆ°å¸§ç¼“å†²åŒºå¯¹è±¡gl.framebufferRenderbuffer( gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthBuffer) framebufferRenderbuffer æ£€æŸ¥å¸§ç¼“å†²åŒºçš„é…ç½®let e = gl.checkFramebufferStatus(gl.FRAMEBUFFER)if(gl.FRAMEBUFFER.COMPLETE !== e) console.log(Framebuffer object is incomlete: + e.toString()) return error() checkFramebufferStatus åœ¨å¸§ç¼“å†²åŒºè¿›è¡Œç»˜å›¾function draw(gl, canvas, fbo, plane, cube, angle, texture, viewProjMatrix, viewProjMatrixFBO) // å…ˆç»˜åˆ¶åœ¨å¸§ç¼“å†²åŒºä¸Š gl.bindFramebuffer(gl.FRAMEBUFFER, fbo) gl.viewport(0, 0, OFFSCREEN_WIDTH, OFFSCREEN_HEIGHT) gl.clearColor(0.2, 0.2, 0.4, 1.0) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) drawTextureCube(gl, gl.program, cube, angle, texture, viewProjMatrixFBO) // å†ç»˜åˆ¶åœ¨canvasä¸Š gl.bindFramebuffer(gl.FRAMEBUFFER, null) gl.viewport(0, 0, canvas.width, canvas.height) gl.clearColor(0.0, 0.0, 0.0, 1.0) gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) drawTexturedPlane(gl, gl.program, plane, angle, fbo.texture, viewProjMatrix) viewportå®šä¹‰ç¦»çº¿ç»˜å›¾çš„ç»˜å›¾åŒºåŸŸ å¼€å¯æ¶ˆéšåŠŸèƒ½gl.CULL_FACE è¿è¡ŒFramebufferObjectæ—¶ï¼ŒçŸ©å½¢æ­£åä¸¤é¢éƒ½è¢«è´´ä¸Šäº†çº¹ç†ï¼Œè¿™æ˜¯å› ä¸ºWebGLé»˜è®¤ ç»˜åˆ¶å›¾å½¢çš„æ­£åä¸¤é¢ã€‚å®é™…ä¸ŠWebGLæä¾›æ¶ˆéšåŠŸèƒ½ï¼ˆculling functionï¼‰ï¼Œ gl.enable(gl.CULL_FACE)è¿™æ ·è®©WebGLä¸å†ç»˜åˆ¶å›¾å½¢èƒŒé¢ï¼Œèƒ½å¤Ÿæé«˜ç»˜åˆ¶é€Ÿåº¦ æœªå¼€å¯æ¶ˆéšæœªå¼€å¯æ¶ˆéšè¿è¡Œç»“æœ å¼€å¯äº†æ¶ˆéšå¼€å¯äº†æ¶ˆéšè¿è¡Œç»“æœ"},{"title":"å“åº”ä¸Šä¸‹æ–‡ä¸¢å¤±","path":"/wiki/WebGL/chapter_10_09.html","content":"ä»€ä¹ˆæ˜¯å“åº”ä¸Šä¸‹æ–‡ä¸¢å¤± å°±æ˜¯æŒ‡åœ¨WebGLç¨‹åºè¿è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªç¨‹åºæ¥ç®¡äº†å›¾å½¢ç¡¬ä»¶ï¼Œæˆ–è€…æ“ä½œç³»ç»Ÿè¿›å…¥äº†ä¼‘çœ çŠ¶æ€ï¼Œæ€»ä¹‹å°±æ˜¯ æµè§ˆå™¨å¤±å»ä½¿ç”¨å›¾å½¢ç¡¬ä»¶èµ„æºçš„æƒåˆ©ï¼Œä¼šå¯¼è‡´å­˜å‚¨åœ¨ç¡¬ä»¶ä¸­çš„æ•°æ®ï¼ˆå“åº”ä¸Šä¸‹æ–‡ï¼‰ä¸¢å¤±ã€‚ELELçš„å¥‡å¦™æ¯”å–»è¿™å°±åƒä½ å¦ˆï¼ˆæ“ä½œç³»ç»Ÿï¼‰åˆ†é…ç»™ä½ å’Œä½ å…„å¼Ÿå§å¦¹ä»¬å„ç§ç‚¹å¿ƒï¼ˆç¡¬ä»¶èµ„æºï¼‰ï¼Œå¦‚æœä½ å…„å¼ŸæŠŠä½ çš„ç‚¹å¿ƒæŠ¢èµ°äº†ï¼ˆå…¶ä»–ç¨‹åºæŠ¢å èµ„æºï¼‰ï¼Œæˆ–è€…ä½ å¦ˆæ‰“ç›¹è¿‡å¤´å¿˜äº†åˆ†ç»™ä½ äº†ï¼ˆæ“ä½œç³»ç»Ÿé•¿æ—¶é—´ä¼‘çœ å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ï¼Œå¯¼è‡´ä½ æ²¡æœ‰ç‚¹å¿ƒåƒï¼Œåªå¥½å£å¤´åæŠ—ï¼ˆæ§åˆ¶å°æŠ¥é”™ï¼‰ å¯èƒ½ä¼šæŠ¥WebGL error CONTEXT_LOST_WEBGL in uniformMatrix4fv([object WebGLUniformLocation, false, [object Float32Array]]) å¦‚ä½•å“åº”ä¸Šä¸‹æ–‡ä¸¢å¤±é€šè¿‡å¯¹ä¸Šä¸‹æ–‡äº‹ä»¶ç›‘å¬ webglcontextlost ä¸Šä¸‹æ–‡ä¸¢å¤±æ—¶è§¦å‘webglcontextrestored æµè§ˆå™¨é‡ç½®WebGLæ—¶è§¦å‘ RotatingTriangle_contextLostmainstartcontextLostlet ANGLE_STEP = 45.0let g_currentAngle = 0.0let g_requestIDfunction main() let canvas = document.getElementById(webgl) canvas.addEventListener(webglcontextlost, contextLost, false) canvas.addEventListener(webglcontextrestored, function (ev) start(canvas) , false) start(canvas)é‡ç»˜äº‹ä»¶function start(canvas) let gl = getWebGLContext(canvas) if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(Failed to intialize shaders.); return; var n = initVertexBuffers(gl); // Write the positions of vertices to a vertex shader if (n 0) console.log(Failed to set the positions of the vertices); return; gl.clearColor(0.0, 0.0, 0.0, 1.0); // Specify the color for clearing canvas // Get storage location of u_ModelMatrix var u_ModelMatrix = gl.getUniformLocation(gl.program, u_ModelMatrix); if (!u_ModelMatrix) console.log(Failed to get the storage location of u_ModelMatrix); return; var modelMatrix = new Matrix4(); // Create a model matrix let tick = function () g_currentAngle = animate(g_currentAngle) draw(gl, n, g_currentAngle, modelMatrix, u_ModelMatrix) g_requestID = requestAnimationFrame(tick,canvas) tick()ä¸Šä¸‹æ–‡ä¸¢å¤±äº‹ä»¶function contextLost(ev) cancelAnimationFrame(g_requestID) //åœæ­¢åŠ¨ç”» ev.preventDefault() // é˜»æ­¢é»˜è®¤äº‹ä»¶"},{"title":"é™„å½•Aï¼šWebGLä¸­æ— éœ€äº¤æ¢ç¼“å†²åŒº","path":"/wiki/WebGL/chapter_11_01.html","content":"äº¤æ¢ç¼“å†²åŒºäº¤æ¢ç¼“å†²åŒºæ˜¯ä»€ä¹ˆï¼Ÿ OpenGLä¸­å®é™…æœ‰ä¸¤ä¸ªé¢œè‰²ç¼“å†²åŒºï¼šåå°é¢œè‰²ç¼“å†²åŒºå®é™…ç»˜åˆ¶å¯¹è±¡å‰å°é¢œè‰²ç¼“å†²åŒºåå°ç»˜åˆ¶å®Œåï¼Œä¼šå°†å†…å®¹å¤åˆ¶åˆ°å‰å°å› ä¸ºç›´æ¥åœ¨å‰å°ç»˜åˆ¶ä¼šå¯¼è‡´å±å¹•ä¸Šå‡ºç°ä¸€äº›è§†è§‰å‡è±¡åå°ç»˜åˆ¶å®Œåï¼Œå°†å†…å®¹å¤åˆ¶åˆ°å‰å°ï¼Œå°±å«åš äº¤æ¢ç¼“å†²åŒºï¼Œå®è´¨ä¸Šæ˜¯ äº¤æ¢æŒ‡é’ˆ åŒç¼“å†²åŒºæ–¹æ³•çš„è°ƒç”¨æœºåˆ¶ åŒç¼“å†²åŒºæ–¹æ³•ä¸»è¦å°±æ˜¯ç”¨æ¥ åˆ‡æ¢å‰å°ä¸åå°ç¼“å†²åŒºçš„ï¼Œä¸åŒçš„ç³»ç»Ÿæœ‰ä¸åŒçš„è°ƒç”¨æœºåˆ¶ï¼šè‡ªåŠ¨è°ƒç”¨æ˜¾å¼è°ƒç”¨ è°ƒç”¨æ—¶æœºï¼šåœ¨åå°ç¼“å†²åŒºç»˜åˆ¶å®Œä¸€å¸§åå¦‚glutSwapBuffers()æˆ–eglSwapBuffers()void display(void) glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); draw(); glutSwapBuffers(); //æ˜¾ç¤ºäº¤æ¢é¢œè‰²ç¼“å†²åŒº WebGLä¸ºä»€ä¹ˆä¸ç”¨äº¤æ¢ç¼“å†²åŒºï¼Ÿå› ä¸ºWebGLåªæœ‰ä¸€ä¸ªé¢œè‰²ç¼“å†²åŒº ä¹Ÿå°±æ˜¯æ‰€è°“çš„ å•ç¼“å†²åŒºï¼Œå•ç¼“å†²åŒºä¹‹æ‰€ä»¥å¯ç”¨å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼ŒJavaScriptç¼–å†™çš„WebGLç¨‹åºåªæ˜¯ ä¸€æ¬¡æ›´åº•å±‚æ–¹æ³•çš„è°ƒç”¨ç»å…¸ä¸ç”¨è€ƒè™‘åº•å±‚è°ƒç”¨ï¼Œæµè§ˆå™¨ï¼Œæˆ‘çš„è¶…äºº æµè§ˆå™¨å•ç¼“å†²åŒºç»˜åˆ¶æµç¨‹Step1JavaScriptæ‰§è¡Œç»“æŸå¹¶é€€å‡ºStep2æµè§ˆå™¨æ£€æŸ¥é¢œè‰²ç¼“å†²åŒºæ˜¯å¦è¢«ä¿®æ”¹Step3å¦‚æœé¢œè‰²ç¼“å†²åŒºè¢«ä¿®æ”¹è¿‡äº†ï¼Œå°†å…¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šæ–¹æ³•ä¼˜åŠ¿æµè§ˆå™¨å¯ä»¥åŒæ—¶æ§åˆ¶é¢œè‰²ç¼“å†²åŒºç½‘é¡µä¸Šçš„å…¶ä»–å†…å®¹"},{"title":"é™„å½•Bï¼šGLES ES 1.0å†…ç½®å‡½æ•°","path":"/wiki/WebGL/chapter_11_02.html","content":"è§’åº¦å’Œä¸‰è§’å‡½æ•° æŒ‡æ•°å‡½æ•° é€šç”¨å‡½æ•° å‡ ä½•å‡½æ•° çŸ©é˜µå‡½æ•° çŸ¢é‡å‡½æ•° çº¹ç†æŸ¥è¯¢å‡½æ•° è§’åº¦å’Œä¸‰è§’å‡½æ•°æŒ‡æ•°å‡½æ•°é€šç”¨å‡½æ•°å‡ ä½•å‡½æ•°çŸ©é˜µå‡½æ•°çŸ¢é‡å‡½æ•°çº¹ç†æŸ¥è¯¢å‡½æ•°"},{"title":"é™„å½•Dï¼šå·¦æ‰‹è¿˜æ˜¯å³æ‰‹åæ ‡ç³»","path":"/wiki/WebGL/chapter_11_04.html","content":"å®˜æ–¹å›ç­”ï¼š The GL does not force left-or right-handedness on of its coordinate systems.ç¿»è¯‘ï¼šè€æ˜¯é—®è¿™ç§é’»ç‰›è§’å°–çš„é—®é¢˜ï¼Œéƒ½è¯´äº†å·¦å³æ‰‹éƒ½è¡Œã€‚é‚£ä¸ºä»€ä¹ˆä¹‹å‰åœ¨WebGLä¸­é¢‘é¢‘ä½¿ç”¨å³æ‰‹åæ ‡ç³»å‘¢ï¼Ÿè¿™ä¸ªç­”æ¡ˆå’Œä½ é—®å—æ–¹äººä¸ºä»€ä¹ˆåƒè‚‰ç²½å­ï¼Œå’ŒåŒ—æ–¹äººä¸ºä»€ä¹ˆåƒç”œç²½å­ä¸€æ ·ï¼Œéƒ½æ˜¯å› ä¸ºä¼ ç»Ÿ CoordinateSystem.jsWebGLçš„zè½´æŒ‡å‘å±å¹•å¤–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š è¶Šæ·±çš„ç‰©ä½“zå€¼è¶Šå° è¶Šæµ…çš„ç‰©ä½“zå€¼è¶Šå¤§ CoordinateSystem CoordinateSystemè¿è¡Œç»“æœShadermaininitVertexBufferslet VSHADER_SOURCE = ` attribute vec4 a_Position; attribute vec4 a_Color; varying vec4 v_Color; void main() gl_Position = a_Position; v_Color = a_Color; `let FSHADER_SOURCE = ` #ifdef GL_ES precision mediump float; #endif varying vec4 v_Color; void main() gl_FragColor = v_Color; `function main() let canvas = document.getElementById(webgl) let gl = getWebGLContext(canvas) if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders) return gl.clearColor(0, 0, 0, 1) let n = initVertexBuffers(gl) if (n 0) console.log(failed to init vertex buffers) return gl.clear(gl.COLOR_BUFFER_BIT) gl.drawArrays(gl.TRIANGLES, 0, n)function initVertexBuffers(gl) let vertices = new Float32Array([ // bluetriangle 0.0, 0.6, -0.1, 0.0, 0.0, 1.0, -0.5, -0.5, -0.1, 0.4, 0.4, 0.4, 0.5, -0.5, -0.1, 0.0, 0.0, 1.0, // green triangle -0.5, 0.5, -0.5, 0.0, 1.0, 0.0, 0.5, 0.5, -0.5, 0.4, 0.4, 0.4, 0.0, -0.6,-0.5, 0.0, 1.0, 0.0 ]) let FSIZE = vertices.BYTES_PER_ELEMENT let n = 6 let a_Position = gl.getAttribLocation(gl.program, a_Position) let a_Color = gl.getAttribLocation(gl.program, a_Color) let buffer = gl.createBuffer() if (!buffer) return -1 gl.bindBuffer(gl.ARRAY_BUFFER, buffer) gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW) gl.vertexAttribPointer(a_Position, 3, gl.FLOAT, false, 6*FSIZE, 0) gl.enableVertexAttribArray(a_Position) gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 6*FSIZE, 3*FSIZE) gl.enableVertexAttribArray(a_Color) return n éšè—é¢æ¶ˆé™¤å’Œè£å‰ªåæ ‡ç³»ç»Ÿä¸ºä»€ä¹ˆç»“æœä¼šæ˜¯ç»¿è‰²ä¸‰è§’å½¢åœ¨å‰ï¼Ÿ è“è‰²ä¸‰è§’å½¢æ•°æ®0.0, 0.6, -0.1, 0.0, 0.0, 1.0, -0.5, -0.5, -0.1, 0.4, 0.4, 0.4,0.5, -0.5, -0.1, 0.0, 0.0, 1.0,ç»¿è‰²ä¸‰è§’å½¢æ•°æ® -0.5, 0.5, -0.5, 0.0, 1.0, 0.0,0.5, 0.5, -0.5, 0.4, 0.4, 0.4,0.0, -0.6,-0.5, 0.0, 1.0, 0.0è¿™æ˜¯å› ä¸ºæ²¡æœ‰è¿›è¡Œéšè—é¢æ¶ˆé™¤è¿™æ—¶WebGLé»˜è®¤æ˜¯æŒ‰ç…§ç»˜åˆ¶é¡ºåºæ¥æ’åˆ—æ·±åº¦çš„ è¿›è¡Œéšè—é¢æ¶ˆé™¤ä¹‹åçš„ç»“æœ æ‰“å¼€éšè—é¢æ¶ˆé™¤gl.enable(gl.DEPTH_TEST)// ...gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)ç»˜åˆ¶ç»“æœä¼šæ”¹å˜å—ï¼Ÿç­”ï¼š å¹¶æ²¡æœ‰å“¦ ä¾æ—§æ˜¯ç»¿è‰²ä¸‰è§’å½¢åœ¨ä¸Šè¿™æ˜¯å› ä¸º WebGLä½¿ç”¨çš„æ˜¯å·¦æ‰‹åæ ‡ç³»zè½´æ˜¯æŒ‡å‘å±å¹•å†…éƒ¨çš„å·¦æ‰‹åæ ‡ç³» è£å‰ªåæ ‡ç³»å’Œå¯è§†ç©ºé—´è£å‰ªåæ ‡ç³»ï¼ˆclip coordinate systemï¼‰ å¼€å¯éšè—é¢æ¶ˆé™¤çš„æ—¶å€™ä¼šç”¨åˆ°è£å‰ªåæ ‡ç³»ï¼Œè£å‰ªåæ ‡ç³»æœ¬èº«å°±æ˜¯å·¦æ‰‹åæ ‡ç³» åˆ°åº•è¦æ€æ ·æ‰èƒ½è®©WebGLæ¢å¤å³æ‰‹åæ ‡ç³»çš„çŠ¶æ€å‘¢ï¼Ÿ å…ˆè¦äº†è§£ä¸ºä»€ä¹ˆå¼€å¯æ¶ˆé™¤é¢éšè—åè¿˜æ˜¯ä»¥å·¦æ‰‹åæ ‡ç³»ç»˜å›¾ç­”ï¼šæ­£å› ä¸ºè£å‰ªåæ ‡ç³»æ˜¯å·¦æ‰‹åæ ‡ç³»ï¼Œæ‰€ä»¥ a_Position çš„æ•°å€¼ä¼ é€’ç»™ gl_Position æ—¶ï¼Œä¼šè‡ªåŠ¨è¢«çº³å…¥ å·¦æ‰‹åæ ‡ç³» è§£å†³æ–¹æ³•åªæœ‰è®¾å®šå¯è§†ç©ºé—´éšè—é¢æ¶ˆé™¤æ‰èƒ½å¤Ÿæ­£å¸¸å·¥ä½œå…³é”®å°±æ˜¯è®¾å®šå¯è§†ç©ºé—´æ—¶ä¼šæŒ‡å®š:è¿‘å‰ªè£é¢ nearè¿œå‰ªè£é¢ farè¿™ä¸¤è€…å†³å®šäº†ä½¿ç”¨çš„åæ ‡ç³»ï¼šnear far zè½´æŒ‡å‘å±å¹•å¤–å³æ‰‹åæ ‡ç³»near farzè½´æŒ‡å‘å±å¹•é‡Œå·¦æ‰‹åæ ‡ç³»ç»™CoordinateSystem.jsæ·»åŠ ä¸Šå¯è§†ç©ºé—´çš„ä»£ç ï¼šlet VSHADER_SOURCE = ` ... uniform mat4 u_MvpMatrix; ... gl_Position = u_MvpMatrix * a_Position; ...`function main() ... let mvpMatrix = new Matrix4() mvpMatrix.setOrtho( -1, 1, // left right -1, 1, // bottom top -1, 1 // near far ) gl.uniformMatrix4fv(u_MvpMatrix,false,mvpMatrix.elements) ... å³æ‰‹åæ ‡ç³»ä¸‹çš„ç»˜åˆ¶ç»“æœ å¯è§†ç©ºé—´ã€æŠ•å½±çŸ©é˜µã€åæ ‡ç³»ä¸ºä»€ä¹ˆnearfaræ—¶å°±æ˜¯å³æ‰‹åæ ‡ç³»ç»˜å›¾å‘¢ï¼Ÿ è¿™é‡Œéœ€è¦è€ƒè™‘ä¸€ä¸‹ setOrtho å¯¹åº”çš„æŠ•å½±çŸ©é˜µï¼ŒmvpMatrix.setOrtho(-1,1,-1,1,-1,1)left -1right 1bottom -1top 1near -1far 1å¯¹åº”çš„æŠ•å½±çŸ©é˜µåº”è¯¥æ˜¯1, 0, 0, 0,0, 1, 0, 0,0, 0, -1, 0,0, 0, 0, 1,ç›¸å½“äºå¯¹zè½´è¿›è¡Œç¿»è½¬ï¼ŒsetScale(1,1,-1)ç”±äºè£å‰ªåæ ‡ç³»æœ¬èº«å°±æ˜¯å·¦æ‰‹åæ ‡ç³»ï¼Œè¿™ä¸€æ“ä½œç›¸å½“äºå°†å·¦æ‰‹å·¦è¾¹ç³»ç¿»è½¬æˆå³æ‰‹åæ ‡ç³»ã€‚ æ€»ç»“æ€»ä¹‹è¿™ä¸€åˆ‡çš„ä¸€åˆ‡éƒ½æ˜¯æ— ä¸­ç”Ÿæœ‰ WebGLé»˜è®¤è¡Œä¸ºè§„å®šæ˜¯ å·¦æ‰‹åæ ‡ç³»æ¯”å¦‚è£å‰ªé¢ä¸€ç±»çš„é»˜è®¤è¡Œä¸ºå¤§éƒ¨åˆ†WebGLåº“å’Œç¨‹åºéƒ½é‡‡ç”¨çš„æ˜¯ å³æ‰‹åæ ‡ç³»åˆ«é—®ï¼Œé—®å°±æ˜¯ä¼ ç»Ÿä¸ºäº†è§£å†³è¿™ä¸ªå†²çªéœ€è¦å°†ä½¿ç”¨ å³æ‰‹åæ ‡ç³»çš„WebGLåº“ï¼Œé€šè¿‡è§„å®š å¯è§†ç©ºé—´ çš„æ–¹å¼ç¿»è½¬zè½´ï¼Œä»è€Œèƒ½å¤Ÿå®ç°ä¸€äº›è§„å®šä½¿ç”¨ å·¦æ‰‹åæ ‡ç³»çš„é»˜è®¤è¡Œä¸ºæ€»ç»“æ€»ä¹‹è¿™ä¸ªé—®é¢˜å‘Šè¯‰æˆ‘ä»¬ç¨‹åºå‘˜å¥‡å¥‡æ€ªæ€ªçš„ä¹ æƒ¯å¦‚ä½•èƒ½æ— ä¸­ç”Ÿæœ‰å‡ºä¸€ä¸ªæ·±å¥¥æ™¦æ¶©çš„æŠ€æœ¯é—®é¢˜ï¼Œè¿˜å‘Šè¯‰æˆ‘ä»¬è®©ç¨‹åºå‘˜ç»Ÿä¸€å¼€å‘è§„èŒƒæœ‰å¤šéš¾"},{"title":"é™„å½•Eï¼šé€†è½¬ç½®çŸ©é˜µ","path":"/wiki/WebGL/chapter_11_05.html","content":"ä¸€èˆ¬ä½¿ç”¨ä¸¤ç§å˜æ¢çŸ©é˜µå¯¹æ³•å‘é‡è¿›è¡Œå˜æ¢ æ¨¡å‹è§†å›¾çŸ©é˜µçš„ é€†è½¬ç½®çŸ©é˜µæ¨¡å‹çŸ©é˜µå…·ä½“ä½¿ç”¨å“ªç§è¦è§†ç‰©ä½“å˜æ¢çš„ç±»å‹è€Œå®šã€‚ åæ ‡å˜æ¢ä¸æ³•å‘é‡å˜æ¢çš„å…³ç³» å˜æ¢ä¸æ³•å‘é‡å¹³ç§»å¹³ç§»å˜æ¢ä¸æ³•å‘é‡å˜æ¢çš„å…³ç³» å˜æ¢é—®é¢˜ å¹³ç§»çš„ç‰©ä½“å®é™…ä¸Šæ³•å‘é‡ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯å¦‚æœæ¨¡å‹è§†å›¾çŸ©é˜µä¸­åŒ…å«å¹³ç§»çŸ©é˜µçš„è¯ï¼ŒåŸæ³•å‘é‡ä¼šè¢«å½“åšç‚¹å¹³ç§» è§£å†³æ–¹æ³• æ—¢ç„¶4ç»´æ¨¡å‹è§†å›¾çŸ©é˜µä¸­ä¸å¹³ç§»ç›¸å…³çš„åªæœ‰ ç¬¬4è¡Œ å’Œ ç¬¬4åˆ—ï¼Œå‰©ä¸‹çš„ 3x3å­çŸ©é˜µ éƒ½æ˜¯ä¸æ—‹è½¬å’Œç¼©æ”¾æœ‰å…³çš„ï¼Œé‚£å°±åªå–å…¶å·¦ä¸Šè§’çš„ 3x3å­çŸ©é˜µ å¯¹æ³•å‘é‡è¿›è¡Œå˜åŒ–å°±å¥½äº† æ—‹è½¬æ—‹è½¬å˜æ¢ä¸æ³•å‘é‡å˜æ¢çš„å…³ç³» è¾ƒä¸ºç®€å•çš„æ—‹è½¬å˜æ¢ ç®€å•ç†ç”±1å¦‚æœåªè¿›è¡Œæ—‹è½¬å˜æ¢ï¼Œåˆ™ç›´æ¥å¯¹æ³•å‘é‡ä½¿ç”¨ç›¸åŒçš„æ—‹è½¬çŸ©é˜µå°±èƒ½ç›´æ¥å®ç°æ³•å‘é‡å˜æ¢ã€‚å³æ—‹è½¬æ—¶æ—¶ï¼šé¡¶ç‚¹å˜æ¢çŸ©é˜µ æ³•å‘é‡å˜æ¢çŸ©é˜µç®€å•ç†ç”±2æ—‹è½¬åæ— éœ€è¿›è¡Œ å½’ä¸€åŒ–å¤„ç† ç¼©æ”¾æƒ…å†µ1ï¼šç¼©æ”¾å› å­ç›¸åŒ é‚£ä¹ˆæ³•å‘é‡è‡ªç„¶ä¸å˜ï¼šé¡¶ç‚¹ç¼©æ”¾çŸ©é˜µ æ³•å‘é‡å˜æ¢çŸ©é˜µéœ€è¦è¿›è¡Œ å½’ä¸€åŒ–å¤„ç† æƒ…å†µ2ï¼šç¼©æ”¾å› å­ä¸åŒ ç¼©æ”¾å› å­ä¸åŒæ—¶çš„æ³•å‘é‡å˜æ¢è¿™ç§æƒ…å†µå¿…é¡»ä½¿ç”¨ æ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µå˜æ¢åæ³•å‘é‡å¿…é¡»è¿›è¡Œ å½’ä¸€åŒ–å¤„ç† é€†è½¬ç½®çŸ©é˜µçš„æ•°å­¦æ¨ç†å‡è®¾ç‰©ä½“é¡¶ç‚¹çŸ¢é‡ä¸º så‚ç›´äº s çš„æ³•å‘é‡ä¸º nå¯¹ s è¿›è¡Œå˜æ¢çš„æ¨¡å‹çŸ©é˜µä¸º Må¯¹ n è¿›è¡Œå˜æ¢çš„çŸ©é˜µä¸º Mâ€˜å˜æ¢åçš„ç‰©ä½“é¡¶ç‚¹çŸ¢é‡ä¸º sâ€™å˜æ¢åçš„æ³•å‘é‡ä¸º nâ€™å·²çŸ¥æ¡ä»¶ç”±äº n ä¸ s å‚ç›´ï¼Œ nâ€™ ä¸ sâ€™ å‚ç›´æ‰€ä»¥æœ‰ï¼šn Â· s 0nâ€™Â· sâ€˜ 0sâ€™ M Ã— snâ€™ Mâ€™ Ã— nå¼€å§‹æ¨å¯¼âˆµ nâ€™Â· sâ€™ 0âˆ´ ï¼ˆMâ€™ Ã— nï¼‰Â·ï¼ˆM Ã— sï¼‰ 0âˆµ A Â· B AT Ã— BTâˆ´ ï¼ˆMâ€™ Ã— nï¼‰T Ã—ï¼ˆM Ã— sï¼‰T 0âˆµ ï¼ˆA Ã— Bï¼‰T BT Ã— ATâˆ´ nT Ã— Mâ€˜T Ã— MT Ã— sT 0âˆµ nT Ã— sT n Â· s 0âˆ´ è¦æ»¡è¶³ç­‰å¼ï¼Œå¿…é¡»æœ‰ Mâ€™T Ã— MT Iâˆ´ Mâ€™ (M^-1)Tæ€»ç»“ï¼š æ³•å‘é‡çš„å˜æ¢çŸ©é˜µå³æ˜¯æ¨¡å‹çŸ©é˜µçš„é€†è½¬ç½®çŸ©é˜µ"},{"title":"é™„å½•Fï¼šä»æ–‡ä»¶ä¸­åŠ è½½ç€è‰²å™¨","path":"/wiki/WebGL/chapter_11_06.html","content":"æœ¬æ¡ˆä¾‹ä¸»è¦ä»‹ç»å¦‚ä½•å°†ç€è‰²å™¨ç¨‹åºä»jsä¸­æå–å‡ºæ¥ã€‚ LoadShaderFromFiles Code LoadShaderFromFilesè¿è¡Œæ•ˆæœXMLHttpRequestshadermaindrawfunction readShaderFile(gl, fileName, shader) let request = new XMLHttpRequest() request.onreadystatechange = function () if (request.readyState === 4 request !== 404) onReadShader(gl, request.responseText, shader) request.open(GET, fileName, true) request.send()function onReadShader(gl, fileString, shader) if (shader === v) VSHADER_SOURCE = fileString if (shader === f) FSHADER_SOURCE = fileString if(VSHADER_SOURCE FSHADER_SOURCE) start(gl)ColoredTriangle.vertattribute vec4 a_Position;attribute vec4 a_Color;varying vec4 v_Color;void main() gl_Position = a_Position; v_Color = a_Color;ColoredTriangle.frag#ifdef GL_ES precision mediump float;#endifvarying vec4 v_Color;void main() gl_FragColor = v_Color;let VSHADER_SOURCE = nulllet FSHADER_SOURCE = nullfunction main() let canvas = document.getElementById(webgl) let gl = getWebGLContext(canvas) if (!gl) console.log(failed to get webgl context) return readShaderFile(gl, ColoredTriangle.vert, v) readShaderFile(gl, ColoredTriangle.frag, f)function start(gl) if (!initShaders(gl, VSHADER_SOURCE, FSHADER_SOURCE)) console.log(failed to init shaders) return let n = initVertexBuffers(gl) if (n 0) console.log(failed to init vertex buffers) return gl.clearColor(0, 0, 0, 1) gl.clear(gl.COLOR_BUFFER_BIT) gl.drawArrays(gl.TRIANGLES,0,n)function initVertexBuffers(gl) let verticesColors = new Float32Array([ 0.0, 0.5, 1.0, 0.0, 0.0, -0.5, -0.5, 0.0, 1.0, 0.0, 0.5, -0.5, 0.0, 0.0, 1.0 ]) let n = 3 let FSIZE = verticesColors.BYTES_PER_ELEMENT let a_Position = gl.getAttribLocation(gl.program, a_Position) let a_Color = gl.getAttribLocation(gl.program, a_Color) if (a_Position 0 || a_Color 0) return -1 let vertexBuffer = gl.createBuffer() let colorBuffer = gl.createBuffer() gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer) gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW) gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 5 * FSIZE, 0) gl.enableVertexAttribArray(a_Position) gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer) gl.bufferData(gl.ARRAY_BUFFER, verticesColors, gl.STATIC_DRAW) gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, 5 * FSIZE, 2 * FSIZE) gl.enableVertexAttribArray(a_Color) return n"},{"title":"é™„å½•Cï¼šæŠ•å½±çŸ©é˜µ","path":"/wiki/WebGL/chapter_11_03.html","content":"å¯è§†ç©ºé—´ å¯è§†ç©ºé—´èƒ½å¤Ÿè§„å®šWebGLçš„ç»˜åˆ¶èŒƒå›´ï¼Œåœ¨ç¬¬7ç« ä¸­å·²ç»ä»‹ç»è¿‡ä¸¤ç§å¸¸ç”¨å¯è§†ç©ºé—´ï¼šæ­£å°„æŠ•å½±é€è§†æŠ•å½± æ­£å°„æŠ•å½±çŸ©é˜µMatrix4.setOrtho( left, right, bottom, top, near, far) é€è§†æŠ•å½±çŸ©é˜µMatrix4.setPerspective( fov, aspect, near, far)"},{"title":"make a 2D Games","path":"/wiki/Unity/Brackeys_01_make_a_game.html","content":"ç¬¬ä¸€ä¸ª2Dæ¸¸æˆunityä¸­åˆ¶ä½œ2Dæ¸¸æˆä¸»è¦æœ‰2ç§æµæ´¾ï¼šTile Based åŸºäºç½‘æ ¼ç³»ç»Ÿï¼Œç¼–è¾‘åœ°å›¾å’Œå…³å¡æ–¹ä¾¿Sprite Based å¯æ§æ€§æ›´å¼º åˆ›å»ºä¸€ä¸ªUnity2Dæ¸¸æˆé¡¹ç›® ç›´æ¥å¯¼å…¥Unity Asset Storeä¸­çš„å…è´¹ç´ æï¼šhttps://assetstore.unity.com/packages/2d/environments/free-platform-game-assets-85838https://assetstore.unity.com/packages/2d/environments/free-platform-game-assets-85838å¯¼å…¥çš„ç´ æåœ¨Assetsç›®å½•ä¸‹ï¼Œä¸€èˆ¬ç´ æåŒ…ä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªDemoæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æ˜¯ç”¨äºå±•ç¤ºç´ æçš„åœºæ™¯ Sorting Layer å›¾å±‚ å°†ä¸€å¼ ç“·ç –å’ŒèƒŒæ™¯å›¾åŒæ—¶æ”¾å…¥åœºæ™¯ä¸­æ—¶ï¼Œä¼šå‘ç°åæ”¾å…¥ç‰©ä½“ä¼šè¢«å…ˆæ”¾å…¥çš„ç‰©ä½“é®æŒ¡ä½ï¼Œè¿™æ—¶éœ€è¦ç»™ç‰©ä½“è®¾ç½®Sorting Layer æ·»åŠ Animation æ·»åŠ æœ‰åŠ¨ç”»çš„ç‰©ä½“ï¼Œéœ€è¦å°†ä¸€è¿ä¸²è¿ç»­çš„åŠ¨ç”»å¸§æ‹–æ‹½åˆ°ç›®å½•æ ‘ä¸‹ï¼šæ‹–æ‹½è¿›å»åï¼ŒUnityä¼šè‡ªåŠ¨åˆ›å»ºAnimationå’ŒAnimatorï¼Œæ³¨æ„åŠ¨ç”»ç‰©ä½“åŒæ ·ä¸è¦å¿˜äº†è®¾ç½®Sorting Layer æ·»åŠ ç‰©ç†æ•ˆæœ å¦‚ä½•å®ç°ä¸€ä¸ªç¡¬å¸æ‰è½åœ¨è‰åªä¸Šçš„åŠ¨ç”»ï¼Ÿ1ã€ç»™ç¡¬å¸å’Œè‰åªæ·»åŠ ç¢°æ’ä½“ç§¯ Box Collider 2D2ã€ç»™ç¡¬å¸æ·»åŠ åˆšä½“æ•ˆæœ RigidBody 2D3ã€è°ƒæ•´ç¡¬å¸çš„å›¾å±‚ï¼šç¡¬å¸å’Œè‰åªå› ä¸ºåŒæ ·å±äºforegroundå›¾å±‚çš„å…ƒç´ ï¼Œå› æ­¤è¿™é‡Œè°ƒæ•´çš„æ˜¯Order in Layerå±æ€§ Tile Pallete ç“¦ç‰‡è°ƒè‰²æ¿ è¦ä½¿ç”¨Tile Palleteï¼Œé¦–å…ˆè¦åˆ›å»ºç“¦ç‰‡åœ°å›¾ï¼šå³é”®Hierachy - 2D Object - TileMap - Rectangularåˆ›å»ºå‡ºä¸€ä¸ªGridç›®å½•ä¸‹æœ‰ä¸€ä¸ªTilemapå¯¹è±¡ã€‚Gridå¯¹è±¡çš„Cellå°ºå¯¸æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼šGrid Cell Sizeæ‰“å¼€è°ƒè‰²æ¿ç•Œé¢ï¼šWindows 2D Tile Palleteä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤æ–°å»ºçš„ä¸œè¥¿éƒ½è¦å­˜æ”¾åˆ°å¯¹åº”æ–‡ä»¶ä¸­å»æ–°å»ºè°ƒè‰²æ¿æ‹–å…¥Tileç“¦ç‰‡æ¥ä¸‹æ¥å°±å¯ä»¥ç”¨åˆ·å­é€‰ä¸­ç“¦ç‰‡æ„‰å¿«ç»˜åˆ¶åœ°å›¾ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯256*256çš„Tileï¼ŒTileçš„å°ºå¯¸å’ŒGridçš„å°ºå¯¸ä¸ä¸€è‡´ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹æ¯ä¸ªå•ä½åŒ…å«çš„åƒç´ å€¼ï¼šPixels Per UnitGridçš„Sizeæ˜¯2*2ï¼ŒTileçš„å°ºå¯¸æ˜¯256 * 256å•ä½çš„å¤§å°å°±åº”è¯¥ä¸ºï¼š2562 128"},{"title":"é™„å½•Gï¼šä¸–ç•Œåæ ‡ç³»å’Œæœ¬åœ°åæ ‡ç³»","path":"/wiki/WebGL/chapter_11_07.html","content":"åšä¸»â€œç™½ç‰æ— å†°â€å…³äºåæ ‡ç³»çš„ä¸€ç¯‡æœ‰è¶£çš„æ–‡ç« https://lamyoung.com/math/2021/12/10/math-Coordinate/ ä½¿ç”¨ä¸“ç”¨ä¸‰ç»´å»ºæ¨¡å·¥å…·æ„å»ºæ¨¡å‹çš„ä¼˜åŠ¿ ä¹‹å‰åªè¦ç»˜åˆ¶æ¨¡å‹å°±éœ€è¦åœ¨ initVertexBuffers é‡Œæ‰‹åŠ¨å†™å…¥å¤§é‡çš„æ•°æ®ï¼šæ¯”å¦‚MultiJoinModelç¨‹åºçš„æ¨¡å‹æ•°æ®å…¨éƒ½å†™åœ¨ç¨‹åºé‡Œvar vertices = new Float32Array([ 0.5, 1.0, 0.5, -0.5, 1.0, 0.5, -0.5, 0.0, 0.5, 0.5, 0.0, 0.5, // v0-v1-v2-v3 front 0.5, 1.0, 0.5, 0.5, 0.0, 0.5, 0.5, 0.0,-0.5, 0.5, 1.0,-0.5, // v0-v3-v4-v5 right 0.5, 1.0, 0.5, 0.5, 1.0,-0.5, -0.5, 1.0,-0.5, -0.5, 1.0, 0.5, // v0-v5-v6-v1 up -0.5, 1.0, 0.5, -0.5, 1.0,-0.5, -0.5, 0.0,-0.5, -0.5, 0.0, 0.5, // v1-v6-v7-v2 left -0.5, 0.0,-0.5, 0.5, 0.0,-0.5, 0.5, 0.0, 0.5, -0.5, 0.0, 0.5, // v7-v4-v3-v2 down 0.5, 0.0,-0.5, -0.5, 0.0,-0.5, -0.5, 1.0,-0.5, 0.5, 1.0,-0.5 // v4-v7-v6-v5 back]);// Normalvar normals = new Float32Array([ 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, // v0-v1-v2-v3 front 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, // v0-v3-v4-v5 right 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, // v0-v5-v6-v1 up -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, // v1-v6-v7-v2 left 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, // v7-v4-v3-v2 down 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0, 0.0, 0.0,-1.0 // v4-v7-v6-v5 back]);// Indices of the verticesvar indices = new Uint8Array([ 0, 1, 2, 0, 2, 3, // front 4, 5, 6, 4, 6, 7, // right 8, 9,10, 8,10,11, // up 12,13,14, 12,14,15, // left 16,17,18, 16,18,19, // down 20,21,22, 20,22,23 // back]);è€Œä½¿ç”¨å»ºæ¨¡å·¥å…·å…è®¸å¯¹åŸºæœ¬ä¸‰ç»´å›¾å½¢è¿›è¡Œå„ç§æ“ä½œï¼š ç»„åˆå½¢å˜é¡¶ç‚¹æ•°é‡è°ƒæ•´é¡¶ç‚¹é—´éš”ä¼˜åŒ–ç­‰ç­‰ æœ¬åœ°åæ ‡ç³»ä¸ä¸–ç•Œåæ ‡ç³»çš„å…³ç³» æœ¬åœ°åæ ‡ç³»æœ¬åœ°åæ ‡ç³»ï¼ˆlocal coordinate systemï¼‰ åˆ›å»ºä¸‰ç»´æ¨¡å‹éœ€è¦çŸ¥é“æ¨¡å‹åŸç‚¹ *ï¼ˆ0.0, 0.0, 0.0ï¼‰*åœ¨å“ªï¼Œæ¯”å¦‚ï¼šç«‹æ–¹ä½“çš„åŸç‚¹å°±åœ¨ ä¸­å¿ƒå¤ªé˜³æˆ–æœˆäº®ç­‰çƒä½“çš„åŸç‚¹åœ¨ çƒå¿ƒæ¸¸æˆè§’è‰²æ¨¡å‹çš„åŸç‚¹å¤§éƒ¨åˆ†éƒ½ä½äº è„šéƒ¨ï¼ŒYè½´ å‚ç›´å‘ä¸Š ç©¿è¿‡èº«ä½“çš„ä¸­çº¿ã€‚è¿™æ ·å°±å¯ä»¥æ–¹ä¾¿çš„æ“çºµæ¸¸æˆè§’è‰²åœ¨ä¸–ç•Œä¸­çš„ä½ç½®å’ŒåŠ¨ä½œï¼šy0 æ—¶ï¼Œæ¸¸æˆè§’è‰²å°±ç«™ç«‹åœ¨åœ°é¢ä¸Šæ¨¡å‹æ²¿yè½´æ—‹è½¬ï¼Œå³æ˜¯è§’è‰²åœ¨ è½¬å‘æ²¿Zè½´æˆ–Xè½´ç§»åŠ¨è§’è‰²ï¼Œå³æ˜¯è§’è‰²åœ¨åœ°é¢ä¸Šè·‘åŠ¨æˆ–æ»‘åŠ¨è‚²ç¢§æ•™ç§‘ä¹¦å¼æ¨¡å‹åæ ‡bugã€Šåˆºå®¢ä¿¡æ¡ï¼šç½—é©¬ä¹‹ä¸‹ã€‹ ä¸–ç•Œåæ ‡ç³»ä¸–ç•Œåæ ‡ç³»ï¼ˆworld coordinate systemï¼‰ ä¹Ÿç§° å…¨å±€åæ ‡ç³» (global coordinate system)å½“ç©ºé—´ä¸­çš„ç‰©ä½“ç§»åŠ¨å’Œå˜åŒ–æ—¶ï¼Œä¸èƒ½å°†ä¸–ç•Œåæ ‡ç³»æˆ–æœ¬ä½“åæ ‡ç³»åˆ†å¼€è€ƒè™‘ï¼Œéœ€è¦å°†ä¸¤ä¸ªåæ ‡ç³»ç»“åˆèµ·æ¥è€ƒè™‘ï¼Œå³ ä¸–ç•Œå˜æ¢ä¸–ç•Œå˜æ¢ï¼ˆworld transformationï¼‰å³ç‰©ä½“æœ¬èº«ä»ç„¶æ˜¯åŸºäº æœ¬åœ°åæ ‡ç³»ï¼Œä½†ç‰©ä½“ç›¸å¯¹ä¸–ç•Œçš„å˜æ¢éœ€è¦å°† æœ¬åœ°åæ ‡ç³» è½¬æ¢åˆ° ä¸–ç•Œåæ ‡ç³»ï¼Œè¿™å°±æ˜¯ä¸–ç•Œå˜æ¢ã€‚ LocalAndWorldCoordinateæ¡ˆä¾‹ä¸»è¦ä»‹ç»çš„æ˜¯ç®€å•çš„ä¸–ç•Œå˜æ¢ LocalAndWorldCoordinate Code æ²¿æœ¬ä½“åæ ‡ç³»æ—‹è½¬åŸºæœ¬åŸç†å®é™…ä¸Šå°±æ˜¯å°†ç‰©ä½“å…ˆå¹³ç§»å›åŸç‚¹ï¼Œç„¶åæ—‹è½¬ï¼Œç„¶åå†å¹³ç§»å›æ¥ï¼Œè¿™æœ¬ä¹¦ä½œè€…ä¹Ÿåœ¨ä¹¦é‡Œåæ§½ï¼šâ€ä¸ºäº†ä¼é¹…åƒåœ¨è·³èŠ­è•¾èˆä¸€æ ·è‡ªæ—‹ï¼Œä½ éœ€è¦å…ˆæŠŠä¼é¹…ç§»åˆ°åœºæ™¯åŸç‚¹ï¼Œæ—‹è½¬ï¼Œå†ç§»å›æ¥ï¼ŒçœŸå¤Ÿéº»çƒ¦çš„ã€‚â€œLocal World æœªç»ä¸–ç•Œå˜æ¢çš„ä¸‰è§’å½¢å›´ç»•ä¸–ç•Œyè½´æ—‹è½¬vertex shader// u_MvpMatrix ä¸ºè§†å›¾æ¨¡å‹çŸ©é˜µï¼Œå…¶ä¸­æ¨¡å‹éƒ¨åˆ†ç›´æ¥è¿›è¡Œç»•Yè½´æ—‹è½¬å˜æ¢gl_Position = u_MvpMatrix * a_Position ç»è¿‡ä¸–ç•Œå˜æ¢çš„ä¸‰è§’å½¢å›´ç»•æœ¬ä½“yè½´æ—‹è½¬vertex shader// u_vpmatrix è§†å›¾çŸ©é˜µ// transbackMatrix å°†é¡¶ç‚¹å¹³ç§»å›åŸç‚¹çš„å¹³ç§»çŸ©é˜µ// u_RotateMatrix æ—‹è½¬çŸ©é˜µ// translateMatrix å°†é¡¶ç‚¹ä»åŸç‚¹å¹³ç§»å›åæ ‡ä½ç½®çš„å¹³ç§»çŸ©é˜µgl_Position = u_vpMatrix * transbackMatrix * u_RotateMatrix * translateMatrix * a_Position; Buffer DatavpMatrixlet verticesColors = new Float32Array([ 0.0, 0.3, 0.5, 0.3, 0.6, 0.6, -0.3, -0.3, 0.5, 0.3, 0.0, 0.6, 0.3, -0.3, 0.5, 0.3, 0.0, 0.6, 0.0, 0.3, 0.0, 0.3, 0.8, 0.8, -0.3, -0.3, 0.0,0.3, 0.0, 0.8, 0.3, -0.3, 0.0,0.3, 0.0, 0.8, 0.0, 0.3, -0.5,0.3, 1.0, 1.0, -0.3, -0.3, -0.5, 0.3, 0.0, 1.0, 0.3, -0.3, -0.5,0.3, 0.0, 1.0,])let vpMatrix = new Matrix4()vpMatrix.setOrtho( -1.0, 1.0, -1.0, 1.0, -1.0, 1.0).lookAt( -0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,1.0,0.0) å˜æ¢ä¸åæ ‡ç³»"},{"title":"2D Movement in Unity","path":"/wiki/Unity/Brackeys_02_2d_movement.html","content":"Character ControlleråŸè§†é¢‘èµ„æºä½œè€…æä¾›çš„è„šæœ¬ä»£ç ï¼šå°†Character-ControlleråŠ å…¥æ§åˆ¶è§’è‰²Playerçš„è„šæœ¬ä¸­ï¼š åœ°é¢æ£€æµ‹ åœ°é¢æ£€æµ‹çš„ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼šä»€ä¹ˆæ˜¯åœ°é¢ï¼ŸWhat is Groundå±æ€§ï¼šé™¤äº†Playerè‡ªèº«ä»¥å¤–çš„Everythingæ£€æµ‹åˆ°åœ°é¢çš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼ŸGround Checkï¼šè„šéƒ¨åæ ‡ç‚¹ï¼Œç”¨äºæ£€æµ‹å’Œåœ°é¢ä¹‹é—´çš„ç¢°æ’Ceiling Checkï¼šå¤´éƒ¨åæ ‡ç‚¹ï¼Œæ£€æµ‹å’Œå¤´é¡¶ç‰©ä½“çš„ç¢°æ’ Ceiling Check Ground Check ç¢°æ’æ£€æµ‹ Rigidbody 2D2ç‚¹éœ€è¦æ³¨æ„ï¼šMassæ¯”å…¶ä»–ç‰©ä½“ç¨å¤§ï¼Œè·³è·ƒä¸‹è½çš„æ•ˆæœæ›´å¥½Collision Detectionè®¾ç½®ä¸ºContinuousï¼Œä¸ç„¶åœ¨ç©å®¶ä¸‹è½æ—¶ä¼šå‡ºç°çŸ­æš‚çš„åœ°é¢å¡é¡¿Zæ—‹è½¬è½´é”æ­»ï¼Œå› ä¸ºä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼šTilemap ç¢°æ’æ£€æµ‹Tilemapè¿™é‡Œåˆ’åˆ†æˆ3ä¸ªæ¨¡å—ï¼šå‰æ™¯ï¼šä¸è¢«é®æŒ¡æ— ç¢°æ’å…ƒç´ åæ™¯ï¼šè¢«é®æŒ¡çš„æ— ç¢°æ’å…ƒç´ å¹³å°ï¼šç¢°æ’å…ƒç´ è¿™é‡Œä¸ºéœ€è¦è¿›è¡Œç¢°æ’æ£€æµ‹çš„Tilemapæ·»åŠ 3ä¸ªè„šæœ¬ï¼šRigidbody 2Dï¼šå¼€å¯Staticç±»å‹Tilemap Collider 2DComposite Collider 2DMulti Collider æ··åˆç¢°æ’æ£€æµ‹Tips1: åœ¨Edit Colliderçš„æ—¶å€™ï¼ŒæŒ‰ä½alté”®å¯ä»¥è¿›è¡Œå¯¹ç§°ç¼–è¾‘Tips2: é¼ æ ‡æ‹–åŠ¨è°ƒæ•´å±æ€§æ—¶ï¼ŒæŒ‰ä½altå¯ä»¥è¿›è¡Œç»†è°ƒè§’è‰²å¦‚æœåªç”¨ä¸€ä¸ªBox Collideræˆ–è€…Circle Colliderè¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œæ•ˆæœéƒ½ä¼šæœ‰ç¼ºç‚¹ï¼Œä»…ä½¿ç”¨Box Colliderçš„æ—¶å€™ï¼Œæ–œå¡åœ°æ®µä¼šå‡ºç°å¡é¡¿çš„æƒ…å†µè¿™é‡Œä½œè€…å»ºè®®è§’è‰²ä¸ŠåŠèº«ç”¨Box Colliderï¼Œä¸‹åŠèº«ç”¨Circle Colliderï¼š MovementCharacterController2D Brackeysæä¾›çš„CharacterController2Dç±»ï¼Œå…¶ä¸­æä¾›ç§»åŠ¨çš„ä¸»è¦æ–¹æ³•å°±æ˜¯Moveï¼ŒMoveéœ€è¦3ä¸ªå‚æ•°ï¼šfloat moveï¼šæ°´å¹³ç§»åŠ¨è·ç¦»bool crouchï¼šæ˜¯å¦ä¸‹è¹²bool jumpï¼šæ˜¯å¦è·³è·ƒ Horizontal Movement æ°´å¹³ç§»åŠ¨ ä¸ºPlayeræ·»åŠ ä¸€ä¸ªæ–°çš„è„šæœ¬PlayerMovementï¼špublic class PlayerMovement : MonoBehaviour public CharacterController2D controller2D; // å…³è”çš„æ§åˆ¶å™¨ public float moveSpeed = 50f; // ç§»åŠ¨é€Ÿåº¦ float horizontalMove = 0f; // æ°´å¹³ç§»åŠ¨è·ç¦» // Update is called once per frame void Update() // Input.GetAxisRow(Horizontal) è·å–æ°´å¹³æ–¹å‘çš„ç§»åŠ¨ // å·¦ç§»ï¼šAé”® Input.GetAxisRow(Horizontal) = -1 // å³ç§»ï¼šDé”® Input.GetAxisRow(Horizontal) = 1 horizontalMove = Input.GetAxisRaw(Horizontal) * moveSpeed; void FixedUpdate() // Time.fixedDeltaTime æ—¶é—´å¢é‡ controller2D.Move(horizontalMove * Time.fixedDeltaTime, false, false); å¹¶å°†ä¹‹å‰ä¸ºç©å®¶æ·»åŠ çš„Character Controller 2Dè„šæœ¬ä¸controller2Då±æ€§å…³è”ã€‚ unity input setting Unityæä¾›æŒ‰é”®æ£€æµ‹çš„æ–¹æ³•ï¼šInput.GetButtonDown(Jump); // æ£€æµ‹æŒ‰é”®æŒ‰ä¸‹Input.GetButtonUp(Crouch); // æ£€æµ‹æŒ‰é”®æ¾å¼€è¿™æ ·åªè¦æˆ‘ä»¬æŒ‰ä¸‹Wé”®ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¿”å›trueï¼ŒWé”®-Jumpçš„å¯¹åº”å…³ç³»åœ¨Unityå†…å¯ä»¥ä¿®æ”¹ï¼šEdit - Project Settings - Input Manager Jump è·³è·ƒ åœ¨PlayerMovementä¸­æ·»åŠ è¿›è¡Œè·³è·ƒæ£€æµ‹çš„ä»£ç ï¼špublic class PlayerMovement : MonoBehaviour // ... bool jump = false; void Update() // ... if (Input.GetButtonDown(Jump)) jump = true; void FixedUpdate() controller2D.Move(horizontalMove * Time.fixedDeltaTime, false, jump); jump = false; // è·³è·ƒåé‡ç½® è¿™æ ·åšæ˜¯å¯ä»¥è¿›è¡Œè·³è·ƒï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°è§’è‰²å¡åœ¨å¹³å°è¾¹ç¼˜çš„æƒ…å†µï¼Œè¿™æ˜¯å› ä¸ºè§’è‰²ä¸ŠåŠèº«çš„æ–¹å½¢ç¢°æ’ç›’å’Œå¹³å°ç¢°æ’ç›’ä¹‹é—´å­˜åœ¨æ‘©æ“¦åŠ›ï¼Œå› æ­¤å¯ä»¥ä¸ºè§’è‰²çš„ç¢°æ’ç›’æ·»åŠ æ–°çš„Physics Materialï¼šFiction 0Bounciness 0è¿™æ ·åœ¨å¹³å°è¾¹ç¼˜ï¼Œè§’è‰²å°±ä¼šå› ä¸ºç¼ºå°‘æ‘©æ“¦åŠ›è‡ªåŠ¨æ»‘ä¸‹æ¥ Crouch ä¸‹è¹² åœ¨PlayerMovementä¸­å¯¹ä¸‹è¹²è¿›è¡Œæ£€æµ‹ï¼špublic class PlayerMovement : MonoBehaviour // ... bool crouch = false; // ä¸‹è¹²æ£€æµ‹ void Update() // ... // ä¸‹è¹²æ£€æµ‹ if (Input.GetButtonDown(Crouch)) crouch = true; else if (Input.GetButtonUp(Crouch)) crouch = false; void FixedUpdate() controller2D.Move(horizontalMove * Time.fixedDeltaTime, crouch, jump); jump = false; åœ¨ä¸ºPlayeræ·»åŠ ç¢°æ’ä½“æ—¶ï¼Œåˆ†åˆ«ä¸ºä¸ŠåŠèº«å’Œä¸‹åŠèº«æ·»åŠ äº†ä¸€ä¸ªç¢°æ’ä½“ç§¯ï¼Œä¸‹è¹²å®é™…å®ç°çš„æ˜¯ä½¿ä¸ŠåŠèº«çš„ç¢°æ’ç›’å¤±æ•ˆï¼Œè¿™ä¸€ç‚¹éœ€è¦åœ¨Character Controller 2Dä¸­å¯¹Crouch Disable Colliderè¿›è¡Œé…ç½®åœ¨æŒ‰ä¸‹ä¸‹è¹²é”®æ—¶ï¼Œä¸ŠåŠèº«çš„ç¢°æ’ç›’å°±ä¼šå¤±æ•ˆï¼š onLandingé—ªç”µè§¦å‘Bugé—®é¢˜æè¿° è§’è‰²è·³è·ƒæ—¶ï¼Œæœ¬åº”åªåœ¨è§’è‰²è½åœ°æ—¶è§¦å‘ï¼Œä½†ç°åœ¨åœ¨è§’è‰²è·³èµ·ä¹‹å‰ä¹Ÿè¢«è§¦å‘ä¸€æ¬¡ï¼Œäºæ˜¯è§’è‰²åŠ¨ç”»å°±å› ä¸ºè·³èµ·ä¹‹å‰çš„è¿™ä¸€æ¬¡è¢«å…³é—­äº†ï¼š è§£å†³æ–¹å¼ æŸ¥çœ‹CharacterController2Dä»£ç ï¼Œå‘ç°åœ°é¢æ£€æµ‹æ˜¯åœ¨FixedUpdateå‡½æ•°ä¸­è¢«è°ƒç”¨çš„ï¼Œå› æ­¤åº”å½“æ˜¯å› ä¸ºè·³è·ƒä¹‹åçš„ç¬¬ä¸€å¸§ï¼Œè§’è‰²è¿˜æ²¡æœ‰ç¦»åœ°ï¼ŒCharacterController2Dçš„FixedUpdateå‡½æ•°å°±è¢«è°ƒç”¨äº†ï¼Œäºæ˜¯å°±åˆ¤å®šè·³è·ƒç»“æŸï¼Œå› æ­¤è¿™é‡Œåœ¨FixedUpdateå‡½æ•°ä¸­ä½¿ç”¨Invokeè¿›è¡Œå»¶æ—¶è°ƒç”¨ï¼š // åœ°é¢æ£€æµ‹å‡½æ•°private void CollideCheck() bool wasGrounded = m_Grounded; m_Grounded = false; Collider2D[] colliders = Physics2D.OverlapCircleAll(m_GroundCheck.position, k_GroundedRadius, m_WhatIsGround); for (int i = 0; i colliders.Length; i++) if (colliders[i].gameObject != gameObject) m_Grounded = true; if (!wasGrounded) OnLandEvent.Invoke(); // å»¶æ—¶è°ƒç”¨0.01sprivate void FixedUpdate() Invoke(CollideCheck, 0.01f);"},{"title":"2D Camera","path":"/wiki/Unity/Brackeys_04_2d_camera.html","content":"Cinemachineunityä¸­ä½¿ç”¨Cinemachineè¿›è¡Œç›¸æœºè¿½è¸ªæ•ˆæœã€‚Cinemachineæ‰‹å†ŒCinemachineéœ€è¦ä½œä¸ºåŒ…å¼•å…¥ï¼Œå¼•å…¥ä½ç½®ï¼šWindowPackage ManagerCinemachine â†’ installå¼•å…¥åå°±å¯ä»¥åœ¨Hierarchyä¸­åˆ›å»º2D Cameraåˆ›å»ºå‡ºæ¥çš„Cameraå…¨ç§°CinemachineVirtualCameraï¼Œå³è™šæ‹Ÿç›¸æœºï¼Œå’Œä¸»ç›¸æœºå…³è”ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¯¹CinemachineVirtualCameraè¿›è¡Œçš„æ“ä½œéƒ½ä¼šåæ˜ åˆ°ä¸»ç›¸æœºä¸Šï¼Œå› ä¸ºç›¸æœºè¦è·Ÿéšè§’è‰²çš„ç§»åŠ¨è€Œç§»åŠ¨ï¼Œæ‰€ä»¥éœ€è¦å°†è§’è‰²ç»‘å®šåˆ°Followå±æ€§ä¸Šï¼š CinemachineVirtualCamera.Body CinemachineVirtualCamera.Bodyä¸­æä¾›è®¸å¤šå¯è°ƒæ•´çš„å‚æ•°ï¼šLookahead ç›¸æœºæœè§’è‰²è¿åŠ¨æ–¹å‘çš„åè½¬Damping ç›¸æœºè·Ÿéšé˜»å°¼Screen ç›¸æœºç»å¯¹ä½ç½®Dead Zone æ­»åŒº"},{"title":"2D Shooting","path":"/wiki/Unity/Brackeys_05_2d_Shooting.html","content":"å­å¼¹ å°„çº¿å®ç°Shootingçš„ä¸¤ç§æ–¹å¼ é¢„åˆ¶ä»¶ prefabsåˆ›å»ºBullet Prefabsï¼Œæ¯æ¬¡å°„å‡»éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å­å¼¹å®ä¾‹å­å¼¹æœ¬ä½“æ§åˆ¶å°„å‡ºç­‰åŠ¨ä½œã€ä¼¤å®³ã€æ•ˆæœç­‰å±æ€§å°„çº¿ raycastsç”±å°„å‡»ç‚¹å°„å‡ºä¸€æ¡å°„çº¿ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç¢°æ’ç‰© å¼€ç«ç‚¹ FirePointFirePoint åœ¨Playerå±‚çº§ä¸‹åˆ›å»ºç©ºå¯¹è±¡FirePointï¼Œç”¨äºå¯¹å¼€ç«ç‚¹åæ ‡è¿›è¡Œæ ‡æ³¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ§åˆ¶è§’è‰²ç§»åŠ¨çš„è„šæœ¬CharacterController2Dä¸­ï¼Œå®ç°è§’è‰²æ°´å¹³ç§»åŠ¨æ—¶ç¿»è½¬çš„å‡½æ•°æ˜¯è¿™æ ·çš„ï¼šprivate void Flip() m_FacingRight = !m_FacingRight; // Multiply the players x local scale by -1. Vector3 theScale = transform.localScale; theScale.x *= -1; // åè½¬xè½´ç¼©æ”¾ transform.localScale = theScale;é€šè¿‡åè½¬Playeråœ¨xè½´æ–¹å‘çš„ç¼©æ”¾å€¼è¿›è¡Œç¿»è½¬ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿåœ¨ä¸å½±å“Playeråæ ‡ç³»çš„æƒ…å†µä¸‹å¯¹å®ƒçš„è´´å›¾è¿›è¡Œç¿»è½¬ã€‚ä½†æ˜¯Playerä¸‹çš„FirePointçš„åæ ‡ç³»æ˜¯åŠ¨æ€çš„ï¼Œåœ¨Playerè¿›è¡Œç¿»è½¬æ—¶ï¼ŒFirePointåæ ‡ç³»ä¹Ÿéœ€è¦è·Ÿéšç¿»è½¬ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å­å¼¹ä¸€ç›´æœPlayeré¢å‘çš„æ–¹å‘è¿›è¡Œå°„å‡»ï¼Œé€šè¿‡å°†Playeræ²¿yè½´æ–¹å‘æ—‹è½¬180Â°çš„æ–¹å¼èƒ½å¤Ÿå®ç°è¿™ä¸€ç‚¹ï¼šprivate void Flip() m_FacingRight = !m_FacingRight; transform.Rotate(0f, 180f, 0f); Prefabå°„å‡»Bullet ä½¿ç”¨prefabæ–¹å¼ï¼Œå°±è¦åšbulletçš„prefabï¼šBulletPrefabè„šæœ¬ï¼šBullet ä¸ºå­å¼¹è‡ªå®šä¹‰è¡Œä¸ºçš„è„šæœ¬Circle Collider 2D ç¢°æ’ä½“ç§¯isTrigger true ä»…ç”¨äºè§¦å‘Rigidbody 2DGraivity Scale 0 æ— é‡åŠ›Collision Detection Continuous æŒç»­æ£€æµ‹Freeze Rotation Z true æ— zè½´æ—‹è½¬å°†åšå¥½çš„BulletPrefabæ‹–åŠ¨åˆ°Assetsç›®å½•ä¸‹ï¼Œå³ä½œä¸ºé¢„åˆ¶ä»¶ä½¿ç”¨ã€‚ åˆ›å»ºå­å¼¹å°„å‡»åˆ›å»ºBulletPrefab å­å¼¹å·²ç»åšå¥½ï¼Œé‚£ä¹ˆåªè¦åœ¨Playerå°„å‡»çš„æ—¶å€™åˆ›å»ºå‡ºå­å¼¹å³å¯ï¼Œå› æ­¤éœ€è¦ä¸ºPlayeråˆ›å»ºæ–°çš„Weaponè„šæœ¬ï¼ŒWeaponè„šæœ¬è¦å®ç°åœ¨ç”¨æˆ·å°„å‡»æ—¶åˆ›å»ºBulletPrefabçš„åŠŸèƒ½ï¼šusing System.Collections;using System.Collections.Generic;using UnityEngine;public class Weapon : MonoBehaviour public Transform firePoint; // ç«ç‚¹ æ­¤å¤„èµ‹å€¼Playerä¸‹çš„FirePoint public GameObject bulletPrefab; // å­å¼¹é¢„åˆ¶ä»¶ æ­¤å¤„èµ‹å€¼Bulleté¢„åˆ¶ä»¶ void Update() if (Input.GetButtonDown(Fire1)) Shoot(); // å°„å‡» private void Shoot() // åˆ›å»ºé¢„åˆ¶ä»¶ Instantiate(bulletPrefab, firePoint.position, firePoint.rotation); åˆ›å»ºå®ä¾‹çš„æ–¹æ³•ï¼š// åˆ›å»ºå¯¹è±¡ ä½ç½® æ—‹è½¬Instantiate(GameObject. position, rotation) å­å¼¹ç§»åŠ¨å­å¼¹ç§»åŠ¨ é€šè¿‡ä¸ºBulletæ·»åŠ åˆå§‹é€Ÿåº¦æ¥æ—¶å…¶ä¿æŒç§»åŠ¨ï¼Œè¿™è¦é€šè¿‡å­å¼¹çš„Rigidbody2D.velocityå±æ€§æ¥æ§åˆ¶ï¼špublic class Bullet : MonoBehaviour public float speed = 30f; // é€Ÿåº¦ public Rigidbody2D rd; // ä½¿ç”¨Rigidbody2D.velocityå±æ€§ï¼Œä¸ºç‰©ä½“æä¾›åˆå§‹é€Ÿåº¦ void Start() // é€Ÿåº¦ = ç§»åŠ¨æ–¹å‘ * ç§»åŠ¨é€Ÿåº¦ rd.velocity = transform.right * speed; å­å¼¹ä¼¤å®³å­å¼¹ä¼¤å®³ ç°åœ¨å­å¼¹å·²ç»èƒ½å°„å‡ºï¼Œæ¥ä¸‹æ¥è¦å®ç°çš„ï¼šæ£€æµ‹å­å¼¹æ˜¯å¦ç¢°æ’åˆ°ç‰©ä½“æ£€æµ‹åˆ°ç¢°æ’ï¼Œäº§ç”Ÿå­å¼¹å†²å‡»æ•ˆæœï¼Œå­å¼¹æ¶ˆå¤±ç¢°æ’ç‰©æ˜¯å¦æ˜¯æ•Œäººä½¿æ•Œäººï¼Œé€ æˆä¼¤å®³æ•Œäººè„šæœ¬è¦å®ç°çš„åŠ¨ä½œæ”¶åˆ°ä¼¤å®³ç”Ÿå‘½å€¼ä¸º0æ—¶ï¼Œæ­»äº¡æ­»äº¡æ•Œäººæ¶ˆå¤±å‡ºç°æ¶ˆå¤±ç‰¹æ•ˆEnemyè„šæœ¬ä¸ºæ•Œäººæ·»åŠ çš„Enemyè„šæœ¬å¦‚ä¸‹ï¼špublic class Enemy : MonoBehaviour public int health = 100; // ç”Ÿå‘½å€¼ public GameObject DeathEffect; // æ­»äº¡æ•ˆæœ public void TakeDamage(int damage) health -= damage; if (health = 0) Death(); private void Death() // Quaternion.identityä»£è¡¨æ— æ—‹è½¬ Instantiate(DeathEffect, transform.position, Quaternion.identity); Destroy(gameObject); å…¶ä¸­çš„TakeDamageæ–¹æ³•çš„è°ƒç”¨æ—¶æœºæ˜¯ï¼šå½“å­å¼¹ç¢°æ’åˆ°Enemyæ—¶ï¼Œè¿™ä¸€æ­¥åœ¨Bulleté¢„åˆ¶ä»¶è„šæœ¬ä¸­è¿›è¡Œï¼Œå› æ­¤éœ€è¦ç”¨publicæš´éœ²å‡ºæ¥ã€‚å­å¼¹ç¢°æ’æ£€æµ‹ä¹‹å‰å·²ç»æ‰“å¼€äº†Bulleté¢„åˆ¶ä»¶Collider2Dçš„isTriggeré€‰é¡¹ï¼Œå› æ­¤å½“å­å¼¹ç¢°æ’åˆ°ç‰©ä½“æ—¶ï¼Œä¼šè§¦å‘Unityæä¾›çš„OnTriggerEnter2Då‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æä¾›ä¸€ä¸ªCollider2Dç±»çš„å‚æ•°ï¼Œè¡¨ç¤ºç¢°æ’ç‰©ä¿¡æ¯ã€‚public class Bullet : MonoBehaviour public int damage = 40; // ä¼¤å®³ public GameObject impactEffect; // å­å¼¹å†²å‡»æ•ˆæœé¢„åˆ¶ä»¶ // Triggerå›è°ƒå‡½æ•° private void OnTriggerEnter2D(Collider2D hitInfo) // åˆ¤æ–­ç¢°æ’ç‰©æ˜¯å¦æ˜¯Enemy Enemy enemy = hitInfo.GetComponentEnemy(); if(enemy != null) enemy.TakeDamage(damage); Instantiate(impactEffect, transform.position, transform.rotation); // å†²å‡»æ•ˆæœ Destroy(gameObject); // é”€æ¯å­å¼¹ Raycastå°„å‡»raycastå°„çº¿æ£€æµ‹raycast raycastå’Œprefabä¸åŒçš„åœ°æ–¹æ˜¯ï¼šprefabç¢°æ’çš„é€»è¾‘éœ€è¦å†å­å¼¹ä¸Šå®ç°raycastç¢°æ’çš„é€»è¾‘åœ¨Playerä¸Šå°±èƒ½å®ç°ä¸ºPlayeræ·»åŠ WeaponRaycastè„šæœ¬ï¼špublic class WeaponRaycast : MonoBehaviour public Transform firePoint; public int damage = 30; public GameObject ImpactEffect; // Update is called once per frame void Update() if (Input.GetButtonDown(Fire1)) Shoot(); private void Shoot() RaycastHit2D hitInfo = Physics2D.Raycast(firePoint.position, firePoint.right); if (hitInfo) Enemy enemy = hitInfo.transform.GetComponentEnemy(); if(enemy != null) enemy.TakeDamage(damage); Instantiate(ImpactEffect,hitInfo.point,Quaternion.identity); åˆ›å»ºraycastå¹¶è¿”å›å°„çº¿æ¢æµ‹ç‰©ï¼šRaycastHit2D hitInfo = Physics2D.Raycast(firePoint.position, firePoint.right);åŸæœ¬åœ¨Prefabæ–¹æ³•é‡Œï¼Œä¼šåœ¨OnTriggerEnter2Dæ–¹æ³•ä¸­æä¾›ä¸€ä¸ªCollider2Dç±»å‹çš„å‚æ•°ï¼Œè¿™é‡Œå¯¹åº”RaycastHit2Dä¸­çš„å‚æ•°ä¸ºï¼šEnemy enemy = hitInfo.transform.GetComponentEnemy();è€Œç¢°æ’ç‚¹çš„åæ ‡å€¼åˆ™ä»hitInfo.pointé‡Œå–å¾— å°„çº¿ç»˜åˆ¶Line ä½¿ç”¨Lineï¼ˆEffectLineï¼‰æ¥ä½œä¸ºå°„çº¿æ•ˆæœï¼Œåœ¨Playerä¸‹åˆ›å»ºLineå®ä¾‹ï¼Œå¼€å¯Lineçš„Use World Spaceå±æ€§ Coroutineå°„çº¿æ•ˆæœ public class WeaponRaycast : MonoBehaviour // ... private void Start() lineRenderer.enabled = false; // å¼€å§‹æ—¶å…³é—­å°„çº¿å¯è§ void Update() if (Input.GetButtonDown(Fire1)) StartCoroutine(Shoot()); // StartCoroutineè°ƒç”¨Shoot IEnumerator Shoot() // IEnumeratorå£°æ˜ // ...ç¢°æ’æ£€æµ‹ç•¥ // å®ç°å°„çº¿çŸ­æš‚æ˜¾ç¤ºçš„æ•ˆæœ lineRenderer.enabled = true; // å®ç°çŸ­æš‚å»¶æ—¶ yield return new WaitForSeconds(0.01f); lineRenderer.enabled = false; Top Down Shooting ä¿¯è§†è§’å°„å‡»è¿™é‡Œä¿¯è§†è§’ä¸‹ç©å®¶çš„ç§»åŠ¨æ¶‰åŠåˆ°è·Ÿéšé¼ æ ‡ç§»åŠ¨çš„æ—‹è½¬ï¼špublic class PlayerMovement : MonoBehaviour public float moveSpeed = 5f; // ç§»åŠ¨é€Ÿåº¦ public Rigidbody2D rb; // rigidbody Vector2 movement; // ä½ç½® public Animator animator; // åŠ¨ç”»æ§åˆ¶å™¨ public Camera cam; // ç›¸æœº Vector2 mousePos; // é¼ æ ‡ä½ç½® // Updateç”¨äºè·å–ç©å®¶è¾“å…¥ void Update() movement.x = Input.GetAxisRaw(Horizontal); // è·å–æ¨ªåæ ‡ movement.y = Input.GetAxisRaw(Vertical); // è·å–çºµåæ ‡ // åŠ¨ç”» float moveDiff = Mathf.Abs(movement.x * moveSpeed) + Mathf.Abs(movement.y * moveSpeed); // ç›¸å¯¹ç§»åŠ¨è·ç¦» animator.SetFloat(speed, moveDiff); // å°†é¼ æ ‡ç›¸å¯¹å±å¹•çš„åæ ‡è½¬æ¢ä¸ºä¸–ç•Œç‚¹ä½åæ ‡ mousePos = cam.ScreenToWorldPoint(Input.mousePosition); // FixedUpdateç”¨äºå¯¹ç©å®¶ä½ç½®æ›´æ–° private void FixedUpdate() rb.MovePosition(rb.position + movement * moveSpeed * Time.fixedDeltaTime); // è®¡ç®—zè½´æ—‹è½¬è§’ Vector2 lookDir = mousePos - rb.position; float angle = Mathf.Atan2(lookDir.y, lookDir.x) * Mathf.Rad2Deg + 90f; rb.rotation = angle; Input.GetAxisRaw(â€œHorizontal|Verticalâ€) è·å–æ¨ªå‘çºµå‘ç§»åŠ¨è·ç¦»Camera.ScreenToWorldPoiint(Vector2D var) å°†é¼ æ ‡ç›¸å¯¹å±å¹•çš„åæ ‡è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ç³»ä¸‹çš„åæ ‡æœ€åéœ€è¦æ ¹æ®ç©å®¶å½“å‰åæ ‡å’Œé¼ æ ‡ä½ç½®è®¡ç®—æ—‹è½¬çš„è§’åº¦ï¼šMathf.Atan2(y,x) è·å–æ­£å¼¦å€¼ä¸ºyxçš„å¼§åº¦Mathf.Rad2Deg å°†å¼§åº¦è½¬ä¸ºè§’åº¦éœ€è¦ä¹˜ä¸Šçš„æ•°Shootingè„šæœ¬Shootingè„šæœ¬éœ€è¦åœ¨ç©å®¶è§¦å‘å­å¼¹å‘å°„è¡Œä¸ºæ—¶ï¼Œè·å–å¼€ç«ç‚¹åˆ›å»ºå­å¼¹å®ä¾‹ ç»™å­å¼¹ä¸€ä¸ªæ¨åŠ¨åŠ›ï¼špublic class Shooting : MonoBehaviour public GameObject Bullet; // å­å¼¹prefab public Transform FirePoint; // å¼€ç«ç‚¹ public float bulletForce = 20f; // å­å¼¹é€Ÿåº¦ private void Update() if (Input.GetButtonDown(Fire1)) Shoot(); private void Shoot() GameObject bullet = Instantiate(Bullet, FirePoint.position, FirePoint.rotation); Rigidbody2D rb = bullet.GetComponentRigidbody2D(); rb.AddForce(-FirePoint.up * bulletForce, ForceMode2D.Impulse); Bulletæœ€åæ˜¯å­å¼¹è‡ªèº«æ£€æµ‹åˆ°ç¢°æ’åçš„é€»è¾‘ï¼špublic class Bullet : MonoBehaviour public GameObject ImpactEffect; private void OnCollisionEnter2D(Collision2D collision) GameObject impactEffect = Instantiate(ImpactEffect, transform.position, Quaternion.identity); Destroy(impactEffect, 0.5f); // åŠç§’åé”€æ¯ç‰¹æ•ˆå®ä¾‹ Destroy(gameObject); // é”€æ¯å½“å‰å®ä¾‹"},{"title":"2D Animation","path":"/wiki/Unity/Brackeys_03_2d_animation.html","content":"åˆ›å»ºåŠ¨ç”»æ–°å»ºAnimationå’ŒAnimator è°ƒå‡ºAnimationé¢æ¿ï¼ˆWindowAnimationAnimationï¼‰Hierarchyé€‰ä¸­æ·»åŠ åŠ¨ç”»çš„å…ƒç´ ï¼ˆPlayerï¼‰ç‚¹å‡»Animationä¸­Createåˆ›å»ºæ–°çš„åŠ¨ç”»åˆ›å»ºåŠ¨ç”»çš„åŒæ—¶ï¼ŒAnimatorä¹Ÿåˆ›å»ºå‡ºæ¥äº†ã€‚ åˆ›å»ºå¸§åºåˆ—åŠ¨ç”» å°†ä¸€ç»„å¸§åºåˆ—åŠ¨ç”»æ‹–å…¥Animationé¢æ¿å³å¯åˆ›å»ºä¸€ä¸ªæ–°çš„åŠ¨ç”»ï¼Œè°ƒæ•´Samplesé‡‡æ ·å€¼ï¼ˆæ¯ç§’é’Ÿæ’­æ”¾çš„å›¾ç‰‡æ•°ï¼‰idle AnimatoråŠ¨ç”»æ§åˆ¶å™¨Animatorè®¾ç½® Parameter æ·»åŠ å˜é‡Base Layer ç¼–è¾‘çŠ¶æ€Setting è¿ç§»è®¾ç½®Condition è¿ç§»æ¡ä»¶ è„šæœ¬ä¸­ä¿®æ”¹Animatorçš„å˜é‡ å®šä¹‰animatorï¼Œå®šä¹‰å®Œåè®°å¾—åœ¨Inspectorä¸­èµ‹å€¼public Animator animator; // åŠ¨ç”»æ§åˆ¶å™¨ä¿®æ”¹é€Ÿåº¦Speedå˜é‡çš„å€¼ï¼ˆSetFloatï¼‰ï¼šhorizontalMove = Input.GetAxisRaw(Horizontalâ€œ) * moveSpeed;animator.SetFloat(Speed, Mathf.Abs(horizontalMove))// è·³è·ƒæ£€æµ‹ if (Input.GetButtonDown(Jump)) jump = true; animator.SetBool(IsJumping, true); ç”±äºè·³è·ƒåŠ¨ç”»å¹¶ä¸æ˜¯åœ¨è·³è·ƒæœŸé—´å¾ªç¯æ’­æ”¾ï¼Œè€Œæ˜¯åœ¨è·³è·ƒå¼€å§‹åˆ°è·³è·ƒç»“æŸä¹‹é—´åªæ’­æ”¾ä¸€æ¬¡ï¼Œå› æ­¤éœ€è¦å°†Any Status â†’ player_jump ä¹‹é—´çš„è½¬åŒ–Settingçš„Can Transition To Selfå…³é—­ã€‚æˆ‘ä»¬çŸ¥é“è§’è‰²ä½•æ—¶è·³èµ·ï¼Œå¦‚ä½•çŸ¥é“ä½•æ—¶è½åœ°ï¼ŸåŒæ ·çš„ï¼ŒçŸ¥é“è§’è‰²ä½•æ—¶å¼€å§‹è¹²ä¸‹ï¼Œå¦‚ä½•çŸ¥é“è§’è‰²ä½•æ—¶èµ·æ¥ï¼ŸCharacterController2Dè„šæœ¬æä¾›ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼šOnLand è·³è·ƒç»“æŸå›è°ƒå‡½æ•°OnCrouch è¹²ä¸‹ç»“æŸå›è°ƒå‡½æ•°åœ¨playerMovementä¸­æ·»åŠ ä¸¤ä¸ªå‡½æ•°// è·³è·ƒç»“æŸå›è°ƒå‡½æ•°public void OnLanding() animator.SetBool(IsJumping, false);// ä¸‹è¹²æ£€æµ‹å‡½æ•°public void OnCrouching(bool isCrouching) animator.SetBool(IsCrouching, isCrouching);è®¾ç½®è¿™ä¸¤ä¸ªå‡½æ•°ä¸CharacterController2Dä¸­å¯¹åº”ï¼šæ³¨æ„ï¼šOnCrouchå‡½æ•°æœ‰ä¸€ä¸ªboolç±»å‹å‚æ•°ï¼Œä»£è¡¨æ˜¯å¦è¹²ä¸‹ï¼Œå› æ­¤åœ¨å…³è”æ—¶ï¼Œéœ€è¦é€‰ç”¨ä¸Šé¢çš„Dynamic bool"},{"title":"2D Sprite Shape","path":"/wiki/Unity/Brackeys_06_2d_sprite_shape.html","content":"Sprite ShapeSprite Shape å®˜æ–¹æ–‡æ¡£Unityä¸­ä¸¤ç§åˆ›å»ºåœ°å›¾çš„æ–¹å¼ï¼šTile Map é€šè¿‡åœ¨gridä¸Šé“ºæ»¡ç“¦ç‰‡çš„æ–¹å¼åˆ›å»ºåœ°å›¾ï¼Œçµæ´»åº¦ä½Sprite Shape èƒ½å¤Ÿå¯¹Spriteå›¾åšæ‹‰ä¼¸ã€å¹³é“ºç­‰æ“ä½œï¼Œæ›´åŠ çµæ´»ä½¿ç”¨Sprite Shapeï¼Œé¦–å…ˆè¦å®‰è£…å®ƒï¼šWindowPackage ManagerPackages:Unity Registry2D SpriteShapeInstallå‡†å¤‡çš„Spriteç²¾çµå›¾éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼šPixels Per Unit : 16Filter Mode : PointCompression : None Open Sprite Shapeopen sprite shapeæ¯”è¾ƒé€‚åˆç”¨æ¥åšå¹³é¢åˆ›å»º Sprite Shape ProfileProjectèœå•Create2DSprite Shape Profileå°†å¹³é¢å›¾ä½œä¸º-180Â°åˆ°180Â°çš„Spriteå›¾å¡«å…¥ï¼Œåœ¨Hierarchyæ ‘ä¸‹åˆ›å»ºOpen Sprite Shapeï¼š2D ObjectSprite ShapeOpen Sprite Shapeå°†Sprite Shape Controllerçš„Profileè®¾ç½®ä¸ºåˆšæ‰åˆ›å»ºçš„Sprite Shape Profileï¼ŒEdit Splineï¼šè¿™é‡Œç”±äºæ²¡æœ‰å¯¹Spriteæ‹‰ä¼¸çš„éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¸€æ®µä¸€æ®µçš„æƒ…å†µï¼Œéœ€è¦å¯¹Spriteè¿›è¡ŒBorderè°ƒæ•´ï¼šè¿™æ ·Sprite Shapeæ‹‰ä¼¸éƒ¨åˆ†å°±ä¼šæ ¹æ®è°ƒæ•´çš„éƒ¨åˆ†è¿›è¡Œæ‹¼æ¥ï¼šSprite Shape ColliderSprite Shapeçš„Colliderä½¿ç”¨Edge Collider 2Dï¼ŒåŠ å…¥åï¼Œéœ€è¦è°ƒæ•´Sprite Shape Controllerä¸­çš„2ä¸ªå±æ€§ï¼šUpdate Collider ä¸ºtrueè°ƒæ•´Offsetï¼Œä¸ç„¶Collideråˆ¤å®šåœ¨Edgeçš„ä¸­é—´ Close Sprite Shapeåœ¨Close Sprite Shapeä¸­ï¼Œæ—‹è½¬è§’åº¦ä¸åŒçš„Spriteå¯ä»¥é€‰æ‹©ä¸åŒçš„è´´å›¾ï¼Œåªéœ€è¦è§„å®šå¥½èµ·å§‹è§’åº¦ï¼Œå’Œåœ¨è¿™ä¸ªè§’åº¦èŒƒå›´å†…å±•ç¤ºçš„è´´å›¾å³å¯ï¼šæ³¨æ„ï¼šé—­åˆçš„Sprite Shapeä½¿ç”¨Angle Rangesé…ç½®å››å‘¨çš„è´´å›¾ï¼Œä¸­å¿ƒè´´å›¾éœ€è¦å¯¹Fill Textureè¿›è¡Œé…ç½®ï¼Œä¸­å¿ƒè´´å›¾ç»˜åˆ¶çš„æ¨¡å¼åœ¨é€‰æ‹©å¡«å…¥çš„Spriteè´´å›¾Inspectorä¸­ï¼Œæœ‰ä¸€ä¸ªWeap Modeå±æ€§ï¼Œå¯ä»¥é€‰æ‹©Repeaté‡å¤ã€‚Conersè®¾ç½®æ‹è§’è´´å›¾ï¼šåˆ›å»ºClose Sprite Shapeï¼Œèµ‹å€¼Profileï¼Œæœ€ç»ˆå¯ä»¥è·å–åˆ°ä¸€ä¸ªå¯ç¼–è¾‘çš„Close Sprite Shapeï¼š"},{"title":"2D Lighting","path":"/wiki/Unity/Brackeys_07_2d_light.html","content":"Unityç‰ˆæœ¬:2021 å®‰è£…URPåŒ…ä½¿ç”¨Package Managerå®‰è£…Universal RPåŒ…å®‰è£…å¥½ä¹‹åå°±èƒ½åœ¨Assetsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºURPæ¸²æŸ“ç®¡çº¿ï¼ŒCreateRenderingURP Asset(with 2d renderer)æ–°å»ºåè¿˜ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªrenderer 2d dataæ–‡ä»¶ï¼Œç”¨æ¥æ”¾åœ¨URP Assetçš„Renderer Listé‡Œçš„ã€‚å°†Project SettingsGraphicsScriptable Renderer Pipeline Settingsè®¾ç½®ä¸ºåˆšæ‰åˆ›å»ºçš„URP Assetæ–‡ä»¶ åˆ‡æ¢æ¸²æŸ“æ¨¡å¼ å°†æ¸²æŸ“ç®¡çº¿ä¿®æ”¹æˆURP Assetä¹‹åï¼Œè¿˜éœ€è¦å°†Spriteçš„æè´¨ä¿®æ”¹ä¸ºSprite-Lit-Defaultè¿™æ ·Spriteæ‰èƒ½å—åˆ°å…‰ç…§çš„å½±å“ã€‚é€šè¿‡WindowRenderingRender Pipeline Converterå¯¹ç°æœ‰åœºæ™¯ä¸­çš„Spriteè¿›è¡Œæè´¨æ›¿æ¢ï¼Œé€‰æ‹©Convert Built-in to 2D(URP)ï¼Œå‹¾é€‰ Material and Material Reference Upgrade è¿›è¡Œæ›´æ–°è¿™æ ·æ‰€æœ‰Spriteçš„æè´¨éƒ½è¢«æ›¿æ¢ä¸ºSprite-Lit-Default Spriteæ²¡æœ‰å˜æš—é—®é¢˜ æŒ‰ç†æ¥è¯´Spriteçš„Materialä¿®æ”¹ä¸ºSprite-Lit-Defaultåï¼Œå°±ä¼šå—å…‰ç…§å½±å“ï¼Œå¦‚æœæ²¡æœ‰Lightçš„è¯ï¼Œä¼šå˜ä¸ºå…¨é»‘ï¼Œä½†æ˜¯å¦‚æœåœºæ™¯ä¸­Spriteæ²¡æœ‰å˜é»‘ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰åŠ ä»»ä½•Lightå®ä¾‹ï¼Œåªæœ‰å­˜åœ¨è‡³å°‘ä¸€ä¸ªå…¨å±€å…‰ç…§GlobalLightæ—¶ï¼Œå…‰ç…§æ‰èƒ½æœ‰æ•ˆã€‚å‚è€ƒè§†é¢‘å¦å¤–ï¼Œåœ¨Hierarchyç›´æ¥é€šè¿‡èœå•åˆ›å»ºçš„Lightæœ‰æ—¶ä¼šè‡ªå¸¦ä¸€ä¸ªLighté…ç½®è„šæœ¬ï¼ˆå¯¼è‡´ä¸èµ·ä½œç”¨ï¼‰ï¼Œéœ€è¦é¢å¤–æ·»åŠ Light 2Dè„šæœ¬æ‰èµ·ä½œç”¨ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ã€‚ Lightå®ŒæˆURPçš„é…ç½®åï¼Œå°±èƒ½åœ¨Hierarchyä¸­åˆ›å»º2D Lightï¼ŒUnityæä¾›å¾ˆå¤šç§ç±»çš„å…‰æºï¼šPoint Light ç‚¹å…‰æºSpot Light èšå…‰ç¯å¯ä»¥è°ƒæ•´è§’åº¦Global å…¨å±€å…‰ç…§Sprite è´´å›¾å…‰ç…§èƒ½å¤Ÿæ ¹æ®æä¾›çš„å…‰ç…§è´´å›¾æ·»åŠ å…‰Freeform è‡ªå®šä¹‰å½¢çŠ¶å…‰å¯ä»¥è‡ªå®šä¹‰å…‰çš„å½¢çŠ¶ï¼Œå¾ˆå¥½ç”¨ï¼è¿™äº›å…‰æºéƒ½æ˜¯å¯ä»¥è°ƒæ•´å½±å“å›¾å±‚çš„ï¼ˆTarget Sorting Layersï¼‰ Normal TextureSpriteè¿˜æ”¯æŒæ³•çº¿è´´å›¾æ³•çº¿è´´å›¾é€šè¿‡å…‰ç…§èƒ½ä¸º2dç‰©ä½“å¸¦æ¥3dæ•ˆæœï¼š"}]